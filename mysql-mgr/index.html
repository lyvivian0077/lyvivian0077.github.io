
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
      
      
        <link rel="next" href="../mysql-group-replication-how-to-elect-the-new-primary-node/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.9">
    
    
      
        <title>MGR - 总有刁民想要害朕</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mysql-mgr" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="总有刁民想要害朕" class="md-header__button md-logo" aria-label="总有刁民想要害朕" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            总有刁民想要害朕
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MGR
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="总有刁民想要害朕" class="md-nav__button md-logo" aria-label="总有刁民想要害朕" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    总有刁民想要害朕
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          ansbile
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          ansbile
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ansbile/" class="md-nav__link">
        ansbileオプション
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ansbile_async/" class="md-nav__link">
        ansbile_async
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../awk/" class="md-nav__link">
        awk
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../sed/" class="md-nav__link">
        sed
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../MB-MiB%E7%9A%84%E5%8C%BA%E5%88%AB/" class="md-nav__link">
        MB_MiB的区别
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          MegaRAID
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          MegaRAID
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../megacli/" class="md-nav__link">
        megacli
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../megaraid/" class="md-nav__link">
        megaraid
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          PostgreSQL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          PostgreSQL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../psql-vs-mysql/" class="md-nav__link">
        MySQLとPostgreSQLコマンド比較表
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          MySQL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          MySQL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" class="md-nav__link">
        Explain详解与索引最佳实践
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql/" class="md-nav__link">
        Mysql参数优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql-table/" class="md-nav__link">
        MySQL-table
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql%E3%82%92%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%8B%E3%82%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/" class="md-nav__link">
        MySQLビルド
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        学习笔记
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_6" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_8_6" id="__nav_8_6_label" tabindex="0">
          MGR
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_6_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_8_6">
          <span class="md-nav__icon md-icon"></span>
          MGR
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          MGR
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        MGR
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    参考
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mgr" class="md-nav__link">
    MGR的使用约束
  </a>
  
    <nav class="md-nav" aria-label="MGR的使用约束">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vm" class="md-nav__link">
    検証VM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mycnf" class="md-nav__link">
    my.cnf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    各节点配置
  </a>
  
    <nav class="md-nav" aria-label="各节点配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    设置复制账号
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#master" class="md-nav__link">
    MASTERサーバ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slave" class="md-nav__link">
    SLAVEサーバ追加
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recovering" class="md-nav__link">
    RECOVERINGになった場合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    確認
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sysbench" class="md-nav__link">
    sysbenchの検証
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#master_1" class="md-nav__link">
    MASTER死んだ場合の確認
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#master_2" class="md-nav__link">
    MASTERサーバを障害から復活の場合
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    運用中のグループにインスタンスを追加
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip" class="md-nav__link">
    IPアドレスのホワイトリスト
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-group-replication" class="md-nav__link">
    Monitoring Group Replication
  </a>
  
    <nav class="md-nav" aria-label="Monitoring Group Replication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    レプリケーションチャンネルには次の用途の2つが作成されています。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    グループのメンバに関するパフォーマンステーブルのビューについて。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replication_group_members" class="md-nav__link">
    replication_group_members で表示されるメンバーのステータス。
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keepalived" class="md-nav__link">
    keepalived
  </a>
  
    <nav class="md-nav" aria-label="keepalived">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mysqldmysql" class="md-nav__link">
    mysqld/mysqlサーバが落ちた場合の復旧手順
  </a>
  
    <nav class="md-nav" aria-label="mysqld/mysqlサーバが落ちた場合の復旧手順">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mgr_1" class="md-nav__link">
    落ちたサーバをMGRに参加する
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    起動順番
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clone" class="md-nav__link">
    clone
  </a>
  
    <nav class="md-nav" aria-label="clone">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clone-status" class="md-nav__link">
    clone status
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql-group-replication-how-to-elect-the-new-primary-node/" class="md-nav__link">
        MGR 如何选举新的主节点
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql-mgr-copy/" class="md-nav__link">
        転載MGR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql-ha/" class="md-nav__link">
        mysql+keepalived搭建教程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql-clone/" class="md-nav__link">
        mysqlクローン機能
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          Python Tips
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Python Tips
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python-styleguide/" class="md-nav__link">
        Python风格规范
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python-config/" class="md-nav__link">
        Python程序配置文件管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python-decorator/" class="md-nav__link">
        装饰器
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python-dunder/" class="md-nav__link">
        5种下划线
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python-function/" class="md-nav__link">
        传入参数的几种方法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python/" class="md-nav__link">
        非常规的技巧
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python-mysql/" class="md-nav__link">
        操作mysql基础
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/" class="md-nav__link">
        Re 模块
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E6%80%BB%E7%BB%93/" class="md-nav__link">
        字符串拼接总结
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E4%B8%80%E8%A1%8C-Python-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%B9%B6%E8%A1%8C/" class="md-nav__link">
        代码并行
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Regular-Expression/" class="md-nav__link">
        正規表現
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../taged-VLAN%E3%81%A8untagedVLAN%E3%81%AE%E9%81%95%E3%81%84/" class="md-nav__link">
        タグVLAN
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../sar/" class="md-nav__link">
        sar
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/" class="md-nav__link">
        Bash编程超详细语法总结
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../iptables/" class="md-nav__link">
        iptables
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../linux-lvm/" class="md-nav__link">
        linux-lvm
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../centos7-set-kernel/" class="md-nav__link">
        centos7-set-kernel
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../centos-network-device-naming/" class="md-nav__link">
        centos-network-device-naming
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Linux-Performance/" class="md-nav__link">
        Linux Performance
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Linux-shell-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6-%E9%80%BB%E8%BE%91%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%A6%E8%A7%A3/" class="md-nav__link">
        Linux-shell-逻辑运算符-逻辑表达式详解
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../LVM%E9%80%BB%E8%BE%91%E5%8D%B7%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8ALVM%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/" class="md-nav__link">
        LVM逻辑卷基本概念及LVM的工作原理
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../macOS%E8%BD%AF%E4%BB%B6%E7%BC%96%E8%AF%91%E6%97%B6%E6%89%BE%E4%B8%8D%E5%88%B0%E5%A4%B4%E6%96%87%E4%BB%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95-%E6%9B%B4%E6%96%B010-15/" class="md-nav__link">
        macOS软件编译时找不到头文件解决方法[更新10.15]
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ubnt/" class="md-nav__link">
        ubnt
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../vim/" class="md-nav__link">
        VIM
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="mysql-mgr">MYSQL MGR<a class="headerlink" href="#mysql-mgr" title="Permanent link">&para;</a></h1>
<h4 id="_1">参考<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h4>
<ul>
<li>https://www.modb.pro/db/337457</li>
<li>https://www.modb.pro/db/377620</li>
<li>https://www.modb.pro/db/25554</li>
<li>https://www.cndba.cn/dave/article/108030</li>
<li>https://blog.51cto.com/imysql/3199719</li>
<li>https://dev.mysql.com/doc/refman/8.0/ja/group-replication-adding-instances.html</li>
<li>https://ngyuki.hatenablog.com/entry/2018/07/02/072619</li>
</ul>
<h2 id="mgr">MGR的使用约束<a class="headerlink" href="#mgr" title="Permanent link">&para;</a></h2>
<ol>
<li>仅支持InnoDB表,并且每张表一定要有一个主键,用于做write set 的冲突检测<ul>
<li>mgr模式下所有表都需要设置主键，不然会报错</li>
<li><code>ERROR 3098 (HY000): The table does not comply with the requirements by an external plugin.</code></li>
</ul>
</li>
<li>必须打开GTID特性,二进制日志格式必须设置为ROW,用于选主与write set; <ul>
<li>主从状态信息存于表中,(--master-info-repository=TABLE, --relay-log-info-repository=TABLE), --log-slave-updates打开.</li>
</ul>
</li>
<li>MGR不支持大事务,事务大小最好不超过143MB, 当事务过大,无法在5秒的时间内通过网络在组成员之间复制消息,则可能会怀疑成员失败了,然后将其逐出局</li>
<li>目前一个MGR群集最多支持9个节点</li>
<li>不支持外键于save point特性, 无法做全局间的约束检测与部分事务回滚</li>
<li>二进制日志不支持binlog Event Checksum (在 MySQL 8.0.20 之前)<ul>
<li>从 MySQL 8.0.21 开始，Group Replication 支持校验和，因此组成员可以使用默认设置。</li>
<li>From MySQL 8.0.21, Group Replication supports checksums, so group members may use the default setting.</li>
<li>https://dev.mysql.com/doc/refman/8.0/en/replication-options-binary-log.html#sysvar_binlog_checksum</li>
</ul>
</li>
</ol>
<h3 id="vm">検証VM<a class="headerlink" href="#vm" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th align="left">IP</th>
<th align="left">Hostname</th>
<th align="left">virt_name</th>
<th align="left">spec</th>
<th align="left">HV</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">xx.yyy.zzz.1</td>
<td align="left">node1 (<strong>rocky8</strong>)</td>
<td align="left">mysql8-test</td>
<td align="left">22c/160g</td>
<td align="left">hv1</td>
</tr>
<tr>
<td align="left">xx.yyy.zzz.2</td>
<td align="left">node2 (<strong>rocky87-mysql8</strong>)</td>
<td align="left">rocky87-test</td>
<td align="left">8c/16g</td>
<td align="left">hv2</td>
</tr>
<tr>
<td align="left">xx.yyy.zzz.3</td>
<td align="left">node3 (<strong>amd-rocky8</strong>)</td>
<td align="left">rocky-mysql8</td>
<td align="left">22c/160g</td>
<td align="left">hv2</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>MySQL再インストール</p>
</li>
<li>
<p>mysql8はインストール済のため、一旦削除する</p>
</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a># backup
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>[root@node3 work]# pwd
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>/root/work
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>[root@node3 work]#
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>cp /etc/my.cnf my.cnf.20230515
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>cp /root/.my.cnf .my.cnf.20230515
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>cp /root/.mytop .mytop.20230515
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a># rpmを削除
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>[root@node1 work]# for i in `rpm -aq | grep mysql`; do yum -y remove $i; done
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>[root@node2 work]# for i in `rpm -aq | grep mysql`; do yum -y remove $i; done
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>[root@node3 work]# for i in `rpm -aq | grep mysql`; do yum -y remove $i; done
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a># 不要ファイル削除
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>rm -rf /etc/my.cnf.rpmsave
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>rm -rf /etc/my.cnf
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>rm -rf /etc/mysql-version.txt
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>rm -rf /home/mysql
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>rm -rf /root/.my.cnf
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>rm -rf /root/.mytop
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a># AnsibleでMySQL8.0を再インストールする
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>$ sudo /usr/local/bin/ansible-playbook mysql80.yml --limit xx.yyy.zzz.1,xx.yyy.zzz.2,xx.yyy.zzz.3  -t systool,mysql80 -v
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>PLAY RECAP *********************************************************************************************************************
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>xx.yyy.zzz.1              : ok=29   changed=12   unreachable=0    failed=0    skipped=6    rescued=0    ignored=0
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>xx.yyy.zzz.2              : ok=29   changed=12   unreachable=0    failed=0    skipped=6    rescued=0    ignored=0
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>xx.yyy.zzz.3              : ok=28   changed=14   unreachable=0    failed=0    skipped=6    rescued=0    ignored=0
</span></code></pre></div>
<h3 id="mycnf">my.cnf<a class="headerlink" href="#mycnf" title="Permanent link">&para;</a></h3>
<details class="info">
<summary>my.cnf</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>[mysql]
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>default-character-set=utf8mb4
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>socket=/tmp/mysql.sock
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>auto-rehash
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>prompt=&quot;\\r:\\m:\\s \\u@\\h[\\d]&gt; &quot;
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>[mysqld]
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a># mgr
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>server_id=1
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>gtid_mode=ON
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>enforce_gtid_consistency=ON
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>binlog_checksum=NONE
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>log_replica_updates=ON
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>log_bin=binlog
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>relay_log=relay_log
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>binlog_format=ROW
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>plugin-load=mysql_clone.so;group_replication.so
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>loose-group_replication_group_name=&quot;aaaaaaaa-1111-2222-3333-bbbbbbbbbbbb&quot;
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>loose-group_replication_start_on_boot=off
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>loose-group_replication_local_address=&quot;node1:33061&quot;
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>loose-group_replication_group_seeds=&quot;node1:33061,node2:33061,node3:33061&quot;
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>loose-group_replication_bootstrap_group=off
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>loose-group_replication_ip_allowlist=&quot;xx.yyy.zzz.0/25&quot;
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>report-host=&quot;node1&quot;
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>binlog_expire_logs_seconds=86400 # 表示自动删除1天以前的binlog，可选
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a># general
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>user=mysql
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a>datadir=/home/mysql
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a>socket=/tmp/mysql.sock
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>tmpdir=/home/tmp
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>bind-address=0.0.0.0
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>performance_schema_show_processlist=1
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>default_storage_engine=INNODB
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a>skip-name-resolve
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a>skip-mysqlx
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a># skip-log-bin # MGRのため、コメントアウト
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a>event_scheduler=OFF
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a>
</span><span id="__span-1-43"><a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a>tls_version=TLSv1.2,TLSv1.3
</span><span id="__span-1-44"><a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a>sql_mode=&quot;ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION&quot;
</span><span id="__span-1-45"><a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a>
</span><span id="__span-1-46"><a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a>max_connections=100
</span><span id="__span-1-47"><a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a>max_connect_errors=300
</span><span id="__span-1-48"><a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a>max_allowed_packet=32M
</span><span id="__span-1-49"><a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a>connect_timeout=30
</span><span id="__span-1-50"><a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a>max_user_connections=30
</span><span id="__span-1-51"><a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a>table_open_cache=9600
</span><span id="__span-1-52"><a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a>interactive_timeout=300
</span><span id="__span-1-53"><a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a>wait_timeout=300
</span><span id="__span-1-54"><a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a>tmp_table_size=256M
</span><span id="__span-1-55"><a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a>max_heap_table_size=256M
</span><span id="__span-1-56"><a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a>default_password_lifetime=0
</span><span id="__span-1-57"><a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a>explicit_defaults_for_timestamp=1
</span><span id="__span-1-58"><a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a>log_timestamps=SYSTEM
</span><span id="__span-1-59"><a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a>character-set-server=utf8mb4
</span><span id="__span-1-60"><a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a>collation-server=utf8mb4_general_ci
</span><span id="__span-1-61"><a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a>
</span><span id="__span-1-62"><a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a># auth
</span><span id="__span-1-63"><a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a>authentication_policy = &#39;mysql_native_password,,&#39;
</span><span id="__span-1-64"><a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a>
</span><span id="__span-1-65"><a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a># ssl_rsa
</span><span id="__span-1-66"><a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a>auto_generate_certs=ON
</span><span id="__span-1-67"><a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a>caching_sha2_password_auto_generate_rsa_keys=0
</span><span id="__span-1-68"><a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a>sha256_password_auto_generate_rsa_keys=0
</span><span id="__span-1-69"><a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a>
</span><span id="__span-1-70"><a id="__codelineno-1-70" name="__codelineno-1-70" href="#__codelineno-1-70"></a># innodb doublewrite
</span><span id="__span-1-71"><a id="__codelineno-1-71" name="__codelineno-1-71" href="#__codelineno-1-71"></a>innodb_doublewrite_dir=&quot;/home/mysql/#innodb_dblwr&quot;
</span><span id="__span-1-72"><a id="__codelineno-1-72" name="__codelineno-1-72" href="#__codelineno-1-72"></a># innodb_doublewrite_files=16 # (innodb_buffer_pool_instances * 2)
</span><span id="__span-1-73"><a id="__codelineno-1-73" name="__codelineno-1-73" href="#__codelineno-1-73"></a>
</span><span id="__span-1-74"><a id="__codelineno-1-74" name="__codelineno-1-74" href="#__codelineno-1-74"></a># undo log
</span><span id="__span-1-75"><a id="__codelineno-1-75" name="__codelineno-1-75" href="#__codelineno-1-75"></a>innodb_max_undo_log_size=1G
</span><span id="__span-1-76"><a id="__codelineno-1-76" name="__codelineno-1-76" href="#__codelineno-1-76"></a>
</span><span id="__span-1-77"><a id="__codelineno-1-77" name="__codelineno-1-77" href="#__codelineno-1-77"></a># log
</span><span id="__span-1-78"><a id="__codelineno-1-78" name="__codelineno-1-78" href="#__codelineno-1-78"></a>slow_query_log=1
</span><span id="__span-1-79"><a id="__codelineno-1-79" name="__codelineno-1-79" href="#__codelineno-1-79"></a>log_error_verbosity=3
</span><span id="__span-1-80"><a id="__codelineno-1-80" name="__codelineno-1-80" href="#__codelineno-1-80"></a>long_query_time=10
</span><span id="__span-1-81"><a id="__codelineno-1-81" name="__codelineno-1-81" href="#__codelineno-1-81"></a>slow_query_log_file=/var/log/mysql/slow_query.log
</span><span id="__span-1-82"><a id="__codelineno-1-82" name="__codelineno-1-82" href="#__codelineno-1-82"></a>log_error=/var/log/mysql/error.log
</span><span id="__span-1-83"><a id="__codelineno-1-83" name="__codelineno-1-83" href="#__codelineno-1-83"></a>log_output=FILE
</span><span id="__span-1-84"><a id="__codelineno-1-84" name="__codelineno-1-84" href="#__codelineno-1-84"></a>
</span><span id="__span-1-85"><a id="__codelineno-1-85" name="__codelineno-1-85" href="#__codelineno-1-85"></a># buffer
</span><span id="__span-1-86"><a id="__codelineno-1-86" name="__codelineno-1-86" href="#__codelineno-1-86"></a>sort_buffer_size=1M
</span><span id="__span-1-87"><a id="__codelineno-1-87" name="__codelineno-1-87" href="#__codelineno-1-87"></a>read_buffer_size=1M
</span><span id="__span-1-88"><a id="__codelineno-1-88" name="__codelineno-1-88" href="#__codelineno-1-88"></a>read_rnd_buffer_size=1M
</span><span id="__span-1-89"><a id="__codelineno-1-89" name="__codelineno-1-89" href="#__codelineno-1-89"></a>
</span><span id="__span-1-90"><a id="__codelineno-1-90" name="__codelineno-1-90" href="#__codelineno-1-90"></a># MyISAM
</span><span id="__span-1-91"><a id="__codelineno-1-91" name="__codelineno-1-91" href="#__codelineno-1-91"></a>myisam_sort_buffer_size=128M
</span><span id="__span-1-92"><a id="__codelineno-1-92" name="__codelineno-1-92" href="#__codelineno-1-92"></a>key_buffer_size=512M
</span><span id="__span-1-93"><a id="__codelineno-1-93" name="__codelineno-1-93" href="#__codelineno-1-93"></a>
</span><span id="__span-1-94"><a id="__codelineno-1-94" name="__codelineno-1-94" href="#__codelineno-1-94"></a># InnoDB
</span><span id="__span-1-95"><a id="__codelineno-1-95" name="__codelineno-1-95" href="#__codelineno-1-95"></a>innodb-adaptive-hash-index=OFF
</span><span id="__span-1-96"><a id="__codelineno-1-96" name="__codelineno-1-96" href="#__codelineno-1-96"></a>innodb-strict-mode=1
</span><span id="__span-1-97"><a id="__codelineno-1-97" name="__codelineno-1-97" href="#__codelineno-1-97"></a>innodb_file_per_table=1
</span><span id="__span-1-98"><a id="__codelineno-1-98" name="__codelineno-1-98" href="#__codelineno-1-98"></a>innodb_temp_data_file_path=ibtmp1:12M:autoextend:max:10G
</span><span id="__span-1-99"><a id="__codelineno-1-99" name="__codelineno-1-99" href="#__codelineno-1-99"></a>innodb_buffer_pool_size=4G
</span><span id="__span-1-100"><a id="__codelineno-1-100" name="__codelineno-1-100" href="#__codelineno-1-100"></a>innodb_buffer_pool_dump_pct=100
</span><span id="__span-1-101"><a id="__codelineno-1-101" name="__codelineno-1-101" href="#__codelineno-1-101"></a>innodb_buffer_pool_dump_at_shutdown=1
</span><span id="__span-1-102"><a id="__codelineno-1-102" name="__codelineno-1-102" href="#__codelineno-1-102"></a>innodb_buffer_pool_load_at_startup=0
</span><span id="__span-1-103"><a id="__codelineno-1-103" name="__codelineno-1-103" href="#__codelineno-1-103"></a>innodb_redo_log_capacity=512M
</span><span id="__span-1-104"><a id="__codelineno-1-104" name="__codelineno-1-104" href="#__codelineno-1-104"></a>innodb_io_capacity=2000
</span><span id="__span-1-105"><a id="__codelineno-1-105" name="__codelineno-1-105" href="#__codelineno-1-105"></a>innodb_io_capacity_max=5000
</span><span id="__span-1-106"><a id="__codelineno-1-106" name="__codelineno-1-106" href="#__codelineno-1-106"></a>innodb_flush_log_at_trx_commit=2
</span><span id="__span-1-107"><a id="__codelineno-1-107" name="__codelineno-1-107" href="#__codelineno-1-107"></a>innodb_flush_method=O_DIRECT
</span><span id="__span-1-108"><a id="__codelineno-1-108" name="__codelineno-1-108" href="#__codelineno-1-108"></a>innodb_flush_neighbors=0
</span><span id="__span-1-109"><a id="__codelineno-1-109" name="__codelineno-1-109" href="#__codelineno-1-109"></a>innodb_read_ahead_threshold=0
</span><span id="__span-1-110"><a id="__codelineno-1-110" name="__codelineno-1-110" href="#__codelineno-1-110"></a>innodb_purge_threads=1
</span></code></pre></div>
</details>
<h3 id="_2">各节点配置<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>配置项</th>
<th>值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>server_id</td>
<td>1</td>
<td>唯一标识MySQL实例</td>
</tr>
<tr>
<td>gtid_mode</td>
<td>ON</td>
<td>开启事务的gtid</td>
</tr>
<tr>
<td>enforce_gtid_consistency</td>
<td>ON</td>
<td>强制gtid一致性</td>
</tr>
<tr>
<td>master_info_repository(deprecated)</td>
<td>TABLE</td>
<td><code>master.info</code>使用数据表方式记录</td>
</tr>
<tr>
<td>log_bin</td>
<td>ON</td>
<td>开启binlog</td>
</tr>
<tr>
<td>binlog_format</td>
<td>ROW</td>
<td>binlog的复制模式</td>
</tr>
<tr>
<td>binlog_checksum</td>
<td>NONE</td>
<td>不使用binlog校验和</td>
</tr>
<tr>
<td>relay_log_info_repository(deprecated)</td>
<td>TABLE</td>
<td>作为从库同步事务后，记录至数据表</td>
</tr>
<tr>
<td>transaction_write_set_extraction (deprecated)</td>
<td>XXHASH64</td>
<td>deprecated as of MySQL 8.0.26</td>
</tr>
<tr>
<td>default_authentication_plugin</td>
<td>mysql_native_password</td>
<td>配置用户账户的加密方式</td>
</tr>
<tr>
<td>plugin_load</td>
<td>mysql_clone.so;group_replication.so</td>
<td>加载组复制插件</td>
</tr>
<tr>
<td>loose-group_replication_group_name</td>
<td>"aaaaaaaa-1111-2222-3333-bbbbbbbbbbbb"</td>
<td>UUID，分组的节点需配置一致</td>
</tr>
<tr>
<td>loose-group_replication_start_on_boot</td>
<td>OFF</td>
<td>启动MySQL时不自动开启组复制</td>
</tr>
<tr>
<td>loose-group_replication_bootstrap_group</td>
<td>OFF</td>
<td>关闭此MySQL实例的组引导</td>
</tr>
<tr>
<td>loose-group_replication_single_primary_mode</td>
<td>OFF</td>
<td>关闭单主模式，即使用多主模式</td>
</tr>
<tr>
<td>loose-group_replication_enforce_update_everywhere_checks</td>
<td>ON</td>
<td>在多主模式下，建议开启此选项，严格检查一致性</td>
</tr>
<tr>
<td>loose-group_replication_ssl_mode</td>
<td>DISABLED</td>
<td>组复制节点通信禁用SSL</td>
</tr>
<tr>
<td>loose-group_replication_local_address</td>
<td>"node1:33061"</td>
<td>当前MySQL实例的组复制通信地址</td>
</tr>
<tr>
<td>loose-group_replication_group_seeds</td>
<td>"node1:33061,node2:33061,node3:33061"</td>
<td>组复制的节点通信地址</td>
</tr>
<tr>
<td>loose-group_replication_ip_whitelist or<br />loose-group_replication_ip_allowlist</td>
<td>xx.yyy.zzz.0/25,127.0.0.1"</td>
<td>设置组复制节点通信的IP白名单，同网段可省略</td>
</tr>
<tr>
<td>report-host</td>
<td>"node1"</td>
<td>设置本机MEMBER_HOST,默认为hostname,由于开启了skip-name-resolve,此处用IP方式通讯</td>
</tr>
</tbody>
</table>
<h4 id="_3">设置复制账号<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h4>
<ul>
<li>下記作業は全nodeで実施する</li>
</ul>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1">-- レプリケーションユーザーを作ります。</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">SQL_LOG_BIN</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;repl_user&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">GRANT</span><span class="w"> </span><span class="n">REPLICATION</span><span class="w"> </span><span class="n">SLAVE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">repl_user</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FLUSH</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="p">;</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">SQL_LOG_BIN</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="c1">-- レプリケーションチャンネル group_replication_recovery に↑で作成したユーザーの資格情報を使うように設定します。</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CHANGE</span><span class="w"> </span><span class="n">REPLICATION</span><span class="w"> </span><span class="k">SOURCE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">SOURCE_USER</span><span class="o">=</span><span class="s1">&#39;repl_user&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">SOURCE_PASSWORD</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="n">CHANNEL</span><span class="w"> </span><span class="s1">&#39;group_replication_recovery&#39;</span><span class="p">;</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="c1">-- データベースが初期化された時点でバイナリログにいろいろ書き込まれているので、そのままだとレプリケーションを開始したときに競合するので、バイナリログをリセットしておきます。</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">RESET</span><span class="w"> </span><span class="n">MASTER</span><span class="p">;</span>
</span></code></pre></div>
<details class="warning">
<summary>warningメッセージが出る場合</summary>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="o">#</span><span class="w"> </span><span class="n">replicationユーザを追加時</span><span class="err">、下記の</span><span class="n">warningメッセージが出る</span><span class="err">。</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="mi">01</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">21</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CHANGE</span><span class="w"> </span><span class="n">REPLICATION</span><span class="w"> </span><span class="k">SOURCE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">SOURCE_USER</span><span class="o">=</span><span class="s1">&#39;repl_user&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">SOURCE_PASSWORD</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="n">CHANNEL</span><span class="w"> </span><span class="s1">&#39;group_replication_recovery&#39;</span><span class="p">;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">warnings</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="mi">01</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">21</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="n">warnings</span><span class="err">\</span><span class="k">G</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="o">***************************</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="o">***************************</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">  </span><span class="k">Level</span><span class="p">:</span><span class="w"> </span><span class="n">Note</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">   </span><span class="n">Code</span><span class="p">:</span><span class="w"> </span><span class="mi">1759</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="n">Message</span><span class="p">:</span><span class="w"> </span><span class="n">Sending</span><span class="w"> </span><span class="n">passwords</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">plain</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">without</span><span class="w"> </span><span class="n">SSL</span><span class="o">/</span><span class="n">TLS</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">extremely</span><span class="w"> </span><span class="n">insecure</span><span class="p">.</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="o">***************************</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="o">***************************</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">  </span><span class="k">Level</span><span class="p">:</span><span class="w"> </span><span class="n">Note</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">   </span><span class="n">Code</span><span class="p">:</span><span class="w"> </span><span class="mi">1760</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="n">Message</span><span class="p">:</span><span class="w"> </span><span class="n">Storing</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">connection</span><span class="w"> </span><span class="n">metadata</span><span class="w"> </span><span class="n">repository</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">secure</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">therefore</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">recommended</span><span class="p">.</span><span class="w"> </span><span class="n">Please</span><span class="w"> </span><span class="n">consider</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">PASSWORD</span><span class="w"> </span><span class="k">connection</span><span class="w"> </span><span class="k">options</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">START</span><span class="w"> </span><span class="n">REPLICA</span><span class="p">;</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s1">&#39;START REPLICA Syntax&#39;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="n">Manual</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">more</span><span class="w"> </span><span class="n">information</span><span class="p">.</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="mi">01</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">29</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="o">#</span><span class="w"> </span><span class="err">原因は</span><span class="n">mysqlクライアントが接続時sslなしで接続しているためです</span><span class="err">。</span><span class="w"> </span><span class="p">(</span><span class="n">node1</span><span class="p">)</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="mi">01</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">17</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="err">\</span><span class="n">s</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="c1">--------------</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="n">mysql</span><span class="w">  </span><span class="n">Ver</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">33</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">x86_64</span><span class="w"> </span><span class="p">(</span><span class="n">MySQL</span><span class="w"> </span><span class="n">Community</span><span class="w"> </span><span class="n">Server</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">GPL</span><span class="p">)</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="k">Current</span><span class="w"> </span><span class="k">user</span><span class="p">:</span><span class="w">           </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="n">SSL</span><span class="p">:</span><span class="w">                    </span><span class="k">Not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">use</span><span class="w">     </span><span class="o">&lt;&lt;</span><span class="c1">-- ここがSSLなし</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="o">&lt;</span><span class="n">SKIP</span><span class="o">&gt;</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="c1">--------------</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a><span class="mi">01</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">41</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a><span class="o">#</span><span class="w"> </span><span class="err">対応方法</span><span class="w"> </span><span class="p">(</span><span class="n">node2</span><span class="p">)</span>
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a><span class="o">-</span><span class="w"> </span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="p">.</span><span class="n">my</span><span class="p">.</span><span class="n">cnf</span><span class="w"> </span><span class="err">に下記の通りに変更</span>
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a><span class="mi">01</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mi">27</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="err">\</span><span class="o">!</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="p">.</span><span class="n">my</span><span class="p">.</span><span class="n">cnf</span>
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a><span class="p">[</span><span class="n">client</span><span class="p">]</span>
</span><span id="__span-3-35"><a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a><span class="n">socket</span><span class="o">=/</span><span class="n">tmp</span><span class="o">/</span><span class="n">mysql</span><span class="p">.</span><span class="n">sock</span>
</span><span id="__span-3-36"><a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a><span class="k">user</span><span class="o">=</span><span class="n">root</span>
</span><span id="__span-3-37"><a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a><span class="n">password</span><span class="o">=</span><span class="n">password</span>
</span><span id="__span-3-38"><a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a><span class="k">host</span><span class="o">=</span><span class="n">localhost</span>
</span><span id="__span-3-39"><a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a><span class="n">ssl</span><span class="o">-</span><span class="k">mode</span><span class="o">=</span><span class="n">required</span><span class="w">  </span><span class="o">&lt;</span><span class="c1">--- ssl-modeを追加する。強制的にsslを利用する</span>
</span><span id="__span-3-40"><a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a><span class="mi">01</span><span class="p">:</span><span class="mi">53</span><span class="p">:</span><span class="mi">30</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span><span id="__span-3-41"><a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a>
</span><span id="__span-3-42"><a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a><span class="o">##</span><span class="w"> </span><span class="err">結果</span>
</span><span id="__span-3-43"><a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a><span class="o">-</span><span class="w"> </span><span class="n">warningメッセージは一つになりました</span><span class="err">。</span>
</span><span id="__span-3-44"><a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a><span class="mi">01</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">10</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CHANGE</span><span class="w"> </span><span class="n">REPLICATION</span><span class="w"> </span><span class="k">SOURCE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">SOURCE_USER</span><span class="o">=</span><span class="s1">&#39;repl_user&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">SOURCE_PASSWORD</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="n">CHANNEL</span><span class="w"> </span><span class="s1">&#39;group_replication_recovery&#39;</span><span class="p">;</span>
</span><span id="__span-3-45"><a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-3-46"><a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a>
</span><span id="__span-3-47"><a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a><span class="mi">01</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">10</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span><span id="__span-3-48"><a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a><span class="mi">01</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">10</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="n">warnings</span><span class="err">\</span><span class="k">G</span>
</span><span id="__span-3-49"><a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a><span class="o">***************************</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="o">***************************</span>
</span><span id="__span-3-50"><a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a><span class="w">  </span><span class="k">Level</span><span class="p">:</span><span class="w"> </span><span class="n">Note</span>
</span><span id="__span-3-51"><a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a><span class="w">   </span><span class="n">Code</span><span class="p">:</span><span class="w"> </span><span class="mi">1760</span>
</span><span id="__span-3-52"><a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a><span class="n">Message</span><span class="p">:</span><span class="w"> </span><span class="n">Storing</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">connection</span><span class="w"> </span><span class="n">metadata</span><span class="w"> </span><span class="n">repository</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">secure</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">therefore</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">recommended</span><span class="p">.</span><span class="w"> </span><span class="n">Please</span><span class="w"> </span><span class="n">consider</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">PASSWORD</span><span class="w"> </span><span class="k">connection</span><span class="w"> </span><span class="k">options</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">START</span><span class="w"> </span><span class="n">REPLICA</span><span class="p">;</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s1">&#39;START REPLICA Syntax&#39;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="n">Manual</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">more</span><span class="w"> </span><span class="n">information</span><span class="p">.</span>
</span><span id="__span-3-53"><a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-3-54"><a id="__codelineno-3-54" name="__codelineno-3-54" href="#__codelineno-3-54"></a>
</span><span id="__span-3-55"><a id="__codelineno-3-55" name="__codelineno-3-55" href="#__codelineno-3-55"></a><span class="mi">01</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">17</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span></code></pre></div>
</details>
<h4 id="master">MASTERサーバ<a class="headerlink" href="#master" title="Permanent link">&para;</a></h4>
<details class="tip">
<summary>Tip</summary>
<p>なお、レプリケーションユーザーの作成などの、すべてのノードで個別に実行するためレプリケーションされたくないクエリは<br />
<code>set sql_log_bin = 0|1</code> とかでバイナリログの <code>ON/OFF</code> を制御しつつクエリを実行するのが普通のようです。<br />
ただ、初回のセットアップでは「<code>すべてのノードでいろいろ準備</code>→<code>RESET MASTER</code>→ <code>レプリケーション開始</code>」の方がわかりみがあるきがするので、いつもそうしてます。</p>
</details>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="o">#</span><span class="w"> </span><span class="err">主服务器</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">reset</span><span class="w"> </span><span class="n">master</span><span class="p">;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">group_replication_bootstrap_group</span><span class="o">=</span><span class="k">ON</span><span class="p">;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">START</span><span class="w"> </span><span class="n">GROUP_REPLICATION</span><span class="p">;</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">group_replication_bootstrap_group</span><span class="o">=</span><span class="k">OFF</span><span class="p">;</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="o">#</span><span class="w"> </span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">START</span><span class="w"> </span><span class="n">GROUP_REPLICATION</span><span class="p">;</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="o">#</span><span class="w"> </span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">START</span><span class="w"> </span><span class="n">GROUP_REPLICATION</span><span class="w"> </span><span class="k">USER</span><span class="o">=</span><span class="s1">&#39;repl_user&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">PASSWORD</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">;</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="o">#</span><span class="w"> </span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CHANGE</span><span class="w"> </span><span class="n">REPLICATION</span><span class="w"> </span><span class="k">SOURCE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">SOURCE_PORT</span><span class="o">=</span><span class="s1">&#39;3306&#39;</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="n">CHANNEL</span><span class="w"> </span><span class="s1">&#39;group_replication_recovery&#39;</span><span class="p">;</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="o">#</span><span class="w"> </span><span class="err">另一种写法</span><span class="p">.</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="o">#</span><span class="w"> </span><span class="n">CHANGE</span><span class="w"> </span><span class="n">REPLICATION</span><span class="w"> </span><span class="k">SOURCE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">SOURCE_HOST</span><span class="o">=</span><span class="s1">&#39;xx.yyy.zzz.1&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">SOURCE_PORT</span><span class="o">=</span><span class="mi">33061</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="n">CHANNEL</span><span class="w"> </span><span class="s1">&#39;group_replication_recovery&#39;</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="o">#</span><span class="w"> </span><span class="n">CHANGE</span><span class="w"> </span><span class="n">REPLICATION</span><span class="w"> </span><span class="k">SOURCE</span><span class="w"> </span><span class="k">TO</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="o">#</span><span class="w">   </span><span class="n">SOURCE_HOST</span><span class="o">=</span><span class="s1">&#39;xx.yyy.zzz.1&#39;</span><span class="p">,</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="o">#</span><span class="w">   </span><span class="n">SOURCE_USER</span><span class="o">=</span><span class="s1">&#39;repl_user&#39;</span><span class="p">,</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="o">#</span><span class="w">   </span><span class="n">SOURCE_PASSWORD</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">,</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="o">#</span><span class="w">   </span><span class="n">SOURCE_PORT</span><span class="o">=</span><span class="mi">33061</span><span class="p">;</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="o">#</span><span class="w"> </span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="o">#</span><span class="w"> </span><span class="k">START</span><span class="w"> </span><span class="n">GROUP_REPLICATION</span><span class="w"> </span><span class="k">USER</span><span class="o">=</span><span class="s1">&#39;repl_user&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">PASSWORD</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">;</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SHOW</span><span class="w"> </span><span class="n">VARIABLES</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;gtid_executed&#39;</span><span class="p">;</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="o">+</span><span class="c1">---------------+------------------------------------------+</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="o">|</span><span class="w"> </span><span class="n">Variable_name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Value</span><span class="w">                                    </span><span class="o">|</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="o">+</span><span class="c1">---------------+------------------------------------------+</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="o">|</span><span class="w"> </span><span class="n">gtid_executed</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">aaaaaaaa</span><span class="o">-</span><span class="mi">1111</span><span class="o">-</span><span class="mi">2222</span><span class="o">-</span><span class="mi">3333</span><span class="o">-</span><span class="n">bbbbbbbbbbbb</span><span class="p">:</span><span class="mi">1</span><span class="o">-</span><span class="mi">3</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="o">+</span><span class="c1">---------------+------------------------------------------+</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="c1">-- 查看MGR组信息</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="p">;</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="o">+</span><span class="c1">---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="o">|</span><span class="w"> </span><span class="n">CHANNEL_NAME</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="w">                            </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_PORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_VERSION</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_COMMUNICATION_STACK</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="o">+</span><span class="c1">---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="o">|</span><span class="w"> </span><span class="n">group_replication_applier</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">defba275</span><span class="o">-</span><span class="n">f2ef</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">eae</span><span class="o">-</span><span class="mi">525400</span><span class="n">e752a2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node1</span><span class="w">       </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">33</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">XCom</span><span class="w">                       </span><span class="o">|</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="o">+</span><span class="c1">---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="slave">SLAVEサーバ追加<a class="headerlink" href="#slave" title="Permanent link">&para;</a></h4>
<details class="tip" open="open">
<summary>Tip</summary>
<p>残りのノードでも開始します。このとき <code>group_replication_bootstrap_group=ON</code> を指定しません。<br />
指定すると同じ名前の別のグループが作成されてしまいます。</p>
</details>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">replica</span><span class="p">;</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">reset</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="k">all</span><span class="p">;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="n">group_replication</span><span class="p">;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SHOW</span><span class="w"> </span><span class="n">VARIABLES</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;gtid_executed&#39;</span><span class="p">;</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="p">;</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_connection_status</span><span class="p">;</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="o">#</span><span class="w"> </span><span class="err">確認</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="mi">04</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">18</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="w"> </span><span class="p">;</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="o">+</span><span class="c1">---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="o">|</span><span class="w"> </span><span class="n">CHANNEL_NAME</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="w">                            </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_PORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_VERSION</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_COMMUNICATION_STACK</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="o">+</span><span class="c1">---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="o">|</span><span class="w"> </span><span class="n">group_replication_applier</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="n">ba497e</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">e8e</span><span class="o">-</span><span class="mi">5254007</span><span class="n">b60ca</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node2</span><span class="w">       </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">33</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">XCom</span><span class="w">                       </span><span class="o">|</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="o">|</span><span class="w"> </span><span class="n">group_replication_applier</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">d7239f8c</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="n">aeeb</span><span class="o">-</span><span class="mi">525400</span><span class="n">c72882</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node3</span><span class="w">       </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">33</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">XCom</span><span class="w">                       </span><span class="o">|</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="o">|</span><span class="w"> </span><span class="n">group_replication_applier</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">defba275</span><span class="o">-</span><span class="n">f2ef</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">eae</span><span class="o">-</span><span class="mi">525400</span><span class="n">e752a2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node1</span><span class="w">       </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">33</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">XCom</span><span class="w">                       </span><span class="o">|</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="o">+</span><span class="c1">---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="mi">04</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">48</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span></code></pre></div>
<ul>
<li>CHANNEL_NAME:显示的值永远为group_replication_applier</li>
<li>MEMBER_ID :实例节点的serer_uuid值</li>
<li>MEMBER_PORT :实例节点服务端口，取值为server_port指定的端口</li>
<li>MEMBER_HOST :如果没有配置report_host选项，那么取值为机器的hostname，可以通过report_host配置指定具体的IP</li>
<li>MEMBER_STATE : 节点状态<ul>
<li>ONLINE 表示该节点可正常提供服务</li>
<li>RECOVERING 表示该节点正在从其他节点恢复数据</li>
<li>OFFLINE 表示MGR插件已经加载，但是该节点不属于任何一个GR组</li>
<li>ERROR 表示该节点在recovery阶段出现错误或者从其他节点同步状态中出现错误</li>
<li>UNREACHABLE 表示该节点处于不可达状态，无法与之发生网络通讯</li>
</ul>
</li>
</ul>
<h4 id="recovering">RECOVERINGになった場合<a class="headerlink" href="#recovering" title="Permanent link">&para;</a></h4>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="o">#</span><span class="w"> </span><span class="n">slaveサーバ追加の際</span><span class="err">、</span><span class="n">MEMBER_STATEがずっとRECOVERINGになった場合</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="c1">-- select * from performance_schema.replication_connection_status\G でエラーを確認</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="c1">-- 基本的にはreplicationユーザの追加できてないのが原因です。</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="o">##</span><span class="w"> </span><span class="err">対策</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="c1">-- replicationユーザを追加する</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="c1">-- CHANGE REPLICATION SOURCE TO SOURCE_USER=&#39;repl_user&#39;, SOURCE_PASSWORD=&#39;password&#39; FOR CHANNEL &#39;group_replication_recovery&#39;;</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="c1">-- SELECT MEMBER_ID,MEMBER_HOST,MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members; で確認</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="mi">04</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">34</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="p">,</span><span class="n">MEMBER_HOST</span><span class="p">,</span><span class="n">MEMBER_STATE</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="p">;</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">    </span><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="w">                            </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">    </span><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="n">ba497e</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">e8e</span><span class="o">-</span><span class="mi">5254007</span><span class="n">b60ca</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node2</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">d7239f8c</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="n">aeeb</span><span class="o">-</span><span class="mi">525400</span><span class="n">c72882</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node3</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">defba275</span><span class="o">-</span><span class="n">f2ef</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">eae</span><span class="o">-</span><span class="mi">525400</span><span class="n">e752a2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node1</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">     </span><span class="o">|</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">    </span><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="w">    </span><span class="mi">04</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">18</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="mi">04</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">57</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="w"> </span><span class="p">;</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="o">+</span><span class="c1">---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="o">|</span><span class="w"> </span><span class="n">CHANNEL_NAME</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="w">                            </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_PORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_VERSION</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_COMMUNICATION_STACK</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="o">+</span><span class="c1">---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span>
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="o">|</span><span class="w"> </span><span class="n">group_replication_applier</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="n">ba497e</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">e8e</span><span class="o">-</span><span class="mi">5254007</span><span class="n">b60ca</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node2</span><span class="w">       </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">33</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">XCom</span><span class="w">                       </span><span class="o">|</span>
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="o">|</span><span class="w"> </span><span class="n">group_replication_applier</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">d7239f8c</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="n">aeeb</span><span class="o">-</span><span class="mi">525400</span><span class="n">c72882</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node3</span><span class="w">       </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RECOVERING</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">33</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">XCom</span><span class="w">                       </span><span class="o">|</span>
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="o">|</span><span class="w"> </span><span class="n">group_replication_applier</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">defba275</span><span class="o">-</span><span class="n">f2ef</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">eae</span><span class="o">-</span><span class="mi">525400</span><span class="n">e752a2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node1</span><span class="w">       </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">33</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">XCom</span><span class="w">                       </span><span class="o">|</span>
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="o">+</span><span class="c1">---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span>
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="mi">04</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">01</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_connection_status</span><span class="err">\</span><span class="k">G</span>
</span><span id="__span-6-35"><a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="o">***************************</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="o">***************************</span>
</span><span id="__span-6-36"><a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="w">           </span><span class="n">CHANNEL_NAME</span><span class="p">:</span><span class="w"> </span><span class="n">group_replication_recovery</span>
</span><span id="__span-6-37"><a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="w">      </span><span class="n">LAST_ERROR_NUMBER</span><span class="p">:</span><span class="w"> </span><span class="mi">13117</span>
</span><span id="__span-6-38"><a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="w">     </span><span class="n">LAST_ERROR_MESSAGE</span><span class="p">:</span><span class="w"> </span><span class="n">Fatal</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="n">Invalid</span><span class="w"> </span><span class="p">(</span><span class="n">empty</span><span class="p">)</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">attempting</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">connect</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="n">server</span><span class="p">.</span><span class="w"> </span><span class="k">Connection</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="n">terminated</span><span class="p">.</span>
</span><span id="__span-6-39"><a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="w">   </span><span class="n">LAST_ERROR_TIMESTAMP</span><span class="p">:</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="w"> </span><span class="mi">16</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">55</span><span class="p">.</span><span class="mi">939759</span>
</span><span id="__span-6-40"><a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a>
</span><span id="__span-6-41"><a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="_4">確認<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<ul>
<li>master側はNOT READ_ONLY、slave側はREAD_ONLY</li>
</ul>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="o">#</span><span class="w"> </span><span class="n">node1</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="mi">04</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mi">11</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="k">global</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">Variable_name</span><span class="w">  </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%hostname%&#39;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">Variable_name</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%read_only%&#39;</span><span class="p">;</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="o">+</span><span class="c1">-----------------------+-------+</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="o">|</span><span class="w"> </span><span class="n">Variable_name</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="o">+</span><span class="c1">-----------------------+-------+</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="o">|</span><span class="w"> </span><span class="n">hostname</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">node1</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="o">|</span><span class="w"> </span><span class="n">innodb_read_only</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">OFF</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="o">|</span><span class="w"> </span><span class="n">read_only</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">OFF</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="o">|</span><span class="w"> </span><span class="n">super_read_only</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">OFF</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="o">|</span><span class="w"> </span><span class="n">transaction_read_only</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">OFF</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="o">+</span><span class="c1">-----------------------+-------+</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="mi">04</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mi">44</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="o">#</span><span class="w"> </span><span class="n">node2</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="mi">04</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">09</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="k">global</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">Variable_name</span><span class="w">  </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%hostname%&#39;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">Variable_name</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%read_only%&#39;</span><span class="p">;</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="o">+</span><span class="c1">-----------------------+-------+</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="o">|</span><span class="w"> </span><span class="n">Variable_name</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="o">+</span><span class="c1">-----------------------+-------+</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="o">|</span><span class="w"> </span><span class="n">hostname</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">node2</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="o">|</span><span class="w"> </span><span class="n">innodb_read_only</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">OFF</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="o">|</span><span class="w"> </span><span class="n">read_only</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">ON</span><span class="w">    </span><span class="o">|</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a><span class="o">|</span><span class="w"> </span><span class="n">super_read_only</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">ON</span><span class="w">    </span><span class="o">|</span>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a><span class="o">|</span><span class="w"> </span><span class="n">transaction_read_only</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">OFF</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="o">+</span><span class="c1">-----------------------+-------+</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a><span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a><span class="mi">04</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">22</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a><span class="o">#</span><span class="w"> </span><span class="n">node3</span>
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a><span class="mi">04</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">53</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="k">global</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">Variable_name</span><span class="w">  </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%hostname%&#39;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">Variable_name</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%read_only%&#39;</span><span class="p">;</span>
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a><span class="o">+</span><span class="c1">-----------------------+-------+</span>
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a><span class="o">|</span><span class="w"> </span><span class="n">Variable_name</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-7-35"><a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a><span class="o">+</span><span class="c1">-----------------------+-------+</span>
</span><span id="__span-7-36"><a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a><span class="o">|</span><span class="w"> </span><span class="n">hostname</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">node3</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-7-37"><a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a><span class="o">|</span><span class="w"> </span><span class="n">innodb_read_only</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">OFF</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-7-38"><a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a><span class="o">|</span><span class="w"> </span><span class="n">read_only</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">ON</span><span class="w">    </span><span class="o">|</span>
</span><span id="__span-7-39"><a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a><span class="o">|</span><span class="w"> </span><span class="n">super_read_only</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">ON</span><span class="w">    </span><span class="o">|</span>
</span><span id="__span-7-40"><a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a><span class="o">|</span><span class="w"> </span><span class="n">transaction_read_only</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">OFF</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-7-41"><a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a><span class="o">+</span><span class="c1">-----------------------+-------+</span>
</span><span id="__span-7-42"><a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a><span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-7-43"><a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a>
</span><span id="__span-7-44"><a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a><span class="mi">04</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">09</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span></code></pre></div>
<h4 id="sysbench">sysbenchの検証<a class="headerlink" href="#sysbench" title="Permanent link">&para;</a></h4>
<details class="info">
<summary>sysbenchの検証</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1">## DB作成</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>&gt;<span class="w"> </span>CREATE<span class="w"> </span>DATABASE<span class="w"> </span>sbtest<span class="p">;</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="c1">## ユーザー作成</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>&gt;<span class="w"> </span>CREATE<span class="w"> </span>USER<span class="w"> </span><span class="s1">&#39;sbtest&#39;</span>@<span class="s1">&#39;%&#39;</span><span class="w"> </span>IDENTIFIED<span class="w"> </span>BY<span class="w"> </span><span class="s1">&#39;sbtest&#39;</span><span class="p">;</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="c1">## ユーザーに全権限追加</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>&gt;<span class="w"> </span>GRANT<span class="w"> </span>all<span class="w"> </span>ON<span class="w"> </span>*.*<span class="w"> </span>TO<span class="w"> </span><span class="s1">&#39;sbtest&#39;</span>@<span class="s1">&#39;%&#39;</span><span class="p">;</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="c1">## 権限の変更をデータベースに反映</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>&gt;<span class="w"> </span>FLUSH<span class="w"> </span>PRIVILEGES<span class="p">;</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="c1">## 確認</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>&gt;<span class="w"> </span>show<span class="w"> </span>databases<span class="p">;</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>&gt;<span class="w"> </span><span class="k">select</span><span class="w"> </span>user,host,authentication_string<span class="w"> </span>from<span class="w"> </span>mysql.user<span class="p">;</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="c1">## 検証用スクリプト作成</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="c1">#!/usr/bin/env bash</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="nv">PATH</span><span class="o">=</span>/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="nb">export</span><span class="w"> </span>PATH
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="nb">set</span><span class="w"> </span>-e
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>clear
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="nv">THR</span><span class="o">=</span><span class="nv">$1</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="nv">CMD</span><span class="o">=</span><span class="nv">$2</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$THR</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Not threads set! &quot;</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="w">  </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="k">fi</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CMD</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Not command selected! &quot;</span>
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w">  </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="k">fi</span>
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>
</span><span id="__span-8-38"><a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>sysbench<span class="w"> </span>oltp_read_write<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-39"><a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>--mysql-host<span class="o">=</span>xx.yyy.zzz.1<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-40"><a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>--mysql-dry-run<span class="o">=</span>off<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-41"><a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a>--db-driver<span class="o">=</span>mysql<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-42"><a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a>--mysql-user<span class="o">=</span>sbtest<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-43"><a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>--mysql-password<span class="o">=</span>sbtest<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-44"><a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a>--table_size<span class="o">=</span><span class="m">10000</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-45"><a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a>--threads<span class="o">=</span><span class="nv">$THR</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-46"><a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a>--tables<span class="o">=</span><span class="m">30</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-47"><a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a>--time<span class="o">=</span><span class="m">120</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-48"><a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a>--report-interval<span class="o">=</span><span class="m">10</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-49"><a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a><span class="nv">$CMD</span>
</span><span id="__span-8-50"><a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a>
</span><span id="__span-8-51"><a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a><span class="c1">## 2. テーブル準備</span>
</span><span id="__span-8-52"><a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a>&gt;<span class="w"> </span>bash<span class="w"> </span>sysbench_mgr.sh<span class="w"> </span><span class="m">300</span><span class="w"> </span>prepare
</span><span id="__span-8-53"><a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a>
</span><span id="__span-8-54"><a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a><span class="c1">## 性能検証</span>
</span><span id="__span-8-55"><a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a>&gt;<span class="w"> </span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>seq<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">300</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$i</span><span class="p">;</span><span class="w"> </span>bash<span class="w"> </span>sysbench_mgr.sh<span class="w"> </span><span class="nv">$i</span><span class="w"> </span>run<span class="w"> </span>&gt;&gt;<span class="w"> </span>mgr_sysbench.log<span class="p">;</span><span class="w"> </span><span class="k">done</span>
</span></code></pre></div>
</details>
<h4 id="master_1">MASTER死んだ場合の確認<a class="headerlink" href="#master_1" title="Permanent link">&para;</a></h4>
<ul>
<li>masterが正常に切り替えたかどうかを確認</li>
</ul>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="o">#</span><span class="w"> </span><span class="n">master</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="mi">04</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">35</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[</span><span class="n">sbtest</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="w"> </span><span class="p">;</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="o">+</span><span class="c1">---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="o">|</span><span class="w"> </span><span class="n">CHANNEL_NAME</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="w">                            </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_PORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_VERSION</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_COMMUNICATION_STACK</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="o">+</span><span class="c1">---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="o">|</span><span class="w"> </span><span class="n">group_replication_applier</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="n">ba497e</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">e8e</span><span class="o">-</span><span class="mi">5254007</span><span class="n">b60ca</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node2</span><span class="w">       </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">33</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">XCom</span><span class="w">                       </span><span class="o">|</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="o">|</span><span class="w"> </span><span class="n">group_replication_applier</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">d7239f8c</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="n">aeeb</span><span class="o">-</span><span class="mi">525400</span><span class="n">c72882</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node3</span><span class="w">       </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">33</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">XCom</span><span class="w">                       </span><span class="o">|</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="o">|</span><span class="w"> </span><span class="n">group_replication_applier</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">defba275</span><span class="o">-</span><span class="n">f2ef</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">eae</span><span class="o">-</span><span class="mi">525400</span><span class="n">e752a2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node1</span><span class="w">       </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">33</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">XCom</span><span class="w">                       </span><span class="o">|</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="o">+</span><span class="c1">---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="mi">04</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">18</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[</span><span class="n">sbtest</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">@@</span><span class="n">hostname</span><span class="p">;</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="o">+</span><span class="c1">------------+</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="o">|</span><span class="w"> </span><span class="o">@@</span><span class="n">hostname</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="o">+</span><span class="c1">------------+</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="o">|</span><span class="w"> </span><span class="n">node1</span><span class="w">      </span><span class="o">|</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="o">+</span><span class="c1">------------+</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="mi">04</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">23</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[</span><span class="n">sbtest</span><span class="p">]</span><span class="o">&gt;</span>
</span></code></pre></div>
<ul>
<li>masterのmysqldを停止</li>
</ul>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="o">#</span><span class="w"> </span><span class="n">masterのmysqldを停止</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="p">[</span><span class="n">root</span><span class="o">@</span><span class="n">node1</span><span class="w"> </span><span class="k">work</span><span class="p">]</span><span class="o">#</span><span class="w"> </span><span class="n">systemctl</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">mysqld</span>
</span></code></pre></div>
<ul>
<li>slave上で確認</li>
</ul>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="o">#</span><span class="w"> </span><span class="n">slave上で確認</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="o">##</span><span class="w"> </span><span class="n">node2</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="mi">04</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">20</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="p">,</span><span class="n">MEMBER_HOST</span><span class="p">,</span><span class="n">MEMBER_STATE</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="p">;</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="w">                            </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="n">ba497e</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">e8e</span><span class="o">-</span><span class="mi">5254007</span><span class="n">b60ca</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node2</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">     </span><span class="o">|</span><span class="w">  </span><span class="o">&lt;&lt;</span><span class="c1">-- masterがnode2に切り替えたこと確認できた。</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="o">|</span><span class="w"> </span><span class="n">d7239f8c</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="n">aeeb</span><span class="o">-</span><span class="mi">525400</span><span class="n">c72882</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node3</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="mi">05</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">19</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="o">##</span><span class="w"> </span><span class="n">node3</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="mi">05</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">55</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="p">,</span><span class="n">MEMBER_HOST</span><span class="p">,</span><span class="n">MEMBER_STATE</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="p">;</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="w">                            </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="n">ba497e</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">e8e</span><span class="o">-</span><span class="mi">5254007</span><span class="n">b60ca</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node2</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">     </span><span class="o">|</span><span class="w">  </span><span class="o">&lt;&lt;</span><span class="c1">-- masterがnode2に切り替えたこと確認できた。</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="o">|</span><span class="w"> </span><span class="n">d7239f8c</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="n">aeeb</span><span class="o">-</span><span class="mi">525400</span><span class="n">c72882</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node3</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="o">#</span><span class="w"> </span><span class="n">mysqlログ</span>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="o">##</span><span class="w"> </span><span class="n">mysqldを停止の際</span>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">39</span><span class="p">.</span><span class="mi">420249</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">010559</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Multi</span><span class="o">-</span><span class="n">threaded</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="k">statistics</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="s1">&#39;group_replication_applier&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">elapsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3044</span><span class="p">;</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="n">assigned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1025</span><span class="p">;</span><span class="w"> </span><span class="n">worker</span><span class="w"> </span><span class="n">queues</span><span class="w"> </span><span class="n">filled</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">overrun</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Worker</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="k">full</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">clock</span><span class="w"> </span><span class="n">conflicts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">433423400</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="p">(</span><span class="k">count</span><span class="p">)</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">Workers</span><span class="w"> </span><span class="n">occupied</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">Workers</span><span class="w"> </span><span class="n">occupied</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">56</span><span class="p">.</span><span class="mi">719644</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">41</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">013730</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Server</span><span class="p">]</span><span class="w"> </span><span class="s1">&#39;wait_timeout&#39;</span><span class="w"> </span><span class="k">period</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">exceeded</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">`</span><span class="n">root</span><span class="o">`@`</span><span class="n">localhost</span><span class="o">`</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">idle</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="k">last</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">long</span><span class="p">.</span>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">56</span><span class="p">.</span><span class="mi">719745</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">41</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">010914</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Server</span><span class="p">]</span><span class="w"> </span><span class="n">Aborted</span><span class="w"> </span><span class="k">connection</span><span class="w"> </span><span class="mi">41</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">db</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;unconnected&#39;</span><span class="w"> </span><span class="k">user</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="w"> </span><span class="k">host</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">The</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">disconnected</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">inactivity</span><span class="p">.).</span>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">39</span><span class="p">.</span><span class="mi">039940</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">010559</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Multi</span><span class="o">-</span><span class="n">threaded</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="k">statistics</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="s1">&#39;group_replication_applier&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">elapsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">120</span><span class="p">;</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="n">assigned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1155073</span><span class="p">;</span><span class="w"> </span><span class="n">worker</span><span class="w"> </span><span class="n">queues</span><span class="w"> </span><span class="n">filled</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">overrun</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Worker</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="k">full</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">clock</span><span class="w"> </span><span class="n">conflicts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1878944800</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="p">(</span><span class="k">count</span><span class="p">)</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">Workers</span><span class="w"> </span><span class="n">occupied</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20404</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">Workers</span><span class="w"> </span><span class="n">occupied</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11202672000</span>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">39</span><span class="p">.</span><span class="mi">060182</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">010559</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Multi</span><span class="o">-</span><span class="n">threaded</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="k">statistics</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="s1">&#39;group_replication_applier&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">elapsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">120</span><span class="p">;</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="n">assigned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3861505</span><span class="p">;</span><span class="w"> </span><span class="n">worker</span><span class="w"> </span><span class="n">queues</span><span class="w"> </span><span class="n">filled</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">overrun</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Worker</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="k">full</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">clock</span><span class="w"> </span><span class="n">conflicts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1881781000</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="p">(</span><span class="k">count</span><span class="p">)</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">Workers</span><span class="w"> </span><span class="n">occupied</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">134123</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">Workers</span><span class="w"> </span><span class="n">occupied</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">63201443400</span>
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">39</span><span class="p">.</span><span class="mi">016324</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">010559</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Multi</span><span class="o">-</span><span class="n">threaded</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="k">statistics</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="s1">&#39;group_replication_applier&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">elapsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">120</span><span class="p">;</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="n">assigned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7382017</span><span class="p">;</span><span class="w"> </span><span class="n">worker</span><span class="w"> </span><span class="n">queues</span><span class="w"> </span><span class="n">filled</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">overrun</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Worker</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="k">full</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">clock</span><span class="w"> </span><span class="n">conflicts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1883981300</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="p">(</span><span class="k">count</span><span class="p">)</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">Workers</span><span class="w"> </span><span class="n">occupied</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">361966</span><span class="w"> </span><span class="n">waited</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">Workers</span><span class="w"> </span><span class="n">occupied</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">163103230800</span>
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">58</span><span class="p">.</span><span class="mi">960486</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] Updating physical connections to other servers&#39;</span>
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">58</span><span class="p">.</span><span class="mi">960609</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] Using existing server node 0 host node2:33061&#39;</span>
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">58</span><span class="p">.</span><span class="mi">960624</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] Using existing server node 1 host node3:33061&#39;</span>
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">58</span><span class="p">.</span><span class="mi">960636</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] Sucessfully installed new site definition. Start synode for this configuration is {dd63b25c 719175 0}, boot key synode is {dd63b25c 719164 0}, configured event horizon=10, my node identifier is 0&#39;</span>
</span><span id="__span-11-39"><a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">59</span><span class="p">.</span><span class="mi">735276</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] A configuration change was detected. Sending a Global View Message to all nodes. My node identifier is 0 and my address is node2:33061&#39;</span>
</span><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">59</span><span class="p">.</span><span class="mi">739469</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] Group is able to support up to communication protocol version 8.0.27&#39;</span>
</span><span id="__span-11-41"><a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a>
</span><span id="__span-11-42"><a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a><span class="o">##</span><span class="w"> </span><span class="n">MGRからnode1を除外される</span>
</span><span id="__span-11-43"><a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">59</span><span class="p">.</span><span class="mi">739611</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Warning</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011499</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Members removed from the group: node1:3306&#39;</span>
</span><span id="__span-11-44"><a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">59</span><span class="p">.</span><span class="mi">739642</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="k">System</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011500</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Primary server with address node1:3306 left the group. Electing new Primary.&#39;</span>
</span><span id="__span-11-45"><a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">59</span><span class="p">.</span><span class="mi">739912</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">013519</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Elected primary member gtid_executed: aaaaaaaa-1111-2222-3333-bbbbbbbbbbbb:1-852676&#39;</span>
</span><span id="__span-11-46"><a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">59</span><span class="p">.</span><span class="mi">739948</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">013519</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Elected primary member applier channel received_transaction_set: aaaaaaaa-1111-2222-3333-bbbbbbbbbbbb:1-852676&#39;</span>
</span><span id="__span-11-47"><a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a>
</span><span id="__span-11-48"><a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a><span class="o">##</span><span class="w"> </span><span class="err">新たな</span><span class="w"> </span><span class="k">Primary</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="err">を</span><span class="n">node2に選択された</span>
</span><span id="__span-11-49"><a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">59</span><span class="p">.</span><span class="mi">740007</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="k">System</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011507</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;A new primary with address node2:3306 was elected. The new primary will execute all previous group transactions before allowing writes.&#39;</span>
</span><span id="__span-11-50"><a id="__codelineno-11-50" name="__codelineno-11-50" href="#__codelineno-11-50"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">59</span><span class="p">.</span><span class="mi">740757</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="k">System</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011503</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Group membership changed to node2:3306, node3:3306 on view 16842195647561739:10.&#39;</span>
</span><span id="__span-11-51"><a id="__codelineno-11-51" name="__codelineno-11-51" href="#__codelineno-11-51"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">59</span><span class="p">.</span><span class="mi">741723</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">46</span><span class="w"> </span><span class="p">[</span><span class="k">System</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011565</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Setting super_read_only=ON.&#39;</span>
</span><span id="__span-11-52"><a id="__codelineno-11-52" name="__codelineno-11-52" href="#__codelineno-11-52"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">59</span><span class="p">.</span><span class="mi">742265</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="p">[</span><span class="k">System</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">013731</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;The member action &quot;mysql_disable_super_read_only_if_primary&quot; for event &quot;AFTER_PRIMARY_ELECTION&quot; with priority &quot;1&quot; will be run.&#39;</span>
</span><span id="__span-11-53"><a id="__codelineno-11-53" name="__codelineno-11-53" href="#__codelineno-11-53"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">59</span><span class="p">.</span><span class="mi">742318</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="p">[</span><span class="k">System</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011566</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Setting super_read_only=OFF.&#39;</span>
</span><span id="__span-11-54"><a id="__codelineno-11-54" name="__codelineno-11-54" href="#__codelineno-11-54"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">59</span><span class="p">.</span><span class="mi">742649</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="p">[</span><span class="k">System</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">013731</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;The member action &quot;mysql_start_failover_channels_if_primary&quot; for event &quot;AFTER_PRIMARY_ELECTION&quot; with priority &quot;10&quot; will be run.&#39;</span>
</span><span id="__span-11-55"><a id="__codelineno-11-55" name="__codelineno-11-55" href="#__codelineno-11-55"></a>
</span><span id="__span-11-56"><a id="__codelineno-11-56" name="__codelineno-11-56" href="#__codelineno-11-56"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">59</span><span class="p">.</span><span class="mi">743420</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">46</span><span class="w"> </span><span class="p">[</span><span class="k">System</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011510</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;This server is working as primary member.&#39;</span>
</span><span id="__span-11-57"><a id="__codelineno-11-57" name="__codelineno-11-57" href="#__codelineno-11-57"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">59</span><span class="p">.</span><span class="mi">743453</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011485</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Primary had applied all relay logs, disabled conflict detection.&#39;</span>
</span><span id="__span-11-58"><a id="__codelineno-11-58" name="__codelineno-11-58" href="#__codelineno-11-58"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T16</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">01</span><span class="p">.</span><span class="mi">971224</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] Failure reading from fd=56 n=0 from node1:33061&#39;</span>
</span><span id="__span-11-59"><a id="__codelineno-11-59" name="__codelineno-11-59" href="#__codelineno-11-59"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">19</span><span class="p">.</span><span class="mi">471719</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">013730</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Server</span><span class="p">]</span><span class="w"> </span><span class="s1">&#39;wait_timeout&#39;</span><span class="w"> </span><span class="k">period</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">exceeded</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">`</span><span class="n">root</span><span class="o">`@`</span><span class="n">localhost</span><span class="o">`</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">idle</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="k">last</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">long</span><span class="p">.</span>
</span><span id="__span-11-60"><a id="__codelineno-11-60" name="__codelineno-11-60" href="#__codelineno-11-60"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">19</span><span class="p">.</span><span class="mi">472016</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">010914</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Server</span><span class="p">]</span><span class="w"> </span><span class="n">Aborted</span><span class="w"> </span><span class="k">connection</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">db</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;unconnected&#39;</span><span class="w"> </span><span class="k">user</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="w"> </span><span class="k">host</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">The</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">disconnected</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">inactivity</span><span class="p">.).</span>
</span><span id="__span-11-61"><a id="__codelineno-11-61" name="__codelineno-11-61" href="#__codelineno-11-61"></a>
</span><span id="__span-11-62"><a id="__codelineno-11-62" name="__codelineno-11-62" href="#__codelineno-11-62"></a><span class="o">##</span><span class="w"> </span><span class="n">node1のmysqldを起動し</span><span class="err">、</span><span class="k">start</span><span class="w"> </span><span class="n">group_replicationしました</span><span class="err">。</span>
</span><span id="__span-11-63"><a id="__codelineno-11-63" name="__codelineno-11-63" href="#__codelineno-11-63"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">30</span><span class="p">.</span><span class="mi">683150</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] Adding new node to the configuration: node1:33061&#39;</span>
</span><span id="__span-11-64"><a id="__codelineno-11-64" name="__codelineno-11-64" href="#__codelineno-11-64"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">30</span><span class="p">.</span><span class="mi">683570</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] Updating physical connections to other servers&#39;</span>
</span><span id="__span-11-65"><a id="__codelineno-11-65" name="__codelineno-11-65" href="#__codelineno-11-65"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">30</span><span class="p">.</span><span class="mi">683610</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] Using existing server node 0 host node2:33061&#39;</span>
</span><span id="__span-11-66"><a id="__codelineno-11-66" name="__codelineno-11-66" href="#__codelineno-11-66"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">30</span><span class="p">.</span><span class="mi">683623</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] Using existing server node 1 host node3:33061&#39;</span>
</span><span id="__span-11-67"><a id="__codelineno-11-67" name="__codelineno-11-67" href="#__codelineno-11-67"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">30</span><span class="p">.</span><span class="mi">683634</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] Using existing server node 2 host node1:33061&#39;</span>
</span><span id="__span-11-68"><a id="__codelineno-11-68" name="__codelineno-11-68" href="#__codelineno-11-68"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">30</span><span class="p">.</span><span class="mi">683652</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] Sucessfully installed new site definition. Start synode for this configuration is {dd63b25c 834186 0}, boot key synode is {dd63b25c 834175 0}, configured event horizon=10, my node identifier is 0&#39;</span>
</span><span id="__span-11-69"><a id="__codelineno-11-69" name="__codelineno-11-69" href="#__codelineno-11-69"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">30</span><span class="p">.</span><span class="mi">684085</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] Sender task disconnected from node1:33061&#39;</span>
</span><span id="__span-11-70"><a id="__codelineno-11-70" name="__codelineno-11-70" href="#__codelineno-11-70"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">30</span><span class="p">.</span><span class="mi">684112</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] Connecting to node1:33061&#39;</span>
</span><span id="__span-11-71"><a id="__codelineno-11-71" name="__codelineno-11-71" href="#__codelineno-11-71"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">30</span><span class="p">.</span><span class="mi">684368</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] Connected to node1:33061&#39;</span>
</span><span id="__span-11-72"><a id="__codelineno-11-72" name="__codelineno-11-72" href="#__codelineno-11-72"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">31</span><span class="p">.</span><span class="mi">487931</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] A configuration change was detected. Sending a Global View Message to all nodes. My node identifier is 0 and my address is node2:33061&#39;</span>
</span><span id="__span-11-73"><a id="__codelineno-11-73" name="__codelineno-11-73" href="#__codelineno-11-73"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">37</span><span class="p">.</span><span class="mi">966205</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] A configuration change was detected. Sending a Global View Message to all nodes. My node identifier is 0 and my address is node2:33061&#39;</span>
</span><span id="__span-11-74"><a id="__codelineno-11-74" name="__codelineno-11-74" href="#__codelineno-11-74"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">38</span><span class="p">.</span><span class="mi">065989</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011735</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;[GCS] Group is able to support up to communication protocol version 8.0.27&#39;</span>
</span><span id="__span-11-75"><a id="__codelineno-11-75" name="__codelineno-11-75" href="#__codelineno-11-75"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">38</span><span class="p">.</span><span class="mi">066211</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011501</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Members joined the group: node1:3306&#39;</span>
</span><span id="__span-11-76"><a id="__codelineno-11-76" name="__codelineno-11-76" href="#__codelineno-11-76"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">38</span><span class="p">.</span><span class="mi">066410</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="k">System</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011503</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Group membership changed to node2:3306, node3:3306, node1:3306 on view 16842195647561739:11.&#39;</span>
</span><span id="__span-11-77"><a id="__codelineno-11-77" name="__codelineno-11-77" href="#__codelineno-11-77"></a>
</span><span id="__span-11-78"><a id="__codelineno-11-78" name="__codelineno-11-78" href="#__codelineno-11-78"></a><span class="o">##</span><span class="w"> </span><span class="n">binlogをnode1に転送する</span>
</span><span id="__span-11-79"><a id="__codelineno-11-79" name="__codelineno-11-79" href="#__codelineno-11-79"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">38</span><span class="p">.</span><span class="mi">092124</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">62</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">010462</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="k">Start</span><span class="w"> </span><span class="n">binlog_dump</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">source_thread_id</span><span class="p">(</span><span class="mi">62</span><span class="p">)</span><span class="w"> </span><span class="n">replica_server</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">pos</span><span class="p">(,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
</span><span id="__span-11-80"><a id="__codelineno-11-80" name="__codelineno-11-80" href="#__codelineno-11-80"></a>
</span><span id="__span-11-81"><a id="__codelineno-11-81" name="__codelineno-11-81" href="#__codelineno-11-81"></a><span class="o">##</span><span class="w"> </span><span class="n">node1をMGRの一員としてjoinしました</span><span class="err">。</span>
</span><span id="__span-11-82"><a id="__codelineno-11-82" name="__codelineno-11-82" href="#__codelineno-11-82"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">48</span><span class="p">.</span><span class="mi">293141</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="k">System</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">011492</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Repl</span><span class="p">]</span><span class="w"> </span><span class="n">Plugin</span><span class="w"> </span><span class="n">group_replication</span><span class="w"> </span><span class="n">reported</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;The member with address node1:3306 was declared online within the replication group.&#39;</span>
</span><span id="__span-11-83"><a id="__codelineno-11-83" name="__codelineno-11-83" href="#__codelineno-11-83"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">20</span><span class="p">.</span><span class="mi">217670</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">62</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">010914</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Server</span><span class="p">]</span><span class="w"> </span><span class="n">Aborted</span><span class="w"> </span><span class="k">connection</span><span class="w"> </span><span class="mi">62</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">db</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;unconnected&#39;</span><span class="w"> </span><span class="k">user</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;repl_user&#39;</span><span class="w"> </span><span class="k">host</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;49.212.126.51&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">failed</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">flush_net</span><span class="p">()).</span>
</span><span id="__span-11-84"><a id="__codelineno-11-84" name="__codelineno-11-84" href="#__codelineno-11-84"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">49</span><span class="p">.</span><span class="mi">417733</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">58</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">013730</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Server</span><span class="p">]</span><span class="w"> </span><span class="s1">&#39;wait_timeout&#39;</span><span class="w"> </span><span class="k">period</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">exceeded</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">`</span><span class="n">root</span><span class="o">`@`</span><span class="n">localhost</span><span class="o">`</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">idle</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="k">last</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">long</span><span class="p">.</span>
</span><span id="__span-11-85"><a id="__codelineno-11-85" name="__codelineno-11-85" href="#__codelineno-11-85"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">16</span><span class="n">T17</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">49</span><span class="p">.</span><span class="mi">418050</span><span class="o">+</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">58</span><span class="w"> </span><span class="p">[</span><span class="n">Note</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">MY</span><span class="o">-</span><span class="mi">010914</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Server</span><span class="p">]</span><span class="w"> </span><span class="n">Aborted</span><span class="w"> </span><span class="k">connection</span><span class="w"> </span><span class="mi">58</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">db</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;unconnected&#39;</span><span class="w"> </span><span class="k">user</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="w"> </span><span class="k">host</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">The</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">disconnected</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">inactivity</span><span class="p">.).</span>
</span></code></pre></div>
<h4 id="master_2">MASTERサーバを障害から復活の場合<a class="headerlink" href="#master_2" title="Permanent link">&para;</a></h4>
<ul>
<li>このとき <code>group_replication_bootstrap_group=ON</code> を指定しません。指定すると同じ名前の別のグループが作成されてしまいます。</li>
</ul>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1">-- mysqldを起動</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="p">[</span><span class="n">root</span><span class="o">@</span><span class="n">node1</span><span class="w"> </span><span class="k">work</span><span class="p">]</span><span class="o">#</span><span class="w"> </span><span class="n">systemctl</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="n">mysqld</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="c1">-- 現状確認</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="c1">-- offlineであること</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="mi">04</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">07</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="w"> </span><span class="p">;</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="o">+</span><span class="c1">---------------------------+-----------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="o">|</span><span class="w"> </span><span class="n">CHANNEL_NAME</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_PORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_VERSION</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_COMMUNICATION_STACK</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="o">+</span><span class="c1">---------------------------+-----------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="o">|</span><span class="w"> </span><span class="n">group_replication_applier</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">        </span><span class="k">NULL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">OFFLINE</span><span class="w">      </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w">                </span><span class="o">|</span><span class="w">                            </span><span class="o">|</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="o">+</span><span class="c1">---------------------------+-----------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="c1">-- MGRを起動する</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="c1">-- このとき group_replication_bootstrap_group=ON を指定しません。指定すると同じ名前の別のグループが作成されてしまいます。</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="mi">04</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">10</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="n">group_replication</span><span class="p">;</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">8</span><span class="p">.</span><span class="mi">60</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="c1">-- MGRのステータスを確認</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="c1">-- 起動直後のMEMBER_STATEがRECOVERINGであること</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="c1">-- データの自動同期中</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="mi">04</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">25</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="w"> </span><span class="p">;</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="o">+</span><span class="c1">---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a><span class="o">|</span><span class="w"> </span><span class="n">CHANNEL_NAME</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="w">                            </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_PORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_VERSION</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_COMMUNICATION_STACK</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="o">+</span><span class="c1">---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a><span class="o">|</span><span class="w"> </span><span class="n">group_replication_applier</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="n">ba497e</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">e8e</span><span class="o">-</span><span class="mi">5254007</span><span class="n">b60ca</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node2</span><span class="w">       </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">33</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">XCom</span><span class="w">                       </span><span class="o">|</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a><span class="o">|</span><span class="w"> </span><span class="n">group_replication_applier</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">d7239f8c</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="n">aeeb</span><span class="o">-</span><span class="mi">525400</span><span class="n">c72882</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node3</span><span class="w">       </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">33</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">XCom</span><span class="w">                       </span><span class="o">|</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a><span class="o">|</span><span class="w"> </span><span class="n">group_replication_applier</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">defba275</span><span class="o">-</span><span class="n">f2ef</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">eae</span><span class="o">-</span><span class="mi">525400</span><span class="n">e752a2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node1</span><span class="w">       </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RECOVERING</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">33</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">XCom</span><span class="w">                       </span><span class="o">|</span>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a><span class="o">+</span><span class="c1">---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a>
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a><span class="c1">-- しばらく後状況を確認</span>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a><span class="mi">05</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">19</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="p">,</span><span class="n">MEMBER_HOST</span><span class="p">,</span><span class="n">MEMBER_STATE</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="p">;</span>
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="w">                            </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="n">ba497e</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">e8e</span><span class="o">-</span><span class="mi">5254007</span><span class="n">b60ca</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node2</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">     </span><span class="o">|</span>
</span><span id="__span-12-40"><a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a><span class="o">|</span><span class="w"> </span><span class="n">d7239f8c</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="n">aeeb</span><span class="o">-</span><span class="mi">525400</span><span class="n">c72882</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node3</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-12-41"><a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a><span class="o">|</span><span class="w"> </span><span class="n">defba275</span><span class="o">-</span><span class="n">f2ef</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">eae</span><span class="o">-</span><span class="mi">525400</span><span class="n">e752a2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node1</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span><span class="w">  </span><span class="o">&lt;&lt;</span><span class="c1">-- ONLINEに戻りました。</span>
</span><span id="__span-12-42"><a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-12-43"><a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-12-44"><a id="__codelineno-12-44" name="__codelineno-12-44" href="#__codelineno-12-44"></a>
</span><span id="__span-12-45"><a id="__codelineno-12-45" name="__codelineno-12-45" href="#__codelineno-12-45"></a><span class="mi">05</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">19</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span></code></pre></div>
<h3 id="_5">運用中のグループにインスタンスを追加<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>リカバリプロセスは MySQL の通常のレプリケーションを利用して行われます。<br />
なので必要なバイナリログがグループのすべてのメンバーで既にパージされているとリカバリプロセスは失敗します。<br />
グループのすべてのメンバからバイナリログをパージします。</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="cm">/* [sv01/sv02/sv03] */</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">flush</span><span class="w"> </span><span class="n">logs</span><span class="p">;</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="n">purge</span><span class="w"> </span><span class="nb">binary</span><span class="w"> </span><span class="n">logs</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">now</span><span class="p">();</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="k">show</span><span class="w"> </span><span class="n">binlog</span><span class="w"> </span><span class="n">events</span><span class="p">;</span>
</span></code></pre></div>
<p>新しいインスタンスを開始して、</p>
<p><div class="language-sql highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="w"> </span><span class="n">rm</span><span class="w"> </span><span class="o">-</span><span class="n">fsv</span><span class="w"> </span><span class="n">sv04</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="n">sv04</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="w"> </span><span class="n">logs</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="n">sv04</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="w"> </span><span class="k">exec</span><span class="w"> </span><span class="n">sv04</span><span class="w"> </span><span class="n">mysql</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="cm">/* [sv04] */</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="n">rpl_user</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">;</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="k">GRANT</span><span class="w"> </span><span class="n">REPLICATION</span><span class="w"> </span><span class="n">SLAVE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">rpl_user</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="n">CHANGE</span><span class="w"> </span><span class="n">MASTER</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">MASTER_USER</span><span class="o">=</span><span class="s1">&#39;rpl_user&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">MASTER_PASSWORD</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="n">CHANNEL</span><span class="w"> </span><span class="s1">&#39;group_replication_recovery&#39;</span><span class="p">;</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="k">RESET</span><span class="w"> </span><span class="n">MASTER</span><span class="p">;</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="k">START</span><span class="w"> </span><span class="n">GROUP_REPLICATION</span><span class="p">;</span>
</span></code></pre></div>
ログに次のようなものがたくさん出力されます。</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>[ERROR] [MY-010557] [Repl] Error reading packet from server for channel &#39;group_replication_recovery&#39;: Cannot replicate because the master purged required binary logs. Replicate the missing transactions from elsewhere, or provision a new slave from backup. Consider increasing the master&#39;s binary log expiration period. To find the missing transactions, see the master&#39;s error log or the manual for GTID_SUBTRACT. (server_errno=1236)
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>[ERROR] [MY-013114] [Repl] Slave I/O for channel &#39;group_replication_recovery&#39;: Got fatal error 1236 from master when reading data from binary log: &#39;Cannot replicate because the master purged required binary logs. Replicate the missing transactions from elsewhere, or provision a new slave from backup. Consider increasing the master&#39;s binary log expiration period. To find the missing transactions, see the master&#39;s error log or the manual for GTID_SUBTRACT.&#39;, Error_code: MY-013114
</span></code></pre></div>
メンバーのリストを見てみると、追加はされていますが MEMBER_STATE が RECOVERING のままです。</p>
<p><div class="language-sql highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="cm">/* [sv04] */</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_PORT</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="p">;</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="o">+</span><span class="c1">-------------+-------------+--------------+-------------+</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_PORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="o">+</span><span class="c1">-------------+-------------+--------------+-------------+</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="o">|</span><span class="w"> </span><span class="n">sv04</span><span class="w">        </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RECOVERING</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="o">|</span><span class="w"> </span><span class="n">sv01</span><span class="w">        </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">     </span><span class="o">|</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="o">|</span><span class="w"> </span><span class="n">sv03</span><span class="w">        </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="o">|</span><span class="w"> </span><span class="n">sv02</span><span class="w">        </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="o">+</span><span class="c1">-------------+-------------+--------------+-------------+</span>
</span></code></pre></div>
しばらくと MEMBER_STATE は ERROR になります。</p>
<p><div class="language-sql highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="cm">/* [sv04] */</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_PORT</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="p">;</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="o">+</span><span class="c1">-------------+-------------+--------------+-------------+</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_PORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="o">+</span><span class="c1">-------------+-------------+--------------+-------------+</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="o">|</span><span class="w"> </span><span class="n">sv04</span><span class="w">        </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ERROR</span><span class="w">        </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="o">+</span><span class="c1">-------------+-------------+--------------+-------------+</span>
</span></code></pre></div>
他のメンバーからは見えなくなります。</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="cm">/* [sv01] */</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_PORT</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="p">;</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="o">+</span><span class="c1">-------------+-------------+--------------+-------------+</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_PORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="o">+</span><span class="c1">-------------+-------------+--------------+-------------+</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="o">|</span><span class="w"> </span><span class="n">sv01</span><span class="w">        </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">     </span><span class="o">|</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="o">|</span><span class="w"> </span><span class="n">sv03</span><span class="w">        </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="o">|</span><span class="w"> </span><span class="n">sv02</span><span class="w">        </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="o">+</span><span class="c1">-------------+-------------+--------------+-------------+</span>
</span></code></pre></div>
<details class="tip" open="open">
<summary>注意</summary>
<p>グループレプリケーションを開始した直後の、すべてのバイナリログがまだ残っている状態でインスタンスを追加するようなときは別として、運用中のグループにノードを追加するときは追加前に mysqldump 的なことが必要です。<br />
公式のドキュメントだと MySQL Enterprise Backup を使用する例が記載されていましたが、mysqldump でも良いと思うし、データディレクトリの rsync（auto.cnf に注意）でも大丈夫だと思います。</p>
</details>
<p>試しに mysqldump してみます。</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># 新しいインスタンスを開始</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>docker-compose<span class="w"> </span>rm<span class="w"> </span>-fsv<span class="w"> </span>sv04
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>sv04
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>docker-compose<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>sv04
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="c1"># レプリケーションユーザーの作成やバイナリログのリセット</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-T<span class="w"> </span>sv04<span class="w"> </span>mysql<span class="w"> </span><span class="s">&lt;&lt;&#39;SQL&#39;</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="s">  CREATE USER rpl_user@&#39;%&#39; IDENTIFIED BY &#39;password&#39;;</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="s">  GRANT REPLICATION SLAVE ON *.* TO rpl_user@&#39;%&#39;;</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="s">  CHANGE MASTER TO MASTER_USER=&#39;rpl_user&#39;, MASTER_PASSWORD=&#39;password&#39; FOR CHANNEL &#39;group_replication_recovery&#39;;</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="s">  RESET MASTER;</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="s">SQL</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="c1"># 別のノードからダンプ</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="o">[</span>root@node3<span class="w"> </span>work<span class="o">]</span><span class="c1"># mysqldump --all-databases --single-transaction --triggers --routines --events &gt; bk.sql</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="c1"># ダンプしたファイルを新ノードにインポート</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="o">[</span>root@node1<span class="w"> </span>work<span class="o">]</span><span class="c1"># mysql &lt; bk.sql</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="c1"># コンテナに入る</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>sv04<span class="w"> </span>mysql
</span></code></pre></div>
<details class="info">
<summary>インポート失敗した場合</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a># ダンプしたファイルを新ノードにインポート
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>[root@node1 work]# mysql &lt; bk.sql
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>ERROR 3546 (HY000) at line 26: @@GLOBAL.GTID_PURGED cannot be changed: the added gtid set must not overlap with @@GLOBAL.GTID_EXECUTED
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>[root@node1 work]#
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a># 上記の通り失敗した場合
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>https://blog.s-style.co.jp/2021/10/8244/
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>https://acind.hatenablog.jp/entry/2021/03/18/115957
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>https://gihyo.jp/dev/serial/01/mysql-road-construction-news/0025
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a># インポート時GTIDが空である必要です。
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a># 対象の行をコメントアウトする
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>[root@node1 work]# vi bk.sql
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>## -- SET @@GLOBAL.GTID_PURGED=/*!80000 &#39;+&#39;*/ &#39;aaaaaaaa-1111-2222-3333-bbbbbbbbbbbb:1-907783:1000006-1118353&#39;;
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a># インポートする
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>[root@node1 work]# mysql &lt; bk.sql
</span></code></pre></div>
</details>
<p><code>show master status</code> の <code>Executed_Gtid_Set</code> が他のノードと同じになっていれば大丈夫です。</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="cm">/* [sv04] */</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="k">show</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="o">+</span><span class="c1">---------------+----------+--------------+------------------+------------------------------------------+</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="o">|</span><span class="w"> </span><span class="n">File</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="k">Position</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Binlog_Do_DB</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Binlog_Ignore_DB</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Executed_Gtid_Set</span><span class="w">                        </span><span class="o">|</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="o">+</span><span class="c1">---------------+----------+--------------+------------------+------------------------------------------+</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="o">|</span><span class="w"> </span><span class="n">binlog</span><span class="p">.</span><span class="mi">000001</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">151</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="o">|</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="mi">470</span><span class="n">b4daf</span><span class="o">-</span><span class="mi">6</span><span class="n">c34</span><span class="o">-</span><span class="mi">415</span><span class="n">f</span><span class="o">-</span><span class="mi">97</span><span class="n">ad</span><span class="o">-</span><span class="mi">68</span><span class="n">cf76ef24e7</span><span class="p">:</span><span class="mi">1</span><span class="o">-</span><span class="mi">6</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="o">+</span><span class="c1">---------------+----------+--------------+------------------+------------------------------------------+</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="mi">04</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">20</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SHOW</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">VARIABLES</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;gtid_executed&#39;</span><span class="p">;</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="o">+</span><span class="c1">---------------+---------------------------------------------------------------+</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="o">|</span><span class="w"> </span><span class="n">Variable_name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Value</span><span class="w">                                                         </span><span class="o">|</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="o">+</span><span class="c1">---------------+---------------------------------------------------------------+</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="o">|</span><span class="w"> </span><span class="n">gtid_executed</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">aaaaaaaa</span><span class="o">-</span><span class="mi">1111</span><span class="o">-</span><span class="mi">2222</span><span class="o">-</span><span class="mi">3333</span><span class="o">-</span><span class="n">bbbbbbbbbbbb</span><span class="p">:</span><span class="mi">1</span><span class="o">-</span><span class="mi">907784</span><span class="p">:</span><span class="mi">1000006</span><span class="o">-</span><span class="mi">1118353</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="o">+</span><span class="c1">---------------+---------------------------------------------------------------+</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="mi">04</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">27</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>グループレプリケーションを開始できます。</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="cm">/* [sv04] */</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="k">START</span><span class="w"> </span><span class="n">GROUP_REPLICATION</span><span class="p">;</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_PORT</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="p">;</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="o">+</span><span class="c1">-------------+-------------+--------------+-------------+</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_PORT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="o">+</span><span class="c1">-------------+-------------+--------------+-------------+</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="o">|</span><span class="w"> </span><span class="n">sv04</span><span class="w">        </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="o">|</span><span class="w"> </span><span class="n">sv01</span><span class="w">        </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">     </span><span class="o">|</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="o">|</span><span class="w"> </span><span class="n">sv03</span><span class="w">        </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="o">|</span><span class="w"> </span><span class="n">sv02</span><span class="w">        </span><span class="o">|</span><span class="w">        </span><span class="mi">3306</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="o">+</span><span class="c1">-------------+-------------+--------------+-------------+</span>
</span></code></pre></div>
<h3 id="ip">IPアドレスのホワイトリスト<a class="headerlink" href="#ip" title="Permanent link">&para;</a></h3>
<p>MySQL の設定で <code>group_replication_group_seeds</code> にグループのインスタンスのアドレスを羅列していますが、別にグループのすべてのインスタンスが羅列されている必要はありません。<br />
この設定は、インスタンスでグループレプリケーションを開始したときに、どこからグループの情報を取得するかの設定です。<br />
なのでグループ内の生きているメンバーのいずれかが指定されていれば大丈夫です。なので、グループへのインスタンスの追加は <code>group_replication_group_seeds</code> をいじらなくてもできます。<br />
一方、グループに参加できるアドレスのホワイトリストの設定もあって（<code>group_replication_ip_whitelist</code>）、そこに含まれないアドレスのインスタンスはグループのインスタンスとの通信が拒否されます。ただし、デフォルトでサーバの I/F のサブネットが追加されるので、複数のサブネットにインスタンスが分散されるとかではない限りはデフォルトのままで良さそうです。</p>
<h3 id="monitoring-group-replication">Monitoring Group Replication<a class="headerlink" href="#monitoring-group-replication" title="Permanent link">&para;</a></h3>
<p>グループのメンバやレプリケーションの詳細は下記のようにパフォーマンススキーマから得られます。</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="cm">/* グループのメンバに関する情報 */</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_member_stats</span><span class="w"> </span><span class="err">\</span><span class="k">G</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="p">;</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="cm">/* レプリケーションチャンネルに関する情報 */</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_connection_status</span><span class="w"> </span><span class="err">\</span><span class="k">G</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_applier_status</span><span class="p">;</span>
</span></code></pre></div>
<h5 id="2">レプリケーションチャンネルには次の用途の2つが作成されています。<a class="headerlink" href="#2" title="Permanent link">&para;</a></h5>
<ul>
<li>group_replication_recovery<ul>
<li>分散リカバリフェーズ（リカバリプロセス）で使用される</li>
<li>ノードを追加したときや故障ノードが復帰したときの同期用</li>
</ul>
</li>
<li>group_replication_applier<ul>
<li>グループで実行されたトランザクションを適用するために使用される</li>
<li>要するに平時のトランザクションのレプリケーション</li>
</ul>
</li>
</ul>
<h5 id="_6">グループのメンバに関するパフォーマンステーブルのビューについて。<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h5>
<ul>
<li>replication_group_member_stats<ul>
<li>メンバーごとの待機中のトランザクション数とか処理済トランザクション数とかの統計</li>
<li>特定のメンバーが遅れているとかでキューに溜まってるのを監視したりするのに使える</li>
</ul>
</li>
<li>replication_group_members<ul>
<li>メンバーのステータス</li>
</ul>
</li>
</ul>
<h5 id="replication_group_members"><code>replication_group_members</code> で表示されるメンバーのステータス。<a class="headerlink" href="#replication_group_members" title="Permanent link">&para;</a></h5>
<ul>
<li>ONLINE<ul>
<li>同期されている</li>
</ul>
</li>
<li>RECOVERING<ul>
<li>リカバリプロセス中</li>
</ul>
</li>
<li>OFFLINE<ul>
<li>メンバーはグループに属していない</li>
<li>プラグインがロード済でグループレプリケーションか開始していないとき</li>
</ul>
</li>
<li>ERROR<ul>
<li>リカバリプロセスやトランザクションの適用中にエラー</li>
</ul>
</li>
<li>UNREACHABLE<ul>
<li>メンバーがネットワーク的に到達不能</li>
</ul>
</li>
</ul>
<p>サービス監視とかするなら <code>ONLINE</code> 以外はなにかしら異常とみなして良さそうです。</p>
<h2 id="keepalived">keepalived<a class="headerlink" href="#keepalived" title="Permanent link">&para;</a></h2>
<details class="info">
<summary>keepalived.conf</summary>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># node1</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="o">[</span>root@node1<span class="w"> </span>work<span class="o">]</span><span class="c1"># cat /etc/keepalived/keepalived.conf</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>!<span class="w"> </span>Configuration<span class="w"> </span>File<span class="w"> </span><span class="k">for</span><span class="w"> </span>keepalived
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>global_defs<span class="w"> </span><span class="o">{</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="w">   </span>router_id<span class="w"> </span>MGR_NODE1<span class="w">            </span><span class="c1">#是运行keepalived的一个表示，多个集群设置不同。</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="w">   </span>notification_email<span class="w"> </span><span class="o">{</span><span class="w">           </span><span class="c1">#设置 keepalived 在发生事件（比如切换）的时候，需要发送到的email地址，可以设置多个，每行一个。</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="w">     </span>y-ryu@sakura.ad.jp
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="w">   </span><span class="o">}</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="w">   </span>notification_email_from<span class="w"> </span>node3<span class="w">  </span><span class="c1">#设置通知邮件发送来自于哪里，如果本地开启了sendmail的话，可以使用上面的默认值。</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="w">   </span><span class="c1"># smtp_server 192.168.200.1    #指定发送邮件的smtp服务器。</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="w">   </span>smtp_connect_timeout<span class="w"> </span><span class="m">30</span><span class="w">        </span><span class="c1">#设置smtp连接超时时间，单位为秒。</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="o">}</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="c1">#指定mysql服务检测脚本</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>vrrp_script<span class="w"> </span>chk_mysql<span class="w"> </span><span class="o">{</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="w">    </span>script<span class="w"> </span><span class="s2">&quot;/etc/keepalived/chk_mysql.sh&quot;</span><span class="w"> </span><span class="c1">#脚本路径</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a><span class="w">    </span>interval<span class="w"> </span><span class="m">2</span><span class="w">            </span><span class="c1">#脚本检测频率</span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a><span class="w">    </span>weight<span class="w"> </span>-5<span class="w">             </span><span class="c1">#脚本执行返回值 =0 ，优先级不变。 !=0 时优先级 -5</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a><span class="w">    </span>fall<span class="w"> </span><span class="m">2</span><span class="w">                </span><span class="c1">#如果连续两次检测失败，认为节点服务不可用</span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="w">    </span>rise<span class="w"> </span><span class="m">1</span><span class="w">                </span><span class="c1">#如果连续2次检查成功则认为节点正常</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a><span class="o">}</span>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a><span class="c1">#监测mysql 是否是master</span>
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>vrrp_script<span class="w"> </span>chk_mysql_master<span class="w"> </span><span class="o">{</span>
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a><span class="w">    </span>script<span class="w"> </span><span class="s2">&quot;/etc/keepalived/chk_mysql_master.sh&quot;</span>
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a><span class="w">    </span>interval<span class="w"> </span><span class="m">2</span>
</span><span id="__span-24-28"><a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a><span class="w">    </span>weight<span class="w"> </span><span class="m">10</span><span class="w">             </span><span class="c1">#脚本执行返回值 =0 ，优先级加 10。 !=0 时优先级不变。</span>
</span><span id="__span-24-29"><a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a><span class="o">}</span>
</span><span id="__span-24-30"><a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>
</span><span id="__span-24-31"><a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a><span class="c1"># 简易检测</span>
</span><span id="__span-24-32"><a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>vrrp_script<span class="w"> </span>check_run<span class="w"> </span><span class="o">{</span>
</span><span id="__span-24-33"><a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a><span class="w">        </span>script<span class="w"> </span><span class="s2">&quot;/etc/keepalived/mysql_check.sh&quot;</span>
</span><span id="__span-24-34"><a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a><span class="w">        </span>interval<span class="w"> </span><span class="m">5</span><span class="w">                              </span><span class="c1">#5秒执行一次脚本</span>
</span><span id="__span-24-35"><a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a><span class="o">}</span>
</span><span id="__span-24-36"><a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a>
</span><span id="__span-24-37"><a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a>vrrp_instance<span class="w"> </span>VI_1<span class="w"> </span><span class="o">{</span>
</span><span id="__span-24-38"><a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a><span class="w">    </span>state<span class="w"> </span>BACKUP<span class="w">          </span><span class="c1">#指定实例初始状态，实际的MASTER和BACKUP是选举决定的。</span>
</span><span id="__span-24-39"><a id="__codelineno-24-39" name="__codelineno-24-39" href="#__codelineno-24-39"></a><span class="w">    </span>interface<span class="w"> </span>eth0<span class="w">        </span><span class="c1">#指定实例绑定的网卡</span>
</span><span id="__span-24-40"><a id="__codelineno-24-40" name="__codelineno-24-40" href="#__codelineno-24-40"></a><span class="w">    </span>virtual_router_id<span class="w"> </span><span class="m">88</span><span class="w">  </span><span class="c1">#设置VRID标记(0..255)</span>
</span><span id="__span-24-41"><a id="__codelineno-24-41" name="__codelineno-24-41" href="#__codelineno-24-41"></a><span class="w">    </span>priority<span class="w"> </span><span class="m">90</span><span class="w">           </span><span class="c1">#设置优先级，优先级高的会被竞选为Master</span>
</span><span id="__span-24-42"><a id="__codelineno-24-42" name="__codelineno-24-42" href="#__codelineno-24-42"></a><span class="w">    </span>advert_int<span class="w"> </span><span class="m">1</span><span class="w">          </span><span class="c1">#检查的时间间隔，默认1s</span>
</span><span id="__span-24-43"><a id="__codelineno-24-43" name="__codelineno-24-43" href="#__codelineno-24-43"></a><span class="w">    </span>authentication<span class="w"> </span><span class="o">{</span><span class="w">      </span><span class="c1">#节点间的认证，所有的必须一致</span>
</span><span id="__span-24-44"><a id="__codelineno-24-44" name="__codelineno-24-44" href="#__codelineno-24-44"></a><span class="w">        </span>auth_type<span class="w"> </span>PASS
</span><span id="__span-24-45"><a id="__codelineno-24-45" name="__codelineno-24-45" href="#__codelineno-24-45"></a><span class="w">        </span>auth_pass<span class="w"> </span><span class="m">1111</span>
</span><span id="__span-24-46"><a id="__codelineno-24-46" name="__codelineno-24-46" href="#__codelineno-24-46"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-24-47"><a id="__codelineno-24-47" name="__codelineno-24-47" href="#__codelineno-24-47"></a>
</span><span id="__span-24-48"><a id="__codelineno-24-48" name="__codelineno-24-48" href="#__codelineno-24-48"></a><span class="w">    </span>virtual_ipaddress<span class="w"> </span><span class="o">{</span><span class="w">   </span><span class="c1">#设置VIP，可以设置多个，用于切换时的地址绑定。</span>
</span><span id="__span-24-49"><a id="__codelineno-24-49" name="__codelineno-24-49" href="#__codelineno-24-49"></a><span class="w">        </span>VIP<span class="w">               </span><span class="c1"># VIP地址（该ip为虚拟出来的vip地址)</span>
</span><span id="__span-24-50"><a id="__codelineno-24-50" name="__codelineno-24-50" href="#__codelineno-24-50"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-24-51"><a id="__codelineno-24-51" name="__codelineno-24-51" href="#__codelineno-24-51"></a>
</span><span id="__span-24-52"><a id="__codelineno-24-52" name="__codelineno-24-52" href="#__codelineno-24-52"></a><span class="w">    </span>track_script<span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="c1">#指定前面脚本的名字</span>
</span><span id="__span-24-53"><a id="__codelineno-24-53" name="__codelineno-24-53" href="#__codelineno-24-53"></a><span class="w">        </span><span class="c1"># check_run</span>
</span><span id="__span-24-54"><a id="__codelineno-24-54" name="__codelineno-24-54" href="#__codelineno-24-54"></a><span class="w">        </span>chk_mysql
</span><span id="__span-24-55"><a id="__codelineno-24-55" name="__codelineno-24-55" href="#__codelineno-24-55"></a><span class="w">        </span>chk_mysql_master
</span><span id="__span-24-56"><a id="__codelineno-24-56" name="__codelineno-24-56" href="#__codelineno-24-56"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-24-57"><a id="__codelineno-24-57" name="__codelineno-24-57" href="#__codelineno-24-57"></a><span class="o">}</span>
</span><span id="__span-24-58"><a id="__codelineno-24-58" name="__codelineno-24-58" href="#__codelineno-24-58"></a>
</span><span id="__span-24-59"><a id="__codelineno-24-59" name="__codelineno-24-59" href="#__codelineno-24-59"></a><span class="c1"># node2</span>
</span><span id="__span-24-60"><a id="__codelineno-24-60" name="__codelineno-24-60" href="#__codelineno-24-60"></a><span class="o">[</span>root@node2<span class="w"> </span>~<span class="o">]</span><span class="c1"># cat /etc/keepalived/keepalived.conf</span>
</span><span id="__span-24-61"><a id="__codelineno-24-61" name="__codelineno-24-61" href="#__codelineno-24-61"></a>!<span class="w"> </span>Configuration<span class="w"> </span>File<span class="w"> </span><span class="k">for</span><span class="w"> </span>keepalived
</span><span id="__span-24-62"><a id="__codelineno-24-62" name="__codelineno-24-62" href="#__codelineno-24-62"></a>
</span><span id="__span-24-63"><a id="__codelineno-24-63" name="__codelineno-24-63" href="#__codelineno-24-63"></a>global_defs<span class="w"> </span><span class="o">{</span>
</span><span id="__span-24-64"><a id="__codelineno-24-64" name="__codelineno-24-64" href="#__codelineno-24-64"></a><span class="w">   </span>router_id<span class="w"> </span>MGR_NODE2<span class="w">            </span><span class="c1">#是运行keepalived的一个表示，多个集群设置不同。</span>
</span><span id="__span-24-65"><a id="__codelineno-24-65" name="__codelineno-24-65" href="#__codelineno-24-65"></a><span class="w">   </span>notification_email<span class="w"> </span><span class="o">{</span><span class="w">           </span><span class="c1">#设置 keepalived 在发生事件（比如切换）的时候，需要发送到的email地址，可以设置多个，每行一个。</span>
</span><span id="__span-24-66"><a id="__codelineno-24-66" name="__codelineno-24-66" href="#__codelineno-24-66"></a><span class="w">     </span>y-ryu@sakura.ad.jp
</span><span id="__span-24-67"><a id="__codelineno-24-67" name="__codelineno-24-67" href="#__codelineno-24-67"></a><span class="w">   </span><span class="o">}</span>
</span><span id="__span-24-68"><a id="__codelineno-24-68" name="__codelineno-24-68" href="#__codelineno-24-68"></a><span class="w">   </span>notification_email_from<span class="w"> </span>node3<span class="w">  </span><span class="c1">#设置通知邮件发送来自于哪里，如果本地开启了sendmail的话，可以使用上面的默认值。</span>
</span><span id="__span-24-69"><a id="__codelineno-24-69" name="__codelineno-24-69" href="#__codelineno-24-69"></a><span class="w">   </span><span class="c1"># smtp_server 192.168.200.1    #指定发送邮件的smtp服务器。</span>
</span><span id="__span-24-70"><a id="__codelineno-24-70" name="__codelineno-24-70" href="#__codelineno-24-70"></a><span class="w">   </span>smtp_connect_timeout<span class="w"> </span><span class="m">30</span><span class="w">        </span><span class="c1">#设置smtp连接超时时间，单位为秒。</span>
</span><span id="__span-24-71"><a id="__codelineno-24-71" name="__codelineno-24-71" href="#__codelineno-24-71"></a><span class="o">}</span>
</span><span id="__span-24-72"><a id="__codelineno-24-72" name="__codelineno-24-72" href="#__codelineno-24-72"></a>
</span><span id="__span-24-73"><a id="__codelineno-24-73" name="__codelineno-24-73" href="#__codelineno-24-73"></a><span class="c1">#指定mysql服务检测脚本</span>
</span><span id="__span-24-74"><a id="__codelineno-24-74" name="__codelineno-24-74" href="#__codelineno-24-74"></a>vrrp_script<span class="w"> </span>chk_mysql<span class="w"> </span><span class="o">{</span>
</span><span id="__span-24-75"><a id="__codelineno-24-75" name="__codelineno-24-75" href="#__codelineno-24-75"></a><span class="w">    </span>script<span class="w"> </span><span class="s2">&quot;/etc/keepalived/chk_mysql.sh&quot;</span><span class="w"> </span><span class="c1">#脚本路径</span>
</span><span id="__span-24-76"><a id="__codelineno-24-76" name="__codelineno-24-76" href="#__codelineno-24-76"></a><span class="w">    </span>interval<span class="w"> </span><span class="m">2</span><span class="w">                            </span><span class="c1">#脚本检测频率</span>
</span><span id="__span-24-77"><a id="__codelineno-24-77" name="__codelineno-24-77" href="#__codelineno-24-77"></a><span class="w">    </span>weight<span class="w"> </span>-5<span class="w">                             </span><span class="c1">#脚本执行返回值 =0 ，优先级不变。 !=0 时优先级 -5</span>
</span><span id="__span-24-78"><a id="__codelineno-24-78" name="__codelineno-24-78" href="#__codelineno-24-78"></a><span class="w">    </span>fall<span class="w"> </span><span class="m">2</span><span class="w">                                </span><span class="c1">#如果连续两次检测失败，认为节点服务不可用</span>
</span><span id="__span-24-79"><a id="__codelineno-24-79" name="__codelineno-24-79" href="#__codelineno-24-79"></a><span class="w">    </span>rise<span class="w"> </span><span class="m">1</span><span class="w">                                </span><span class="c1">#如果连续2次检查成功则认为节点正常</span>
</span><span id="__span-24-80"><a id="__codelineno-24-80" name="__codelineno-24-80" href="#__codelineno-24-80"></a><span class="o">}</span>
</span><span id="__span-24-81"><a id="__codelineno-24-81" name="__codelineno-24-81" href="#__codelineno-24-81"></a>
</span><span id="__span-24-82"><a id="__codelineno-24-82" name="__codelineno-24-82" href="#__codelineno-24-82"></a><span class="c1">#监测mysql 是否是master</span>
</span><span id="__span-24-83"><a id="__codelineno-24-83" name="__codelineno-24-83" href="#__codelineno-24-83"></a>vrrp_script<span class="w"> </span>chk_mysql_master<span class="w"> </span><span class="o">{</span>
</span><span id="__span-24-84"><a id="__codelineno-24-84" name="__codelineno-24-84" href="#__codelineno-24-84"></a><span class="w">    </span>script<span class="w"> </span><span class="s2">&quot;/etc/keepalived/chk_mysql_master.sh&quot;</span>
</span><span id="__span-24-85"><a id="__codelineno-24-85" name="__codelineno-24-85" href="#__codelineno-24-85"></a><span class="w">    </span>interval<span class="w"> </span><span class="m">2</span>
</span><span id="__span-24-86"><a id="__codelineno-24-86" name="__codelineno-24-86" href="#__codelineno-24-86"></a><span class="w">    </span>weight<span class="w"> </span><span class="m">10</span><span class="w">                             </span><span class="c1">#脚本执行返回值 =0 ，优先级加 10。 !=0 时优先级不变。</span>
</span><span id="__span-24-87"><a id="__codelineno-24-87" name="__codelineno-24-87" href="#__codelineno-24-87"></a><span class="o">}</span>
</span><span id="__span-24-88"><a id="__codelineno-24-88" name="__codelineno-24-88" href="#__codelineno-24-88"></a>
</span><span id="__span-24-89"><a id="__codelineno-24-89" name="__codelineno-24-89" href="#__codelineno-24-89"></a><span class="c1"># 简易检测</span>
</span><span id="__span-24-90"><a id="__codelineno-24-90" name="__codelineno-24-90" href="#__codelineno-24-90"></a>vrrp_script<span class="w"> </span>check_run<span class="w"> </span><span class="o">{</span>
</span><span id="__span-24-91"><a id="__codelineno-24-91" name="__codelineno-24-91" href="#__codelineno-24-91"></a><span class="w">        </span>script<span class="w"> </span><span class="s2">&quot;/etc/keepalived/mysql_check.sh&quot;</span>
</span><span id="__span-24-92"><a id="__codelineno-24-92" name="__codelineno-24-92" href="#__codelineno-24-92"></a><span class="w">        </span>interval<span class="w"> </span><span class="m">5</span><span class="w">                              </span><span class="c1">#5秒执行一次脚本</span>
</span><span id="__span-24-93"><a id="__codelineno-24-93" name="__codelineno-24-93" href="#__codelineno-24-93"></a><span class="o">}</span>
</span><span id="__span-24-94"><a id="__codelineno-24-94" name="__codelineno-24-94" href="#__codelineno-24-94"></a>
</span><span id="__span-24-95"><a id="__codelineno-24-95" name="__codelineno-24-95" href="#__codelineno-24-95"></a>vrrp_instance<span class="w"> </span>VI_1<span class="w"> </span><span class="o">{</span>
</span><span id="__span-24-96"><a id="__codelineno-24-96" name="__codelineno-24-96" href="#__codelineno-24-96"></a><span class="w">    </span>state<span class="w"> </span>BACKUP<span class="w">          </span><span class="c1">#指定实例初始状态，实际的MASTER和BACKUP是选举决定的。</span>
</span><span id="__span-24-97"><a id="__codelineno-24-97" name="__codelineno-24-97" href="#__codelineno-24-97"></a><span class="w">    </span>interface<span class="w"> </span>eth0<span class="w">        </span><span class="c1">#指定实例绑定的网卡</span>
</span><span id="__span-24-98"><a id="__codelineno-24-98" name="__codelineno-24-98" href="#__codelineno-24-98"></a><span class="w">    </span>virtual_router_id<span class="w"> </span><span class="m">88</span><span class="w">  </span><span class="c1">#设置VRID标记(0..255)</span>
</span><span id="__span-24-99"><a id="__codelineno-24-99" name="__codelineno-24-99" href="#__codelineno-24-99"></a><span class="w">    </span>priority<span class="w"> </span><span class="m">10</span><span class="w">           </span><span class="c1">#设置优先级，优先级高的会被竞选为Master</span>
</span><span id="__span-24-100"><a id="__codelineno-24-100" name="__codelineno-24-100" href="#__codelineno-24-100"></a><span class="w">    </span>advert_int<span class="w"> </span><span class="m">1</span><span class="w">          </span><span class="c1">#检查的时间间隔，默认1s</span>
</span><span id="__span-24-101"><a id="__codelineno-24-101" name="__codelineno-24-101" href="#__codelineno-24-101"></a><span class="w">    </span>authentication<span class="w"> </span><span class="o">{</span><span class="w">      </span><span class="c1">#节点间的认证，所有的必须一致</span>
</span><span id="__span-24-102"><a id="__codelineno-24-102" name="__codelineno-24-102" href="#__codelineno-24-102"></a><span class="w">        </span>auth_type<span class="w"> </span>PASS
</span><span id="__span-24-103"><a id="__codelineno-24-103" name="__codelineno-24-103" href="#__codelineno-24-103"></a><span class="w">        </span>auth_pass<span class="w"> </span><span class="m">1111</span>
</span><span id="__span-24-104"><a id="__codelineno-24-104" name="__codelineno-24-104" href="#__codelineno-24-104"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-24-105"><a id="__codelineno-24-105" name="__codelineno-24-105" href="#__codelineno-24-105"></a>
</span><span id="__span-24-106"><a id="__codelineno-24-106" name="__codelineno-24-106" href="#__codelineno-24-106"></a><span class="w">    </span>virtual_ipaddress<span class="w"> </span><span class="o">{</span><span class="w">   </span><span class="c1">#设置VIP，可以设置多个，用于切换时的地址绑定。</span>
</span><span id="__span-24-107"><a id="__codelineno-24-107" name="__codelineno-24-107" href="#__codelineno-24-107"></a><span class="w">        </span>VIP<span class="w">               </span><span class="c1"># VIP地址（该ip为虚拟出来的vip地址)</span>
</span><span id="__span-24-108"><a id="__codelineno-24-108" name="__codelineno-24-108" href="#__codelineno-24-108"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-24-109"><a id="__codelineno-24-109" name="__codelineno-24-109" href="#__codelineno-24-109"></a>
</span><span id="__span-24-110"><a id="__codelineno-24-110" name="__codelineno-24-110" href="#__codelineno-24-110"></a><span class="w">    </span>track_script<span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="c1">#指定前面脚本的名字</span>
</span><span id="__span-24-111"><a id="__codelineno-24-111" name="__codelineno-24-111" href="#__codelineno-24-111"></a><span class="w">        </span><span class="c1"># check_run</span>
</span><span id="__span-24-112"><a id="__codelineno-24-112" name="__codelineno-24-112" href="#__codelineno-24-112"></a><span class="w">        </span>chk_mysql
</span><span id="__span-24-113"><a id="__codelineno-24-113" name="__codelineno-24-113" href="#__codelineno-24-113"></a><span class="w">        </span>chk_mysql_master
</span><span id="__span-24-114"><a id="__codelineno-24-114" name="__codelineno-24-114" href="#__codelineno-24-114"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-24-115"><a id="__codelineno-24-115" name="__codelineno-24-115" href="#__codelineno-24-115"></a><span class="o">}</span>
</span><span id="__span-24-116"><a id="__codelineno-24-116" name="__codelineno-24-116" href="#__codelineno-24-116"></a>
</span><span id="__span-24-117"><a id="__codelineno-24-117" name="__codelineno-24-117" href="#__codelineno-24-117"></a><span class="o">[</span>root@node2<span class="w"> </span>~<span class="o">]</span><span class="c1">#</span>
</span><span id="__span-24-118"><a id="__codelineno-24-118" name="__codelineno-24-118" href="#__codelineno-24-118"></a>
</span><span id="__span-24-119"><a id="__codelineno-24-119" name="__codelineno-24-119" href="#__codelineno-24-119"></a><span class="c1"># node3</span>
</span><span id="__span-24-120"><a id="__codelineno-24-120" name="__codelineno-24-120" href="#__codelineno-24-120"></a><span class="o">[</span>root@node3<span class="w"> </span>work<span class="o">]</span><span class="c1"># cat /etc/keepalived/keepalived.conf</span>
</span><span id="__span-24-121"><a id="__codelineno-24-121" name="__codelineno-24-121" href="#__codelineno-24-121"></a>
</span><span id="__span-24-122"><a id="__codelineno-24-122" name="__codelineno-24-122" href="#__codelineno-24-122"></a>!<span class="w"> </span>Configuration<span class="w"> </span>File<span class="w"> </span><span class="k">for</span><span class="w"> </span>keepalived
</span><span id="__span-24-123"><a id="__codelineno-24-123" name="__codelineno-24-123" href="#__codelineno-24-123"></a>
</span><span id="__span-24-124"><a id="__codelineno-24-124" name="__codelineno-24-124" href="#__codelineno-24-124"></a>global_defs<span class="w"> </span><span class="o">{</span>
</span><span id="__span-24-125"><a id="__codelineno-24-125" name="__codelineno-24-125" href="#__codelineno-24-125"></a><span class="w">   </span>notification_email<span class="w"> </span><span class="o">{</span><span class="w">           </span><span class="c1">#设置 keepalived 在发生事件（比如切换）的时候，需要发送到的email地址，可以设置多个，每行一个。</span>
</span><span id="__span-24-126"><a id="__codelineno-24-126" name="__codelineno-24-126" href="#__codelineno-24-126"></a><span class="w">     </span>y-ryu@sakura.ad.jp
</span><span id="__span-24-127"><a id="__codelineno-24-127" name="__codelineno-24-127" href="#__codelineno-24-127"></a><span class="w">   </span><span class="o">}</span>
</span><span id="__span-24-128"><a id="__codelineno-24-128" name="__codelineno-24-128" href="#__codelineno-24-128"></a><span class="w">   </span>notification_email_from<span class="w"> </span>node3<span class="w">  </span><span class="c1">#设置通知邮件发送来自于哪里，如果本地开启了sendmail的话，可以使用上面的默认值。</span>
</span><span id="__span-24-129"><a id="__codelineno-24-129" name="__codelineno-24-129" href="#__codelineno-24-129"></a><span class="w">   </span><span class="c1"># smtp_server 192.168.200.1    #指定发送邮件的smtp服务器。</span>
</span><span id="__span-24-130"><a id="__codelineno-24-130" name="__codelineno-24-130" href="#__codelineno-24-130"></a><span class="w">   </span>smtp_connect_timeout<span class="w"> </span><span class="m">30</span><span class="w">        </span><span class="c1">#设置smtp连接超时时间，单位为秒。</span>
</span><span id="__span-24-131"><a id="__codelineno-24-131" name="__codelineno-24-131" href="#__codelineno-24-131"></a><span class="w">   </span>router_id<span class="w"> </span>MGR_NODE3<span class="w">            </span><span class="c1">#是运行keepalived的一个表示，多个集群设置不同。</span>
</span><span id="__span-24-132"><a id="__codelineno-24-132" name="__codelineno-24-132" href="#__codelineno-24-132"></a><span class="o">}</span>
</span><span id="__span-24-133"><a id="__codelineno-24-133" name="__codelineno-24-133" href="#__codelineno-24-133"></a>
</span><span id="__span-24-134"><a id="__codelineno-24-134" name="__codelineno-24-134" href="#__codelineno-24-134"></a><span class="c1">#指定mysql服务检测脚本</span>
</span><span id="__span-24-135"><a id="__codelineno-24-135" name="__codelineno-24-135" href="#__codelineno-24-135"></a>vrrp_script<span class="w"> </span>chk_mysql<span class="w"> </span><span class="o">{</span>
</span><span id="__span-24-136"><a id="__codelineno-24-136" name="__codelineno-24-136" href="#__codelineno-24-136"></a><span class="w">    </span>script<span class="w"> </span><span class="s2">&quot;/etc/keepalived/chk_mysql.sh&quot;</span><span class="w"> </span><span class="c1">#脚本路径</span>
</span><span id="__span-24-137"><a id="__codelineno-24-137" name="__codelineno-24-137" href="#__codelineno-24-137"></a><span class="w">    </span>interval<span class="w"> </span><span class="m">2</span><span class="w">            </span><span class="c1">#脚本检测频率</span>
</span><span id="__span-24-138"><a id="__codelineno-24-138" name="__codelineno-24-138" href="#__codelineno-24-138"></a><span class="w">    </span>weight<span class="w"> </span>-5<span class="w">             </span><span class="c1">#脚本执行返回值 =0 ，优先级不变。 !=0 时优先级 -5</span>
</span><span id="__span-24-139"><a id="__codelineno-24-139" name="__codelineno-24-139" href="#__codelineno-24-139"></a><span class="w">    </span>fall<span class="w"> </span><span class="m">2</span><span class="w">                </span><span class="c1">#如果连续两次检测失败，认为节点服务不可用</span>
</span><span id="__span-24-140"><a id="__codelineno-24-140" name="__codelineno-24-140" href="#__codelineno-24-140"></a><span class="w">    </span>rise<span class="w"> </span><span class="m">1</span><span class="w">                </span><span class="c1">#如果连续2次检查成功则认为节点正常</span>
</span><span id="__span-24-141"><a id="__codelineno-24-141" name="__codelineno-24-141" href="#__codelineno-24-141"></a><span class="o">}</span>
</span><span id="__span-24-142"><a id="__codelineno-24-142" name="__codelineno-24-142" href="#__codelineno-24-142"></a>
</span><span id="__span-24-143"><a id="__codelineno-24-143" name="__codelineno-24-143" href="#__codelineno-24-143"></a><span class="c1">#监测mysql 是否是master</span>
</span><span id="__span-24-144"><a id="__codelineno-24-144" name="__codelineno-24-144" href="#__codelineno-24-144"></a>vrrp_script<span class="w"> </span>chk_mysql_master<span class="w"> </span><span class="o">{</span>
</span><span id="__span-24-145"><a id="__codelineno-24-145" name="__codelineno-24-145" href="#__codelineno-24-145"></a><span class="w">    </span>script<span class="w"> </span><span class="s2">&quot;/etc/keepalived/chk_mysql_master.sh&quot;</span>
</span><span id="__span-24-146"><a id="__codelineno-24-146" name="__codelineno-24-146" href="#__codelineno-24-146"></a><span class="w">    </span>interval<span class="w"> </span><span class="m">2</span>
</span><span id="__span-24-147"><a id="__codelineno-24-147" name="__codelineno-24-147" href="#__codelineno-24-147"></a><span class="w">    </span>weight<span class="w"> </span><span class="m">10</span><span class="w">             </span><span class="c1">#脚本执行返回值 =0 ，优先级加 10。 !=0 时优先级不变。</span>
</span><span id="__span-24-148"><a id="__codelineno-24-148" name="__codelineno-24-148" href="#__codelineno-24-148"></a><span class="o">}</span>
</span><span id="__span-24-149"><a id="__codelineno-24-149" name="__codelineno-24-149" href="#__codelineno-24-149"></a>
</span><span id="__span-24-150"><a id="__codelineno-24-150" name="__codelineno-24-150" href="#__codelineno-24-150"></a><span class="c1"># 简易检测</span>
</span><span id="__span-24-151"><a id="__codelineno-24-151" name="__codelineno-24-151" href="#__codelineno-24-151"></a>vrrp_script<span class="w"> </span>check_run<span class="w"> </span><span class="o">{</span>
</span><span id="__span-24-152"><a id="__codelineno-24-152" name="__codelineno-24-152" href="#__codelineno-24-152"></a><span class="w">        </span>script<span class="w"> </span><span class="s2">&quot;/etc/keepalived/mysql_check.sh&quot;</span>
</span><span id="__span-24-153"><a id="__codelineno-24-153" name="__codelineno-24-153" href="#__codelineno-24-153"></a><span class="w">        </span>interval<span class="w"> </span><span class="m">5</span><span class="w">                              </span><span class="c1">#5秒执行一次脚本</span>
</span><span id="__span-24-154"><a id="__codelineno-24-154" name="__codelineno-24-154" href="#__codelineno-24-154"></a><span class="o">}</span>
</span><span id="__span-24-155"><a id="__codelineno-24-155" name="__codelineno-24-155" href="#__codelineno-24-155"></a>
</span><span id="__span-24-156"><a id="__codelineno-24-156" name="__codelineno-24-156" href="#__codelineno-24-156"></a>vrrp_instance<span class="w"> </span>VI_1<span class="w"> </span><span class="o">{</span>
</span><span id="__span-24-157"><a id="__codelineno-24-157" name="__codelineno-24-157" href="#__codelineno-24-157"></a><span class="w">    </span>state<span class="w"> </span>MASTER<span class="w">          </span><span class="c1">#指定实例初始状态，实际的MASTER和BACKUP是选举决定的。</span>
</span><span id="__span-24-158"><a id="__codelineno-24-158" name="__codelineno-24-158" href="#__codelineno-24-158"></a><span class="w">    </span>interface<span class="w"> </span>eth0<span class="w">        </span><span class="c1">#指定实例绑定的网卡</span>
</span><span id="__span-24-159"><a id="__codelineno-24-159" name="__codelineno-24-159" href="#__codelineno-24-159"></a><span class="w">    </span>virtual_router_id<span class="w"> </span><span class="m">88</span><span class="w">  </span><span class="c1">#设置VRID标记(0..255)</span>
</span><span id="__span-24-160"><a id="__codelineno-24-160" name="__codelineno-24-160" href="#__codelineno-24-160"></a><span class="w">    </span>priority<span class="w"> </span><span class="m">100</span><span class="w">          </span><span class="c1">#设置优先级，优先级高的会被竞选为Master</span>
</span><span id="__span-24-161"><a id="__codelineno-24-161" name="__codelineno-24-161" href="#__codelineno-24-161"></a><span class="w">    </span>advert_int<span class="w"> </span><span class="m">1</span><span class="w">          </span><span class="c1">#检查的时间间隔，默认1s</span>
</span><span id="__span-24-162"><a id="__codelineno-24-162" name="__codelineno-24-162" href="#__codelineno-24-162"></a><span class="w">    </span>authentication<span class="w"> </span><span class="o">{</span><span class="w">      </span><span class="c1">#节点间的认证，所有的必须一致</span>
</span><span id="__span-24-163"><a id="__codelineno-24-163" name="__codelineno-24-163" href="#__codelineno-24-163"></a><span class="w">        </span>auth_type<span class="w"> </span>PASS
</span><span id="__span-24-164"><a id="__codelineno-24-164" name="__codelineno-24-164" href="#__codelineno-24-164"></a><span class="w">        </span>auth_pass<span class="w"> </span><span class="m">1111</span>
</span><span id="__span-24-165"><a id="__codelineno-24-165" name="__codelineno-24-165" href="#__codelineno-24-165"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-24-166"><a id="__codelineno-24-166" name="__codelineno-24-166" href="#__codelineno-24-166"></a>
</span><span id="__span-24-167"><a id="__codelineno-24-167" name="__codelineno-24-167" href="#__codelineno-24-167"></a><span class="w">    </span>virtual_ipaddress<span class="w"> </span><span class="o">{</span><span class="w">       </span><span class="c1">#设置VIP，可以设置多个，用于切换时的地址绑定。</span>
</span><span id="__span-24-168"><a id="__codelineno-24-168" name="__codelineno-24-168" href="#__codelineno-24-168"></a><span class="w">            </span>VIP<span class="w">               </span><span class="c1"># VIP地址（该ip为虚拟出来的vip地址)</span>
</span><span id="__span-24-169"><a id="__codelineno-24-169" name="__codelineno-24-169" href="#__codelineno-24-169"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-24-170"><a id="__codelineno-24-170" name="__codelineno-24-170" href="#__codelineno-24-170"></a>
</span><span id="__span-24-171"><a id="__codelineno-24-171" name="__codelineno-24-171" href="#__codelineno-24-171"></a><span class="w">    </span>track_script<span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="c1">#指定前面脚本的名字</span>
</span><span id="__span-24-172"><a id="__codelineno-24-172" name="__codelineno-24-172" href="#__codelineno-24-172"></a><span class="w">        </span><span class="c1"># check_run</span>
</span><span id="__span-24-173"><a id="__codelineno-24-173" name="__codelineno-24-173" href="#__codelineno-24-173"></a><span class="w">        </span>chk_mysql
</span><span id="__span-24-174"><a id="__codelineno-24-174" name="__codelineno-24-174" href="#__codelineno-24-174"></a><span class="w">        </span>chk_mysql_master
</span><span id="__span-24-175"><a id="__codelineno-24-175" name="__codelineno-24-175" href="#__codelineno-24-175"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-24-176"><a id="__codelineno-24-176" name="__codelineno-24-176" href="#__codelineno-24-176"></a><span class="o">}</span>
</span></code></pre></div>
</details>
<details class="info">
<summary>chk_mysql.sh</summary>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="o">[</span>root@node3<span class="w"> </span>work<span class="o">]</span><span class="c1"># cat /etc/keepalived/chk_mysql.sh</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="c1">#!/bin/bash</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>mysql<span class="w"> </span>--defaults-file<span class="o">=</span>/root/.my.cnf<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;show status&quot;</span><span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="p">;</span><span class="k">then</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">    </span>systemctl<span class="w"> </span>stop<span class="w"> </span>keepalived
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="k">fi</span>
</span></code></pre></div>
</details>
<details class="info">
<summary>chk_mysql_master.sh</summary>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="o">[</span>root@node3<span class="w"> </span>work<span class="o">]</span><span class="c1"># cat /etc/keepalived/chk_mysql_master.sh</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="c1">#!/bin/bash</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="nv">PATH</span><span class="o">=</span>/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="nb">export</span><span class="w"> </span>PATH
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="nv">priuuid</span><span class="o">=</span><span class="sb">`</span>mysql<span class="w"> </span>--defaults-file<span class="o">=</span>/root/.my.cnf<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;SELECT * FROM performance_schema.replication_group_members WHERE MEMBER_ID = (SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME= &#39;group_replication_primary_member&#39;)&quot;</span><span class="w"> </span><span class="p">|</span>awk<span class="w"> </span><span class="s1">&#39;NR==2{print}&#39;</span><span class="p">|</span>awk<span class="w"> </span>-F<span class="s2">&quot; &quot;</span><span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="sb">`</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="nv">uuid</span><span class="o">=</span><span class="sb">`</span>mysql<span class="w"> </span>--defaults-file<span class="o">=</span>/root/.my.cnf<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;select @@global.server_uuid&quot;</span><span class="w"> </span><span class="p">|</span>awk<span class="w"> </span><span class="s1">&#39;NR==2{print}&#39;</span><span class="sb">`</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$priuuid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$uuid</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="k">else</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="k">fi</span>
</span></code></pre></div>
</details>
<h3 id="mysqldmysql">mysqld/mysqlサーバが落ちた場合の復旧手順<a class="headerlink" href="#mysqldmysql" title="Permanent link">&para;</a></h3>
<h5 id="mgr_1">落ちたサーバをMGRに参加する<a class="headerlink" href="#mgr_1" title="Permanent link">&para;</a></h5>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="o">#</span><span class="w"> </span><span class="n">mysqldを先に起動する</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="p">[</span><span class="n">root</span><span class="o">@</span><span class="n">node3</span><span class="w"> </span><span class="o">~</span><span class="p">]</span><span class="o">#</span><span class="w"> </span><span class="n">systemctl</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="n">mysqld</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="o">#</span><span class="w"> </span><span class="n">mysql起動後</span><span class="err">、状況確認</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="mi">03</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">46</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="p">,</span><span class="n">MEMBER_HOST</span><span class="p">,</span><span class="n">MEMBER_STATE</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="p">;</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="o">+</span><span class="c1">-----------+-------------+--------------+-------------+</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="o">+</span><span class="c1">-----------+-------------+--------------+-------------+</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="o">|</span><span class="w">           </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">OFFLINE</span><span class="w">      </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="o">+</span><span class="c1">-----------+-------------+--------------+-------------+</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="o">#</span><span class="w"> </span><span class="n">mysql起動後</span><span class="err">、該当</span><span class="n">mysqlをMGRに参加させる</span><span class="err">。</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="mi">03</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">48</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="n">group_replication</span><span class="p">;</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">.</span><span class="mi">75</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a><span class="o">#</span><span class="w"> </span><span class="n">MGRに確認</span>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a><span class="mi">03</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">52</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="p">,</span><span class="n">MEMBER_HOST</span><span class="p">,</span><span class="n">MEMBER_STATE</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="p">;</span>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="w">                            </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="n">ba497e</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">e8e</span><span class="o">-</span><span class="mi">5254007</span><span class="n">b60ca</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node2</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a><span class="o">|</span><span class="w"> </span><span class="n">d7239f8c</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="n">aeeb</span><span class="o">-</span><span class="mi">525400</span><span class="n">c72882</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node3</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">RECOVERING</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-27-24"><a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a><span class="o">|</span><span class="w"> </span><span class="n">defba275</span><span class="o">-</span><span class="n">f2ef</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">eae</span><span class="o">-</span><span class="mi">525400</span><span class="n">e752a2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node1</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">     </span><span class="o">|</span>
</span><span id="__span-27-25"><a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-27-26"><a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-27-27"><a id="__codelineno-27-27" name="__codelineno-27-27" href="#__codelineno-27-27"></a>
</span><span id="__span-27-28"><a id="__codelineno-27-28" name="__codelineno-27-28" href="#__codelineno-27-28"></a><span class="o">#</span><span class="w"> </span><span class="err">しばらくと</span><span class="n">RECOVERINGからONLINEになる</span>
</span><span id="__span-27-29"><a id="__codelineno-27-29" name="__codelineno-27-29" href="#__codelineno-27-29"></a><span class="mi">03</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">47</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="p">,</span><span class="n">MEMBER_HOST</span><span class="p">,</span><span class="n">MEMBER_STATE</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="p">;</span>
</span><span id="__span-27-30"><a id="__codelineno-27-30" name="__codelineno-27-30" href="#__codelineno-27-30"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-27-31"><a id="__codelineno-27-31" name="__codelineno-27-31" href="#__codelineno-27-31"></a><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="w">                            </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-27-32"><a id="__codelineno-27-32" name="__codelineno-27-32" href="#__codelineno-27-32"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-27-33"><a id="__codelineno-27-33" name="__codelineno-27-33" href="#__codelineno-27-33"></a><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="n">ba497e</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">e8e</span><span class="o">-</span><span class="mi">5254007</span><span class="n">b60ca</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node2</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-27-34"><a id="__codelineno-27-34" name="__codelineno-27-34" href="#__codelineno-27-34"></a><span class="o">|</span><span class="w"> </span><span class="n">d7239f8c</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="n">aeeb</span><span class="o">-</span><span class="mi">525400</span><span class="n">c72882</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node3</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-27-35"><a id="__codelineno-27-35" name="__codelineno-27-35" href="#__codelineno-27-35"></a><span class="o">|</span><span class="w"> </span><span class="n">defba275</span><span class="o">-</span><span class="n">f2ef</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">eae</span><span class="o">-</span><span class="mi">525400</span><span class="n">e752a2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node1</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">     </span><span class="o">|</span>
</span><span id="__span-27-36"><a id="__codelineno-27-36" name="__codelineno-27-36" href="#__codelineno-27-36"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-27-37"><a id="__codelineno-27-37" name="__codelineno-27-37" href="#__codelineno-27-37"></a><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-27-38"><a id="__codelineno-27-38" name="__codelineno-27-38" href="#__codelineno-27-38"></a>
</span><span id="__span-27-39"><a id="__codelineno-27-39" name="__codelineno-27-39" href="#__codelineno-27-39"></a><span class="mi">03</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">05</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span></code></pre></div>
<h4 id="_7">起動順番<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h4>
<ol>
<li>mysqlをMGRに参加させる</li>
<li>keepalivedを起動する</li>
</ol>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># ONLINEになった後、keepalivedを起動する</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="o">[</span>root@node3<span class="w"> </span>~<span class="o">]</span><span class="c1"># systemctl start keepalived.service</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="c1"># 起動後status確認する</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="o">[</span>root@node3<span class="w"> </span>~<span class="o">]</span><span class="c1"># systemctl status keepalived.service</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>●<span class="w"> </span>keepalived.service<span class="w"> </span>-<span class="w"> </span>LVS<span class="w"> </span>and<span class="w"> </span>VRRP<span class="w"> </span>High<span class="w"> </span>Availability<span class="w"> </span>Monitor
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">   </span>Loaded:<span class="w"> </span>loaded<span class="w"> </span><span class="o">(</span>/usr/lib/systemd/system/keepalived.service<span class="p">;</span><span class="w"> </span>enabled<span class="p">;</span><span class="w"> </span>vendor<span class="w"> </span>preset:<span class="w"> </span>disabled<span class="o">)</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">   </span>Active:<span class="w"> </span>active<span class="w"> </span><span class="o">(</span>running<span class="o">)</span><span class="w"> </span>since<span class="w"> </span>Fri<span class="w"> </span><span class="m">2023</span>-05-19<span class="w"> </span><span class="m">15</span>:15:27<span class="w"> </span>JST<span class="p">;</span><span class="w"> </span>7min<span class="w"> </span>ago
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">  </span>Process:<span class="w"> </span><span class="m">3765</span><span class="w"> </span><span class="nv">ExecStart</span><span class="o">=</span>/usr/sbin/keepalived<span class="w"> </span><span class="nv">$KEEPALIVED_OPTIONS</span><span class="w"> </span><span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited,<span class="w"> </span><span class="nv">status</span><span class="o">=</span><span class="m">0</span>/SUCCESS<span class="o">)</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w"> </span>Main<span class="w"> </span>PID:<span class="w"> </span><span class="m">3766</span><span class="w"> </span><span class="o">(</span>keepalived<span class="o">)</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">    </span>Tasks:<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">(</span>limit:<span class="w"> </span><span class="m">1031248</span><span class="o">)</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">   </span>Memory:<span class="w"> </span><span class="m">2</span>.7M
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="w">   </span>CGroup:<span class="w"> </span>/system.slice/keepalived.service
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="w">           </span>├─3766<span class="w"> </span>/usr/sbin/keepalived<span class="w"> </span>-D
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="w">           </span>└─3767<span class="w"> </span>/usr/sbin/keepalived<span class="w"> </span>-D
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>May<span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="m">15</span>:15:27<span class="w"> </span>node3<span class="w"> </span>systemd<span class="o">[</span><span class="m">1</span><span class="o">]</span>:<span class="w"> </span>Starting<span class="w"> </span>LVS<span class="w"> </span>and<span class="w"> </span>VRRP<span class="w"> </span>High<span class="w"> </span>Availability<span class="w"> </span>Monitor...
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>May<span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="m">15</span>:15:27<span class="w"> </span>node3<span class="w"> </span>systemd<span class="o">[</span><span class="m">1</span><span class="o">]</span>:<span class="w"> </span>Started<span class="w"> </span>LVS<span class="w"> </span>and<span class="w"> </span>VRRP<span class="w"> </span>High<span class="w"> </span>Availability<span class="w"> </span>Monitor.
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a><span class="o">[</span>root@node3<span class="w"> </span>~<span class="o">]</span><span class="c1">#</span>
</span></code></pre></div>
<h2 id="clone">clone<a class="headerlink" href="#clone" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://dev.mysql.com/doc/refman/8.0/ja/clone-plugin-remote.html">リモートデータのクローニング</a></li>
</ul>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">CLONE</span><span class="w"> </span><span class="n">INSTANCE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="o">@</span><span class="s1">&#39;host&#39;</span><span class="p">:</span><span class="n">port</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;password&#39;</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="p">[</span><span class="k">DATA</span><span class="w"> </span><span class="n">DIRECTORY</span><span class="w"> </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="s1">&#39;clone_dir&#39;</span><span class="p">]</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="p">[</span><span class="n">REQUIRE</span><span class="w"> </span><span class="p">[</span><span class="k">NO</span><span class="p">]</span><span class="w"> </span><span class="n">SSL</span><span class="p">];</span>
</span></code></pre></div>
<ul>
<li><code>user</code> は、ドナー MySQL サーバーインスタンス上のクローンユーザーです。</li>
<li><code>password</code> は user のパスワードです。</li>
<li><code>host</code> は、ドナー MySQL サーバーインスタンスの hostname アドレスです。 インターネットプロトコルバージョン 6 (IPv6) アドレス形式はサポートされていません。 かわりに、IPv6 アドレスのエイリアスを使用できます。 IPv4 アドレスはそのまま使用できます。</li>
<li><code>port</code> は、ドナー MySQL サーバーインスタンスの port 番号です。 (mysqlx_port で指定された X プロトコル ポートはサポートされていません。 MySQL Router を介したドナー MySQL サーバーインスタンスへの接続もサポートされていません。)</li>
<li><code>DATA DIRECTORY [=] 'clone_dir'</code>は、クローニングするデータの受信者上のディレクトリを指定するために使用するオプションの句です。 このオプションは、受信者データディレクトリ内の既存のデータを削除しない場合に使用します。 絶対パスが必要であり、ディレクトリが存在していない必要があります。 MySQL サーバーには、ディレクトリの作成に必要な書込みアクセス権が必要です。<br />
オプションの <code>DATA DIRECTORY [=] 'clone_dir'</code>句を<strong>使用しない</strong>場合、クローニング操作では、<strong>受信者データディレクトリ内の既存のデータが削除され、クローニングされたデータに置き換えられ、その後サーバーが自動的に再起動されます</strong>。</li>
<li><code>[REQUIRE [NO] SSL]</code>は、クローニングされたデータをネットワーク経由で転送するときに、暗号化された接続を使用するかどうかを明示的に指定します。 明示的な指定が満たされない場合は、エラーが返されます。 SSL 句が指定されていない場合、クローンはデフォルトで暗号化された接続を確立しようとし、セキュアな接続試行が失敗した場合はセキュアでない接続にフォールバックします。 暗号化データをクローニングする場合は、この句が指定されているかどうかに関係なく、セキュアな接続が必要です。 詳細は、クローニング用の暗号化された接続の構成を参照してください。</li>
</ul>
<details class="note">
<summary>注記</summary>
<ul>
<li>デフォルトでは、ドナー MySQL サーバーインスタンスのデータディレクトリに存在するユーザー作成の InnoDB テーブルおよびテーブルスペースは、受信者 MySQL サーバーインスタンスのデータディレクトリにクローニングされます。 DATA DIRECTORY [=] 'clone_dir'句を指定すると、指定したディレクトリにクローニングされます。</li>
<li>ドナー MySQL サーバーインスタンスのデータディレクトリ外にあるユーザー作成の InnoDB テーブルおよびテーブルスペースは、受信者 MySQL サーバーインスタンスの同じパスにクローニングされます。 テーブルまたはテーブルスペースがすでに存在する場合は、エラーが報告されます。</li>
<li>デフォルトでは、InnoDB システムテーブルスペース、redo ログおよび undo テーブルスペースは、ドナーに構成されているのと同じ場所にクローニングされます (それぞれ、innodb_data_home_dir および innodb_data_file_path、innodb_log_group_home_dir および innodb_undo_directory で定義されています)。 DATA DIRECTORY [=] 'clone_dir'句が指定されている場合、これらのテーブルスペースおよびログは指定されたディレクトリにクローニングされます。</li>
</ul>
</details>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="p">[</span><span class="n">root</span><span class="o">@</span><span class="n">node1</span><span class="w"> </span><span class="n">backup</span><span class="p">]</span><span class="o">#</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">my</span><span class="p">.</span><span class="n">cnf</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="n">plugin</span><span class="o">-</span><span class="k">load</span><span class="o">=</span><span class="n">mysql_clone</span><span class="p">.</span><span class="n">so</span><span class="p">;</span><span class="n">group_replication</span><span class="p">.</span><span class="n">so</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="p">[</span><span class="n">root</span><span class="o">@</span><span class="n">node1</span><span class="w"> </span><span class="n">backup</span><span class="p">]</span><span class="o">#</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="mi">05</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">23</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">plugin_name</span><span class="p">,</span><span class="w"> </span><span class="n">plugin_status</span><span class="p">,</span><span class="w"> </span><span class="n">plugin_type</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">plugins</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">plugin_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;clone&#39;</span><span class="p">;</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="o">+</span><span class="c1">-------------+---------------+-------------+</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="o">|</span><span class="w"> </span><span class="n">plugin_name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">plugin_status</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">plugin_type</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="o">+</span><span class="c1">-------------+---------------+-------------+</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="o">|</span><span class="w"> </span><span class="n">clone</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ACTIVE</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">CLONE</span><span class="w">       </span><span class="o">|</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="o">+</span><span class="c1">-------------+---------------+-------------+</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="mi">05</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">24</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">clone_valid_donor_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;xx.yyy.zzz.2:3306&#39;</span><span class="p">;</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a><span class="o">#</span><span class="w"> </span><span class="k">DATA</span><span class="w"> </span><span class="n">DIRECTORY</span><span class="w"> </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="s1">&#39;clone_dir&#39;</span><span class="err">句を使用しないため、そのまま受信者データディレクトリ内の既存のデータが削除され、クローニングされたデータに置き換えられる</span>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CLONE</span><span class="w"> </span><span class="n">INSTANCE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s1">&#39;repl_user&#39;</span><span class="o">@</span><span class="s1">&#39;xx.yyy.zzz.2&#39;</span><span class="p">:</span><span class="mi">3306</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">;</span>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a><span class="o">#</span><span class="w"> </span><span class="k">DATA</span><span class="w"> </span><span class="n">DIRECTORY</span><span class="w"> </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="s1">&#39;clone_dir&#39;</span><span class="err">句を使用したため、受信者の指定データディレクトリ内にクローニングされる</span>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CLONE</span><span class="w"> </span><span class="k">LOCAL</span><span class="w"> </span><span class="k">DATA</span><span class="w"> </span><span class="n">DIRECTORY</span><span class="w"> </span><span class="s1">&#39;/home/mysql/cloned_data/&#39;</span>
</span></code></pre></div>
<details class="example">
<summary>clone 検証</summary>
<ul>
<li>本来はclone専用ユーザで実行するべきですが、検証のため、rootで検証いたします。</li>
<li>前提条件として新規サーバをMGRに参加するため、事前にデータを同期する。</li>
<li><code>DATA DIRECTORY [=] 'clone_dir'</code>句を使用しないため、そのまま受信者データディレクトリ内の既存のデータが削除され、クローニングされたデータに置き換えられ、その後サーバーが自動的に再起動されます</li>
<li>イメージ: <code>node1</code>(ドナー) から <code>node2</code>(受信者/コピー先) へデータ同期する
<div class="language-sql highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="o">#</span><span class="w"> </span><span class="n">node2</span><span class="w"> </span><span class="err">を確認する</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="mi">05</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">29</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="p">,</span><span class="n">MEMBER_HOST</span><span class="p">,</span><span class="n">MEMBER_STATE</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="p">;</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="w">                            </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="n">ba497e</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">e8e</span><span class="o">-</span><span class="mi">5254007</span><span class="n">b60ca</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node2</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="o">|</span><span class="w"> </span><span class="n">d7239f8c</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="n">aeeb</span><span class="o">-</span><span class="mi">525400</span><span class="n">c72882</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node3</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="o">|</span><span class="w"> </span><span class="n">defba275</span><span class="o">-</span><span class="n">f2ef</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">eae</span><span class="o">-</span><span class="mi">525400</span><span class="n">e752a2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node1</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">     </span><span class="o">|</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="o">#</span><span class="w"> </span><span class="n">node2</span><span class="w"> </span><span class="err">を</span><span class="n">MGRから外す</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="mi">05</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">44</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">group_replication</span><span class="p">;</span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">.</span><span class="mi">18</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a><span class="o">#</span><span class="w"> </span><span class="n">node2</span><span class="w"> </span><span class="err">を確認する</span>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a><span class="mi">05</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">54</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="p">,</span><span class="n">MEMBER_HOST</span><span class="p">,</span><span class="n">MEMBER_STATE</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="p">;</span>
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="w">                            </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="n">ba497e</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">e8e</span><span class="o">-</span><span class="mi">5254007</span><span class="n">b60ca</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node2</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">OFFLINE</span><span class="w">      </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
</span><span id="__span-31-22"><a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-31-23"><a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-31-24"><a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a>
</span><span id="__span-31-25"><a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a><span class="mi">05</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">56</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span><span id="__span-31-26"><a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a>
</span><span id="__span-31-27"><a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a><span class="o">#</span><span class="w"> </span><span class="err">ドナー</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span><span class="err">から受信者</span><span class="p">(</span><span class="n">node2</span><span class="p">)</span><span class="err">へデータを受信する</span>
</span><span id="__span-31-28"><a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a><span class="mi">05</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">28</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">clone_valid_donor_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;xx.yyy.zzz.1:3306&#39;</span><span class="p">;</span>
</span><span id="__span-31-29"><a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-31-30"><a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a>
</span><span id="__span-31-31"><a id="__codelineno-31-31" name="__codelineno-31-31" href="#__codelineno-31-31"></a><span class="mi">05</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">33</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">@@</span><span class="n">clone_valid_donor_list</span><span class="p">;</span>
</span><span id="__span-31-32"><a id="__codelineno-31-32" name="__codelineno-31-32" href="#__codelineno-31-32"></a><span class="o">+</span><span class="c1">--------------------------+</span>
</span><span id="__span-31-33"><a id="__codelineno-31-33" name="__codelineno-31-33" href="#__codelineno-31-33"></a><span class="o">|</span><span class="w"> </span><span class="o">@@</span><span class="n">clone_valid_donor_list</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-31-34"><a id="__codelineno-31-34" name="__codelineno-31-34" href="#__codelineno-31-34"></a><span class="o">+</span><span class="c1">--------------------------+</span>
</span><span id="__span-31-35"><a id="__codelineno-31-35" name="__codelineno-31-35" href="#__codelineno-31-35"></a><span class="o">|</span><span class="w"> </span><span class="n">xx</span><span class="p">.</span><span class="n">yyy</span><span class="p">.</span><span class="n">zzz</span><span class="p">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">3306</span><span class="w">        </span><span class="o">|</span>
</span><span id="__span-31-36"><a id="__codelineno-31-36" name="__codelineno-31-36" href="#__codelineno-31-36"></a><span class="o">+</span><span class="c1">--------------------------+</span>
</span><span id="__span-31-37"><a id="__codelineno-31-37" name="__codelineno-31-37" href="#__codelineno-31-37"></a><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-31-38"><a id="__codelineno-31-38" name="__codelineno-31-38" href="#__codelineno-31-38"></a>
</span><span id="__span-31-39"><a id="__codelineno-31-39" name="__codelineno-31-39" href="#__codelineno-31-39"></a><span class="mi">05</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">39</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CLONE</span><span class="w"> </span><span class="n">INSTANCE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="o">@</span><span class="s1">&#39;xx.yyy.zzz.1&#39;</span><span class="p">:</span><span class="mi">3306</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">;</span>
</span><span id="__span-31-40"><a id="__codelineno-31-40" name="__codelineno-31-40" href="#__codelineno-31-40"></a><span class="n">ERROR</span><span class="w"> </span><span class="mi">1290</span><span class="w"> </span><span class="p">(</span><span class="n">HY000</span><span class="p">):</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="c1">--super-read-only option so it cannot execute this statement</span>
</span><span id="__span-31-41"><a id="__codelineno-31-41" name="__codelineno-31-41" href="#__codelineno-31-41"></a><span class="mi">05</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">59</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span><span id="__span-31-42"><a id="__codelineno-31-42" name="__codelineno-31-42" href="#__codelineno-31-42"></a>
</span><span id="__span-31-43"><a id="__codelineno-31-43" name="__codelineno-31-43" href="#__codelineno-31-43"></a><span class="o">#</span><span class="w"> </span><span class="n">MGRから外れたのためread</span><span class="o">-</span><span class="n">onlyのままです</span><span class="err">。</span><span class="n">mysqldを再起動する必要です</span><span class="err">。</span>
</span><span id="__span-31-44"><a id="__codelineno-31-44" name="__codelineno-31-44" href="#__codelineno-31-44"></a><span class="mi">05</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">20</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="k">global</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">Variable_name</span><span class="w">  </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%hostname%&#39;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">Variable_name</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%read_only%&#39;</span><span class="p">;</span>
</span><span id="__span-31-45"><a id="__codelineno-31-45" name="__codelineno-31-45" href="#__codelineno-31-45"></a><span class="o">+</span><span class="c1">-----------------------+-------+</span>
</span><span id="__span-31-46"><a id="__codelineno-31-46" name="__codelineno-31-46" href="#__codelineno-31-46"></a><span class="o">|</span><span class="w"> </span><span class="n">Variable_name</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-31-47"><a id="__codelineno-31-47" name="__codelineno-31-47" href="#__codelineno-31-47"></a><span class="o">+</span><span class="c1">-----------------------+-------+</span>
</span><span id="__span-31-48"><a id="__codelineno-31-48" name="__codelineno-31-48" href="#__codelineno-31-48"></a><span class="o">|</span><span class="w"> </span><span class="n">hostname</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">node2</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-31-49"><a id="__codelineno-31-49" name="__codelineno-31-49" href="#__codelineno-31-49"></a><span class="o">|</span><span class="w"> </span><span class="n">innodb_read_only</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">OFF</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-31-50"><a id="__codelineno-31-50" name="__codelineno-31-50" href="#__codelineno-31-50"></a><span class="o">|</span><span class="w"> </span><span class="n">read_only</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">ON</span><span class="w">    </span><span class="o">|</span>
</span><span id="__span-31-51"><a id="__codelineno-31-51" name="__codelineno-31-51" href="#__codelineno-31-51"></a><span class="o">|</span><span class="w"> </span><span class="n">super_read_only</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">ON</span><span class="w">    </span><span class="o">|</span>
</span><span id="__span-31-52"><a id="__codelineno-31-52" name="__codelineno-31-52" href="#__codelineno-31-52"></a><span class="o">|</span><span class="w"> </span><span class="n">transaction_read_only</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">OFF</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-31-53"><a id="__codelineno-31-53" name="__codelineno-31-53" href="#__codelineno-31-53"></a><span class="o">+</span><span class="c1">-----------------------+-------+</span>
</span><span id="__span-31-54"><a id="__codelineno-31-54" name="__codelineno-31-54" href="#__codelineno-31-54"></a>
</span><span id="__span-31-55"><a id="__codelineno-31-55" name="__codelineno-31-55" href="#__codelineno-31-55"></a><span class="o">#</span><span class="w"> </span><span class="n">mysqldを再起動する</span>
</span><span id="__span-31-56"><a id="__codelineno-31-56" name="__codelineno-31-56" href="#__codelineno-31-56"></a><span class="p">[</span><span class="n">root</span><span class="o">@</span><span class="n">node2</span><span class="w"> </span><span class="o">~</span><span class="p">]</span><span class="o">#</span><span class="w"> </span><span class="n">systemctl</span><span class="w"> </span><span class="k">restart</span><span class="w"> </span><span class="n">mysqld</span>
</span><span id="__span-31-57"><a id="__codelineno-31-57" name="__codelineno-31-57" href="#__codelineno-31-57"></a>
</span><span id="__span-31-58"><a id="__codelineno-31-58" name="__codelineno-31-58" href="#__codelineno-31-58"></a><span class="o">#</span><span class="w"> </span><span class="k">read</span><span class="o">-</span><span class="n">onlyモードではなくなりました</span><span class="err">。</span>
</span><span id="__span-31-59"><a id="__codelineno-31-59" name="__codelineno-31-59" href="#__codelineno-31-59"></a><span class="mi">05</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">01</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="k">global</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">Variable_name</span><span class="w">  </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%hostname%&#39;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">Variable_name</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%read_only%&#39;</span><span class="p">;</span>
</span><span id="__span-31-60"><a id="__codelineno-31-60" name="__codelineno-31-60" href="#__codelineno-31-60"></a><span class="o">+</span><span class="c1">-----------------------+-------+</span>
</span><span id="__span-31-61"><a id="__codelineno-31-61" name="__codelineno-31-61" href="#__codelineno-31-61"></a><span class="o">|</span><span class="w"> </span><span class="n">Variable_name</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-31-62"><a id="__codelineno-31-62" name="__codelineno-31-62" href="#__codelineno-31-62"></a><span class="o">+</span><span class="c1">-----------------------+-------+</span>
</span><span id="__span-31-63"><a id="__codelineno-31-63" name="__codelineno-31-63" href="#__codelineno-31-63"></a><span class="o">|</span><span class="w"> </span><span class="n">hostname</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">node2</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-31-64"><a id="__codelineno-31-64" name="__codelineno-31-64" href="#__codelineno-31-64"></a><span class="o">|</span><span class="w"> </span><span class="n">innodb_read_only</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">OFF</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-31-65"><a id="__codelineno-31-65" name="__codelineno-31-65" href="#__codelineno-31-65"></a><span class="o">|</span><span class="w"> </span><span class="n">read_only</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">OFF</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-31-66"><a id="__codelineno-31-66" name="__codelineno-31-66" href="#__codelineno-31-66"></a><span class="o">|</span><span class="w"> </span><span class="n">super_read_only</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">OFF</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-31-67"><a id="__codelineno-31-67" name="__codelineno-31-67" href="#__codelineno-31-67"></a><span class="o">|</span><span class="w"> </span><span class="n">transaction_read_only</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">OFF</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-31-68"><a id="__codelineno-31-68" name="__codelineno-31-68" href="#__codelineno-31-68"></a><span class="o">+</span><span class="c1">-----------------------+-------+</span>
</span><span id="__span-31-69"><a id="__codelineno-31-69" name="__codelineno-31-69" href="#__codelineno-31-69"></a><span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-31-70"><a id="__codelineno-31-70" name="__codelineno-31-70" href="#__codelineno-31-70"></a>
</span><span id="__span-31-71"><a id="__codelineno-31-71" name="__codelineno-31-71" href="#__codelineno-31-71"></a><span class="o">#</span><span class="w"> </span><span class="n">cloneを実行する</span>
</span><span id="__span-31-72"><a id="__codelineno-31-72" name="__codelineno-31-72" href="#__codelineno-31-72"></a><span class="mi">05</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">31</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CLONE</span><span class="w"> </span><span class="n">INSTANCE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="o">@</span><span class="s1">&#39;xx.yyy.zzz.1&#39;</span><span class="p">:</span><span class="mi">3306</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;password&#39;</span><span class="p">;</span>
</span><span id="__span-31-73"><a id="__codelineno-31-73" name="__codelineno-31-73" href="#__codelineno-31-73"></a><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">19</span><span class="p">.</span><span class="mi">61</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-31-74"><a id="__codelineno-31-74" name="__codelineno-31-74" href="#__codelineno-31-74"></a>
</span><span id="__span-31-75"><a id="__codelineno-31-75" name="__codelineno-31-75" href="#__codelineno-31-75"></a><span class="o">#</span><span class="w"> </span><span class="n">cloneのステータスを確認</span>
</span><span id="__span-31-76"><a id="__codelineno-31-76" name="__codelineno-31-76" href="#__codelineno-31-76"></a><span class="mi">05</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">12</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">STATE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">clone_status</span><span class="p">;</span>
</span><span id="__span-31-77"><a id="__codelineno-31-77" name="__codelineno-31-77" href="#__codelineno-31-77"></a><span class="o">+</span><span class="c1">-----------+</span>
</span><span id="__span-31-78"><a id="__codelineno-31-78" name="__codelineno-31-78" href="#__codelineno-31-78"></a><span class="o">|</span><span class="w"> </span><span class="k">STATE</span><span class="w">     </span><span class="o">|</span>
</span><span id="__span-31-79"><a id="__codelineno-31-79" name="__codelineno-31-79" href="#__codelineno-31-79"></a><span class="o">+</span><span class="c1">-----------+</span>
</span><span id="__span-31-80"><a id="__codelineno-31-80" name="__codelineno-31-80" href="#__codelineno-31-80"></a><span class="o">|</span><span class="w"> </span><span class="n">Completed</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-31-81"><a id="__codelineno-31-81" name="__codelineno-31-81" href="#__codelineno-31-81"></a><span class="o">+</span><span class="c1">-----------+</span>
</span><span id="__span-31-82"><a id="__codelineno-31-82" name="__codelineno-31-82" href="#__codelineno-31-82"></a><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-31-83"><a id="__codelineno-31-83" name="__codelineno-31-83" href="#__codelineno-31-83"></a>
</span><span id="__span-31-84"><a id="__codelineno-31-84" name="__codelineno-31-84" href="#__codelineno-31-84"></a><span class="mi">05</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="p">,</span><span class="n">MEMBER_HOST</span><span class="p">,</span><span class="n">MEMBER_STATE</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="p">;</span>
</span><span id="__span-31-85"><a id="__codelineno-31-85" name="__codelineno-31-85" href="#__codelineno-31-85"></a><span class="o">+</span><span class="c1">-----------+-------------+--------------+-------------+</span>
</span><span id="__span-31-86"><a id="__codelineno-31-86" name="__codelineno-31-86" href="#__codelineno-31-86"></a><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-31-87"><a id="__codelineno-31-87" name="__codelineno-31-87" href="#__codelineno-31-87"></a><span class="o">+</span><span class="c1">-----------+-------------+--------------+-------------+</span>
</span><span id="__span-31-88"><a id="__codelineno-31-88" name="__codelineno-31-88" href="#__codelineno-31-88"></a><span class="o">|</span><span class="w">           </span><span class="o">|</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">OFFLINE</span><span class="w">      </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
</span><span id="__span-31-89"><a id="__codelineno-31-89" name="__codelineno-31-89" href="#__codelineno-31-89"></a><span class="o">+</span><span class="c1">-----------+-------------+--------------+-------------+</span>
</span><span id="__span-31-90"><a id="__codelineno-31-90" name="__codelineno-31-90" href="#__codelineno-31-90"></a><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-31-91"><a id="__codelineno-31-91" name="__codelineno-31-91" href="#__codelineno-31-91"></a>
</span><span id="__span-31-92"><a id="__codelineno-31-92" name="__codelineno-31-92" href="#__codelineno-31-92"></a><span class="mi">05</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">45</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">STATE</span><span class="p">,</span><span class="w"> </span><span class="n">ERROR_NO</span><span class="p">,</span><span class="w"> </span><span class="n">ERROR_MESSAGE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">clone_status</span><span class="p">;</span>
</span><span id="__span-31-93"><a id="__codelineno-31-93" name="__codelineno-31-93" href="#__codelineno-31-93"></a><span class="o">+</span><span class="c1">-----------+----------+---------------+</span>
</span><span id="__span-31-94"><a id="__codelineno-31-94" name="__codelineno-31-94" href="#__codelineno-31-94"></a><span class="o">|</span><span class="w"> </span><span class="k">STATE</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">ERROR_NO</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ERROR_MESSAGE</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-31-95"><a id="__codelineno-31-95" name="__codelineno-31-95" href="#__codelineno-31-95"></a><span class="o">+</span><span class="c1">-----------+----------+---------------+</span>
</span><span id="__span-31-96"><a id="__codelineno-31-96" name="__codelineno-31-96" href="#__codelineno-31-96"></a><span class="o">|</span><span class="w"> </span><span class="n">Completed</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">               </span><span class="o">|</span>
</span><span id="__span-31-97"><a id="__codelineno-31-97" name="__codelineno-31-97" href="#__codelineno-31-97"></a><span class="o">+</span><span class="c1">-----------+----------+---------------+</span>
</span><span id="__span-31-98"><a id="__codelineno-31-98" name="__codelineno-31-98" href="#__codelineno-31-98"></a><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-31-99"><a id="__codelineno-31-99" name="__codelineno-31-99" href="#__codelineno-31-99"></a>
</span><span id="__span-31-100"><a id="__codelineno-31-100" name="__codelineno-31-100" href="#__codelineno-31-100"></a><span class="mi">05</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">52</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">STAGE</span><span class="p">,</span><span class="w"> </span><span class="k">STATE</span><span class="p">,</span><span class="w"> </span><span class="n">END_TIME</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">clone_progress</span><span class="p">;</span>
</span><span id="__span-31-101"><a id="__codelineno-31-101" name="__codelineno-31-101" href="#__codelineno-31-101"></a><span class="o">+</span><span class="c1">-----------+-----------+----------------------------+</span>
</span><span id="__span-31-102"><a id="__codelineno-31-102" name="__codelineno-31-102" href="#__codelineno-31-102"></a><span class="o">|</span><span class="w"> </span><span class="n">STAGE</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="k">STATE</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">END_TIME</span><span class="w">                   </span><span class="o">|</span>
</span><span id="__span-31-103"><a id="__codelineno-31-103" name="__codelineno-31-103" href="#__codelineno-31-103"></a><span class="o">+</span><span class="c1">-----------+-----------+----------------------------+</span>
</span><span id="__span-31-104"><a id="__codelineno-31-104" name="__codelineno-31-104" href="#__codelineno-31-104"></a><span class="o">|</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">DATA</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Completed</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">21</span><span class="w"> </span><span class="mi">17</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">41</span><span class="p">.</span><span class="mi">202984</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-31-105"><a id="__codelineno-31-105" name="__codelineno-31-105" href="#__codelineno-31-105"></a><span class="o">|</span><span class="w"> </span><span class="n">FILE</span><span class="w"> </span><span class="k">COPY</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Completed</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">21</span><span class="w"> </span><span class="mi">17</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">58</span><span class="p">.</span><span class="mi">597719</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-31-106"><a id="__codelineno-31-106" name="__codelineno-31-106" href="#__codelineno-31-106"></a><span class="o">|</span><span class="w"> </span><span class="n">PAGE</span><span class="w"> </span><span class="k">COPY</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Completed</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">21</span><span class="w"> </span><span class="mi">17</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">58</span><span class="p">.</span><span class="mi">831569</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-31-107"><a id="__codelineno-31-107" name="__codelineno-31-107" href="#__codelineno-31-107"></a><span class="o">|</span><span class="w"> </span><span class="n">REDO</span><span class="w"> </span><span class="k">COPY</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Completed</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">21</span><span class="w"> </span><span class="mi">17</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">59</span><span class="p">.</span><span class="mi">062794</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-31-108"><a id="__codelineno-31-108" name="__codelineno-31-108" href="#__codelineno-31-108"></a><span class="o">|</span><span class="w"> </span><span class="n">FILE</span><span class="w"> </span><span class="n">SYNC</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Completed</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">21</span><span class="w"> </span><span class="mi">17</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">59</span><span class="p">.</span><span class="mi">283958</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-31-109"><a id="__codelineno-31-109" name="__codelineno-31-109" href="#__codelineno-31-109"></a><span class="o">|</span><span class="w"> </span><span class="k">RESTART</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Completed</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">21</span><span class="w"> </span><span class="mi">17</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">04</span><span class="p">.</span><span class="mi">721238</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-31-110"><a id="__codelineno-31-110" name="__codelineno-31-110" href="#__codelineno-31-110"></a><span class="o">|</span><span class="w"> </span><span class="n">RECOVERY</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Completed</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">21</span><span class="w"> </span><span class="mi">17</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">06</span><span class="p">.</span><span class="mi">078122</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-31-111"><a id="__codelineno-31-111" name="__codelineno-31-111" href="#__codelineno-31-111"></a><span class="o">+</span><span class="c1">-----------+-----------+----------------------------+</span>
</span><span id="__span-31-112"><a id="__codelineno-31-112" name="__codelineno-31-112" href="#__codelineno-31-112"></a><span class="mi">7</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-31-113"><a id="__codelineno-31-113" name="__codelineno-31-113" href="#__codelineno-31-113"></a>
</span><span id="__span-31-114"><a id="__codelineno-31-114" name="__codelineno-31-114" href="#__codelineno-31-114"></a><span class="mi">05</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">56</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span><span id="__span-31-115"><a id="__codelineno-31-115" name="__codelineno-31-115" href="#__codelineno-31-115"></a>
</span><span id="__span-31-116"><a id="__codelineno-31-116" name="__codelineno-31-116" href="#__codelineno-31-116"></a><span class="o">#</span><span class="w"> </span><span class="n">clone完了後</span><span class="err">、</span><span class="n">MGRに参加させる</span>
</span><span id="__span-31-117"><a id="__codelineno-31-117" name="__codelineno-31-117" href="#__codelineno-31-117"></a><span class="mi">05</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">56</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="n">group_replication</span><span class="p">;</span>
</span><span id="__span-31-118"><a id="__codelineno-31-118" name="__codelineno-31-118" href="#__codelineno-31-118"></a><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">.</span><span class="mi">19</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-31-119"><a id="__codelineno-31-119" name="__codelineno-31-119" href="#__codelineno-31-119"></a>
</span><span id="__span-31-120"><a id="__codelineno-31-120" name="__codelineno-31-120" href="#__codelineno-31-120"></a><span class="mi">05</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">59</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="p">,</span><span class="n">MEMBER_HOST</span><span class="p">,</span><span class="n">MEMBER_STATE</span><span class="p">,</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">replication_group_members</span><span class="p">;</span>
</span><span id="__span-31-121"><a id="__codelineno-31-121" name="__codelineno-31-121" href="#__codelineno-31-121"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-31-122"><a id="__codelineno-31-122" name="__codelineno-31-122" href="#__codelineno-31-122"></a><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ID</span><span class="w">                            </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_HOST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_STATE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MEMBER_ROLE</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-31-123"><a id="__codelineno-31-123" name="__codelineno-31-123" href="#__codelineno-31-123"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-31-124"><a id="__codelineno-31-124" name="__codelineno-31-124" href="#__codelineno-31-124"></a><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="n">ba497e</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">e8e</span><span class="o">-</span><span class="mi">5254007</span><span class="n">b60ca</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node2</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-31-125"><a id="__codelineno-31-125" name="__codelineno-31-125" href="#__codelineno-31-125"></a><span class="o">|</span><span class="w"> </span><span class="n">d7239f8c</span><span class="o">-</span><span class="n">f2f1</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="n">aeeb</span><span class="o">-</span><span class="mi">525400</span><span class="n">c72882</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node3</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">SECONDARY</span><span class="w">   </span><span class="o">|</span>
</span><span id="__span-31-126"><a id="__codelineno-31-126" name="__codelineno-31-126" href="#__codelineno-31-126"></a><span class="o">|</span><span class="w"> </span><span class="n">defba275</span><span class="o">-</span><span class="n">f2ef</span><span class="o">-</span><span class="mi">11</span><span class="n">ed</span><span class="o">-</span><span class="mi">9</span><span class="n">eae</span><span class="o">-</span><span class="mi">525400</span><span class="n">e752a2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">node1</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">ONLINE</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">     </span><span class="o">|</span>
</span><span id="__span-31-127"><a id="__codelineno-31-127" name="__codelineno-31-127" href="#__codelineno-31-127"></a><span class="o">+</span><span class="c1">--------------------------------------+-------------+--------------+-------------+</span>
</span><span id="__span-31-128"><a id="__codelineno-31-128" name="__codelineno-31-128" href="#__codelineno-31-128"></a><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-31-129"><a id="__codelineno-31-129" name="__codelineno-31-129" href="#__codelineno-31-129"></a>
</span><span id="__span-31-130"><a id="__codelineno-31-130" name="__codelineno-31-130" href="#__codelineno-31-130"></a><span class="mi">05</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">02</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span></code></pre></div></li>
</ul>
</details>
<h3 id="clone-status">clone status<a class="headerlink" href="#clone-status" title="Permanent link">&para;</a></h3>
<ul>
<li>https://dev.mysql.com/doc/refman/8.0/ja/clone-plugin-replication.html</li>
<li>https://dev.mysql.com/doc/refman/8.0/ja/clone-plugin-monitoring.html</li>
</ul>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="mi">05</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">36</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">STATE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">clone_status</span><span class="p">;</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">Empty</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="mi">05</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">08</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">STATE</span><span class="p">,</span><span class="w"> </span><span class="n">ERROR_NO</span><span class="p">,</span><span class="w"> </span><span class="n">ERROR_MESSAGE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">clone_status</span><span class="p">;</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="n">Empty</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="mi">05</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">12</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">STAGE</span><span class="p">,</span><span class="w"> </span><span class="k">STATE</span><span class="p">,</span><span class="w"> </span><span class="n">END_TIME</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">clone_progress</span><span class="p">;</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="n">Empty</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="mi">05</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">21</span><span class="w"> </span><span class="n">root</span><span class="o">@</span><span class="n">localhost</span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span>
</span></code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2022 - 2023 - lyvivian0077
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tracking", "navigation.top", "navigation.sections", "navigation.indexes", "navigation.path", "toc.integrate", "content.code.copy"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  </body>
</html>