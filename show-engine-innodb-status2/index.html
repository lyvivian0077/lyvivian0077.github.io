
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../show-engine-innodb-status/">
      
      
        <link rel="next" href="../undo-log/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.9">
    
    
      
        <title>innodb status解读2 - 总有刁民想要害朕</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mysqlshow-engine-innodb-status" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="总有刁民想要害朕" class="md-header__button md-logo" aria-label="总有刁民想要害朕" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            总有刁民想要害朕
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              innodb status解读2
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="总有刁民想要害朕" class="md-nav__button md-logo" aria-label="总有刁民想要害朕" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    总有刁民想要害朕
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          ansbile
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          ansbile
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ansbile/" class="md-nav__link">
        ansbileオプション
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ansbile_async/" class="md-nav__link">
        ansbile_async
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../awk/" class="md-nav__link">
        awk
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../sed/" class="md-nav__link">
        sed
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../MB-MiB%E7%9A%84%E5%8C%BA%E5%88%AB/" class="md-nav__link">
        MB_MiB的区别
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          MegaRAID
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          MegaRAID
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../megacli/" class="md-nav__link">
        megacli
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../megaraid/" class="md-nav__link">
        megaraid
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          PostgreSQL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          PostgreSQL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../psql-vs-mysql/" class="md-nav__link">
        MySQLとPostgreSQLコマンド比較表
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../psql-conf/" class="md-nav__link">
        从零开始学PostgreSQL (二)： 配置文件
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          MySQL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          MySQL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql-ssl/" class="md-nav__link">
        MySQL安全SSL介绍
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" class="md-nav__link">
        Explain详解与索引最佳实践
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../server-status-variables/" class="md-nav__link">
        Mysqlサーバーステータス変数
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql/" class="md-nav__link">
        Mysql参数优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../isolation/" class="md-nav__link">
        事务隔离级别
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../show-engine-innodb-status/" class="md-nav__link">
        innodb status解读
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          innodb status解读2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        innodb status解读2
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mysqlshow-engine-innodb-status" class="md-nav__link">
    mysql之show engine innodb status解读（转）
  </a>
  
    <nav class="md-nav" aria-label="mysql之show engine innodb status解读（转）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    第一段是头部信息，它仅仅声明了输出的开始，其内容包括当前的日期和时间，以及自上次输出以来经过的时长。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    后台线程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    信号量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    最近一次外键错误
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    最近一次死锁
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    事务
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#io" class="md-nav__link">
    文件I/O
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert-bufferadaptive-hash-index" class="md-nav__link">
    这部分显示了insert buffer和adaptive hash index两个部分的结构的状态
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#innodb" class="md-nav__link">
    这部分显示了关于innodb事务日志（重做日志）子系统的统计：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#innodb_1" class="md-nav__link">
    这部分显示了其他各项的innodb统计：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../undo-log/" class="md-nav__link">
        undo-log
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../buffer-pool/" class="md-nav__link">
        Buffer-Pool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../my-cnf/" class="md-nav__link">
        mysql5.7性能提升一百倍调优宝典
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql-table/" class="md-nav__link">
        MySQL-table
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql%E3%82%92%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%8B%E3%82%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/" class="md-nav__link">
        MySQLビルド
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql-add-del-user/" class="md-nav__link">
        Mysqlユーザ作成削除
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql-sysbench/" class="md-nav__link">
        Mysql sysbench
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql-dummy/" class="md-nav__link">
        ダミーデータを作成
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql-kill/" class="md-nav__link">
        mysqladmin kill
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        学习笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql8-basic/" class="md-nav__link">
        Mysql8
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_19" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_8_19" id="__nav_8_19_label" tabindex="0">
          MGR
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_19_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8_19">
          <span class="md-nav__icon md-icon"></span>
          MGR
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql-group-replication/" class="md-nav__link">
        3種類のMGR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql-mgr/" class="md-nav__link">
        MGR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql-group-replication-how-to-elect-the-new-primary-node/" class="md-nav__link">
        MGR 如何选举新的主节点
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql-mgr-copy/" class="md-nav__link">
        転載MGR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql-ha/" class="md-nav__link">
        mysql+keepalived搭建教程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql-clone/" class="md-nav__link">
        mysqlクローン機能
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          MySQL DUMP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          MySQL DUMP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysql_backup/" class="md-nav__link">
        Mysql バックアップツール
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mydumper/" class="md-nav__link">
        mydumper
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
          Python Tips
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Python Tips
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python-styleguide/" class="md-nav__link">
        Python风格规范
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python-config/" class="md-nav__link">
        Python程序配置文件管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python-decorator/" class="md-nav__link">
        装饰器
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python-dunder/" class="md-nav__link">
        5种下划线
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python-function/" class="md-nav__link">
        传入参数的几种方法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python/" class="md-nav__link">
        非常规的技巧
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python-mysql/" class="md-nav__link">
        操作mysql基础
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/" class="md-nav__link">
        Re 模块
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E6%80%BB%E7%BB%93/" class="md-nav__link">
        字符串拼接总结
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%E4%B8%80%E8%A1%8C-Python-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%B9%B6%E8%A1%8C/" class="md-nav__link">
        代码并行
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../py-pip/" class="md-nav__link">
        使用 Python Pip 的 10 个技巧
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Regular-Expression/" class="md-nav__link">
        正規表現
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../taged-VLAN%E3%81%A8untagedVLAN%E3%81%AE%E9%81%95%E3%81%84/" class="md-nav__link">
        タグVLAN
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../sar/" class="md-nav__link">
        sar
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/" class="md-nav__link">
        Bash编程超详细语法总结
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
          iptables
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_15">
          <span class="md-nav__icon md-icon"></span>
          iptables
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../iptables/" class="md-nav__link">
        iptables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../iptables_1/" class="md-nav__link">
        iptables概念(1)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../iptables_2/" class="md-nav__link">
        iptables实际操作之规则查询(2)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../iptables_3/" class="md-nav__link">
        iptables规则管理(3)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../iptables_4/" class="md-nav__link">
        iptables匹配条件总结之一(4)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../iptables_5/" class="md-nav__link">
        iptables匹配条件总结之二（常用扩展模块）(5)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../iptables_6/" class="md-nav__link">
        iptables扩展匹配条件之’–tcp-flags’(6)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../iptables_7/" class="md-nav__link">
        iptables扩展之udp扩展与icmp扩展(7)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../iptables_8/" class="md-nav__link">
        iptables扩展模块之state扩展(8)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../iptables_9/" class="md-nav__link">
        iptables的黑白名单机制(9)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../iptables_10/" class="md-nav__link">
        iptables自定义链(10)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../iptables_11/" class="md-nav__link">
        iptables之网络防火墙(11)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../iptables_12/" class="md-nav__link">
        iptables动作总结之一(12)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../iptables_13/" class="md-nav__link">
        iptables动作总结之二(13)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../iptables_14/" class="md-nav__link">
        iptables小结之常用套路(14)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
          virt
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_16">
          <span class="md-nav__icon md-icon"></span>
          virt
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../virt-migrate/" class="md-nav__link">
        KVM迁移
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_17" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_17" id="__nav_17_label" tabindex="0">
          Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_17_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_17">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../centos7-set-kernel/" class="md-nav__link">
        centos7-set-kernel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../centos-network-device-naming/" class="md-nav__link">
        centos-network-device-naming
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux-Performance/" class="md-nav__link">
        Linux Performance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Linux-shell-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6-%E9%80%BB%E8%BE%91%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%A6%E8%A7%A3/" class="md-nav__link">
        Linux-shell-逻辑运算符-逻辑表达式详解
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../busybox/" class="md-nav__link">
        busybox
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linux-img/" class="md-nav__link">
        rocky img 作成
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../osinfo-query/" class="md-nav__link">
        osinfo-query更新
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_18" id="__nav_18_label" tabindex="0">
          LVM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_18_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_18">
          <span class="md-nav__icon md-icon"></span>
          LVM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../LVM%E9%80%BB%E8%BE%91%E5%8D%B7%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8ALVM%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/" class="md-nav__link">
        LVM逻辑卷基本概念及LVM的工作原理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linux-lvm/" class="md-nav__link">
        LVM逻辑卷的建立、扩容和减容
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lvm-snapshot/" class="md-nav__link">
        LVM-snapshot
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../macOS%E8%BD%AF%E4%BB%B6%E7%BC%96%E8%AF%91%E6%97%B6%E6%89%BE%E4%B8%8D%E5%88%B0%E5%A4%B4%E6%96%87%E4%BB%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95-%E6%9B%B4%E6%96%B010-15/" class="md-nav__link">
        macOS软件编译时找不到头文件解决方法[更新10.15]
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ubnt/" class="md-nav__link">
        ubnt
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../vim/" class="md-nav__link">
        VIM
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../teslak20c/" class="md-nav__link">
        Tesla K20c をゲーム用に改造してみた
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../terminal-shortcut/" class="md-nav__link">
        ターミナルを使うためのショートカット集
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_24" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_24" id="__nav_24_label" tabindex="0">
          Zabbix
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_24_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_24">
          <span class="md-nav__icon md-icon"></span>
          Zabbix
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../zabbix6/" class="md-nav__link">
        zabbix6検証
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_25" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_25" id="__nav_25_label" tabindex="0">
          SWAP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_25_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_25">
          <span class="md-nav__icon md-icon"></span>
          SWAP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../swap-find/" class="md-nav__link">
        Swapを使ってるプロセスを探す
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../swap-schema/" class="md-nav__link">
        Swap原理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../swap-linux/" class="md-nav__link">
        Linux内存回收与swap
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../pfctl/" class="md-nav__link">
        pfctlのコマンドを毎回忘れるのでメモ
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_27" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_27" id="__nav_27_label" tabindex="0">
          Prometheus
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_27_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_27">
          <span class="md-nav__icon md-icon"></span>
          Prometheus
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../prometheus/" class="md-nav__link">
        prometheus構築
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mysqld_exporter_flags/" class="md-nav__link">
        mysqld_exporterコレクタFlags
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mysqlshow-engine-innodb-status" class="md-nav__link">
    mysql之show engine innodb status解读（转）
  </a>
  
    <nav class="md-nav" aria-label="mysql之show engine innodb status解读（转）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    第一段是头部信息，它仅仅声明了输出的开始，其内容包括当前的日期和时间，以及自上次输出以来经过的时长。
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    后台线程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    信号量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    最近一次外键错误
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    最近一次死锁
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    事务
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#io" class="md-nav__link">
    文件I/O
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert-bufferadaptive-hash-index" class="md-nav__link">
    这部分显示了insert buffer和adaptive hash index两个部分的结构的状态
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#innodb" class="md-nav__link">
    这部分显示了关于innodb事务日志（重做日志）子系统的统计：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#innodb_1" class="md-nav__link">
    这部分显示了其他各项的innodb统计：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>innodb status解读2</h1>

<h2 id="mysqlshow-engine-innodb-status">mysql之show engine innodb status解读（转）<a class="headerlink" href="#mysqlshow-engine-innodb-status" title="Permanent link">&para;</a></h2>
<ul>
<li>https://www.cnblogs.com/ajianbeyourself/p/6941905.html</li>
</ul>
<p>原文：http://www.lai18.com/content/4734006.html</p>
<p><strong>注：以下内容为根据《高性能mysql第三版》和《mysql技术内幕innodb存储引擎》的innodb status部分的个人理解，如果有错误，还望指正！！</strong></p>
<p>innodb存储引擎在show engine innodb status（老版本对应的是show innodb status）输出中，显示除了大量的内部信息，它输出就是一个单独的字符串，没有行和列，内容分为很多小段，每一段对应innodb存储引擎不同部分的信息，其中有一些信息对于innodb开发者来说非常有用，但是，许多信息，如果你尝试去理解，并且应用到高性能innodb调优的时候，你会发现它们非常有趣，甚至是非常有必要的。</p>
<p>输出内容中包含了一些平均值的统计信息，这些平均值是自上次输出结果生成以来的统计数，因此，如果你正在检查这些值，那就要确保已经等待了至少30s的时间，使两次采样之间的积累足够长的统计时间并多次采样，检查计数器变化从而弄清其行为，并不是所有的输出都会在一个时间点上生成，因而也不是所有的显示出来的平均值会在同一时间间隔里重新再计算。而且，innodb有一个内部复位间隔，而它是不可预知的，各个版本也不一样。</p>
<p>这些输出信息足够提供给手工计算出大多数你想要的统计信息，有一款监控工具innotop可以帮你计算出增量差值和平均值。下面，在你的mysql命令行敲下show engine innodb status;看着输出跟着下面的步骤一步一步理解输出信息是什么含义：</p>
<p><strong>注意：以下使用mysql5.5.24版本做解读，mysql5.6.x和5.7.x输出内容有些地方有调整。</strong></p>
<ol>
<li>
<h4 id="_1">第一段是头部信息，它仅仅声明了输出的开始，其内容包括当前的日期和时间，以及自上次输出以来经过的时长。<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h4>
<ul>
<li>
<details class="note" open="open">
<summary>Note</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="o">=====================================</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="m">160129</span><span class="w"> </span><span class="m">12</span>:07:26<span class="w"> </span>INNODB<span class="w"> </span>MONITOR<span class="w"> </span>OUTPUT<span class="w"> </span><span class="c1"># 第二行是当前日期和时间</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="o">=====================================</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>Per<span class="w"> </span>second<span class="w"> </span>averages<span class="w"> </span>calculated<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>last<span class="w"> </span><span class="m">24</span><span class="w"> </span>seconds<span class="w"> </span><span class="c1"># 第四行显示的是计算出这一平均值的时间间隔，即自上次输出以来的时间，或者是距上次内部复位的时长</span>
</span></code></pre></div></details>
</li>
</ul>
</li>
<li>
<h4 id="_2">后台线程<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h4>
<ul>
<li>
<details class="note" open="open">
<summary>Note</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>从innodb1.0.x开始，可以使用命令show<span class="w"> </span>engine<span class="w"> </span>innodb<span class="w"> </span>status<span class="p">;</span><span class="w"> </span>来查看master<span class="w"> </span>thread的状态信息:
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>-----------------
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>BACKGROUND<span class="w"> </span>THREAD
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>-----------------
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>srv_master_thread<span class="w"> </span>loops:<span class="w"> </span><span class="m">30977173</span><span class="w"> </span>1_second,<span class="w"> </span><span class="m">30975685</span><span class="w"> </span>sleeps,<span class="w"> </span><span class="m">3090359</span><span class="w"> </span>10_second,<span class="w"> </span><span class="m">166112</span><span class="w"> </span>background,<span class="w"> </span><span class="m">165988</span><span class="w"> </span>flush
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="c1"># 这行显示主循环进行了30977173 1_second次，每秒挂起的操作进行了30975685 sleeps次（说明负载不是很大），</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="c1"># 10秒一次的活动进行了3090359 10_second次，1秒循环和10秒循环比值符合1：10，</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="c1"># backgroup loop进行了166112 background次，</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="c1"># flush loop进行了165988 flush次，</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="c1"># 如果在一台很大压力的mysql上，可能看到每秒运行次数和挂起次数比例小于1很多，这是因为innodb对内部进行了一些优化，</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="c1"># 当压力大时间隔时间并不总是等待1秒，因此，不能认为每秒循环和挂起的值总是相等，在某些情况下，可以通过两者之间的差值来比较反映当前数据库的负载压力。</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>srv_master_thread<span class="w"> </span>log<span class="w"> </span>flush<span class="w"> </span>and<span class="w"> </span>writes:<span class="w"> </span><span class="m">31160103</span>
</span></code></pre></div></details>
</li>
</ul>
</li>
<li>
<h4 id="_3">信号量<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h4>
<ul>
<li>
<details class="note" open="open">
<summary>Note</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>----------
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>SEMAPHORES
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>----------
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="c1"># 如果有高并发的工作负载，你就要关注下接下来的段（SEMAPHORES信号量）,</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="c1"># 它包含了两种数据：事件计数器以及可选的当前等待线程的列表，</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="c1"># 如果有性能上的瓶颈，可以使用这些信息来找出瓶颈，不幸的是，想知道怎么使用这些信息还是有一点复杂，下面先给出一些解释：</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>OS<span class="w"> </span>WAIT<span class="w"> </span>ARRAY<span class="w"> </span>INFO:<span class="w"> </span>reservation<span class="w"> </span>count<span class="w"> </span><span class="m">68581015</span>,<span class="w"> </span>signal<span class="w"> </span>count<span class="w"> </span><span class="m">218437328</span><span class="w"> </span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>--Thread<span class="w"> </span><span class="m">140653057947392</span><span class="w"> </span>has<span class="w"> </span>waited<span class="w"> </span>at<span class="w"> </span>btr0pcur.c<span class="w"> </span>line<span class="w"> </span><span class="m">437</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="m">0</span>.00<span class="w"> </span>seconds<span class="w"> </span>the<span class="w"> </span>semaphore:
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>S-lock<span class="w"> </span>on<span class="w"> </span>RW-latch<span class="w"> </span>at<span class="w"> </span>0x7ff536c7d3c0<span class="w"> </span>created<span class="w"> </span><span class="k">in</span><span class="w"> </span>file<span class="w"> </span>buf0buf.c<span class="w"> </span>line<span class="w"> </span><span class="m">916</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>a<span class="w"> </span>writer<span class="w"> </span><span class="o">(</span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">140653057947392</span><span class="o">)</span><span class="w"> </span>has<span class="w"> </span>reserved<span class="w"> </span>it<span class="w"> </span><span class="k">in</span><span class="w"> </span>mode<span class="w"> </span>exclusive
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>number<span class="w"> </span>of<span class="w"> </span>readers<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>waiters<span class="w"> </span>flag<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>lock_word:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>Last<span class="w"> </span><span class="nb">time</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>locked<span class="w"> </span><span class="k">in</span><span class="w"> </span>file<span class="w"> </span>row0sel.c<span class="w"> </span>line<span class="w"> </span><span class="m">3097</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>Last<span class="w"> </span><span class="nb">time</span><span class="w"> </span>write<span class="w"> </span>locked<span class="w"> </span><span class="k">in</span><span class="w"> </span>file<span class="w"> </span>/usr/local/src/soft/mysql-5.5.24/storage/innobase/buf/buf0buf.c<span class="w"> </span>line<span class="w"> </span><span class="m">3151</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>--Thread<span class="w"> </span><span class="m">140653677291264</span><span class="w"> </span>has<span class="w"> </span>waited<span class="w"> </span>at<span class="w"> </span>btr0pcur.c<span class="w"> </span>line<span class="w"> </span><span class="m">437</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="m">0</span>.00<span class="w"> </span>seconds<span class="w"> </span>the<span class="w"> </span>semaphore:
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>S-lock<span class="w"> </span>on<span class="w"> </span>RW-latch<span class="w"> </span>at<span class="w"> </span>0x7ff53945b240<span class="w"> </span>created<span class="w"> </span><span class="k">in</span><span class="w"> </span>file<span class="w"> </span>buf0buf.c<span class="w"> </span>line<span class="w"> </span><span class="m">916</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>a<span class="w"> </span>writer<span class="w"> </span><span class="o">(</span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">140653677291264</span><span class="o">)</span><span class="w"> </span>has<span class="w"> </span>reserved<span class="w"> </span>it<span class="w"> </span><span class="k">in</span><span class="w"> </span>mode<span class="w"> </span>exclusive
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>number<span class="w"> </span>of<span class="w"> </span>readers<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>waiters<span class="w"> </span>flag<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>lock_word:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>Last<span class="w"> </span><span class="nb">time</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>locked<span class="w"> </span><span class="k">in</span><span class="w"> </span>file<span class="w"> </span>row0sel.c<span class="w"> </span>line<span class="w"> </span><span class="m">3097</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>Last<span class="w"> </span><span class="nb">time</span><span class="w"> </span>write<span class="w"> </span>locked<span class="w"> </span><span class="k">in</span><span class="w"> </span>file<span class="w"> </span>/usr/local/src/soft/mysql-5.5.24/storage/innobase/buf/buf0buf.c<span class="w"> </span>line<span class="w"> </span><span class="m">3151</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>Mutex<span class="w"> </span>spin<span class="w"> </span>waits<span class="w"> </span><span class="m">1157217380</span>,<span class="w"> </span>rounds<span class="w"> </span><span class="m">1783981614</span>,<span class="w"> </span>OS<span class="w"> </span>waits<span class="w"> </span><span class="m">10610359</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>RW-shared<span class="w"> </span>spins<span class="w"> </span><span class="m">103830012</span>,<span class="w"> </span>rounds<span class="w"> </span><span class="m">1982690277</span>,<span class="w"> </span>OS<span class="w"> </span>waits<span class="w"> </span><span class="m">52051891</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>RW-excl<span class="w"> </span>spins<span class="w"> </span><span class="m">43730722</span>,<span class="w"> </span>rounds<span class="w"> </span><span class="m">602114981</span>,<span class="w"> </span>OS<span class="w"> </span>waits<span class="w"> </span><span class="m">3495769</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>Spin<span class="w"> </span>rounds<span class="w"> </span>per<span class="w"> </span>wait:<span class="w"> </span><span class="m">1</span>.54<span class="w"> </span>mutex,<span class="w"> </span><span class="m">19</span>.10<span class="w"> </span>RW-shared,<span class="w"> </span><span class="m">13</span>.77<span class="w"> </span>RW-excl
</span></code></pre></div></details>
</li>
<li>
<details class="note" open="open">
<summary>3.1</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>OS<span class="w"> </span>WAIT<span class="w"> </span>ARRAY<span class="w"> </span>INFO:<span class="w"> </span>reservation<span class="w"> </span>count<span class="w"> </span><span class="m">68581015</span>,<span class="w"> </span>signal<span class="w"> </span>count<span class="w"> </span><span class="m">218437328</span><span class="w"> </span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="c1"># 这行给出了关于操作系统等待数组的信息，它是一个插槽数组，innodb在数组里为信号量保留了一些插槽，</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="c1"># 操作系统用这些信号量给线程发送信号，使线程可以继续运行，以完成它们等着做的事情，</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="c1"># 这一行还显示出innodb使用了多少次操作系统的等待：保留统计（reservation count）显示了innodb分配插槽的频度，</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="c1"># 而信号计数（signal count）衡量的是线程通过数组得到信号的频度，操作系统的等待相对于空转等待（spin wait）要昂贵些。</span>
</span></code></pre></div>
</details>
</li>
<li>
<details class="note" open="open">
<summary>3.2</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>--Thread<span class="w"> </span><span class="m">140653057947392</span><span class="w"> </span>has<span class="w"> </span>waited<span class="w"> </span>at<span class="w"> </span>btr0pcur.c<span class="w"> </span>line<span class="w"> </span><span class="m">437</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="m">0</span>.00<span class="w"> </span>seconds<span class="w"> </span>the<span class="w"> </span>semaphore:
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>S-lock<span class="w"> </span>on<span class="w"> </span>RW-latch<span class="w"> </span>at<span class="w"> </span>0x7ff536c7d3c0<span class="w"> </span>created<span class="w"> </span><span class="k">in</span><span class="w"> </span>file<span class="w"> </span>buf0buf.c<span class="w"> </span>line<span class="w"> </span><span class="m">916</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>a<span class="w"> </span>writer<span class="w"> </span><span class="o">(</span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">140653057947392</span><span class="o">)</span><span class="w"> </span>has<span class="w"> </span>reserved<span class="w"> </span>it<span class="w"> </span><span class="k">in</span><span class="w"> </span>mode<span class="w"> </span>exclusive
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>number<span class="w"> </span>of<span class="w"> </span>readers<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>waiters<span class="w"> </span>flag<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>lock_word:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>Last<span class="w"> </span><span class="nb">time</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>locked<span class="w"> </span><span class="k">in</span><span class="w"> </span>file<span class="w"> </span>row0sel.c<span class="w"> </span>line<span class="w"> </span><span class="m">3097</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>Last<span class="w"> </span><span class="nb">time</span><span class="w"> </span>write<span class="w"> </span>locked<span class="w"> </span><span class="k">in</span><span class="w"> </span>file<span class="w"> </span>/usr/local/src/soft/mysql-5.5.24/storage/innobase/buf/buf0buf.c<span class="w"> </span>line<span class="w"> </span><span class="m">3151</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>--Thread<span class="w"> </span><span class="m">140653677291264</span><span class="w"> </span>has<span class="w"> </span>waited<span class="w"> </span>at<span class="w"> </span>btr0pcur.c<span class="w"> </span>line<span class="w"> </span><span class="m">437</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="m">0</span>.00<span class="w"> </span>seconds<span class="w"> </span>the<span class="w"> </span>semaphore:
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>S-lock<span class="w"> </span>on<span class="w"> </span>RW-latch<span class="w"> </span>at<span class="w"> </span>0x7ff53945b240<span class="w"> </span>created<span class="w"> </span><span class="k">in</span><span class="w"> </span>file<span class="w"> </span>buf0buf.c<span class="w"> </span>line<span class="w"> </span><span class="m">916</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>a<span class="w"> </span>writer<span class="w"> </span><span class="o">(</span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">140653677291264</span><span class="o">)</span><span class="w"> </span>has<span class="w"> </span>reserved<span class="w"> </span>it<span class="w"> </span><span class="k">in</span><span class="w"> </span>mode<span class="w"> </span>exclusive
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>number<span class="w"> </span>of<span class="w"> </span>readers<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>waiters<span class="w"> </span>flag<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>lock_word:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>Last<span class="w"> </span><span class="nb">time</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>locked<span class="w"> </span><span class="k">in</span><span class="w"> </span>file<span class="w"> </span>row0sel.c<span class="w"> </span>line<span class="w"> </span><span class="m">3097</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>Last<span class="w"> </span><span class="nb">time</span><span class="w"> </span>write<span class="w"> </span>locked<span class="w"> </span><span class="k">in</span><span class="w"> </span>file<span class="w"> </span>/usr/local/src/soft/mysql-5.5.24/storage/innobase/buf/buf0buf.c<span class="w"> </span>line<span class="w"> </span><span class="m">3151</span>
</span></code></pre></div>
<ul>
<li><strong>这部分显示的是当前正在等待互斥量的innodb线程，在这里可以看到有两个线程正在等待，每一个都是以--Thread &lt;数字&gt; has waited...开始，这一段内容在正常情况下应该是空的（即查看的时候没有这部分内容），除非服务器运行着高并发的工作负载，促使innodb采取让操作系统等待的措施，除非你对innodb源码熟悉，否则这里看到的最有用的信息就是发生线程等待的代码文件名 /usr/local/src/soft/mysql-5.5.24/storage/innobase/buf/buf0buf.c line 3151。</strong></li>
<li>在innodb内部哪里才是热点？举例来说，如果看到许多线程都在一个名为buf0buf.c的文件上等待，那就意味着你的系统里存在着缓冲池竞争，这个输出信息还显示了这些线程等待了多少时间，其中waiters flag显示了有多少个等待着正在等待同一个互斥量。 如果waiters flag为0那就表示没有线程在等待同一个互斥量（此时在waiters flag 0后面可能可以看到wait is ending，表示这个互斥量已经被释放了，但操作系统还没有把线程调度过来运行）。</li>
<li>你可能想知道innodb真正等待的是什么，innodb使用了互斥量和信号量来保护代码的临界区，如：限定每次只能有一个线程进入临界区，或者是当有活动的读时，就限制写入等。在innodb代码里有很多临界区，在合适的条件下，它们都可能出现在那里，常常能见到的一种情形是：获取缓冲池分页的访问权的时候。</li>
</ul>
</details>
</li>
<li>
<details class="note" open="open">
<summary>3.3</summary>
<p>在等待线程之后的部分信息如下，这部分显示了更多的事件计数器，在每一个情形中，都能看到innodb依靠操作系统等待的频度：
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>Mutex<span class="w"> </span>spin<span class="w"> </span>waits<span class="w"> </span><span class="m">1157217380</span>,<span class="w"> </span>rounds<span class="w"> </span><span class="m">1783981614</span>,<span class="w"> </span>OS<span class="w"> </span>waits<span class="w"> </span><span class="m">10610359</span><span class="w"> </span>**#这行显示的是跟互斥量相关的几个计数器**
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>RW-shared<span class="w"> </span>spins<span class="w"> </span><span class="m">103830012</span>,<span class="w"> </span>rounds<span class="w"> </span><span class="m">1982690277</span>,<span class="w"> </span>OS<span class="w"> </span>waits<span class="w"> </span><span class="m">52051891</span><span class="w"> </span>**#这行显示读写的共享锁的计数器**
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>RW-excl<span class="w"> </span>spins<span class="w"> </span><span class="m">43730722</span>,<span class="w"> </span>rounds<span class="w"> </span><span class="m">602114981</span>,<span class="w"> </span>OS<span class="w"> </span>waits<span class="w"> </span><span class="m">3495769</span><span class="w"> </span>**#这行显示读写的排他锁的计数器**
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>Spin<span class="w"> </span>rounds<span class="w"> </span>per<span class="w"> </span>wait:<span class="w"> </span><span class="m">1</span>.54<span class="w"> </span>mutex,<span class="w"> </span><span class="m">19</span>.10<span class="w"> </span>RW-shared,<span class="w"> </span><span class="m">13</span>.77<span class="w"> </span>RW-excl
</span></code></pre></div></p>
<ul>
<li>innodb有着一个多阶段等待的策略，首先，它会试着对锁进行空转等待，如果经历了一个预设的空转等待周期（设置innodb_sync_spin_loops配置变量命令）之后还没有成功，那就会退到更昂贵更复杂的等待数组中。</li>
<li>空转等待的成本相对较低，但是它们要不停地检查一个资源能否被锁定，这种方式会消耗CPU周期，但是，这没有听起来那么糟糕，因为当处理器在等待IO时，一般都有一些空闲的CPU周期可用，即使是没有空闲的CPU周期，空等也要比其他方式更加廉价一些。然而，当另外一个线程能做一些事情的时候，空转等待也还会把CPU独占着。</li>
<li>空转等待的替代方案就是让操作系统做上下文切换，这样，当一个线程在等待时，另外一个线程就可以被运行，然后，通过等待数组里的信号量发出信号，唤醒那个沉睡的线程，通过信号量来发送信号是比较有效的，但是上下文切换就很昂贵，这很快就会积少成多，每秒钟几千次的切换会引发大量的系统开销。</li>
<li>你可以通过修改innodb_sync_spin_loops的值，试着在空转等待与操作系统等待之间达成平衡，不要担心空转等待，除非你在一秒里看到几十万个空转等待。此时，你可以考虑performance_schema库或者show engine innodb mutex;查看下相关信息。</li>
</ul>
</details>
</li>
</ul>
</li>
<li>
<h4 id="_4">最近一次外键错误<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<ul>
<li>
<details class="note" open="open">
<summary>Note</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>------------------------
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>LATEST<span class="w"> </span>FOREIGN<span class="w"> </span>KEY<span class="w"> </span>ERROR
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>------------------------
</span></code></pre></div></details>
</li>
<li>
<p>这一段外键错误的信息一般不会出现，除非你服务器上发生了外键错误，有时问题在于事务在插入，更新或删除一条记录时要寻找父表或子表，还有时候是当innodb尝试增加或删除一个外键或者修改一个已经存在的外键时，发现表之间类型不匹配，这部分输出对于调试与innodb不明确的外键错误发生的准确原因非常有帮助。</p>
</li>
<li>
<details class="note" open="open">
<summary>4.1 创建父表：</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>mysql&gt;<span class="w"> </span>create<span class="w"> </span>table<span class="w"> </span>parent<span class="o">(</span>parent_id<span class="w"> </span>int<span class="w"> </span>not<span class="w"> </span>null,primary<span class="w"> </span>key<span class="o">(</span>parent_id<span class="o">))</span><span class="w"> </span><span class="nv">engine</span><span class="o">=</span>innodb<span class="p">;</span>
</span></code></pre></div>
</details>
</li>
<li>
<details class="note" open="open">
<summary>4.2 创建子表：</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>mysql&gt;<span class="w"> </span>create<span class="w"> </span>table<span class="w"> </span>child<span class="o">(</span>child_id<span class="w"> </span>int<span class="w"> </span>not<span class="w"> </span>null,key<span class="w"> </span>child_id<span class="o">(</span>child_id<span class="o">)</span>,constraint<span class="w"> </span>i_child<span class="w"> </span>foreign<span class="w"> </span>key<span class="o">(</span>child_id<span class="o">)</span><span class="w"> </span>references<span class="w"> </span>parent<span class="o">(</span>parent_id<span class="o">))</span><span class="w"> </span><span class="nv">engine</span><span class="o">=</span>innodb<span class="p">;</span>
</span></code></pre></div>
</details>
</li>
<li>
<details class="note" open="open">
<summary>4.3 插入数据：</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>mysql&gt;<span class="w"> </span>insert<span class="w"> </span>into<span class="w"> </span>parent<span class="o">(</span>parent_id<span class="o">)</span><span class="w"> </span>values<span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>mysql&gt;<span class="w"> </span>insert<span class="w"> </span>into<span class="w"> </span>child<span class="o">(</span>child_id<span class="o">)</span><span class="w"> </span>values<span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="p">;</span>
</span></code></pre></div>
</details>
</li>
<li>
<details class="note" open="open">
<summary>4.5 有两种基本的外键错误：</summary>
<p>第一种：以某种可能违反外键约束关系的方法增加，更新，删除数据，将导致第一类错误，如，在父表中删除行时发生如下错误：
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>mysql&gt;<span class="w"> </span>delete<span class="w"> </span>from<span class="w"> </span>parent<span class="p">;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>ERROR<span class="w"> </span><span class="m">1451</span><span class="w"> </span><span class="o">(</span><span class="m">23000</span><span class="o">)</span>:<span class="w"> </span>Cannot<span class="w"> </span>delete<span class="w"> </span>or<span class="w"> </span>update<span class="w"> </span>a<span class="w"> </span>parent<span class="w"> </span>row:<span class="w"> </span>a<span class="w"> </span>foreign<span class="w"> </span>key<span class="w"> </span>constraint<span class="w"> </span>fails<span class="w"> </span><span class="o">(</span><span class="sb">`</span>xiaoboluo<span class="sb">`</span>.<span class="sb">`</span>child<span class="sb">`</span>,<span class="w"> </span>CONSTRAINT<span class="w"> </span><span class="sb">`</span>i_child<span class="sb">`</span><span class="w"> </span>FOREIGN<span class="w"> </span>KEY<span class="w"> </span><span class="o">(</span><span class="sb">`</span>child_id<span class="sb">`</span><span class="o">)</span><span class="w"> </span>REFERENCES<span class="w"> </span><span class="sb">`</span>parent<span class="sb">`</span><span class="w"> </span><span class="o">(</span><span class="sb">`</span>parent_id<span class="sb">`</span><span class="o">))</span>
</span></code></pre></div></p>
</details>
<p>错误信息相当明了，对所有由增加，删除，更新不匹配的行导致的错误都会看到相似的信息，下面是show engine innodb status的输出：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>------------------------
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>LATEST<span class="w"> </span>FOREIGN<span class="w"> </span>KEY<span class="w"> </span>ERROR
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>------------------------
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="m">160128</span><span class="w"> </span><span class="m">1</span>:17:06<span class="w"> </span>Transaction:<span class="w"> </span><span class="c1"># 这行显示了最近一次外键错误的日期和时间**</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>TRANSACTION<span class="w"> </span>D203D6,<span class="w"> </span>ACTIVE<span class="w"> </span><span class="m">0</span><span class="w"> </span>sec<span class="w"> </span>updating<span class="w"> </span>or<span class="w"> </span>deleting
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>mysql<span class="w"> </span>tables<span class="w"> </span><span class="k">in</span><span class="w"> </span>use<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>locked<span class="w"> </span><span class="m">1</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="m">4</span><span class="w"> </span>lock<span class="w"> </span>struct<span class="o">(</span>s<span class="o">)</span>,<span class="w"> </span>heap<span class="w"> </span>size<span class="w"> </span><span class="m">1248</span>,<span class="w"> </span><span class="m">2</span><span class="w"> </span>row<span class="w"> </span>lock<span class="o">(</span>s<span class="o">)</span>,<span class="w"> </span>undo<span class="w"> </span>log<span class="w"> </span>entries<span class="w"> </span><span class="m">1</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>MySQL<span class="w"> </span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">20027</span>,<span class="w"> </span>OS<span class="w"> </span>thread<span class="w"> </span>handle<span class="w"> </span>0x7f0a4c0f8700,<span class="w"> </span>query<span class="w"> </span>id<span class="w"> </span><span class="m">1813996</span><span class="w"> </span>localhost<span class="w"> </span>root<span class="w"> </span>updating
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>delete<span class="w"> </span>from<span class="w"> </span>parent
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>Foreign<span class="w"> </span>key<span class="w"> </span>constraint<span class="w"> </span>fails<span class="w"> </span><span class="k">for</span><span class="w"> </span>table<span class="w"> </span><span class="sb">`</span>xiaoboluo<span class="sb">`</span>.<span class="sb">`</span>child<span class="sb">`</span>:
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="c1"># 上面部分显示了关于破坏外键约束的事务详情。后边部分显示了发现错误时innodb正尝试修改的准确数据，输出中有许多是转换成可打印格式的行数据**。</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>CONSTRAINT<span class="w"> </span><span class="sb">`</span>i_child<span class="sb">`</span><span class="w"> </span>FOREIGN<span class="w"> </span>KEY<span class="w"> </span><span class="o">(</span><span class="sb">`</span>child_id<span class="sb">`</span><span class="o">)</span><span class="w"> </span>REFERENCES<span class="w"> </span><span class="sb">`</span>parent<span class="sb">`</span><span class="w"> </span><span class="o">(</span><span class="sb">`</span>parent_id<span class="sb">`</span><span class="o">)</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>Trying<span class="w"> </span>to<span class="w"> </span>delete<span class="w"> </span>or<span class="w"> </span>update<span class="w"> </span><span class="k">in</span><span class="w"> </span>parent<span class="w"> </span>table,<span class="w"> </span><span class="k">in</span><span class="w"> </span>index<span class="w"> </span><span class="sb">`</span>PRIMARY<span class="sb">`</span><span class="w"> </span>tuple:
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>DATA<span class="w"> </span>TUPLE:<span class="w"> </span><span class="m">3</span><span class="w"> </span>fields<span class="p">;</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="m">0</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span><span class="m">80000001</span><span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="m">1</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">6</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span>000000d203d6<span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="m">2</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">7</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span>1e000001ca0110<span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>But<span class="w"> </span><span class="k">in</span><span class="w"> </span>child<span class="w"> </span>table<span class="w"> </span><span class="sb">`</span>xiaoboluo<span class="sb">`</span>.<span class="sb">`</span>child<span class="sb">`</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>index<span class="w"> </span><span class="sb">`</span>child_id<span class="sb">`</span>,<span class="w"> </span>there<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>record:
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>PHYSICAL<span class="w"> </span>RECORD:<span class="w"> </span>n_fields<span class="w"> </span><span class="m">2</span><span class="p">;</span><span class="w"> </span>compact<span class="w"> </span>format<span class="p">;</span><span class="w"> </span>info<span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="m">0</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span><span class="m">80000001</span><span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="m">1</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">6</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span>000013a99b3e<span class="p">;</span><span class="w"> </span>asc<span class="w"> </span>&gt;<span class="p">;;</span>
</span></code></pre></div>
</li>
<li>
<details class="note" open="open">
<summary>4.6 第二种：尝试修改父表的表结构时发生的错误，这种错误就没有那么清楚了，这可能会让调试更困难：</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>mysql&gt;<span class="w"> </span>alter<span class="w"> </span>table<span class="w"> </span>parent<span class="w"> </span>modify<span class="w"> </span>parent_id<span class="w"> </span>int<span class="w"> </span>unsigned<span class="w"> </span>not<span class="w"> </span>null<span class="p">;</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>ERROR<span class="w"> </span><span class="m">1025</span><span class="w"> </span><span class="o">(</span>HY000<span class="o">)</span>:<span class="w"> </span>Error<span class="w"> </span>on<span class="w"> </span>rename<span class="w"> </span>of<span class="w"> </span><span class="s1">&#39;./xiaoboluo/#sql-b695_4e3b&#39;</span><span class="w"> </span>to<span class="w"> </span><span class="s1">&#39;./xiaoboluo/parent&#39;</span><span class="w"> </span><span class="o">(</span>errno:<span class="w"> </span><span class="m">150</span><span class="o">)</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>查看show<span class="w"> </span>engine<span class="w"> </span>innodb<span class="w"> </span>status输出信息：
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>------------------------
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>LATEST<span class="w"> </span>FOREIGN<span class="w"> </span>KEY<span class="w"> </span>ERROR
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>------------------------
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="m">160128</span><span class="w"> </span><span class="m">1</span>:32:33<span class="w"> </span>Error<span class="w"> </span><span class="k">in</span><span class="w"> </span>foreign<span class="w"> </span>key<span class="w"> </span>constraint<span class="w"> </span>of<span class="w"> </span>table<span class="w"> </span>xiaoboluo/child:
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>there<span class="w"> </span>is<span class="w"> </span>no<span class="w"> </span>index<span class="w"> </span><span class="k">in</span><span class="w"> </span>referenced<span class="w"> </span>table<span class="w"> </span>which<span class="w"> </span>would<span class="w"> </span>contain
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>the<span class="w"> </span>columns<span class="w"> </span>as<span class="w"> </span>the<span class="w"> </span>first<span class="w"> </span>columns,<span class="w"> </span>or<span class="w"> </span>the<span class="w"> </span>data<span class="w"> </span>types<span class="w"> </span><span class="k">in</span><span class="w"> </span>the
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>referenced<span class="w"> </span>table<span class="w"> </span><span class="k">do</span><span class="w"> </span>not<span class="w"> </span>match<span class="w"> </span>the<span class="w"> </span>ones<span class="w"> </span><span class="k">in</span><span class="w"> </span>table.<span class="w"> </span>Constraint:
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>,
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>CONSTRAINT<span class="w"> </span><span class="s2">&quot;i_child&quot;</span><span class="w"> </span>FOREIGN<span class="w"> </span>KEY<span class="w"> </span><span class="o">(</span><span class="s2">&quot;child_id&quot;</span><span class="o">)</span><span class="w"> </span>REFERENCES<span class="w"> </span><span class="s2">&quot;parent&quot;</span><span class="w"> </span><span class="o">(</span><span class="s2">&quot;parent_id&quot;</span><span class="o">)</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>The<span class="w"> </span>index<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>foreign<span class="w"> </span>key<span class="w"> </span><span class="k">in</span><span class="w"> </span>table<span class="w"> </span>is<span class="w"> </span><span class="s2">&quot;child_id&quot;</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>See<span class="w"> </span>http://dev.mysql.com/doc/refman/5.5/en/innodb-foreign-key-constraints.html
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="k">for</span><span class="w"> </span>correct<span class="w"> </span>foreign<span class="w"> </span>key<span class="w"> </span>definition.
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>InnoDB:<span class="w"> </span>Renaming<span class="w"> </span>table<span class="w"> </span><span class="sb">`</span>xiaoboluo<span class="sb">`</span>.&lt;result<span class="w"> </span><span class="m">2</span><span class="w"> </span>when<span class="w"> </span>explaining<span class="w"> </span>filename<span class="w"> </span><span class="s1">&#39;#sql-b695_4e3b&#39;</span>&gt;<span class="w"> </span>to<span class="w"> </span><span class="sb">`</span>xiaoboluo<span class="sb">`</span>.<span class="sb">`</span>parent<span class="sb">`</span><span class="w"> </span>failed!
</span></code></pre></div>
</details>
</li>
<li>上面的错误是数据类型不匹配，外键列必须有完全相同的数据类型，包括任何的修饰符（如这里父表多加了一个unsigned，这也是问题所在），当看到1025错误并不理解为什么时，最好查看下innodb status。在每次看到有新错误时，外键错误信息都会被重写，percona toolkit中的pt-fk-error-logger工具可以用表保存这些信息以供后续分析。</li>
</ul>
</li>
<li>
<h4 id="_5">最近一次死锁<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>------------------------
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>LATEST DETECTED DEADLOCK
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>------------------------
</span></code></pre></div>
<ul>
<li>与外键错误一样，这部分只有当服务器产生死锁时才会出现，死锁信息同样在每次有新的死锁错误时被重写，percona toolkit中的pt-deadlock-logger工具可以用表保存这些信息以供后续分析死锁在等待关系图里是一个循环，就是一个锁定了行的数据结构又在等待别的锁，这个循环可以任意地大，innodb会立即检测到死锁，因为每当有事务等待行锁的时候，它都会去检查等待关系图里是否有循环，死锁的情况可能会比较复杂，但是，这一部分只显示了最近的两个死锁的情况，它们在各自的事务里执行的最后一条语句，以及它们在等待关系图里形成环锁的信息。在这个循环里你看不到其他事务，也可能看不到在事务里早先真正获得了锁的语句，尽管如此，通常还是可以通过查看这些输出结果来确定到底是什么引起了死锁。</li>
<li>在innodb里实际上有两种死锁，第一种就是常常碰到的那种，它在等待关系图里是一个真正的循环，另外一种就是在一个等待关系图里，因代价昂贵而无法检测它是不是包含了循环，如果innodb要在关系图里检查超过100W个锁，或者在检查过程中，innodb要重做200个以上的事务，那它会放弃，并宣布这里有一个死锁，这些数值都是硬编码在innodb代码里的常量，无法配置（如果你NB可以修改代码然后重新编译）。第二种死锁报错你可以在输出里看到一条信息：TOO DEEP OR LONG SEARCH IN THE LOCK TABLE WAITS-FOR GRAPH</li>
<li>
<p>innodb不仅会打印出事务和事务持有和等待的锁，而且还有记录本身，不幸的是，它至于可能超过为输出结果预留的长度（只能打印1M的内容且只能保留最近一次的死锁信息），如果你无法看到完整的输出，此时可以在任意库下创建innodb_monitor或innodb_lock_monitor表，这样innodb status信息会完整且每15s一次被记录到错误日志中。如：create table innodb_monitor(a int)engine=innodb;，不需要记录到错误日志中时就删掉这个表即可。</p>
</li>
<li>
<p>5.1 下面也搞一个示例来看看：</p>
<ul>
<li>
<details class="note" open="open">
<summary>5.1.1 建表：</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>mysql&gt;<span class="w"> </span>create<span class="w"> </span>table<span class="w"> </span>test_deadlock<span class="o">(</span>id<span class="w"> </span>int<span class="w"> </span>unsigned<span class="w"> </span>not<span class="w"> </span>null<span class="w"> </span>primary<span class="w"> </span>key<span class="w"> </span>auto_increment,test<span class="w"> </span>int<span class="w"> </span>unsigned<span class="w"> </span>not<span class="w"> </span>null<span class="o">)</span><span class="p">;</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>Query<span class="w"> </span>OK,<span class="w"> </span><span class="m">0</span><span class="w"> </span>rows<span class="w"> </span>affected<span class="w"> </span><span class="o">(</span><span class="m">0</span>.02<span class="w"> </span>sec<span class="o">)</span>
</span></code></pre></div></details>
</li>
<li>
<details class="note" open="open">
<summary>5.1.2 插入测试数据：</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>mysql&gt;<span class="w"> </span>insert<span class="w"> </span>into<span class="w"> </span>test_deadlock<span class="o">(</span><span class="nb">test</span><span class="o">)</span><span class="w"> </span>values<span class="o">(</span><span class="m">1</span><span class="o">)</span>,<span class="o">(</span><span class="m">2</span><span class="o">)</span>,<span class="o">(</span><span class="m">3</span><span class="o">)</span>,<span class="o">(</span><span class="m">4</span><span class="o">)</span>,<span class="o">(</span><span class="m">5</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>Query<span class="w"> </span>OK,<span class="w"> </span><span class="m">5</span><span class="w"> </span>rows<span class="w"> </span>affected<span class="w"> </span><span class="o">(</span><span class="m">0</span>.00<span class="w"> </span>sec<span class="o">)</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>Records:<span class="w"> </span><span class="m">5</span><span class="w"> </span>Duplicates:<span class="w"> </span><span class="m">0</span><span class="w"> </span>Warnings:<span class="w"> </span><span class="m">0</span>
</span></code></pre></div>
</details>
</li>
<li>
<details class="note" open="open">
<summary>5.1.3 会话1执行下面的SQL：</summary>
<p>打开两个会话终端：
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>mysql&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="nv">autocommit</span><span class="o">=</span><span class="m">0</span><span class="p">;</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>Query<span class="w"> </span>OK,<span class="w"> </span><span class="m">0</span><span class="w"> </span>rows<span class="w"> </span>affected<span class="w"> </span><span class="o">(</span><span class="m">0</span>.00<span class="w"> </span>sec<span class="o">)</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>mysql&gt;<span class="w"> </span><span class="k">select</span><span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>test_deadlock<span class="w"> </span>where<span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>update<span class="p">;</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>+----+------+
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="p">|</span><span class="w"> </span>id<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="p">|</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>+----+------+
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="p">|</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>+----+------+
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="m">1</span><span class="w"> </span>row<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="o">(</span><span class="m">0</span>.00<span class="w"> </span>sec<span class="o">)</span>
</span></code></pre></div></p>
</details>
</li>
<li>
<details class="note" open="open">
<summary>5.1.4 接着会话2执行下面的SQL：</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>mysql&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="nv">autocommit</span><span class="o">=</span><span class="m">0</span><span class="p">;</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>Query<span class="w"> </span>OK,<span class="w"> </span><span class="m">0</span><span class="w"> </span>rows<span class="w"> </span>affected<span class="w"> </span><span class="o">(</span><span class="m">0</span>.00<span class="w"> </span>sec<span class="o">)</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>mysql&gt;<span class="w"> </span><span class="k">select</span><span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>test_deadlock<span class="w"> </span>where<span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>update<span class="p">;</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>+----+------+
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="p">|</span><span class="w"> </span>id<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="p">|</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>+----+------+
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="p">|</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">|</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>+----+------+
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="m">1</span><span class="w"> </span>row<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="o">(</span><span class="m">0</span>.00<span class="w"> </span>sec<span class="o">)</span>
</span></code></pre></div>
</details>
</li>
<li>
<details class="note" open="open">
<summary>5.1.5 回到会话1执行下面的SQL，会发生等待：</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>mysql&gt;<span class="w"> </span><span class="k">select</span><span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>test_deadlock<span class="w"> </span>where<span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>update<span class="p">;</span>
</span></code></pre></div>
</details>
</li>
<li>
<details class="note" open="open">
<summary>5.1.6 回到会话2执行下面的SQL，产生死锁，会话2被回滚：</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>mysql&gt;<span class="w"> </span><span class="k">select</span><span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>test_deadlock<span class="w"> </span>where<span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>update<span class="p">;</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>ERROR<span class="w"> </span><span class="m">1213</span><span class="w"> </span><span class="o">(</span><span class="m">40001</span><span class="o">)</span>:<span class="w"> </span>Deadlock<span class="w"> </span>found<span class="w"> </span>when<span class="w"> </span>trying<span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>lock<span class="p">;</span><span class="w"> </span>try<span class="w"> </span>restarting<span class="w"> </span>transaction
</span></code></pre></div>
</details>
</li>
</ul>
</li>
<li>
<p>5.2 查看innodb status信息：</p>
<ul>
<li>
<details class="note">
<summary>Note</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>------------------------
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>LATEST<span class="w"> </span>DETECTED<span class="w"> </span>DEADLOCK
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>------------------------
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="m">160128</span><span class="w"> </span><span class="m">1</span>:51:53<span class="w"> </span>**#这里显示了最近一次发生死锁的日期和时间**
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>***<span class="w"> </span><span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="w"> </span>TRANSACTION:
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>TRANSACTION<span class="w"> </span>D20847,<span class="w"> </span>ACTIVE<span class="w"> </span><span class="m">141</span><span class="w"> </span>sec<span class="w"> </span>starting<span class="w"> </span>index<span class="w"> </span><span class="nb">read</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>mysql<span class="w"> </span>tables<span class="w"> </span><span class="k">in</span><span class="w"> </span>use<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>locked<span class="w"> </span><span class="m">1</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>LOCK<span class="w"> </span>WAIT<span class="w"> </span><span class="m">3</span><span class="w"> </span>lock<span class="w"> </span>struct<span class="o">(</span>s<span class="o">)</span>,<span class="w"> </span>heap<span class="w"> </span>size<span class="w"> </span><span class="m">376</span>,<span class="w"> </span><span class="m">2</span><span class="w"> </span>row<span class="w"> </span>lock<span class="o">(</span>s<span class="o">)</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>MySQL<span class="w"> </span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">20027</span>,<span class="w"> </span>OS<span class="w"> </span>thread<span class="w"> </span>handle<span class="w"> </span>0x7f0a4c0f8700,<span class="w"> </span>query<span class="w"> </span>id<span class="w"> </span><span class="m">1818124</span><span class="w"> </span>localhost<span class="w"> </span>root<span class="w"> </span>statistics
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="k">select</span><span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>test_deadlock<span class="w"> </span>where<span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>update
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>***<span class="w"> </span><span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="w"> </span>WAITING<span class="w"> </span>FOR<span class="w"> </span>THIS<span class="w"> </span>LOCK<span class="w"> </span>TO<span class="w"> </span>BE<span class="w"> </span>GRANTED:
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>RECORD<span class="w"> </span>LOCKS<span class="w"> </span>space<span class="w"> </span>id<span class="w"> </span><span class="m">441</span><span class="w"> </span>page<span class="w"> </span>no<span class="w"> </span><span class="m">3</span><span class="w"> </span>n<span class="w"> </span>bits<span class="w"> </span><span class="m">72</span><span class="w"> </span>index<span class="w"> </span><span class="sb">`</span>PRIMARY<span class="sb">`</span><span class="w"> </span>of<span class="w"> </span>table<span class="w"> </span><span class="sb">`</span>xiaoboluo<span class="sb">`</span>.<span class="sb">`</span>test_deadlock<span class="sb">`</span><span class="w"> </span>trx<span class="w"> </span>id<span class="w"> </span>D20847<span class="w"> </span>lock_mode<span class="w"> </span>X<span class="w"> </span>locks<span class="w"> </span>rec<span class="w"> </span>but<span class="w"> </span>not<span class="w"> </span>gap<span class="w"> </span>waiting
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>Record<span class="w"> </span>lock,<span class="w"> </span>heap<span class="w"> </span>no<span class="w"> </span><span class="m">3</span><span class="w"> </span>PHYSICAL<span class="w"> </span>RECORD:<span class="w"> </span>n_fields<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>compact<span class="w"> </span>format<span class="p">;</span><span class="w"> </span>info<span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="m">0</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span><span class="m">00000002</span><span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="m">1</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">6</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span>000000d20808<span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="m">2</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">7</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span>ad000001ab011d<span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="m">3</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span><span class="m">00000002</span><span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>***<span class="w"> </span><span class="o">(</span><span class="m">2</span><span class="o">)</span><span class="w"> </span>TRANSACTION:
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>TRANSACTION<span class="w"> </span>D20853,<span class="w"> </span>ACTIVE<span class="w"> </span><span class="m">119</span><span class="w"> </span>sec<span class="w"> </span>starting<span class="w"> </span>index<span class="w"> </span><span class="nb">read</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>mysql<span class="w"> </span>tables<span class="w"> </span><span class="k">in</span><span class="w"> </span>use<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>locked<span class="w"> </span><span class="m">1</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="m">3</span><span class="w"> </span>lock<span class="w"> </span>struct<span class="o">(</span>s<span class="o">)</span>,<span class="w"> </span>heap<span class="w"> </span>size<span class="w"> </span><span class="m">1248</span>,<span class="w"> </span><span class="m">2</span><span class="w"> </span>row<span class="w"> </span>lock<span class="o">(</span>s<span class="o">)</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a>MySQL<span class="w"> </span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">20081</span>,<span class="w"> </span>OS<span class="w"> </span>thread<span class="w"> </span>handle<span class="w"> </span>0x7f0a0f020700,<span class="w"> </span>query<span class="w"> </span>id<span class="w"> </span><span class="m">1818204</span><span class="w"> </span>localhost<span class="w"> </span>root<span class="w"> </span>statistics
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="k">select</span><span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>test_deadlock<span class="w"> </span>where<span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>update
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>***<span class="w"> </span><span class="o">(</span><span class="m">2</span><span class="o">)</span><span class="w"> </span>HOLDS<span class="w"> </span>THE<span class="w"> </span>LOCK<span class="o">(</span>S<span class="o">)</span>:
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a>RECORD<span class="w"> </span>LOCKS<span class="w"> </span>space<span class="w"> </span>id<span class="w"> </span><span class="m">441</span><span class="w"> </span>page<span class="w"> </span>no<span class="w"> </span><span class="m">3</span><span class="w"> </span>n<span class="w"> </span>bits<span class="w"> </span><span class="m">72</span><span class="w"> </span>index<span class="w"> </span><span class="sb">`</span>PRIMARY<span class="sb">`</span><span class="w"> </span>of<span class="w"> </span>table<span class="w"> </span><span class="sb">`</span>xiaoboluo<span class="sb">`</span>.<span class="sb">`</span>test_deadlock<span class="sb">`</span><span class="w"> </span>trx<span class="w"> </span>id<span class="w"> </span>D20853<span class="w"> </span>lock_mode<span class="w"> </span>X<span class="w"> </span>locks<span class="w"> </span>rec<span class="w"> </span>but<span class="w"> </span>not<span class="w"> </span>gap
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a>Record<span class="w"> </span>lock,<span class="w"> </span>heap<span class="w"> </span>no<span class="w"> </span><span class="m">3</span><span class="w"> </span>PHYSICAL<span class="w"> </span>RECORD:<span class="w"> </span>n_fields<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>compact<span class="w"> </span>format<span class="p">;</span><span class="w"> </span>info<span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="m">0</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span><span class="m">00000002</span><span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a><span class="m">1</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">6</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span>000000d20808<span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a><span class="m">2</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">7</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span>ad000001ab011d<span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a><span class="m">3</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span><span class="m">00000002</span><span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a>
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a>***<span class="w"> </span><span class="o">(</span><span class="m">2</span><span class="o">)</span><span class="w"> </span>WAITING<span class="w"> </span>FOR<span class="w"> </span>THIS<span class="w"> </span>LOCK<span class="w"> </span>TO<span class="w"> </span>BE<span class="w"> </span>GRANTED:
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a>RECORD<span class="w"> </span>LOCKS<span class="w"> </span>space<span class="w"> </span>id<span class="w"> </span><span class="m">441</span><span class="w"> </span>page<span class="w"> </span>no<span class="w"> </span><span class="m">3</span><span class="w"> </span>n<span class="w"> </span>bits<span class="w"> </span><span class="m">72</span><span class="w"> </span>index<span class="w"> </span><span class="sb">`</span>PRIMARY<span class="sb">`</span><span class="w"> </span>of<span class="w"> </span>table<span class="w"> </span><span class="sb">`</span>xiaoboluo<span class="sb">`</span>.<span class="sb">`</span>test_deadlock<span class="sb">`</span><span class="w"> </span>trx<span class="w"> </span>id<span class="w"> </span>D20853<span class="w"> </span>lock_mode<span class="w"> </span>X<span class="w"> </span>locks<span class="w"> </span>rec<span class="w"> </span>but<span class="w"> </span>not<span class="w"> </span>gap<span class="w"> </span>waiting
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a>Record<span class="w"> </span>lock,<span class="w"> </span>heap<span class="w"> </span>no<span class="w"> </span><span class="m">2</span><span class="w"> </span>PHYSICAL<span class="w"> </span>RECORD:<span class="w"> </span>n_fields<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>compact<span class="w"> </span>format<span class="p">;</span><span class="w"> </span>info<span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a><span class="m">0</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span><span class="m">00000001</span><span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a><span class="m">1</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">6</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span>000000d20808<span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-20-38"><a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a><span class="m">2</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">7</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span>ad000001ab0110<span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-20-39"><a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a><span class="m">3</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span><span class="m">00000001</span><span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-20-40"><a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a>
</span><span id="__span-20-41"><a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a>***<span class="w"> </span>WE<span class="w"> </span>ROLL<span class="w"> </span>BACK<span class="w"> </span>TRANSACTION<span class="w"> </span><span class="o">(</span><span class="m">2</span><span class="o">)</span>
</span></code></pre></div></details>
</li>
<li>
<p>这部分内容比较多，下面分段逐一进行解释：</p>
</li>
<li>
<details class="note" open="open">
<summary>5.2.1 下面这部分显示的是死锁的第一个事务的信息：</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>***<span class="w"> </span><span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="w"> </span>TRANSACTION:
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>TRANSACTION<span class="w"> </span>D20847,<span class="w"> </span>ACTIVE<span class="w"> </span><span class="m">141</span><span class="w"> </span>sec<span class="w"> </span>starting<span class="w"> </span>index<span class="w"> </span><span class="nb">read</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>mysql<span class="w"> </span>tables<span class="w"> </span><span class="k">in</span><span class="w"> </span>use<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>locked<span class="w"> </span><span class="m">1</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>LOCK<span class="w"> </span>WAIT<span class="w"> </span><span class="m">3</span><span class="w"> </span>lock<span class="w"> </span>struct<span class="o">(</span>s<span class="o">)</span>,<span class="w"> </span>heap<span class="w"> </span>size<span class="w"> </span><span class="m">376</span>,<span class="w"> </span><span class="m">2</span><span class="w"> </span>row<span class="w"> </span>lock<span class="o">(</span>s<span class="o">)</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>MySQL<span class="w"> </span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">20027</span>,<span class="w"> </span>OS<span class="w"> </span>thread<span class="w"> </span>handle<span class="w"> </span>0x7f0a4c0f8700,<span class="w"> </span>query<span class="w"> </span>id<span class="w"> </span><span class="m">1818124</span><span class="w"> </span>localhost<span class="w"> </span>root<span class="w"> </span>statistics
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="k">select</span><span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>test_deadlock<span class="w"> </span>where<span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>update
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>TRANSACTION<span class="w"> </span>D20847,<span class="w"> </span>ACTIVE<span class="w"> </span><span class="m">141</span><span class="w"> </span>sec<span class="w"> </span>starting<span class="w"> </span>index<span class="w"> </span>read：#<span class="w"> </span>这行表示事务D20847，ACTIVE<span class="w"> </span><span class="m">141</span><span class="w"> </span>sec表示事务处于活跃状态141s，starting<span class="w"> </span>index<span class="w"> </span>read表示正在使用索引读取数据行
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>mysql<span class="w"> </span>tables<span class="w"> </span><span class="k">in</span><span class="w"> </span>use<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>locked<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1"># 这行表示事务D20847正在使用1个表，且涉及锁的表有1个</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>LOCK<span class="w"> </span>WAIT<span class="w"> </span><span class="m">3</span><span class="w"> </span>lock<span class="w"> </span>struct<span class="o">(</span>s<span class="o">)</span>,<span class="w"> </span>heap<span class="w"> </span>size<span class="w"> </span><span class="m">376</span>,<span class="w"> </span><span class="m">2</span><span class="w"> </span>row<span class="w"> </span>lock<span class="o">(</span>s<span class="o">)</span><span class="w"> </span><span class="c1"># 这行表示在等待3把锁，占用内存376字节，涉及2行记录，如果事务已经锁定了几行数据，这里将会有一行信息显示出锁定结构的数目（注意，这跟行锁是两回事）和堆大小，堆的大小指的是为了持有这些行锁而占用的内存大小，Innodb是用一种特殊的位图表来实现行锁的，从理论上讲，它可将每一个锁定的行表示为一个比特，经测试显示，每个锁通常不超过4比特</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>MySQL<span class="w"> </span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">20027</span>,<span class="w"> </span>OS<span class="w"> </span>thread<span class="w"> </span>handle<span class="w"> </span>0x7f0a4c0f8700,<span class="w"> </span>query<span class="w"> </span>id<span class="w"> </span><span class="m">1818124</span><span class="w"> </span>localhost<span class="w"> </span>root<span class="w"> </span>statistics<span class="w"> </span><span class="c1"># 这行表示该事务的线程ID信息，操作系统句柄信息，连接来源、用户</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="k">select</span><span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>test_deadlock<span class="w"> </span>where<span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>update<span class="w"> </span><span class="c1"># 这行表示事务涉及的SQL</span>
</span></code></pre></div>
</details>
</li>
<li>
<details class="note" open="open">
<summary>5.2.2 下面这一部分显示的是当死锁发生时，第一个事务正在等待的锁等信息：</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>***<span class="w"> </span><span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="w"> </span>WAITING<span class="w"> </span>FOR<span class="w"> </span>THIS<span class="w"> </span>LOCK<span class="w"> </span>TO<span class="w"> </span>BE<span class="w"> </span>GRANTED:<span class="w"> </span><span class="c1"># 这行信息表示第一个事务正在等待锁被授予</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>RECORD<span class="w"> </span>LOCKS<span class="w"> </span>space<span class="w"> </span>id<span class="w"> </span><span class="m">441</span><span class="w"> </span>page<span class="w"> </span>no<span class="w"> </span><span class="m">3</span><span class="w"> </span>n<span class="w"> </span>bits<span class="w"> </span><span class="m">72</span><span class="w"> </span>index<span class="w"> </span><span class="sb">`</span>PRIMARY<span class="sb">`</span><span class="w"> </span>of<span class="w"> </span>table<span class="w"> </span><span class="sb">`</span>xiaoboluo<span class="sb">`</span>.<span class="sb">`</span>test_deadlock<span class="sb">`</span><span class="w"> </span>trx<span class="w"> </span>id<span class="w"> </span>D20847<span class="w"> </span>lock_mode<span class="w"> </span>X<span class="w"> </span>locks<span class="w"> </span>rec<span class="w"> </span>but<span class="w"> </span>not<span class="w"> </span>gap<span class="w"> </span>waiting
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>Record<span class="w"> </span>lock,<span class="w"> </span>heap<span class="w"> </span>no<span class="w"> </span><span class="m">3</span><span class="w"> </span>PHYSICAL<span class="w"> </span>RECORD:<span class="w"> </span>n_fields<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>compact<span class="w"> </span>format<span class="p">;</span><span class="w"> </span>info<span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="m">0</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span><span class="m">00000002</span><span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="m">1</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">6</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span>000000d20808<span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="m">2</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">7</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span>ad000001ab011d<span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="m">3</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span><span class="m">00000002</span><span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>RECORD<span class="w"> </span>LOCKS<span class="w"> </span>space<span class="w"> </span>id<span class="w"> </span><span class="m">441</span><span class="w"> </span>page<span class="w"> </span>no<span class="w"> </span><span class="m">3</span><span class="w"> </span>n<span class="w"> </span>bits<span class="w"> </span><span class="m">72</span><span class="w"> </span>index<span class="w"> </span><span class="sb">`</span>PRIMARY<span class="sb">`</span><span class="w"> </span>of<span class="w"> </span>table<span class="w"> </span><span class="sb">`</span>xiaoboluo<span class="sb">`</span>.<span class="sb">`</span>test_deadlock<span class="sb">`</span><span class="w"> </span>trx<span class="w"> </span>id<span class="w"> </span>D20847<span class="w"> </span>lock_mode<span class="w"> </span>X<span class="w"> </span>locks<span class="w"> </span>rec<span class="w"> </span>but<span class="w"> </span>not<span class="w"> </span>gap<span class="w"> </span>waiting
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="c1"># 这行信息表示等待的锁是一个record lock，空间id是441，页编号为3，大概位置在页的72位处，锁发生在表xiaoboluo.test_deadlock的主键上，是一个X锁，但是不是gap lock。 waiting表示正在等待锁</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>Record<span class="w"> </span>lock,<span class="w"> </span>heap<span class="w"> </span>no<span class="w"> </span><span class="m">3</span><span class="w"> </span>PHYSICAL<span class="w"> </span>RECORD:<span class="w"> </span>n_fields<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>compact<span class="w"> </span>format<span class="p">;</span><span class="w"> </span>info<span class="w"> </span>bits<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1"># 这行表示record lock的heap no 位置</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="c1"># 这部分剩下的内容只对调试才有用。</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="m">0</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span><span class="m">00000002</span><span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="m">1</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">6</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span>000000d20808<span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="m">2</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">7</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span>ad000001ab011d<span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="m">3</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span><span class="m">00000002</span><span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span></code></pre></div>
</details>
</li>
<li>
<details class="note" open="open">
<summary>5.2.3 下面这部分是事务二的状态：</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>***<span class="w"> </span><span class="o">(</span><span class="m">2</span><span class="o">)</span><span class="w"> </span>TRANSACTION:
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>TRANSACTION<span class="w"> </span>D20853,<span class="w"> </span>ACTIVE<span class="w"> </span><span class="m">119</span><span class="w"> </span>sec<span class="w"> </span>starting<span class="w"> </span>index<span class="w"> </span><span class="nb">read</span><span class="w"> </span><span class="c1"># 事务2处于活跃状态119s</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>mysql<span class="w"> </span>tables<span class="w"> </span><span class="k">in</span><span class="w"> </span>use<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>locked<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1"># 正在使用1个表，涉及锁的表有1个</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="m">3</span><span class="w"> </span>lock<span class="w"> </span>struct<span class="o">(</span>s<span class="o">)</span>,<span class="w"> </span>heap<span class="w"> </span>size<span class="w"> </span><span class="m">1248</span>,<span class="w"> </span><span class="m">2</span><span class="w"> </span>row<span class="w"> </span>lock<span class="o">(</span>s<span class="o">)</span><span class="w"> </span><span class="c1"># 涉及3把锁，2行记录</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>MySQL<span class="w"> </span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">20081</span>,<span class="w"> </span>OS<span class="w"> </span>thread<span class="w"> </span>handle<span class="w"> </span>0x7f0a0f020700,<span class="w"> </span>query<span class="w"> </span>id<span class="w"> </span><span class="m">1818204</span><span class="w"> </span>localhost<span class="w"> </span>root<span class="w"> </span>statistics
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="k">select</span><span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>test_deadlock<span class="w"> </span>where<span class="w"> </span><span class="nv">id</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>update<span class="w"> </span><span class="c1"># 第二个事务的SQL</span>
</span></code></pre></div>
</details>
</li>
<li>
<details class="note" open="open">
<summary>5.2.4 下面这部分是事务二的持有锁信息：</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>***<span class="w"> </span><span class="o">(</span><span class="m">2</span><span class="o">)</span><span class="w"> </span>HOLDS<span class="w"> </span>THE<span class="w"> </span>LOCK<span class="o">(</span>S<span class="o">)</span>:
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>RECORD<span class="w"> </span>LOCKS<span class="w"> </span>space<span class="w"> </span>id<span class="w"> </span><span class="m">441</span><span class="w"> </span>page<span class="w"> </span>no<span class="w"> </span><span class="m">3</span><span class="w"> </span>n<span class="w"> </span>bits<span class="w"> </span><span class="m">72</span><span class="w"> </span>index<span class="w"> </span><span class="sb">`</span>PRIMARY<span class="sb">`</span><span class="w"> </span>of<span class="w"> </span>table<span class="w"> </span><span class="sb">`</span>xiaoboluo<span class="sb">`</span>.<span class="sb">`</span>test_deadlock<span class="sb">`</span><span class="w"> </span>trx<span class="w"> </span>id<span class="w"> </span>D20853<span class="w"> </span>lock_mode<span class="w"> </span>X<span class="w"> </span>locks<span class="w"> </span>rec<span class="w"> </span>but<span class="w"> </span>not<span class="w"> </span>gap
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>Record<span class="w"> </span>lock,<span class="w"> </span>heap<span class="w"> </span>no<span class="w"> </span><span class="m">3</span><span class="w"> </span>PHYSICAL<span class="w"> </span>RECORD:<span class="w"> </span>n_fields<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>compact<span class="w"> </span>format<span class="p">;</span><span class="w"> </span>info<span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="m">0</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span><span class="m">00000002</span><span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="m">1</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">6</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span>000000d20808<span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="m">2</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">7</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span>ad000001ab011d<span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="m">3</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span><span class="m">00000002</span><span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>RECORD<span class="w"> </span>LOCKS<span class="w"> </span>space<span class="w"> </span>id<span class="w"> </span><span class="m">441</span><span class="w"> </span>page<span class="w"> </span>no<span class="w"> </span><span class="m">3</span><span class="w"> </span>n<span class="w"> </span>bits<span class="w"> </span><span class="m">72</span><span class="w"> </span>index<span class="w"> </span><span class="sb">`</span>PRIMARY<span class="sb">`</span><span class="w"> </span>of<span class="w"> </span>table<span class="w"> </span><span class="sb">`</span>xiaoboluo<span class="sb">`</span>.<span class="sb">`</span>test_deadlock<span class="sb">`</span><span class="w"> </span>trx<span class="w"> </span>id<span class="w"> </span>D20853<span class="w"> </span>lock_mode<span class="w"> </span>X<span class="w"> </span>locks<span class="w"> </span>rec<span class="w"> </span>but<span class="w"> </span>not<span class="w"> </span>gap
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>Record<span class="w"> </span>lock,<span class="w"> </span>heap<span class="w"> </span>no<span class="w"> </span><span class="m">3</span><span class="w"> </span>PHYSICAL<span class="w"> </span>RECORD:<span class="w"> </span>n_fields<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>compact<span class="w"> </span>format<span class="p">;</span><span class="w"> </span>info<span class="w"> </span>bits<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1"># 从这两行持有锁信息计息后面几行调试信息上看，就是事务1正在等待的锁。</span>
</span></code></pre></div>
</details>
</li>
<li>
<details class="note" open="open">
<summary>5.2.5 下面这部分是事务二正在等待的锁，从下面的信息上看，等待的是同一个表，同一个索引，同一个page上的record lock X锁，但是heap no位置不同，即不同的行上的锁：</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>***<span class="w"> </span><span class="o">(</span><span class="m">2</span><span class="o">)</span><span class="w"> </span>WAITING<span class="w"> </span>FOR<span class="w"> </span>THIS<span class="w"> </span>LOCK<span class="w"> </span>TO<span class="w"> </span>BE<span class="w"> </span>GRANTED:
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>RECORD<span class="w"> </span>LOCKS<span class="w"> </span>space<span class="w"> </span>id<span class="w"> </span><span class="m">441</span><span class="w"> </span>page<span class="w"> </span>no<span class="w"> </span><span class="m">3</span><span class="w"> </span>n<span class="w"> </span>bits<span class="w"> </span><span class="m">72</span><span class="w"> </span>index<span class="w"> </span><span class="sb">`</span>PRIMARY<span class="sb">`</span><span class="w"> </span>of<span class="w"> </span>table<span class="w"> </span><span class="sb">`</span>xiaoboluo<span class="sb">`</span>.<span class="sb">`</span>test_deadlock<span class="sb">`</span><span class="w"> </span>trx<span class="w"> </span>id<span class="w"> </span>D20853<span class="w"> </span>lock_mode<span class="w"> </span>X<span class="w"> </span>locks<span class="w"> </span>rec<span class="w"> </span>but<span class="w"> </span>not<span class="w"> </span>gap<span class="w"> </span>waiting
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>Record<span class="w"> </span>lock,<span class="w"> </span>heap<span class="w"> </span>no<span class="w"> </span><span class="m">2</span><span class="w"> </span>PHYSICAL<span class="w"> </span>RECORD:<span class="w"> </span>n_fields<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>compact<span class="w"> </span>format<span class="p">;</span><span class="w"> </span>info<span class="w"> </span>bits<span class="w"> </span><span class="m">0</span><span class="w"> </span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="m">0</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span><span class="m">00000001</span><span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="m">1</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">6</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span>000000d20808<span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="m">2</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">7</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span>ad000001ab0110<span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="m">3</span>:<span class="w"> </span>len<span class="w"> </span><span class="m">4</span><span class="p">;</span><span class="w"> </span>hex<span class="w"> </span><span class="m">00000001</span><span class="p">;</span><span class="w"> </span>asc<span class="w"> </span><span class="p">;;</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>***<span class="w"> </span>WE<span class="w"> </span>ROLL<span class="w"> </span>BACK<span class="w"> </span>TRANSACTION<span class="w"> </span><span class="o">(</span><span class="m">2</span><span class="o">)</span><span class="w"> </span><span class="c1"># 这个表示事务2被回滚，因为两个事务的回滚开销一样，所以选择了后提交的事务进行回滚，如果两个事务回滚的开销不同(undo 数量不同)，那么就回滚开销最小的那个事务。</span>
</span></code></pre></div>
</details>
</li>
<li>
<p>当一个事务持有了其他事务需要的锁，同时又想获得其他事务持有的锁时，等待关系图上就会产生循环，Innodb不会显示所有持有和等待的锁，但是，它显示了足够的信息来帮你确定，查询操作正在使用哪些索引，这对于你确定能否避免死锁有极大的价值。</p>
</li>
<li>如果能使两个查询对同一个索引朝同一个方向进行扫描，就能降低死锁的数目，因为，查询在同一个顺序上请求锁的时候不会创建循环，有时候，这是很容易做到的，如：要在一个事务里更新许多条记录，就可以在应用程序的内存里把它们按照主键进行排序，然后，再用同样的顺序更新到数据库里，这样就不会有死锁发生，但是在另一些时候，这个方法也是行不通的（如果有两个进程使用了不同的索引区间操作同一张表的时候）。</li>
</ul>
</li>
</ul>
</li>
<li>
<h4 id="_6">事务<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h4>
<ul>
<li>
<details class="note" open="open">
<summary>Note</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>------------
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>TRANSACTIONS
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>------------
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>这部分包含了一些关于innodb事务的总结信息，紧随其后的是当前活跃事务列表，如：
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>Trx<span class="w"> </span>id<span class="w"> </span>counter<span class="w"> </span>4E0132AD
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>Purge<span class="w"> </span><span class="k">done</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>trx<span class="err">&#39;</span>s<span class="w"> </span>n:o<span class="w"> </span>&lt;<span class="w"> </span>4E01090B<span class="w"> </span>undo<span class="w"> </span>n:o<span class="w"> </span>&lt;<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>History<span class="w"> </span>list<span class="w"> </span>length<span class="w"> </span><span class="m">1853</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>LIST<span class="w"> </span>OF<span class="w"> </span>TRANSACTIONS<span class="w"> </span>FOR<span class="w"> </span>EACH<span class="w"> </span>SESSION:
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>---TRANSACTION<span class="w"> </span>4E0131D3,<span class="w"> </span>not<span class="w"> </span>started
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>MySQL<span class="w"> </span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">26208218</span>,<span class="w"> </span>OS<span class="w"> </span>thread<span class="w"> </span>handle<span class="w"> </span>0x7fec7c582700,<span class="w"> </span>query<span class="w"> </span>id<span class="w"> </span><span class="m">5274800318</span><span class="w"> </span><span class="m">10</span>.207.162.69<span class="w"> </span>gdsser
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>---TRANSACTION<span class="w"> </span>4E01323F,<span class="w"> </span>not<span class="w"> </span>started
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>MySQL<span class="w"> </span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">26208217</span>,<span class="w"> </span>OS<span class="w"> </span>thread<span class="w"> </span>handle<span class="w"> </span>0x7fec7c1b3700,<span class="w"> </span>query<span class="w"> </span>id<span class="w"> </span><span class="m">5274800938</span><span class="w"> </span><span class="m">10</span>.207.162.69<span class="w"> </span>gdsser
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>....................
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>---TRANSACTION<span class="w"> </span>4E0132AC,<span class="w"> </span>ACTIVE<span class="w"> </span><span class="m">0</span><span class="w"> </span>sec<span class="w"> </span>preparing
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a><span class="m">2</span><span class="w"> </span>lock<span class="w"> </span>struct<span class="o">(</span>s<span class="o">)</span>,<span class="w"> </span>heap<span class="w"> </span>size<span class="w"> </span><span class="m">376</span>,<span class="w"> </span><span class="m">1</span><span class="w"> </span>row<span class="w"> </span>lock<span class="o">(</span>s<span class="o">)</span>,<span class="w"> </span>undo<span class="w"> </span>log<span class="w"> </span>entries<span class="w"> </span><span class="m">1</span>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>MySQL<span class="w"> </span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">26208200</span>,<span class="w"> </span>OS<span class="w"> </span>thread<span class="w"> </span>handle<span class="w"> </span>0x7fec567e0700,<span class="w"> </span>query<span class="w"> </span>id<span class="w"> </span><span class="m">5274801557</span><span class="w"> </span><span class="m">10</span>.207.162.69<span class="w"> </span>gdsser
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>commit
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>---TRANSACTION<span class="w"> </span>4E0110E7,<span class="w"> </span>ACTIVE<span class="w"> </span><span class="m">188</span><span class="w"> </span>sec
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>mysql<span class="w"> </span>tables<span class="w"> </span><span class="k">in</span><span class="w"> </span>use<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>locked<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>MySQL<span class="w"> </span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">26208154</span>,<span class="w"> </span>OS<span class="w"> </span>thread<span class="w"> </span>handle<span class="w"> </span>0x7fec7c235700,<span class="w"> </span>query<span class="w"> </span>id<span class="w"> </span><span class="m">5274800671</span><span class="w"> </span><span class="m">10</span>.143.90.228<span class="w"> </span>root<span class="w"> </span>Sending<span class="w"> </span>data
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>SELECT<span class="w"> </span>/*!40001<span class="w"> </span>SQL_NO_CACHE<span class="w"> </span>*/<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span><span class="sb">`</span>m_flowskillpoint<span class="sb">`</span>
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>Trx<span class="w"> </span><span class="nb">read</span><span class="w"> </span>view<span class="w"> </span>will<span class="w"> </span>not<span class="w"> </span>see<span class="w"> </span>trx<span class="w"> </span>with<span class="w"> </span>id<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span>4E0110E8,<span class="w"> </span>sees<span class="w"> </span>&lt;<span class="w"> </span>4E0108EE
</span><span id="__span-26-25"><a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>---TRANSACTION<span class="w"> </span>4E0108EF,<span class="w"> </span>ACTIVE<span class="w"> </span><span class="m">233</span><span class="w"> </span>sec<span class="w"> </span>fetching<span class="w"> </span>rows
</span><span id="__span-26-26"><a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>mysql<span class="w"> </span>tables<span class="w"> </span><span class="k">in</span><span class="w"> </span>use<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>locked<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-27"><a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>MySQL<span class="w"> </span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">26208131</span>,<span class="w"> </span>OS<span class="w"> </span>thread<span class="w"> </span>handle<span class="w"> </span>0x7fec578e3700,<span class="w"> </span>query<span class="w"> </span>id<span class="w"> </span><span class="m">5274801341</span><span class="w"> </span><span class="m">10</span>.143.90.228<span class="w"> </span>root<span class="w"> </span>Sending<span class="w"> </span>data
</span><span id="__span-26-28"><a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a>SELECT<span class="w"> </span>/*!40001<span class="w"> </span>SQL_NO_CACHE<span class="w"> </span>*/<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span><span class="sb">`</span>m_flowsilver<span class="sb">`</span>
</span><span id="__span-26-29"><a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a>Trx<span class="w"> </span><span class="nb">read</span><span class="w"> </span>view<span class="w"> </span>will<span class="w"> </span>not<span class="w"> </span>see<span class="w"> </span>trx<span class="w"> </span>with<span class="w"> </span>id<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span>4E0108F0,<span class="w"> </span>sees<span class="w"> </span>&lt;<span class="w"> </span>4E0108EC
</span><span id="__span-26-30"><a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a>---TRANSACTION<span class="w"> </span>4E0108EE,<span class="w"> </span>ACTIVE<span class="w"> </span><span class="m">233</span><span class="w"> </span>sec<span class="w"> </span>fetching<span class="w"> </span>rows
</span><span id="__span-26-31"><a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a>mysql<span class="w"> </span>tables<span class="w"> </span><span class="k">in</span><span class="w"> </span>use<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>locked<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-32"><a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a>MySQL<span class="w"> </span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">26208132</span>,<span class="w"> </span>OS<span class="w"> </span>thread<span class="w"> </span>handle<span class="w"> </span>0x7fec7c78a700,<span class="w"> </span>query<span class="w"> </span>id<span class="w"> </span><span class="m">5274797797</span><span class="w"> </span><span class="m">10</span>.143.90.228<span class="w"> </span>root<span class="w"> </span>Sending<span class="w"> </span>data
</span><span id="__span-26-33"><a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a>SELECT<span class="w"> </span>/*!40001<span class="w"> </span>SQL_NO_CACHE<span class="w"> </span>*/<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span><span class="sb">`</span>m_flowmail<span class="sb">`</span>
</span><span id="__span-26-34"><a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a>Trx<span class="w"> </span><span class="nb">read</span><span class="w"> </span>view<span class="w"> </span>will<span class="w"> </span>not<span class="w"> </span>see<span class="w"> </span>trx<span class="w"> </span>with<span class="w"> </span>id<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span>4E0108EF,<span class="w"> </span>sees<span class="w"> </span>&lt;<span class="w"> </span>4E0108EC
</span></code></pre></div></details>
</li>
<li>
<details class="note" open="open">
<summary>6.1</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>Trx<span class="w"> </span>id<span class="w"> </span>counter<span class="w"> </span>4E0132AD<span class="w"> </span><span class="c1"># 这行表示当前事务ID，这是一个系统变量，每创建一个新事务都会增加</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>Purge<span class="w"> </span><span class="k">done</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>trx<span class="err">&#39;</span>s<span class="w"> </span>n:o<span class="w"> </span>&lt;<span class="w"> </span>4E01090B<span class="w"> </span>undo<span class="w"> </span>n:o<span class="w"> </span>&lt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1"># 这是innodb清除旧MVCC行时所用的事务ID，将这个值和当前事务ID进行比较，就可以知道有多少老版本的数据未被清除。</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="c1"># 这个数字多大才可以安全的取值没有硬性和速成的规定，如果数据没做过任何更新，那么一个巨大的数字也不意味着有未清除的数据，</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="c1"># 因为实际上所有事务在数据库里查看的都是同一个版本的数据（此时只是事务ID在增加，而数据没有变更），另一方面，如果有很多行被更新，</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="c1"># 那每一行就会有一个或多个版本留在内存里，减少此类开销的最好办法就是确保事务已完成就立即提交，不要让它长时间地处于打开状态，</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="c1"># 因为一个打开的事务即使不做任何操作，也会影响到innodb清理旧版本的行数据。 undo n:o &lt; 0这个是innodb清理进程正在使用的撤销日志编号，为0 0时说明清理进程处于空闲状态。</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>History<span class="w"> </span>list<span class="w"> </span>length<span class="w"> </span><span class="m">1853</span><span class="w"> </span><span class="c1"># 历史记录的长度，即位于innodb数据文件的撤销空间里的页面的数目，如果事务执行了更新并提交，这个数字就会增加，而当清理进程移除旧版本数据时，它就会减少，清理进程也会更新Purge done for.....这行中的数值。</span>
</span></code></pre></div>
</details>
</li>
<li>
<details class="note" open="open">
<summary>6.2</summary>
<p>头部信息之后就是一个事务列表，当前版本的mysql还不支持嵌套事务，因此，在某个时间点上，每个客户端连接能够拥有的事务数量是有一个上限的，而且每一个事务只能属于单一连接（即一个事务只能使用单个线程执行，不能使用多个线程）。在输出信息里，每一个事务至少占有两行内容，如：
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>---TRANSACTION<span class="w"> </span>4E0131D3,<span class="w"> </span>not<span class="w"> </span>started<span class="w"> </span><span class="c1"># 每个事务的第一行以事务的ID和状态开始，not started表示这个事务已经提交并且没有再发起影响事务的语句，可能刚好空闲</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>MySQL<span class="w"> </span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">26208218</span>,<span class="w"> </span>OS<span class="w"> </span>thread<span class="w"> </span>handle<span class="w"> </span>0x7fec7c582700,<span class="w"> </span>query<span class="w"> </span>id<span class="w"> </span><span class="m">5274800318</span><span class="w"> </span><span class="m">10</span>.207.162.69<span class="w"> </span>gdsser
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="c1"># 然后每个事务的第二行是一些线程等信息，MySQL thread id &lt;数字&gt;部分和是hi用show full processlist;命令看到的id列相同。紧随其后的是一个内部查询id和一些连接信息，这些信息同样与show full processlist中的输出相同。</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>---TRANSACTION<span class="w"> </span>4E01323F,<span class="w"> </span>not<span class="w"> </span>started
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>MySQL<span class="w"> </span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">26208217</span>,<span class="w"> </span>OS<span class="w"> </span>thread<span class="w"> </span>handle<span class="w"> </span>0x7fec7c1b3700,<span class="w"> </span>query<span class="w"> </span>id<span class="w"> </span><span class="m">5274800938</span><span class="w"> </span><span class="m">10</span>.207.162.69<span class="w"> </span>gdsser
</span></code></pre></div></p>
</details>
</li>
<li>
<details class="note" open="open">
<summary>6.3</summary>
<p>上面是not started状态的事务信息，下面来看看为ACTIVE状态的事务信息：
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>---TRANSACTION<span class="w"> </span>4E0110E7,<span class="w"> </span>ACTIVE<span class="w"> </span><span class="m">188</span><span class="w"> </span>sec<span class="w"> </span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="c1"># 这行显示次事务处于活跃状态已经188s，可能的所有状态有not started，active，prepared和committed in memory，一旦事务日志落盘了就会变成not started状态。在时间后面会显示出当前事务正在做什么（在这里为空没有显示出来），在源代码中有超过30个字符串常量可以显示在时间后面，如：fetching，preparing，rows，adding foreign keys等等</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>mysql<span class="w"> </span>tables<span class="w"> </span><span class="k">in</span><span class="w"> </span>use<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>locked<span class="w"> </span><span class="m">0</span><span class="w"> </span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="c1"># 该事务用到的表数和涉及表锁的表数，Innodb一般不会锁定表，但对有些语句会锁定，如果mysql服务器在高于innodb层之上将表锁定，这里也是能够显示出来的，如果事务已经锁定了几行数据，这里将会有一行信息显示出锁定结构的数目（注意，这跟行锁是两回事）和和堆大小，如：2 lock struct(s), heap size 376, 1 row lock(s), undo log entries 1，堆的大小指的是为了持有这些行锁而占用的内存大小，Innodb是用一种特殊的位图表来实现行锁的，从理论上讲，它可将每一个锁定的行表示为一个比特，经测试显示，每个锁通常不超过4比特。</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>MySQL<span class="w"> </span>thread<span class="w"> </span>id<span class="w"> </span><span class="m">26208154</span>,<span class="w"> </span>OS<span class="w"> </span>thread<span class="w"> </span>handle<span class="w"> </span>0x7fec7c235700,<span class="w"> </span>query<span class="w"> </span>id<span class="w"> </span><span class="m">5274800671</span><span class="w"> </span><span class="m">10</span>.143.90.228<span class="w"> </span>root<span class="w"> </span>Sending<span class="w"> </span>data<span class="w"> </span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="c1"># 与show processlist输出结果大部分相同</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>SELECT<span class="w"> </span>/*!40001<span class="w"> </span>SQL_NO_CACHE<span class="w"> </span>*/<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span><span class="sb">`</span>m_flowskillpoint<span class="sb">`</span><span class="w"> </span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="c1"># 如果事务正在运行一个查询，那么这里就会显示事务涉及的SQL，注意：有些版本可能只显示其中一小段，而不是完整的SQL</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>Trx<span class="w"> </span><span class="nb">read</span><span class="w"> </span>view<span class="w"> </span>will<span class="w"> </span>not<span class="w"> </span>see<span class="w"> </span>trx<span class="w"> </span>with<span class="w"> </span>id<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span>4E0110E8,<span class="w"> </span>sees<span class="w"> </span>&lt;<span class="w"> </span>4E0108EE<span class="w"> </span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="c1"># 这行显示了事务的读视图，它表明了因为版本关系而产生的对于事务可见和不可见两种类型的事务ID的范围，在这里，两个数字之间有一个事务的间隙，这个间隙里的事务可能是不可见的，innodb在执行查询时，对于那些事务ID正好在这个间隙的行，还会检查其可见性。</span>
</span></code></pre></div></p>
</details>
</li>
<li>注：如果事务正在等待一个锁，那么在查询SQL文本后面将可以看到这个锁的信息，在上文的死锁例子里，这样的信息看到过很多了，不幸的是，输出信息并没有说出这个锁正被其他哪个事务持有，</li>
<li>不过可以通过information_schema库下的innodb_trx，innodb_lock_waits，innodb_locks三个表来查明这一点。如果输出信息里有很多个事务，innodb可能会限制要打印出来的事务数目，以免输出信息增长得太大，这时就会看到...truncated...提示。</li>
</ul>
</li>
<li>
<h4 id="io">文件I/O<a class="headerlink" href="#io" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>FILE I/O部分显示的是I/O辅助线程的状态，还有性能计数器的状态，如下：</p>
</li>
<li>
<details class="note" open="open">
<summary>Note</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>--------
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>FILE<span class="w"> </span>I/O
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>--------
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>I/O<span class="w"> </span>thread<span class="w"> </span><span class="m">0</span><span class="w"> </span>state:<span class="w"> </span>waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>i/o<span class="w"> </span>request<span class="w"> </span><span class="o">(</span>insert<span class="w"> </span>buffer<span class="w"> </span>thread<span class="o">)</span><span class="w"> </span><span class="c1"># insert buffer thread</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>I/O<span class="w"> </span>thread<span class="w"> </span><span class="m">1</span><span class="w"> </span>state:<span class="w"> </span>waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>i/o<span class="w"> </span>request<span class="w"> </span><span class="o">(</span>log<span class="w"> </span>thread<span class="o">)</span><span class="w"> </span><span class="c1"># log thread</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>I/O<span class="w"> </span>thread<span class="w"> </span><span class="m">2</span><span class="w"> </span>state:<span class="w"> </span>waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>i/o<span class="w"> </span>request<span class="w"> </span><span class="o">(</span><span class="nb">read</span><span class="w"> </span>thread<span class="o">)</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>I/O<span class="w"> </span>thread<span class="w"> </span><span class="m">3</span><span class="w"> </span>state:<span class="w"> </span>waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>i/o<span class="w"> </span>request<span class="w"> </span><span class="o">(</span><span class="nb">read</span><span class="w"> </span>thread<span class="o">)</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>I/O<span class="w"> </span>thread<span class="w"> </span><span class="m">4</span><span class="w"> </span>state:<span class="w"> </span>waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>i/o<span class="w"> </span>request<span class="w"> </span><span class="o">(</span><span class="nb">read</span><span class="w"> </span>thread<span class="o">)</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>I/O<span class="w"> </span>thread<span class="w"> </span><span class="m">5</span><span class="w"> </span>state:<span class="w"> </span>doing<span class="w"> </span>file<span class="w"> </span>i/o<span class="w"> </span><span class="o">(</span><span class="nb">read</span><span class="w"> </span>thread<span class="o">)</span><span class="w"> </span>ev<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="c1"># 以上为默认的4个read thread</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>I/O<span class="w"> </span>thread<span class="w"> </span><span class="m">6</span><span class="w"> </span>state:<span class="w"> </span>waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>i/o<span class="w"> </span>request<span class="w"> </span><span class="o">(</span>write<span class="w"> </span>thread<span class="o">)</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>I/O<span class="w"> </span>thread<span class="w"> </span><span class="m">7</span><span class="w"> </span>state:<span class="w"> </span>waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>i/o<span class="w"> </span>request<span class="w"> </span><span class="o">(</span>write<span class="w"> </span>thread<span class="o">)</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>I/O<span class="w"> </span>thread<span class="w"> </span><span class="m">8</span><span class="w"> </span>state:<span class="w"> </span>waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>i/o<span class="w"> </span>request<span class="w"> </span><span class="o">(</span>write<span class="w"> </span>thread<span class="o">)</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>I/O<span class="w"> </span>thread<span class="w"> </span><span class="m">9</span><span class="w"> </span>state:<span class="w"> </span>waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>i/o<span class="w"> </span>request<span class="w"> </span><span class="o">(</span>write<span class="w"> </span>thread<span class="o">)</span><span class="w"> </span><span class="c1"># 以上为默认的4个write thread</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>Pending<span class="w"> </span>normal<span class="w"> </span>aio<span class="w"> </span>reads:<span class="w"> </span><span class="m">128</span><span class="w"> </span><span class="o">[</span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">128</span><span class="o">]</span><span class="w"> </span>,<span class="w"> </span>aio<span class="w"> </span>writes:<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">[</span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span><span class="o">]</span><span class="w"> </span>,<span class="w"> </span><span class="c1"># 读线程和写线程挂起操作的数目等，aio的意思是异步I/O</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>ibuf<span class="w"> </span>aio<span class="w"> </span>reads:<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>log<span class="w"> </span>i/o<span class="s1">&#39;s: 0, sync i/o&#39;</span>s:<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1"># insert buffer thread挂起的fsync()操作数目等</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>Pending<span class="w"> </span>flushes<span class="w"> </span><span class="o">(</span>fsync<span class="o">)</span><span class="w"> </span>log:<span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span>buffer<span class="w"> </span>pool:<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1"># log thread挂起的fsync()操作数目等</span>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a><span class="m">146246831</span><span class="w"> </span>OS<span class="w"> </span>file<span class="w"> </span>reads,<span class="w"> </span><span class="m">760501349</span><span class="w"> </span>OS<span class="w"> </span>file<span class="w"> </span>writes,<span class="w"> </span><span class="m">247143684</span><span class="w"> </span>OS<span class="w"> </span>fsyncs<span class="w"> </span><span class="c1"># 这行显示了读，写和fsync()调用执行的数目，在你的机器环境负载下这些绝对值可能会有所不同，因此更重要的是监控它们过去一段时间内是如何改变的。</span>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a><span class="m">1</span><span class="w"> </span>pending<span class="w"> </span>preads,<span class="w"> </span><span class="m">0</span><span class="w"> </span>pending<span class="w"> </span>pwrites<span class="w"> </span><span class="c1"># 这行显示了当前被挂起的读和写操作数</span>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a><span class="m">145</span>.49<span class="w"> </span>reads/s,<span class="w"> </span><span class="m">783677</span><span class="w"> </span>avg<span class="w"> </span>bytes/read,<span class="w"> </span><span class="m">28</span>.75<span class="w"> </span>writes/s,<span class="w"> </span><span class="m">10</span>.67<span class="w"> </span>fsyncs/s<span class="w"> </span><span class="c1"># 这行显示了在头部显示的时间（指的是第1部分的时间）段内的每秒平均值。</span>
</span></code></pre></div>
</details>
</li>
<li>注：三行挂起读写线程、缓冲池线程、日志线程的统计信息的值是检测I/O受限的应用的一个好方法，如果这些I/O大部分有挂起操作，那么负载可能I/O受限。在linux系统下使用参数：innodb_read_io_threads和innodb_write_io_threads两个变量来配置读写线程的数量，默认为各4个线程。</li>
<li>insert buffer thread：负责插入缓冲合并，如：记录被从插入缓冲合并到表空间中</li>
<li>log thread：负责异步刷事务日志</li>
<li>read thread：执行预读操作以尝试预先读取innodb预感需要的数据</li>
<li>write thread：刷新脏页缓冲</li>
</ul>
</li>
<li>
<h4 id="insert-bufferadaptive-hash-index">这部分显示了insert buffer和adaptive hash index两个部分的结构的状态<a class="headerlink" href="#insert-bufferadaptive-hash-index" title="Permanent link">&para;</a></h4>
<ul>
<li>
<details class="note" open="open">
<summary>Note</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>-------------------------------------
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>INSERT<span class="w"> </span>BUFFER<span class="w"> </span>AND<span class="w"> </span>ADAPTIVE<span class="w"> </span>HASH<span class="w"> </span>INDEX
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>-------------------------------------
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>Ibuf:<span class="w"> </span>size<span class="w"> </span><span class="m">12</span>,<span class="w"> </span>free<span class="w"> </span>list<span class="w"> </span>len<span class="w"> </span><span class="m">27559</span>,<span class="w"> </span>seg<span class="w"> </span>size<span class="w"> </span><span class="m">27572</span>,<span class="w"> </span><span class="m">18074934</span><span class="w"> </span>merges<span class="w"> </span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="c1"># 这行显示了关于size（size 12代表了已经合并记录页的数量）、free list（代表了插入缓冲中空闲列表长度）和seg size大小（seg size 27572显示了当前insert buffer的长度，大小为27572\*16K=440M左右）的信息。18074934 merges代表合并插入的次数</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>merged<span class="w"> </span>operations:<span class="w"> </span><span class="c1"># 这个标签下的一行信息insert，delete mark，delete分别表示merge操作合并了多少个insert buffer，delete buffer，purge buffer</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>insert<span class="w"> </span><span class="m">81340470</span>,<span class="w"> </span>delete<span class="w"> </span>mark<span class="w"> </span><span class="m">8893610</span>,<span class="w"> </span>delete<span class="w"> </span><span class="m">818579</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>discarded<span class="w"> </span>operations:<span class="w"> </span><span class="c1"># 这个标签下的一行信息表示当change buffer发生merge时表已经被删除了，就不需要再将记录合并到辅助索引中了</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>insert<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>delete<span class="w"> </span>mark<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>delete<span class="w"> </span><span class="m">0</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>Hash<span class="w"> </span>table<span class="w"> </span>size<span class="w"> </span><span class="m">87709057</span>,<span class="w"> </span>node<span class="w"> </span>heap<span class="w"> </span>has<span class="w"> </span><span class="m">10228</span><span class="w"> </span>buffer<span class="o">(</span>s<span class="o">)</span><span class="w"> </span><span class="c1"># 这行显示了自使用哈希索引的状态，其中，Hash table size 87709057表示AHI的大小，node heap has 10228 buffer(s)表示AHI的使用情况</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="m">1741</span>.05<span class="w"> </span><span class="nb">hash</span><span class="w"> </span>searches/s,<span class="w"> </span><span class="m">539</span>.48<span class="w"> </span>non-hash<span class="w"> </span>searches/s<span class="w"> </span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="c1"># 这行显示了在头部第1部分提及的时间内Innodb每秒完成了多少哈希索引操作，</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="c1"># 1741.05 hash searches/s表示每秒使用AHI搜索的情况，</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a><span class="c1"># 539.48 non-hash searches/s表示每秒没有使用AHI搜索的情况(因为哈希索引只能用于等值查询，而范围查询，模糊查询是不能使用哈希索引的。)，</span>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a><span class="c1"># 通过hash searches: non-hash searches的比例大概可以了解使用哈希索引后的效率，哈希索引查找与非哈希索引查找的比例仅供参考，自适应哈希索引无法配置，</span>
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a><span class="c1"># 但是可以通过innodb_adaptive_hash_index=ON|OFF参数来选择是否需要这个特性。</span>
</span></code></pre></div></details>
</li>
<li>
<p>注：</p>
<ul>
<li>innodb从1.0.x开始引入change buffer，可以视为insert buffer的升级，从这个版本开始，innodb可以对DML操作(insert,delete,update)都进行缓冲，他们分别是insert buffer,delete buffer,purge buffer，当然和之前insert buffer一样，change buffer适用对象仍然是非唯一索引的辅助索引，因为没有update buffer，所以对一条记录进行update的操作可以分为两个过程：</li>
</ul>
</li>
<li>
<p>A：将记录标记为删除</p>
</li>
<li>B：真正将记录删除
因此，delete buffer对应update 操作的第一个过程，即将记录标记为删除，purge buffer对应update的第二个过程，即将记录真正地删除</li>
</ul>
</li>
<li>
<h4 id="innodb">这部分显示了关于innodb事务日志（重做日志）子系统的统计：<a class="headerlink" href="#innodb" title="Permanent link">&para;</a></h4>
<ul>
<li>
<details class="note" open="open">
<summary>Note</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>---
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>LOG
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>---
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>Log<span class="w"> </span>sequence<span class="w"> </span>number<span class="w"> </span><span class="m">1351392990515</span><span class="w"> </span><span class="c1"># 这行显示了当前最新数据产生的日志序列号</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>Log<span class="w"> </span>flushed<span class="w"> </span>up<span class="w"> </span>to<span class="w"> </span><span class="m">1351392989504</span><span class="w"> </span><span class="c1"># 这行显示了日志已经刷新到哪个位置了（已经落盘到事务日志中的日志序列号）</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>Last<span class="w"> </span>checkpoint<span class="w"> </span>at<span class="w"> </span><span class="m">1351373900020</span><span class="w"> </span><span class="c1"># 这行显示了上一次检查点的位置（一个检查点表示一个数据和日志文件都处于一致状态的时刻，并且能用于恢复数据），如果上一次检查点落后与上一行太多，并且差异接近于事务日志文件的大小，Innodb会触发“疯狂刷”，这对性能而言非常糟糕。</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="m">0</span><span class="w"> </span>pending<span class="w"> </span>log<span class="w"> </span>writes,<span class="w"> </span><span class="m">0</span><span class="w"> </span>pending<span class="w"> </span>chkp<span class="w"> </span>writes<span class="w"> </span><span class="c1"># 这行显示了当前挂起的日志读写操作，可以将这行的值与第7部分FILE I/O对应的值做比较，以了解你的I/O有多少是由于日志系统引起的。</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="m">286879989</span><span class="w"> </span>log<span class="w"> </span>i/o<span class="s1">&#39;s done, 15.92 log i/o&#39;</span>s/second<span class="w"> </span><span class="c1"># 这行显示了日志操作的统计和每秒日志I/O数，可以将这行的值与第7部分FILE I/O对应的值做比较，以了解你的I/O有多少是由于日志系统引起的。</span>
</span></code></pre></div></details>
</li>
<li>
<details class="note" open="open">
<summary>9.1 这部分显示了关于innodb缓冲池及其如何使用内存的统计：</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>----------------------
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>BUFFER<span class="w"> </span>POOL<span class="w"> </span>AND<span class="w"> </span>MEMORY
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>----------------------
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>Total<span class="w"> </span>memory<span class="w"> </span>allocated<span class="w"> </span><span class="m">45357793280</span><span class="p">;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>additional<span class="w"> </span>pool<span class="w"> </span>allocated<span class="w"> </span><span class="m">0</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="c1"># 这行显示了由innodb分配的总内存，以及其中多少是额外内存池分配，额外内存池仅分配了其中很小一部分内存，由内部内存分配器分配，现在的innodb版本一般使用操作系统的内存分配器，但老版本使用自己的，这是由于在那个时代有些操作系统并未提供一个非常好的内存分配实现。</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>Dictionary<span class="w"> </span>memory<span class="w"> </span>allocated<span class="w"> </span><span class="m">12681573</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>Buffer<span class="w"> </span>pool<span class="w"> </span>size<span class="w"> </span><span class="m">2705015</span><span class="w"> </span><span class="c1"># 从这行开始的下面4行显示缓冲池度量值，以页为单位，度量值有总的缓冲池大小，空闲页数，分配用来存储数据库页的页数，以及脏数据库页数。这行显示了缓冲池总共有多少个页，即即2705015\*16K，共有43G的缓冲池</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>Free<span class="w"> </span>buffers<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c1"># 这行显示了缓冲池空闲页数</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>Database<span class="w"> </span>pages<span class="w"> </span><span class="m">2694782</span><span class="w"> </span><span class="c1"># 这行显示了分配用来存储数据库页的页数，即，表示LRU列表中页的数量,包含young sublist和old sublist</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>Old<span class="w"> </span>database<span class="w"> </span>pages<span class="w"> </span><span class="m">994651</span><span class="w"> </span><span class="c1"># 这行显示了LRU中的old sublist部分页的数量</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>Modified<span class="w"> </span>db<span class="w"> </span>pages<span class="w"> </span><span class="m">10610</span><span class="w"> </span><span class="c1"># 这行显示脏数据库页数</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a>Pending<span class="w"> </span>reads<span class="w"> </span><span class="m">128</span><span class="w"> </span><span class="c1"># 这行显示了挂起读的数量</span>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a>Pending<span class="w"> </span>writes:<span class="w"> </span>LRU<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>flush<span class="w"> </span>list<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>single<span class="w"> </span>page<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1"># 这行显示了挂起写的数量</span>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="c1"># 注意，这里挂起的读和写操作并不与FILE I/O部分的值匹配，因为Innodb可能合并许多的逻辑读写操作到一个物理I/O操作中，LRU代表最近使用到的被挂起数量，它是通过冲刷缓冲中不经常使用的页来释放空间以供给经常使用的页的一种方法，冲刷列表flush list存放着检查点处理需要冲刷的旧页被挂起的数量，单页single page被挂起的数量（single page写是独立的页面写，不会被合并)。</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a>
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a>Pages<span class="w"> </span>made<span class="w"> </span>young<span class="w"> </span><span class="m">3014373561</span>,<span class="w"> </span>not<span class="w"> </span>young<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1"># 这行显示了LRU列表中页移动到LRU首部的次数，因为该服务器在运行阶段改变没有达到innodb_old_blocks_time阀值的值，因此not young为0</span>
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a>
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a><span class="m">6960</span>.42<span class="w"> </span>youngs/s,<span class="w"> </span><span class="m">0</span>.00<span class="w"> </span>non-youngs/s<span class="w"> </span><span class="c1"># 表示每秒young和non-youngs这两类操作的次数</span>
</span><span id="__span-33-22"><a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a>
</span><span id="__span-33-23"><a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a>Pages<span class="w"> </span><span class="nb">read</span><span class="w"> </span><span class="m">2946570833</span>,<span class="w"> </span>created<span class="w"> </span><span class="m">43450158</span>,<span class="w"> </span>written<span class="w"> </span><span class="m">574214278</span><span class="w"> </span>
</span><span id="__span-33-24"><a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a><span class="c1"># 这行显示了innodb被读取，创建，写入了多少页，读/写页的值是指的从磁盘读到缓冲池的数据，或者从缓冲池写到磁盘中的数据，创建页指的是innodb在缓冲池中分配但没有从数据文件中读取内容的页，因为它并不关心内容是什么（如，它们可能属于一个已经被删除的表）</span>
</span><span id="__span-33-25"><a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a>
</span><span id="__span-33-26"><a id="__codelineno-33-26" name="__codelineno-33-26" href="#__codelineno-33-26"></a><span class="m">6960</span>.54<span class="w"> </span>reads/s,<span class="w"> </span><span class="m">4</span>.42<span class="w"> </span>creates/s,<span class="w"> </span><span class="m">9</span>.33<span class="w"> </span>writes/s<span class="w"> </span><span class="c1"># 这行显示了对应上面一行的每秒read，create，write的页数</span>
</span><span id="__span-33-27"><a id="__codelineno-33-27" name="__codelineno-33-27" href="#__codelineno-33-27"></a>
</span><span id="__span-33-28"><a id="__codelineno-33-28" name="__codelineno-33-28" href="#__codelineno-33-28"></a>Buffer<span class="w"> </span>pool<span class="w"> </span>hit<span class="w"> </span>rate<span class="w"> </span><span class="m">955</span><span class="w"> </span>/<span class="w"> </span><span class="m">1000</span>,<span class="w"> </span>young-making<span class="w"> </span>rate<span class="w"> </span><span class="m">45</span><span class="w"> </span>/<span class="w"> </span><span class="m">1000</span><span class="w"> </span>not<span class="w"> </span><span class="m">0</span><span class="w"> </span>/<span class="w"> </span><span class="m">1000</span><span class="w"> </span>
</span><span id="__span-33-29"><a id="__codelineno-33-29" name="__codelineno-33-29" href="#__codelineno-33-29"></a><span class="c1"># 这行显示了缓冲池的命中率，它用来衡量innodb在缓冲池中查找到所需页的比例，它度量自上次Innodb状态输出后到本次输出这段时间内的命中率，因此，如果服务器自那以后一直很安静，你将会看到No buffer pool page gets since the last printout。它对于度量缓存池的大小并没有用处。</span>
</span><span id="__span-33-30"><a id="__codelineno-33-30" name="__codelineno-33-30" href="#__codelineno-33-30"></a>
</span><span id="__span-33-31"><a id="__codelineno-33-31" name="__codelineno-33-31" href="#__codelineno-33-31"></a>
</span><span id="__span-33-32"><a id="__codelineno-33-32" name="__codelineno-33-32" href="#__codelineno-33-32"></a>Pages<span class="w"> </span><span class="nb">read</span><span class="w"> </span>ahead<span class="w"> </span><span class="m">6928</span>.54/s,<span class="w"> </span>evicted<span class="w"> </span>without<span class="w"> </span>access<span class="w"> </span><span class="m">8</span>.21/s,<span class="w"> </span>Random<span class="w"> </span><span class="nb">read</span><span class="w"> </span>ahead<span class="w"> </span><span class="m">0</span>.00/s<span class="w"> </span>**#这行显示了页面预读，随机预读的每秒页数**
</span><span id="__span-33-33"><a id="__codelineno-33-33" name="__codelineno-33-33" href="#__codelineno-33-33"></a>LRU<span class="w"> </span>len:<span class="w"> </span><span class="m">2694782</span>,<span class="w"> </span>unzip_LRU<span class="w"> </span>len:<span class="w"> </span><span class="m">0</span><span class="w"> </span>**#innodb1.0.x开始支持压缩页的功能，将原来16K的页压缩为1K，2K，4K，8K，而由于页的大小发生了变化，LRU列表也有了些改变，对于非16K的页，是通过unzip_LRU列表进行管理的，可以看到unzip_LRU<span class="w"> </span>len为0表示没有使用压缩页.**
</span><span id="__span-33-34"><a id="__codelineno-33-34" name="__codelineno-33-34" href="#__codelineno-33-34"></a>I/O<span class="w"> </span>sum<span class="o">[</span><span class="m">60790</span><span class="o">]</span>:cur<span class="o">[</span><span class="m">30</span><span class="o">]</span>,<span class="w"> </span>unzip<span class="w"> </span>sum<span class="o">[</span><span class="m">0</span><span class="o">]</span>:cur<span class="o">[</span><span class="m">0</span><span class="o">]</span>
</span></code></pre></div>
</details>
</li>
<li>
<p>对于压缩页的表，每个表的压缩比例可能不同，可能存在有的表页大小为8K，有的表页大小为2K的情况，unzip_LRUs 怎样从缓存池中分配内存的呢？</p>
<ul>
<li>首先，在unzip_LRU列表中对不同压缩页大小的页进行分别管理，其次，通过伙伴算法进行内存的分配，例如：需要从缓存池中申请页为4K的大小，其过程如下：</li>
<li>a：检查4K的unzip_LRU列表，检查是否有可用的空闲页</li>
<li>b：若有，则直接使用</li>
<li>c：若没有，检查8K的unzip_LRU列表</li>
<li>d：若能够得到空闲页，将页分成2个4K的页，存放到4K的unzip_LRU列表</li>
<li>e：若不能得到空闲页，从LRU列表中申请一个16K的页，将页分成1个8K，2个4K的页，分别存放到各自大小对应的unzip_LRU列表中。</li>
</ul>
</li>
<li>
<p>注：可能出现Free buffers和Database pages之和不等于Buffer pool size，因为缓冲池中的页肯会被分配给自适应哈希索引，lock信息，insert buffer等，而这部分页不需要LRU算法进行维护，因此不在LRU列表中。</p>
</li>
<li>
<details class="note" open="open">
<summary>9.2.如果innodb buffer pool使用参数innodb</summary>
<p><code>_buffer_pool_instances=num</code>设置了大于1个缓冲池实例，那么就会按照这个参数把<code>innodb_buffer_pool_size=xxx</code>平分为num份。每份的信息显示类似如下，这部分的内容和9.1小节内容类似，就不再多说。
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>----------------------
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>INDIVIDUAL<span class="w"> </span>BUFFER<span class="w"> </span>POOL<span class="w"> </span>INFO
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>----------------------
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>---BUFFER<span class="w"> </span>POOL<span class="w"> </span><span class="m">0</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>Buffer<span class="w"> </span>pool<span class="w"> </span>size<span class="w"> </span><span class="m">541003</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>Free<span class="w"> </span>buffers<span class="w"> </span><span class="m">1</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>Database<span class="w"> </span>pages<span class="w"> </span><span class="m">538965</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>Old<span class="w"> </span>database<span class="w"> </span>pages<span class="w"> </span><span class="m">198933</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>Modified<span class="w"> </span>db<span class="w"> </span>pages<span class="w"> </span><span class="m">2190</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>Pending<span class="w"> </span>reads<span class="w"> </span><span class="m">128</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>Pending<span class="w"> </span>writes:<span class="w"> </span>LRU<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>flush<span class="w"> </span>list<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>single<span class="w"> </span>page<span class="w"> </span><span class="m">0</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>Pages<span class="w"> </span>made<span class="w"> </span>young<span class="w"> </span><span class="m">603372180</span>,<span class="w"> </span>not<span class="w"> </span>young<span class="w"> </span><span class="m">0</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="m">1441</span>.81<span class="w"> </span>youngs/s,<span class="w"> </span><span class="m">0</span>.00<span class="w"> </span>non-youngs/s
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>Pages<span class="w"> </span><span class="nb">read</span><span class="w"> </span><span class="m">589705199</span>,<span class="w"> </span>created<span class="w"> </span><span class="m">8703138</span>,<span class="w"> </span>written<span class="w"> </span><span class="m">116954697</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="m">1441</span>.61<span class="w"> </span>reads/s,<span class="w"> </span><span class="m">0</span>.75<span class="w"> </span>creates/s,<span class="w"> </span><span class="m">1</span>.83<span class="w"> </span>writes/s
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>Buffer<span class="w"> </span>pool<span class="w"> </span>hit<span class="w"> </span>rate<span class="w"> </span><span class="m">955</span><span class="w"> </span>/<span class="w"> </span><span class="m">1000</span>,<span class="w"> </span>young-making<span class="w"> </span>rate<span class="w"> </span><span class="m">45</span><span class="w"> </span>/<span class="w"> </span><span class="m">1000</span><span class="w"> </span>not<span class="w"> </span><span class="m">0</span><span class="w"> </span>/<span class="w"> </span><span class="m">1000</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a>Pages<span class="w"> </span><span class="nb">read</span><span class="w"> </span>ahead<span class="w"> </span><span class="m">1436</span>.98/s,<span class="w"> </span>evicted<span class="w"> </span>without<span class="w"> </span>access<span class="w"> </span><span class="m">0</span>.87/s,<span class="w"> </span>Random<span class="w"> </span><span class="nb">read</span><span class="w"> </span>ahead<span class="w"> </span><span class="m">0</span>.00/s
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a>LRU<span class="w"> </span>len:<span class="w"> </span><span class="m">538965</span>,<span class="w"> </span>unzip_LRU<span class="w"> </span>len:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>I/O<span class="w"> </span>sum<span class="o">[</span><span class="m">12158</span><span class="o">]</span>:cur<span class="o">[</span><span class="m">6</span><span class="o">]</span>,<span class="w"> </span>unzip<span class="w"> </span>sum<span class="o">[</span><span class="m">0</span><span class="o">]</span>:cur<span class="o">[</span><span class="m">0</span><span class="o">]</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a>---BUFFER<span class="w"> </span>POOL<span class="w"> </span><span class="m">1</span>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a>Buffer<span class="w"> </span>pool<span class="w"> </span>size<span class="w"> </span><span class="m">541003</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a>Free<span class="w"> </span>buffers<span class="w"> </span><span class="m">1</span>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a>Database<span class="w"> </span>pages<span class="w"> </span><span class="m">538959</span>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a>Old<span class="w"> </span>database<span class="w"> </span>pages<span class="w"> </span><span class="m">198931</span>
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a>Modified<span class="w"> </span>db<span class="w"> </span>pages<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a>Pending<span class="w"> </span>reads<span class="w"> </span><span class="m">0</span>
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a>Pending<span class="w"> </span>writes:<span class="w"> </span>LRU<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>flush<span class="w"> </span>list<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>single<span class="w"> </span>page<span class="w"> </span><span class="m">0</span>
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a>Pages<span class="w"> </span>made<span class="w"> </span>young<span class="w"> </span><span class="m">602366394</span>,<span class="w"> </span>not<span class="w"> </span>young<span class="w"> </span><span class="m">0</span>
</span><span id="__span-34-29"><a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a><span class="m">1481</span>.35<span class="w"> </span>youngs/s,<span class="w"> </span><span class="m">0</span>.00<span class="w"> </span>non-youngs/s
</span><span id="__span-34-30"><a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a>Pages<span class="w"> </span><span class="nb">read</span><span class="w"> </span><span class="m">588738997</span>,<span class="w"> </span>created<span class="w"> </span><span class="m">8708171</span>,<span class="w"> </span>written<span class="w"> </span><span class="m">113209540</span>
</span><span id="__span-34-31"><a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a><span class="m">1480</span>.56<span class="w"> </span>reads/s,<span class="w"> </span><span class="m">0</span>.83<span class="w"> </span>creates/s,<span class="w"> </span><span class="m">1</span>.92<span class="w"> </span>writes/s
</span><span id="__span-34-32"><a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a>Buffer<span class="w"> </span>pool<span class="w"> </span>hit<span class="w"> </span>rate<span class="w"> </span><span class="m">958</span><span class="w"> </span>/<span class="w"> </span><span class="m">1000</span>,<span class="w"> </span>young-making<span class="w"> </span>rate<span class="w"> </span><span class="m">42</span><span class="w"> </span>/<span class="w"> </span><span class="m">1000</span><span class="w"> </span>not<span class="w"> </span><span class="m">0</span><span class="w"> </span>/<span class="w"> </span><span class="m">1000</span>
</span><span id="__span-34-33"><a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a>Pages<span class="w"> </span><span class="nb">read</span><span class="w"> </span>ahead<span class="w"> </span><span class="m">1473</span>.73/s,<span class="w"> </span>evicted<span class="w"> </span>without<span class="w"> </span>access<span class="w"> </span><span class="m">1</span>.96/s,<span class="w"> </span>Random<span class="w"> </span><span class="nb">read</span><span class="w"> </span>ahead<span class="w"> </span><span class="m">0</span>.00/s
</span><span id="__span-34-34"><a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a>LRU<span class="w"> </span>len:<span class="w"> </span><span class="m">538959</span>,<span class="w"> </span>unzip_LRU<span class="w"> </span>len:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-34-35"><a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a>I/O<span class="w"> </span>sum<span class="o">[</span><span class="m">12158</span><span class="o">]</span>:cur<span class="o">[</span><span class="m">6</span><span class="o">]</span>,<span class="w"> </span>unzip<span class="w"> </span>sum<span class="o">[</span><span class="m">0</span><span class="o">]</span>:cur<span class="o">[</span><span class="m">0</span><span class="o">]</span>
</span></code></pre></div></p>
</details>
</li>
</ul>
</li>
<li>
<h4 id="innodb_1">这部分显示了其他各项的innodb统计：<a class="headerlink" href="#innodb_1" title="Permanent link">&para;</a></h4>
<ul>
<li>
<details class="note" open="open">
<summary>Note</summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>--------------
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>ROW<span class="w"> </span>OPERATIONS
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>--------------
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="m">0</span><span class="w"> </span>queries<span class="w"> </span>inside<span class="w"> </span>InnoDB,<span class="w"> </span><span class="m">0</span><span class="w"> </span>queries<span class="w"> </span><span class="k">in</span><span class="w"> </span>queue<span class="w"> </span><span class="c1"># 这行显示了innodb内核内有多少个线程，队列中有多少个线程，队列中的查询是innodb为限制并发执行的线程数量而不运行进入内核的线程。查询在进入队列之前会休眠等待。</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="m">5</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>views<span class="w"> </span>open<span class="w"> </span>inside<span class="w"> </span>InnoDB<span class="w"> </span><span class="c1"># 这行显示了有多少打开的innodb读视图，读视图是包含事务开始点的数据库内容的MVCC快照，你可以看看某特定事务在第6部分TRANSACTIONS是否有读视图</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>Main<span class="w"> </span>thread<span class="w"> </span>process<span class="w"> </span>no.<span class="w"> </span><span class="m">4368</span>,<span class="w"> </span>id<span class="w"> </span><span class="m">140653691242240</span>,<span class="w"> </span>state:<span class="w"> </span>sleeping<span class="w"> </span><span class="c1"># 这行显示了内核的主线程状态</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>Number<span class="w"> </span>of<span class="w"> </span>rows<span class="w"> </span>inserted<span class="w"> </span><span class="m">3429012215</span>,<span class="w"> </span>updated<span class="w"> </span><span class="m">153529675</span>,<span class="w"> </span>deleted<span class="w"> </span><span class="m">112310240</span>,<span class="w"> </span><span class="nb">read</span><span class="w"> </span><span class="m">3739562987410</span><span class="w"> </span><span class="c1"># 这行显示了多少行被插入，更新和删除，读取</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="m">428</span>.52<span class="w"> </span>inserts/s,<span class="w"> </span><span class="m">7</span>.21<span class="w"> </span>updates/s,<span class="w"> </span><span class="m">0</span>.46<span class="w"> </span>deletes/s,<span class="w"> </span><span class="m">1047933</span>.92<span class="w"> </span>reads/s<span class="w"> </span><span class="c1"># 这行显示了对应上面一行的每秒平均值，如果想查看innodb有多少工作量在进行，那么这两行是很好的参考值</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>----------------------------
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>END<span class="w"> </span>OF<span class="w"> </span>INNODB<span class="w"> </span>MONITOR<span class="w"> </span>OUTPUT<span class="w"> </span><span class="c1"># 要注意了，如果看不到这行输出，可能是有大量事务或者是有一个大的死锁截断了输出信息</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="o">============================</span>
</span></code></pre></div></details>
</li>
<li>
<p>注：内核的主线程状态可能的状态值有如下一些：</p>
</li>
<li>A：doing background drop tables</li>
<li>B：doing insert buffer merge</li>
<li>C：flushing buffer pool pages</li>
<li>D：making checkpoint</li>
<li>E：purging</li>
<li>F：reserving kernel mutex</li>
<li>G：sleeping</li>
<li>H：suspending</li>
<li>I：waiting for buffer pool flush to end</li>
<li>J：waiting for server activity</li>
</ul>
</li>
</ol>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2022 - 2023 - lyvivian0077
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tracking", "navigation.top", "navigation.indexes", "navigation.path", "content.code.copy", "toc.follow"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  </body>
</html>