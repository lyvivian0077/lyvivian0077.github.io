{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to My Docs","text":"xxx  details\u30bf\u30b0 \u6298\u308a\u305f\u305f\u307f  <pre><code>&lt;details&gt;\n&lt;summary&gt;xxx&lt;/summary&gt;\n\naaaaaaaaaaaaaaaaaaaaa\nbbbbbbbbbbbbbbbbbbb\nccccccccccccccccccccc\n&lt;/details&gt;\n</code></pre>"},{"location":"#collapsible-blocks","title":"Collapsible blocks\u00b6","text":"<ul> <li>https://squidfunk.github.io/mkdocs-material/reference/admonitions/#collapsible-blocks</li> <li>https://squidfunk.github.io/mkdocs-material/reference/admonitions/#supported-types</li> <li>note+<ul> <li> Note note+ </li> </ul> </li> <li> <p>note</p> <ul> <li> Note <pre><code># Code block content\n</code></pre> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. </li> </ul> </li> <li> <p>abstract</p> <ul> <li> Abstract abstract </li> </ul> </li> <li>info<ul> <li> Info info </li> </ul> </li> <li>tip<ul> <li> Tip tip </li> </ul> </li> <li>success<ul> <li> Success success </li> </ul> </li> <li>question<ul> <li> Question question </li> </ul> </li> <li>warning<ul> <li> Warning warning </li> </ul> </li> <li>failure<ul> <li> Failure failure </li> </ul> </li> <li>danger<ul> <li> Danger danger </li> </ul> </li> <li>bug<ul> <li> Bug bug </li> </ul> </li> <li>example<ul> <li> Example example </li> </ul> </li> <li>quote<ul> <li> Quote quote </li> </ul> </li> </ul>"},{"location":"#commands","title":"Commands","text":"<ul> <li><code>mkdocs new [dir-name]</code> - Create a new project.</li> <li><code>mkdocs serve</code> - Start the live-reloading docs server.</li> <li><code>mkdocs build</code> - Build the documentation site.</li> <li><code>mkdocs -h</code> - Print help message and exit.</li> </ul>"},{"location":"#project-layout","title":"Project layout","text":"<pre><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre>"},{"location":"#deploying-docs","title":"Deploying docs","text":"<ul> <li>https://mkdocs.nakaken88.com/use/write/</li> <li>https://dev.classmethod.jp/articles/mkdocs-and-material-for-mkdocs-tips-matome/</li> <li>https://www.mkdocs.org/getting-started/</li> <li>https://www.mkdocs.org/user-guide/deploying-your-docs/</li> </ul> <pre><code>#  python3 -m pip install --upgrade pip\n#  pip install mkdocs\n#  pip install mkdocs-material\n#  mkdocs serve -a 127.0.0.1:8000 -v\n</code></pre> <pre><code>blog/\n    mkdocs.yml\n    docs/\norgname.github.io/\n\ncd ../orgname.github.io/\nmkdocs gh-deploy --config-file ../my-project/mkdocs.yml --remote-branch master\n\n  or\ncd ../blog/\n\n# add new title\n# vim mkdocs.yml\n\n# create new blog\n# vim docs/xxxx.md\n\n# build for github pages\n# mkdocs build -d ../lyvivian0077.github.io/\n\n# commit origin docs\n# git add .\n# git commit -m 'test'\n# git push\n\n# change to github pages dir\n# cd ../lyvivian0077.github.io/\n\n# commit origin github pages\n# git add .\n# git commit -m 'test'\n# git push\n</code></pre>"},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/","title":"Bash\u7f16\u7a0b\u8d85\u8be6\u7ec6\u8bed\u6cd5\u603b\u7ed3","text":"<ul> <li>\u539f\u6587</li> </ul> <p>\u5728Linux\u5b66\u4e60\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u65e0\u53ef\u907f\u514d\u7684\u4f1a\u78b0\u5230\u4e00\u4e2a\u65e2\u8ba9\u4eba\u559c\u6b22\uff0c\u53c8\u4ee4\u4eba\u5934\u75bc\u7684\u795e\u5947\u7684\u4e1c\u897f\u2014\u2014bash\u7f16\u7a0b\uff0c\u5373shell\u811a\u672c\u3002 \u90a3\u4e48\u4ec0\u4e48\u662fshell\u811a\u672c\u5462\uff1fshell\u662f\u4e00\u4e2a\u547d\u4ee4\u8bed\u8a00\u89e3\u91ca\u5668\uff0c\u800cshell\u811a\u672c\u5219\u662fLinux\u547d\u4ee4\u7684\u96c6\u5408\uff0c \u6309\u7167\u9884\u8bbe\u7684\u987a\u5e8f\u4f9d\u6b21\u89e3\u91ca\u6267\u884c\uff0c\u6765\u5b8c\u6210\u7279\u5b9a\u7684\u3001\u8f83\u590d\u6742\u7684\u7cfb\u7edf\u7ba1\u7406\u4efb\u52a1\uff0c\u7c7b\u4f3c\u4e8eWindows\u4e2d\u7684\u6279\u5904\u7406\u6587\u4ef6\u3002 \u672c\u6587\u5e26\u6765\u7684\u662fbash\u7f16\u7a0b\u7684\u57fa\u7840\u8bed\u6cd5\u8bb2\u89e3\u3002</p>"},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/#bash","title":"bash\u7f16\u7a0b\u4e4b\u53d8\u91cf","text":""},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/#bash_1","title":"bash\u53d8\u91cf\u7c7b\u522b","text":"<p>\u672c\u5730\u53d8\u91cf : \u53ea\u5bf9\u5f53\u524dshell\u8fdb\u7a0b\u6709\u6548\u7684\u53d8\u91cf\uff0c\u5bf9\u5176\u5b83shell\u8fdb\u7a0b\u65e0\u6548\uff0c\u5305\u5f53\u524dshell\u8fdb\u7a0b\u7684\u5b50\u8fdb\u7a0b</p> <pre><code>VAR_NAME=VALUE\n</code></pre> <p>\u53d8\u91cf\u8d4b\u503c : \u5411\u53d8\u91cf\u7684\u5b58\u50a8\u7a7a\u95f4\u4fdd\u5b58\u6570\u636e</p> <p>\u53d8\u91cf\u5f15\u7528 : ${VAR_NAME} </p> <pre><code>\"\":\u5f31\u5f15\u7528\uff0c\u91cc\u9762\u7684\u53d8\u91cf\u4f1a\u88ab\u66ff\u6362\n'':\u5f3a\u5f15\u7528\uff0c\u91cc\u9762\u7684\u6240\u6709\u5b57\u7b26\u90fd\u662f\u5b57\u9762\u91cf\uff0c\u76f4\u63a5\u8f93\u51fa\n</code></pre> <p>\u73af\u5883\u53d8\u91cf : \u5bf9\u5f53\u524dshell\u8fdb\u7a0b\u53ca\u5176\u5b50shell\u6709\u6548\uff0c\u5bf9\u5176\u5b83\u7684shell\u8fdb\u7a0b\u65e0\u6548</p> <pre><code>\u5b9a\u4e49\uff1aexport VAR_NAME=VALUE\n\u5bfc\u51fa\uff1aexport VAR_NAME\n\u64a4\u6d88\u53d8\u91cf\uff1aunset VAR_NAME\n\u53ea\u8bfb\u53d8\u91cf\uff1areadonly VAR_NAME\n</code></pre> <p>\u5c40\u90e8\u53d8\u91cf : \u5bf9shell\u811a\u672c\u4e2d\u67d0\u4ee3\u7801\u7247\u65ad\u6709\u6548\uff0c\u901a\u5e38\u7528\u4e8e\u51fd\u6570\u672c\u5730</p> <pre><code>local VAR_NAME=VALUE\n</code></pre> <p>\u4f4d\u7f6e\u53d8\u91cf : \u7528\u6765\u63a5\u53d7\u53d8\u91cf\u6307\u5b9a\u4f4d\u7f6e\u7684\u53c2\u6570</p> <pre><code>$1,$2...,${10}\n</code></pre> <p>\u7279\u6b8a\u53d8\u91cf : shell\u5bf9\u4e00\u4e9b\u53c2\u6570\u505a\u7279\u6b8a\u5904\u7406,\u8fd9\u4e9b\u53c2\u6570\u53ea\u80fd\u88ab\u5f15\u7528\u800c\u4e0d\u80fd\u88ab\u8d4b\u503c</p> <pre><code>$#  \u4f20\u9012\u5230\u811a\u672c\u7684\u53c2\u6570\u4e2a\u6570\n$*  \u663e\u793a\u6240\u6709\u5411\u811a\u672c\u4f20\u9012\u7684\u53c2\u6570                  #\u4e0e\u4f4d\u7f6e\u53d8\u91cf\u4e0d\u540c\uff0c\u6b64\u9009\u9879\u53c2\u6570\u53ef\u8d85\u8fc79\u4e2a\n$$  \u83b7\u53d6\u5f53\u524dshell\u7684\u8fdb\u7a0b\u53f7\n$!  \u6267\u884c\u4e0a\u4e00\u4e2a\u6307\u4ee4\u7684\u8fdb\u7a0b\u53f7\n$?  \u83b7\u53d6\u6267\u884c\u7684\u4e0a\u4e00\u4e2a\u6307\u4ee4\u7684\u8fd4\u56de\u503c              #0\u4e3a\u6267\u884c\u6210\u529f\uff0c\u975e\u96f6\u4e3a\u6267\u884c\u5931\u8d25\n$-  \u663e\u793ashell\u4f7f\u7528\u7684\u5f53\u524d\u9009\u9879\uff0c\u4e0eset\u547d\u4ee4\u529f\u80fd\u76f8\u540c\n$@  \u4e0e$*\u76f8\u540c\uff0c\u4f46\u662f\u4f7f\u7528\u65f6\u52a0\u5f15\u53f7\uff0c\u5e76\u5728\u5f15\u53f7\u4e2d\u8fd4\u56de\u6bcf\u4e2a\u53c2\u6570\n</code></pre> <p>\u67e5\u770b\u53d8\u91cf :</p> <pre><code>set\uff1a\u67e5\u770b\u5f53\u524dshell\u8fdb\u7a0b\u4e2d\u7684\u6240\u6709\u53d8\u91cf\nexport, printenv, env\uff1a\u67e5\u770b\u5f53\u524dshell\u8fdb\u7a0b\u4e2d\u7684\u6240\u6709\u73af\u5883\u53d8\u91cf\n</code></pre> <p>\u53d8\u91cf\u547d\u540d :   1. \u4e0d\u80fd\u4f7f\u7528\u7a0b\u5e8f\u4e2d\u7684\u5173\u952e\u5b57\uff08\u4fdd\u7559\u5b57\uff09   2. \u53ea\u80fd\u4f7f\u7528\u6570\u5b57\u3001\u5b57\u6bcd\u548c\u4e0b\u5212\u7ebf\uff0c\u4e14\u4e0d\u80fd\u4ee5\u6570\u5b57\u5f00\u5934   3. \u8981\u89c1\u540d\u77e5\u4e49</p> <p>\u53d8\u91cf\u7c7b\u578b :</p> <pre><code>\u6570\u503c\u578b\uff1a\u7cbe\u786e\u6570\u503c(\u6574\u6570)\uff0c\u8fd1\u4f3c\u6570\u503c\uff08\u6d6e\u70b9\u578b\uff09\n\u5b57\u7b26\u578b\uff1achar,string\n\u5e03\u5c14\u578b\uff1atrue, false\n</code></pre> <p>\u7c7b\u578b\u8f6c\u6362 :</p> <pre><code>\u663e\u5f0f\u8f6c\u6362\n\u9690\u5f0f\u8f6c\u6362\n</code></pre>"},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/#bash_2","title":"bash\u7684\u914d\u7f6e\u6587\u4ef6\uff1a","text":""},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/#_1","title":"\u529f\u80fd\uff1a\u8bbe\u5b9a\u672c\u5730\u53d8\u91cf\uff0c\u5b9a\u4e49\u547d\u4ee4\u522b\u540d","text":"<ul> <li>profile\u7c7b\uff1a\u4e3a\u4ea4\u4e92\u5f0f\u767b\u5f55\u7684\u7528\u6237\u63d0\u4f9b\u914d\u7f6e</li> </ul> <pre><code>\u5168\u5c40\uff1a/etc/profile\u3001/etc/profile.d/*.sh\n\u7528\u6237\uff1a~/.bash_profile\n</code></pre> <ul> <li>bashrc\u7c7b\uff1a\u4e3a\u975e\u4ea4\u4e92\u5f0f\u7684\u7528\u6237\u63d0\u4f9b\u914d\u7f6e</li> </ul> <pre><code>\u5168\u5c40\uff1a/etc/bashrc\n\u7528\u6237\uff1a~/.bashrc\n</code></pre>"},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/#bash_3","title":"bash\u7f16\u7a0b\u4e4b\u7f16\u5199\u683c\u5f0f\u53ca\u6267\u884c\u65b9\u5f0f","text":"<ul> <li>\u7f16\u5199\u683c\u5f0f\uff1ashell\u811a\u672c\u7b2c\u4e00\u884c\u5fc5\u987b\u9876\u683c\u5199\uff0c\u7528shebang\u5b9a\u4e49\u6307\u5b9a\u7684\u89e3\u91ca\u5668\u6765\u89e3\u91ca\u8be5\u811a\u672c\u3002</li> </ul> <pre><code>#!/bin/bash       #!\u5373\u4e3ashebang\n# \u5176\u5b83\u7684\u4ee5#\u5f00\u5934\u7684\u884c\u5747\u4e3a\u6ce8\u91ca\uff0c\u4f1a\u88ab\u89e3\u91ca\u5668\u5ffd\u7565\uff0c\u53ef\u7528\u6765\u6ce8\u91ca\u811a\u672c\u7528\u9014\u53ca\u7248\u672c\uff0c\u65b9\u4fbf\u4f7f\u7528\u7ba1\u7406\u3002\n</code></pre> <ul> <li>\u6267\u884c\u65b9\u5f0f\uff1abash\u7f16\u7a0b\u5c5e\u4e8e\u9762\u5411\u8fc7\u7a0b\u7f16\u7a0b\uff0c\u6267\u884c\u65b9\u5f0f\u5982\u4e0b\uff1a</li> </ul> <pre><code>\u987a\u5e8f\u6267\u884c\uff1a\u6309\u547d\u4ee4\u5148\u540e\u987a\u5bfb\u4f9d\u6b21\u6267\u884c\n\u9009\u62e9\u6267\u884c\uff1a\u6d4b\u8bd5\u6761\u4ef6\uff0c\u53ef\u80fd\u4f1a\u591a\u4e2a\u6d4b\u8bd5\u6761\u4ef6\uff0c\u67d0\u6761\u4ef6\u6ee1\u8db3\u65f6\uff0c\u5219\u6267\u884c\u5bf9\u5e94\u7684\u5206\u652f\n\u5faa\u73af\u6267\u884c\uff1a\u5c06\u540c\u4e00\u6bb5\u4ee3\u7801\u53cd\u590d\u6267\u884c\u591a\u6b21\uff0c\u56e0\u6b64\uff0c\u5faa\u73af\u5fc5\u987b\u6709\u9000\u51fa\u6761\u4ef6\uff1b\u5426\u5219\uff0c\u5219\u9677\u5165\u6b7b\u5faa\u73af\n</code></pre> <ul> <li>bash\u6267\u884c\u9009\u9879\uff1a</li> </ul> <pre><code>bash -n SHELLNAME  #\u8bed\u6cd5\u6d4b\u8bd5\uff0c\u6d4b\u8bd5\u662f\u5426\u5b58\u5728\u8bed\u6cd5\u9519\u8bef\nbash -x SHELLNAME  #\u6a21\u62df\u5355\u6b65\u6267\u884c\uff0c\u663e\u793a\u6bcf\u4e00\u6b65\u6267\u884c\u8fc7\u7a0b\n</code></pre>"},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/#bash_4","title":"bash\u4e4b\u7b97\u6570\u8fd0\u7b97\u4e0e\u903b\u8f91\u8fd0\u7b97","text":"<ul> <li> <p>\u7b97\u6570\u8fd0\u7b97</p> </li> <li> <p>\u5b9a\u4e49\u6574\u578b\u53d8\u91cf\uff1a <pre><code>let VAR_NAME=INTEGER_VALUE            #\u4f8b\u5982\uff1alet a=3\ndeclare -i VAR_NAME=INTEGER_VALUE     #declare -i a=3\n</code></pre></p> </li> <li>\u5b9e\u73b0\u7b97\u672f\u8fd0\u7b97\u7684\u65b9\u5f0f\uff1a <pre><code>let VAR_NAME=ARITHMATIC_EXPRESSION\nVAR_NAME=$[ARITHMATIC_EXRESSION]\nVAR_NAME=$((EXPRESSION))\nVAR_NAME=$(expr $num1 + $num2)\n</code></pre></li> <li>\u7b97\u672f\u8fd0\u7b97\u7b26\uff1a <pre><code>+\uff1a\u52a0\u6cd5\n-\uff1a\u51cf\u6cd5\n*\uff1a\u4e58\u6cd5\n/\uff1a\u6574\u9664\n%\uff1a\u53d6\u4f59\u6570\n**\uff1a\u4e58\u5e42\n</code></pre> <p>\u6ce8\u610f\uff1a\u5373\u4f7f\u6ca1\u6709\u5b9a\u4e49\u4e3a\u6574\u578b\u53d8\u91cf\uff0c\u5b57\u7b26\u578b\u7684\u6570\u5b57\u4f9d\u7136\u53ef\u4ee5\u53c2\u4e0e\u7b97\u672f\u8fd0\u7b97\uff0cbash\u4f1a\u6267\u884c\u53d8\u91cf\u7c7b\u578b\u7684\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\u3002</p> </li> <li>\u903b\u8f91\u8fd0\u7b97</li> </ul> <pre><code>\u5e03\u5c14\u8fd0\u7b97\uff1a\u771f\uff0c\u5047\n\u4e0e\u8fd0\u7b97\uff1a\u771f &amp;&amp; \u771f = \u771f\n        \u771f &amp;&amp; \u5047 = \u5047\n        \u5047 &amp;&amp; \u771f = \u5047\n        \u5047 &amp;&amp; \u5047 = \u5047\n\u6216\u8fd0\u7b97\uff1a\u771f || \u771f = \u771f\n  \u771f || \u5047 = \u771f\n  \u5047 || \u771f = \u771f\n  \u5047 || \u5047 = \u5047\n\u975e\u8fd0\u7b97\uff1a\uff01\u771f=\u5047\n        \uff01\u5047=\u771f\n</code></pre>"},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/#bash_5","title":"bash\u7f16\u7a0b\u4e4b\u6761\u4ef6\u6d4b\u8bd5\u8bed\u53e5","text":""},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/#bash_6","title":"bash\u6761\u4ef6\u6d4b\u8bd5","text":"<p>\u6574\u578b\u6d4b\u8bd5\uff1a\u6574\u6570\u6bd4\u8f83</p> <pre><code>\u4f8b\u5982 [ $num1 -gt $num2 ]\n\n-gt: \u5927\u4e8e\u5219\u4e3a\u771f\n-lt: \u5c0f\u4e8e\u5219\u4e3a\u771f\n-ge: \u5927\u4e8e\u7b49\u4e8e\u5219\u4e3a\u771f\n-le: \u5c0f\u4e8e\u7b49\u4e8e\u5219\u4e3a\u771f\n-eq: \u7b49\u4e8e\u5219\u4e3a\u771f\n-ne: \u4e0d\u7b49\u4e8e\u5219\u4e3a\u771f\n</code></pre> <p>\u5b57\u7b26\u6d4b\u8bd5\uff1a\u5b57\u7b26\u4e32\u6bd4\u8f83</p> <pre><code>\u53cc\u76ee\uff1a\n\u4f8b\u5982[[ \"$str1\" &gt; \"$str2\" ]]\n\n&gt;: \u5927\u4e8e\u5219\u4e3a\u771f\n&lt;: \u5c0f\u4e8e\u5219\u4e3a\u771f\n&gt;=\uff1a\u5927\u4e8e\u7b49\u4e8e\u5219\u4e3a\u771f\n&lt;=\uff1a\u5c0f\u4e8e\u7b49\u4e8e\u5219\u4e3a\u771f\n==\uff1a\u7b49\u4e8e\u5219\u4e3a\u771f\n!=\uff1a\u4e0d\u7b49\u4e8e\u5219\u4e3a\u771f\n\n\u5355\u76ee\uff1a\n-n String: \u662f\u5426\u4e0d\u7a7a\uff0c\u4e0d\u7a7a\u5219\u4e3a\u771f\uff0c\u7a7a\u5219\u4e3a\u5047\n-z String: \u662f\u5426\u4e3a\u7a7a\uff0c\u7a7a\u5219\u4e3a\u771f\uff0c\u4e0d\u7a7a\u5219\u5047\n\n\u6587\u4ef6\u6d4b\u8bd5\uff1a\u5224\u65ad\u6587\u4ef6\u7684\u5b58\u5728\u6027\u53ca\u5c5e\u6027\u7b49\n\n-a FILE\uff1a\u5b58\u5728\u5219\u4e3a\u771f\uff1b\u5426\u5219\u5219\u4e3a\u5047\uff1b\n-e FILE: \u5b58\u5728\u5219\u4e3a\u771f\uff1b\u5426\u5219\u5219\u4e3a\u5047\uff1b\n-f FILE: \u5b58\u5728\u5e76\u4e14\u4e3a\u666e\u901a\u6587\u4ef6\uff0c\u5219\u4e3a\u771f\uff1b\u5426\u5219\u4e3a\u5047\uff1b\n-d FILE: \u5b58\u5728\u5e76\u4e14\u4e3a\u76ee\u5f55\u6587\u4ef6\uff0c\u5219\u4e3a\u771f\uff1b\u5426\u5219\u4e3a\u5047\uff1b\n-L/-h FILE: \u5b58\u5728\u5e76\u4e14\u4e3a\u7b26\u53f7\u94fe\u63a5\u6587\u4ef6\uff0c\u5219\u4e3a\u771f\uff1b\u5426\u5219\u4e3a\u5047\uff1b\n-b: \u5b58\u5728\u5e76\u4e14\u4e3a\u5757\u8bbe\u5907\uff0c\u5219\u4e3a\u771f\uff1b\u5426\u5219\u4e3a\u5047\uff1b\n-c: \u5b58\u5728\u5e76\u4e14\u4e3a\u5b57\u7b26\u8bbe\u5907\uff0c\u5219\u4e3a\u771f\uff1b\u5426\u5219\u4e3a\u5047\n-S: \u5b58\u5728\u5e76\u4e14\u4e3a\u5957\u63a5\u5b57\u6587\u4ef6\uff0c\u5219\u4e3a\u771f\uff1b\u5426\u5219\u4e3a\u5047\n-p: \u5b58\u5728\u5e76\u4e14\u4e3a\u547d\u540d\u7ba1\u9053\uff0c\u5219\u4e3a\u771f\uff1b\u5426\u5219\u4e3a\u5047\n-s FILE: \u5b58\u5728\u5e76\u4e14\u4e3a\u975e\u7a7a\u6587\u4ef6\u5219\u4e3a\u503c\uff0c\u5426\u5219\u4e3a\u5047\uff1b\n-r FILE\uff1a\u6587\u4ef6\u53ef\u8bfb\u4e3a\u771f\uff0c\u5426\u5219\u4e3a\u5047\n-w FILE\uff1a\u6587\u4ef6\u53ef\u5199\u4e3a\u771f\uff0c\u5426\u5219\u4e3a\u5047\n-x FILE\uff1a\u6587\u4ef6\u53ef\u6267\u884c\u4e3a\u771f\uff0c\u5426\u5219\u4e3a\u5047\nfile1 -nt file2: file1\u7684mtime\u65b0\u4e8efile2\u5219\u4e3a\u771f\uff0c\u5426\u5219\u4e3a\u5047\uff1b\nfile1 -ot file2\uff1afile1\u7684mtime\u65e7\u4e8efile2\u5219\u4e3a\u771f\uff0c\u5426\u5219\u4e3a\u5047\uff1b\n\n\u7ec4\u5408\u6761\u4ef6\u6d4b\u8bd5\uff1a\u5728\u591a\u4e2a\u6761\u4ef6\u95f4\u5b9e\u73b0\u903b\u8f91\u8fd0\u7b97\n\n\u4e0e\uff1a[ condition1 -a condition2 ]\n  condition1 &amp;&amp; condition2\n\u6216\uff1a[ condition1 -o condition2 ]\n  condition1 || condition2\n\u975e\uff1a[ -not condition ]\n  ! condition\n\u4e0e\uff1aCOMMAND1 &amp;&amp; COMMAND2\nCOMMAND1\u5982\u679c\u4e3a\u5047\uff0c\u5219COMMAND2\u4e0d\u6267\u884c\n\u6216\uff1aCOMMAND1 || COMMAND2\nCOMMAND1\u5982\u679c\u4e3a\u771f\uff0c\u5219COMMAND2\u4e0d\u6267\u884c\n\u975e\uff1a! COMMAND\n</code></pre> <p>\u6761\u4ef6\u6d4b\u8bd5\u4e4bif\u8bed\u53e5</p> <pre><code>1\u3001if\u8bed\u53e5\u4e4b\u5355\u5206\u652f\n\u8bed\u53e5\u7ed3\u6784\uff1a\nif \u6d4b\u8bd5\u6761\u4ef6;then\n   \u9009\u62e9\u5206\u652f\nfi\n\u8868\u793a\u6761\u4ef6\u6d4b\u8bd5\u72b6\u6001\u8fd4\u56de\u503c\u4e3a\u503c\uff0c\u5219\u6267\u884c\u9009\u62e9\u5206\u652f\n\u4f8b\uff1a\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u63a5\u53d7\u4e00\u4e2a\u53c2\u6570\uff0c\u8fd9\u4e2a\u53c2\u6570\u662f\u7528\u6237\u540d\uff1b\u5982\u679c\u6b64\u7528\u6237\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\u8be5\u7528\u6237\uff1b\n\n#\uff01/bin/bash\nif ! id $1 &amp;&gt; /dev/null;then\n  useradd $1\nfi\n\n2\u3001if\u8bed\u53e5\u4e4b\u53cc\u5206\u652f\n\u8bed\u53e5\u7ed3\u6784\uff1a\nif \u6d4b\u8bd5\u6761\u4ef6;then\n   \u9009\u62e9\u5206\u652f1\nelse\n   \u9009\u62e9\u5206\u652f2\nfi\n\n\u4e24\u4e2a\u5206\u652f\u4ec5\u6267\u884c\u5176\u4e2d\u4e4b\u4e00\n\u4f8b\uff1a\u901a\u8fc7\u547d\u4ee4\u884c\u7ed9\u5b9a\u4e00\u4e2a\u6587\u4ef6\u8def\u5f84\uff0c\u800c\u540e\u5224\u65ad\uff1a\u5982\u679c\u6b64\u6587\u4ef6\u4e2d\u5b58\u5728\u7a7a\u767d\u884c\uff0c\u5219\u663e\u793a\u5176\u7a7a\u767d\u884c\u7684\u603b\u6570\uff1b\u5426\u5219\uff0c\u5219\u663e\u793a\u65e0\u7a7a\u767d\u884c\uff1b\n#\uff01/bin/bash\nif grep \"^[[:space]]*$\" $1 &amp;&gt; /dev/null; then\n  echo \"$1 has $(grep \"^[[:space]]*$\" $1 | wc -l) blank lines.\"\nelse\n  echo \"No blank lines\"\nfi\n\n\u6ce8\u610f\uff1a\u5982\u679c\u628a\u547d\u4ee4\u6267\u884c\u6210\u529f\u4e0e\u5426\u5f53\u4f5c\u6761\u4ef6\uff0c\u5219if\u8bed\u53e5\u540e\u5fc5\u987b\u53ea\u8ddf\u547d\u4ee4\u672c\u8eab\uff0c\u800c\u4e0d\u80fd\u5f15\u7528\u3002\n\n3\u3001if\u8bed\u53e5\u4e4b\u591a\u5206\u652f\n\u8bed\u53e5\u7ed3\u6784\uff1a\nif \u6761\u4ef61;then\n     \u5206\u652f1\nelif \u6761\u4ef62;then\n     \u5206\u652f2\nelif \u6761\u4ef63;then\n     \u5206\u652f3\n      ...\nelse\n     \u5206\u652fn\nfi\n\n\u4f8b\uff1a\u4f20\u9012\u4e00\u4e2a\u7528\u6237\u540d\u7ed9\u811a\u672c\uff1a\u5982\u679c\u6b64\u7528\u6237\u7684id\u53f7\u4e3a0\uff0c\u5219\u663e\u793a\u8bf4\u8fd9\u662f\u7ba1\u7406\u5458\uff1b\u5982\u679c\u6b64\u7528\u6237\u7684id\u53f7\u5927\u4e8e\u7b49\u4e8e500\uff0c\u5219\u663e\u793a\u8bf4\u8fd9\u662f\u666e\u901a\u7528\u6237\uff1b\u5426\u5219\uff0c\u5219\u8bf4\u8fd9\u662f\u7cfb\u7edf\u7528\u6237\u3002\n#!/bin/bash\nif [ $# -lt 1 ]; then\n  echo \"Usage: `basename $0` username\"\n  exit 1\nfi\nif ! id -u $1 &amp;&gt; /dev/null; then\n  echo \"Usage: `basename $0` username\"\n  echo \"No this user $1.\"\n  exit 2\nfi\n\nif [ $(id -u $1) -eq 0 ]; then\n  echo \"Admin\"\nelif [ $(id -u $1) -ge 500 ]; then\n  echo \"Common user.\"\nelse\n  echo \"System user.\"\nfi\n</code></pre> <p>bash\u4ea4\u4e92\u5f0f\u7f16\u7a0b</p> <pre><code>read [option] \u201cprompt\u201d-p:\u76f4\u63a5\u6307\u5b9a\u4e00\u4e2a\u53d8\u91cf\u63a5\u53d7\u53c2\u6570\n-t timaout\uff1a\u6307\u5b9a\u7b49\u5f85\u63a5\u53d7\u53c2\u6570\u7684\u65f6\u95f4\n-n:\u8868\u793a\u4e0d\u6362\u884c\n\n\u4f8b\uff1a\u8f93\u5165\u7528\u6237\u540d\uff0c\u53ef\u8fd4\u56de\u5176shell\n\n#!/bin/bash\nread -p \"Plz input a username: \" userName\nif id $userName &amp;&gt; /dev/null; then\n    echo \"The shell of $userName is `grep \"^$userName\\&gt;\" /etc/passwd | cut -d: -f7`.\"\nelse\n    echo \"No such user. stupid.\"\nfi    \n</code></pre> <p>\u6761\u4ef6\u6d4b\u8bd5\u4e4bcase\u8bed\u53e5</p> <pre><code>case\u8bed\u53e5\uff1a\u6709\u591a\u4e2a\u6d4b\u8bd5\u6761\u4ef6\u65f6\uff0ccase\u8bed\u53e5\u4f1a\u4f7f\u5f97\u8bed\u6cd5\u7ed3\u6784\u66f4\u660e\u6670\n\u8bed\u53e5\u7ed3\u6784\uff1a\n\ncase \u53d8\u91cf\u5f15\u7528 in\nPATTERN1)\n  \u5206\u652f1\n;;\nPATTERN2)\n  \u5206\u652f2\n;;\n...\n*)\n  \u5206\u652fn\n;;\nesac\n</code></pre> <p>PATTERN\uff1a\u7c7b\u540c\u4e8e\u6587\u4ef6\u540d\u901a\u914d\u673a\u5236\uff0c\u4f46\u652f\u6301\u4f7f\u7528|\u8868\u793a\u6216\u8005</p> <pre><code> a|b:  a\u6216\u8005b*\uff1a\u5339\u914d\u4efb\u610f\u957f\u5ea6\u7684\u4efb\u610f\u5b57\u7b26\n?: \u5339\u914d\u4efb\u610f\u5355\u4e2a\u5b57\u7b26\n[]: \u6307\u5b9a\u8303\u56f4\u5185\u7684\u4efb\u610f\u5355\u4e2a\u5b57\u7b26\n\n\u4f8b\uff1a\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u5b8c\u6210\u5982\u4e0b\u4efb\u52a1\uff0c\u5176\u4f7f\u7528\u5f62\u5f0f\u5982\u4e0b\u6240\u793a\uff1a\nscript.sh {start|stop|restart|status}\n\n\u5176\u4e2d\uff1a\u5982\u679c\u53c2\u6570\u4e3a\u7a7a\uff0c\u5219\u663e\u793a\u5e2e\u52a9\u4fe1\u606f\uff0c\u5e76\u9000\u51fa\u811a\u672c\uff1b\n\u5982\u679c\u53c2\u6570\u4e3astart\uff0c\u5219\u521b\u5efa\u7a7a\u6587\u4ef6/var/lock/subsys/script\uff0c\u5e76\u663e\u793a\u201cstarting script successfully.\u201d\n\u5982\u679c\u53c2\u6570\u4e3astop\uff0c\u5219\u5220\u9664\u6587\u4ef6/var/lock/subsys/script\uff0c\u5e76\u663e\u793a\u201cStop script successfully.\u201d\n\u5982\u679c\u53c2\u6570\u4e3arestart\uff0c\u5219\u5220\u9664\u6587\u4ef6/var/locksubsys/script\u5e76\u91cd\u65b0\u521b\u5efa\uff0c\u800c\u540e\u663e\u793a\u201cRestarting script successfully.\u201d\n\u5982\u679c\u53c2\u6570\u4e3astatus\uff0c\u90a3\u4e48\uff1a\u5982\u679c\u6587\u4ef6/var/lock/subsys/script\u5b58\u5728\uff0c\u5219\u663e\u793a\u201cScript is running\u2026\u201d\uff0c\u5426\u5219\uff0c\u5219\u663e\u793a\u201cScript is stopped.\u201d\n\n#!/bin/bash\nfile='/var/lock/subsys/script'\ncase $1 in\nstart)\n  if [ -f $file ];then\n  echo \"Script is running...\"\n    exit 3\n  else\n  touch $file\n  [ $? -eq 0 ] &amp;&amp; echo \"Starting script successfully.\"\n  fi\n  ;;\nstop)\n  if [ -f $file ];then\n  rm -rf $file\n  [ $? -eq 0 ] &amp;&amp; echo \"Stop script successfully.\"\n  else\n  echo \"Script is stopped...\"\n  exit 4\n  fi\n  ;;\nrestart)\n  if [ -f $file ];then\n  rm -rf $file\n  [ $? -eq 0 ] &amp;&amp; echo \"Stop script successfully\"\n  else \n  echo \"Script is stopped...\"\n  exit 5\n  fi\n  touch $file\n  [ $? -eq 0 ] &amp;&amp; echo \"Starting script successfully\"\n  ;;\nstatus)\n  if [ -f $file ];then\n  echo \"Script is running...\"\n  else\n  echo \"Script is stopped.\"\n  fi\n  ;;\n*)\n  echo \"`basename $0` {start|stop|restart|status}\"\n  exit 2\n  ;;\n esac\n</code></pre>"},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/#bash_7","title":"bash\u7f16\u7a0b\u4e4b\u5faa\u73af\u8bed\u53e5","text":"<p>\u5faa\u73af\u4e4bfor\u5faa\u73af</p> <pre><code>1\u3001for\u8bed\u53e5\u683c\u5f0f\u4e00\n\u8bed\u53e5\u7ed3\u6784\uff1a\nfor \u53d8\u91cf\u540d in \u5217\u8868; do\n    \u5faa\u73af\u4f53\ndone\n\u5217\u8868\uff1a\u53ef\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a\u5143\u7d20\n\u5faa\u73af\u4f53\uff1a\u4f9d\u8d56\u4e8e\u8c03\u7528\u53d8\u91cf\u6765\u5b9e\u73b0\u5176\u53d8\u5316\n\u5faa\u73af\u53ef\u5d4c\u5957\n\u9000\u51fa\u6761\u4ef6\uff1a\u904d\u5386\u5143\u7d20\u5217\u8868\u7ed3\u675f\n\u4f8b\uff1a\u6c42100\u4ee5\u5185\u6240\u6709\u6b63\u6574\u6570\u4e4b\u548c\n\n#!/bin/bash\ndeclare -i sum=0\nfor i in {1..100}; do\n    let sum+=$i\ndone\necho $sum\n\n2\u3001for\u8bed\u53e5\u683c\u5f0f\u4e8c\nfor ((\u521d\u59cb\u6761\u4ef6;\u6d4b\u8bd5\u6761\u4ef6;\u4fee\u6539\u8868\u8fbe\u5f0f)); do\n      \u5faa\u73af\u4f53\ndone\n\u5148\u7528\u521d\u59cb\u6761\u4ef6\u548c\u6d4b\u8bd5\u6761\u4ef6\u505a\u5224\u65ad\uff0c\u5982\u679c\u7b26\u5408\u6d4b\u8bd5\u6761\u4ef6\u5219\u6267\u884c\u5faa\u73af\u4f53\uff0c\u518d\u4fee\u6539\u8868\u8fbe\u5f0f\uff0c\u5426\u5219\u76f4\u63a5\u8df3\u51fa\u5faa\u73af\u3002\n\n\u4f8b\uff1a\u6c42100\u4ee5\u5185\u6240\u6709\u6b63\u6574\u6570\u4e4b\u548c\uff08for\u4e8c\u5b9e\u73b0\uff09\n#!/bin/bash\ndeclare -i sum=0\nfor ((counter=1;$counter &lt;= 100; counter++)); do\n  let sum+=$counter\ndone\necho $sum\n</code></pre> <p>\u5faa\u73af\u4e4bwhile\u8bed\u53e5</p> <p>while\u9002\u7528\u4e8e\u5faa\u73af\u6b21\u6570\u672a\u77e5\uff0c\u6216\u4e0d\u4fbf\u7528for\u76f4\u63a5\u751f\u6210\u8f83\u5927\u7684\u5217\u8868\u65f6</p> <pre><code>\u8bed\u53e5\u7ed3\u6784\uff1a\nwhile \u6d4b\u8bd5\u6761\u4ef6; do\n  \u5faa\u73af\u4f53\ndone\n\u6d4b\u8bd5\u6761\u4ef6\u4e3a\u771f\uff0c\u8fdb\u5165\u5faa\u73af\uff1b\u6d4b\u8bd5\u6761\u4ef6\u4e3a\u5047\uff0c\u9000\u51fa\u5faa\u73af\n\u4f8b1\uff1a\u6c42100\u4ee5\u5185\u6240\u6709\u5076\u6570\u4e4b\u548c\uff0c\u8981\u6c42\u4f7f\u7528\u53d6\u6a21\u65b9\u6cd5\n#!/bin/bash\ndeclare -i counter=1\ndeclare -i sum=0\nwhile [ $counter -le 100 ]; do\n  if [ $[$counter%2] -eq 0 ]; then\n     let sum+=$counter\n  fi\n  let counter++\n done\necho $sum\n\n\u4f8b2\uff1a\u63d0\u793a\u7528\u6237\u8f93\u5165\u4e00\u4e2a\u7528\u6237\u540d\uff0c\u5982\u679c\u7528\u6237\u5b58\u5728\uff0c\u5c31\u663e\u793a\u7528\u6237\u7684ID\u53f7\u548cshell\uff1b\u5426\u5219\u663e\u793a\u7528\u6237\u4e0d\u5b58\u5728\uff1b\u663e\u793a\u5b8c\u6210\u4e4b\u540e\u4e0d\u9000\u51fa\uff0c\u518d\u6b21\u91cd\u590d\u524d\u9762\u7684\u64cd\u4f5c\uff0c\u76f4\u5230\u7528\u6237\u8f93\u5165q\u6216quit\u4e3a\u6b62\n#!/bin/bash\nread -p \"Plz enter a username: \" userName\nwhile [ \"$userName\" != 'q' -a \"$userName\" != 'quit' ]; do\n  if id $userName &amp;&gt; /dev/null; then\n     grep \"^$userName\\&gt;\" /etc/passwd | cut -d: -f3,7\n  else\n    echo \"No such user.\"\n  fi\nread -p \"Plz enter a username again: \" userName\ndone\n\nwhile\u7279\u6b8a\u7528\u6cd5\uff1a\u904d\u5386\u6587\u672c\u6587\u4ef6\n\u8bed\u53e5\u7ed3\u6784\uff1a\nwhile read \u53d8\u91cf\u540d; do\n  \u5faa\u73af\u4f53\ndone &lt; /path/to/somefile\n\u53d8\u91cf\u540d\uff0c\u6bcf\u5faa\u73af\u4e00\u6b21\uff0c\u8bb0\u5fc6\u4e86\u6587\u4ef6\u4e2d\u4e00\u884c\u6587\u672c\n\n\u4f8b\uff1a\u663e\u793aID\u53f7\u4e3a\u5076\u6570\uff0c\u4e14ID\u53f7\u540cGID\u7684\u7528\u6237\u7684\u7528\u6237\u540d\u3001ID\u548cSHELL\nwhile read line; do\n  userID=`echo $line | cut -d: -f3`\n  groupID=`echo $line | cut -d: -f4`\n  if [ $[$userID%2] -eq 0 -a $userID -eq $groupID ]; then\n     echo $line | cut -d: -f1,3,7\n  fi\ndone &lt; /etc/passwd\n</code></pre> <p>\u5faa\u73af\u4e4buntil\u8bed\u53e5</p> <pre><code>\u8bed\u53e5\u7ed3\u6784\uff1a\nuntil \u6d4b\u8bd5\u6761\u4ef6; do\n      \u5faa\u73af\u4f53\ndone\n\u6d4b\u8bd5\u6761\u4ef6\u4e3a\u5047\uff0c\u8fdb\u5165\u5faa\u73af\uff1b\u6d4b\u8bd5\u6761\u4ef6\u4e3a\u771f\uff0c\u9000\u51fa\u5faa\u73af\n\n\u4f8b\uff1a\u6c42100\u4ee5\u5185\u6240\u6709\u5076\u6570\u4e4b\u548c\uff0c\u8981\u6c42\u4f7f\u7528\u53d6\u6a21\u65b9\u6cd5\uff08until\u5b9e\u73b0\uff09\n\n#!/bin/bash\ndeclare -i counter=1\ndeclare -i sum=0\nuntil [ $counter -gt 100 ]; do\n  if [ $[$counter%2] -eq 0 ]; then\n     let sum+=$counter\n  fi\n  let counter++\ndone\necho $sum\n\u4f8b\uff1a\u63d0\u793a\u7528\u6237\u8f93\u5165\u4e00\u4e2a\u7528\u6237\u540d\uff0c\u5982\u679c\u7528\u6237\u5b58\u5728\uff0c\u5c31\u663e\u793a\u7528\u6237\u7684ID\u53f7\u548cshell\uff1b\u5426\u5219\u663e\u793a\u7528\u6237\u4e0d\u5b58\u5728\uff1b\u663e\u793a\u5b8c\u6210\u4e4b\u540e\u4e0d\u9000\u51fa\uff0c\u518d\u6b21\u91cd\u590d\u524d\u9762\u7684\u64cd\u4f5c\uff0c\u76f4\u5230\u7528\u6237\u8f93\u5165q\u6216quit\u4e3a\u6b62\uff08until\u5b9e\u73b0\uff09\n\n#!/bin/bash\nread -p \"Plz enter a username: \" userName\nuntil [ \"$userName\" = 'q' -a \"$userName\" = 'quit' ]; do\n  if id $userName &amp;&gt; /dev/null; then\n   grep \"^$userName\\&gt;\" /etc/passwd | cut -d: -f3,7\nelse\necho \"No such user.\"\nfi\nread -p \"Plz enter a username again: \" userName\ndone\n</code></pre> <p>\u5faa\u73af\u4e4b\u5faa\u73af\u63a7\u5236\u548cshift</p> <pre><code>\u5faa\u73af\u63a7\u5236\u547d\u4ee4\uff1a\nbreak\uff1a\u63d0\u524d\u9000\u51fa\u5faa\u73af\nbreak [N]: \u9000\u51faN\u5c42\u5faa\u73af\uff1bN\u7701\u7565\u65f6\u8868\u793a\u9000\u51fabreak\u8bed\u53e5\u6240\u5728\u7684\u5faa\u73af\ncontinue: \u63d0\u524d\u7ed3\u675f\u672c\u8f6e\u5faa\u73af\uff0c\u800c\u76f4\u63a5\u8fdb\u5165\u4e0b\u8f6e\u5faa\u73af\ncontinue [N]\uff1a\u63d0\u524d\u7b2cN\u5c42\u7684\u5faa\u73af\u7684\u672c\u8f6e\u5faa\u73af\uff0c\u800c\u76f4\u63a5\u8fdb\u5165\u4e0b\u8f6e\u5faa\u73af\n</code></pre> <p>\u6b7b\u5faa\u73af\uff1a</p> <pre><code>#while\u4f53while true; do\n      \u5faa\u73af\u4f53\ndone\n#until\u4f53\nuntil false; do\n      \u5faa\u73af\u4f53\ndone\n\n\u4f8b1\uff1a\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u5224\u65ad\u7ed9\u5b9a\u7684\u7528\u6237\u662f\u5426\u767b\u5f55\u4e86\u5f53\u524d\u7cfb\u7edf\n(1) \u5982\u679c\u767b\u5f55\u4e86\uff0c\u5219\u811a\u672c\u7ec8\u6b62\uff1b\n(2) \u6bcf5\u79d2\u79cd\uff0c\u67e5\u770b\u4e00\u6b21\u7528\u6237\u662f\u5426\u767b\u5f55\uff1b\n#!/bin/bash\nwhile true; do\n    who | grep \"gentoo\" &amp;&gt; /dev/null\n    if [ $? -eq 0 ];then\nbreak\n    fi\n    sleep 5\ndone\necho \"gentoo is logged.\"\n</code></pre> <p>shift\uff1a</p> <pre><code>\u5982\u679c\u6ca1\u6709\u6570\u5b57\uff0c\u53ea\u6709shift \u5c31\u662f\u8df3\u8fc7\u4e00\u4e2a\u53c2\u6570\u83b7\u53d6\u4e0b\u4e00\u4e2a\u53c2\u6570\uff0c\u5982\u679c\u52a0\u4e0a\u6570\u5b57\uff0c\u6bd4\u5982shift 2 \uff0c\u8df3\u8fc7\u4e24\u4e2a\u53c2\u6570\u83b7\u53d6\u4e0b\u4e00\u4e2a\u53c2\u6570\u3002\n\u4f8b\uff1a\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u4f7f\u7528\u5f62\u5f0f\u5982\u4e0b\u6240\u793a    \nshowifinfo.sh [-i INTERFACE|-a] [-v]\n\u8981\u6c42\uff1a\n1\u3001-i\u6216-a\u4e0d\u53ef\u540c\u65f6\u4f7f\u7528\uff0c-i\u7528\u4e8e\u6307\u5b9a\u7279\u5b9a\u7f51\u5361\u63a5\u53e3\uff0c-a\u7528\u4e8e\u6307\u5b9a\u6240\u6709\u63a5\u53e3\uff1b\n\u663e\u793a\u63a5\u53e3\u7684ip\u5730\u5740\n2\u3001\u4f7f\u7528-v\uff0c\u5219\u8868\u793a\u663e\u793a\u8be6\u7ec6\u4fe1\u606f\uff0c\u663e\u793a\u63a5\u53e3\u7684ip\u5730\u5740\u3001\u5b50\u7f51\u63a9\u7801\u3001\u5e7f\u64ad\u5730\u5740\uff1b\n3\u3001\u9ed8\u8ba4\u8868\u793a\u4ec5\u4f7f\u7528-a\u9009\u9879;\n\n#!/bin/bash\nallinterface=0\nifflag=0\nverbose=0\ninterface=0\nif [ $# -eq 0 ];then\n  ifconfig | grep \"inet addr:\" | awk '{print $2}'\nfi\nwhile [ $# -ge 1 ];do\n  case $1 in \n-a)\n allinterface=1\n shift 1\n  ;;\n-i)\n  ifflag=1\n  interface=$2\n  shift 2\n  ;;\n-v)\n  verbose=1\n  shift 1\n  ;;\n  *)\necho \"error option\"\nexit 2\n  ;;\n  esac\ndone\nif [ $allinterface -eq 1 ];then\n  if [ $ifflag -eq 1 ];then\n   echo \"command not found\"\n    exit 5\n  fi\n  if [ $verbose -eq 1 ];then\n    ifconfig | grep \"inet addr:\"\n  else\n    ifconfig | grep \"inet addr:\" | awk '{print $2}'\n  fi\nfi\nif [ $ifflag -eq 1 ];then\n  if [ $allinterface -eq 1 ];then\n        echo \"command not found\"\n        exit 5\n  fi\n if [ $verbose -eq 1 ];then\n    ifconfig $interface | grep \"inet addr:\"\n  else\n    ifconfig $interface | grep \"inet addr:\" | awk '{print $2}'\n  fi\nfi\n</code></pre>"},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/#bash_8","title":"bash\u7f16\u7a0b\u4e4b\u51fd\u6570","text":""},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/#_2","title":"\u8bed\u6cd5\u7ed3\u6784\uff1a","text":"<pre><code>function F_NAME {    \n   \u51fd\u6570\u4f53\n  }\n\n  F_NAME() {\n    \u51fd\u6570\u4f53\n  }\n</code></pre> <p>\u53ef\u8c03\u7528\uff1a\u4f7f\u7528\u51fd\u6570\u540d\uff0c\u51fd\u6570\u540d\u51fa\u73b0\u7684\u5730\u65b9\uff0c\u4f1a\u88ab\u81ea\u52a8\u66ff\u6362\u4e3a\u51fd\u6570 \u51fd\u6570\u7684\u8fd4\u56de\u503c\uff1a \u51fd\u6570\u7684\u6267\u884c\u7ed3\u679c\u8fd4\u56de\u503c\uff1a\u4ee3\u7801\u7684\u8f93\u51fa \u51fd\u6570\u4e2d\u4f7f\u7528\u6253\u5370\u8bed\u53e5\uff1aecho, printf \u51fd\u6570\u4e2d\u8c03\u7528\u7684\u7cfb\u7edf\u547d\u4ee4\u6267\u884c\u540e\u8fd4\u56de\u7684\u7ed3\u679c \u6267\u884c\u72b6\u6001\u8fd4\u56de\u503c\uff1a \u9ed8\u8ba4\u53d6\u51b3\u4e8e\u51fd\u6570\u4f53\u6267\u884c\u7684\u6700\u540e\u4e00\u4e2a\u547d\u4ee4\u72b6\u6001\u7ed3\u679c \u81ea\u5b9a\u4e49\u9000\u51fa\u72b6\u6001\u7801\uff1areturn [0-255]</p> <p>\u6ce8\u610f\uff1a\u51fd\u6570\u4f53\u8fd0\u884c\u65f6\uff0c\u4e00\u65e6\u9047\u5230return\u8bed\u53e5\uff0c\u51fd\u6570\u5373\u8fd4\u56de\uff1b</p> <p>\u51fd\u6570\u53ef\u4ee5\u63a5\u53d7\u53c2\u6570\uff1a \u5728\u51fd\u6570\u4f53\u4e2d\u8c03\u7528\u51fd\u6570\u53c2\u6570\u7684\u65b9\u5f0f\u540c\u811a\u672c\u4e2d\u8c03\u7528\u811a\u672c\u53c2\u6570\u7684\u65b9\u5f0f\uff1a</p> <pre><code>\u4f4d\u7f6e\u53c2\u6570\n$1, $2, \u2026\n$#, $*, $@\n</code></pre> <p>\u4f8b\uff1a\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u5b8c\u6210\u5982\u4e0b\u529f\u80fd(\u4f7f\u7528\u51fd\u6570)\uff1a</p> <p>1\u3001\u63d0\u793a\u7528\u6237\u8f93\u5165\u4e00\u4e2a\u53ef\u6267\u884c\u547d\u4ee4\uff1b</p> <p>2\u3001\u83b7\u53d6\u8fd9\u4e2a\u547d\u4ee4\u6240\u4f9d\u8d56\u7684\u6240\u6709\u5e93\u6587\u4ef6(\u4f7f\u7528ldd\u547d\u4ee4)\uff1b</p> <p>3\u3001\u590d\u5236\u547d\u4ee4\u81f3/mnt/sysroot/\u5bf9\u5e94\u7684\u76ee\u5f55\u4e2d</p> <p>\u89e3\u91ca\uff1a\u5047\u8bbe\uff0c\u5982\u679c\u590d\u5236\u7684\u662fcat\u547d\u4ee4\uff0c\u5176\u53ef\u6267\u884c\u7a0b\u5e8f\u7684\u8def\u5f84\u662f/bin/cat\uff0c\u90a3\u4e48\u5c31\u8981\u5c06/bin/cat\u590d\u5230/mnt/sysroot/bin/\u76ee\u5f55\u4e2d\uff0c\u5982\u679c\u590d\u5236\u7684\u662fuseradd\u547d\u4ee4\uff0c\u800cuseradd\u7684\u53ef\u6267\u884c\u6587\u4ef6\u8def\u5f84\u4e3a/usr/sbin/useradd\uff0c\u90a3\u4e48\u5c31\u8981\u5c06\u5176\u590d\u5236\u5230/mnt/sysroot/usr/sbin/\u76ee\u5f55\u4e2d\uff1b</p> <p>4\u3001\u590d\u5236\u5404\u5e93\u6587\u4ef6\u81f3/mnt/sysroot/\u5bf9\u5e94\u7684\u76ee\u5f55\u4e2d\uff1b</p> <pre><code>#!/bin/bash\ntarget=/mnt/sysroot/\n[ -d $target ] || mkdir $target\npreCommand() {\n    if which $1 &amp;&gt; /dev/null; then\n  commandPath=`which --skip-alias $1`\n  return 0\n    else\n  echo \"No such command.\"\n  return 1\n    fi\n}\n\ncommandCopy() {\n    commandDir=`dirname $1`\n    [ -d ${target}${commandDir} ] || mkdir -p ${target}${commandDir}\n    [ -f ${target}${commandPath} ] || cp $1 ${target}${commandDir}\n}\n\nlibCopy() {\n    for lib in `ldd $1 | egrep -o \"/[^[:space:]]+\"`; do\nlibDir=`dirname $lib`\n[ -d ${target}${libDir} ] || mkdir -p ${target}${libDir}\n[ -f ${target}${lib} ] || cp $lib ${target}${libDir}\n    done\n} \nread -p \"Plz enter a command: \" command\n\nuntil [ \"$command\" == 'quit' ]; do\n\n  if preCommand $command &amp;&gt; /dev/null; then\n    commandCopy $commandPath\n    libCopy $commandPath\n  fi\n\n  read -p \"Plz enter a command: \" command\ndone\n</code></pre>"},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/#bash_9","title":"bash\u7f16\u7a0b\u4e4b\u4fe1\u53f7\u6355\u6349","text":"<p>trap\u547d\u4ee4\u7528\u4e8e\u5728shell\u7a0b\u5e8f\u4e2d\u6355\u6349\u5230\u4fe1\u53f7\uff0c\u4e4b\u540e\u53ef\u4ee5\u6709\u4e09\u79cd\u53cd\u5e94\u65b9\u5f0f\uff1a</p> <ul> <li>(1)\u6267\u884c\u4e00\u6bb5\u7a0b\u5e8f\u6765\u5904\u7406\u8fd9\u4e00\u4fe1\u53f7</li> <li>(2)\u63a5\u53d7\u4fe1\u53f7\u7684\u9ed8\u8ba4\u64cd\u4f5c</li> <li>(3)\u5ffd\u89c6\u8fd9\u4e00\u4fe1\u53f7</li> </ul> <p>trap\u5bf9\u4e0a\u9762\u4e09\u79cd\u65b9\u5f0f\u63d0\u4f9b\u4e86\u4e09\u79cd\u57fa\u672c\u5f62\u5f0f\uff1a</p> <p>\u7b2c\u4e00\u79cd\u5f62\u5f0f\u7684trap\u547d\u4ee4\u5728shell\u63a5\u6536\u5230signal list\u6e05\u5355\u4e2d\u6570\u503c\u76f8\u540c\u7684\u4fe1\u53f7\u65f6\uff0c\u5c06\u6267\u884c\u53cc\u5f15\u53f7\u4e2d\u7684\u547d\u4ee4\u4e32\u3002</p> <pre><code>trap 'commands' signal-list\ntrap \"commands\" signal-list\n</code></pre> <p>\u7b2c\u4e8c\u79cd\u5f62\u5f0f\u7684trap\u547d\u4ee4\u6062\u590d\u4fe1\u53f7\u7684\u9ed8\u8ba4\u64cd\u4f5c\uff1a</p> <pre><code>trap signal-list\n</code></pre> <p>\u7b2c\u4e09\u79cd\u5f62\u5f0f\u7684trap\u547d\u4ee4\u5141\u8bb8\u5ffd\u89c6\u4fe1\u53f7\uff1a</p> <pre><code>trap \" \" signal-list\ntrap 'COMMAND' SIGINT\uff08\u8868\u793a\u5173\u95ed\u8fdb\u7a0b\uff09\n</code></pre> <p>\u4f8b\uff1a\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u80fd\u591fping\u63a2\u6d4b\u6307\u5b9a\u7f51\u7edc\u5185\u7684\u6240\u6709\u4e3b\u673a\u662f\u5426\u5728\u7ebf,\u5f53\u6ca1\u6709\u6267\u884c\u5b8c\u65f6\u53ef\u63a5\u6536ctrl+c\u547d\u4ee4\u9000\u51fa\u3002 <pre><code>#!/bin/bash\nquitScript() {\n   echo \"Quit...\"\n}    \ntrap 'quitScript; exit 5' SIGINT\n\ncnetPing() {\n  for i in {1..254}; do\n    if ping -c 1 -W 1 $1.$i &amp;&gt; /dev/null; then\n      echo \"$1.$i is up.\"\n     else\n      echo \"$1.$i is down.\"\n    fi\n    done\n}\n\nbnetPing() {\n  for j in {0..255}; do\n    cnetPing $1.$j \n  done\n}\nanetPing() {\nfor m in {0..255}; do\nbnetPing $1.$m\ndone\n}\n\nnetType=`echo $1 | cut -d\".\" -f1`\n\nif [ $netType -ge 1 -a $netType -le 126 ]; then\nanetPing $netType\nelif [ $netType -ge 128 -a $netType -le 191 ]; then\nbnetPing $(echo $1 | cut -d'.' -f1,2)\nelif [ $netType -ge 192 -a $netType -le 223 ]; then\ncnetPing $(echo $1 | cut -d'.' -f1-3)\nelse\necho \"Wrong\"\nexit 2\nfi\n</code></pre></p>"},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/#bash_10","title":"bash\u7f16\u7a0b\u4e4b\u6570\u7ec4","text":"<p>\u6570\u7ec4\uff1a\u8fde\u7eed\u7684\u591a\u4e2a\u72ec\u7acb\u5185\u5b58\u7a7a\u95f4\uff0c\u6bcf\u4e2a\u5185\u5b58\u7a7a\u95f4\u76f8\u5f53\u4e8e\u4e00\u4e2a\u53d8\u91cf \u6570\u7ec4\u5143\u7d20\uff1a\u6570\u7ec4\u540d+\u7d22\u5f15\uff08\u4ece0\u5f00\u59cb\u7f16\u53f7\uff09 \u7d22\u5f15\u7684\u8868\u793a\u65b9\u5f0f\uff1aa[0], a[1] \u58f0\u660e\u6570\u7ec4\uff1a <pre><code>declare -a ARRAR_NAME\n</code></pre> \u5173\u8054\u6570\u7ec4\uff1a <pre><code>declare -A ARRAY_NAME\n</code></pre></p> <p>\u652f\u6301\u7a00\u758f\u683c\u5f0f\uff1a\u4ec5\u4e00\u7ef4\u6570\u7ec4  </p> <p>\u6570\u7ec4\u5143\u7d20\u7684\u8d4b\u503c\uff1a</p> <p>(1) \u4e00\u6b21\u53ea\u8d4b\u503c\u4e00\u4e2a\u5143\u7d20 <pre><code>a[0]=$RANDOM\n</code></pre></p> <p>(2) \u4e00\u6b21\u8d4b\u503c\u5168\u90e8\u5143\u7d20 <pre><code>a=(red blue yellow green)\n</code></pre></p> <p>(3) \u6307\u5b9a\u7d22\u5f15\u8fdb\u884c\u8d4b\u503c <pre><code>a=([0]=green [3]=red [2]=blue [6]=yellow)\n</code></pre></p> <p>(4) \u7528\u6237\u8f93\u5165 <pre><code>read -a ARRAY\n</code></pre></p> <p>\u6570\u7ec4\u7684\u8bbf\u95ee\uff1a \u7528\u7d22\u5f15\u8bbf\u95ee\uff1a <pre><code>ARRAY[index]\n</code></pre> \u6570\u7ec4\u7684\u957f\u5ea6\uff1a</p> <p><pre><code>${#ARRAY[*]}\n${#ARRAY[@]}\n</code></pre> \u4f8b\uff1a\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u751f\u621010\u4e2a\u968f\u673a\u6570\uff0c\u4fdd\u5b58\u81f3\u6570\u7ec4\u4e2d\uff1b\u800c\u540e\u663e\u793a\u6570\u7ec4\u4e0b\u6807\u4e3a\u5076\u6570\u7684\u5143\u7d20</p> <pre><code>#\uff01/bin/bash\nfor i in {0..9}; do\n    rand[$i]=$RANDOM\n    [ $[$i%2] -eq 0 ] &amp;&amp; echo \"$i:${rand[$i]}\"\ndone\n</code></pre> <p>\u4ece\u6570\u7ec4\u4e2d\u6311\u9009\u67d0\u5143\u7d20:</p> <pre><code>${ARRAY[@]:offset:number}\n</code></pre> <p>\u5207\u7247\uff1a</p> <pre><code>offset: \u504f\u79fb\u7684\u5143\u7d20\u4e2a\u6570\nnumber: \u53d6\u51fa\u7684\u5143\u7d20\u7684\u4e2a\u6570\n${ARRAY[@]:offset}\uff1a\u53d6\u51fa\u504f\u79fb\u91cf\u540e\u7684\u6240\u6709\u5143\u7d20\n${ARRAY[@]}: \u53d6\u51fa\u6240\u6709\u5143\u7d20\n</code></pre> <p>\u6570\u7ec4\u590d\u5236\uff1a\u8981\u4f7f\u7528${ARRAY[@]}</p> <p><pre><code>$@: \u6bcf\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u4e32\n$*: \u6240\u6709\u53c2\u6570\u662f\u4e00\u4e2a\u4e32\n</code></pre> \u5411\u6570\u7ec4\u4e2d\u8ffd\u52a0\u5143\u7d20\uff1a\u975e\u7a00\u758f\u683c\u5f0f</p> <pre><code>week, \nweek[${#week[@]}]\n</code></pre> <p>\u4ece\u6570\u7ec4\u4e2d\u5220\u9664\u5143\u7d20\uff1a</p> <pre><code>unset ARRAY[index]\n</code></pre> <p>\u4f8b\uff1a\u590d\u5236\u4e00\u4e2a\u6570\u7ec4\u4e2d\u4e0b\u6807\u4e3a\u5076\u6570\u7684\u5143\u7d20\u81f3\u4e00\u4e2a\u65b0\u6570\u7ec4\u4e2d</p> <pre><code>#!/bin/bash\ndeclare -a mylogs\nlogs=(/var/log/*.log)\necho ${logs[@]}\nfor i in `seq 0 ${#logs[@]}`; do\n  if [ $[$i%2] -eq 0 ];then\n    index=${#mylogs[@]}\n     mylogs[$index]=${logs[$i]}\n  fi\ndone\necho ${mylogs[@]}\n</code></pre> <p>\u4f8b2\uff1a\u751f\u621010\u4e2a\u968f\u673a\u6570\uff0c\u5347\u5e8f\u6392\u5e8f</p> <pre><code>#!/bin/bash\nfor((i=0;i&lt;10;i++))\ndo\n  rnd[$i]=$RANDOM\ndone\necho -e \"total=${#rnd[@]}\\n${rnd[@]}\\nBegin to sort\"\nfor((i=9;i&gt;=1;i--))\ndo\n        for((j=0;j&lt;i;j++))\n  do\n  if [ ${rnd[$j]} -gt ${rnd[$[$j+1]]} ] ;then\n    swapValue=${rnd[$j]}\n    rnd[$j]=${rnd[$[$j+1]]}\n    rnd[$[$j+1]]=$swapValue\n  fi\n  done\ndone\necho ${rnd[@]}\n</code></pre> <p>\u4f8b3\uff1a\u6253\u5370\u4e5d\u4e5d\u4e58\u6cd5\u8868</p> <pre><code>#!/bin/bashfor((i=1;i&lt;=9;i++))\ndo \nstrLine=\"\"\n  for((j=1;i&lt;=9;j++))\n  do\n    strLine=$strLine\"$i*$j=\"$[$i*$j]\"\\t\"\n    [ $i -eq $j ] &amp;&amp; echo -e $strLine &amp;&amp; break\n  done\ndone\n</code></pre>"},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/#bash_11","title":"bash\u7f16\u7a0b\u4e4b\u5b57\u7b26\u4e32\u64cd\u4f5c","text":"<p>\u5b57\u7b26\u4e32\u5207\u7247\uff1a</p> <pre><code>${string:offset:length}\n[root@scholar scripts]# string='hello word'\n[root@scholar scripts]# echo ${string:2:4}\nllo\n\n\u53d6\u5c3e\u90e8\u7684\u6307\u5b9a\u4e2a\u6570\u7684\u5b57\u7b26\uff1a\n${string: -length}\n[root@scholar scripts]# echo ${string: -2}\nrd\n</code></pre> <p>\u53d6\u5b50\u4e32\uff1a\u57fa\u4e8e\u6a21\u5f0f</p> <ul> <li><code>${variable#*word}</code>\uff1a\u5728variable\u4e2d\u5b58\u50a8\u5b57\u4e32\u4e0a\uff0c\u81ea\u5de6\u800c\u53f3\uff0c\u67e5\u627e\u7b2c\u4e00\u6b21\u51fa\u73b0word\uff0c\u5220\u9664\u5b57\u7b26\u5f00\u59cb\u81f3\u6b64word\u5904\u7684\u6240\u6709\u5185\u5bb9\uff1b</li> <li>$<code>{variable##*word}</code>\uff1a\u5728variable\u4e2d\u5b58\u50a8\u5b57\u4e32\u4e0a\uff0c\u81ea\u5de6\u800c\u53f3\uff0c\u67e5\u627e\u6700\u540e\u4e00\u6b21\u51fa\u73b0word\uff0c\u5220\u9664\u5b57\u7b26\u5f00\u59cb\u81f3\u6b64word\u5904\u7684\u6240\u6709\u5185\u5bb9\uff1b   <code>file='/var/log/messages' ${file#*/}: \u8fd4\u56de\u7684\u7ed3\u679c\u662fvar/log/messages ${file##*/}: \u8fd4\u56demessages</code></li> <li><code>${variable%word*}</code>: \u5728variable\u4e2d\u5b58\u50a8\u5b57\u4e32\u4e0a\uff0c\u81ea\u53f3\u800c\u5de6\uff0c\u67e5\u627e\u7b2c\u4e00\u6b21\u51fa\u73b0word\uff0c\u5220\u9664\u6b64word\u5904\u81f3\u5b57\u4e32\u5c3e\u90e8\u7684\u6240\u6709\u5185\u5bb9\uff1b</li> <li><code>${variable%%world*}</code>:\u5728variable\u4e2d\u5b58\u50a8\u5b57\u4e32\u4e0a\uff0c\u81ea\u53f3\u800c\u5de6\uff0c\u67e5\u627e\u6700\u540e\u4e00\u6b21\u51fa\u73b0word\uff0c\u5220\u9664\u6b64word\u5904\u81f3\u5b57\u4e32\u5c3e\u90e8\u7684\u6240\u6709\u5185\u5bb9\uff1b</li> </ul> <pre><code>file='/var/log/messages'\n${file%*/}: \u8fd4\u56de\u7684\u7ed3\u679c\u662f/var/log\n${file%%*/}: \u8fd4\u56de\u7ed3\u679c\u4e3a\u7a7a\n\n\u4f8b\uff1aurl=\"http://www.redhat.com:80\"\n\u53d6\u7aef\u53e3\uff1a${url##*:}\n\u53d6\u534f\u8bae\uff1a${url%%:*}\n</code></pre> <p>\u67e5\u627e\u66ff\u6362\uff1a</p> <ul> <li><code>${variable/pattern/substi}</code>: \u66ff\u6362\u7b2c\u4e00\u6b21\u51fa\u73b0</li> </ul> <pre><code>#userinfo=`tail -1 /etc/passwd\n#echo $userinfo\nscholar:x:500:500:scholar:/home/scholar:/bin/bash\n#echo ${userinfo/scholar/redhat}\nredhat:x:500:500:scholar:/home/scholar:/bin/bash\n</code></pre> <ul> <li><code>${variable//pattern/substi}</code>\uff1a\u66ff\u6362\u6240\u6709\u7684\u51fa\u73b0</li> </ul> <pre><code>#echo ${userinfo//scholar/redhat}\nredhat:x:500:500:redhat:/home/redhat:/bin/bash\n</code></pre> <ul> <li><code>${variable/#pattern/substi}</code>\uff1a\u66ff\u6362\u884c\u9996\u88abpattern\u5339\u914d\u5230\u7684\u5185\u5bb9</li> </ul> <pre><code>#echo ${userinfo/#scholar/redhat}\nredhat:x:500:500:scholar:/home/scholar:/bin/bash\n</code></pre> <ul> <li><code>${variable/%pattern/substi}</code>\uff1a\u66ff\u6362\u884c\u5c3e\u88abpattern\u5339\u914d\u5230\u7684\u5185\u5bb9</li> </ul> <pre><code>#echo ${userinfo/%bash/redhat}\nscholar:x:500:500:scholar:/home/scholar:/bin/redhat\n</code></pre>"},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/#patternglobbing","title":"pattern\u53ef\u4ee5\u4f7f\u7528globbing\u4e2d\u7684\u5143\u5b57\u7b26\uff1a<code>* \uff1f</code>","text":"<p>\u67e5\u627e\u5220\u9664\uff1a</p> <ul> <li><code>${variable/pattern}</code>\uff1a\u5220\u9664\u7b2c\u4e00\u6b21\u51fa\u73b0</li> </ul> <pre><code>#echo ${userinfo/scholar}\n:x:500:500:scholar:/home/scholar:/bin/bash\n</code></pre> <ul> <li><code>${variable//pattern}</code>\uff1a\u5220\u9664\u6240\u6709\u7684\u51fa\u73b0</li> </ul> <pre><code>#echo ${userinfo//scholar}\n:x:500:500::/home/:/bin/bash\n</code></pre> <ul> <li><code>${variable/#pattern}</code>\uff1a\u5220\u9664\u884c\u9996\u88abpattern\u5339\u914d\u5230\u7684\u5185\u5bb9</li> </ul> <pre><code>#echo ${userinfo/#scholar}\n:x:500:500:scholar:/home/scholar:/bin/bash\n</code></pre> <ul> <li><code>${variable/%pattern}</code>\uff1a\u5220\u9664\u884c\u5c3e\u88abpattern\u5339\u914d\u5230\u7684\u5185\u5bb9</li> </ul> <pre><code>#echo ${userinfo/%bash}\nscholar:x:500:500:scholar:/home/scholar:/bin/\n</code></pre> <p>\u5927\u5c0f\u5199\u8f6c\u6362\uff1a</p> <p>\u5c0f\u2013&gt;\u5927\uff1a<code>${variable^^}</code></p> <pre><code>#echo ${userinfo^^}\nSCHOLAR:X:500:500:SCHOLAR:/HOME/SCHOLAR:/BIN/BASH\n</code></pre> <p>\u5927\u2013&gt;\u5c0f\uff1a<code>${variable,,}</code></p> <pre><code>#name=\"SCHOLAR\"\n#echo ${name,,}\nscholar\n</code></pre>"},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/#_3","title":"\u53d8\u91cf\u8d4b\u503c\u64cd\u4f5c\uff1a","text":"<ul> <li><code>${variable:-string}</code>:variable\u4e3a\u7a7a\u6216\u672a\u8bbe\u5b9a\uff0c\u90a3\u4e48\u8fd4\u56destring\uff0c\u5426\u5219\uff0c\u8fd4\u56devariable\u53d8\u91cf\u7684\u503c\uff1b</li> <li><code>${variable:=string}</code>:variable\u4e3a\u7a7a\u6216\u672a\u8bbe\u5b9a\uff0c\u5219\u8fd4\u56destring\uff0c\u4e14\u5c06string\u8d4b\u503c\u7ed9\u53d8\u91cfvariable\uff0c\u5426\u5219\uff0c\u8fd4\u56devariable\u7684\u503c\uff1b</li> </ul> <p>\u4e3a\u811a\u672c\u4f7f\u7528\u914d\u7f6e\u6587\u4ef6\uff0c\u5e76\u786e\u4fdd\u67d0\u53d8\u91cf\u6709\u53ef\u7528\u503c\u7684\u65b9\u5f0f</p> <p><code>variable=${variable:-default vaule}</code></p> <p>\u5199\u4e2a\u811a\u672c\uff0c\u914d\u7f6eetc\u76ee\u5f55\uff1b</p> <ul> <li>(1) \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u5b9a\u4e49\u53d8\u91cf\uff1b</li> <li>(2) \u5728\u811a\u672c\u4e2dsource\u914d\u7f6e\u6587\u4ef6\uff1b</li> </ul> <pre><code>#!/bin/bash\n[ -f /etc/sysconfig/network ] &amp;&amp; source /etc/network/network\n[-z \"$HOSTAME\" -o \"$HOSTNAME\" = '(none)' ] || HOSTNAME ='localhost'\n/bin/hostname $HOSTNAME\n/bin/hostname\n</code></pre>"},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/#mktemp","title":"mktemp\u547d\u4ee4\uff1a","text":"<p>mktemp [OPTIONS] filename.XXX</p> <pre><code>-d: \u521b\u5efa\u4e34\u65f6\u76ee\u5f55\n--tmpdir=/path/to/somewhere \uff1a\u6307\u5b9a\u4e34\u65f6\u6587\u4ef6\u6240\u5728\u7684\u76ee\u5f55\n\nmktemp /tmp/tmp.XXX                    #XXX\u751f\u6210\u76f8\u540c\u6570\u91cf\u968f\u673a\u5b57\u7b26\nmktemp --tmpdir=/var/tmp tmp.XXX       #\u6307\u5b9a\u76ee\u5f55\u521b\u5efa\u4e34\u65f6\u6587\u4ef6\nmktemp --tmpdir=/var/tmp -d tmp.XXX    #\u6307\u5b9a\u76ee\u5f55\u521b\u5efa\u4e34\u65f6\u76ee\u5f55\n</code></pre>"},{"location":"Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/#install","title":"install\u547d\u4ee4:","text":"<p>install [OPTIONS] SOURCE DEST install [OPTIONS] SOURCE\u2026 DIR install [OPTIONS] -d DIR \u2026</p> <pre><code>\u589e\u5f3a\u578b\u7684\u590d\u5236\u547d\u4ee4\uff1a\n-o OWNER\n-g GROUP\n-m MODE\n-d : \u521b\u5efa\u76ee\u5f55\n\ninstall /etc/fstab /tmp                 #\u590d\u5236\u6587\u4ef6\u5230\u6307\u5b9a\u76ee\u5f55\ninstall --mode=644 /etc/fstab /tmp/     #\u590d\u5236\u65f6\u6307\u5b9a\u6743\u9650\ninstall --owner=scholar /etc/fstab /tmp #\u590d\u5236\u65f6\u6307\u5b9a\u5c5e\u4e3b\ninstall --group=scholar /etc/fstab /tmp #\u590d\u5236\u65f6\u6307\u5b9a\u5c5e\u7ec4\ninstall -d /tmp/install                 #\u521b\u5efa\u76ee\u5f55\n</code></pre>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/","title":"Explain\u8be6\u89e3\u4e0e\u7d22\u5f15\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#explain","title":"explain\u8be6\u89e3\u4e0e\u7d22\u5f15\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#info","title":"info","text":"<ul> <li>1 </li> <li>2 </li> <li>3 </li> <li>4 </li> <li>5 </li> <li>6 </li> <li>7 </li> <li>8 </li> <li>9 </li> <li>10 </li> <li>11 </li> <li>12 </li> </ul> select_type \u542b\u4e49 SIMPLE \u7b80\u5355\u7684select\u67e5\u8be2,\u67e5\u8be2\u4e2d\u4e0d\u5305\u542b\u5b50\u67e5\u8be2\u6216\u8005UNION PRIMARY \u67e5\u8be2\u4e2d\u82e5\u5305\u542b\u4efb\u4f55\u590d\u6742\u7684\u5b57\u67e5\u8be2,\u6700\u5916\u5c42\u67e5\u8be2\u6807\u8bb0\u4e3a\u8be5\u6807\u8bc6 SUBQUERY \u5728SELECT\u6216WHERE\u5217\u8868\u4e2d\u5305\u542b\u4e86\u5b50\u67e5\u8be2 DERIVED \u5728FROM\u5217\u8868\u4e2d\u5305\u542b\u7684\u5b50\u67e5\u8be2,\u88ab\u6807\u8bb0\u4e3aDERIVED(\u884d\u751f)MySQL\u4f1a\u9012\u5f52\u6267\u884c\u8fd9\u4e9b\u5b50\u67e5\u8be2,\u628a\u7ed3\u679c\u653e\u5728\u4e34\u65f6\u8868\u4e2d UNION \u82e5\u7b2c\u4e8c\u4e2aSELECT\u51fa\u73b0\u5728UNION\u4e4b\u540e,\u5219\u6807\u8bb0\u4e3aUNION;\u82e5UNION\u5305\u542b\u5728FROM\u5b57\u53e5\u7684\u5b50\u67e5\u8be2\u4e2d,\u5916\u5c42SELECT\u5c06\u88ab\u6807\u8bb0\u4e3a:DERIVED UNION RESULT \u4eceUNION\u8868\u83b7\u53d6\u7ed3\u679c\u7684SELECT"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#explain-type","title":"explain \u4e4btype","text":"type \u542b\u4e49 NULL MySQL\u4e0d\u8bbf\u95ee\u4efb\u4f55\u8868,\u7d22\u5f15,\u76f4\u63a5\u8fd4\u56de\u7ed3\u679c system \u8868\u53ea\u6709\u4e00\u884c\u8bb0\u5f55(\u7b49\u4e8e\u7cfb\u7edf\u8868),\u8fd9\u662fconst\u7c7b\u578b\u7684\u7279\u4f8b,\u4e00\u822c\u4e0d\u4f1a\u51fa\u73b0 const \u8868\u793a\u901a\u8fc7\u7d22\u5f15\u4e00\u6b21\u5c31\u627e\u5230\u4e86,const\u7528\u4e8e\u6bd4\u8f83primary key\u6216\u8005unique\u7d22\u5f15.\u56e0\u4e3a\u53ea\u5339\u914d\u4e00\u884c\u6570\u636e,\u6240\u4ee5\u5f88\u5feb.\u5982\u5c06\u4e3b\u952e\u7f6e\u4e8ewhere\u5217\u8868\u4e2d,MySQL\u5c31\u80fd\u5c06\u8be5\u67e5\u8be2\u8f6c\u6362\u4e3a\u4e00\u4e2a\u5e38\u91cf.const\u4e8e\u5c06\"\u4e3b\u952e\"\u6216\"\u552f\u4e00\"\u7d22\u5f15\u7684\u6240\u6709\u90e8\u5206\u4e0e\u5e38\u91cf\u503c\u8fdb\u884c\u6bd4\u8f83 eq_ref \u7c7b\u578bref,\u533a\u522b\u5728\u4e8e\u4f7f\u7528\u7684\u662f\u552f\u4e00\u7d22\u5f15,\u4f7f\u7528\u4e3b\u952e\u7684\u5e76\u8054\u67e5\u8be2,\u5173\u8054\u67e5\u8be2\u7684\u8bb0\u5f55\u53ea\u6709\u4e00\u6761.\u5e38\u89c1\u4e8e\u4e3b\u952e\u6216\u552f\u4e00\u7d22\u5f15\u63cf\u8ff0 ref \u975e\u552f\u4e00\u6027\u7d22\u5f15\u63cf\u8ff0,\u8fd4\u56de\u5339\u914d\u67d0\u4e2a\u5355\u72ec\u503c\u5f97\u6240\u6709\u884c.\u672c\u8d28\u4e0a\u4e5f\u662f\u4e00\u79cd\u7d22\u5f15\u8bbf\u95ee,\u8fd4\u56de\u6240\u6709\u5339\u914d\u67d0\u4e2a\u5355\u72ec\u503c\u7684\u6240\u6709\u884c(\u591a\u4e2a) range \u53ea\u68c0\u7d22\u7ed9\u5b9a\u8fd4\u56de\u7684\u884c,\u4f7f\u7528\u4e00\u4e2a\u7d22\u5f15\u6765\u9009\u62e9\u884c.where\u4e4b\u540e\u51fa\u73b0between,&lt;,&gt;,in \u7b49\u64cd\u4f5c index index\u4e0eALL\u7684\u533a\u522b\u4e3aindex\u7c7b\u578b\u53ea\u662f\u904d\u5386\u4e86\u7d22\u5f15\u6811,\u901a\u5e38\u6bd4ALL\u5feb,ALL\u662f\u904d\u5386\u6570\u636e\u6587\u4ef6 ALL \u5c06\u904d\u5386\u5168\u8868\u4ee5\u627e\u5230\u5339\u914d\u7684\u884c <p>\u7ed3\u679c\u503c\u4ece \u6700\u597d \u5230 \u6700\u574f \u4f9d\u6b21\u662f:</p> <pre><code>NULL &gt; system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL\n\nsystem &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL\n</code></pre> <p>\u4e00\u822c\u6765\u8bf4,\u6211\u4eec\u9700\u8981\u4fdd\u8bc1\u67e5\u8be2\u81f3\u5c11\u8fbe\u5230range\u7ea7\u522b, \u6700\u540e\u8fbe\u5230ref.</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#explain-key","title":"explain \u4e4bkey","text":"<pre><code>possible_keys: \u663e\u793a\u53ef\u80fd\u5e94\u7528\u5728\u8fd9\u5f20\u8868\u7684\u7d22\u5f15, \u4e00\u4e2a\u6216\u591a\u4e2a\nkey: \u5b9e\u9645\u4f7f\u7528\u7684\u7d22\u5f15,\u5982\u679c\u4e3aNULL,\u5219\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\nkey_len: \u8868\u793a\u7d22\u5f15\u4e2d\u4f7f\u7528\u7684\u5b57\u8282\u6570, \u8be5\u503c\u4e3a\u7d22\u5f15\u5b57\u6bb5\u6700\u5927\u53ef\u80fd\u957f\u5ea6,\u5e76\u975e\u5b9e\u9645\u4f7f\u7528\u957f\u5ea6,\u5728\u4e0d\u635f\u5931\u7cbe\u786e\u6027\u7684\u524d\u63d0\u4e0b,\u957f\u5ea6\u8d8a\u77ed\u8d8a\u597d.\n</code></pre>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#explain-rows","title":"explain \u4e4brows","text":"<p>\u626b\u63cf\u884c\u7684\u6570\u91cf</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#explain-extra","title":"explain \u4e4bextra","text":"<p>\u5176\u4ed6\u7684\u989d\u5916\u7684\u6267\u884c\u8ba1\u5212\u4fe1\u606f,\u5728\u8be5\u5217\u663e\u793a.</p> extra \u542b\u4e49 using filesort \u8bf4\u660emysql\u4f1a\u5bf9\u6570\u636e\u4f7f\u7528\u4e00\u4e2a\u5916\u90e8\u7684\u7d22\u5f15\u6392\u5e8f,\u800c\u4e0d\u662f\u6309\u7167\u8868\u5185\u7684\u7d22\u5f15\u987a\u5e8f\u8fdb\u884c\u8bfb\u53d6,\u79f0\u4e3a\"\u6587\u4ef6\u6392\u5e8f\",\u6548\u7387\u4f4e. using temporary \u4f7f\u7528\u4e86\u4e34\u65f6\u8868\u4fdd\u5b58\u4e2d\u95f4\u7ed3\u679c,MySQL\u5728\u5bf9\u67e5\u8be2\u7ed3\u679c\u6392\u5e8f\u65f6\u4f7f\u7528\u4e34\u65f6\u8868. \u5e38\u89c1\u4e8eorder by \u548c group by, \u6548\u7387\u4f4e. using index \u8868\u793a\u76f8\u5e94\u7684select\u64cd\u4f5c\u4f7f\u7528\u4e86\u8986\u76d6\u7d22\u5f15,\u907f\u514d\u8bbf\u95ee\u8868\u7684\u6570\u636e\u884c,\u6548\u7387\u4e0d\u9519. <p>6). \u5c3d\u91cf\u4f7f\u7528\u8986\u76d6\u7d22\u5f15,\u907f\u514dselect *</p> <p>\u5c3d\u91cf\u4f7f\u7528\u8986\u76d6\u7d22\u5f15(\u53ea\u8bbf\u95ee\u7d22\u5f15\u7684\u67e5\u8be2(\u7d22\u5f15\u5217 \u5b8c\u5168\u5305\u542b \u67e5\u8be2\u5217)),\u51cf\u5c11<code>select *</code>.</p> <p>\u5982\u679c\u67e5\u8be2\u7c7b,\u8d85\u51fa\u7d22\u5f15\u5217,\u4e5f\u4f1a\u964d\u4f4e\u6027\u80fd.</p> <pre><code>TIP:\n using index: \u4f7f\u7528\u8986\u76d6\u7d22\u5f15\u7684\u65f6\u5019\u5c31\u4f1a\u51fa\u73b0\n using where: \u5728\u67e5\u627e\u4f7f\u7528\u7d22\u5f15\u7684\u60c5\u51b5\u4e0b, \u9700\u8981\u56de\u8868\u67e5\u8be2\u6570\u636e\n using index condition: \u67e5\u627e\u4f7f\u7528\u4e86\u7d22\u5f15, \u4f46\u662f\u9700\u8981\u56de\u8868\u67e5\u8be2\u6570\u636e\n using index; using where: \u67e5\u627e\u4f7f\u7528\u4e86\u7d22\u5f15, \u4f46\u662f\u9700\u8981\u7684\u6570\u636e\u90fd\u5728\u7d22\u5f15\u5217\u4e2d\u80fd\u627e\u5230, \u6240\u4ee5\u4e0d\u9700\u8981\u56de\u8868\u67e5\u8be2\u6570\u636e\n</code></pre> <p>12) \u5355\u5217\u7d22\u5f15\u548c\u590d\u5408\u7d22\u5f15</p> <p>\u5c3d\u91cf\u4f7f\u7528\u590d\u5408\u7d22\u5f15, \u800c\u5c11\u4f7f\u7528\u5355\u5217\u7d22\u5f15</p> <ul> <li>\u521b\u5efa\u590d\u5408\u7d22\u5f15</li> </ul> <pre><code>create index idx_name_sta_address on tb_seller(name, status, address);\n\u5c31\u76f8\u5f53\u4e8e\u521b\u5efa\u4e86\u4e09\u4e2a\u7d22\u5f15:\n\nname\nname + status\nname + status + address\n</code></pre> <ul> <li>\u521b\u5efa\u5355\u5217\u7d22\u5f15</li> </ul> <pre><code>create index idx_seller_name on tb_sell(name);\ncreate index idx_seller_status on tb_sell(status);\ncreate index idx_seller_address on tb_sell(address);\n</code></pre> <p>\u6570\u636e\u5e93\u4f1a\u9009\u62e9\u4e00\u4e2a\u6700\u4f18\u7684\u7d22\u5f15(\u8fa8\u8bc6\u5ea6\u6700\u9ad8\u7d22\u5f15)\u6765\u4f7f\u7528,\u5e76\u4e0d\u4f1a\u4f7f\u7528\u5168\u90e8\u7d22\u5f15.</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_1","title":"\u67e5\u770b\u7d22\u5f15\u7d22\u5f15\u60c5\u51b5","text":"<pre><code>show status like 'Handler_read%';\nshow global status like 'Handler_read%';\n</code></pre> <pre><code>02:06:55 root@localhost[database1]&gt; show status like 'Handler_read%';\n\n+-----------------------+-------+\n| Variable_name         | Value |\n+-----------------------+-------+\n| Handler_read_first    | 0     |\n| Handler_read_key      | 0     |\n| Handler_read_last     | 0     |\n| Handler_read_next     | 0     |\n| Handler_read_prev     | 0     |\n| Handler_read_rnd      | 0     |\n| Handler_read_rnd_next | 34    |\n+-----------------------+-------+\n7 rows in set (0.01 sec)\n\n05:08:03 root@localhost[database1]&gt; show global status like 'Handler_read%';\n+-----------------------+--------------+\n| Variable_name         | Value        |\n+-----------------------+--------------+\n| Handler_read_first    | 622670       |\n| Handler_read_key      | 254215292    |\n| Handler_read_last     | 29           |\n| Handler_read_next     | 273266451    |\n| Handler_read_prev     | 97           |\n| Handler_read_rnd      | 10101645     |\n| Handler_read_rnd_next | 166307007667 |\n+-----------------------+--------------+\n7 rows in set (0.00 sec)\n\n05:08:11 root@localhost[database1]&gt;\n</code></pre> <ul> <li> <p>Handler_read_first: \u7d22\u5f15\u4e2d\u7b2c\u4e00\u6761\u88ab\u8bfb\u7684\u6b21\u6570.\u5982\u679c\u9ad8,\u8868\u793a\u670d\u52a1\u5668\u6b63\u6267\u884c\u5927\u91cf\u5168\u7d22\u5f15\u626b\u63cf(\u8fd9\u4e2a\u503c\u8d8a\u4f4e\u8d8a\u597d).</p> </li> <li> <p>Handler_read_key: \u5982\u679c\u7d22\u5f15\u6b63\u5728\u5de5\u4f5c,\u8fd9\u4e2a\u503c\u4ee3\u8868\u4e00\u4e2a\u884c\u88ab\u7d22\u5f15\u503c\u8bfb\u7684\u6b21\u6570,\u5982\u679c\u503c\u8d8a\u4f4e,\u8868\u793a\u7d22\u5f15\u5f97\u5230\u7684\u6027\u80fd\u6539\u5584\u4e0d\u9ad8,\u56e0\u4e3a\u7d22\u5f15\u4e0d\u7ecf\u5e38\u4f7f\u7528(\u8fd9\u4e2a\u503c\u8d8a\u9ad8\u8d8a\u597d).</p> </li> <li> <p>Handler_read_rnd: \u6839\u636e\u56fa\u5b9a\u4f4d\u7f6e\u8bfb\u4e00\u884c\u7684\u8bf7\u6c42\u503c. \u5982\u679c\u4f60\u6b63\u6267\u884c\u5927\u91cf\u67e5\u8be2\u5e76\u9700\u8981\u5bf9\u7ed3\u679c\u8fdb\u884c\u6392\u5e8f,\u8be5\u503c\u5e94\u8be5\u8f83\u9ad8. \u4f60\u53ef\u80fd\u4f7f\u7528\u4e86\u5927\u91cf\u9700\u8981MySQL\u626b\u63cf\u8fd9\u4e2a\u8868\u7684\u67e5\u8be2\u6216\u4f60\u7684\u8fde\u63a5\u6ca1\u6709\u6b63\u786e\u4f7f\u7528\u952e.\u8fd9\u4e2a\u503c\u8f83\u9ad8,\u610f\u5473\u7740\u8fd0\u884c\u6548\u7387\u4f4e,\u53ef\u4ee5\u5efa\u7acb\u7d22\u5f15\u6765\u8865\u6551.</p> </li> <li> <p>Handler_read_rnd_next: \u5728\u6570\u636e\u6587\u4ef6\u4e2d\u8bfb\u4e0b\u4e00\u884c\u7684\u8bf7\u6c42\u6570.\u5982\u679c\u4f60\u6b63\u5728\u8fdb\u884c\u5927\u91cf\u7684\u8868\u626b\u63cf,\u8be5\u503c\u8f83\u9ad8.\u901a\u5e38\u8bf4\u660e\u4f60\u7684\u8868\u7684\u7d22\u5f15\u4e0d\u6b63\u786e\u6216\u5199\u5165\u7684\u67e5\u8be2\u6ca1\u6709\u5229\u7528\u7d22\u5f15.</p> </li> </ul>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#sql","title":"SQL\u4f18\u5316","text":"<ol> <li> <p>\u5927\u6279\u91cf\u63d2\u5165</p> <ul> <li> <p>\u4f7f\u7528load\u547d\u4ee4\u5bfc\u5165\u6570\u636e\u7684\u65f6\u5019,\u9002\u5f53\u7684\u8bbe\u7f6e\u53ef\u4ee5\u63d0\u9ad8\u5bfc\u5165\u7684\u6548\u7387.</p> <ul> <li> <p>\u5bf9\u4e8eInnoDB\u7c7b\u578b\u7684\u8868,\u6709\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\u53ef\u4ee5\u63d0\u9ad8\u5bfc\u5165\u7684\u6548\u7387:</p> <ol> <li> <p>\u4e3b\u952e\u987a\u5e8f\u63d2\u5165</p> <ul> <li>\u56e0\u4e3aInnoDB\u7c7b\u578b\u7684\u8868\u793a\u6309\u7167\u4e3b\u952e\u7684\u987a\u5e8f\u4fdd\u5b58\u7684,\u6240\u4ee5\u5c06\u5bfc\u5165\u7684\u6570\u636e\u6309\u7167\u4e3b\u952e\u7684\u987a\u5e8f\u6392\u5217,\u53ef\u4ee5\u6709\u6548\u7684\u63d0\u9ad8\u5bfc\u5165\u6570\u636e\u7684\u6548\u7387. \u5982\u679cInnoDB\u8868\u6ca1\u6709\u4e3b\u952e,\u90a3\u4e48\u7cfb\u7edf\u4f1a\u81ea\u52a8\u9ed8\u8ba4\u521b\u5efa\u4e00\u4e2a\u5185\u90e8\u5217\u4f5c\u4e3a\u4e3b\u952e,\u6240\u4ee5\u5982\u679c\u53ef\u4ee5\u7ed9\u8868\u521b\u5efa\u4e00\u4e2a\u4e3b\u952e,\u5c06\u53ef\u4ee5\u5229\u7528\u8fd9\u70b9,\u6765\u63d0\u9ad8\u5bfc\u5165\u6570\u636e\u7684\u6548\u7387.<ul> <li>\u63d2\u5165ID\u987a\u5e8f\u6392\u5217\u6570\u636e</li> <li>\u63d2\u5165ID\u65e0\u5e8f\u6392\u5217\u6570\u636e</li> </ul> </li> </ul> </li> <li> <p>\u5173\u95ed\u552f\u4e00\u6027\u6821\u9a8c</p> <ul> <li>\u5728\u5bfc\u5165\u6570\u636e\u524d\u6267\u884c <code>SET UNIQUE_CHECKS = 0</code>, \u5173\u95ed\u552f\u4e00\u6027\u6821\u9a8c, \u5728\u5bfc\u5165\u7ed3\u675f\u540e\u6267\u884c <code>SET UNIQUE_CHECKS = 1</code>, \u6062\u590d\u552f\u4e00\u6027\u6821\u9a8c, \u53ef\u4ee5\u63d0\u9ad8\u5bfc\u5165\u7684\u6548\u7387.</li> </ul> </li> <li> <p>\u624b\u52a8\u63d0\u4ea4\u4e8b\u52a1</p> <ol> <li>\u5982\u679c\u5e94\u7528\u4f7f\u7528\u81ea\u52a8\u63d0\u4ea4\u7684\u65b9\u5f0f,\u5efa\u8bae\u5728\u5bfc\u5165\u524d\u6267\u884c <code>SET AUTOCOMMIT=0</code>, \u5173\u95ed\u81ea\u52a8\u63d0\u4ea4, \u5bfc\u5165\u7ed3\u675f\u540e\u518d\u6267\u884c <code>SET AUTOCOMMIT=1</code>, \u6253\u5f00\u81ea\u52a8\u63d0\u4ea4, \u4e5f\u53ef\u4ee5\u63d0\u9ad8\u5bfc\u5165\u7684\u6548\u7387.</li> </ol> </li> </ol> </li> </ul> </li> </ul> </li> <li> <p>\u4f18\u5316insert\u8bed\u53e5</p> <ol> <li> <p>\u5f53\u8fdb\u884c\u6570\u636e\u7684insert\u64cd\u4f5c\u7684\u65f6\u5019,\u53ef\u4ee5\u8003\u8651\u91c7\u7528\u4ee5\u4e0b\u51e0\u79cd\u4f18\u5316\u65b9\u6848</p> <ul> <li>\u5982\u679c\u9700\u8981\u540c\u65f6\u5bf9\u4e00\u5f20\u8868\u63d2\u5165\u5f88\u591a\u884c\u6570\u636e\u65f6,\u5e94\u8be5\u5c3d\u91cf\u4f7f\u7528\u591a\u4e2a\u503c\u8868\u7684insert\u8bed\u53e5,\u8fd9\u79cd\u65b9\u5f0f\u5c06\u5927\u5927\u7684\u7f29\u51cf\u5ba2\u6237\u7aef\u4e0e\u6570\u636e\u5e93\u4e4b\u95f4\u7684\u8fde\u63a5,\u5173\u95ed\u793a\u4f8b,\u539f\u59cb\u65b9\u5f0f\u4e3a:<ul> <li>\u539f\u59cb\u65b9\u5f0f\u4e3a:<ul> <li> Sql <pre><code>insert into tb_test values(1,'Tom');\ninsert into tb_test values(2,'Cat');\ninsert into tb_test values(3,'Jerry');\n</code></pre> </li> </ul> </li> <li>\u4f18\u5316\u540e\u7684\u65b9\u6848\u4e3a:<ul> <li> Sql <pre><code>insert into tb_test values(1,'Tom'),(2,'Cat'),(3,'Jerry');\n</code></pre> </li> </ul> </li> </ul> </li> </ul> </li> <li> <p>\u5728\u4e8b\u52a1\u4e2d\u8fdb\u884c\u6570\u636e\u63d2\u5165</p> <ul> <li> Sql <pre><code>start transaction;\ninsert into tb_test values(1,'Tom');\ninsert into tb_test values(2,'Cat');\ninsert into tb_test values(3,'Jerry');\ncommit;\n</code></pre> </li> </ul> </li> <li> <p>\u6570\u636e\u6709\u5e8f\u63d2\u5165</p> <ul> <li>\u539f\u59cb\u65b9\u5f0f\u4e3a:<ul> <li> Sql <pre><code>insert into tb_test values(4,'Tim');\ninsert into tb_test values(1,'Tom');\ninsert into tb_test values(5,'Rose');\ninsert into tb_test values(3,'Jerry');\ninsert into tb_test values(2,'Cat');\n</code></pre> </li> </ul> </li> <li>\u4f18\u5316\u540e\u7684\u65b9\u6848\u4e3a:<ul> <li> Sql <pre><code>insert into tb_test values(1,'Tom');\ninsert into tb_test values(2,'Cat');\ninsert into tb_test values(3,'Jerry');\ninsert into tb_test values(4,'Tim');\ninsert into tb_test values(5,'Rose');\n</code></pre> </li> </ul> </li> </ul> </li> </ol> </li> <li> <p>\u4f18\u5316order by\u8bed\u53e5</p> <ol> <li> <p>\u4e24\u79cd\u6392\u5e8f\u65b9\u5f0f</p> <ol> <li>\u7b2c\u4e00\u79cd\u662f\u901a\u8fc7\u5bf9\u8fd4\u56de\u6570\u636e\u8fdb\u884c\u6392\u5e8f,\u4e5f\u5c31\u662f\u901a\u5e38\u8bf4\u7684 filesort \u6392\u5e8f, \u6240\u6709\u4e0d\u662f\u901a\u8fc7\u7d22\u5f15\u76f4\u63a5\u8fd4\u56de\u6392\u5e8f\u7ed3\u679c\u7684\u6392\u5e8f\u90fd\u53ebFilesort\u6392\u5e8f.</li> <li>\u7b2c\u4e8c\u79cd\u901a\u8fc7\u6709\u5e8f\u7d22\u5f15\u987a\u5e8f\u626b\u63cf\u76f4\u63a5\u8fd4\u56de\u6709\u5e8f\u6570\u636e,\u8fd9\u79cd\u60c5\u51b5\u5373\u4e3a<code>using index</code>, \u4e0d\u9700\u8981\u989d\u5916\u6392\u5e8f,\u64cd\u4f5c\u6548\u7387\u9ad8.</li> </ol> </li> <li> <p>\u4e86\u89e3\u4e86MySQL\u7684\u6392\u5e8f\u65b9\u5f0f,\u4f18\u5316\u76ee\u6807\u5c31\u6e05\u6670\u4e86:</p> <ol> <li>\u5c3d\u91cf\u51cf\u5c11\u989d\u5916\u7684\u6392\u5e8f,\u901a\u8fc7\u7d22\u5f15\u76f4\u63a5\u8fd4\u56de\u6709\u5e8f\u6570\u636e.</li> <li><code>where</code>\u6761\u4ef6\u548c<code>order by</code> \u4f7f\u7528\u76f8\u540c\u7684\u7d22\u5f15,\u5e76\u4e14<code>Order by</code> \u7684\u987a\u5e8f\u548c<code>\u7d22\u5f15\u987a\u5e8f</code>\u76f8\u540c, \u5e76\u4e14<code>order by</code> \u7684\u5b57\u6bb5\u90fd\u662f\u5347\u5e8f,\u6216\u8005\u90fd\u662f\u964d\u5e8f. \u5426\u5219\u80af\u5b9a\u9700\u8981\u989d\u5916\u7684\u64cd\u4f5c, \u8fd9\u6837\u5c31\u4f1a\u51fa\u73b0FileSort.</li> </ol> </li> </ol> </li> <li> <p>Filesort\u7684\u4f18\u5316</p> <ul> <li> <p>\u901a\u8fc7\u521b\u5efa\u5408\u9002\u7684\u7d22\u5f15,\u80fd\u591f\u51cf\u5c11filesort\u7684\u51fa\u73b0,\u4f46\u662f\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b,\u6761\u4ef6\u9650\u5236\u4e0d\u80fd\u8ba9Filesort\u6d88\u5931,\u90a3\u5c31\u9700\u8981\u52a0\u5febFilesort\u7684\u6392\u5e8f\u64cd\u4f5c.\u5bf9\u4e8eFileSort, MySQL\u6709\u4e24\u79cd\u6392\u5e8f\u7b97\u6cd5:</p> <ul> <li>\u4e24\u6b21\u626b\u63cf\u7b97\u6cd5: MySQL4.1 \u4e4b\u524d, \u4f7f\u7528\u8be5\u65b9\u5f0f\u6392\u5e8f. \u9996\u5148\u6839\u636e\u6761\u4ef6\u53d6\u51fa\u6392\u5e8f\u5b57\u6bb5\u548c\u884c\u6307\u9488\u4fe1\u606f,\u7136\u540e\u5728\u6392\u5e8f\u533a sort buffer \u4e2d\u6392\u5e8f, \u5982\u679csort buffer \u4e0d\u591f,\u5219\u5728\u4e34\u65f6\u8868temporary table \u4e2d\u5b58\u50a8\u6392\u5e8f\u7ed3\u679c. \u5b8c\u6210\u6392\u5e8f\u540e, \u518d\u6839\u636e\u884c\u6307\u9488\u56de\u8868\u8bfb\u53d6\u8bb0\u5f55, \u8be5\u64cd\u4f5c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5927\u91cf\u968f\u673aIO\u64cd\u4f5c.</li> <li>\u4e00\u6b21\u626b\u63cf\u7b97\u6cd5: \u4e00\u6b21\u6027\u53d6\u51fa\u6ee1\u8db3\u6761\u4ef6\u7684\u7d22\u5f15\u5b57\u6bb5,\u7136\u540e\u5728\u6392\u5e8f\u533asort buffer \u4e2d\u6392\u5e8f\u540e\u76f4\u63a5\u8f93\u51fa\u7ed3\u679c\u96c6. \u6392\u5e8f\u65f6\u5185\u5b58\u5f00\u9500\u8f83\u5927, \u4f46\u662f\u6392\u5e8f\u6548\u7387\u6bd4\u4e24\u6b21\u626b\u63cf\u7b97\u6cd5\u8981\u9ad8.</li> </ul> </li> <li> <p>MySQL\u901a\u8fc7\u6bd4\u8f83\u7cfb\u7edf\u53d8\u91cf <code>max_length_for_sort_data</code>\u7684\u5927\u5c0f\u548cQuery\u8bed\u53e5\u53d6\u51fa\u7684\u5b57\u6bb5\u603b\u5927\u5c0f,\u6765\u5224\u65ad\u662f\u5426\u90a3\u79cd\u6392\u5e8f\u7b97\u6cd5,\u5982\u679c<code>max_length_for_sort_data</code> \u66f4\u5927,\u90a3\u4e48\u4f7f\u7528\u7b2c\u4e8c\u79cd\u4f18\u5316\u4e4b\u540e\u7684\u7b97\u6cd5,\u5426\u5219\u4f7f\u7528\u7b2c\u4e00\u79cd. \u53ef\u4ee5\u9002\u5f53\u63d0\u9ad8<code>sort_buffer_size</code>\u548c<code>max_length_for_sort_date</code>\u7cfb\u7edf\u53d8\u91cf,\u6765\u589e\u5927\u6392\u5e8f\u533a\u7684\u5927\u5c0f,\u63d0\u9ad8\u6392\u5e8f\u7684\u6548\u7387.</p> </li> </ul> </li> <li> <p>\u4f18\u5316group by\u8bed\u53e5</p> <ul> <li> <p>\u7531\u4e8egroup by \u5b9e\u9645\u4e0a\u4e5f\u540c\u6837\u4f1a\u8fdb\u884c\u6392\u5e8f\u64cd\u4f5c, \u800c\u4e14\u4e8eorder by \u76f8\u6bd4,group by \u53ea\u8981\u53ea\u662f\u591a\u4e86\u6392\u5e8f\u4e4b\u540e\u7684\u5206\u7ec4\u64cd\u4f5c. \u5f53\u7136,\u5982\u679c\u5728\u5206\u7ec4\u7684\u65f6\u5019\u8fd8\u4f7f\u7528\u4e86\u5176\u4ed6\u7684\u4e00\u4e9b\u805a\u5408\u51fd\u6570, \u90a3\u4e48\u8fd8\u9700\u8981\u4e00\u4e9b\u805a\u5408\u51fd\u6570\u7684\u8ba1\u7b97.\u6240\u4ee5,\u5728group by \u7684\u5b9e\u73b0\u8fc7\u7a0b\u4e2d,\u4e8eorder by\u4e00\u6837\u4e5f\u53ef\u4ee5\u5229\u7528\u5230\u7d22\u5f15. </p> </li> <li> <p>\u5982\u679c\u67e5\u8be2\u5305\u542bgroup by \u4f46\u662f\u7528\u6237\u60f3\u8981\u907f\u514d\u6392\u5e8f\u7ed3\u679c\u7684\u6d88\u8017,\u5219\u53ef\u4ee5\u6267\u884c<code>order by null</code> \u7981\u6b62\u6392\u5e8f. \u5982\u4e0b:</p> <ul> <li> Sql <pre><code>explain select age, count(*) from emp group by age;\n</code></pre> </li> </ul> </li> <li> <p>\u4f18\u5316\u540e</p> <ul> <li> Sql <pre><code>explain select age,count(*) from emp group by age order by null;\n</code></pre> </li> </ul> </li> </ul> </li> <li> <p>\u4f18\u5316\u5d4c\u5957\u67e5\u8be2</p> <ul> <li>MySQL4.1 \u7248\u672c\u4e4b\u540e,\u5f00\u59cb\u652f\u6301SQL\u7684\u5b50\u67e5\u8be2.\u8fd9\u4e2a\u6280\u672f\u53ef\u4ee5\u4f7f\u7528select\u8bed\u53e5\u6765\u521b\u5efa\u4e00\u4e2a\u5355\u5217\u7684\u67e5\u8be2,\u7136\u540e\u628a\u8fd9\u4e2a\u7ed3\u679c\u4f5c\u4e3a\u8fc7\u6ee4\u6761\u4ef6\u7528\u5728\u53e6\u4e00\u4e2a\u67e5\u8be2\u4e2d. \u4f7f\u7528\u5b50\u67e5\u8be2\u53ef\u4ee5\u4e00\u6b21\u6027\u7684\u5b8c\u6210\u5f88\u591a\u903b\u8f91\u4e0a\u9700\u8981\u591a\u4e2a\u6b65\u9aa4\u624d\u80fd\u5b8c\u6210\u7684SQL\u64cd\u4f5c, \u540c\u65f6\u4e5f\u53ef\u4ee5\u907f\u514d\u4e8b\u52a1\u6216\u8868\u9501\u6b7b, \u5e76\u4e14\u5199\u8d77\u6765\u4e5f\u5f88\u5bb9\u6613. \u4f46\u662f,\u6709\u4e9b\u60c5\u51b5\u4e0b,\u5b50\u67e5\u8be2\u662f\u53ef\u4ee5\u88ab\u8ddf\u9ad8\u6548\u7684\u8fde\u63a5(JOIN)\u4ee3\u66ff.</li> </ul> </li> <li> <p>\u4f18\u5316OR\u6761\u4ef6</p> <ul> <li> <p>\u5bf9\u4e8e\u5305\u542bOR\u67e5\u8be2\u5b50\u53e5,\u5982\u679c\u8981\u5229\u7528\u7d22\u5f15,\u5219OR\u4e4b\u95f4\u7684\u6bcf\u4e2a\u6761\u4ef6\u5217\u90fd\u5fc5\u987b\u7528\u5230\u7d22\u5f15, \u800c\u4e14\u4e0d\u80fd\u4f7f\u7528\u5230\u590d\u5408\u7d22\u5f15; \u5982\u679c\u6ca1\u6709\u7d22\u5f15,\u5219\u5e94\u8be5\u8003\u8651\u589e\u52a0\u7d22\u5f15.</p> <ul> <li>\u5efa\u8bae\u4f7f\u7528union\u66ff\u6362or</li> </ul> </li> <li> <p>type\u663e\u793a\u7684\u662f\u8bbf\u95ee\u7c7b\u578b,\u662f\u8f83\u4e3a\u91cd\u8981\u7684\u4e00\u4e2a\u6307\u6807,\u7ed3\u679c\u503c\u4ece\u597d\u5230\u574f\u4f9d\u6b21\u662f:</p> <ul> <li> Sql <pre><code>system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merger &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL\n</code></pre> </li> </ul> </li> <li> <p>UNION \u8bed\u53e5\u7684type\u503c\u4e3aref, OR\u8bed\u53e5\u7684type\u503c\u4e3arange, \u53ef\u4ee5\u770b\u5230\u8fd9\u662f\u4e00\u4e2a\u5f88\u660e\u663e\u7684\u5dee\u8ddd</p> </li> <li>UNION \u8bed\u53e5\u7684ref\u503c\u4e3aconst, OR\u8bed\u53e5\u7684type\u503c\u4e3anull, const\u8868\u793a\u662f\u5e38\u91cf\u503c\u5f15\u7528,\u975e\u5e38\u5feb</li> <li>\u8fd9\u4e24\u9879\u7684\u5dee\u8ddd\u5c31\u8bf4\u660e\u4e86UNION\u8981\u4f18\u4e8eOR.</li> </ul> </li> <li> <p>\u4f18\u5316\u5206\u9875\u67e5\u8be2</p> <ul> <li> <p>\u4e00\u822c\u5206\u9875\u67e5\u8be2\u65f6,\u901a\u8fc7\u521b\u5efa\u8986\u76d6\u7d22\u5f15\u80fd\u591f\u6bd4\u8f83\u597d\u7684\u63d0\u9ad8\u6027\u80fd. \u4e00\u4e2a\u5e38\u89c1\u53c8\u975e\u5e38\u5934\u75bc\u7684\u95ee\u9898\u5c31\u662f limit 2000000, 10 , \u6b64\u65f6\u9700\u8981MySQL\u6392\u5e8f\u524d 2000010 \u8bb0\u5f55, \u4ec5\u4ec5\u8fd4\u56de2000000 - 2000010 \u7684\u8bb0\u5f55, \u5176\u4ed6\u8bb0\u5f55\u4e22\u5f03, \u67e5\u8be2\u6392\u5e8f\u7684\u4ee3\u4ef7\u975e\u5e38\u5927.</p> <ul> <li> <p>\u4f18\u5316\u601d\u8def\u4e00</p> <ul> <li>\u5728\u7d22\u5f15\u4e0a\u5b8c\u6210\u6392\u5e8f\u5206\u9875\u64cd\u4f5c, \u6700\u540e\u6839\u636e\u4e3b\u952e\u5173\u8054\u56de\u539f\u8868\u67e5\u8be2\u6240\u9700\u8981\u7684\u5176\u4ed6\u5217\u5185\u5bb9.</li> </ul> </li> <li> <p>\u4f18\u5316\u601d\u8def\u4e8c</p> <ul> <li>\u8be5\u65b9\u6848\u9002\u5e94\u4e8e\u4e3b\u952e\u81ea\u589e\u7684\u8868,\u53ef\u4ee5\u628aLimit\u67e5\u8be2\u8f6c\u6362\u6210\u67d0\u4e2a\u4f4d\u7f6e\u7684\u67e5\u8be2.</li> </ul> </li> </ul> </li> </ul> </li> <li> <p>\u9002\u5e94SQL\u63d0\u793a</p> <ul> <li>SQL\u63d0\u793a, \u662f\u4f18\u5316\u6570\u636e\u5e93\u7684\u4e00\u4e2a\u91cd\u8981\u5b57\u6bb5, \u7b80\u5355\u6765\u8bf4, \u5c31\u662f\u5728SQL\u8bed\u53e5\u4e2d\u52a0\u5165\u4e00\u4e9b\u4eba\u4e3a\u7684\u63d0\u793a\u6765\u8fbe\u5230\u4f18\u5316\u64cd\u4f5c\u7684\u76ee\u7684.<ul> <li>USE INDEX<ul> <li>\u5728\u67e5\u8be2\u8bed\u53e5\u4e2d\u8868\u540d\u7684\u540e\u9762,\u6dfb\u52a0 use index \u6765\u63d0\u4f9b\u5e0c\u671bMySQL\u53bb\u53c2\u8003\u7684\u7d22\u5f15\u5217\u8868,\u5c31\u53ef\u4ee5\u8ba9MySQL\u4e0d\u518d\u8003\u8651\u5176\u4ed6\u53ef\u7528\u7684\u7d22\u5f15.</li> <li><code>create index idx_serller_name on tb_sellwe(name);</code></li> </ul> </li> <li>IGNORE INDEX<ul> <li>\u5982\u679c\u7528\u6237\u53ea\u662f\u5355\u7eaf\u7684\u60f3\u8ba9MySQL\u5ffd\u7565\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u7d22\u5f15, \u5219\u53ef\u4ee5\u4f7f\u7528 ignore index \u4f5c\u4e3a hint.</li> <li><code>explain select * from tb_seller ignore index(idx_seller_name) where name = 'xxx';</code></li> </ul> </li> <li>FORCE INDEX<ul> <li>\u4e3a\u5f3a\u5236MySQL\u4f7f\u7528\u4e00\u4e2a\u7279\u5b9a\u7684\u7d22\u5f15, \u53ef\u5728\u67e5\u8be2\u4e2d\u4f7f\u7528 force index \u4f5c\u4e3ahint.</li> <li><code>explain select * from tb_seller force index(idx_seller_address) wher address = 'xxx';</code></li> </ul> </li> </ul> </li> </ul> </li> </ol>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_2","title":"\u67e5\u8be2\u7f13\u5b58\u914d\u7f6e","text":"<pre><code>mysql&gt; show status like 'Qcache%';\n+-------------------------+------------+\n| Variable_name           | Value      |\n+-------------------------+------------+\n| Qcache_free_blocks      | 23822      | &lt;- \u53ef\u7528\u7684\u5185\u5b58\u7684\u5757\u7684\u4e2a\u6570\n| Qcache_free_memory      | 70259792   | &lt;- \u53ef\u7528\u7684\u5185\u5b58\u7684\u7a7a\u95f4,\u5bb9\u91cf\n| Qcache_hits             | 1594706026 | &lt;- \u67e5\u8be2\u7f13\u51b2\u7684\u547d\u4e2d\u6b21\u6570\n| Qcache_inserts          | 678651145  | &lt;- \u6dfb\u52a0\u5230\u67e5\u8be2\u7f13\u51b2\u7684\u6b21\u6570\n| Qcache_lowmem_prunes    | 237160055  | &lt;- \u5982\u679c\u5185\u5b58\u4e0d\u8db3,\u5c06\u6570\u636e\u79fb\u9664\u51fa\u5185\u5b58\u7a7a\u95f4\u7684\u6b21\u6570\n| Qcache_not_cached       | 1344572761 | &lt;- \u672a\u505a\u7f13\u5b58\u7684\u6b21\u6570\n| Qcache_queries_in_cache | 67682      | &lt;- \u67e5\u8be2\u7f13\u5b58\u4e2d\u6ce8\u518c\u7684\u67e5\u8be2\u6570\n| Qcache_total_blocks     | 181973     | &lt;- \u67e5\u8be2\u7f13\u5b58\u4e2d\u7684\u5757\u603b\u6570\n+-------------------------+------------+\n</code></pre> \u53c2\u6570 \u542b\u4e49 Qcache_free_blocks \u67e5\u8be2\u7f13\u5b58\u4e2d\u7684\u53ef\u4ee5\u5185\u5b58\u5757\u6570 Qcache_free_memory \u67e5\u8be2\u7f13\u5b58\u7684\u53ef\u7528\u5185\u5b58\u91cf Qcache_hits \u67e5\u8be2\u7f13\u5b58\u547d\u4e2d\u7387 Qcache_inserts \u6dfb\u52a0\u5230\u67e5\u8be2\u7f13\u5b58\u7684\u67e5\u8be2\u6570 Qcache_lowmem_prunes \u7531\u4e8e\u5185\u5b58\u4e0d\u8db3\u800c\u4ece\u67e5\u8be2\u7f13\u5b58\u4e2d\u5220\u9664\u7684\u67e5\u8be2\u6570 Qcache_not_cached \u975e\u7f13\u5b58\u67e5\u8be2\u7684\u6570\u91cf(\u7531\u4e8equery_cache_type\u8bbe\u7f6e\u800c\u65e0\u6cd5\u7f13\u5b58\u6216\u672a\u7f13\u5b58) Qcache_queries_in_cache \u67e5\u8be2\u7f13\u5b58\u4e2d\u6ce8\u518c\u7684\u67e5\u8be2\u6570 Qcache_total_blocks \u67e5\u8be2\u7f13\u5b58\u4e2d\u7684\u5757\u603b\u6570"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_3","title":"\u5f00\u542f\u67e5\u8be2\u7f13\u5b58","text":"<p>MySQL\u7684\u67e5\u8be2\u7f13\u5b58\u9ed8\u8ba4\u662f\u5173\u95ed\u7684, \u9700\u8981\u624b\u52a8\u914d\u7f6e\u53c2\u6570 <code>query_cache_type</code>,\u6765\u5f00\u542f\u67e5\u8be2\u7f13\u5b58. <code>query_cache_type</code>\u8be5\u53c2\u6570\u7684\u53ef\u53d6\u503c\u6709\u4e09\u4e2a</p> \u503c \u542b\u4e49 OFF \u6216 0 \u67e5\u8be2\u7f13\u5b58\u529f\u80fd\u5173\u95ed ON \u6216 1 \u67e5\u8be2\u7f13\u5b58\u529f\u80fd\u6253\u5f00, SELECT \u7684\u7ed3\u679c\u7b26\u5408\u7f13\u5b58\u6761\u4ef6\u5373\u4f1a\u7f13\u5b58,\u5426\u5219,\u4e0d\u4e88\u7f13\u5b58, \u663e\u793a\u6307\u5b9aSQL_NO_CACHE, \u4e0d\u4e88\u7f13\u5b58 DEMAND \u6216 2 \u67e5\u8be2\u7f13\u5b58\u529f\u80fd\u6309\u9700\u8fdb\u884c, \u663e\u793a\u6307\u5b9aSQL_CACHE\u7684SELECT\u8bed\u53e5\u624d\u4f1a\u7f13\u5b58; \u5176\u4ed6\u5747\u4e0d\u4e88\u7f13\u5b58"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_4","title":"\u67e5\u8be2\u7f13\u5b58\u5931\u6548\u7684\u60c5\u51b5","text":"<p>1) SQL\u8bed\u53e5\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5,\u60f3\u8981\u547d\u4e2d\u67e5\u8be2\u7f13\u5b58,\u67e5\u8be2\u7684SQL\u8bed\u53e5\u5fc5\u987b\u4e00\u81f4.</p> <p>2) \u5f53\u67e5\u8be2\u8bed\u53e5\u4e2d\u6709\u4e00\u4e9b\u4e0d\u786e\u5b9a\u7684\u65f6,\u5219\u4e0d\u4f1a\u7f13\u5b58. \u5982: now(), current_date(),curdate(),curtime(),rand(),uuid(),user(),databases().</p> <p>3) \u4e0d\u4f7f\u7528\u4efb\u4f55\u8868\u67e5\u8be2\u8bed\u53e5</p> <p>4) \u67e5\u8be2 mysql, information_schema,\u6216performance_schema \u6570\u636e\u5e93\u4e2d\u7684\u8868\u65f6,\u4e0d\u4f1a\u8d70\u67e5\u8be2\u7f13\u5b58.</p> <p>5) \u5728\u5b58\u50a8\u7684\u51fd\u6570, \u89e6\u53d1\u5668\u6216\u4e8b\u4ef6\u7684\u4e3b\u4f53\u5185\u6267\u884c\u7684\u67e5\u8be2.</p> <p>6) \u5982\u679c\u8868\u66f4\u6539,\u5219\u4f7f\u7528\u8be5\u8868\u7684\u6240\u6709\u9ad8\u901f\u7f13\u5b58\u67e5\u8be2\u90fd\u5c06\u53d8\u4e3a\u65e0\u6548\u5e76\u4ece\u9ad8\u901f\u7f13\u5b58\u4e2d\u5220\u9664. \u8fd9\u5305\u62ec\u4f7f\u7528<code>MERGE</code>\u6620\u5c04\u5230\u5df2\u66f4\u6539\u8868\u7684\u67e5\u8be2.\u4e00\u4e2a\u8868\u53ef\u4ee5\u88ab\u8bb8\u591a\u7c7b\u578b\u7684\u8bed\u53e5, \u5982\u88ab\u6539\u53d8 INSERT, UPDATE, DELETE, TRUNCATE TABLE, ALTER TABLE, DROP TABLE, \u6216 DROP DATABASE.</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#mysql","title":"MySQL\u5185\u5b58\u7ba1\u7406\u53ca\u4f18\u5316","text":""},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#_5","title":"\u5185\u5b58\u4f18\u5316\u539f\u5219","text":"<p>1) \u5c06\u5c3d\u91cf\u591a\u7684\u5185\u5b58\u5206\u914d\u7ed9MySQL\u505a\u7f13\u5b58, \u4f46\u8981\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u548c\u5176\u4ed6\u67e5\u8be2\u9884\u7559\u8db3\u591f\u5185\u5b58.</p> <p>2) MyISAM\u5b58\u50a8\u5f15\u64ce\u7684\u6570\u636e\u6587\u4ef6\u8bfb\u53d6\u4f9d\u8d56\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u81ea\u8eab\u7684<code>IO</code>\u7f13\u5b58,\u56e0\u6b64,\u5982\u679c\u6709MyISAM\u8868, \u5c31\u8981\u9884\u7559\u66f4\u591a\u7684\u5185\u5b58\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u505aIO\u7f13\u5b58.</p> <p>3) \u6392\u5e8f\u533a, \u8fde\u63a5\u533a\u7b49\u7f13\u5b58\u662f\u5206\u914d\u7ed9\u6bcf\u4e2a\u6570\u636e\u5e93\u5bf9\u8bdd(session)\u4e13\u4e1a\u7684,\u5176\u9ed8\u8ba4\u503c\u7684\u8bbe\u7f6e\u8981\u6839\u636e\u6700\u5927\u8fde\u63a5\u6570\u5408\u7406\u5206\u914d, \u5982\u679c\u8bbe\u7f6e\u592a\u5927, \u4e0d\u4f46\u6d6a\u8d39\u8d44\u6e90,\u800c\u4e14\u5728\u5e76\u53d1\u8fde\u63a5\u8f83\u9ad8\u65f6\u4f1a\u5bfc\u81f4\u7269\u7406\u5185\u5b58\u8017\u5c3d.</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#myisam","title":"MyISAM \u5185\u5b58\u4f18\u5316","text":"<p>MyISAM\u5b58\u50a8\u5f15\u64ce\u4f7f\u7528 <code>key_buffer</code> \u7f13\u5b58\u7d22\u5f15\u5757, \u52a0\u901fMyISAM\u7d22\u5f15\u7684\u8bfb\u5199\u901f\u5ea6. \u5bf9\u4e8eMyISAM\u8868\u7684\u6570\u636e\u5757, mysql\u6ca1\u6709\u7279\u522b\u7684\u7f13\u5b58\u673a\u5236, \u5b8c\u5168\u4f9d\u8d56\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684IO\u7f13\u5b58.</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#key_buffer_size","title":"key_buffer_size","text":"<p><code>key_buffer_size</code> \u51b3\u5b9aMyISAM\u7d22\u5f15\u5757\u7f13\u51b2\u533a\u7684\u5927\u5c0f, \u76f4\u63a5\u5f71\u54cd\u5230MyISAM\u8868\u7684\u8bfb\u53d6\u6548\u7387. \u53ef\u4ee5\u5728MySQL\u53c2\u6570\u6587\u4ef6\u4e2d\u8bbe\u7f6ekey_buffer_size\u7684\u503c, \u5bf9\u4e8e\u4e00\u822cMyISAM\u6570\u636e\u5e93, \u5efa\u8bae\u81f3\u5c11\u5c06 <code>1/4</code> \u53ef\u7528\u5185\u5b58\u5206\u914d\u7ed9key_buffer_size.</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#read_buffer_size","title":"read_buffer_size","text":"<p>\u5982\u679c\u9700\u8981\u7ecf\u5e38\u987a\u5e8f\u626b\u63cfmyisam\u8868,\u53ef\u4ee5\u901a\u8fc7\u589e\u5927read_buffer_size\u7684\u503c\u6765\u6539\u5584\u6027\u80fd. \u4f46\u9700\u8981\u6ce8\u610f\u7684\u662fread_buffer_size\u662f\u6bcf\u4e2asession\u72ec\u5360\u7684,\u5982\u679c\u9ed8\u8ba4\u503c\u8bbe\u7f6e\u592a\u5927,\u5c31\u597d\u9020\u6210\u5185\u5b58\u6d6a\u8d39.</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#read_rnd_buffer_size","title":"read_rnd_buffer_size","text":"<p>\u5bf9\u4e8e\u9700\u8981\u6392\u5e8f\u7684myisam\u8868\u7684\u67e5\u8be2, \u5982\u5e26\u6709order by \u5b50\u53e5\u7684sql, \u9002\u5f53\u589e\u52a0 read_rnd_buffer_size\u7684\u503c, \u53ef\u4ee5\u6539\u5584\u6b64\u7c7b\u7684sql\u6027\u80fd. \u4f46\u9700\u6ce8\u610f\u7684\u662f, read_rnd_buffer_size\u662f\u6bcf\u4e2asession\u72ec\u5360\u7684, \u5982\u679c\u9ed8\u8ba4\u503c\u8bbe\u7f6e\u592a\u5927,\u5c31\u597d\u9020\u6210\u5185\u5b58\u6d6a\u8d39.</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#innodb","title":"InnoDB\u5185\u5b58\u4f18\u5316","text":"<p>innodb\u7528\u4e00\u5757\u5185\u5b58\u533a\u505aIO\u7f13\u5b58, \u8be5\u7f13\u5b58\u6c60\u4e0d\u4ec5\u7528\u6765\u7f13\u5b58innodb\u7684\u7d22\u5f15\u5757, \u800c\u4e14\u4e5f\u7528\u6765\u7f13\u5b58innodb\u7684\u6570\u636e\u5757.</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#innodb_buffer_pool_size","title":"innodb_buffer_pool_size","text":"<p>\u8be5\u53d8\u91cf\u51b3\u5b9a\u4e86Innodb\u5b58\u50a8\u5f15\u64ce\u8868\u6570\u636e\u548c\u7d22\u5f15\u6570\u636e\u7684\u6700\u5927\u7f13\u5b58\u533a\u5927\u5c0f. \u5728\u4fdd\u8bc1\u64cd\u4f5c\u7cfb\u7edf\u53ca\u5176\u4ed6\u7a0b\u5e8f\u6709\u8db3\u591f\u5185\u5b58\u53ef\u7528\u7684\u60c5\u51b5\u4e0b,innodb_buffer_pool_size \u7684\u503c\u8d8a\u5927, \u7f13\u5b58\u547d\u4e2d\u7387\u8d8a\u9ad8, \u8bbf\u95eeInnoDB\u8868\u9700\u8981\u7684\u78c1\u76d8IO\u5c31\u8d8a\u5c11, \u6027\u80fd\u4e5f\u5c31\u8d8a\u9ad8.</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#innodb_log_buffer_size","title":"innodb_log_buffer_size","text":"<p>\u51b3\u5b9a\u4e86InnoDB\u91cd\u505a\u65e5\u5fd7\u7f13\u5b58\u7684\u5927\u5c0f, \u5bf9\u4e8e\u53ef\u80fd\u4ea7\u751f\u5927\u91cf\u66f4\u65b0\u8bb0\u5f55\u7684\u5927\u4e8b\u52a1, \u589e\u52a0innodb_log_buffer_size\u7684\u5927\u5c0f, \u53ef\u7528\u907f\u514dinnodb\u5728\u4e8b\u52a1\u63d0\u4ea4\u524d\u5c31\u6267\u884c\u4e0d\u5fc5\u8981\u7684\u65e5\u5fd7\u5199\u5165\u78c1\u76d8.</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#mysql_1","title":"MySQL\u5e76\u53d1\u53c2\u6570\u8c03\u6574","text":"<p>\u4ece\u5b9e\u73b0\u4e0a\u6765\u8bf4, MySQL Server \u662f\u591a\u7ebf\u7a0b\u7ed3\u679c, \u5305\u62ec\u540e\u53f0\u7ebf\u7a0b\u548c\u5ba2\u6237\u7aef\u7ebf\u7a0b. \u591a\u7ebf\u7a0b\u53ef\u7528\u6709\u6548\u5229\u7528\u670d\u52a1\u5668\u8d44\u6e90,\u63d0\u9ad8\u6570\u636e\u5e93\u7684\u5e76\u53d1\u6027\u80fd.</p> <p>\u5728MySQL\u4e2d, \u63a7\u5236\u5e76\u53d1\u8fde\u63a5\u548c\u7ebf\u7a0b\u7684\u4e3b\u8981\u53c2\u6570\u5305\u62ec max_connections, back_log, thread_cache_size, table_open_cache.</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#max_connections","title":"max_connections","text":"<p>\u91c7\u7528max_connections\u63a7\u5236\u5141\u8bb8\u8fde\u63a5\u5230MySQL\u6570\u636e\u5e93\u7684\u6700\u5927\u6570\u91cf, \u9ed8\u8ba4\u662f151. \u5f53\u5ba2\u6237\u7aef\u8fde\u63a5\u670d\u52a1\u7aef\u65f6,\u5f53\u540c\u65f6\u8fde\u63a5\u7684\u8bf7\u6c42\u8d85\u8fc7151\u65f6,\u5c31\u6ca1\u6709\u53ef\u7528\u7684\u8fde\u63a5\u6765\u5904\u7406\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42,\u540e\u9762\u8fdb\u6765\u7684\u8fde\u63a5\u90fd\u4f1a\u8fdb\u5165\u7b49\u5f85\u72b6\u6001.</p> <p><code>connections_errors_max_connections</code>\u4e3a\u5f53\u8fde\u63a5\u8fbe\u5230\u6700\u5927\u8bf7\u6c42\u503c\u65f6,\u8fde\u63a5\u62a5\u9519\u7684\u4fe1\u606f.</p> <p>\u5982\u679c\u72b6\u6001\u53d8\u91cf <code>connections_errors_max_connections</code>\u4e0d\u4e3a\u96f6,\u5e76\u4e14\u4e00\u76f4\u589e\u957f, \u5219\u8bf4\u660e\u4e0d\u65ad\u6709\u8fde\u63a5\u8bf7\u6c42\u56e0\u6570\u636e\u5e93\u8fde\u63a5\u5df2\u8fbe\u5230\u5141\u8bb8\u6700\u5927\u503c\u800c\u5931\u8d25, \u8fd9\u65f6\u53ef\u4ee5\u8003\u8651\u589e\u5927max_connections\u7684\u503c.</p> <p>MySQL\u6700\u5927\u53ef\u652f\u6301\u7684\u8fde\u63a5\u6570, \u53d6\u51b3\u4e8e\u5f88\u591a\u56e0\u7d20,\u5305\u62ec\u7ed9\u5b9a\u64cd\u4f5c\u7cfb\u7edf\u5e73\u53f0\u7684\u7ebf\u7a0b\u5e93\u7684\u8d28\u91cf,\u5185\u5b58\u5927\u5c0f,\u6bcf\u4e2a\u8fde\u63a5\u7684\u8d1f\u8377,CPU\u7684\u5904\u7406\u901f\u5ea6,\u671f\u671b\u7684\u54cd\u5e94\u65f6\u95f4\u7b49.\u5728Linux\u5e73\u53f0\u4e0b,\u6027\u80fd\u597d\u7684\u670d\u52a1\u5668,\u652f\u6301500-1000\u4e2a\u8fde\u63a5\u4e0d\u662f\u96be\u4e8b,\u9700\u8981\u6839\u636e\u670d\u52a1\u5668\u6027\u80fd\u8fdb\u884c\u8bbe\u5b9a.</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#back_log","title":"back_log","text":"<p>back_log\u53c2\u6570\u63a7\u5236MySQL\u76d1\u542cTCP\u7aef\u53e3\u65f6\u8bbe\u7f6e\u7684\u79ef\u538b\u8bf7\u6c42\u6808\u5927\u5c0f. \u5982\u679cMySQL\u7684\u8fde\u63a5\u6570\u8fbe\u5230max_connections\u65f6,\u65b0\u6765\u7684\u8bf7\u6c42\u5c06\u4f1a\u88ab\u5b58\u5728\u5806\u6808\u4e2d,\u4ee5\u7b49\u5f85\u67d0\u4e00\u8fde\u63a5\u91ca\u653e\u8d44\u6e90, \u8be5\u5806\u6808\u7684\u6570\u91cf\u65e2\u662fback_log. \u5982\u679c\u7b49\u5f85\u7684\u8fde\u63a5\u7684\u6570\u91cf\u8d85\u8fc7back_log, \u5c06\u4e0d\u88ab\u6388\u4e88\u8fde\u63a5\u8d44\u6e90,\u5c06\u4f1a\u62a5\u9519.</p> <p>5.5.5\u7248\u672c\u4e4b\u524d\u9ed8\u8ba4\u503c\u4e3a50, \u4e4b\u540e\u7684\u7248\u672c\u9ed8\u8ba4\u4e3a50+(max_connections / 5), \u4f46\u6700\u5927\u4e0d\u8d85\u8fc7900.</p> <p>\u5982\u679c\u9700\u8981\u6570\u636e\u5e93\u5728\u77ed\u7684\u65f6\u95f4\u5185\u5904\u7406\u5927\u91cf\u7684\u8fde\u63a5\u8bf7\u6c42, \u53ef\u4ee5\u8003\u8651\u9002\u5f53\u589e\u5927back_log\u7684\u503c.</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#table_open_cache","title":"table_open_cache","text":"<p>\u8be5\u53c2\u6570\u7528\u6765\u63a7\u5236\u6240\u6709SQL\u8bed\u53e5\u6267\u884c\u7ebf\u7a0b\u53ef\u6253\u5f00\u8868\u7f13\u5b58\u7684\u6570\u91cf, \u800c\u5728\u6267\u884cSQL\u8bed\u53e5\u65f6, \u6bcf\u4e00\u4e2aSQL\u6267\u884c\u7ebf\u7a0b\u81f3\u5c11\u8981\u6253\u5f001\u4e2a\u8868\u7f13\u5b58. \u8be5\u53c2\u6570\u7684\u503c\u5e94\u8be5\u6839\u636e\u8bbe\u7f6e\u7684\u6700\u5927\u8fde\u63a5\u6570max_connections\u4e00\u4e2a\u6bcf\u4e2a\u8fde\u63a5\u6267\u884c\u5173\u8054\u67e5\u8be2\u4e2d\u6d89\u53ca\u7684\u8868\u7684\u6700\u5927\u6570\u91cf\u6765\u8bbe\u5b9a:</p> <p><code>max_connections x N;</code></p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#hread_cache_size","title":"hread_cache_size","text":"<p>\u4e3a\u4e86\u52a0\u5feb\u6570\u636e\u5e93\u7684\u901f\u5ea6\uff0cMySQL\u4f1a\u7f13\u5b58\u4e00\u5b9a\u6570\u91cf\u7684\u5ba2\u6237\u670d\u52a1\u7ebf\u7a0b\u4ee5\u5907\u91cd\u7528\uff0c\u901a\u8fc7\u53c2\u6570 thread_cache_size \u53ef\u63a7\u5236 MySQL \u7f13\u5b58\u5ba2\u6237\u7aef\u670d\u52a1\u7ebf\u7a0b\u7684\u6570\u91cf\u3002</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#innodb_lock_wait_timeout","title":"innodb_lock_wait_timeout","text":"<p>\u8be5\u53c2\u6570\u662f\u7528\u6765\u8bbe\u7f6e InnoDB \u4e8b\u52a1\u7b49\u5f85\u884c\u9501\u7684\u65f6\u95f4\uff0c\u9ed8\u8ba4\u503c\u662f 50 ms\uff0c\u53ef\u4ee5\u6839\u636e\u8fdb\u884c\u52a8\u6001\u8bbe\u7f6e\u3002\u5bf9\u4e8e\u9700\u8981\u5feb\u901f\u53cd\u9988\u7684\u4e1a\u52a1\u7cfb\u7edf\u6765\u8bf4\uff0c\u53ef\u4ee5\u5c06\u884c\u9501\u7684\u7b49\u5f85\u65f6\u95f4\u8c03\u5c0f\uff0c\u4ee5\u907f\u514d\u4e8b\u52a1\u957f\u65f6\u95f4\u6302\u8d77\uff1b\u5bf9\u4e8e\u540e\u53f0\u8fd0\u884c\u7684\u6279\u91cf\u5904\u7406\u7a0b\u5e8f\u6765\u8bf4\uff0c\u53ef\u4ee5\u5c06\u884c\u9501\u7684\u7b49\u5f85\u65f6\u95f4\u8c03\u5927\uff0c\u4ee5\u907f\u514d\u53d1\u751f\u5927\u7684\u56de\u6eda\u64cd\u4f5c\u3002</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#2mysql","title":"2\u3001MySQL \u9501\u95ee\u9898","text":""},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#21","title":"2.1\u3001\u9501\u6982\u8ff0","text":"<p>\u9501 \u662f\u8ba1\u7b97\u673a\u534f\u8c03\u591a\u4e2a\u8fdb\u7a0b\u6216\u7ebf\u7a0b\u5e76\u53d1\u8bbf\u95ee\u67d0\u4e00\u8d44\u6e90\u7684\u673a\u5236\uff08\u907f\u514d\u4e89\u62a2\uff09\u3002</p> <p>\u5728\u6570\u636e\u5e93\u4e2d\uff0c\u9664\u4f20\u7edf\u7684\u8ba1\u7b97\u8d44\u6e90\uff08\u5982\uff1aCPU\u3001RAM\u3001I/O \u7b49\uff09\u7684\u4e89\u7528\u4ee5\u5916\uff0c\u6570\u636e\u4e5f\u662f\u4e00\u79cd\u4f9b\u8bb8\u591a\u7528\u6237\u5171\u4eab\u7684\u8d44\u6e90\u3002\u5982\u4f55\u4fdd\u8bc1\u6570\u636e\u5e76\u53d1\u8bbf\u95ee\u7684\u4e00\u81f4\u6027\u3001\u6709\u6548\u6027\u662f\u6240\u6709\u6570\u636e\u5e93\u5fc5\u987b\u89e3\u51b3\u7684\u4e00\u4e2a\u95ee\u9898\uff0c\u9501\u51b2\u7a81\u4e5f\u662f\u5f71\u54cd\u6570\u636e\u5e93\u5e76\u53d1\u8bbf\u95ee\u6027\u80fd\u7684\u4e00\u4e2a\u91cd\u8981\u56e0\u7d20\u3002</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#22","title":"2.2\u3001\u9501\u5206\u7c7b","text":"<p>\u4ece\u5bf9\u6570\u636e\u64cd\u4f5c\u7684\u7c92\u5ea6\u5206\uff1a</p> <ol> <li>\u8868\u9501\uff1a\u64cd\u4f5c\u65f6\uff0c\u4f1a\u9501\u5b9a\u6574\u4e2a\u8868</li> <li>\u884c\u9501\uff1a\u64cd\u4f5c\u65f6\uff0c\u4f1a\u9501\u5b9a\u5f53\u524d\u64cd\u4f5c\u884c</li> </ol> <p>\u4ece\u5bf9\u6570\u636e\u64cd\u4f5c\u7684\u7c7b\u578b\u5206\uff1a</p> <ol> <li>\u8bfb\u9501\uff08\u5171\u4eab\u9501\uff09\uff1a\u9488\u5bf9\u540c\u4e00\u4efd\u6570\u636e\uff0c\u591a\u4e2a\u8bfb\u64cd\u4f5c\u53ef\u4ee5\u540c\u65f6\u8fdb\u884c\u800c\u4e0d\u4f1a\u76f8\u4e92\u5f71\u54cd</li> <li>\u5199\u9501\uff08\u6392\u5b83\u9501\uff09\uff1a\u5f53\u524d\u64cd\u4f5c\u6ca1\u6709\u5b8c\u6210\u4e4b\u524d\uff0c\u5b83\u4f1a\u963b\u65ad\u5176\u4ed6\u5199\u9501\u548c\u8bfb\u9501</li> </ol>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#23mysql","title":"2.3\u3001MySQL\u9501","text":"<p>\u76f8\u5bf9\u4e8e\u5176\u4ed6\u6570\u636e\u5e93\u800c\u8a00\uff0cMySQL \u7684\u9501\u673a\u5236\u6bd4\u8f83\u7b80\u5355\uff0c\u5176\u6700\u663e\u8457\u7684\u7279\u70b9\u5c31\u662f\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u652f\u6301\u4e0d\u540c\u7684\u9501\u673a\u5236\u3002\u4e0b\u8868\u4e2d\u7f57\u5217\u51fa\u4e86\u5404\u4e2a\u5b58\u50a8\u5f15\u64ce\u5bf9\u9501\u7684\u652f\u6301\u60c5\u51b5</p> \u5b58\u50a8\u5f15\u64ce \u8868\u7ea7\u9501 \u884c\u7ea7\u9501 \u9875\u9762\u9501 MyISAM \u652f\u6301 \u4e0d\u652f\u6301 \u4e0d\u652f\u6301 InnoDB \u652f\u6301 \u652f\u6301 \u4e0d\u652f\u6301 MEMORY \u652f\u6301 \u4e0d\u652f\u6301 \u4e0d\u652f\u6301 BDB \u652f\u6301 \u4e0d\u652f\u6301 \u652f\u6301 <p>MySQL \u8fd93\u4e2d\u9501\u7684\u7279\u6027\u53ef\u5927\u81f4\u5f52\u7eb3\u5982\u4e0b\uff1a</p> \u9501\u7c7b\u578b \u7279\u70b9 \u8868\u6781\u9501 \u504f\u5411 MyISAM \u5b58\u50a8\u5f15\u64ce\uff0c\u5f00\u9500\u5c0f\uff0c\u52a0\u9501\u5feb\uff1b\u4e0d\u4f1a\u51fa\u73b0\u6b7b\u9501\uff1b\u9501\u5b9a\u7c92\u5ea6\u5927\uff0c\u53d1\u751f\u9501\u51b2\u7a81\u7684\u6982\u7387\u6700\u9ad8\uff0c\u5e76\u53d1\u5ea6\u6700\u4f4e \u884c\u6781\u9501 \u504f\u5411 InnoDB \u5b58\u50a8\u5f15\u64ce\uff0c\u5f00\u9500\u5927\uff0c\u52a0\u9501\u6162\uff1b\u4f1a\u51fa\u73b0\u6b7b\u9501\uff1b\u9501\u5b9a\u7c92\u5ea6\u6700\u5c0f\uff0c\u53d1\u751f\u9501\u51b2\u7a81\u7684\u6982\u7387\u6700\u4f4e\uff0c\u5e76\u53d1\u5ea6\u4e5f\u6700\u9ad8 \u9875\u9762\u9501 \u5f00\u9501\u548c\u52a0\u9501\u65f6\u95f4\u4ecb\u4e8e\u8868\u9501\u548c\u884c\u9501\u4e4b\u95f4\uff1b\u4f1a\u51fa\u73b0\u6b7b\u9501\uff1b\u9501\u5b9a\u7c92\u5ea6\u4ecb\u4e8e\u8868\u9501\u548c\u884c\u9501\u4e4b\u95f4\uff0c\u5e76\u53d1\u5ea6\u4e00\u822c <p>\u4ece\u4e0a\u8ff0\u6765\u770b\uff0c\u5f88\u96be\u7b3c\u7edf\u5730\u8bf4\u54ea\u79cd\u9501\u66f4\u597d\uff0c\u53ea\u80fd\u5c31\u5177\u4f53\u5e94\u7528\u7684\u7279\u70b9\u6765\u8bf4\u54ea\u79cd\u9501\u66f4\u5408\u9002\u3002 \u4ec5\u4ece\u9501\u7684\u89d2\u5ea6\u6765\u8bf4\uff1a\u8868\u7ea7\u9501\u66f4\u9002\u5408\u4ee5\u67e5\u8be2\u4e3a\u4e3b\uff0c\u53ea\u6709\u5c11\u91cf\u6309\u7d22\u5f15\u6761\u4ef6\u66f4\u65b0\u6570\u636e\u7684\u5e94\u7528\uff0c\u5982web\u5e94\u7528\uff1b\u884c\u7ea7\u9501 \u66f4\u9002\u5408\u4e8e\u6709\u5927\u91cf\u6309\u7d22\u5f15\u6761\u4ef6\u5e76\u53d1\u66f4\u65b0\u5c11\u91cf\u4e0d\u540c\u6570\u636e\uff0c\u540c\u65f6\u53c8\u6709\u5e76\u67e5\u8be2\u7684\u5e94\u7528\uff0c\u5982\u4e00\u4e9b\u5728\u7ebf\u4e8b\u52a1\u5904\u7406\uff08OLTP\uff09\u7cfb\u7edf\u3002</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#24myisam","title":"2.4\u3001MyISAM \u8868\u9501","text":"<p>MyISAM \u5b58\u50a8\u5f15\u64ce\u53ea\u652f\u6301\u8868\u9501\uff0c\u8fd9\u4e5f\u662f MySQL \u5f00\u59cb\u51e0\u4e2a\u7248\u672c\u4e2d\u552f\u4e00\u652f\u6301\u7684\u9501\u7c7b\u578b\u3002</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#241","title":"2.4.1\u3001\u5982\u4f55\u52a0\u8868\u9501","text":"<p>MyISAM \u5728\u6267\u884c\u67e5\u8be2\u8bed\u53e5\uff08SELECT\uff09\u524d\uff0c\u4f1a\u81ea\u52a8\u7ed9\u6d89\u53ca\u7684\u6240\u6709\u8868\u52a0\u8bfb\u9501\uff0c\u5728\u6267\u884c\u66f4\u65b0\u64cd\u4f5c\uff08UPDATE\u3001DELETE\u3001INSERT\u7b49\uff09\u524d\uff0c\u4f1a\u81ea\u52a8\u7ed9\u6d89\u53ca\u7684\u8868\u52a0\u5199\u9501\u3002</p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u5e76\u4e0d\u9700\u8981\u7528\u6237\u5e72\u9884\uff0c\u56e0\u6b64\uff0c\u7528\u6237\u4e00\u822c\u4e0d\u9700\u8981\u76f4\u63a5\u7528 <code>LOCJ TABLE</code>\u547d\u4ee4\u7ed9 MyISAM \u8868\u663e\u793a\u52a0\u9501\u3002</p> <p>\u663e\u793a\u52a0\u8868\u9501\u8bed\u6cd5\uff1a</p> <pre><code>\u52a0\u8bfb\u9501\uff1alock table table_name read;\n\u52a0\u5199\u9501\uff1alock table table_name write;\n</code></pre>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#244","title":"2.4.4\u3001\u7ed3\u8bba","text":"\u5f53\u524d\u9501\u6a21\u5f0f\\\u8bf7\u6c42\u9501\u6a21\u5f0f None \u8bfb\u9501 \u5199\u9501 \u8bfb\u9501 \u662f \u662f \u5426 \u5199\u9501 \u662f \u5426 \u5426 <p>\u7531\u4e0a\u8868\u53ef\u89c1\uff1a 1\uff09\u5bf9 MyISAM \u8868\u7684\u8bfb\u64cd\u4f5c\uff0c\u4e0d\u4f1a\u963b\u585e\u5176\u4ed6\u7528\u6237\u5bf9\u540c\u4e00\u8868\u7684\u8bfb\u8bf7\u6c42\uff0c\u4f46\u4f1a\u963b\u585e\u5bf9\u7edf\u4e00\u8868\u7684\u5199\u8bf7\u6c42\uff1b 2\uff09\u5bf9 MyISAM \u8868\u7684\u5199\u64cd\u4f5c\uff0c\u5219\u4f1a\u963b\u585e\u5176\u4ed6\u7528\u6237\u5bf9\u540c\u4e00\u8868\u7684\u8bfb\u548c\u5199\u64cd\u4f5c\uff1b</p> <p>\u7b80\u800c\u8a00\u4e4b\uff0c\u5c31\u662f\u8bfb\u9501\u4f1a\u963b\u585e\u5199\uff0c\u4f46\u662f\u4e0d\u4f1a\u963b\u585e\u8bfb\u3002\u800c\u5199\u9501\uff0c\u65e2\u4f1a\u963b\u585e\u8bfb\uff0c\u53c8\u4f1a\u963b\u585e\u5199\u3002</p> <p>\u6b64\u5916\uff0c MyISAM \u7684\u8bfb\u5199\u9501\u8c03\u5ea6\u662f \u5199 \u4f18\u5148\u3002\u8fd9\u4e5f\u662f MyISAM \u4e0d\u9002\u5408\u4f5c\u4e3a\u5199\u4e3a\u4e3b\u7684\u8868\u7684\u5b58\u50a8\u5f15\u64ce\u7684\u539f\u56e0\u3002\u56e0\u4e3a\u5199\u9501\u540e\uff0c\u5176\u4ed6\u7ebf\u7a0b\u4e0d\u80fd\u505a\u4efb\u4f55\u64cd\u4f5c\uff0c\u5927\u91cf\u7684\u66f4\u65b0\u4f1a\u4f7f\u67e5\u8be2\u5f88\u96be\u5f97\u5230\u9501\uff0c\u4ece\u800c\u9020\u6210\u6c38\u8fdc\u963b\u585e\u3002</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#245","title":"2.4.5\u3001\u67e5\u770b\u9501\u7684\u4e89\u7528\u60c5\u51b5","text":"<pre><code>show open tables;\n</code></pre> <ol> <li>In_use\uff1a\u8868\u5f53\u524d\u88ab\u67e5\u8be2\u4f7f\u7528\u7684\u6b21\u6570\uff0c\u5982\u679c\u4e3a\u96f6\uff0c\u5219\u8868\u662f\u6253\u5f00\u7684\uff0c\u4f46\u662f\u5f53\u524d\u6ca1\u6709\u88ab\u4f7f\u7528\u3002</li> <li>Name_locked\uff1a\u8868\u540d\u79f0\u662f\u5426\u88ab\u9501\u5b9a\u3002\u540d\u79f0\u9501\u5b9a\u7528\u4e8e\u53d6\u6d88\u8868\u6216\u5bf9\u8868\u8fdb\u884c\u91cd\u547d\u540d\u7b49\u64cd\u4f5c\u3002</li> </ol> <pre><code>show status like 'Table_locks%';\n\nmysql&gt; show status like 'Table_lock%';\n+-----------------------+------------+\n| Variable_name         | Value      |\n+-----------------------+------------+\n| Table_locks_immediate | 2772892035 |\n| Table_locks_waited    | 64713      |\n+-----------------------+------------+\n2 rows in set (0.00 sec)\n</code></pre> <ol> <li>Table_locks_immediate\uff1a\u6307\u7684\u662f\u80fd\u591f\u7acb\u5373\u83b7\u5f97\u8868\u7ea7\u9501\u7684\u6b21\u6570\uff0c\u6bcf\u7acb\u5373\u83b7\u53d6\u9501\uff0c\u503c\u52a0 1\u3002</li> <li>Table_locks_waited\uff1a\u6307\u7684\u662f\u4e0d\u80fd\u7acb\u5373\u83b7\u53d6\u8868\u6781\u9501\u800c\u9700\u8981\u7b49\u5f85\u7684\u6b21\u6570\uff0c\u6bcf\u7b49\u5f85\u4e00\u6b21\uff0c\u8be5\u503c\u52a0 1\uff0c\u6b64\u503c\u8d8a\u9ad8\u8bf4\u660e\u5b58\u5728\u7740\u8f83\u4e3a\u4e25\u91cd\u7684\u8868\u6781\u9501\u4e89\u7528\u60c5\u51b5\u3002</li> </ol>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#25innodb","title":"2.5\u3001InnoDB \u884c\u9501","text":""},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#251","title":"2.5.1\u3001\u884c\u9501\u4ecb\u7ecd","text":"<p>\u884c\u9501\u7279\u70b9\uff1a\u504f\u5411 InnoDB \u5b58\u50a8\u5f15\u64ce\uff0c\u5f00\u9500\u5927\uff0c\u52a0\u9501\u6162\uff1b\u4f1a\u51fa\u73b0\u6b7b\u9501\uff1b\u9501\u5b9a\u7c92\u5ea6\u5c0f\uff0c\u53d1\u751f\u9501\u51b2\u7a81\u7684\u6982\u7387\u6700\u4f4e\uff0c\u5e76\u53d1\u5ea6\u6700\u9ad8\u3002</p> <p>InnoDB \u4e0e MyISAM \u7684\u6700\u5927\u4e0d\u540c\u6709\u4e24\u70b9\uff1a\u4e00\u662f\u652f\u6301\u4e8b\u52a1\uff0c\u4e8c\u662f\u91c7\u7528\u4e86\u884c\u7ea7\u9501\u3002</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#252","title":"2.5.2\u3001\u80cc\u666f\u77e5\u8bc6","text":"<p>1\u3001\u4e8b\u52a1\u53ca\u5176ACID\u5c5e\u6027 \u4e8b\u52a1\u662f\u7531\u4e00\u7ec4 SQL \u8bed\u53e5\u7ec4\u6210\u7684\u903b\u8f91\u5904\u7406\u5355\u5143\u3002 \u4e8b\u52a1\u5177\u6709\u4ee5\u4e0b 4 \u4e2a\u7279\u6027\uff0c\u7b80\u79f0\u4e3a \u4e8b\u52a1ACID\u5c5e\u6027\u3002</p> ACID\u5c5e\u6027 \u542b\u4e49 \u539f\u5b50\u6027\uff08Atomicity\uff09 \u4e8b\u52a1\u662f\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\u5355\u5143\uff0c\u5176\u5bf9\u6570\u636e\u7684\u4fee\u6539\uff0c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25 \u4e00\u81f4\u6027\uff08Consistent\uff09 \u5728\u4e8b\u52a1\u5f00\u59cb\u548c\u5b8c\u6210\u65f6\uff0c\u6570\u636e\u90fd\u5fc5\u987b\u4fdd\u6301\u4e00\u81f4\u72b6\u6001 \u9694\u79bb\u6027\uff08Isolation\uff09 \u6570\u636e\u5e93\u7cfb\u7edf\u63d0\u4f9b\u4e00\u5b9a\u7684\u9694\u79bb\u673a\u5236\uff0c\u4fdd\u8bc1\u4e8b\u52a1\u5728\u4e0d\u53d7\u5916\u90e8\u5e76\u53d1\u64cd\u4f5c\u5f71\u54cd\u7684\u201c\u72ec\u7acb\u73af\u5883\u201d\u4e0b\u8fd0\u884c \u6301\u4e45\u6027\uff08Durable\uff09 \u4e8b\u52a1\u5b8c\u6210\u4e4b\u540e\uff0c\u5bf9\u4e8e\u6570\u636e\u7684\u4fee\u6539\u662f\u6c38\u4e45\u7684\u3002 <p>2\u3001\u5e76\u53d1\u4e8b\u52a1\u5904\u7406\u5e26\u6765\u7684\u95ee\u9898</p> \u95ee\u9898 \u542b\u4e49 \u4e22\u5931\u66f4\u65b0\uff08Lost Update\uff09 \u5f53\u4e24\u4e2a\u6216\u591a\u4e2a\u4e8b\u52a1\u9009\u62e9\u540c\u4e00\u884c\uff0c\u6700\u521d\u7684\u4e8b\u52a1\u4fee\u6539\u7684\u503c\uff0c\u4f1a\u88ab\u540e\u9762\u7684\u4e8b\u52a1\u4fee\u6539\u7684\u503c\u8986\u76d6\u3002 \u810f\u8bfb\uff08Dirty Reads\uff09 \u5f53\u4e00\u4e2a\u4e8b\u52a1\u6b63\u5728\u8bbf\u95ee\u6570\u636e\uff0c\u5e76\u5bf9\u6570\u636e\u8fdb\u884c\u4e86\u4fee\u6539\uff0c\u800c\u8fd9\u79cd\u4fee\u6539\u8fd8\u6ca1\u6709\u63d0\u4ea4\u5230\u6570\u636e\u5e93\u4e2d\u3002\u8fd9\u65f6\uff0c\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u4e5f\u8bbf\u95ee\u4e86\u8fd9\u4e2a\u6570\u636e\uff0c\u7136\u540e\u4f7f\u7528\u4e86\u8fd9\u4e2a\u6570\u636e\u3002 \u4e0d\u53ef\u91cd\u590d\u8bfb\uff08Non-Repeatable Reads\uff09 \u4e00\u4e2a\u4e8b\u52a1\u5728\u8bfb\u53d6\u67d0\u4e9b\u6570\u636e\u540e\u7684\u67d0\u4e2a\u65f6\u95f4\uff0c\u518d\u6b21\u8bfb\u53d6\u4ee5\u524d\u8bfb\u8fc7\u7684\u6570\u636e\uff0c\u5374\u53d1\u73b0\u548c\u4ee5\u524d\u8bfb\u51fa\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u3002 \u5e7b\u8bfb\uff08Phantom Reads\uff09 \u4e00\u4e2a\u4e8b\u52a1\u6309\u7167\u76f8\u540c\u7684\u67e5\u8be2\u6761\u4ef6\u91cd\u65b0\u8bfb\u53d6\u4ee5\u524d\u67e5\u8be2\u8fc7\u7684\u6570\u636e\uff0c\u5374\u53d1\u73b0\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u6ee1\u8db3\u67e5\u8be2\u6761\u4ef6\u7684\u65b0\u6570\u636e\u3002 <p>3\u3001\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b \u4e3a\u4e86\u89e3\u51b3\u4e0a\u8ff0\u63d0\u5230\u7684\u4e8b\u52a1\u5e76\u53d1\u95ee\u9898\uff0c\u6570\u636e\u5e93\u63d0\u4f9b\u4e00\u5b9a\u7684\u4e8b\u52a1\u9694\u79bb\u673a\u5236\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\u6570\u636e\u5e93\u7684\u4e8b\u52a1\u9694\u79bb\u8d8a\u4e25\u683c\uff0c\u5e76\u53d1\u526f\u4f5c\u7528\u8d8a\u5c0f\uff0c\u4f46\u4ed8\u51fa\u7684\u4ee3\u4ef7\u4e5f\u5c31\u8d8a\u5927\uff0c\u56e0\u4e3a\u4e8b\u52a1\u9694\u79bb\u5b9e\u8d28\u4e0a\u5c31\u662f\u4f7f\u7528\u4e8b\u52a1\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u201c\u4e32\u884c\u5316\u201d\u8fdb\u884c\uff0c\u8fd9\u663e\u7136\u4e0e\u201d\u5e76\u53d1\u201c\u662f\u77db\u76fe\u7684\u3002</p> <p>\u6570\u636e\u5e93\u7684\u9694\u79bb\u7ea7\u522b\u6709 4 \u4e2a\uff0c\u7531\u4f4e\u5230\u9ad8\u4f9d\u6b21\u4e3a <code>Read uncommitted</code>\u3001<code>Read committed</code>\u3001<code>Repeatable read</code>\u3001<code>Serializbale</code> \uff0c\u8fd9\u56db\u4e2a\u51e0\u676f\u53ef\u4ee5\u9010\u4e2a\u89e3\u51b3 \u810f\u5199\u3001\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u3001\u5e7b\u8bfb\u8fd9\u51e0\u7c7b\u95ee\u9898\u3002</p> \u9694\u79bb\u7ea7\u522b \u4e22\u5931\u66f4\u65b0 \u810f\u8bfb \u4e0d\u53ef\u91cd\u590d\u8bfb \u5e7b\u8bfb Read uncommitted \u00d7 \u221a \u221a \u221a Read committed \u00d7 \u00d7 \u221a \u221a Repeatable read\uff08\u9ed8\u8ba4\uff09 \u00d7 \u00d7 \u00d7 \u221a Serializable \u00d7 \u00d7 \u00d7 \u00d7 <p>\u5907\u6ce8 \uff1a \u221a \u4ee3\u8868\u53ef\u80fd\u51fa\u73b0 \uff0c \u00d7 \u4ee3\u8868\u4e0d\u4f1a\u51fa\u73b0 \u3002</p> <p>MySQL \u7684\u6570\u636e\u5e93\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u4e3a Repeatable read\uff0c\u67e5\u770b\u65b9\u5f0f\u4e3a\uff1a</p> <pre><code>show variables like 'tx_isolation';\n</code></pre>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#253innodb","title":"2.5.3\u3001InnoDB \u7684\u884c\u9501\u6a21\u5f0f","text":"<p>InnoDB \u5b9e\u73b0\u4e86\u4ee5\u4e0b\u4e24\u79cd\u7c7b\u578b\u7684\u884c\u9501\u3002</p> <ul> <li>\u5171\u4eab\u9501\uff08S\uff09\uff1a\u53c8\u79f0\u4e3a \u8bfb\u9501\uff0c\u7b80\u79f0 S\u9501 \uff0c\u5171\u4eab\u9501\u5c31\u662f\u591a\u4e2a\u4e8b\u52a1\u5bf9\u4e8e\u540c\u4e00\u6570\u636e\u53ef\u4ee5\u5171\u4eab\u4e00\u628a\u9501\uff0c\u90fd\u80fd\u8bbf\u95ee\u5230\u6570\u636e\uff0c\u4f46\u662f\u53ea\u80fd\u8bfb\u4e0d\u80fd\u4fee\u6539\u3002</li> <li>\u6392\u4ed6\u9501\uff08X\uff09\uff1a\u53c8\u79f0\u4e3a \u5199\u9501\uff0c\u7b80\u79f0 X\u9501 \uff0c\u6392\u4ed6\u9501\u4e0d\u80fd\u4e0e\u5176\u4ed6\u9501\u5e76\u5b58\uff0c\u5982\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u4e86\u4e00\u4e2a\u6570\u636e\u884c\u7684\u6392\u4ed6\u9501\uff0c\u5176\u4ed6\u4e8b\u52a1\u5c31\u4e0d\u80fd\u518d\u83b7\u53d6\u8be5\u884c\u7684\u5176\u4ed6\u9501\uff0c\u5305\u62ec\u5171\u4eab\u9501\u548c\u6392\u4ed6\u9501\uff0c\u4f46\u662f\u83b7\u53d6\u6392\u4ed6\u9501\u7684\u4e8b\u52a1\u662f\u53ef\u4ee5\u5bf9\u6570\u636e\u5c31 \u884c \u8bfb\u53d6\u548c\u4fee\u6539\u3002</li> </ul> <p>\u5bf9\u4e8e UPDATE\u3001DELETE\u3001INSERT \u8bed\u53e5\uff0cInnoDB \u4f1a\u81ea\u52a8\u7ed9\u6d89\u53ca\u6570\u636e\u96c6\u52a0 \u6392\u4ed6\u9501\uff08X\uff09\uff1b \u5bf9\u4e8e\u666e\u901a SELECT \u8bed\u53e5\uff0c InnoDB \u4e0d\u4f1a\u52a0\u4efb\u4f55\u9501\uff1b</p> <p>\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u8bed\u53e5\u663e\u793a\u7ed9\u8bb0\u5f55\u96c6\u52a0\u5171\u4eab\u9501\u6216\u6392\u4ed6\u9501\u3002</p> <pre><code>\u5171\u4eab\u9501\uff08S\uff09\uff1aselect * from table_name where ... lock in share mode\n\u6392\u4ed6\u9501\uff08X\uff09\uff1aselect * from table_name where ... for update\n</code></pre>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#256","title":"2.5.6\u3001\u65e0\u7d22\u5f15\u884c\u9501\u5347\u7ea7\u4e3a\u8868\u9501","text":"<p>\u5982\u679c\u4e0d\u901a\u8fc7\u7d22\u5f15\u6761\u4ef6\u68c0\u7d22\u6570\u636e\uff0c\u90a3\u4e48 InnoDB \u5c06\u5bf9\u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u52a0\u9501\uff0c\u5b9e\u9645\u6548\u679c\u8ddf\u8868\u9501\u4e00\u6837\u3002</p> <p>\u67e5\u770b\u5f53\u524d\u8868\u7684\u7d22\u5f15\uff1a</p> <pre><code>show index from test_innodb_lock;\n</code></pre> <p>\u7531\u4e8e\u6267\u884c\u66f4\u65b0\u65f6\uff0c name \u5b57\u6bb5\u672c\u6765\u4e3a varchar \u7c7b\u578b\uff0c\u6211\u4eec\u662f\u4f5c\u4e3a\u6570\u636e\u7c7b\u578b\u4f7f\u7528\uff0c\u5b58\u5728\u7c7b\u578b\u8f6c\u6362\uff0c\u7d22\u5f15\u5931\u6548\uff0c\u6700\u7ec8 \u884c\u9501\u53d8\u4e3a\u8868\u9501\u3002</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#257","title":"2.5.7\u3001\u95f4\u9699\u9501\u5371\u5bb3","text":"<p>\u5f53\u6211\u4eec\u7528\u8303\u56f4\u6761\u4ef6\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u76f8\u7b49\u6761\u4ef6\u68c0\u7d22\u6570\u636e\uff0c\u5e76\u8bf7\u6c42\u5171\u4eab\u6216\u6392\u5b83\u9501\u65f6\uff0cInnoDB \u4f1a\u7ed9\u7b26\u5408\u6761\u4ef6\u7684\u5df2\u6709\u6570\u636e\u8fdb\u884c\u52a0\u9501\uff1b\u5bf9\u4e8e\u952e\u503c\u5728\u6761\u4ef6\u8303\u56f4\u5185\u4f46\u4e0d\u5b58\u5728\u8bb0\u5f55\uff0c\u53eb\u505a\u201c\u95f4\u9699\uff08GAP\uff09\u201d\uff0cInnoDB \u4e5f\u4f1a\u5bf9\u8fd9\u4e2a\u201c\u95f4\u9699\u201d\u52a0\u9501\uff0c\u8fd9\u79cd\u673a\u5236\u5c31\u662f\u6240\u8c13\u7684 \u95f4\u9699\u9501\uff08Next-key\u9501\uff09</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#258innodb","title":"2.5.8\u3001InnoDB\u884c\u9501\u4e89\u7528\u60c5\u51b5","text":"<pre><code>show status like 'innodb_row_lock%';\n</code></pre> <pre><code>Innodb_row_lock_current_waits: \u5f53\u524d\u6b63\u5728\u7b49\u5f85\u9501\u5b9a\u7684\u6570\u91cf\n\nInnodb_row_lock_time: \u4ece\u7cfb\u7edf\u542f\u52a8\u5230\u73b0\u5728\u9501\u5b9a\u603b\u65f6\u95f4\u957f\u5ea6\n\nInnodb_row_lock_time_avg:\u6bcf\u6b21\u7b49\u5f85\u6240\u82b1\u5e73\u5747\u65f6\u957f\n\nInnodb_row_lock_time_max:\u4ece\u7cfb\u7edf\u542f\u52a8\u5230\u73b0\u5728\u7b49\u5f85\u6700\u957f\u7684\u4e00\u6b21\u6240\u82b1\u7684\u65f6\u95f4\n\nInnodb_row_lock_waits: \u7cfb\u7edf\u542f\u52a8\u540e\u5230\u73b0\u5728\u603b\u5171\u7b49\u5f85\u7684\u6b21\u6570\n\n\u5f53\u7b49\u5f85\u7684\u6b21\u6570\u5f88\u9ad8\uff0c\u800c\u4e14\u6bcf\u6b21\u7b49\u5f85\u7684\u65f6\u957f\u4e5f\u4e0d\u5c0f\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5206\u6790\u7cfb\u7edf\u4e2d\u4e3a\u4ec0\u4e48\u4f1a\u6709\u5982\u6b64\u591a\u7684\u7b49\u5f85\uff0c\u7136\u540e\u6839\u636e\u5206\u6790\u7ed3\u679c\u7740\u624b\u5236\u5b9a\u4f18\u5316\u8ba1\u5212\u3002\n</code></pre>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#259","title":"2.5.9\u3001\u603b\u7ed3","text":"<p>InnoDB \u5b58\u50a8\u5f15\u64ce\u7531\u4e8e\u5b9e\u73b0\u4e86\u884c\u7ea7\u9501\u5b9a\uff0c\u867d\u7136\u5728\u9501\u5b9a\u673a\u5236\u7684\u5b9e\u73b0\u65b9\u9762\u5e26\u6765\u4e86\u6027\u80fd\u635f\u8017\u53ef\u80fd\u6bd4\u8868\u6781\u9501\u4f1a\u66f4\u9ad8\u4e00\u4e9b\uff0c\u4f46\u662f\u5728\u6574\u4f53\u5e76\u53d1\u5904\u7406\u80fd\u529b\u65b9\u9762\u8981\u8fdc\u8fdc\u4f18\u4e8eMyISAM\u7684\u8868\u9501\u7684\u3002\u5f53\u7cfb\u7edf\u5e76\u53d1\u91cf\u6bd4\u8f83\u9ad8\u7684\u65f6\u5019\uff0cInnoDB \u7684\u6574\u4f53\u6027\u80fd\u548c MyISAM \u76f8\u6bd4\u5c31\u4f1a\u6709\u6bd4\u8f83\u660e\u663e\u7684\u4f18\u52bf\u3002</p> <p>\u4f46\u662f\uff0cInnoDB \u7684\u884c\u7ea7\u9501\u4e5f\u6709\u8106\u5f31\u7684\u4e00\u9762\uff0c\u5f53\u6211\u4eec\u4f7f\u7528\u4e0d\u5f53\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u8ba9 InnoDB \u7684\u6574\u4f53\u6027\u80fd\u8868\u73b0\u4e0d\u4ec5\u4e0d\u80fd\u6bd4 MyISAM \u9ad8\uff0c\u751a\u81f3\u4f1a\u66f4\u5dee\u3002</p>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#2510","title":"2.5.10\u3001\u4f18\u5316\u5efa\u8bae","text":"<ol> <li>\u5c3d\u53ef\u80fd\u8ba9\u6240\u6709\u6570\u636e\u68c0\u7d22\u90fd\u80fd\u901a\u8fc7\u7d22\u5f15\u6765\u5b8c\u6210\uff0c\u907f\u514d\u65e0\u7d22\u5f15\u884c\u9501\u5347\u7ea7\u4e3a\u8868\u9501\u3002</li> <li>\u5408\u7406\u8bbe\u8ba1\u7d22\u5f15\uff0c\u5c3d\u91cf\u7f29\u5c0f\u9501\u7684\u8303\u56f4</li> <li>\u5c3d\u53ef\u80fd\u51cf\u5c11\u7d22\u5f15\u6761\u4ef6\uff0c\u53ca\u7d22\u5f15\u8303\u56f4\uff0c\u907f\u514d\u95f4\u9699\u9501</li> <li>\u5c3d\u91cf\u63a7\u5236\u4e8b\u52a1\u5927\u5c0f\uff0c\u51cf\u5c11\u9501\u5b9a\u8d44\u6e90\u91cf\u548c\u65f6\u95f4\u957f\u5ea6</li> <li>\u5c3d\u53ef\u80fd\u4f7f\u7528\u4f4e\u7ea7\u522b\u4e8b\u52a1\u9694\u79bb\uff08\u4f46\u662f\u9700\u8981\u4e1a\u52a1\u5c42\u6ee1\u8db3\u9700\u6c42\uff09</li> </ol>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#3mysql","title":"3\u3001\u5e38\u7528MySQL\u6280\u5de7","text":""},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#1-sql","title":"1. SQL \u6267\u884c\u987a\u5e8f","text":"<p>\u7f16\u5199\u987a\u5e8f</p> <pre><code>SELECT DISTINCT\n&lt;select list&gt;\nFROM\n&lt;left_table&gt; &lt;join_type&gt;\nJOIN\n&lt;right_table&gt; ON &lt;join_condition&gt;\nWHERE\n&lt;where_condition&gt;\nGROUP BY\n&lt;group_by_list&gt;\nHAVING\n&lt;having_condition&gt;\nORDER BY\n&lt;order_by_condition&gt;\nLIMIT\n&lt;limit_params&gt;\n12345678910111213141516\n</code></pre> <p>\u6267\u884c\u987a\u5e8f</p> <pre><code>FROM    &lt;left_table&gt;\nON      &lt;join_condition&gt;\n&lt;join_type&gt;     JOIN    &lt;right_table&gt;\nWHERE       &lt;where_condition&gt;\nGROUP BY    &lt;group_by_list&gt;\nHAVING      &lt;having_condition&gt;\nSELECT DISTINCT     &lt;select list&gt;\nORDER BY    &lt;order_by_condition&gt;\nLIMIT       &lt;limit_params&gt;\n</code></pre>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#2","title":"2. \u6b63\u5219\u8868\u8fbe\u5f0f\u4f7f\u7528","text":"<p>\u6b63\u5219\u8868\u8fbe\u5f0f\uff08Regular Expression\uff09\u662f\u6307\u4e00\u4e2a\u7528\u6765\u63cf\u8ff0\u6216\u8005\u5339\u914d\u4e00\u7cfb\u5217\u7b26\u5408\u67d0\u4e2a\u53e5\u6cd5\u89c4\u5219\u7684\u5b57\u7b26\u4e32\u7684\u5355\u4e2a\u5b57\u7b26\u4e32\u3002</p> \u7b26\u53f7 \u542b\u4e49 ^ \u5728\u5b57\u7b26\u4e32\u5f00\u59cb\u5904\u8fdb\u884c\u5339\u914d $ \u5728\u5b57\u7b26\u4e32\u672b\u5c3e\u5904\u8fdb\u884c\u5339\u914d . \u5339\u914d\u4efb\u610f\u5355\u4e2a\u5b57\u7b26, \u5305\u62ec\u6362\u884c\u7b26 [\u2026] \u5339\u914d\u51fa\u62ec\u53f7\u5185\u7684\u4efb\u610f\u5b57\u7b26 [^\u2026] \u5339\u914d\u4e0d\u51fa\u62ec\u53f7\u5185\u7684\u4efb\u610f\u5b57\u7b26 a* \u5339\u914d\u96f6\u4e2a\u6216\u8005\u591a\u4e2aa(\u5305\u62ec\u7a7a\u4e32) a+ \u5339\u914d\u4e00\u4e2a\u6216\u8005\u591a\u4e2aa(\u4e0d\u5305\u62ec\u7a7a\u4e32) a? \u5339\u914d\u96f6\u4e2a\u6216\u8005\u4e00\u4e2aa a1|a2 \u5339\u914da1\u6216a2 a(m) \u5339\u914dm\u4e2aa a(m,) \u81f3\u5c11\u5339\u914dm\u4e2aa a(m,n) \u5339\u914dm\u4e2aa \u5230 n\u4e2aa a(,n) \u5339\u914d0\u5230n\u4e2aa (\u2026) \u5c06\u6a21\u5f0f\u5143\u7d20\u7ec4\u6210\u5355\u4e00\u5143\u7d20 <pre><code>select * from emp where name regexp '^T';\nselect * from emp where name regexp '2$';\nselect * from emp where name regexp '[uvw]';\n12345\n</code></pre>"},{"location":"Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/#3-mysql","title":"3. MySQL \u5e38\u7528\u51fd\u6570","text":"<p>\u6570\u5b57\u51fd\u6570</p> \u51fd\u6570\u540d\u79f0 \u4f5c \u7528 ABS \u6c42\u7edd\u5bf9\u503c SQRT \u6c42\u4e8c\u6b21\u65b9\u6839 MOD \u6c42\u4f59\u6570 CEIL \u548c CEILING \u4e24\u4e2a\u51fd\u6570\u529f\u80fd\u76f8\u540c\uff0c\u90fd\u662f\u8fd4\u56de\u4e0d\u5c0f\u4e8e\u53c2\u6570\u7684\u6700\u5c0f\u6574\u6570\uff0c\u5373\u5411\u4e0a\u53d6\u6574 FLOOR \u5411\u4e0b\u53d6\u6574\uff0c\u8fd4\u56de\u503c\u8f6c\u5316\u4e3a\u4e00\u4e2aBIGINT RAND \u751f\u6210\u4e00\u4e2a0~1\u4e4b\u95f4\u7684\u968f\u673a\u6570\uff0c\u4f20\u5165\u6574\u6570\u53c2\u6570\u662f\uff0c\u7528\u6765\u4ea7\u751f\u91cd\u590d\u5e8f\u5217 ROUND \u5bf9\u6240\u4f20\u53c2\u6570\u8fdb\u884c\u56db\u820d\u4e94\u5165 SIGN \u8fd4\u56de\u53c2\u6570\u7684\u7b26\u53f7 POW \u548c POWER \u4e24\u4e2a\u51fd\u6570\u7684\u529f\u80fd\u76f8\u540c\uff0c\u90fd\u662f\u6240\u4f20\u53c2\u6570\u7684\u6b21\u65b9\u7684\u7ed3\u679c\u503c SIN \u6c42\u6b63\u5f26\u503c ASIN \u6c42\u53cd\u6b63\u5f26\u503c\uff0c\u4e0e\u51fd\u6570 SIN \u4e92\u4e3a\u53cd\u51fd\u6570 COS \u6c42\u4f59\u5f26\u503c ACOS \u6c42\u53cd\u4f59\u5f26\u503c\uff0c\u4e0e\u51fd\u6570 COS \u4e92\u4e3a\u53cd\u51fd\u6570 TAN \u6c42\u6b63\u5207\u503c ATAN \u6c42\u53cd\u6b63\u5207\u503c\uff0c\u4e0e\u51fd\u6570 TAN \u4e92\u4e3a\u53cd\u51fd\u6570 COT \u6c42\u4f59\u5207\u503c <p>\u5b57\u7b26\u4e32\u51fd\u6570</p> \u51fd\u6570\u540d\u79f0 \u4f5c \u7528 LENGTH \u8ba1\u7b97\u5b57\u7b26\u4e32\u957f\u5ea6\u51fd\u6570\uff0c\u8fd4\u56de\u5b57\u7b26\u4e32\u7684\u5b57\u8282\u957f\u5ea6 CONCAT \u5408\u5e76\u5b57\u7b26\u4e32\u51fd\u6570\uff0c\u8fd4\u56de\u7ed3\u679c\u4e3a\u8fde\u63a5\u53c2\u6570\u4ea7\u751f\u7684\u5b57\u7b26\u4e32\uff0c\u53c2\u6570\u53ef\u4ee5\u4f7f\u4e00\u4e2a\u6216\u591a\u4e2a INSERT \u66ff\u6362\u5b57\u7b26\u4e32\u51fd\u6570 LOWER \u5c06\u5b57\u7b26\u4e32\u4e2d\u7684\u5b57\u6bcd\u8f6c\u6362\u4e3a\u5c0f\u5199 UPPER \u5c06\u5b57\u7b26\u4e32\u4e2d\u7684\u5b57\u6bcd\u8f6c\u6362\u4e3a\u5927\u5199 LEFT \u4ece\u5de6\u4fa7\u5b57\u622a\u53d6\u7b26\u4e32\uff0c\u8fd4\u56de\u5b57\u7b26\u4e32\u5de6\u8fb9\u7684\u82e5\u5e72\u4e2a\u5b57\u7b26 RIGHT \u4ece\u53f3\u4fa7\u5b57\u622a\u53d6\u7b26\u4e32\uff0c\u8fd4\u56de\u5b57\u7b26\u4e32\u53f3\u8fb9\u7684\u82e5\u5e72\u4e2a\u5b57\u7b26 TRIM \u5220\u9664\u5b57\u7b26\u4e32\u5de6\u53f3\u4e24\u4fa7\u7684\u7a7a\u683c REPLACE \u5b57\u7b26\u4e32\u66ff\u6362\u51fd\u6570\uff0c\u8fd4\u56de\u66ff\u6362\u540e\u7684\u65b0\u5b57\u7b26\u4e32 SUBSTRING \u622a\u53d6\u5b57\u7b26\u4e32\uff0c\u8fd4\u56de\u4ece\u6307\u5b9a\u4f4d\u7f6e\u5f00\u59cb\u7684\u6307\u5b9a\u957f\u5ea6\u7684\u5b57\u7b26\u6362 REVERSE \u5b57\u7b26\u4e32\u53cd\u8f6c\uff08\u9006\u5e8f\uff09\u51fd\u6570\uff0c\u8fd4\u56de\u4e0e\u539f\u59cb\u5b57\u7b26\u4e32\u987a\u5e8f\u76f8\u53cd\u7684\u5b57\u7b26\u4e32 <p>\u65e5\u671f\u51fd\u6570</p> \u51fd\u6570\u540d\u79f0 \u4f5c \u7528 CURDATE \u548c CURRENT_DATE \u4e24\u4e2a\u51fd\u6570\u4f5c\u7528\u76f8\u540c\uff0c\u8fd4\u56de\u5f53\u524d\u7cfb\u7edf\u7684\u65e5\u671f\u503c CURTIME \u548c CURRENT_TIME \u4e24\u4e2a\u51fd\u6570\u4f5c\u7528\u76f8\u540c\uff0c\u8fd4\u56de\u5f53\u524d\u7cfb\u7edf\u7684\u65f6\u95f4\u503c NOW \u548c SYSDATE \u4e24\u4e2a\u51fd\u6570\u4f5c\u7528\u76f8\u540c\uff0c\u8fd4\u56de\u5f53\u524d\u7cfb\u7edf\u7684\u65e5\u671f\u548c\u65f6\u95f4\u503c MONTH \u83b7\u53d6\u6307\u5b9a\u65e5\u671f\u4e2d\u7684\u6708\u4efd MONTHNAME \u83b7\u53d6\u6307\u5b9a\u65e5\u671f\u4e2d\u7684\u6708\u4efd\u82f1\u6587\u540d\u79f0 DAYNAME \u83b7\u53d6\u6307\u5b9a\u66f0\u671f\u5bf9\u5e94\u7684\u661f\u671f\u51e0\u7684\u82f1\u6587\u540d\u79f0 DAYOFWEEK \u83b7\u53d6\u6307\u5b9a\u65e5\u671f\u5bf9\u5e94\u7684\u4e00\u5468\u7684\u7d22\u5f15\u4f4d\u7f6e\u503c WEEK \u83b7\u53d6\u6307\u5b9a\u65e5\u671f\u662f\u4e00\u5e74\u4e2d\u7684\u7b2c\u51e0\u5468\uff0c\u8fd4\u56de\u503c\u7684\u8303\u56f4\u662f\u5426\u4e3a 0\u301c52 \u6216 1\u301c53 DAYOFYEAR \u83b7\u53d6\u6307\u5b9a\u66f0\u671f\u662f\u4e00\u5e74\u4e2d\u7684\u7b2c\u51e0\u5929\uff0c\u8fd4\u56de\u503c\u8303\u56f4\u662f1~366 DAYOFMONTH \u83b7\u53d6\u6307\u5b9a\u65e5\u671f\u662f\u4e00\u4e2a\u6708\u4e2d\u662f\u7b2c\u51e0\u5929\uff0c\u8fd4\u56de\u503c\u8303\u56f4\u662f1~31 YEAR \u83b7\u53d6\u5e74\u4efd\uff0c\u8fd4\u56de\u503c\u8303\u56f4\u662f 1970\u301c2069 TIME_TO_SEC \u5c06\u65f6\u95f4\u53c2\u6570\u8f6c\u6362\u4e3a\u79d2\u6570 SEC_TO_TIME \u5c06\u79d2\u6570\u8f6c\u6362\u4e3a\u65f6\u95f4\uff0c\u4e0eTIME_TO_SEC \u4e92\u4e3a\u53cd\u51fd\u6570 DATE_ADD \u548c ADDDATE \u4e24\u4e2a\u51fd\u6570\u529f\u80fd\u76f8\u540c\uff0c\u90fd\u662f\u5411\u65e5\u671f\u6dfb\u52a0\u6307\u5b9a\u7684\u65f6\u95f4\u95f4\u9694 DATE_SUB \u548c SUBDATE \u4e24\u4e2a\u51fd\u6570\u529f\u80fd\u76f8\u540c\uff0c\u90fd\u662f\u5411\u65e5\u671f\u51cf\u53bb\u6307\u5b9a\u7684\u65f6\u95f4\u95f4\u9694 ADDTIME \u65f6\u95f4\u52a0\u6cd5\u8fd0\u7b97\uff0c\u5728\u539f\u59cb\u65f6\u95f4\u4e0a\u6dfb\u52a0\u6307\u5b9a\u7684\u65f6\u95f4 SUBTIME \u65f6\u95f4\u51cf\u6cd5\u8fd0\u7b97\uff0c\u5728\u539f\u59cb\u65f6\u95f4\u4e0a\u51cf\u53bb\u6307\u5b9a\u7684\u65f6\u95f4 DATEDIFF \u83b7\u53d6\u4e24\u4e2a\u65e5\u671f\u4e4b\u95f4\u95f4\u9694\uff0c\u8fd4\u56de\u53c2\u6570 1 \u51cf\u53bb\u53c2\u6570 2 \u7684\u503c DATE_FORMAT \u683c\u5f0f\u5316\u6307\u5b9a\u7684\u65e5\u671f\uff0c\u6839\u636e\u53c2\u6570\u8fd4\u56de\u6307\u5b9a\u683c\u5f0f\u7684\u503c WEEKDAY \u83b7\u53d6\u6307\u5b9a\u65e5\u671f\u5728\u4e00\u5468\u5185\u7684\u5bf9\u5e94\u7684\u5de5\u4f5c\u65e5\u7d22\u5f15 <p>\u805a\u5408\u51fd\u6570</p> \u51fd\u6570\u540d\u79f0 \u4f5c\u7528 MAX \u67e5\u8be2\u6307\u5b9a\u5217\u7684\u6700\u5927\u503c MIN \u67e5\u8be2\u6307\u5b9a\u5217\u7684\u6700\u5c0f\u503c COUNT \u7edf\u8ba1\u67e5\u8be2\u7ed3\u679c\u7684\u884c\u6570 SUM \u6c42\u548c\uff0c\u8fd4\u56de\u6307\u5b9a\u5217\u7684\u603b\u548c AVG \u6c42\u5e73\u5747\u503c\uff0c\u8fd4\u56de\u6307\u5b9a\u5217\u6570\u636e\u7684\u5e73\u5747\u503c"},{"location":"LVM%E9%80%BB%E8%BE%91%E5%8D%B7%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8ALVM%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/","title":"LVM\u903b\u8f91\u5377\u57fa\u672c\u6982\u5ff5\u53caLVM\u7684\u5de5\u4f5c\u539f\u7406","text":""},{"location":"LVM%E9%80%BB%E8%BE%91%E5%8D%B7%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8ALVM%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/#_1","title":"\u4e00\u3001\u4f20\u7edf\u7684\u78c1\u76d8\u7ba1\u7406","text":"<p>\u5176\u5b9e\u5728Linux\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u6211\u4eec\u7684\u78c1\u76d8\u7ba1\u7406\u673a\u5236\u548cwindows\u4e0a\u7684\u5dee\u4e0d\u591a\uff0c\u7edd\u5927\u591a\u6570\u90fd\u662f\u4f7f\u7528MBR(Master Boot Recorder)\u90fd\u662f\u901a\u8fc7\u5148\u5bf9\u4e00\u4e2a\u786c\u76d8\u8fdb\u884c\u5206\u533a\uff0c\u7136\u540e\u518d\u5c06\u8be5\u5206\u533a\u8fdb\u884c\u6587\u4ef6\u7cfb\u7edf\u7684\u683c\u5f0f\u5316\uff0c\u5728Linux\u7cfb\u7edf\u4e2d\u5982\u679c\u8981\u4f7f\u7528\u8be5\u5206\u533a\u5c31\u5c06\u5176\u6302\u8f7d\u4e0a\u53bb\u5373\u53ef\uff0cwindows\u7684\u8bdd\u5176\u5b9e\u5e95\u5c42\u4e5f\u5c31\u662f\u81ea\u52a8\u5c06\u6240\u6709\u7684\u5206\u533a\u6302\u8f7d\u597d\uff0c\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u5bf9\u8be5\u5206\u533a\u8fdb\u884c\u4f7f\u7528\u4e86\u3002</p> <p>\u4f46\u662f\u8fd9\u79cd\u4f20\u7edf\u7684\u78c1\u76d8\u7ba1\u7406\u7ecf\u5e38\u4f1a\u5e26\u6765\u5f88\u591a\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u8bf4\u5f53\u6211\u4eec\u4f7f\u7528\u7684\u4e00\u4e2a\u5206\u533a\uff0c\u5176\u7a7a\u95f4\u5927\u5c0f\u5df2\u7ecf\u4e0d\u518d\u591f\u7528\u4e86\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u6ca1\u6709\u529e\u6cd5\u901a\u8fc7\u62c9\u4f38\u5206\u533a\u6765\u8fdb\u884c\u5206\u533a\u6269\u5145\uff0c\u5f53\u7136\u76ee\u524d\u4e5f\u6709\u5176\u4ed6\u7b2c\u4e09\u65b9\u7684\u78c1\u76d8\u7ba1\u7406\u8f6f\u4ef6\u53ef\u4ee5\u8fdb\u884c\u78c1\u76d8\u7684\u5206\u533a\u7a7a\u95f4\u5212\u5206\uff0c\u4f46\u662f\u8fd9\u6837\u4f1a\u7ed9\u6211\u4eec\u7684\u6587\u4ef6\u7cfb\u7edf\u9020\u6210\u5f88\u5927\u7684\u4f24\u5bb3\uff0c\u6709\u65f6\u4f1a\u5bfc\u81f4\u6587\u4ef6\u7cfb\u7edf\u5d29\u6e83\u7b49\u95ee\u9898\u3002\u5bf9\u4e8e\u4f20\u7edf\u7684\u78c1\u76d8\u7ba1\u7406\u5982\u679c\u8bf4\u6211\u4eec\u78b0\u5230\u5f53\u5206\u533a\u5927\u5c0f\u4e0d\u8db3\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ea\u80fd\u901a\u8fc7\u589e\u52a0\u65b0\u7684\u786c\u76d8\uff0c\u7136\u540e\u5728\u65b0\u7684\u786c\u76d8\u4e0a\u521b\u5efa\u5206\u533a\uff0c\u5bf9\u5206\u533a\u8fdb\u884c\u683c\u5f0f\u5316\u4ee5\u540e\uff0c\u7136\u540e\u5c06\u4e4b\u524d\u5206\u533a\u7684\u6240\u6709\u4e1c\u897f\u90fd\u62f7\u8d1d\u5230\u65b0\u7684\u5206\u533a\u91cc\u9762\u624d\u884c\u3002\u4f46\u662f\u65b0\u589e\u52a0\u7684\u786c\u76d8\u662f\u4f5c\u4e3a\u72ec\u7acb\u7684\u6587\u4ef6\u7cfb\u7edf\u5b58\u5728\u7684\uff0c\u539f\u6709\u7684\u6587\u4ef6\u7cfb\u7edf\u5e76\u6ca1\u6709\u5f97\u5230\u4efb\u4f55\u7684\u6269\u5145\uff0c\u4e0a\u5c42\u5e94\u7528\u53ea\u80fd\u8bbf\u95ee\u5230\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u3002 \u8fd9\u6837\u7684\u65b9\u5f0f\u5bf9\u4e2a\u4eba\u7684\u7535\u8111\u6765\u8bf4\u53ef\u80fd\u8fd8\u80fd\u63a5\u53d7\uff0c\u4f46\u662f\u5982\u679c\u5bf9\u4e8e\u751f\u4ea7\u73af\u5883\u4e0b\u7684\u670d\u52a1\u5668\u6765\u8bf4\uff0c\u8fd9\u662f\u4e0d\u53ef\u63a5\u53d7\u7684\u3002\u56e0\u4e3a\u5982\u679c\u8981\u628a\u4e00\u4e2a\u5206\u533a\u7684\u5185\u5bb9\u90fd\u62f7\u8d1d\u5230\u53e6\u4e00\u4e2a\u5206\u533a\u4e0a\u53bb\uff0c\u52bf\u5fc5\u8981\u9996\u5148\u5378\u8f7d\u6389\u4e4b\u524d\u7684\u90a3\u4e2a\u5206\u533a\uff0c\u7136\u540e\u5bf9\u6574\u4e2a\u5206\u533a\u8fdb\u884c\u62f7\u8d1d\uff0c\u5982\u679c\u670d\u52a1\u5668\u4e0a\u8fd0\u884c\u7740\u4e00\u4e2a\u91cd\u8981\u7684\u670d\u52a1\uff0c\u6bd4\u5982\u8bf4WWW\u6216\u8005FTP\uff0c\u5176\u8981\u6c42\u662f 7*24 \u5c0f\u65f6\u8fd0\u884c\u6b63\u5e38\u7684\uff0c\u90a3\u4e48\u5378\u8f7d\u6389\u5206\u533a\u8fd9\u662f\u4e0d\u53ef\u60f3\u8c61\u7684\uff0c\u540c\u65f6\u5982\u679c\u8be5\u5206\u533a\u4fdd\u5b58\u7684\u5185\u5bb9\u975e\u5e38\u975e\u5e38\u7684\u591a\uff0c\u90a3\u4e48\u5728\u5bf9\u5206\u533a\u8fdb\u884c\u8f6c\u79fb\u65f6\u65f6\u95f4\u53ef\u80fd\u4f1a\u8017\u8d39\u5f88\u4e45\uff0c\u6240\u4ee5\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u4f1a\u53d7\u5230\u4f20\u7edf\u78c1\u76d8\u7ba1\u7406\u7684\u9650\u5236\uff0c\u56e0\u4e3a\u5176\u4e0d\u80fd\u591f\u8fdb\u884c\u52a8\u6001\u7684\u78c1\u76d8\u7ba1\u7406\u3002\u56e0\u6b64\uff0c\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cLVM\u6280\u672f\u5c31\u8bde\u751f\u4e86\uff01\uff01\uff01</p>"},{"location":"LVM%E9%80%BB%E8%BE%91%E5%8D%B7%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8ALVM%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/#lvm","title":"\u4e8c\u3001LVM\u7684\u78c1\u76d8\u7ba1\u7406","text":"<p>\u6b63\u662f\u56e0\u4e3a\u4f20\u7edf\u7684\u78c1\u76d8\u7ba1\u7406\u4e0d\u80fd\u5bf9\u6211\u4eec\u7684\u78c1\u76d8\u7a7a\u95f4\u8fdb\u884c\u52a8\u6001\u7684\u7ba1\u7406\uff0c\u56e0\u6b64\u5c31\u8bde\u751f\u51fa\u4e86LVM\u8fd9\u4e2a\u6280\u672f\uff0c\u90a3\u4e48LVM\u5230\u5e95\u662f\u4ec0\u4e48\u5462\uff1f\u5b83\u53c8\u662f\u600e\u4e48\u5bf9\u78c1\u76d8\u8fdb\u884c\u7ba1\u7406\u7684\u5462\uff1f</p> <p>LVM(Logical volume Manager)\u662f\u903b\u8f91\u5377\u7ba1\u7406\u7684\u7b80\u79f0\u3002\u5b83\u662fLinux\u73af\u5883\u4e0b\u5bf9\u78c1\u76d8\u5206\u533a\u8fdb\u884c\u7ba1\u7406\u7684\u4e00\u79cd\u673a\u5236\u3002\u73b0\u5728\u4e0d\u4ec5\u4ec5\u662fLinux\u7cfb\u7edf\u4e0a\u53ef\u4ee5\u4f7f\u7528LVM\u8fd9\u79cd\u78c1\u76d8\u7ba1\u7406\u673a\u5236\uff0c\u5bf9\u4e8e\u5176\u5b83\u7684\u7c7bUNIX\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4ee5\u53cawindows\u64cd\u4f5c\u7cfb\u7edf\u90fd\u6709\u7c7b\u4f3c\u4e0eLVM\u8fd9\u79cd\u78c1\u76d8\u7ba1\u7406\u8f6f\u4ef6\u3002</p> <p>LVM\u7684\u5de5\u4f5c\u539f\u7406\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u5b83\u5c31\u662f\u901a\u8fc7\u5c06\u5e95\u5c42\u7684\u7269\u7406\u786c\u76d8\u62bd\u8c61\u7684\u5c01\u88c5\u8d77\u6765\uff0c\u7136\u540e\u4ee5\u903b\u8f91\u5377\u7684\u65b9\u5f0f\u5448\u73b0\u7ed9\u4e0a\u5c42\u5e94\u7528\u3002\u5728\u4f20\u7edf\u7684\u78c1\u76d8\u7ba1\u7406\u673a\u5236\u4e2d\uff0c\u6211\u4eec\u7684\u4e0a\u5c42\u5e94\u7528\u662f\u76f4\u63a5\u8bbf\u95ee\u6587\u4ef6\u7cfb\u7edf\uff0c\u4ece\u800c\u5bf9\u5e95\u5c42\u7684\u7269\u7406\u786c\u76d8\u8fdb\u884c\u8bfb\u53d6\uff0c\u800c\u5728LVM\u4e2d\uff0c\u5176\u901a\u8fc7\u5bf9\u5e95\u5c42\u7684\u786c\u76d8\u8fdb\u884c\u5c01\u88c5\uff0c\u5f53\u6211\u4eec\u5bf9\u5e95\u5c42\u7684\u7269\u7406\u786c\u76d8\u8fdb\u884c\u64cd\u4f5c\u65f6\uff0c\u5176\u4e0d\u518d\u662f\u9488\u5bf9\u4e8e\u5206\u533a\u8fdb\u884c\u64cd\u4f5c\uff0c\u800c\u662f\u901a\u8fc7\u4e00\u4e2a\u53eb\u505a\u903b\u8f91\u5377\u7684\u4e1c\u897f\u6765\u5bf9\u5176\u8fdb\u884c\u5e95\u5c42\u7684\u78c1\u76d8\u7ba1\u7406\u64cd\u4f5c\u3002\u6bd4\u5982\u8bf4\u6211\u589e\u52a0\u4e00\u4e2a\u7269\u7406\u786c\u76d8\uff0c\u8fd9\u4e2a\u65f6\u5019\u4e0a\u5c42\u7684\u670d\u52a1\u662f\u611f\u89c9\u4e0d\u5230\u7684\uff0c\u56e0\u4e3a\u5448\u73b0\u7ed9\u4e0a\u6b21\u670d\u52a1\u7684\u662f\u4ee5\u903b\u8f91\u5377\u7684\u65b9\u5f0f\u3002</p> <p>LVM\u6700\u5927\u7684\u7279\u70b9\u5c31\u662f\u53ef\u4ee5\u5bf9\u78c1\u76d8\u8fdb\u884c\u52a8\u6001\u7ba1\u7406\u3002\u56e0\u4e3a\u903b\u8f91\u5377\u7684\u5927\u5c0f\u662f\u53ef\u4ee5\u52a8\u6001\u8c03\u6574\u7684\uff0c\u800c\u4e14\u4e0d\u4f1a\u4e22\u5931\u73b0\u6709\u7684\u6570\u636e\u3002\u6211\u4eec\u5982\u679c\u65b0\u589e\u52a0\u4e86\u786c\u76d8\uff0c\u5176\u4e5f\u4e0d\u4f1a\u6539\u53d8\u73b0\u6709\u4e0a\u5c42\u7684\u903b\u8f91\u5377\u3002\u4f5c\u4e3a\u4e00\u4e2a\u52a8\u6001\u78c1\u76d8\u7ba1\u7406\u673a\u5236\uff0c\u903b\u8f91\u5377\u6280\u672f\u5927\u5927\u63d0\u9ad8\u4e86\u78c1\u76d8\u7ba1\u7406\u7684\u7075\u6d3b\u6027\uff01\uff01\uff01</p>"},{"location":"LVM%E9%80%BB%E8%BE%91%E5%8D%B7%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8ALVM%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/#lvm_1","title":"\u4e09\u3001LVM\u7684\u539f\u7406","text":"<p>\u8981\u60f3\u7406\u89e3\u597dLVM\u7684\u539f\u7406\uff0c\u6211\u4eec\u5fc5\u987b\u9996\u5148\u8981\u638c\u63e14\u4e2a\u57fa\u672c\u7684\u903b\u8f91\u5377\u6982\u5ff5\u3002</p> <ul> <li>\u2460PE  (Physical Extend)  \u7269\u7406\u62d3\u5c55</li> <li>\u2461PV  (Physical Volume)  \u7269\u7406\u5377</li> <li>\u2462VG  (Volume Group)     \u5377\u7ec4</li> <li>\u2463LV  (Logical Volume)   \u903b\u8f91\u5377</li> </ul> <p>\u6211\u4eec\u77e5\u9053\u5728\u4f7f\u7528LVM\u5bf9\u78c1\u76d8\u8fdb\u884c\u52a8\u6001\u7ba1\u7406\u4ee5\u540e\uff0c\u6211\u4eec\u662f\u4ee5\u903b\u8f91\u5377\u7684\u65b9\u5f0f\u5448\u73b0\u7ed9\u4e0a\u5c42\u7684\u670d\u52a1\u7684\u3002\u6240\u4ee5\u6211\u4eec\u6240\u6709\u7684\u64cd\u4f5c\u76ee\u7684\uff0c\u5176\u5b9e\u5c31\u662f\u53bb\u521b\u5efa\u4e00\u4e2aLV(Logical Volume),\u903b\u8f91\u5377\u5c31\u662f\u7528\u6765\u53d6\u4ee3\u6211\u4eec\u4e4b\u524d\u7684\u5206\u533a\uff0c\u6211\u4eec\u901a\u8fc7\u5bf9\u903b\u8f91\u5377\u8fdb\u884c\u683c\u5f0f\u5316\uff0c\u7136\u540e\u8fdb\u884c\u6302\u8f7d\u64cd\u4f5c\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e86\u3002\u90a3\u4e48LVM\u7684\u5de5\u4f5c\u539f\u7406\u662f\u4ec0\u4e48\u5462\uff1f\u6240\u8c13\u65e0\u56fe\u65e0\u771f\u76f8\uff0c\u54b1\u4eec\u4e0b\u9762\u901a\u8fc7\u56fe\u6765\u5bf9\u903b\u8f91\u5377\u7684\u539f\u7406\u8fdb\u884c\u89e3\u91ca\uff01\uff01</p> <p></p>"},{"location":"LVM%E9%80%BB%E8%BE%91%E5%8D%B7%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8ALVM%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/#1pvphysical-volume","title":"1.\u5c06\u6211\u4eec\u7684\u7269\u7406\u786c\u76d8\u683c\u5f0f\u5316\u6210PV(Physical Volume)","text":"<p>\u6211\u4eec\u770b\u5230\uff0c\u8fd9\u91cc\u6709\u4e24\u5757\u786c\u76d8\uff0c\u4e00\u5757\u662fsda\uff0c\u53e6\u4e00\u5757\u662fsdb\uff0c\u5728LVM\u78c1\u76d8\u7ba1\u7406\u91cc\uff0c\u6211\u9996\u5148\u8981\u5c06\u8fd9\u4e24\u5757\u786c\u76d8\u683c\u5f0f\u5316\u4e3a\u6211\u4eec\u7684PV(Physical Volume),\u4e5f\u5c31\u662f\u6211\u4eec\u7684\u7269\u7406\u5377\uff0c\u5176\u5b9e\u683c\u5f0f\u5316\u7269\u7406\u5377\u7684\u8fc7\u7a0b\u4e2dLVM\u662f\u5c06\u5e95\u5c42\u7684\u786c\u76d8\u5212\u5206\u4e3a\u4e86\u4e00\u4e2a\u4e00\u4e2a\u7684PE(Physical Extend),<code>\u6211\u4eec\u7684LVM\u78c1\u76d8\u7ba1\u7406\u4e2dPE\u7684\u9ed8\u8ba4\u5927\u5c0f\u662f4M\u5927\u5c0f</code>\uff0c\u5176\u5b9ePE\u5c31\u662f\u6211\u4eec\u903b\u8f91\u5377\u7ba1\u7406\u7684\u6700\u57fa\u672c\u5355\u4f4d\u3002\u6bd4\u5982\u8bf4\u6211\u6709\u4e00\u4e2a400M\u7684\u786c\u76d8\uff0c\u90a3\u4e48\u5728\u5c06\u5176\u683c\u5f0f\u5316\u6210PV\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u9645\u5c31\u662f\u5c06\u8fd9\u5757\u7269\u7406\u786c\u76d8\u5212\u5206\u6210\u4e86100\u4e2a\u7684PE\uff0c\u56e0\u4e3aPE\u9ed8\u8ba4\u7684\u5927\u5c0f\u5c31\u662f4M\u3002\u8fd9\u4e2a\u5c31\u662f\u6211\u4eec\u7684\u7b2c\u4e00\u6b65\u64cd\u4f5c\u3002</p>"},{"location":"LVM%E9%80%BB%E8%BE%91%E5%8D%B7%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8ALVM%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/#2vgvolume-group","title":"2.\u521b\u5efa\u4e00\u4e2aVG(Volume Group)","text":"<p>\u5728\u5c06\u786c\u76d8\u683c\u5f0f\u5316\u6210PV\u4ee5\u540e\uff0c\u6211\u4eec\u7b2c\u4e8c\u6b65\u64cd\u4f5c\u5c31\u662f\u521b\u5efa\u4e00\u4e2a\u5377\u7ec4\uff0c\u4e5f\u5c31\u662fVG(Volume Group),\u5377\u7ec4\u5728\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u62bd\u8c61\u5316\u6210\u4e00\u4e2a\u7a7a\u95f4\u6c60\uff0cVG\u7684\u4f5c\u7528\u5c31\u662f\u7528\u6765\u88c5PE\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4e00\u4e2a\u6216\u8005\u591a\u4e2aPV\u52a0\u5230VG\u5f53\u4e2d\uff0c\u56e0\u4e3a\u5728\u7b2c\u4e00\u6b65\u64cd\u4f5c\u65f6\u5c31\u5df2\u7ecf\u5c06\u8be5\u786c\u76d8\u5212\u5206\u6210\u4e86\u591a\u4e2aPE\uff0c\u6240\u4ee5\u5c06\u591a\u4e2aPV\u52a0\u5230VG\u91cc\u9762\u540e\uff0cVG\u91cc\u9762\u5c31\u5b58\u653e\u4e86\u8bb8\u8bb8\u591a\u591a\u6765\u81ea\u4e0d\u540cPV\u4e2d\u7684PE\uff0c\u6211\u4eec\u901a\u8fc7\u4e0a\u9762\u7684\u56fe\u7247\u5c31\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u683c\u5f0f\u5316\u4e86\u4e24\u5757\u786c\u76d8\uff0c\u6bcf\u4e2a\u786c\u76d8\u5206\u522b\u683c\u5f0f\u5316\u6210\u4e863\u4e2aPE\uff0c\u7136\u540e\u5c06\u4e24\u5757\u786c\u76d8\u7684PE\u90fd\u52a0\u5230\u4e86\u6211\u4eec\u7684VG\u5f53\u4e2d\uff0c\u90a3\u4e48\u6211\u4eec\u7684VG\u5f53\u4e2d\u5c31\u5305\u542b\u4e866\u4e2aPE\uff0c\u8fd96\u4e2aPE\u5c31\u662f\u4e24\u4e2a\u786c\u76d8\u7684PE\u4e4b\u548c\u3002\u901a\u5e38\u521b\u5efa\u4e00\u4e2a\u5377\u7ec4\u7684\u65f6\u5019\u6211\u4eec\u4f1a\u4e3a\u5176\u53d6\u4e00\u4e2a\u540d\u5b57\uff0c\u4e5f\u5c31\u662f\u8be5VG\u7684\u540d\u5b57\u3002</p>"},{"location":"LVM%E9%80%BB%E8%BE%91%E5%8D%B7%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8ALVM%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/#3vglvlogical-volume","title":"3.\u57fa\u4e8eVG\u521b\u5efa\u6211\u4eec\u6700\u540e\u8981\u4f7f\u7528\u7684LV(Logical Volume)","text":"<p>\u3010\u6ce8\u610f\u3011PV\u4ee5\u53caVG\u521b\u5efa\u597d\u4ee5\u540e\u6211\u4eec\u662f\u4e0d\u80fd\u591f\u76f4\u63a5\u4f7f\u7528\u7684\uff0c\u56e0\u4e3aPV\u3001VG\u662f\u6211\u4eec\u903b\u8f91\u5377\u5e95\u5c42\u7684\u4e1c\u897f\uff0c\u6211\u4eec\u5176\u5b9e\u6700\u540e\u4f7f\u7528\u7684\u662f\u5728VG\u57fa\u7840\u4e0a\u521b\u5efa\u7684LV(Logical Volume),\u6240\u4ee5\u7b2c\u4e09\u6b65\u64cd\u4f5c\u5c31\u662f\u57fa\u4e8eVG\u6765\u521b\u5efa\u6211\u4eec\u6700\u7ec8\u8981\u4f7f\u7528\u7684LV\u3002</p> <p>\u5f53\u6211\u4eec\u521b\u5efa\u597d\u6211\u4eec\u7684VG\u4ee5\u540e\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u521b\u5efaLV\u5176\u5b9e\u5c31\u662f\u4eceVG\u4e2d\u62ff\u51fa\u6211\u4eec\u6307\u5b9a\u6570\u91cf\u7684PE\uff0c\u8fd8\u662f\u62ff\u4e0a\u56fe\u6765\u8bf4\uff0c\u6211\u4eec\u770b\u5230\u6211\u4eec\u6b64\u65f6\u7684VG\u91cc\u9762\u5df2\u7ecf\u62e5\u6709\u4e866\u4e2aPE\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u521b\u5efa\u4e86\u6211\u4eec\u7684\u7b2c\u4e00\u4e2a\u903b\u8f91\u5377\uff0c\u5b83\u7684\u5927\u5c0f\u662f4\u4e2aPE\u7684\u5927\u5c0f\uff0c\u4e5f\u5c31\u662f16M(<code>\u56e0\u4e3a\u4e00\u4e2aPE\u7684\u9ed8\u8ba4\u5927\u5c0f\u662f4M</code>)\uff0c\u800c\u8fd94\u4e2aPE\u6709\u4e09\u4e2a\u662f\u6765\u81ea\u4e8e\u7b2c\u4e00\u5757\u786c\u76d8\uff0c\u800c\u53e6\u5916\u4e00\u4e2aPE\u5219\u662f\u6765\u81ea\u7b2c\u4e8c\u5757\u786c\u76d8\u3002\u5f53\u6211\u4eec\u521b\u5efa\u7b2c\u4e8c\u4e2a\u903b\u8f91\u5377\u65f6\uff0c\u5b83\u7684\u5927\u5c0f\u5c31\u6700\u591a\u53ea\u6709\u4e24\u4e2aPE\u7684\u5927\u5c0f\u4e86\uff0c\u56e0\u4e3a\u5176\u4e2d\u76844\u4e2aPE\u5df2\u7ecf\u5206\u914d\u7ed9\u4e86\u6211\u4eec\u7684\u7b2c\u4e00\u4e2a\u903b\u8f91\u5377\u3002</p> <p><code>\u6240\u4ee5\u521b\u5efa\u903b\u8f91\u5377\u5176\u5b9e\u5c31\u662f\u6211\u4eec\u4eceVG\u4e2d\u62ff\u51fa\u6211\u4eec\u6307\u5b9a\u6570\u91cf\u7684PE\uff0cVG\u4e2d\u7684PE\u53ef\u4ee5\u6765\u81ea\u4e0d\u540c\u7684PV\uff0c\u6211\u4eec\u53ef\u4ee5\u521b\u5efa\u7684\u903b\u8f91\u5377\u7684\u5927\u5c0f\u53d6\u51b3\u4e8eVG\u5f53\u4e2dPE\u5b58\u5728\u7684\u6570\u91cf\uff0c\u5e76\u4e14\u6211\u4eec\u521b\u5efa\u7684\u903b\u8f91\u5377\u5176\u5927\u5c0f\u4e00\u5b9a\u662fPE\u7684\u6574\u6570\u500d(\u5373\u903b\u8f91\u5377\u7684\u5927\u5c0f\u4e00\u5b9a\u8981\u662f4M\u7684\u6574\u6570\u500d)\u3002</code></p>"},{"location":"LVM%E9%80%BB%E8%BE%91%E5%8D%B7%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8ALVM%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/#4lv","title":"4.\u5c06\u6211\u4eec\u521b\u5efa\u597d\u7684LV\u8fdb\u884c\u6587\u4ef6\u7cfb\u7edf\u7684\u683c\u5f0f\u5316\uff0c\u7136\u540e\u6302\u8f7d\u4f7f\u7528","text":"<p>\u5728\u521b\u5efa\u597dLV\u4ee5\u540e\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u80fd\u591f\u5bf9\u5176\u8fdb\u884c\u6587\u4ef6\u7cfb\u7edf\u7684\u683c\u5f0f\u5316\u4e86\uff0c\u6211\u4eec\u6700\u7ec8\u4f7f\u7528\u7684\u5c31\u662f\u6211\u4eec\u521a\u521b\u5efa\u597d\u7684LV\uff0c\u5176\u5c31\u76f8\u5f53\u4e8e\u4f20\u7edf\u7684\u6587\u4ef6\u7ba1\u7406\u7684\u5206\u533a\uff0c\u6211\u4eec\u9996\u5148\u8981\u5bf9\u5176\u8fdb\u884c\u6587\u4ef6\u7cfb\u7edf\u7684\u683c\u5f0f\u5316\u64cd\u4f5c\uff0c\u7136\u540e\u901a\u8fc7mount\u547d\u4ee4\u5bf9\u5176\u8fdb\u884c\u6302\u8f7d\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u80fd\u591f\u50cf\u4f7f\u7528\u5e73\u5e38\u7684\u5206\u533a\u4e00\u6837\u6765\u4f7f\u7528\u6211\u4eec\u7684\u903b\u8f91\u5377\u4e86\u3002</p> <p>\u6211\u4eec\u5728\u521b\u5efa\u597dLV\u4ee5\u540e\uff0c\u6211\u4eec\u4f1a\u5728 <code>/dev</code> \u76ee\u5f55\u4e0b\u770b\u5230\u6211\u4eec\u7684LV\u4fe1\u606f\uff0c\u4f8b\u5982 <code>/dev/vgname/lvname</code>\uff0c \u6211\u4eec\u6bcf\u521b\u5efa\u4e00\u4e2aVG\uff0c\u5176\u4f1a\u5728<code>/dev</code>\u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a\u4ee5\u8be5VG\u540d\u5b57\u547d\u540d\u7684\u6587\u4ef6\u5939\uff0c\u5728\u8be5VG\u7684\u57fa\u7840\u4e0a\u521b\u5efa\u597dLV\u4ee5\u540e\uff0c\u6211\u4eec\u4f1a\u5728\u8fd9\u4e2aVG\u76ee\u5f55\u4e0b\u591a\u51fa\u4e00\u4e2a\u4ee5LV\u540d\u5b57\u547d\u540d\u7684\u903b\u8f91\u5377\u3002</p> <p>\u4e0b\u9762\u6211\u4eec\u6765\u5bf9\u6574\u4e2aLVM\u7684\u5de5\u4f5c\u539f\u7406\u8fdb\u884c\u4e00\u4e2a\u603b\u7ed3\uff1a</p> <ul> <li>(1)\u7269\u7406\u78c1\u76d8\u88ab\u683c\u5f0f\u5316\u4e3aPV\uff0c\u7a7a\u95f4\u88ab\u5212\u5206\u4e3a\u4e00\u4e2a\u4e2a\u7684PE</li> <li>(2)\u4e0d\u540c\u7684PV\u52a0\u5165\u5230\u540c\u4e00\u4e2aVG\u4e2d\uff0c\u4e0d\u540cPV\u7684PE\u5168\u90e8\u8fdb\u5165\u5230\u4e86VG\u7684PE\u6c60\u5185</li> <li>(3)LV\u57fa\u4e8ePE\u521b\u5efa\uff0c\u5927\u5c0f\u4e3aPE\u7684\u6574\u6570\u500d\uff0c\u7ec4\u6210LV\u7684PE\u53ef\u80fd\u6765\u81ea\u4e0d\u540c\u7684\u7269\u7406\u78c1\u76d8</li> <li>(4)LV\u73b0\u5728\u5c31\u76f4\u63a5\u53ef\u4ee5\u683c\u5f0f\u5316\u540e\u6302\u8f7d\u4f7f\u7528\u4e86</li> <li>(5)LV\u7684\u6269\u5145\u7f29\u51cf\u5b9e\u9645\u4e0a\u5c31\u662f\u589e\u52a0\u6216\u51cf\u5c11\u7ec4\u6210\u8be5LV\u7684PE\u6570\u91cf\uff0c\u5176\u8fc7\u7a0b\u4e0d\u4f1a\u4e22\u5931\u539f\u59cb\u6570\u636e</li> </ul> <p></p> <p>\u6211\u4eec\u770b\u5230\uff0c\u6211\u4eec\u8fd9\u91cc\u5982\u679c\u8981\u5bf9LV\u8fdb\u884c\u6269\u5145\uff0c\u76f4\u63a5\u52a0\u8fdb\u6765\u4e00\u5757sdc\u786c\u76d8\uff0c\u7136\u540e\u5c06\u5176\u683c\u5f0f\u5316\u6210PE\uff0c\u7136\u540e\u5c06\u8be5PV\u52a0\u5165\u5230\u4e86VG\u5f53\u4e2d\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0LV\u4e2dPE\u7684\u6570\u91cf\u6765\u52a8\u6001\u7684\u5bf9LV\u8fdb\u884c\u6269\u5145\u4e86\uff0c\u53ea\u8981\u6211\u4eec\u7684LV\u7684\u5927\u5c0f\u4e0d\u8981\u8d85\u8fc7\u6211\u4eecVG\u7a7a\u4f59\u7a7a\u95f4\u7684\u5927\u5c0f\u5c31\u884c\u4e86\uff01\uff01</p>"},{"location":"Linux-Performance/","title":"Linux Performance","text":""},{"location":"Linux-Performance/#linux-performance","title":"Linux Performance","text":"<ul> <li>\u539f\u6587</li> </ul>"},{"location":"Linux-Performance/#linux_observability_tools","title":"linux_observability_tools","text":""},{"location":"Linux-Performance/#linux_benchmarking_tools","title":"linux_benchmarking_tools","text":""},{"location":"Linux-Performance/#linux_tuning_tools","title":"linux_tuning_tools","text":""},{"location":"Linux-Performance/#linux_static_tools","title":"linux_static_tools","text":""},{"location":"Linux-Performance/#linux_observability_sar","title":"linux_observability_sar","text":""},{"location":"Linux-Performance/#perf-tools_2016","title":"perf-tools_2016","text":""},{"location":"Linux-Performance/#bcc_tracing_tools","title":"bcc_tracing_tools","text":""},{"location":"Linux-shell-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6-%E9%80%BB%E8%BE%91%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%A6%E8%A7%A3/","title":"Linux shell \u903b\u8f91\u8fd0\u7b97\u7b26\u3001\u903b\u8f91\u8868\u8fbe\u5f0f\u8be6\u89e3","text":"<ul> <li>Google \u5f00\u6e90\u9879\u76ee\u98ce\u683c\u6307\u5357</li> <li>https://zh-google-styleguide.readthedocs.io/en/latest/google-shell-styleguide/contents/</li> </ul>"},{"location":"Linux-shell-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6-%E9%80%BB%E8%BE%91%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%A6%E8%A7%A3/#shell","title":"shell\u7684\u903b\u8f91\u8fd0\u7b97\u7b26 \u6d89\u53ca\u6709\u4ee5\u4e0b\u51e0\u79cd\u7c7b\u578b\uff0c\u56e0\u6b64\u53ea\u8981\u9002\u5f53\u9009\u62e9\uff0c\u53ef\u4ee5\u89e3\u51b3\u6211\u4eec\u5f88\u591a\u590d\u6742\u7684\u5224\u65ad\uff0c\u8fbe\u5230\u4e8b\u534a\u529f\u500d\u6548\u679c\u3002","text":""},{"location":"Linux-shell-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6-%E9%80%BB%E8%BE%91%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%A6%E8%A7%A3/#_1","title":"\u4e00\u3001\u903b\u8f91\u8fd0\u7b97\u7b26","text":""},{"location":"Linux-shell-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6-%E9%80%BB%E8%BE%91%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%A6%E8%A7%A3/#1","title":"1\u3001\u903b\u8f91\u5377\u6807\u8868\u793a\u610f\u601d","text":"<ol> <li>\u5173\u4e8e\u6863\u6848\u4e0e\u76ee\u5f55\u7684\u4fa6\u6d4b\u903b\u8f91\u5377\u6807 <pre><code>    -f \u5e38\u7528\uff01\u4fa6\u6d4b\u300e\u6863\u6848\u300f\u662f\u5426\u5b58\u5728 eg: if [ -f filename ]\n\n    -d \u5e38\u7528\uff01\u4fa6\u6d4b\u300e\u76ee\u5f55\u300f\u662f\u5426\u5b58\u5728\n\n    -b \u4fa6\u6d4b\u662f\u5426\u4e3a\u4e00\u4e2a\u300e block \u6863\u6848\u300f\n\n    -c \u4fa6\u6d4b\u662f\u5426\u4e3a\u4e00\u4e2a\u300e character \u6863\u6848\u300f\n\n    -S \u4fa6\u6d4b\u662f\u5426\u4e3a\u4e00\u4e2a\u300e socket \u6807\u7b7e\u6863\u6848\u300f\n\n    -L \u4fa6\u6d4b\u662f\u5426\u4e3a\u4e00\u4e2a\u300e symbolic link \u7684\u6863\u6848\u300f\n\n    -e \u4fa6\u6d4b\u300e\u67d0\u4e2a\u4e1c\u897f\u300f\u662f\u5426\u5b58\u5728\uff01\n</code></pre></li> <li>\u5173\u4e8e\u7a0b\u5e8f\u7684\u903b\u8f91\u5377\u6807 <pre><code>    -G \u4fa6\u6d4b\u662f\u5426\u7531 GID \u6240\u6267\u884c\u7684\u7a0b\u5e8f\u6240\u62e5\u6709\n\n    -O \u4fa6\u6d4b\u662f\u5426\u7531 UID \u6240\u6267\u884c\u7684\u7a0b\u5e8f\u6240\u62e5\u6709\n\n    -p \u4fa6\u6d4b\u662f\u5426\u4e3a\u7a0b\u5e8f\u95f4\u4f20\u9001\u4fe1\u606f\u7684 name pipe \u6216\u662f FIFO \uff08\u8001\u5b9e\u8bf4\uff0c\u8fd9\u4e2a\u4e0d\u592a\u61c2\uff01\uff09\n</code></pre></li> <li>\u5173\u4e8e\u6863\u6848\u7684\u5c5e\u6027\u4fa6\u6d4b <pre><code>    -r \u4fa6\u6d4b\u662f\u5426\u4e3a\u53ef\u8bfb\u7684\u5c5e\u6027\n\n    -w \u4fa6\u6d4b\u662f\u5426\u4e3a\u53ef\u4ee5\u5199\u5165\u7684\u5c5e\u6027\n\n    -x \u4fa6\u6d4b\u662f\u5426\u4e3a\u53ef\u6267\u884c\u7684\u5c5e\u6027\n\n    -s \u4fa6\u6d4b\u662f\u5426\u4e3a\u300e\u975e\u7a7a\u767d\u6863\u6848\u300f\n\n    -u \u4fa6\u6d4b\u662f\u5426\u5177\u6709\u300e SUID \u300f\u7684\u5c5e\u6027\n\n    -g \u4fa6\u6d4b\u662f\u5426\u5177\u6709\u300e SGID \u300f\u7684\u5c5e\u6027\n\n    -k \u4fa6\u6d4b\u662f\u5426\u5177\u6709\u300e sticky bit \u300f\u7684\u5c5e\u6027\n</code></pre></li> <li>\u4e24\u4e2a\u6863\u6848\u4e4b\u95f4\u7684\u5224\u65ad\u4e0e\u6bd4\u8f83 \uff1b\u4f8b\u5982[ test file1 -nt file2 ] <pre><code>    -nt \u7b2c\u4e00\u4e2a\u6863\u6848\u6bd4\u7b2c\u4e8c\u4e2a\u6863\u6848\u65b0\n\n    -ot \u7b2c\u4e00\u4e2a\u6863\u6848\u6bd4\u7b2c\u4e8c\u4e2a\u6863\u6848\u65e7\n\n    -ef \u7b2c\u4e00\u4e2a\u6863\u6848\u4e0e\u7b2c\u4e8c\u4e2a\u6863\u6848\u4e3a\u540c\u4e00\u4e2a\u6863\u6848\uff08 link \u4e4b\u7c7b\u7684\u6863\u6848\uff09\n</code></pre></li> <li>\u903b\u8f91\u7684\u300e\u548c(and)\u300f\u300e\u6216(or)\u300f <pre><code>    &amp;&amp; \u903b\u8f91\u7684 AND \u7684\u610f\u601d\n\n    || \u903b\u8f91\u7684 OR \u7684\u610f\u601d\n</code></pre></li> </ol>"},{"location":"Linux-shell-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6-%E9%80%BB%E8%BE%91%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%A6%E8%A7%A3/#2","title":"2\u3001\u8fd0\u7b97\u7b26\u53f7 \u4ee3\u8868\u610f\u4e49","text":"<pre><code>=   \u7b49\u4e8e \u5e94\u7528\u4e8e\uff1a\u6574\u578b\u6216\u5b57\u7b26\u4e32\u6bd4\u8f83 \u5982\u679c\u5728[] \u4e2d\uff0c\u53ea\u80fd\u662f\u5b57\u7b26\u4e32\n\n!=  \u4e0d\u7b49\u4e8e \u5e94\u7528\u4e8e\uff1a\u6574\u578b\u6216\u5b57\u7b26\u4e32\u6bd4\u8f83 \u5982\u679c\u5728[] \u4e2d\uff0c\u53ea\u80fd\u662f\u5b57\u7b26\u4e32\n\n&lt;   \u5c0f\u4e8e \u5e94\u7528\u4e8e\uff1a\u6574\u578b\u6bd4\u8f83 \u5728[] \u4e2d\uff0c\u4e0d\u80fd\u4f7f\u7528 \u8868\u793a\u5b57\u7b26\u4e32\n\n&gt;   \u5927\u4e8e \u5e94\u7528\u4e8e\uff1a\u6574\u578b\u6bd4\u8f83 \u5728[] \u4e2d\uff0c\u4e0d\u80fd\u4f7f\u7528 \u8868\u793a\u5b57\u7b26\u4e32\n\n-eq \u7b49\u4e8e \u5e94\u7528\u4e8e\uff1a\u6574\u578b\u6bd4\u8f83\n\n-ne \u4e0d\u7b49\u4e8e \u5e94\u7528\u4e8e\uff1a\u6574\u578b\u6bd4\u8f83\n\n-lt \u5c0f\u4e8e \u5e94\u7528\u4e8e\uff1a\u6574\u578b\u6bd4\u8f83\n\n-gt \u5927\u4e8e \u5e94\u7528\u4e8e\uff1a\u6574\u578b\u6bd4\u8f83\n\n-le \u5c0f\u4e8e\u6216\u7b49\u4e8e \u5e94\u7528\u4e8e\uff1a\u6574\u578b\u6bd4\u8f83\n\n-ge \u5927\u4e8e\u6216\u7b49\u4e8e \u5e94\u7528\u4e8e\uff1a\u6574\u578b\u6bd4\u8f83\n\n-a  \u53cc\u65b9\u90fd\u6210\u7acb\uff08and\uff09 \u903b\u8f91\u8868\u8fbe\u5f0f \u2013a \u903b\u8f91\u8868\u8fbe\u5f0f\n\n-o  \u5355\u65b9\u6210\u7acb\uff08or\uff09 \u903b\u8f91\u8868\u8fbe\u5f0f \u2013o \u903b\u8f91\u8868\u8fbe\u5f0f\n\n-z  \u7a7a\u5b57\u7b26\u4e32\n\n-n  \u975e\u7a7a\u5b57\u7b26\u4e32\n</code></pre>"},{"location":"Linux-shell-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6-%E9%80%BB%E8%BE%91%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%A6%E8%A7%A3/#_2","title":"\u4e8c\u3001\u903b\u8f91\u8868\u8fbe\u5f0f","text":""},{"location":"Linux-shell-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6-%E9%80%BB%E8%BE%91%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%A6%E8%A7%A3/#1-test","title":"1. test \u547d\u4ee4","text":"<ul> <li>\u4f7f\u7528\u65b9\u6cd5\uff1atest EXPRESSION <pre><code>  [root@localhost ~]# test 1 = 1 &amp;&amp; echo 'ok'\n  ok\n\n  [root@localhost ~]# test -d /etc/ &amp;&amp; echo 'ok'\n  ok\n\n  [root@localhost ~]# test 1 -eq 1 &amp;&amp; echo 'ok'\n  ok\n\n  [root@localhost ~]# if test 1 = 1 ; then echo 'ok'; fi\n  ok\n</code></pre></li> </ul>"},{"location":"Linux-shell-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6-%E9%80%BB%E8%BE%91%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%A6%E8%A7%A3/#_3","title":"\u6ce8\u610f\uff1a\u6240\u6709\u5b57\u7b26 \u4e0e\u903b\u8f91\u8fd0\u7b97\u7b26\u76f4\u63a5\u7528\u201c\u7a7a\u683c\u201d\u5206\u5f00\uff0c\u4e0d\u80fd\u8fde\u5230\u4e00\u8d77\u3002","text":""},{"location":"Linux-shell-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6-%E9%80%BB%E8%BE%91%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%A6%E8%A7%A3/#2_1","title":"2. \u7cbe\u7b80\u8868\u8fbe\u5f0f","text":"<ul> <li>[] \u8868\u8fbe\u5f0f <pre><code>  [root@localhost ~]# [ 1 -eq 1 ] &amp;&amp; echo 'ok'\n  ok\n\n  [root@localhost ~]# [ 2 &lt; 1 ] &amp;&amp; echo 'ok'\n  -bash: 2: No such file or directory\n\n  [root@localhost ~]# [ 2 &lt; 1 ] &amp;&amp; echo 'ok'\n\n  [root@localhost ~]# [ 2 -gt 1 -a 3 -lt 4 ] &amp;&amp; echo 'ok'\n  ok\n\n  [root@localhost ~]# [ 2 -gt 1 &amp;&amp; 3 -lt 4 ] &amp;&amp; echo 'ok'\n  -bash: [: missing `]'\n</code></pre></li> </ul>"},{"location":"Linux-shell-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6-%E9%80%BB%E8%BE%91%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%A6%E8%A7%A3/#acill-aand-oor","title":"\u6ce8\u610f\uff1a\u5728<code>[]</code>\u8868\u8fbe\u5f0f\u4e2d\uff0c\u5e38\u89c1\u7684<code>&gt;,&lt;</code>\u9700\u8981\u52a0\u8f6c\u4e49\u5b57\u7b26\uff0c\u8868\u793a\u5b57\u7b26\u4e32\u5927\u5c0f\u6bd4\u8f83\uff0c\u4ee5acill\u7801 \u4f4d\u7f6e\u4f5c\u4e3a\u6bd4\u8f83\u3002 \u4e0d\u76f4\u63a5\u652f\u6301<code>&lt;&gt;</code>\u8fd0\u7b97\u7b26\uff0c\u8fd8\u6709\u903b\u8f91\u8fd0\u7b97\u7b26<code>||</code> <code>&amp;&amp;</code> \u5b83\u9700\u8981\u7528<code>-a[and]</code> <code>\u2013o[or]</code>\u8868\u793a","text":"<ul> <li>[[]] \u8868\u8fbe\u5f0f <pre><code>  [root@localhost ~]# [ 1 -eq 1 ] &amp;&amp; echo 'ok'\n  ok\n\n  [root@localhost ~]$ [[ 2 &lt; 3 ]] &amp;&amp; echo 'ok'\n  ok\n\n  [root@localhost ~]$ [[ 2 &lt; 3 &amp;&amp; 4 &gt; 5 ]] &amp;&amp; echo 'ok'\n  ok\n</code></pre></li> </ul>"},{"location":"Linux-shell-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6-%E9%80%BB%E8%BE%91%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%A6%E8%A7%A3/#_4","title":"\u6ce8\u610f\uff1a<code>[[]]</code> \u8fd0\u7b97\u7b26\u53ea\u662f<code>[]</code>\u8fd0\u7b97\u7b26\u7684\u6269\u5145\u3002\u80fd\u591f\u652f\u6301<code>&lt;,&gt;</code>\u7b26\u53f7\u8fd0\u7b97\u4e0d\u9700\u8981\u8f6c\u4e49\u7b26\uff0c\u5b83\u8fd8\u662f\u4ee5\u5b57\u7b26\u4e32\u6bd4\u8f83\u5927\u5c0f\u3002\u91cc\u9762\u652f\u6301\u903b\u8f91\u8fd0\u7b97\u7b26\uff1a<code>||</code> <code>&amp;&amp;</code>","text":""},{"location":"Linux-shell-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6-%E9%80%BB%E8%BE%91%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%A6%E8%A7%A3/#3","title":"3. \u6027\u80fd\u6bd4\u8f83","text":""},{"location":"Linux-shell-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6-%E9%80%BB%E8%BE%91%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%A6%E8%A7%A3/#bashtestif-thenabs","title":"bash\u7684\u6761\u4ef6\u8868\u8fbe\u5f0f\u4e2d\u6709\u4e09\u4e2a\u51e0\u4e4e\u7b49\u6548\u7684\u7b26\u53f7\u548c\u547d\u4ee4\uff1a<code>test</code>\uff0c<code>[]</code>\u548c<code>[[]]</code>\u3002\u901a\u5e38\uff0c\u5927\u5bb6\u4e60\u60ef\u7528<code>if [];then</code>\u8fd9\u6837\u7684\u5f62\u5f0f\u3002\u800c<code>[[]]</code>\u7684\u51fa\u73b0\uff0c\u6839\u636eABS\u6240\u8bf4\uff0c\u662f\u4e3a\u4e86\u517c\u5bb9<code>&gt;&lt;</code>\u4e4b\u7c7b\u7684\u8fd0\u7b97\u7b26\u3002\u4ee5\u4e0b\u662f\u6bd4\u8f83\u5b83\u4eec\u6027\u80fd\uff0c\u53d1\u73b0<code>[[]]</code>\u662f\u6700\u5feb\u7684\u3002","text":"<pre><code>  $ time (for m in {1..100000}; do test -d .;done;)\n  real 0m0.658s\n  user 0m0.558s\n  sys 0m0.100s\n\n  $ time (for m in {1..100000}; do [ -d . ];done;)\n  real 0m0.609s\n  user 0m0.524s\n  sys 0m0.085s\n\n  $ time (for m in {1..100000}; do [[ -d . ]];done;)\n  real 0m0.311s\n  user 0m0.275s\n  sys 0m0.036s\n</code></pre>"},{"location":"Linux-shell-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6-%E9%80%BB%E8%BE%91%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%A6%E8%A7%A3/#bashsh","title":"\u4e0d\u8003\u8651\u5bf9\u4f4e\u7248\u672cbash\u548c\u5bf9sh\u7684\u517c\u5bb9\u7684\u60c5\u51b5\u4e0b\uff0c\u7528<code>[[]]</code>\u662f\u517c\u5bb9\u6027\u5f3a\uff0c\u800c\u4e14\u6027\u80fd\u6bd4\u8f83\u5feb\uff0c\u5728\u505a\u6761\u4ef6\u8fd0\u7b97\u65f6\u5019\uff0c\u53ef\u4ee5\u4f7f\u7528\u8be5\u8fd0\u7b97\u7b26","text":""},{"location":"MB-MiB%E7%9A%84%E5%8C%BA%E5%88%AB/","title":"MB_MiB\u7684\u533a\u522b","text":"<ul> <li>\u539f\u6587</li> </ul> <p>\u8bf4\u5b9e\u8bdd\u8fd9\u51e0\u4e2a\u5355\u4f4d\u5f88\u591a\u4eba\u4f1a\u5f04\u6df7\uff0c\u5148\u653e\u4e0a\u76f4\u89c2\u7684\u5bf9\u5e94\u8868\uff1a</p> <p>1KB = 1,000 Byte 1MB = 1,000 KB 1GB = 1,000,000 KB 1TB = 1,000,000,000 KB</p> <p>1KiB = 1,024Byte 1MiB = 1,024KiB 1GiB = 1,024MiB = 1,048,576 KiB 1TiB = 1,024GiB = 1,073,741,824 KiB</p> <p>\u5176\u4e2d\uff0cKiB\u662fkilo binary byte\u7684\u7f29\u5199\uff0c\u6307\u7684\u662f\u5343\u4f4d\u4e8c\u8fdb\u5236\u5b57\u8282</p> <p>\u800cKB\u662fkilobyte\u7684\u7f29\u5199\uff0c\u6307\u7684\u662f\u5343\u5b57\u8282</p> <p>\u4e8c\u8005\u7684\u533a\u522b\u5c31\u5728\u4e8e\u5f53\u4e2d\u7684\u4e8c\u8fdb\u5236\u3002\u6211\u60f3\u8bf4\u9053\u8fd9\u91cc\u5927\u90e8\u5206\u4eba\u5e94\u8be5\u90fd\u660e\u767d\u4e3a\u5565KiB\u662f\u6309\u71671024\u6362\u7b97\u7684\u4e86\u3002\u8fd8\u8bb0\u5f97\u90a3\u4e2a\u7b11\u8bdd\u4e48\uff0cA\u95ee\u7a0b\u5e8f\u5458B\u501f\u94b1\uff1a</p> <p>A\uff1aB\uff0c\u501f\u6211\u70b9\u94b1\u5427\uff01</p> <p>B\uff1a\u591a\u5c11\uff1f A\uff1a1000\u884c\u4e0d\uff1f</p> <p>B\uff1a\u51d1\u4e2a\u6574\uff0c\u7ed9\u4f601024\u5427\uff01</p> <p>\u518d\u8bf4\u6df1\u5165\u4e00\u70b9\uff0c\u8fd9\u5176\u4e2d\u5176\u5b9e\u7275\u626f\u4e86\u4e24\u79cd\u6807\u51c6\uff1a</p> <p>\u56fd\u9645\u5355\u4f4d\u5236 SI \u5236\u5b9a\u7684\u5341\u8fdb\u5236\u6807\u51c6\u548c \u56fd\u9645\u7535\u5de5\u59d4\u5458\u4f1a \u5236\u5b9a\u7684\u4e8c\u8fdb\u5236\u6807\u51c6\uff0c\u4e5f\u5c31\u662f\u901a\u5e38\u6240\u8bf4\u7684SI\u548cIEC\u6807\u51c6\u3002</p> <p>============================================================= \u770b\u4e86\u533f\u540d\u7528\u6237\u7684\u56de\u590d\uff0c\u51b3\u5b9a\u6765\u8865\u5145\u4e00\u4e9b\u4e1c\u897f\u3002//\u8bdd\u8bf4\u8fd9\u79cd\u95ee\u9898\u4e3a\u5565\u8981\u533f\u540d\u5440\u6454\uff01</p> <p>\u9996\u51481KB=1000B\u7edd\u5bf9\u4e0d\u662f\u786c\u76d8\u5382\u5546\u53d1\u660e\u7684\uff0c\u4ed6\u4eec\u53ea\u662f\u5229\u7528\u8005\uff0c\u55ef\u55ef\u3002</p> <p>\u7136\u540e\uff0c\u5173\u4e8e\u5927B\u548c\u5c0fb\uff0c\u533f\u540d\u7528\u6237\u89e3\u91ca\u7684\u975e\u5e38\u597d\u3002\u987a\u4fbf\u4e00\u8bf4\u4e3a\u5565\u7f51\u7edc\u4f20\u8f93\u8981\u4f7f\u7528\u5c0fb\uff0c\u56e0\u4e3a\u5728\u7f51\u7edc\u4f20\u8f93\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4f20\u8f93\u7684\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u4e2a\u4e8c\u8fdb\u5236\u6570\uff0c\u4f3c\u4e4e\u53ef\u4ee5\u4fd7\u79f0\u4e3a\u6bd4\u7279\u6d41\u3002\u90a3\u4e48\uff0c\u5728\u4f20\u8f93\u4e8c\u8fdb\u5236\u6570\u7684\u65f6\u5019\uff0c\u6211\u4eec\u663e\u7136\u662f\u4e0d\u7ba1\u4f60\u8fd9\u662f\u4ec0\u4e48\u5b57\uff0c\u7528\u7684\u4ec0\u4e48\u7f16\u7801\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8861\u91cf\u4f20\u8f93\u901f\u5ea6\u7684\u6700\u76f4\u63a5\u7684\u91cf\u5c31\u662f\u6bcf\u79d2\u949f\u4f20\u8f93\u4e86\u591a\u5c11\u4e86\u4e8c\u8fdb\u5236\u4f4d\uff0c\u6240\u4ee5\u5728\u8ba1\u7b97\u673a\u7f51\u7edc\u4e2d\uff0c\u6211\u4eec\u666e\u904d\u4f7f\u7528\u5c0fb\u4f5c\u4e3a\u5355\u4f4d\u3002</p> <p>\u7136\u540e\u5bf9\u4e8eta\u63d0\u51fa\u7684Windows\u7684Size\u7684\u95ee\u9898\uff0c\u8fd9\u4e2a\u5f88\u597d\u89e3\u91ca\u3002 \u9996\u5148\uff0c\u7b2c\u4e00\u4e2aSize\u663e\u7136\u662f\u7ecf\u8fc7\u820e\u5165\u7684\u3002\u8bf7\u4e0d\u8981\u7528115\u53bb\u505a\u4e58\u6cd5\uff0c\u76f4\u63a5\u7528118774\u53bb\u96641024\u5c31\u80fd\u5f97\u5230\u7ed3\u679c\uff1a115.990234375\u3002\u5173\u4e8e\u820d\u5165\u7a76\u7adf\u662f\u4ec0\u4e48\u89c4\u5219\uff0c\u6211\u8fd8\u5728\u5bfb\u627e\u76f8\u5173\u7684\u6587\u6863\uff0c\u5c31\u76ee\u524d\u6765\u770b\u4f3c\u4e4e\u662f\u76f4\u63a5\u820d\u53bb\u5c0f\u6570\u90e8\u5206\u3002</p> <p>\u7136\u540e\uff0c\u7b2c\u4e8c\u4e2aSize on Disk\u5c31\u66f4\u597d\u89e3\u91ca\u4e86\u3002\u5982\u679c\u4f60\u7528118784\u96641024\u4f1a\u53d1\u73b0\u8bf6\uff0c\u6b63\u597d\u6574\u9664\uff01\u7ed3\u679c\u5c31\u662f116\uff01\u8fd9\u662f\u4e3a\u5565\u5462\uff1f\u663e\u7136\u8fd9\u8ddf\u6587\u4ef6\u5728\u78c1\u76d8\u4e0a\u5b58\u50a8\u7684\u6700\u5c0f\u5355\u4f4d\u6709\u5173\u3002\u5728NTFS\u5206\u533a\u4e0a\uff0c\u6587\u4ef6\u5b58\u50a8\u7684\u6700\u5c0f\u533a\u5757\u662f\u7c07\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u9ed8\u8ba4\u7684\u7c07\u5927\u5c0f\u4e3a4K\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e0d\u8bba\u4f60\u7684\u6587\u4ef6\u6709\u591a\u5c0f\uff0c\u5c31\u7b97\u4f60\u7684\u6587\u4ef6\u53ea\u67091b\uff0c\u5bf9\u4e0d\u8d77\uff0c\u6211\u8fd8\u662f\u8981\u5360\u7528\u4e00\u4e2a4K\u5927\u5c0f\u7684\u7c07\u3002\u4ed4\u7ec6\u4e00\u7b97\u4f60\u662f\u4e0d\u662f\u53d1\u73b0116/4\u521a\u597d\u6574\u9664\uff0c\u7b49\u4e8e29\u5462\uff1f\u8bf4\u660e\u4f60\u7684\u7cfb\u7edf\u5f88\u53ef\u80fd\u4e5f\u662f4K\u4e3a\u4e00\u4e2a\u7c07\uff0c\u7136\u540e\u8be5\u6587\u4ef6\u5360\u7528\u4e86\u4f6029\u4e2a\u7c07\u3002</p> <p>\u53c2\u8003[\u77e5\u8b58] KB KiB MB MiB GB GiB TB TiB \u55ae\u4f4d\u50bb\u50bb\u5206\u4e0d\u6e05\u695a?</p> <p>\u5343\u5b57\u8282Kibibyte</p> <p>KB, MB, GB\u4e2d\u7684K, M, G\u4ee3\u8868\u5b57\u8282\u7684\u6570\u91cf\uff0c\u81ea\u5df1\u4e5f\u5e38\u6df7\u6dc6\uff0c\u603b\u7ed3\u5982\u4e0b\uff1a</p> <ol> <li>K\u5355\u72ec\u51fa\u73b0\u65f6\uff0c\u4ee3\u88681000 \u6216 1024</li> <li>K\u4e0eKi\u4e00\u8d77\u51fa\u73b0\u65f6\uff0cK\u4ee3\u88681000\uff0cKi\u4ee3\u88681024</li> <li>K\u4e0ek\u4e00\u8d77\u51fa\u73b0\u65f6\uff0cK\u4ee3\u88681024\uff0ck\u4ee3\u88681000</li> </ol> <p>K\u548cKi\u4e3a\u4f8b\uff1a</p> <pre><code>1K=10^3\n1M=10^3K=10^6\n1G=10^3M=10^9\nKi=2^10\nMi=2^10Ki=2^20\nGi=2^10Mi=2^30\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","title":"1000\u884c MySQL \u5b66\u4e60\u7b14\u8bb0\uff0c\u4e0d\u6015\u4f60\u4e0d\u4f1a\uff0c\u5c31\u6015\u4f60\u4e0d\u5b66\uff01","text":""},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#1000-mysql","title":"1000\u884c MySQL \u5b66\u4e60\u7b14\u8bb0\uff0c\u4e0d\u6015\u4f60\u4e0d\u4f1a\uff0c\u5c31\u6015\u4f60\u4e0d\u5b66\uff01","text":"<ul> <li>\u539f\u6587</li> </ul>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_1","title":"\u8fde\u63a5\u4e0e\u65ad\u5f00\u670d\u52a1\u5668","text":"<pre><code>mysql -h \u5730\u5740 -P \u7aef\u53e3 -u \u7528\u6237\u540d -p \u5bc6\u7801\n\nSHOW PROCESSLIST -- \u663e\u793a\u54ea\u4e9b\u7ebf\u7a0b\u6b63\u5728\u8fd0\u884c\nSHOW VARIABLES -- \u663e\u793a\u7cfb\u7edf\u53d8\u91cf\u4fe1\u606f\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_2","title":"\u6570\u636e\u5e93\u64cd\u4f5c","text":"<pre><code>-- \u67e5\u770b\u5f53\u524d\u6570\u636e\u5e93\n    SELECT DATABASE();\n-- \u663e\u793a\u5f53\u524d\u65f6\u95f4\u3001\u7528\u6237\u540d\u3001\u6570\u636e\u5e93\u7248\u672c\n    SELECT now(), user(), version();\n-- \u521b\u5efa\u5e93\n    CREATE DATABASE[ IF NOT EXISTS] \u6570\u636e\u5e93\u540d \u6570\u636e\u5e93\u9009\u9879\n    \u6570\u636e\u5e93\u9009\u9879\uff1a\n        CHARACTER SET charset_name\n        COLLATE collation_name\n-- \u67e5\u770b\u5df2\u6709\u5e93\n    SHOW DATABASES[ LIKE  PATTERN ]\n-- \u67e5\u770b\u5f53\u524d\u5e93\u4fe1\u606f\n    SHOW CREATE DATABASE \u6570\u636e\u5e93\u540d\n-- \u4fee\u6539\u5e93\u7684\u9009\u9879\u4fe1\u606f\n    ALTER DATABASE \u5e93\u540d \u9009\u9879\u4fe1\u606f\n-- \u5220\u9664\u5e93\n    DROP DATABASE[ IF EXISTS] \u6570\u636e\u5e93\u540d\n        \u540c\u65f6\u5220\u9664\u8be5\u6570\u636e\u5e93\u76f8\u5173\u7684\u76ee\u5f55\u53ca\u5176\u76ee\u5f55\u5185\u5bb9\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_3","title":"\u8868\u7684\u64cd\u4f5c","text":"<pre><code>-- \u521b\u5efa\u8868\n    CREATE [TEMPORARY] TABLE[ IF NOT EXISTS] [\u5e93\u540d.]\u8868\u540d ( \u8868\u7684\u7ed3\u6784\u5b9a\u4e49 )[ \u8868\u9009\u9879]\n        \u6bcf\u4e2a\u5b57\u6bb5\u5fc5\u987b\u6709\u6570\u636e\u7c7b\u578b\n        \u6700\u540e\u4e00\u4e2a\u5b57\u6bb5\u540e\u4e0d\u80fd\u6709\u9017\u53f7\n        TEMPORARY \u4e34\u65f6\u8868\uff0c\u4f1a\u8bdd\u7ed3\u675f\u65f6\u8868\u81ea\u52a8\u6d88\u5931\n        \u5bf9\u4e8e\u5b57\u6bb5\u7684\u5b9a\u4e49\uff1a\n            \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [NOT NULL | NULL] [DEFAULT default_value] [AUTO_INCREMENT] [UNIQUE [KEY] | [PRIMARY] KEY] [COMMENT  string ]\n-- \u8868\u9009\u9879\n    -- \u5b57\u7b26\u96c6\n        CHARSET = charset_name\n        \u5982\u679c\u8868\u6ca1\u6709\u8bbe\u5b9a\uff0c\u5219\u4f7f\u7528\u6570\u636e\u5e93\u5b57\u7b26\u96c6\n    -- \u5b58\u50a8\u5f15\u64ce\n        ENGINE = engine_name\n        \u8868\u5728\u7ba1\u7406\u6570\u636e\u65f6\u91c7\u7528\u7684\u4e0d\u540c\u7684\u6570\u636e\u7ed3\u6784\uff0c\u7ed3\u6784\u4e0d\u540c\u4f1a\u5bfc\u81f4\u5904\u7406\u65b9\u5f0f\u3001\u63d0\u4f9b\u7684\u7279\u6027\u64cd\u4f5c\u7b49\u4e0d\u540c\n        \u5e38\u89c1\u7684\u5f15\u64ce\uff1aInnoDB MyISAM Memory/Heap BDB Merge Example CSV MaxDB Archive\n        \u4e0d\u540c\u7684\u5f15\u64ce\u5728\u4fdd\u5b58\u8868\u7684\u7ed3\u6784\u548c\u6570\u636e\u65f6\u91c7\u7528\u4e0d\u540c\u7684\u65b9\u5f0f\n        MyISAM\u8868\u6587\u4ef6\u542b\u4e49\uff1a.frm\u8868\u5b9a\u4e49\uff0c.MYD\u8868\u6570\u636e\uff0c.MYI\u8868\u7d22\u5f15\n        InnoDB\u8868\u6587\u4ef6\u542b\u4e49\uff1a.frm\u8868\u5b9a\u4e49\uff0c\u8868\u7a7a\u95f4\u6570\u636e\u548c\u65e5\u5fd7\u6587\u4ef6\n        SHOW ENGINES -- \u663e\u793a\u5b58\u50a8\u5f15\u64ce\u7684\u72b6\u6001\u4fe1\u606f\n        SHOW ENGINE \u5f15\u64ce\u540d {LOGS|STATUS} -- \u663e\u793a\u5b58\u50a8\u5f15\u64ce\u7684\u65e5\u5fd7\u6216\u72b6\u6001\u4fe1\u606f\n    -- \u81ea\u589e\u8d77\u59cb\u6570\n        AUTO_INCREMENT = \u884c\u6570\n    -- \u6570\u636e\u6587\u4ef6\u76ee\u5f55\n        DATA DIRECTORY =  \u76ee\u5f55 \n    -- \u7d22\u5f15\u6587\u4ef6\u76ee\u5f55\n        INDEX DIRECTORY =  \u76ee\u5f55 \n    -- \u8868\u6ce8\u91ca\n        COMMENT =  string \n    -- \u5206\u533a\u9009\u9879\n        PARTITION BY ... (\u8be6\u7ec6\u89c1\u624b\u518c)\n-- \u67e5\u770b\u6240\u6709\u8868\n    SHOW TABLES[ LIKE  pattern ]\n    SHOW TABLES FROM \u8868\u540d\n-- \u67e5\u770b\u8868\u673a\u6784\n    SHOW CREATE TABLE \u8868\u540d \uff08\u4fe1\u606f\u66f4\u8be6\u7ec6\uff09\n    DESC \u8868\u540d / DESCRIBE \u8868\u540d / EXPLAIN \u8868\u540d / SHOW COLUMNS FROM \u8868\u540d [LIKE  PATTERN ]\n    SHOW TABLE STATUS [FROM db_name] [LIKE  pattern ]\n-- \u4fee\u6539\u8868\n    -- \u4fee\u6539\u8868\u672c\u8eab\u7684\u9009\u9879\n        ALTER TABLE \u8868\u540d \u8868\u7684\u9009\u9879\n        eg: ALTER TABLE \u8868\u540d ENGINE=MYISAM;\n    -- \u5bf9\u8868\u8fdb\u884c\u91cd\u547d\u540d\n        RENAME TABLE \u539f\u8868\u540d TO \u65b0\u8868\u540d\n        RENAME TABLE \u539f\u8868\u540d TO \u5e93\u540d.\u8868\u540d \uff08\u53ef\u5c06\u8868\u79fb\u52a8\u5230\u53e6\u4e00\u4e2a\u6570\u636e\u5e93\uff09\n        -- RENAME\u53ef\u4ee5\u4ea4\u6362\u4e24\u4e2a\u8868\u540d\n    -- \u4fee\u6539\u8868\u7684\u5b57\u6bb5\u673a\u6784\uff0813.1.2. ALTER TABLE\u8bed\u6cd5\uff09\n        ALTER TABLE \u8868\u540d \u64cd\u4f5c\u540d\n        -- \u64cd\u4f5c\u540d\n            ADD[ COLUMN] \u5b57\u6bb5\u5b9a\u4e49       -- \u589e\u52a0\u5b57\u6bb5\n                AFTER \u5b57\u6bb5\u540d          -- \u8868\u793a\u589e\u52a0\u5728\u8be5\u5b57\u6bb5\u540d\u540e\u9762\n                FIRST               -- \u8868\u793a\u589e\u52a0\u5728\u7b2c\u4e00\u4e2a\n            ADD PRIMARY KEY(\u5b57\u6bb5\u540d)   -- \u521b\u5efa\u4e3b\u952e\n            ADD UNIQUE [\u7d22\u5f15\u540d] (\u5b57\u6bb5\u540d)-- \u521b\u5efa\u552f\u4e00\u7d22\u5f15\n            ADD INDEX [\u7d22\u5f15\u540d] (\u5b57\u6bb5\u540d) -- \u521b\u5efa\u666e\u901a\u7d22\u5f15\n            DROP[ COLUMN] \u5b57\u6bb5\u540d      -- \u5220\u9664\u5b57\u6bb5\n            MODIFY[ COLUMN] \u5b57\u6bb5\u540d \u5b57\u6bb5\u5c5e\u6027     -- \u652f\u6301\u5bf9\u5b57\u6bb5\u5c5e\u6027\u8fdb\u884c\u4fee\u6539\uff0c\u4e0d\u80fd\u4fee\u6539\u5b57\u6bb5\u540d(\u6240\u6709\u539f\u6709\u5c5e\u6027\u4e5f\u9700\u5199\u4e0a)\n            CHANGE[ COLUMN] \u539f\u5b57\u6bb5\u540d \u65b0\u5b57\u6bb5\u540d \u5b57\u6bb5\u5c5e\u6027      -- \u652f\u6301\u5bf9\u5b57\u6bb5\u540d\u4fee\u6539\n            DROP PRIMARY KEY    -- \u5220\u9664\u4e3b\u952e(\u5220\u9664\u4e3b\u952e\u524d\u9700\u5220\u9664\u5176AUTO_INCREMENT\u5c5e\u6027)\n            DROP INDEX \u7d22\u5f15\u540d -- \u5220\u9664\u7d22\u5f15\n            DROP FOREIGN KEY \u5916\u952e    -- \u5220\u9664\u5916\u952e\n-- \u5220\u9664\u8868\n    DROP TABLE[ IF EXISTS] \u8868\u540d ...\n-- \u6e05\u7a7a\u8868\u6570\u636e\n    TRUNCATE [TABLE] \u8868\u540d\n-- \u590d\u5236\u8868\u7ed3\u6784\n    CREATE TABLE \u8868\u540d LIKE \u8981\u590d\u5236\u7684\u8868\u540d\n-- \u590d\u5236\u8868\u7ed3\u6784\u548c\u6570\u636e\n    CREATE TABLE \u8868\u540d [AS] SELECT * FROM \u8981\u590d\u5236\u7684\u8868\u540d\n-- \u68c0\u67e5\u8868\u662f\u5426\u6709\u9519\u8bef\n    CHECK TABLE tbl_name [, tbl_name] ... [option] ...\n-- \u4f18\u5316\u8868\n    OPTIMIZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ...\n-- \u4fee\u590d\u8868\n    REPAIR [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ... [QUICK] [EXTENDED] [USE_FRM]\n-- \u5206\u6790\u8868\n    ANALYZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ...\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_4","title":"\u6570\u636e\u64cd\u4f5c","text":"<pre><code>-- \u589e\n    INSERT [INTO] \u8868\u540d [(\u5b57\u6bb5\u5217\u8868)] VALUES (\u503c\u5217\u8868)[, (\u503c\u5217\u8868), ...]\n        -- \u5982\u679c\u8981\u63d2\u5165\u7684\u503c\u5217\u8868\u5305\u542b\u6240\u6709\u5b57\u6bb5\u5e76\u4e14\u987a\u5e8f\u4e00\u81f4\uff0c\u5219\u53ef\u4ee5\u7701\u7565\u5b57\u6bb5\u5217\u8868\u3002\n        -- \u53ef\u540c\u65f6\u63d2\u5165\u591a\u6761\u6570\u636e\u8bb0\u5f55\uff01\n        REPLACE \u4e0e INSERT \u5b8c\u5168\u4e00\u6837\uff0c\u53ef\u4e92\u6362\u3002\n    INSERT [INTO] \u8868\u540d SET \u5b57\u6bb5\u540d=\u503c[, \u5b57\u6bb5\u540d=\u503c, ...]\n-- \u67e5\n    SELECT \u5b57\u6bb5\u5217\u8868 FROM \u8868\u540d[ \u5176\u4ed6\u5b50\u53e5]\n        -- \u53ef\u6765\u81ea\u591a\u4e2a\u8868\u7684\u591a\u4e2a\u5b57\u6bb5\n        -- \u5176\u4ed6\u5b50\u53e5\u53ef\u4ee5\u4e0d\u4f7f\u7528\n        -- \u5b57\u6bb5\u5217\u8868\u53ef\u4ee5\u7528*\u4ee3\u66ff\uff0c\u8868\u793a\u6240\u6709\u5b57\u6bb5\n-- \u5220\n    DELETE FROM \u8868\u540d[ \u5220\u9664\u6761\u4ef6\u5b50\u53e5]\n        \u6ca1\u6709\u6761\u4ef6\u5b50\u53e5\uff0c\u5219\u4f1a\u5220\u9664\u5168\u90e8\n-- \u6539\n    UPDATE \u8868\u540d SET \u5b57\u6bb5\u540d=\u65b0\u503c[, \u5b57\u6bb5\u540d=\u65b0\u503c] [\u66f4\u65b0\u6761\u4ef6]\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_5","title":"\u5b57\u7b26\u96c6\u7f16\u7801","text":"<pre><code>-- MySQL\u3001\u6570\u636e\u5e93\u3001\u8868\u3001\u5b57\u6bb5\u5747\u53ef\u8bbe\u7f6e\u7f16\u7801\n-- \u6570\u636e\u7f16\u7801\u4e0e\u5ba2\u6237\u7aef\u7f16\u7801\u4e0d\u9700\u4e00\u81f4\nSHOW VARIABLES LIKE  character_set_%    -- \u67e5\u770b\u6240\u6709\u5b57\u7b26\u96c6\u7f16\u7801\u9879\n    character_set_client        \u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u53d1\u9001\u6570\u636e\u65f6\u4f7f\u7528\u7684\u7f16\u7801\n    character_set_results       \u670d\u52a1\u5668\u7aef\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u6240\u4f7f\u7528\u7684\u7f16\u7801\n    character_set_connection    \u8fde\u63a5\u5c42\u7f16\u7801\nSET \u53d8\u91cf\u540d = \u53d8\u91cf\u503c\n    SET character_set_client = gbk;\n    SET character_set_results = gbk;\n    SET character_set_connection = gbk;\nSET NAMES GBK;  -- \u76f8\u5f53\u4e8e\u5b8c\u6210\u4ee5\u4e0a\u4e09\u4e2a\u8bbe\u7f6e\n-- \u6821\u5bf9\u96c6\n    \u6821\u5bf9\u96c6\u7528\u4ee5\u6392\u5e8f\n    SHOW CHARACTER SET [LIKE  pattern ]/SHOW CHARSET [LIKE  pattern ]   \u67e5\u770b\u6240\u6709\u5b57\u7b26\u96c6\n    SHOW COLLATION [LIKE  pattern ]     \u67e5\u770b\u6240\u6709\u6821\u5bf9\u96c6\n    CHARSET \u5b57\u7b26\u96c6\u7f16\u7801     \u8bbe\u7f6e\u5b57\u7b26\u96c6\u7f16\u7801\n    COLLATE \u6821\u5bf9\u96c6\u7f16\u7801     \u8bbe\u7f6e\u6821\u5bf9\u96c6\u7f16\u7801\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_6","title":"\u6570\u636e\u7c7b\u578b\uff08\u5217\u7c7b\u578b\uff09","text":"<ul> <li>\u6570\u503c\u7c7b\u578b</li> </ul> <pre><code>-- a. \u6574\u578b ----------\n    \u7c7b\u578b         \u5b57\u8282     \u8303\u56f4\uff08\u6709\u7b26\u53f7\u4f4d\uff09\n    tinyint     1\u5b57\u8282    -128 ~ 127      \u65e0\u7b26\u53f7\u4f4d\uff1a0 ~ 255\n    smallint    2\u5b57\u8282    -32768 ~ 32767\n    mediumint   3\u5b57\u8282    -8388608 ~ 8388607\n    int         4\u5b57\u8282\n    bigint      8\u5b57\u8282\n    int(M)  M\u8868\u793a\u603b\u4f4d\u6570\n    - \u9ed8\u8ba4\u5b58\u5728\u7b26\u53f7\u4f4d\uff0cunsigned \u5c5e\u6027\u4fee\u6539\n    - \u663e\u793a\u5bbd\u5ea6\uff0c\u5982\u679c\u67d0\u4e2a\u6570\u4e0d\u591f\u5b9a\u4e49\u5b57\u6bb5\u65f6\u8bbe\u7f6e\u7684\u4f4d\u6570\uff0c\u5219\u524d\u9762\u4ee50\u8865\u586b\uff0czerofill \u5c5e\u6027\u4fee\u6539\n        \u4f8b\uff1aint(5)   \u63d2\u5165\u4e00\u4e2a\u6570 123 \uff0c\u8865\u586b\u540e\u4e3a 00123 \n    - \u5728\u6ee1\u8db3\u8981\u6c42\u7684\u60c5\u51b5\u4e0b\uff0c\u8d8a\u5c0f\u8d8a\u597d\u3002\n    - 1\u8868\u793abool\u503c\u771f\uff0c0\u8868\u793abool\u503c\u5047\u3002MySQL\u6ca1\u6709\u5e03\u5c14\u7c7b\u578b\uff0c\u901a\u8fc7\u6574\u578b0\u548c1\u8868\u793a\u3002\u5e38\u7528tinyint(1)\u8868\u793a\u5e03\u5c14\u578b\u3002\n\n-- b. \u6d6e\u70b9\u578b ----------\n    \u7c7b\u578b             \u5b57\u8282     \u8303\u56f4\n    float(\u5355\u7cbe\u5ea6)     4\u5b57\u8282\n    double(\u53cc\u7cbe\u5ea6)    8\u5b57\u8282\n    \u6d6e\u70b9\u578b\u65e2\u652f\u6301\u7b26\u53f7\u4f4d unsigned \u5c5e\u6027\uff0c\u4e5f\u652f\u6301\u663e\u793a\u5bbd\u5ea6 zerofill \u5c5e\u6027\u3002\n        \u4e0d\u540c\u4e8e\u6574\u578b\uff0c\u524d\u540e\u5747\u4f1a\u8865\u586b0.\n    \u5b9a\u4e49\u6d6e\u70b9\u578b\u65f6\uff0c\u9700\u6307\u5b9a\u603b\u4f4d\u6570\u548c\u5c0f\u6570\u4f4d\u6570\u3002\n        float(M, D)     double(M, D)\n        M\u8868\u793a\u603b\u4f4d\u6570\uff0cD\u8868\u793a\u5c0f\u6570\u4f4d\u6570\u3002\n        M\u548cD\u7684\u5927\u5c0f\u4f1a\u51b3\u5b9a\u6d6e\u70b9\u6570\u7684\u8303\u56f4\u3002\u4e0d\u540c\u4e8e\u6574\u578b\u7684\u56fa\u5b9a\u8303\u56f4\u3002\n        M\u65e2\u8868\u793a\u603b\u4f4d\u6570\uff08\u4e0d\u5305\u62ec\u5c0f\u6570\u70b9\u548c\u6b63\u8d1f\u53f7\uff09\uff0c\u4e5f\u8868\u793a\u663e\u793a\u5bbd\u5ea6\uff08\u6240\u6709\u663e\u793a\u7b26\u53f7\u5747\u5305\u62ec\uff09\u3002\n        \u652f\u6301\u79d1\u5b66\u8ba1\u6570\u6cd5\u8868\u793a\u3002\n        \u6d6e\u70b9\u6570\u8868\u793a\u8fd1\u4f3c\u503c\u3002\n\n-- c. \u5b9a\u70b9\u6570 ----------\n    decimal -- \u53ef\u53d8\u957f\u5ea6\n    decimal(M, D)   M\u4e5f\u8868\u793a\u603b\u4f4d\u6570\uff0cD\u8868\u793a\u5c0f\u6570\u4f4d\u6570\u3002\n    \u4fdd\u5b58\u4e00\u4e2a\u7cbe\u786e\u7684\u6570\u503c\uff0c\u4e0d\u4f1a\u53d1\u751f\u6570\u636e\u7684\u6539\u53d8\uff0c\u4e0d\u540c\u4e8e\u6d6e\u70b9\u6570\u7684\u56db\u820d\u4e94\u5165\u3002\n    \u5c06\u6d6e\u70b9\u6570\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u6765\u4fdd\u5b58\uff0c\u6bcf9\u4f4d\u6570\u5b57\u4fdd\u5b58\u4e3a4\u4e2a\u5b57\u8282\u3002\n</code></pre> <ul> <li>\u5b57\u7b26\u4e32\u7c7b\u578b</li> </ul> <pre><code>-- a. char, varchar ----------\n    char    \u5b9a\u957f\u5b57\u7b26\u4e32\uff0c\u901f\u5ea6\u5feb\uff0c\u4f46\u6d6a\u8d39\u7a7a\u95f4\n    varchar \u53d8\u957f\u5b57\u7b26\u4e32\uff0c\u901f\u5ea6\u6162\uff0c\u4f46\u8282\u7701\u7a7a\u95f4\n    M\u8868\u793a\u80fd\u5b58\u50a8\u7684\u6700\u5927\u957f\u5ea6\uff0c\u6b64\u957f\u5ea6\u662f\u5b57\u7b26\u6570\uff0c\u975e\u5b57\u8282\u6570\u3002\n    \u4e0d\u540c\u7684\u7f16\u7801\uff0c\u6240\u5360\u7528\u7684\u7a7a\u95f4\u4e0d\u540c\u3002\n    char,\u6700\u591a255\u4e2a\u5b57\u7b26\uff0c\u4e0e\u7f16\u7801\u65e0\u5173\u3002\n    varchar,\u6700\u591a65535\u5b57\u7b26\uff0c\u4e0e\u7f16\u7801\u6709\u5173\u3002\n    \u4e00\u6761\u6709\u6548\u8bb0\u5f55\u6700\u5927\u4e0d\u80fd\u8d85\u8fc765535\u4e2a\u5b57\u8282\u3002\n        utf8 \u6700\u5927\u4e3a21844\u4e2a\u5b57\u7b26\uff0cgbk \u6700\u5927\u4e3a32766\u4e2a\u5b57\u7b26\uff0clatin1 \u6700\u5927\u4e3a65532\u4e2a\u5b57\u7b26\n    varchar \u662f\u53d8\u957f\u7684\uff0c\u9700\u8981\u5229\u7528\u5b58\u50a8\u7a7a\u95f4\u4fdd\u5b58 varchar \u7684\u957f\u5ea6\uff0c\u5982\u679c\u6570\u636e\u5c0f\u4e8e255\u4e2a\u5b57\u8282\uff0c\u5219\u91c7\u7528\u4e00\u4e2a\u5b57\u8282\u6765\u4fdd\u5b58\u957f\u5ea6\uff0c\u53cd\u4e4b\u9700\u8981\u4e24\u4e2a\u5b57\u8282\u6765\u4fdd\u5b58\u3002\n    varchar \u7684\u6700\u5927\u6709\u6548\u957f\u5ea6\u7531\u6700\u5927\u884c\u5927\u5c0f\u548c\u4f7f\u7528\u7684\u5b57\u7b26\u96c6\u786e\u5b9a\u3002\n    \u6700\u5927\u6709\u6548\u957f\u5ea6\u662f65532\u5b57\u8282\uff0c\u56e0\u4e3a\u5728varchar\u5b58\u5b57\u7b26\u4e32\u65f6\uff0c\u7b2c\u4e00\u4e2a\u5b57\u8282\u662f\u7a7a\u7684\uff0c\u4e0d\u5b58\u5728\u4efb\u4f55\u6570\u636e\uff0c\u7136\u540e\u8fd8\u9700\u4e24\u4e2a\u5b57\u8282\u6765\u5b58\u653e\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\uff0c\u6240\u4ee5\u6709\u6548\u957f\u5ea6\u662f64432-1-2=65532\u5b57\u8282\u3002\n    \u4f8b\uff1a\u82e5\u4e00\u4e2a\u8868\u5b9a\u4e49\u4e3a CREATE TABLE tb(c1 int, c2 char(30), c3 varchar(N)) charset=utf8; \u95eeN\u7684\u6700\u5927\u503c\u662f\u591a\u5c11\uff1f \u7b54\uff1a(65535-1-2-4-30*3)/3\n\n-- b. blob, text ----------\n    blob \u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\uff08\u5b57\u8282\u5b57\u7b26\u4e32\uff09\n        tinyblob, blob, mediumblob, longblob\n    text \u975e\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\uff08\u5b57\u7b26\u5b57\u7b26\u4e32\uff09\n        tinytext, text, mediumtext, longtext\n    text \u5728\u5b9a\u4e49\u65f6\uff0c\u4e0d\u9700\u8981\u5b9a\u4e49\u957f\u5ea6\uff0c\u4e5f\u4e0d\u4f1a\u8ba1\u7b97\u603b\u957f\u5ea6\u3002\n    text \u7c7b\u578b\u5728\u5b9a\u4e49\u65f6\uff0c\u4e0d\u53ef\u7ed9default\u503c\n\n-- c. binary, varbinary ----------\n    \u7c7b\u4f3c\u4e8echar\u548cvarchar\uff0c\u7528\u4e8e\u4fdd\u5b58\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\uff0c\u4e5f\u5c31\u662f\u4fdd\u5b58\u5b57\u8282\u5b57\u7b26\u4e32\u800c\u975e\u5b57\u7b26\u5b57\u7b26\u4e32\u3002\n    char, varchar, text \u5bf9\u5e94 binary, varbinary, blob.\n</code></pre> <ul> <li> <p>\u65e5\u671f\u65f6\u95f4\u7c7b\u578b <pre><code>    \u4e00\u822c\u7528\u6574\u578b\u4fdd\u5b58\u65f6\u95f4\u6233\uff0c\u56e0\u4e3aPHP\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5c06\u65f6\u95f4\u6233\u8fdb\u884c\u683c\u5f0f\u5316\u3002\n    datetime    8\u5b57\u8282    \u65e5\u671f\u53ca\u65f6\u95f4     1000-01-01 00:00:00 \u5230 9999-12-31 23:59:59\n    date        3\u5b57\u8282    \u65e5\u671f         1000-01-01 \u5230 9999-12-31\n    timestamp   4\u5b57\u8282    \u65f6\u95f4\u6233        19700101000000 \u5230 2038-01-19 03:14:07\n    time        3\u5b57\u8282    \u65f6\u95f4         -838:59:59 \u5230 838:59:59\n    year        1\u5b57\u8282    \u5e74\u4efd         1901 - 2155\ndatetime    YYYY-MM-DD hh:mm:ss\ntimestamp   YY-MM-DD hh:mm:ss\n            YYYYMMDDhhmmss\n            YYMMDDhhmmss\n            YYYYMMDDhhmmss\n            YYMMDDhhmmss\ndate        YYYY-MM-DD\n            YY-MM-DD\n            YYYYMMDD\n            YYMMDD\n            YYYYMMDD\n            YYMMDD\ntime        hh:mm:ss\n            hhmmss\n            hhmmss\nyear        YYYY\n            YY\n            YYYY\n            YY\n</code></pre></p> </li> <li> <p>\u679a\u4e3e\u548c\u96c6\u5408</p> </li> </ul> <pre><code>-- \u679a\u4e3e(enum) ----------\nenum(val1, val2, val3...)\n    \u5728\u5df2\u77e5\u7684\u503c\u4e2d\u8fdb\u884c\u5355\u9009\u3002\u6700\u5927\u6570\u91cf\u4e3a65535.\n    \u679a\u4e3e\u503c\u5728\u4fdd\u5b58\u65f6\uff0c\u4ee52\u4e2a\u5b57\u8282\u7684\u6574\u578b(smallint)\u4fdd\u5b58\u3002\u6bcf\u4e2a\u679a\u4e3e\u503c\uff0c\u6309\u4fdd\u5b58\u7684\u4f4d\u7f6e\u987a\u5e8f\uff0c\u4ece1\u5f00\u59cb\u9010\u4e00\u9012\u589e\u3002\n    \u8868\u73b0\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u5b58\u50a8\u5374\u662f\u6574\u578b\u3002\n    NULL\u503c\u7684\u7d22\u5f15\u662fNULL\u3002\n    \u7a7a\u5b57\u7b26\u4e32\u9519\u8bef\u503c\u7684\u7d22\u5f15\u503c\u662f0\u3002\n\n-- \u96c6\u5408\uff08set\uff09 ----------\nset(val1, val2, val3...)\n    create table tab ( gender set( \u7537 ,  \u5973 ,  \u65e0 ) );\n    insert into tab values ( \u7537, \u5973 );\n    \u6700\u591a\u53ef\u4ee5\u670964\u4e2a\u4e0d\u540c\u7684\u6210\u5458\u3002\u4ee5bigint\u5b58\u50a8\uff0c\u51718\u4e2a\u5b57\u8282\u3002\u91c7\u53d6\u4f4d\u8fd0\u7b97\u7684\u5f62\u5f0f\u3002\n    \u5f53\u521b\u5efa\u8868\u65f6\uff0cSET\u6210\u5458\u503c\u7684\u5c3e\u90e8\u7a7a\u683c\u5c06\u81ea\u52a8\u88ab\u5220\u9664\u3002\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_7","title":"\u9009\u62e9\u7c7b\u578b","text":"<pre><code>-- PHP\u89d2\u5ea6\n1. \u529f\u80fd\u6ee1\u8db3\n2. \u5b58\u50a8\u7a7a\u95f4\u5c3d\u91cf\u5c0f\uff0c\u5904\u7406\u6548\u7387\u66f4\u9ad8\n3. \u8003\u8651\u517c\u5bb9\u95ee\u9898\n\n-- IP\u5b58\u50a8 ----------\n1. \u53ea\u9700\u5b58\u50a8\uff0c\u53ef\u7528\u5b57\u7b26\u4e32\n2. \u5982\u679c\u9700\u8ba1\u7b97\uff0c\u67e5\u627e\u7b49\uff0c\u53ef\u5b58\u50a8\u4e3a4\u4e2a\u5b57\u8282\u7684\u65e0\u7b26\u53f7int\uff0c\u5373unsigned\n    1) PHP\u51fd\u6570\u8f6c\u6362\n        ip2long\u53ef\u8f6c\u6362\u4e3a\u6574\u578b\uff0c\u4f46\u4f1a\u51fa\u73b0\u643a\u5e26\u7b26\u53f7\u95ee\u9898\u3002\u9700\u683c\u5f0f\u5316\u4e3a\u65e0\u7b26\u53f7\u7684\u6574\u578b\u3002\n        \u5229\u7528sprintf\u51fd\u6570\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\n        sprintf(\"%u\", ip2long( 192.168.3.134 ));\n        \u7136\u540e\u7528long2ip\u5c06\u6574\u578b\u8f6c\u56deIP\u5b57\u7b26\u4e32\n    2) MySQL\u51fd\u6570\u8f6c\u6362(\u65e0\u7b26\u53f7\u6574\u578b\uff0cUNSIGNED)\n        INET_ATON( 127.0.0.1 ) \u5c06IP\u8f6c\u4e3a\u6574\u578b\n        INET_NTOA(2130706433) \u5c06\u6574\u578b\u8f6c\u4e3aIP\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_8","title":"\u5217\u5c5e\u6027\uff08\u5217\u7ea6\u675f\uff09","text":"<pre><code>1. PRIMARY \u4e3b\u952e\n    - \u80fd\u552f\u4e00\u6807\u8bc6\u8bb0\u5f55\u7684\u5b57\u6bb5\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u4e3b\u952e\u3002\n    - \u4e00\u4e2a\u8868\u53ea\u80fd\u6709\u4e00\u4e2a\u4e3b\u952e\u3002\n    - \u4e3b\u952e\u5177\u6709\u552f\u4e00\u6027\u3002\n    - \u58f0\u660e\u5b57\u6bb5\u65f6\uff0c\u7528 primary key \u6807\u8bc6\u3002\n        \u4e5f\u53ef\u4ee5\u5728\u5b57\u6bb5\u5217\u8868\u4e4b\u540e\u58f0\u660e\n            \u4f8b\uff1acreate table tab ( id int, stu varchar(10), primary key (id));\n    - \u4e3b\u952e\u5b57\u6bb5\u7684\u503c\u4e0d\u80fd\u4e3anull\u3002\n    - \u4e3b\u952e\u53ef\u4ee5\u7531\u591a\u4e2a\u5b57\u6bb5\u5171\u540c\u7ec4\u6210\u3002\u6b64\u65f6\u9700\u8981\u5728\u5b57\u6bb5\u5217\u8868\u540e\u58f0\u660e\u7684\u65b9\u6cd5\u3002\n        \u4f8b\uff1acreate table tab ( id int, stu varchar(10), age int, primary key (stu, age));\n2. UNIQUE \u552f\u4e00\u7d22\u5f15\uff08\u552f\u4e00\u7ea6\u675f\uff09\n    \u4f7f\u5f97\u67d0\u5b57\u6bb5\u7684\u503c\u4e5f\u4e0d\u80fd\u91cd\u590d\u3002\n3. NULL \u7ea6\u675f\n    null\u4e0d\u662f\u6570\u636e\u7c7b\u578b\uff0c\u662f\u5217\u7684\u4e00\u4e2a\u5c5e\u6027\u3002\n    \u8868\u793a\u5f53\u524d\u5217\u662f\u5426\u53ef\u4ee5\u4e3anull\uff0c\u8868\u793a\u4ec0\u4e48\u90fd\u6ca1\u6709\u3002\n    null, \u5141\u8bb8\u4e3a\u7a7a\u3002\u9ed8\u8ba4\u3002\n    not null, \u4e0d\u5141\u8bb8\u4e3a\u7a7a\u3002\n    insert into tab values (null,  val );\n        -- \u6b64\u65f6\u8868\u793a\u5c06\u7b2c\u4e00\u4e2a\u5b57\u6bb5\u7684\u503c\u8bbe\u4e3anull, \u53d6\u51b3\u4e8e\u8be5\u5b57\u6bb5\u662f\u5426\u5141\u8bb8\u4e3anull\n4. DEFAULT \u9ed8\u8ba4\u503c\u5c5e\u6027\n    \u5f53\u524d\u5b57\u6bb5\u7684\u9ed8\u8ba4\u503c\u3002\n    insert into tab values (default,  val );    -- \u6b64\u65f6\u8868\u793a\u5f3a\u5236\u4f7f\u7528\u9ed8\u8ba4\u503c\u3002\n    create table tab ( add_time timestamp default current_timestamp );\n        -- \u8868\u793a\u5c06\u5f53\u524d\u65f6\u95f4\u7684\u65f6\u95f4\u6233\u8bbe\u4e3a\u9ed8\u8ba4\u503c\u3002\n        current_date, current_time\n5. AUTO_INCREMENT \u81ea\u52a8\u589e\u957f\u7ea6\u675f\n    \u81ea\u52a8\u589e\u957f\u5fc5\u987b\u4e3a\u7d22\u5f15\uff08\u4e3b\u952e\u6216unique\uff09\n    \u53ea\u80fd\u5b58\u5728\u4e00\u4e2a\u5b57\u6bb5\u4e3a\u81ea\u52a8\u589e\u957f\u3002\n    \u9ed8\u8ba4\u4e3a1\u5f00\u59cb\u81ea\u52a8\u589e\u957f\u3002\u53ef\u4ee5\u901a\u8fc7\u8868\u5c5e\u6027 auto_increment = x\u8fdb\u884c\u8bbe\u7f6e\uff0c\u6216 alter table tbl auto_increment = x;\n6. COMMENT \u6ce8\u91ca\n    \u4f8b\uff1acreate table tab ( id int ) comment  \u6ce8\u91ca\u5185\u5bb9 ;\n7. FOREIGN KEY \u5916\u952e\u7ea6\u675f\n    \u7528\u4e8e\u9650\u5236\u4e3b\u8868\u4e0e\u4ece\u8868\u6570\u636e\u5b8c\u6574\u6027\u3002\n    alter table t1 add constraint `t1_t2_fk` foreign key (t1_id) references t2(id);\n        -- \u5c06\u8868t1\u7684t1_id\u5916\u952e\u5173\u8054\u5230\u8868t2\u7684id\u5b57\u6bb5\u3002\n        -- \u6bcf\u4e2a\u5916\u952e\u90fd\u6709\u4e00\u4e2a\u540d\u5b57\uff0c\u53ef\u4ee5\u901a\u8fc7 constraint \u6307\u5b9a\n    \u5b58\u5728\u5916\u952e\u7684\u8868\uff0c\u79f0\u4e4b\u4e3a\u4ece\u8868\uff08\u5b50\u8868\uff09\uff0c\u5916\u952e\u6307\u5411\u7684\u8868\uff0c\u79f0\u4e4b\u4e3a\u4e3b\u8868\uff08\u7236\u8868\uff09\u3002\n    \u4f5c\u7528\uff1a\u4fdd\u6301\u6570\u636e\u4e00\u81f4\u6027\uff0c\u5b8c\u6574\u6027\uff0c\u4e3b\u8981\u76ee\u7684\u662f\u63a7\u5236\u5b58\u50a8\u5728\u5916\u952e\u8868\uff08\u4ece\u8868\uff09\u4e2d\u7684\u6570\u636e\u3002\n    MySQL\u4e2d\uff0c\u53ef\u4ee5\u5bf9InnoDB\u5f15\u64ce\u4f7f\u7528\u5916\u952e\u7ea6\u675f\uff1a\n    \u8bed\u6cd5\uff1a\n    foreign key (\u5916\u952e\u5b57\u6bb5\uff09 references \u4e3b\u8868\u540d (\u5173\u8054\u5b57\u6bb5) [\u4e3b\u8868\u8bb0\u5f55\u5220\u9664\u65f6\u7684\u52a8\u4f5c] [\u4e3b\u8868\u8bb0\u5f55\u66f4\u65b0\u65f6\u7684\u52a8\u4f5c]\n    \u6b64\u65f6\u9700\u8981\u68c0\u6d4b\u4e00\u4e2a\u4ece\u8868\u7684\u5916\u952e\u9700\u8981\u7ea6\u675f\u4e3a\u4e3b\u8868\u7684\u5df2\u5b58\u5728\u7684\u503c\u3002\u5916\u952e\u5728\u6ca1\u6709\u5173\u8054\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e3anull.\u524d\u63d0\u662f\u8be5\u5916\u952e\u5217\uff0c\u6ca1\u6709not null\u3002\n    \u53ef\u4ee5\u4e0d\u6307\u5b9a\u4e3b\u8868\u8bb0\u5f55\u66f4\u6539\u6216\u66f4\u65b0\u65f6\u7684\u52a8\u4f5c\uff0c\u90a3\u4e48\u6b64\u65f6\u4e3b\u8868\u7684\u64cd\u4f5c\u88ab\u62d2\u7edd\u3002\n    \u5982\u679c\u6307\u5b9a\u4e86 on update \u6216 on delete\uff1a\u5728\u5220\u9664\u6216\u66f4\u65b0\u65f6\uff0c\u6709\u5982\u4e0b\u51e0\u4e2a\u64cd\u4f5c\u53ef\u4ee5\u9009\u62e9\uff1a\n    1. cascade\uff0c\u7ea7\u8054\u64cd\u4f5c\u3002\u4e3b\u8868\u6570\u636e\u88ab\u66f4\u65b0\uff08\u4e3b\u952e\u503c\u66f4\u65b0\uff09\uff0c\u4ece\u8868\u4e5f\u88ab\u66f4\u65b0\uff08\u5916\u952e\u503c\u66f4\u65b0\uff09\u3002\u4e3b\u8868\u8bb0\u5f55\u88ab\u5220\u9664\uff0c\u4ece\u8868\u76f8\u5173\u8bb0\u5f55\u4e5f\u88ab\u5220\u9664\u3002\n    2. set null\uff0c\u8bbe\u7f6e\u4e3anull\u3002\u4e3b\u8868\u6570\u636e\u88ab\u66f4\u65b0\uff08\u4e3b\u952e\u503c\u66f4\u65b0\uff09\uff0c\u4ece\u8868\u7684\u5916\u952e\u88ab\u8bbe\u7f6e\u4e3anull\u3002\u4e3b\u8868\u8bb0\u5f55\u88ab\u5220\u9664\uff0c\u4ece\u8868\u76f8\u5173\u8bb0\u5f55\u5916\u952e\u88ab\u8bbe\u7f6e\u6210null\u3002\u4f46\u6ce8\u610f\uff0c\u8981\u6c42\u8be5\u5916\u952e\u5217\uff0c\u6ca1\u6709not null\u5c5e\u6027\u7ea6\u675f\u3002\n    3. restrict\uff0c\u62d2\u7edd\u7236\u8868\u5220\u9664\u548c\u66f4\u65b0\u3002\n    \u6ce8\u610f\uff0c\u5916\u952e\u53ea\u88abInnoDB\u5b58\u50a8\u5f15\u64ce\u6240\u652f\u6301\u3002\u5176\u4ed6\u5f15\u64ce\u662f\u4e0d\u652f\u6301\u7684\u3002\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_9","title":"\u5efa\u8868\u89c4\u8303","text":"<pre><code>   -- Normal Format, NF\n        - \u6bcf\u4e2a\u8868\u4fdd\u5b58\u4e00\u4e2a\u5b9e\u4f53\u4fe1\u606f\n        - \u6bcf\u4e2a\u5177\u6709\u4e00\u4e2aID\u5b57\u6bb5\u4f5c\u4e3a\u4e3b\u952e\n        - ID\u4e3b\u952e + \u539f\u5b50\u8868\n    -- 1NF, \u7b2c\u4e00\u8303\u5f0f\n        \u5b57\u6bb5\u4e0d\u80fd\u518d\u5206\uff0c\u5c31\u6ee1\u8db3\u7b2c\u4e00\u8303\u5f0f\u3002\n    -- 2NF, \u7b2c\u4e8c\u8303\u5f0f\n        \u6ee1\u8db3\u7b2c\u4e00\u8303\u5f0f\u7684\u524d\u63d0\u4e0b\uff0c\u4e0d\u80fd\u51fa\u73b0\u90e8\u5206\u4f9d\u8d56\u3002\n        \u6d88\u9664\u7b26\u5408\u4e3b\u952e\u5c31\u53ef\u4ee5\u907f\u514d\u90e8\u5206\u4f9d\u8d56\u3002\u589e\u52a0\u5355\u5217\u5173\u952e\u5b57\u3002\n    -- 3NF, \u7b2c\u4e09\u8303\u5f0f\n        \u6ee1\u8db3\u7b2c\u4e8c\u8303\u5f0f\u7684\u524d\u63d0\u4e0b\uff0c\u4e0d\u80fd\u51fa\u73b0\u4f20\u9012\u4f9d\u8d56\u3002\n        \u67d0\u4e2a\u5b57\u6bb5\u4f9d\u8d56\u4e8e\u4e3b\u952e\uff0c\u800c\u6709\u5176\u4ed6\u5b57\u6bb5\u4f9d\u8d56\u4e8e\u8be5\u5b57\u6bb5\u3002\u8fd9\u5c31\u662f\u4f20\u9012\u4f9d\u8d56\u3002\n        \u5c06\u4e00\u4e2a\u5b9e\u4f53\u4fe1\u606f\u7684\u6570\u636e\u653e\u5728\u4e00\u4e2a\u8868\u5185\u5b9e\u73b0\u3002\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#select","title":"SELECT","text":"<pre><code>SELECT [ALL|DISTINCT] select_expr FROM -&gt; WHERE -&gt; GROUP BY [\u5408\u8ba1\u51fd\u6570] -&gt; HAVING -&gt; ORDER BY -&gt; LIMIT\na. select_expr\n    -- \u53ef\u4ee5\u7528 * \u8868\u793a\u6240\u6709\u5b57\u6bb5\u3002\n        select * from tb;\n    -- \u53ef\u4ee5\u4f7f\u7528\u8868\u8fbe\u5f0f\uff08\u8ba1\u7b97\u516c\u5f0f\u3001\u51fd\u6570\u8c03\u7528\u3001\u5b57\u6bb5\u4e5f\u662f\u4e2a\u8868\u8fbe\u5f0f\uff09\n        select stu, 29+25, now() from tb;\n    -- \u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u5217\u4f7f\u7528\u522b\u540d\u3002\u9002\u7528\u4e8e\u7b80\u5316\u5217\u6807\u8bc6\uff0c\u907f\u514d\u591a\u4e2a\u5217\u6807\u8bc6\u7b26\u91cd\u590d\u3002\n        - \u4f7f\u7528 as \u5173\u952e\u5b57\uff0c\u4e5f\u53ef\u7701\u7565 as.\n        select stu+10 as add10 from tb;\nb. FROM \u5b50\u53e5\n    \u7528\u4e8e\u6807\u8bc6\u67e5\u8be2\u6765\u6e90\u3002\n    -- \u53ef\u4ee5\u4e3a\u8868\u8d77\u522b\u540d\u3002\u4f7f\u7528as\u5173\u952e\u5b57\u3002\n        SELECT * FROM tb1 AS tt, tb2 AS bb;\n    -- from\u5b50\u53e5\u540e\uff0c\u53ef\u4ee5\u540c\u65f6\u51fa\u73b0\u591a\u4e2a\u8868\u3002\n        -- \u591a\u4e2a\u8868\u4f1a\u6a2a\u5411\u53e0\u52a0\u5230\u4e00\u8d77\uff0c\u800c\u6570\u636e\u4f1a\u5f62\u6210\u4e00\u4e2a\u7b1b\u5361\u5c14\u79ef\u3002\n        SELECT * FROM tb1, tb2;\n    -- \u5411\u4f18\u5316\u7b26\u63d0\u793a\u5982\u4f55\u9009\u62e9\u7d22\u5f15\n        USE INDEX\u3001IGNORE INDEX\u3001FORCE INDEX\n        SELECT * FROM table1 USE INDEX (key1,key2) WHERE key1=1 AND key2=2 AND key3=3;\n        SELECT * FROM table1 IGNORE INDEX (key3) WHERE key1=1 AND key2=2 AND key3=3;\nc. WHERE \u5b50\u53e5\n    -- \u4ecefrom\u83b7\u5f97\u7684\u6570\u636e\u6e90\u4e2d\u8fdb\u884c\u7b5b\u9009\u3002\n    -- \u6574\u578b1\u8868\u793a\u771f\uff0c0\u8868\u793a\u5047\u3002\n    -- \u8868\u8fbe\u5f0f\u7531\u8fd0\u7b97\u7b26\u548c\u8fd0\u7b97\u6570\u7ec4\u6210\u3002\n        -- \u8fd0\u7b97\u6570\uff1a\u53d8\u91cf\uff08\u5b57\u6bb5\uff09\u3001\u503c\u3001\u51fd\u6570\u8fd4\u56de\u503c\n        -- \u8fd0\u7b97\u7b26\uff1a\n            =, &lt;=&gt;, &lt;&gt;, !=, &lt;=, &lt;, &gt;=, &gt;, !, &amp;&amp;, ||,\n            in (not) null, (not) like, (not) in, (not) between and, is (not), and, or, not, xor\n            is/is not \u52a0\u4e0ature/false/unknown\uff0c\u68c0\u9a8c\u67d0\u4e2a\u503c\u7684\u771f\u5047\n            &lt;=&gt;\u4e0e&lt;&gt;\u529f\u80fd\u76f8\u540c\uff0c&lt;=&gt;\u53ef\u7528\u4e8enull\u6bd4\u8f83\nd. GROUP BY \u5b50\u53e5, \u5206\u7ec4\u5b50\u53e5\n    GROUP BY \u5b57\u6bb5/\u522b\u540d [\u6392\u5e8f\u65b9\u5f0f]\n    \u5206\u7ec4\u540e\u4f1a\u8fdb\u884c\u6392\u5e8f\u3002\u5347\u5e8f\uff1aASC\uff0c\u964d\u5e8f\uff1aDESC\n    \u4ee5\u4e0b[\u5408\u8ba1\u51fd\u6570]\u9700\u914d\u5408 GROUP BY \u4f7f\u7528\uff1a\n    count \u8fd4\u56de\u4e0d\u540c\u7684\u975eNULL\u503c\u6570\u76ee  count(*)\u3001count(\u5b57\u6bb5)\n    sum \u6c42\u548c\n    max \u6c42\u6700\u5927\u503c\n    min \u6c42\u6700\u5c0f\u503c\n    avg \u6c42\u5e73\u5747\u503c\n    group_concat \u8fd4\u56de\u5e26\u6709\u6765\u81ea\u4e00\u4e2a\u7ec4\u7684\u8fde\u63a5\u7684\u975eNULL\u503c\u7684\u5b57\u7b26\u4e32\u7ed3\u679c\u3002\u7ec4\u5185\u5b57\u7b26\u4e32\u8fde\u63a5\u3002\ne. HAVING \u5b50\u53e5\uff0c\u6761\u4ef6\u5b50\u53e5\n    \u4e0e where \u529f\u80fd\u3001\u7528\u6cd5\u76f8\u540c\uff0c\u6267\u884c\u65f6\u673a\u4e0d\u540c\u3002\n    where \u5728\u5f00\u59cb\u65f6\u6267\u884c\u68c0\u6d4b\u6570\u636e\uff0c\u5bf9\u539f\u6570\u636e\u8fdb\u884c\u8fc7\u6ee4\u3002\n    having \u5bf9\u7b5b\u9009\u51fa\u7684\u7ed3\u679c\u518d\u6b21\u8fdb\u884c\u8fc7\u6ee4\u3002\n    having \u5b57\u6bb5\u5fc5\u987b\u662f\u67e5\u8be2\u51fa\u6765\u7684\uff0cwhere \u5b57\u6bb5\u5fc5\u987b\u662f\u6570\u636e\u8868\u5b58\u5728\u7684\u3002\n    where \u4e0d\u53ef\u4ee5\u4f7f\u7528\u5b57\u6bb5\u7684\u522b\u540d\uff0chaving \u53ef\u4ee5\u3002\u56e0\u4e3a\u6267\u884cWHERE\u4ee3\u7801\u65f6\uff0c\u53ef\u80fd\u5c1a\u672a\u786e\u5b9a\u5217\u503c\u3002\n    where \u4e0d\u53ef\u4ee5\u4f7f\u7528\u5408\u8ba1\u51fd\u6570\u3002\u4e00\u822c\u9700\u7528\u5408\u8ba1\u51fd\u6570\u624d\u4f1a\u7528 having\n    SQL\u6807\u51c6\u8981\u6c42HAVING\u5fc5\u987b\u5f15\u7528GROUP BY\u5b50\u53e5\u4e2d\u7684\u5217\u6216\u7528\u4e8e\u5408\u8ba1\u51fd\u6570\u4e2d\u7684\u5217\u3002\nf. ORDER BY \u5b50\u53e5\uff0c\u6392\u5e8f\u5b50\u53e5\n    order by \u6392\u5e8f\u5b57\u6bb5/\u522b\u540d \u6392\u5e8f\u65b9\u5f0f [,\u6392\u5e8f\u5b57\u6bb5/\u522b\u540d \u6392\u5e8f\u65b9\u5f0f]...\n    \u5347\u5e8f\uff1aASC\uff0c\u964d\u5e8f\uff1aDESC\n    \u652f\u6301\u591a\u4e2a\u5b57\u6bb5\u7684\u6392\u5e8f\u3002\ng. LIMIT \u5b50\u53e5\uff0c\u9650\u5236\u7ed3\u679c\u6570\u91cf\u5b50\u53e5\n    \u4ec5\u5bf9\u5904\u7406\u597d\u7684\u7ed3\u679c\u8fdb\u884c\u6570\u91cf\u9650\u5236\u3002\u5c06\u5904\u7406\u597d\u7684\u7ed3\u679c\u7684\u770b\u4f5c\u662f\u4e00\u4e2a\u96c6\u5408\uff0c\u6309\u7167\u8bb0\u5f55\u51fa\u73b0\u7684\u987a\u5e8f\uff0c\u7d22\u5f15\u4ece0\u5f00\u59cb\u3002\n    limit \u8d77\u59cb\u4f4d\u7f6e, \u83b7\u53d6\u6761\u6570\n    \u7701\u7565\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u8868\u793a\u4ece\u7d22\u5f150\u5f00\u59cb\u3002limit \u83b7\u53d6\u6761\u6570\nh. DISTINCT, ALL \u9009\u9879\n    distinct \u53bb\u9664\u91cd\u590d\u8bb0\u5f55\n    \u9ed8\u8ba4\u4e3a all, \u5168\u90e8\u8bb0\u5f55\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#union","title":"UNION","text":"<pre><code>   \u5c06\u591a\u4e2aselect\u67e5\u8be2\u7684\u7ed3\u679c\u7ec4\u5408\u6210\u4e00\u4e2a\u7ed3\u679c\u96c6\u5408\u3002\n    SELECT ... UNION [ALL|DISTINCT] SELECT ...\n    \u9ed8\u8ba4 DISTINCT \u65b9\u5f0f\uff0c\u5373\u6240\u6709\u8fd4\u56de\u7684\u884c\u90fd\u662f\u552f\u4e00\u7684\n    \u5efa\u8bae\uff0c\u5bf9\u6bcf\u4e2aSELECT\u67e5\u8be2\u52a0\u4e0a\u5c0f\u62ec\u53f7\u5305\u88f9\u3002\n    ORDER BY \u6392\u5e8f\u65f6\uff0c\u9700\u52a0\u4e0a LIMIT \u8fdb\u884c\u7ed3\u5408\u3002\n    \u9700\u8981\u5404select\u67e5\u8be2\u7684\u5b57\u6bb5\u6570\u91cf\u4e00\u6837\u3002\n    \u6bcf\u4e2aselect\u67e5\u8be2\u7684\u5b57\u6bb5\u5217\u8868(\u6570\u91cf\u3001\u7c7b\u578b)\u5e94\u4e00\u81f4\uff0c\u56e0\u4e3a\u7ed3\u679c\u4e2d\u7684\u5b57\u6bb5\u540d\u4ee5\u7b2c\u4e00\u6761select\u8bed\u53e5\u4e3a\u51c6\u3002\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_10","title":"\u5b50\u67e5\u8be2","text":"<pre><code>   - \u5b50\u67e5\u8be2\u9700\u7528\u62ec\u53f7\u5305\u88f9\u3002\n-- from\u578b\n    from\u540e\u8981\u6c42\u662f\u4e00\u4e2a\u8868\uff0c\u5fc5\u987b\u7ed9\u5b50\u67e5\u8be2\u7ed3\u679c\u53d6\u4e2a\u522b\u540d\u3002\n    - \u7b80\u5316\u6bcf\u4e2a\u67e5\u8be2\u5185\u7684\u6761\u4ef6\u3002\n    - from\u578b\u9700\u5c06\u7ed3\u679c\u751f\u6210\u4e00\u4e2a\u4e34\u65f6\u8868\u683c\uff0c\u53ef\u7528\u4ee5\u539f\u8868\u7684\u9501\u5b9a\u7684\u91ca\u653e\u3002\n    - \u5b50\u67e5\u8be2\u8fd4\u56de\u4e00\u4e2a\u8868\uff0c\u8868\u578b\u5b50\u67e5\u8be2\u3002\n    select * from (select * from tb where id&gt;0) as subfrom where id&gt;1;\n-- where\u578b\n    - \u5b50\u67e5\u8be2\u8fd4\u56de\u4e00\u4e2a\u503c\uff0c\u6807\u91cf\u5b50\u67e5\u8be2\u3002\n    - \u4e0d\u9700\u8981\u7ed9\u5b50\u67e5\u8be2\u53d6\u522b\u540d\u3002\n    - where\u5b50\u67e5\u8be2\u5185\u7684\u8868\uff0c\u4e0d\u80fd\u76f4\u63a5\u7528\u4ee5\u66f4\u65b0\u3002\n    select * from tb where money = (select max(money) from tb);\n    -- \u5217\u5b50\u67e5\u8be2\n        \u5982\u679c\u5b50\u67e5\u8be2\u7ed3\u679c\u8fd4\u56de\u7684\u662f\u4e00\u5217\u3002\n        \u4f7f\u7528 in \u6216 not in \u5b8c\u6210\u67e5\u8be2\n        exists \u548c not exists \u6761\u4ef6\n            \u5982\u679c\u5b50\u67e5\u8be2\u8fd4\u56de\u6570\u636e\uff0c\u5219\u8fd4\u56de1\u62160\u3002\u5e38\u7528\u4e8e\u5224\u65ad\u6761\u4ef6\u3002\n            select column1 from t1 where exists (select * from t2);\n    -- \u884c\u5b50\u67e5\u8be2\n        \u67e5\u8be2\u6761\u4ef6\u662f\u4e00\u4e2a\u884c\u3002\n        select * from t1 where (id, gender) in (select id, gender from t2);\n        \u884c\u6784\u9020\u7b26\uff1a(col1, col2, ...) \u6216 ROW(col1, col2, ...)\n        \u884c\u6784\u9020\u7b26\u901a\u5e38\u7528\u4e8e\u4e0e\u5bf9\u80fd\u8fd4\u56de\u4e24\u4e2a\u6216\u4e24\u4e2a\u4ee5\u4e0a\u5217\u7684\u5b50\u67e5\u8be2\u8fdb\u884c\u6bd4\u8f83\u3002\n    -- \u7279\u6b8a\u8fd0\u7b97\u7b26\n    != all()    \u76f8\u5f53\u4e8e not in\n    = some()    \u76f8\u5f53\u4e8e in\u3002any \u662f some \u7684\u522b\u540d\n    != some()   \u4e0d\u7b49\u540c\u4e8e not in\uff0c\u4e0d\u7b49\u4e8e\u5176\u4e2d\u67d0\u4e00\u4e2a\u3002\n    all, some \u53ef\u4ee5\u914d\u5408\u5176\u4ed6\u8fd0\u7b97\u7b26\u4e00\u8d77\u4f7f\u7528\u3002\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#join","title":"\u8fde\u63a5\u67e5\u8be2(join)","text":"<pre><code>   \u5c06\u591a\u4e2a\u8868\u7684\u5b57\u6bb5\u8fdb\u884c\u8fde\u63a5\uff0c\u53ef\u4ee5\u6307\u5b9a\u8fde\u63a5\u6761\u4ef6\u3002\n-- \u5185\u8fde\u63a5(inner join)\n    - \u9ed8\u8ba4\u5c31\u662f\u5185\u8fde\u63a5\uff0c\u53ef\u7701\u7565inner\u3002\n    - \u53ea\u6709\u6570\u636e\u5b58\u5728\u65f6\u624d\u80fd\u53d1\u9001\u8fde\u63a5\u3002\u5373\u8fde\u63a5\u7ed3\u679c\u4e0d\u80fd\u51fa\u73b0\u7a7a\u884c\u3002\n    on \u8868\u793a\u8fde\u63a5\u6761\u4ef6\u3002\u5176\u6761\u4ef6\u8868\u8fbe\u5f0f\u4e0ewhere\u7c7b\u4f3c\u3002\u4e5f\u53ef\u4ee5\u7701\u7565\u6761\u4ef6\uff08\u8868\u793a\u6761\u4ef6\u6c38\u8fdc\u4e3a\u771f\uff09\n    \u4e5f\u53ef\u7528where\u8868\u793a\u8fde\u63a5\u6761\u4ef6\u3002\n    \u8fd8\u6709 using, \u4f46\u9700\u5b57\u6bb5\u540d\u76f8\u540c\u3002 using(\u5b57\u6bb5\u540d)\n    -- \u4ea4\u53c9\u8fde\u63a5 cross join\n        \u5373\uff0c\u6ca1\u6709\u6761\u4ef6\u7684\u5185\u8fde\u63a5\u3002\n        select * from tb1 cross join tb2;\n-- \u5916\u8fde\u63a5(outer join)\n    - \u5982\u679c\u6570\u636e\u4e0d\u5b58\u5728\uff0c\u4e5f\u4f1a\u51fa\u73b0\u5728\u8fde\u63a5\u7ed3\u679c\u4e2d\u3002\n    -- \u5de6\u5916\u8fde\u63a5 left join\n        \u5982\u679c\u6570\u636e\u4e0d\u5b58\u5728\uff0c\u5de6\u8868\u8bb0\u5f55\u4f1a\u51fa\u73b0\uff0c\u800c\u53f3\u8868\u4e3anull\u586b\u5145\n    -- \u53f3\u5916\u8fde\u63a5 right join\n        \u5982\u679c\u6570\u636e\u4e0d\u5b58\u5728\uff0c\u53f3\u8868\u8bb0\u5f55\u4f1a\u51fa\u73b0\uff0c\u800c\u5de6\u8868\u4e3anull\u586b\u5145\n-- \u81ea\u7136\u8fde\u63a5(natural join)\n    \u81ea\u52a8\u5224\u65ad\u8fde\u63a5\u6761\u4ef6\u5b8c\u6210\u8fde\u63a5\u3002\n    \u76f8\u5f53\u4e8e\u7701\u7565\u4e86using\uff0c\u4f1a\u81ea\u52a8\u67e5\u627e\u76f8\u540c\u5b57\u6bb5\u540d\u3002\n    natural join\n    natural left join\n    natural right join\n\nselect info.id, info.name, info.stu_num, extra_info.hobby, extra_info.sex from info, extra_info where info.stu_num = extra_info.stu_id;\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_11","title":"\u5bfc\u51fa","text":"<pre><code>select * into outfile \u6587\u4ef6\u5730\u5740 [\u63a7\u5236\u683c\u5f0f] from \u8868\u540d;   -- \u5bfc\u51fa\u8868\u6570\u636e\n\nload data [local] infile \u6587\u4ef6\u5730\u5740 [replace|ignore] into table \u8868\u540d [\u63a7\u5236\u683c\u5f0f]; -- \u5bfc\u5165\u6570\u636e\n    \u751f\u6210\u7684\u6570\u636e\u9ed8\u8ba4\u7684\u5206\u9694\u7b26\u662f\u5236\u8868\u7b26\n    local\u672a\u6307\u5b9a\uff0c\u5219\u6570\u636e\u6587\u4ef6\u5fc5\u987b\u5728\u670d\u52a1\u5668\u4e0a\n    replace \u548c ignore \u5173\u952e\u8bcd\u63a7\u5236\u5bf9\u73b0\u6709\u7684\u552f\u4e00\u952e\u8bb0\u5f55\u7684\u91cd\u590d\u7684\u5904\u7406\n-- \u63a7\u5236\u683c\u5f0f\nfields  \u63a7\u5236\u5b57\u6bb5\u683c\u5f0f\n\u9ed8\u8ba4\uff1afields terminated by       enclosed by    escaped by   \n    terminated by  string   -- \u7ec8\u6b62\n    enclosed by  char       -- \u5305\u88f9\n    escaped by  char        -- \u8f6c\u4e49\n    -- \u793a\u4f8b\uff1a\n        SELECT a,b,a+b INTO OUTFILE  /tmp/result.text \n        FIELDS TERMINATED BY  ,  OPTIONALLY ENCLOSED BY  \" \n        LINES TERMINATED BY  \n\n        FROM test_table;\nlines   \u63a7\u5236\u884c\u683c\u5f0f\n\u9ed8\u8ba4\uff1alines terminated by  \n\n    terminated by  string   -- \u7ec8\u6b62\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#insert","title":"INSERT","text":"<pre><code>select\u8bed\u53e5\u83b7\u5f97\u7684\u6570\u636e\u53ef\u4ee5\u7528insert\u63d2\u5165\u3002\n\u53ef\u4ee5\u7701\u7565\u5bf9\u5217\u7684\u6307\u5b9a\uff0c\u8981\u6c42 values () \u62ec\u53f7\u5185\uff0c\u63d0\u4f9b\u7ed9\u4e86\u6309\u7167\u5217\u987a\u5e8f\u51fa\u73b0\u7684\u6240\u6709\u5b57\u6bb5\u7684\u503c\u3002\n    \u6216\u8005\u4f7f\u7528set\u8bed\u6cd5\u3002\n    INSERT INTO tbl_name SET field=value,...\uff1b\n\u53ef\u4ee5\u4e00\u6b21\u6027\u4f7f\u7528\u591a\u4e2a\u503c\uff0c\u91c7\u7528(), (), ();\u7684\u5f62\u5f0f\u3002\n    INSERT INTO tbl_name VALUES (), (), ();\n\u53ef\u4ee5\u5728\u5217\u503c\u6307\u5b9a\u65f6\uff0c\u4f7f\u7528\u8868\u8fbe\u5f0f\u3002\n    INSERT INTO tbl_name VALUES (field_value, 10+10, now());\n\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u7279\u6b8a\u503c DEFAULT\uff0c\u8868\u793a\u8be5\u5217\u4f7f\u7528\u9ed8\u8ba4\u503c\u3002\n    INSERT INTO tbl_name VALUES (field_value, DEFAULT);\n\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u67e5\u8be2\u7684\u7ed3\u679c\uff0c\u4f5c\u4e3a\u9700\u8981\u63d2\u5165\u7684\u503c\u3002\n    INSERT INTO tbl_name SELECT ...;\n\u53ef\u4ee5\u6307\u5b9a\u5728\u63d2\u5165\u7684\u503c\u51fa\u73b0\u4e3b\u952e\uff08\u6216\u552f\u4e00\u7d22\u5f15\uff09\u51b2\u7a81\u65f6\uff0c\u66f4\u65b0\u5176\u4ed6\u975e\u4e3b\u952e\u5217\u7684\u4fe1\u606f\u3002\n    INSERT INTO tbl_name VALUES/SET/SELECT ON DUPLICATE KEY UPDATE \u5b57\u6bb5=\u503c, \u2026;\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#delete","title":"DELETE","text":"<pre><code>DELETE FROM tbl_name [WHERE where_definition] [ORDER BY ...] [LIMIT row_count]\n\u6309\u7167\u6761\u4ef6\u5220\u9664\u3002where\n\u6307\u5b9a\u5220\u9664\u7684\u6700\u591a\u8bb0\u5f55\u6570\u3002limit\n\u53ef\u4ee5\u901a\u8fc7\u6392\u5e8f\u6761\u4ef6\u5220\u9664\u3002order by + limit\n\u652f\u6301\u591a\u8868\u5220\u9664\uff0c\u4f7f\u7528\u7c7b\u4f3c\u8fde\u63a5\u8bed\u6cd5\u3002\ndelete from \u9700\u8981\u5220\u9664\u6570\u636e\u591a\u88681\uff0c\u88682 using \u8868\u8fde\u63a5\u64cd\u4f5c \u6761\u4ef6\u3002\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#truncate","title":"TRUNCATE","text":"<pre><code>TRUNCATE [TABLE] tbl_name\n\u6e05\u7a7a\u6570\u636e\n\u5220\u9664\u91cd\u5efa\u8868\n\u533a\u522b\uff1a\n1\uff0ctruncate \u662f\u5220\u9664\u8868\u518d\u521b\u5efa\uff0cdelete \u662f\u9010\u6761\u5220\u9664\n2\uff0ctruncate \u91cd\u7f6eauto_increment\u7684\u503c\u3002\u800cdelete\u4e0d\u4f1a\n3\uff0ctruncate \u4e0d\u77e5\u9053\u5220\u9664\u4e86\u51e0\u6761\uff0c\u800cdelete\u77e5\u9053\u3002\n4\uff0c\u5f53\u88ab\u7528\u4e8e\u5e26\u5206\u533a\u7684\u8868\u65f6\uff0ctruncate \u4f1a\u4fdd\u7559\u5206\u533a\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_12","title":"\u5907\u4efd\u4e0e\u8fd8\u539f","text":"<pre><code>\u5907\u4efd\uff0c\u5c06\u6570\u636e\u7684\u7ed3\u6784\u4e0e\u8868\u5185\u6570\u636e\u4fdd\u5b58\u8d77\u6765\u3002\n\u5229\u7528 mysqldump \u6307\u4ee4\u5b8c\u6210\u3002\n-- \u5bfc\u51fa\nmysqldump [options] db_name [tables]\nmysqldump [options] ---database DB1 [DB2 DB3...]\nmysqldump [options] --all--database\n1. \u5bfc\u51fa\u4e00\u5f20\u8868\n    mysqldump -u\u7528\u6237\u540d -p\u5bc6\u7801 \u5e93\u540d \u8868\u540d &gt; \u6587\u4ef6\u540d(D:/a.sql)\n2. \u5bfc\u51fa\u591a\u5f20\u8868\n    mysqldump -u\u7528\u6237\u540d -p\u5bc6\u7801 \u5e93\u540d \u88681 \u88682 \u88683 &gt; \u6587\u4ef6\u540d(D:/a.sql)\n3. \u5bfc\u51fa\u6240\u6709\u8868\n    mysqldump -u\u7528\u6237\u540d -p\u5bc6\u7801 \u5e93\u540d &gt; \u6587\u4ef6\u540d(D:/a.sql)\n4. \u5bfc\u51fa\u4e00\u4e2a\u5e93\n    mysqldump -u\u7528\u6237\u540d -p\u5bc6\u7801 --lock-all-tables --database \u5e93\u540d &gt; \u6587\u4ef6\u540d(D:/a.sql)\n\u53ef\u4ee5-w\u643a\u5e26WHERE\u6761\u4ef6\n-- \u5bfc\u5165\n1. \u5728\u767b\u5f55mysql\u7684\u60c5\u51b5\u4e0b\uff1a\n    source  \u5907\u4efd\u6587\u4ef6\n2. \u5728\u4e0d\u767b\u5f55\u7684\u60c5\u51b5\u4e0b\n    mysql -u\u7528\u6237\u540d -p\u5bc6\u7801 \u5e93\u540d &lt; \u5907\u4efd\u6587\u4ef6\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_13","title":"\u89c6\u56fe","text":"<pre><code>\u4ec0\u4e48\u662f\u89c6\u56fe\uff1a\n    \u89c6\u56fe\u662f\u4e00\u4e2a\u865a\u62df\u8868\uff0c\u5176\u5185\u5bb9\u7531\u67e5\u8be2\u5b9a\u4e49\u3002\u540c\u771f\u5b9e\u7684\u8868\u4e00\u6837\uff0c\u89c6\u56fe\u5305\u542b\u4e00\u7cfb\u5217\u5e26\u6709\u540d\u79f0\u7684\u5217\u548c\u884c\u6570\u636e\u3002\u4f46\u662f\uff0c\u89c6\u56fe\u5e76\u4e0d\u5728\u6570\u636e\u5e93\u4e2d\u4ee5\u5b58\u50a8\u7684\u6570\u636e\u503c\u96c6\u5f62\u5f0f\u5b58\u5728\u3002\u884c\u548c\u5217\u6570\u636e\u6765\u81ea\u7531\u5b9a\u4e49\u89c6\u56fe\u7684\u67e5\u8be2\u6240\u5f15\u7528\u7684\u8868\uff0c\u5e76\u4e14\u5728\u5f15\u7528\u89c6\u56fe\u65f6\u52a8\u6001\u751f\u6210\u3002\n    \u89c6\u56fe\u5177\u6709\u8868\u7ed3\u6784\u6587\u4ef6\uff0c\u4f46\u4e0d\u5b58\u5728\u6570\u636e\u6587\u4ef6\u3002\n    \u5bf9\u5176\u4e2d\u6240\u5f15\u7528\u7684\u57fa\u7840\u8868\u6765\u8bf4\uff0c\u89c6\u56fe\u7684\u4f5c\u7528\u7c7b\u4f3c\u4e8e\u7b5b\u9009\u3002\u5b9a\u4e49\u89c6\u56fe\u7684\u7b5b\u9009\u53ef\u4ee5\u6765\u81ea\u5f53\u524d\u6216\u5176\u5b83\u6570\u636e\u5e93\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u8868\uff0c\u6216\u8005\u5176\u5b83\u89c6\u56fe\u3002\u901a\u8fc7\u89c6\u56fe\u8fdb\u884c\u67e5\u8be2\u6ca1\u6709\u4efb\u4f55\u9650\u5236\uff0c\u901a\u8fc7\u5b83\u4eec\u8fdb\u884c\u6570\u636e\u4fee\u6539\u65f6\u7684\u9650\u5236\u4e5f\u5f88\u5c11\u3002\n    \u89c6\u56fe\u662f\u5b58\u50a8\u5728\u6570\u636e\u5e93\u4e2d\u7684\u67e5\u8be2\u7684sql\u8bed\u53e5\uff0c\u5b83\u4e3b\u8981\u51fa\u4e8e\u4e24\u79cd\u539f\u56e0\uff1a\u5b89\u5168\u539f\u56e0\uff0c\u89c6\u56fe\u53ef\u4ee5\u9690\u85cf\u4e00\u4e9b\u6570\u636e\uff0c\u5982\uff1a\u793e\u4f1a\u4fdd\u9669\u57fa\u91d1\u8868\uff0c\u53ef\u4ee5\u7528\u89c6\u56fe\u53ea\u663e\u793a\u59d3\u540d\uff0c\u5730\u5740\uff0c\u800c\u4e0d\u663e\u793a\u793e\u4f1a\u4fdd\u9669\u53f7\u548c\u5de5\u8d44\u6570\u7b49\uff0c\u53e6\u4e00\u539f\u56e0\u662f\u53ef\u4f7f\u590d\u6742\u7684\u67e5\u8be2\u6613\u4e8e\u7406\u89e3\u548c\u4f7f\u7528\u3002\n-- \u521b\u5efa\u89c6\u56fe\nCREATE [OR REPLACE] [ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}] VIEW view_name [(column_list)] AS select_statement\n    - \u89c6\u56fe\u540d\u5fc5\u987b\u552f\u4e00\uff0c\u540c\u65f6\u4e0d\u80fd\u4e0e\u8868\u91cd\u540d\u3002\n    - \u89c6\u56fe\u53ef\u4ee5\u4f7f\u7528select\u8bed\u53e5\u67e5\u8be2\u5230\u7684\u5217\u540d\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5df1\u6307\u5b9a\u76f8\u5e94\u7684\u5217\u540d\u3002\n    - \u53ef\u4ee5\u6307\u5b9a\u89c6\u56fe\u6267\u884c\u7684\u7b97\u6cd5\uff0c\u901a\u8fc7ALGORITHM\u6307\u5b9a\u3002\n    - column_list\u5982\u679c\u5b58\u5728\uff0c\u5219\u6570\u76ee\u5fc5\u987b\u7b49\u4e8eSELECT\u8bed\u53e5\u68c0\u7d22\u7684\u5217\u6570\n-- \u67e5\u770b\u7ed3\u6784\n    SHOW CREATE VIEW view_name\n-- \u5220\u9664\u89c6\u56fe\n    - \u5220\u9664\u89c6\u56fe\u540e\uff0c\u6570\u636e\u4f9d\u7136\u5b58\u5728\u3002\n    - \u53ef\u540c\u65f6\u5220\u9664\u591a\u4e2a\u89c6\u56fe\u3002\n    DROP VIEW [IF EXISTS] view_name ...\n-- \u4fee\u6539\u89c6\u56fe\u7ed3\u6784\n    - \u4e00\u822c\u4e0d\u4fee\u6539\u89c6\u56fe\uff0c\u56e0\u4e3a\u4e0d\u662f\u6240\u6709\u7684\u66f4\u65b0\u89c6\u56fe\u90fd\u4f1a\u6620\u5c04\u5230\u8868\u4e0a\u3002\n    ALTER VIEW view_name [(column_list)] AS select_statement\n-- \u89c6\u56fe\u4f5c\u7528\n    1. \u7b80\u5316\u4e1a\u52a1\u903b\u8f91\n    2. \u5bf9\u5ba2\u6237\u7aef\u9690\u85cf\u771f\u5b9e\u7684\u8868\u7ed3\u6784\n-- \u89c6\u56fe\u7b97\u6cd5(ALGORITHM)\n    MERGE       \u5408\u5e76\n        \u5c06\u89c6\u56fe\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u4e0e\u5916\u90e8\u67e5\u8be2\u9700\u8981\u5148\u5408\u5e76\u518d\u6267\u884c\uff01\n    TEMPTABLE   \u4e34\u65f6\u8868\n        \u5c06\u89c6\u56fe\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u5f62\u6210\u4e34\u65f6\u8868\uff0c\u518d\u505a\u5916\u5c42\u67e5\u8be2\uff01\n    UNDEFINED   \u672a\u5b9a\u4e49(\u9ed8\u8ba4)\uff0c\u6307\u7684\u662fMySQL\u81ea\u4e3b\u53bb\u9009\u62e9\u76f8\u5e94\u7684\u7b97\u6cd5\u3002\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#transaction","title":"\u4e8b\u52a1(transaction)","text":"<pre><code>\u4e8b\u52a1\u662f\u6307\u903b\u8f91\u4e0a\u7684\u4e00\u7ec4\u64cd\u4f5c\uff0c\u7ec4\u6210\u8fd9\u7ec4\u64cd\u4f5c\u7684\u5404\u4e2a\u5355\u5143\uff0c\u8981\u4e0d\u5168\u6210\u529f\u8981\u4e0d\u5168\u5931\u8d25\u3002\n    - \u652f\u6301\u8fde\u7eedSQL\u7684\u96c6\u4f53\u6210\u529f\u6216\u96c6\u4f53\u64a4\u9500\u3002\n    - \u4e8b\u52a1\u662f\u6570\u636e\u5e93\u5728\u6570\u636e\u665a\u81ea\u4e60\u65b9\u9762\u7684\u4e00\u4e2a\u529f\u80fd\u3002\n    - \u9700\u8981\u5229\u7528 InnoDB \u6216 BDB \u5b58\u50a8\u5f15\u64ce\uff0c\u5bf9\u81ea\u52a8\u63d0\u4ea4\u7684\u7279\u6027\u652f\u6301\u5b8c\u6210\u3002\n    - InnoDB\u88ab\u79f0\u4e3a\u4e8b\u52a1\u5b89\u5168\u578b\u5f15\u64ce\u3002\n-- \u4e8b\u52a1\u5f00\u542f\n    START TRANSACTION; \u6216\u8005 BEGIN;\n    \u5f00\u542f\u4e8b\u52a1\u540e\uff0c\u6240\u6709\u88ab\u6267\u884c\u7684SQL\u8bed\u53e5\u5747\u88ab\u8ba4\u4f5c\u5f53\u524d\u4e8b\u52a1\u5185\u7684SQL\u8bed\u53e5\u3002\n-- \u4e8b\u52a1\u63d0\u4ea4\n    COMMIT;\n-- \u4e8b\u52a1\u56de\u6eda\n    ROLLBACK;\n    \u5982\u679c\u90e8\u5206\u64cd\u4f5c\u53d1\u751f\u95ee\u9898\uff0c\u6620\u5c04\u5230\u4e8b\u52a1\u5f00\u542f\u524d\u3002\n-- \u4e8b\u52a1\u7684\u7279\u6027\n    1. \u539f\u5b50\u6027\uff08Atomicity\uff09\n        \u4e8b\u52a1\u662f\u4e00\u4e2a\u4e0d\u53ef\u5206\u5272\u7684\u5de5\u4f5c\u5355\u4f4d\uff0c\u4e8b\u52a1\u4e2d\u7684\u64cd\u4f5c\u8981\u4e48\u90fd\u53d1\u751f\uff0c\u8981\u4e48\u90fd\u4e0d\u53d1\u751f\u3002\n    2. \u4e00\u81f4\u6027\uff08Consistency\uff09\n        \u4e8b\u52a1\u524d\u540e\u6570\u636e\u7684\u5b8c\u6574\u6027\u5fc5\u987b\u4fdd\u6301\u4e00\u81f4\u3002\n        - \u4e8b\u52a1\u5f00\u59cb\u548c\u7ed3\u675f\u65f6\uff0c\u5916\u90e8\u6570\u636e\u4e00\u81f4\n        - \u5728\u6574\u4e2a\u4e8b\u52a1\u8fc7\u7a0b\u4e2d\uff0c\u64cd\u4f5c\u662f\u8fde\u7eed\u7684\n    3. \u9694\u79bb\u6027\uff08Isolation\uff09\n        \u591a\u4e2a\u7528\u6237\u5e76\u53d1\u8bbf\u95ee\u6570\u636e\u5e93\u65f6\uff0c\u4e00\u4e2a\u7528\u6237\u7684\u4e8b\u52a1\u4e0d\u80fd\u88ab\u5176\u5b83\u7528\u6237\u7684\u4e8b\u7269\u6240\u5e72\u6270\uff0c\u591a\u4e2a\u5e76\u53d1\u4e8b\u52a1\u4e4b\u95f4\u7684\u6570\u636e\u8981\u76f8\u4e92\u9694\u79bb\u3002\n    4. \u6301\u4e45\u6027\uff08Durability\uff09\n        \u4e00\u4e2a\u4e8b\u52a1\u4e00\u65e6\u88ab\u63d0\u4ea4\uff0c\u5b83\u5bf9\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u6539\u53d8\u5c31\u662f\u6c38\u4e45\u6027\u7684\u3002\n-- \u4e8b\u52a1\u7684\u5b9e\u73b0\n    1. \u8981\u6c42\u662f\u4e8b\u52a1\u652f\u6301\u7684\u8868\u7c7b\u578b\n    2. \u6267\u884c\u4e00\u7ec4\u76f8\u5173\u7684\u64cd\u4f5c\u524d\u5f00\u542f\u4e8b\u52a1\n    3. \u6574\u7ec4\u64cd\u4f5c\u5b8c\u6210\u540e\uff0c\u90fd\u6210\u529f\uff0c\u5219\u63d0\u4ea4\uff1b\u5982\u679c\u5b58\u5728\u5931\u8d25\uff0c\u9009\u62e9\u56de\u6eda\uff0c\u5219\u4f1a\u56de\u5230\u4e8b\u52a1\u5f00\u59cb\u7684\u5907\u4efd\u70b9\u3002\n-- \u4e8b\u52a1\u7684\u539f\u7406\n    \u5229\u7528InnoDB\u7684\u81ea\u52a8\u63d0\u4ea4(autocommit)\u7279\u6027\u5b8c\u6210\u3002\n    \u666e\u901a\u7684MySQL\u6267\u884c\u8bed\u53e5\u540e\uff0c\u5f53\u524d\u7684\u6570\u636e\u63d0\u4ea4\u64cd\u4f5c\u5747\u53ef\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u53ef\u89c1\u3002\n    \u800c\u4e8b\u52a1\u662f\u6682\u65f6\u5173\u95ed\u201c\u81ea\u52a8\u63d0\u4ea4\u201d\u673a\u5236\uff0c\u9700\u8981commit\u63d0\u4ea4\u6301\u4e45\u5316\u6570\u636e\u64cd\u4f5c\u3002\n-- \u6ce8\u610f\n    1. \u6570\u636e\u5b9a\u4e49\u8bed\u8a00\uff08DDL\uff09\u8bed\u53e5\u4e0d\u80fd\u88ab\u56de\u6eda\uff0c\u6bd4\u5982\u521b\u5efa\u6216\u53d6\u6d88\u6570\u636e\u5e93\u7684\u8bed\u53e5\uff0c\u548c\u521b\u5efa\u3001\u53d6\u6d88\u6216\u66f4\u6539\u8868\u6216\u5b58\u50a8\u7684\u5b50\u7a0b\u5e8f\u7684\u8bed\u53e5\u3002\n    2. \u4e8b\u52a1\u4e0d\u80fd\u88ab\u5d4c\u5957\n-- \u4fdd\u5b58\u70b9\n    SAVEPOINT \u4fdd\u5b58\u70b9\u540d\u79f0 -- \u8bbe\u7f6e\u4e00\u4e2a\u4e8b\u52a1\u4fdd\u5b58\u70b9\n    ROLLBACK TO SAVEPOINT \u4fdd\u5b58\u70b9\u540d\u79f0 -- \u56de\u6eda\u5230\u4fdd\u5b58\u70b9\n    RELEASE SAVEPOINT \u4fdd\u5b58\u70b9\u540d\u79f0 -- \u5220\u9664\u4fdd\u5b58\u70b9\n-- InnoDB\u81ea\u52a8\u63d0\u4ea4\u7279\u6027\u8bbe\u7f6e\n    SET autocommit = 0|1;   0\u8868\u793a\u5173\u95ed\u81ea\u52a8\u63d0\u4ea4\uff0c1\u8868\u793a\u5f00\u542f\u81ea\u52a8\u63d0\u4ea4\u3002\n    - \u5982\u679c\u5173\u95ed\u4e86\uff0c\u90a3\u666e\u901a\u64cd\u4f5c\u7684\u7ed3\u679c\u5bf9\u5176\u4ed6\u5ba2\u6237\u7aef\u4e5f\u4e0d\u53ef\u89c1\uff0c\u9700\u8981commit\u63d0\u4ea4\u540e\u624d\u80fd\u6301\u4e45\u5316\u6570\u636e\u64cd\u4f5c\u3002\n    - \u4e5f\u53ef\u4ee5\u5173\u95ed\u81ea\u52a8\u63d0\u4ea4\u6765\u5f00\u542f\u4e8b\u52a1\u3002\u4f46\u4e0eSTART TRANSACTION\u4e0d\u540c\u7684\u662f\uff0c\n        SET autocommit\u662f\u6c38\u4e45\u6539\u53d8\u670d\u52a1\u5668\u7684\u8bbe\u7f6e\uff0c\u76f4\u5230\u4e0b\u6b21\u518d\u6b21\u4fee\u6539\u8be5\u8bbe\u7f6e\u3002(\u9488\u5bf9\u5f53\u524d\u8fde\u63a5)\n        \u800cSTART TRANSACTION\u8bb0\u5f55\u5f00\u542f\u524d\u7684\u72b6\u6001\uff0c\u800c\u4e00\u65e6\u4e8b\u52a1\u63d0\u4ea4\u6216\u56de\u6eda\u540e\u5c31\u9700\u8981\u518d\u6b21\u5f00\u542f\u4e8b\u52a1\u3002(\u9488\u5bf9\u5f53\u524d\u4e8b\u52a1)\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_14","title":"\u9501\u8868","text":"<pre><code>\u8868\u9501\u5b9a\u53ea\u7528\u4e8e\u9632\u6b62\u5176\u5b83\u5ba2\u6237\u7aef\u8fdb\u884c\u4e0d\u6b63\u5f53\u5730\u8bfb\u53d6\u548c\u5199\u5165\nMyISAM \u652f\u6301\u8868\u9501\uff0cInnoDB \u652f\u6301\u884c\u9501\n-- \u9501\u5b9a\n    LOCK TABLES tbl_name [AS alias]\n-- \u89e3\u9501\n    UNLOCK TABLES\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_15","title":"\u89e6\u53d1\u5668","text":"<pre><code>   \u89e6\u53d1\u7a0b\u5e8f\u662f\u4e0e\u8868\u6709\u5173\u7684\u547d\u540d\u6570\u636e\u5e93\u5bf9\u8c61\uff0c\u5f53\u8be5\u8868\u51fa\u73b0\u7279\u5b9a\u4e8b\u4ef6\u65f6\uff0c\u5c06\u6fc0\u6d3b\u8be5\u5bf9\u8c61\n    \u76d1\u542c\uff1a\u8bb0\u5f55\u7684\u589e\u52a0\u3001\u4fee\u6539\u3001\u5220\u9664\u3002\n-- \u521b\u5efa\u89e6\u53d1\u5668\nCREATE TRIGGER trigger_name trigger_time trigger_event ON tbl_name FOR EACH ROW trigger_stmt\n    \u53c2\u6570\uff1a\n    trigger_time\u662f\u89e6\u53d1\u7a0b\u5e8f\u7684\u52a8\u4f5c\u65f6\u95f4\u3002\u5b83\u53ef\u4ee5\u662f before \u6216 after\uff0c\u4ee5\u6307\u660e\u89e6\u53d1\u7a0b\u5e8f\u662f\u5728\u6fc0\u6d3b\u5b83\u7684\u8bed\u53e5\u4e4b\u524d\u6216\u4e4b\u540e\u89e6\u53d1\u3002\n    trigger_event\u6307\u660e\u4e86\u6fc0\u6d3b\u89e6\u53d1\u7a0b\u5e8f\u7684\u8bed\u53e5\u7684\u7c7b\u578b\n        INSERT\uff1a\u5c06\u65b0\u884c\u63d2\u5165\u8868\u65f6\u6fc0\u6d3b\u89e6\u53d1\u7a0b\u5e8f\n        UPDATE\uff1a\u66f4\u6539\u67d0\u4e00\u884c\u65f6\u6fc0\u6d3b\u89e6\u53d1\u7a0b\u5e8f\n        DELETE\uff1a\u4ece\u8868\u4e2d\u5220\u9664\u67d0\u4e00\u884c\u65f6\u6fc0\u6d3b\u89e6\u53d1\u7a0b\u5e8f\n    tbl_name\uff1a\u76d1\u542c\u7684\u8868\uff0c\u5fc5\u987b\u662f\u6c38\u4e45\u6027\u7684\u8868\uff0c\u4e0d\u80fd\u5c06\u89e6\u53d1\u7a0b\u5e8f\u4e0eTEMPORARY\u8868\u6216\u89c6\u56fe\u5173\u8054\u8d77\u6765\u3002\n    trigger_stmt\uff1a\u5f53\u89e6\u53d1\u7a0b\u5e8f\u6fc0\u6d3b\u65f6\u6267\u884c\u7684\u8bed\u53e5\u3002\u6267\u884c\u591a\u4e2a\u8bed\u53e5\uff0c\u53ef\u4f7f\u7528BEGIN...END\u590d\u5408\u8bed\u53e5\u7ed3\u6784\n-- \u5220\u9664\nDROP TRIGGER [schema_name.]trigger_name\n\u53ef\u4ee5\u4f7f\u7528old\u548cnew\u4ee3\u66ff\u65e7\u7684\u548c\u65b0\u7684\u6570\u636e\n    \u66f4\u65b0\u64cd\u4f5c\uff0c\u66f4\u65b0\u524d\u662fold\uff0c\u66f4\u65b0\u540e\u662fnew.\n    \u5220\u9664\u64cd\u4f5c\uff0c\u53ea\u6709old.\n    \u589e\u52a0\u64cd\u4f5c\uff0c\u53ea\u6709new.\n-- \u6ce8\u610f\n    1. \u5bf9\u4e8e\u5177\u6709\u76f8\u540c\u89e6\u53d1\u7a0b\u5e8f\u52a8\u4f5c\u65f6\u95f4\u548c\u4e8b\u4ef6\u7684\u7ed9\u5b9a\u8868\uff0c\u4e0d\u80fd\u6709\u4e24\u4e2a\u89e6\u53d1\u7a0b\u5e8f\u3002\n</code></pre> <pre><code>-- \u5b57\u7b26\u8fde\u63a5\u51fd\u6570\nconcat(str1,str2,...])\nconcat_ws(separator,str1,str2,...)\n\n-- \u5206\u652f\u8bed\u53e5\nif \u6761\u4ef6 then\n    \u6267\u884c\u8bed\u53e5\nelseif \u6761\u4ef6 then\n    \u6267\u884c\u8bed\u53e5\nelse\n    \u6267\u884c\u8bed\u53e5\nend if;\n\n-- \u4fee\u6539\u6700\u5916\u5c42\u8bed\u53e5\u7ed3\u675f\u7b26\ndelimiter \u81ea\u5b9a\u4e49\u7ed3\u675f\u7b26\u53f7\n    SQL\u8bed\u53e5\n\u81ea\u5b9a\u4e49\u7ed3\u675f\u7b26\u53f7\ndelimiter ;     -- \u4fee\u6539\u56de\u539f\u6765\u7684\u5206\u53f7\n\n-- \u8bed\u53e5\u5757\u5305\u88f9\nbegin\n    \u8bed\u53e5\u5757\nend\n\n-- \u7279\u6b8a\u7684\u6267\u884c\n1. \u53ea\u8981\u6dfb\u52a0\u8bb0\u5f55\uff0c\u5c31\u4f1a\u89e6\u53d1\u7a0b\u5e8f\u3002\n2. Insert into on duplicate key update \u8bed\u6cd5\u4f1a\u89e6\u53d1\uff1a\n    \u5982\u679c\u6ca1\u6709\u91cd\u590d\u8bb0\u5f55\uff0c\u4f1a\u89e6\u53d1 before insert, after insert;\n    \u5982\u679c\u6709\u91cd\u590d\u8bb0\u5f55\u5e76\u66f4\u65b0\uff0c\u4f1a\u89e6\u53d1 before insert, before update, after update;\n    \u5982\u679c\u6709\u91cd\u590d\u8bb0\u5f55\u4f46\u662f\u6ca1\u6709\u53d1\u751f\u66f4\u65b0\uff0c\u5219\u89e6\u53d1 before insert, before update\n3. Replace \u8bed\u6cd5 \u5982\u679c\u6709\u8bb0\u5f55\uff0c\u5219\u6267\u884c before insert, before delete, after delete, after insert\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#sql","title":"SQL\u7f16\u7a0b","text":"<pre><code>--// \u5c40\u90e8\u53d8\u91cf ----------\n-- \u53d8\u91cf\u58f0\u660e\n    declare var_name[,...] type [default value]\n    \u8fd9\u4e2a\u8bed\u53e5\u88ab\u7528\u6765\u58f0\u660e\u5c40\u90e8\u53d8\u91cf\u3002\u8981\u7ed9\u53d8\u91cf\u63d0\u4f9b\u4e00\u4e2a\u9ed8\u8ba4\u503c\uff0c\u8bf7\u5305\u542b\u4e00\u4e2adefault\u5b50\u53e5\u3002\u503c\u53ef\u4ee5\u88ab\u6307\u5b9a\u4e3a\u4e00\u4e2a\u8868\u8fbe\u5f0f\uff0c\u4e0d\u9700\u8981\u4e3a\u4e00\u4e2a\u5e38\u6570\u3002\u5982\u679c\u6ca1\u6709default\u5b50\u53e5\uff0c\u521d\u59cb\u503c\u4e3anull\u3002\n-- \u8d4b\u503c\n    \u4f7f\u7528 set \u548c select into \u8bed\u53e5\u4e3a\u53d8\u91cf\u8d4b\u503c\u3002\n    - \u6ce8\u610f\uff1a\u5728\u51fd\u6570\u5185\u662f\u53ef\u4ee5\u4f7f\u7528\u5168\u5c40\u53d8\u91cf\uff08\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u53d8\u91cf\uff09\n\n--// \u5168\u5c40\u53d8\u91cf ----------\n-- \u5b9a\u4e49\u3001\u8d4b\u503c\nset \u8bed\u53e5\u53ef\u4ee5\u5b9a\u4e49\u5e76\u4e3a\u53d8\u91cf\u8d4b\u503c\u3002\nset @var = value;\n\u4e5f\u53ef\u4ee5\u4f7f\u7528select into\u8bed\u53e5\u4e3a\u53d8\u91cf\u521d\u59cb\u5316\u5e76\u8d4b\u503c\u3002\u8fd9\u6837\u8981\u6c42select\u8bed\u53e5\u53ea\u80fd\u8fd4\u56de\u4e00\u884c\uff0c\u4f46\u662f\u53ef\u4ee5\u662f\u591a\u4e2a\u5b57\u6bb5\uff0c\u5c31\u610f\u5473\u7740\u540c\u65f6\u4e3a\u591a\u4e2a\u53d8\u91cf\u8fdb\u884c\u8d4b\u503c\uff0c\u53d8\u91cf\u7684\u6570\u91cf\u9700\u8981\u4e0e\u67e5\u8be2\u7684\u5217\u6570\u4e00\u81f4\u3002\n\u8fd8\u53ef\u4ee5\u628a\u8d4b\u503c\u8bed\u53e5\u770b\u4f5c\u4e00\u4e2a\u8868\u8fbe\u5f0f\uff0c\u901a\u8fc7select\u6267\u884c\u5b8c\u6210\u3002\u6b64\u65f6\u4e3a\u4e86\u907f\u514d=\u88ab\u5f53\u4f5c\u5173\u7cfb\u8fd0\u7b97\u7b26\u770b\u5f85\uff0c\u4f7f\u7528:=\u4ee3\u66ff\u3002\uff08set\u8bed\u53e5\u53ef\u4ee5\u4f7f\u7528= \u548c :=\uff09\u3002\nselect @var:=20;\nselect @v1:=id, @v2=name from t1 limit 1;\nselect * from tbl_name where @var:=30;\nselect into \u53ef\u4ee5\u5c06\u8868\u4e2d\u67e5\u8be2\u83b7\u5f97\u7684\u6570\u636e\u8d4b\u7ed9\u53d8\u91cf\u3002\n    -| select max(height) into @max_height from tb;\n-- \u81ea\u5b9a\u4e49\u53d8\u91cf\u540d\n\u4e3a\u4e86\u907f\u514dselect\u8bed\u53e5\u4e2d\uff0c\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u53d8\u91cf\u4e0e\u7cfb\u7edf\u6807\u8bc6\u7b26\uff08\u901a\u5e38\u662f\u5b57\u6bb5\u540d\uff09\u51b2\u7a81\uff0c\u7528\u6237\u81ea\u5b9a\u4e49\u53d8\u91cf\u5728\u53d8\u91cf\u540d\u524d\u4f7f\u7528@\u4f5c\u4e3a\u5f00\u59cb\u7b26\u53f7\u3002\n@var=10;\n    - \u53d8\u91cf\u88ab\u5b9a\u4e49\u540e\uff0c\u5728\u6574\u4e2a\u4f1a\u8bdd\u5468\u671f\u90fd\u6709\u6548\uff08\u767b\u5f55\u5230\u9000\u51fa\uff09\n\n--// \u63a7\u5236\u7ed3\u6784 ----------\n-- if\u8bed\u53e5\nif search_condition then\n    statement_list   \n[elseif search_condition then\n    statement_list]\n...\n[else\n    statement_list]\nend if;\n-- case\u8bed\u53e5\nCASE value WHEN [compare-value] THEN result\n[WHEN [compare-value] THEN result ...]\n[ELSE result]\nEND\n-- while\u5faa\u73af\n[begin_label:] while search_condition do\n    statement_list\nend while [end_label];\n- \u5982\u679c\u9700\u8981\u5728\u5faa\u73af\u5185\u63d0\u524d\u7ec8\u6b62 while\u5faa\u73af\uff0c\u5219\u9700\u8981\u4f7f\u7528\u6807\u7b7e\uff1b\u6807\u7b7e\u9700\u8981\u6210\u5bf9\u51fa\u73b0\u3002\n    -- \u9000\u51fa\u5faa\u73af\n        \u9000\u51fa\u6574\u4e2a\u5faa\u73af leave\n        \u9000\u51fa\u5f53\u524d\u5faa\u73af iterate\n        \u901a\u8fc7\u9000\u51fa\u7684\u6807\u7b7e\u51b3\u5b9a\u9000\u51fa\u54ea\u4e2a\u5faa\u73af\n\n--// \u5185\u7f6e\u51fd\u6570 ----------\n-- \u6570\u503c\u51fd\u6570\nabs(x)          -- \u7edd\u5bf9\u503c abs(-10.9) = 10\nformat(x, d)    -- \u683c\u5f0f\u5316\u5343\u5206\u4f4d\u6570\u503c format(1234567.456, 2) = 1,234,567.46\nceil(x)         -- \u5411\u4e0a\u53d6\u6574 ceil(10.1) = 11\nfloor(x)        -- \u5411\u4e0b\u53d6\u6574 floor (10.1) = 10\nround(x)        -- \u56db\u820d\u4e94\u5165\u53bb\u6574\nmod(m, n)       -- m%n m mod n \u6c42\u4f59 10%3=1\npi()            -- \u83b7\u5f97\u5706\u5468\u7387\npow(m, n)       -- m^n\nsqrt(x)         -- \u7b97\u672f\u5e73\u65b9\u6839\nrand()          -- \u968f\u673a\u6570\ntruncate(x, d)  -- \u622a\u53d6d\u4f4d\u5c0f\u6570\n-- \u65f6\u95f4\u65e5\u671f\u51fd\u6570\nnow(), current_timestamp();     -- \u5f53\u524d\u65e5\u671f\u65f6\u95f4\ncurrent_date();                 -- \u5f53\u524d\u65e5\u671f\ncurrent_time();                 -- \u5f53\u524d\u65f6\u95f4\ndate( yyyy-mm-dd hh:ii:ss );    -- \u83b7\u53d6\u65e5\u671f\u90e8\u5206\ntime( yyyy-mm-dd hh:ii:ss );    -- \u83b7\u53d6\u65f6\u95f4\u90e8\u5206\ndate_format( yyyy-mm-dd hh:ii:ss ,  %d %y %a %d %m %b %j ); -- \u683c\u5f0f\u5316\u65f6\u95f4\nunix_timestamp();               -- \u83b7\u5f97unix\u65f6\u95f4\u6233\nfrom_unixtime();                -- \u4ece\u65f6\u95f4\u6233\u83b7\u5f97\u65f6\u95f4\n-- \u5b57\u7b26\u4e32\u51fd\u6570\nlength(string)          -- string\u957f\u5ea6\uff0c\u5b57\u8282\nchar_length(string)     -- string\u7684\u5b57\u7b26\u4e2a\u6570\nsubstring(str, position [,length])      -- \u4ecestr\u7684position\u5f00\u59cb,\u53d6length\u4e2a\u5b57\u7b26\nreplace(str ,search_str ,replace_str)   -- \u5728str\u4e2d\u7528replace_str\u66ff\u6362search_str\ninstr(string ,substring)    -- \u8fd4\u56desubstring\u9996\u6b21\u5728string\u4e2d\u51fa\u73b0\u7684\u4f4d\u7f6e\nconcat(string [,...])   -- \u8fde\u63a5\u5b57\u4e32\ncharset(str)            -- \u8fd4\u56de\u5b57\u4e32\u5b57\u7b26\u96c6\nlcase(string)           -- \u8f6c\u6362\u6210\u5c0f\u5199\nleft(string, length)    -- \u4ecestring2\u4e2d\u7684\u5de6\u8fb9\u8d77\u53d6length\u4e2a\u5b57\u7b26\nload_file(file_name)    -- \u4ece\u6587\u4ef6\u8bfb\u53d6\u5185\u5bb9\nlocate(substring, string [,start_position]) -- \u540cinstr,\u4f46\u53ef\u6307\u5b9a\u5f00\u59cb\u4f4d\u7f6e\nlpad(string, length, pad)   -- \u91cd\u590d\u7528pad\u52a0\u5728string\u5f00\u5934,\u76f4\u5230\u5b57\u4e32\u957f\u5ea6\u4e3alength\nltrim(string)           -- \u53bb\u9664\u524d\u7aef\u7a7a\u683c\nrepeat(string, count)   -- \u91cd\u590dcount\u6b21\nrpad(string, length, pad)   --\u5728str\u540e\u7528pad\u8865\u5145,\u76f4\u5230\u957f\u5ea6\u4e3alength\nrtrim(string)           -- \u53bb\u9664\u540e\u7aef\u7a7a\u683c\nstrcmp(string1 ,string2)    -- \u9010\u5b57\u7b26\u6bd4\u8f83\u4e24\u5b57\u4e32\u5927\u5c0f\n-- \u6d41\u7a0b\u51fd\u6570\ncase when [condition] then result [when [condition] then result ...] [else result] end   \u591a\u5206\u652f\nif(expr1,expr2,expr3)  \u53cc\u5206\u652f\u3002\n-- \u805a\u5408\u51fd\u6570\ncount()\nsum();\nmax();\nmin();\navg();\ngroup_concat()\n-- \u5176\u4ed6\u5e38\u7528\u51fd\u6570\nmd5();\ndefault();\n\n--// \u5b58\u50a8\u51fd\u6570\uff0c\u81ea\u5b9a\u4e49\u51fd\u6570 ----------\n-- \u65b0\u5efa\n    CREATE FUNCTION function_name (\u53c2\u6570\u5217\u8868) RETURNS \u8fd4\u56de\u503c\u7c7b\u578b\n        \u51fd\u6570\u4f53\n    - \u51fd\u6570\u540d\uff0c\u5e94\u8be5\u5408\u6cd5\u7684\u6807\u8bc6\u7b26\uff0c\u5e76\u4e14\u4e0d\u5e94\u8be5\u4e0e\u5df2\u6709\u7684\u5173\u952e\u5b57\u51b2\u7a81\u3002\n    - \u4e00\u4e2a\u51fd\u6570\u5e94\u8be5\u5c5e\u4e8e\u67d0\u4e2a\u6570\u636e\u5e93\uff0c\u53ef\u4ee5\u4f7f\u7528db_name.funciton_name\u7684\u5f62\u5f0f\u6267\u884c\u5f53\u524d\u51fd\u6570\u6240\u5c5e\u6570\u636e\u5e93\uff0c\u5426\u5219\u4e3a\u5f53\u524d\u6570\u636e\u5e93\u3002\n    - \u53c2\u6570\u90e8\u5206\uff0c\u7531\"\u53c2\u6570\u540d\"\u548c\"\u53c2\u6570\u7c7b\u578b\"\u7ec4\u6210\u3002\u591a\u4e2a\u53c2\u6570\u7528\u9017\u53f7\u9694\u5f00\u3002\n    - \u51fd\u6570\u4f53\u7531\u591a\u6761\u53ef\u7528\u7684mysql\u8bed\u53e5\uff0c\u6d41\u7a0b\u63a7\u5236\uff0c\u53d8\u91cf\u58f0\u660e\u7b49\u8bed\u53e5\u6784\u6210\u3002\n    - \u591a\u6761\u8bed\u53e5\u5e94\u8be5\u4f7f\u7528 begin...end \u8bed\u53e5\u5757\u5305\u542b\u3002\n    - \u4e00\u5b9a\u8981\u6709 return \u8fd4\u56de\u503c\u8bed\u53e5\u3002\n-- \u5220\u9664\n    DROP FUNCTION [IF EXISTS] function_name;\n-- \u67e5\u770b\n    SHOW FUNCTION STATUS LIKE  partten \n    SHOW CREATE FUNCTION function_name;\n-- \u4fee\u6539\n    ALTER FUNCTION function_name \u51fd\u6570\u9009\u9879\n\n--// \u5b58\u50a8\u8fc7\u7a0b\uff0c\u81ea\u5b9a\u4e49\u529f\u80fd ----------\n-- \u5b9a\u4e49\n\u5b58\u50a8\u5b58\u50a8\u8fc7\u7a0b \u662f\u4e00\u6bb5\u4ee3\u7801\uff08\u8fc7\u7a0b\uff09\uff0c\u5b58\u50a8\u5728\u6570\u636e\u5e93\u4e2d\u7684sql\u7ec4\u6210\u3002\n\u4e00\u4e2a\u5b58\u50a8\u8fc7\u7a0b\u901a\u5e38\u7528\u4e8e\u5b8c\u6210\u4e00\u6bb5\u4e1a\u52a1\u903b\u8f91\uff0c\u4f8b\u5982\u62a5\u540d\uff0c\u4ea4\u73ed\u8d39\uff0c\u8ba2\u5355\u5165\u5e93\u7b49\u3002\n\u800c\u4e00\u4e2a\u51fd\u6570\u901a\u5e38\u4e13\u6ce8\u4e0e\u67d0\u4e2a\u529f\u80fd\uff0c\u89c6\u4e3a\u5176\u4ed6\u7a0b\u5e8f\u670d\u52a1\u7684\uff0c\u9700\u8981\u5728\u5176\u4ed6\u8bed\u53e5\u4e2d\u8c03\u7528\u51fd\u6570\u624d\u53ef\u4ee5\uff0c\u800c\u5b58\u50a8\u8fc7\u7a0b\u4e0d\u80fd\u88ab\u5176\u4ed6\u8c03\u7528\uff0c\u662f\u81ea\u5df1\u6267\u884c \u901a\u8fc7call\u6267\u884c\u3002\n-- \u521b\u5efa\nCREATE PROCEDURE sp_name (\u53c2\u6570\u5217\u8868)\n    \u8fc7\u7a0b\u4f53\n\u53c2\u6570\u5217\u8868\uff1a\u4e0d\u540c\u4e8e\u51fd\u6570\u7684\u53c2\u6570\u5217\u8868\uff0c\u9700\u8981\u6307\u660e\u53c2\u6570\u7c7b\u578b\nIN\uff0c\u8868\u793a\u8f93\u5165\u578b\nOUT\uff0c\u8868\u793a\u8f93\u51fa\u578b\nINOUT\uff0c\u8868\u793a\u6df7\u5408\u578b\n\u6ce8\u610f\uff0c\u6ca1\u6709\u8fd4\u56de\u503c\u3002\n\n/* \u5b58\u50a8\u8fc7\u7a0b */ ------------------\n\u5b58\u50a8\u8fc7\u7a0b\u662f\u4e00\u6bb5\u53ef\u6267\u884c\u6027\u4ee3\u7801\u7684\u96c6\u5408\u3002\u76f8\u6bd4\u51fd\u6570\uff0c\u66f4\u504f\u5411\u4e8e\u4e1a\u52a1\u903b\u8f91\u3002\n\u8c03\u7528\uff1aCALL \u8fc7\u7a0b\u540d\n-- \u6ce8\u610f\n- \u6ca1\u6709\u8fd4\u56de\u503c\u3002\n- \u53ea\u80fd\u5355\u72ec\u8c03\u7528\uff0c\u4e0d\u53ef\u5939\u6742\u5728\u5176\u4ed6\u8bed\u53e5\u4e2d\n-- \u53c2\u6570\nIN|OUT|INOUT \u53c2\u6570\u540d \u6570\u636e\u7c7b\u578b\nIN      \u8f93\u5165\uff1a\u5728\u8c03\u7528\u8fc7\u7a0b\u4e2d\uff0c\u5c06\u6570\u636e\u8f93\u5165\u5230\u8fc7\u7a0b\u4f53\u5185\u90e8\u7684\u53c2\u6570\nOUT     \u8f93\u51fa\uff1a\u5728\u8c03\u7528\u8fc7\u7a0b\u4e2d\uff0c\u5c06\u8fc7\u7a0b\u4f53\u5904\u7406\u5b8c\u7684\u7ed3\u679c\u8fd4\u56de\u5230\u5ba2\u6237\u7aef\nINOUT   \u8f93\u5165\u8f93\u51fa\uff1a\u65e2\u53ef\u8f93\u5165\uff0c\u4e5f\u53ef\u8f93\u51fa\n-- \u8bed\u6cd5\nCREATE PROCEDURE \u8fc7\u7a0b\u540d (\u53c2\u6570\u5217\u8868)\nBEGIN\n    \u8fc7\u7a0b\u4f53\nEND\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_16","title":"\u7528\u6237\u548c\u6743\u9650\u7ba1\u7406","text":"<pre><code>-- root\u5bc6\u7801\u91cd\u7f6e\n1. \u505c\u6b62MySQL\u670d\u52a1\n2.  [Linux] /usr/local/mysql/bin/safe_mysqld --skip-grant-tables &amp;\n    [Windows] mysqld --skip-grant-tables\n3. use mysql;\n4. UPDATE `user` SET PASSWORD=PASSWORD(\"\u5bc6\u7801\") WHERE `user` = \"root\";\n5. FLUSH PRIVILEGES;\n\u7528\u6237\u4fe1\u606f\u8868\uff1amysql.user\n-- \u5237\u65b0\u6743\u9650\nFLUSH PRIVILEGES;\n-- \u589e\u52a0\u7528\u6237\nCREATE USER \u7528\u6237\u540d IDENTIFIED BY [PASSWORD] \u5bc6\u7801(\u5b57\u7b26\u4e32)\n    - \u5fc5\u987b\u62e5\u6709mysql\u6570\u636e\u5e93\u7684\u5168\u5c40CREATE USER\u6743\u9650\uff0c\u6216\u62e5\u6709INSERT\u6743\u9650\u3002\n    - \u53ea\u80fd\u521b\u5efa\u7528\u6237\uff0c\u4e0d\u80fd\u8d4b\u4e88\u6743\u9650\u3002\n    - \u7528\u6237\u540d\uff0c\u6ce8\u610f\u5f15\u53f7\uff1a\u5982  user_name @ 192.168.1.1 \n    - \u5bc6\u7801\u4e5f\u9700\u5f15\u53f7\uff0c\u7eaf\u6570\u5b57\u5bc6\u7801\u4e5f\u8981\u52a0\u5f15\u53f7\n    - \u8981\u5728\u7eaf\u6587\u672c\u4e2d\u6307\u5b9a\u5bc6\u7801\uff0c\u9700\u5ffd\u7565PASSWORD\u5173\u952e\u8bcd\u3002\u8981\u628a\u5bc6\u7801\u6307\u5b9a\u4e3a\u7531PASSWORD()\u51fd\u6570\u8fd4\u56de\u7684\u6df7\u7f16\u503c\uff0c\u9700\u5305\u542b\u5173\u952e\u5b57PASSWORD\n-- \u91cd\u547d\u540d\u7528\u6237\nRENAME USER old_user TO new_user\n-- \u8bbe\u7f6e\u5bc6\u7801\nSET PASSWORD = PASSWORD( \u5bc6\u7801 )  -- \u4e3a\u5f53\u524d\u7528\u6237\u8bbe\u7f6e\u5bc6\u7801\nSET PASSWORD FOR \u7528\u6237\u540d = PASSWORD( \u5bc6\u7801 ) -- \u4e3a\u6307\u5b9a\u7528\u6237\u8bbe\u7f6e\u5bc6\u7801\n-- \u5220\u9664\u7528\u6237\nDROP USER \u7528\u6237\u540d\n-- \u5206\u914d\u6743\u9650/\u6dfb\u52a0\u7528\u6237\nGRANT \u6743\u9650\u5217\u8868 ON \u8868\u540d TO \u7528\u6237\u540d [IDENTIFIED BY [PASSWORD]  password ]\n    - all privileges \u8868\u793a\u6240\u6709\u6743\u9650\n    - *.* \u8868\u793a\u6240\u6709\u5e93\u7684\u6240\u6709\u8868\n    - \u5e93\u540d.\u8868\u540d \u8868\u793a\u67d0\u5e93\u4e0b\u9762\u7684\u67d0\u8868\n    GRANT ALL PRIVILEGES ON `pms`.* TO  pms @ %  IDENTIFIED BY  pms0817 ;\n-- \u67e5\u770b\u6743\u9650\nSHOW GRANTS FOR \u7528\u6237\u540d\n    -- \u67e5\u770b\u5f53\u524d\u7528\u6237\u6743\u9650\n    SHOW GRANTS; \u6216 SHOW GRANTS FOR CURRENT_USER; \u6216 SHOW GRANTS FOR CURRENT_USER();\n-- \u64a4\u6d88\u6743\u9650\nREVOKE \u6743\u9650\u5217\u8868 ON \u8868\u540d FROM \u7528\u6237\u540d\nREVOKE ALL PRIVILEGES, GRANT OPTION FROM \u7528\u6237\u540d   -- \u64a4\u9500\u6240\u6709\u6743\u9650\n-- \u6743\u9650\u5c42\u7ea7\n-- \u8981\u4f7f\u7528GRANT\u6216REVOKE\uff0c\u60a8\u5fc5\u987b\u62e5\u6709GRANT OPTION\u6743\u9650\uff0c\u5e76\u4e14\u60a8\u5fc5\u987b\u7528\u4e8e\u60a8\u6b63\u5728\u6388\u4e88\u6216\u64a4\u9500\u7684\u6743\u9650\u3002\n\u5168\u5c40\u5c42\u7ea7\uff1a\u5168\u5c40\u6743\u9650\u9002\u7528\u4e8e\u4e00\u4e2a\u7ed9\u5b9a\u670d\u52a1\u5668\u4e2d\u7684\u6240\u6709\u6570\u636e\u5e93\uff0cmysql.user\n    GRANT ALL ON *.*\u548c REVOKE ALL ON *.*\u53ea\u6388\u4e88\u548c\u64a4\u9500\u5168\u5c40\u6743\u9650\u3002\n\u6570\u636e\u5e93\u5c42\u7ea7\uff1a\u6570\u636e\u5e93\u6743\u9650\u9002\u7528\u4e8e\u4e00\u4e2a\u7ed9\u5b9a\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u76ee\u6807\uff0cmysql.db, mysql.host\n    GRANT ALL ON db_name.*\u548cREVOKE ALL ON db_name.*\u53ea\u6388\u4e88\u548c\u64a4\u9500\u6570\u636e\u5e93\u6743\u9650\u3002\n\u8868\u5c42\u7ea7\uff1a\u8868\u6743\u9650\u9002\u7528\u4e8e\u4e00\u4e2a\u7ed9\u5b9a\u8868\u4e2d\u7684\u6240\u6709\u5217\uff0cmysql.talbes_priv\n    GRANT ALL ON db_name.tbl_name\u548cREVOKE ALL ON db_name.tbl_name\u53ea\u6388\u4e88\u548c\u64a4\u9500\u8868\u6743\u9650\u3002\n\u5217\u5c42\u7ea7\uff1a\u5217\u6743\u9650\u9002\u7528\u4e8e\u4e00\u4e2a\u7ed9\u5b9a\u8868\u4e2d\u7684\u5355\u4e00\u5217\uff0cmysql.columns_priv\n    \u5f53\u4f7f\u7528REVOKE\u65f6\uff0c\u60a8\u5fc5\u987b\u6307\u5b9a\u4e0e\u88ab\u6388\u6743\u5217\u76f8\u540c\u7684\u5217\u3002\n-- \u6743\u9650\u5217\u8868\nALL [PRIVILEGES]    -- \u8bbe\u7f6e\u9664GRANT OPTION\u4e4b\u5916\u7684\u6240\u6709\u7b80\u5355\u6743\u9650\nALTER   -- \u5141\u8bb8\u4f7f\u7528ALTER TABLE\nALTER ROUTINE   -- \u66f4\u6539\u6216\u53d6\u6d88\u5df2\u5b58\u50a8\u7684\u5b50\u7a0b\u5e8f\nCREATE  -- \u5141\u8bb8\u4f7f\u7528CREATE TABLE\nCREATE ROUTINE  -- \u521b\u5efa\u5df2\u5b58\u50a8\u7684\u5b50\u7a0b\u5e8f\nCREATE TEMPORARY TABLES     -- \u5141\u8bb8\u4f7f\u7528CREATE TEMPORARY TABLE\nCREATE USER     -- \u5141\u8bb8\u4f7f\u7528CREATE USER, DROP USER, RENAME USER\u548cREVOKE ALL PRIVILEGES\u3002\nCREATE VIEW     -- \u5141\u8bb8\u4f7f\u7528CREATE VIEW\nDELETE  -- \u5141\u8bb8\u4f7f\u7528DELETE\nDROP    -- \u5141\u8bb8\u4f7f\u7528DROP TABLE\nEXECUTE     -- \u5141\u8bb8\u7528\u6237\u8fd0\u884c\u5df2\u5b58\u50a8\u7684\u5b50\u7a0b\u5e8f\nFILE    -- \u5141\u8bb8\u4f7f\u7528SELECT...INTO OUTFILE\u548cLOAD DATA INFILE\nINDEX   -- \u5141\u8bb8\u4f7f\u7528CREATE INDEX\u548cDROP INDEX\nINSERT  -- \u5141\u8bb8\u4f7f\u7528INSERT\nLOCK TABLES     -- \u5141\u8bb8\u5bf9\u60a8\u62e5\u6709SELECT\u6743\u9650\u7684\u8868\u4f7f\u7528LOCK TABLES\nPROCESS     -- \u5141\u8bb8\u4f7f\u7528SHOW FULL PROCESSLIST\nREFERENCES  -- \u672a\u88ab\u5b9e\u65bd\nRELOAD  -- \u5141\u8bb8\u4f7f\u7528FLUSH\nREPLICATION CLIENT  -- \u5141\u8bb8\u7528\u6237\u8be2\u95ee\u4ece\u5c5e\u670d\u52a1\u5668\u6216\u4e3b\u670d\u52a1\u5668\u7684\u5730\u5740\nREPLICATION SLAVE   -- \u7528\u4e8e\u590d\u5236\u578b\u4ece\u5c5e\u670d\u52a1\u5668\uff08\u4ece\u4e3b\u670d\u52a1\u5668\u4e2d\u8bfb\u53d6\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e8b\u4ef6\uff09\nSELECT  -- \u5141\u8bb8\u4f7f\u7528SELECT\nSHOW DATABASES  -- \u663e\u793a\u6240\u6709\u6570\u636e\u5e93\nSHOW VIEW   -- \u5141\u8bb8\u4f7f\u7528SHOW CREATE VIEW\nSHUTDOWN    -- \u5141\u8bb8\u4f7f\u7528mysqladmin shutdown\nSUPER   -- \u5141\u8bb8\u4f7f\u7528CHANGE MASTER, KILL, PURGE MASTER LOGS\u548cSET GLOBAL\u8bed\u53e5\uff0cmysqladmin debug\u547d\u4ee4\uff1b\u5141\u8bb8\u60a8\u8fde\u63a5\uff08\u4e00\u6b21\uff09\uff0c\u5373\u4f7f\u5df2\u8fbe\u5230max_connections\u3002\nUPDATE  -- \u5141\u8bb8\u4f7f\u7528UPDATE\nUSAGE   -- \u201c\u65e0\u6743\u9650\u201d\u7684\u540c\u4e49\u8bcd\nGRANT OPTION    -- \u5141\u8bb8\u6388\u4e88\u6743\u9650\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_17","title":"\u8868\u7ef4\u62a4","text":"<pre><code>-- \u5206\u6790\u548c\u5b58\u50a8\u8868\u7684\u5173\u952e\u5b57\u5206\u5e03\nANALYZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE \u8868\u540d ...\n-- \u68c0\u67e5\u4e00\u4e2a\u6216\u591a\u4e2a\u8868\u662f\u5426\u6709\u9519\u8bef\nCHECK TABLE tbl_name [, tbl_name] ... [option] ...\noption = {QUICK | FAST | MEDIUM | EXTENDED | CHANGED}\n-- \u6574\u7406\u6570\u636e\u6587\u4ef6\u7684\u788e\u7247\nOPTIMIZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tbl_name [, tbl_name] ...\n</code></pre>"},{"location":"MySQL-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#_18","title":"\u6742\u9879","text":"<pre><code>1. \u53ef\u7528\u53cd\u5f15\u53f7\uff08`\uff09\u4e3a\u6807\u8bc6\u7b26\uff08\u5e93\u540d\u3001\u8868\u540d\u3001\u5b57\u6bb5\u540d\u3001\u7d22\u5f15\u3001\u522b\u540d\uff09\u5305\u88f9\uff0c\u4ee5\u907f\u514d\u4e0e\u5173\u952e\u5b57\u91cd\u540d\uff01\u4e2d\u6587\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u6807\u8bc6\u7b26\uff01\n2. \u6bcf\u4e2a\u5e93\u76ee\u5f55\u5b58\u5728\u4e00\u4e2a\u4fdd\u5b58\u5f53\u524d\u6570\u636e\u5e93\u7684\u9009\u9879\u6587\u4ef6db.opt\u3002\n3. \u6ce8\u91ca\uff1a\n    \u5355\u884c\u6ce8\u91ca # \u6ce8\u91ca\u5185\u5bb9\n    \u591a\u884c\u6ce8\u91ca /* \u6ce8\u91ca\u5185\u5bb9 */\n    \u5355\u884c\u6ce8\u91ca -- \u6ce8\u91ca\u5185\u5bb9     (\u6807\u51c6SQL\u6ce8\u91ca\u98ce\u683c\uff0c\u8981\u6c42\u53cc\u7834\u6298\u53f7\u540e\u52a0\u4e00\u7a7a\u683c\u7b26\uff08\u7a7a\u683c\u3001TAB\u3001\u6362\u884c\u7b49\uff09)\n4. \u6a21\u5f0f\u901a\u914d\u7b26\uff1a\n    _   \u4efb\u610f\u5355\u4e2a\u5b57\u7b26\n    %   \u4efb\u610f\u591a\u4e2a\u5b57\u7b26\uff0c\u751a\u81f3\u5305\u62ec\u96f6\u5b57\u7b26\n    \u5355\u5f15\u53f7\u9700\u8981\u8fdb\u884c\u8f6c\u4e49  \n5. CMD\u547d\u4ee4\u884c\u5185\u7684\u8bed\u53e5\u7ed3\u675f\u7b26\u53ef\u4ee5\u4e3a \";\", \"G\", \"g\"\uff0c\u4ec5\u5f71\u54cd\u663e\u793a\u7ed3\u679c\u3002\u5176\u4ed6\u5730\u65b9\u8fd8\u662f\u7528\u5206\u53f7\u7ed3\u675f\u3002delimiter \u53ef\u4fee\u6539\u5f53\u524d\u5bf9\u8bdd\u7684\u8bed\u53e5\u7ed3\u675f\u7b26\u3002\n6. SQL\u5bf9\u5927\u5c0f\u5199\u4e0d\u654f\u611f\n7. \u6e05\u9664\u5df2\u6709\u8bed\u53e5\uff1ac\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/","title":"Python Re \u6a21\u5757\u8d85\u5168\u89e3\u8bfb","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#re","title":"re\u6a21\u5757\u4e0b\u7684\u51fd\u6570","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#compilepattern","title":"compile(pattern)\uff1a\u521b\u5efa\u6a21\u5f0f\u5bf9\u8c61","text":"<pre><code>import re\npat=re.compile('A')\nm=pat.search('CBA')                    #\u7b49\u4ef7\u4e8e re.search('A','CBA')\nprint m\n&lt;_sre.SRE_Match object at 0x9d690c8&gt;   #\u5339\u914d\u5230\u4e86\uff0c\u8fd4\u56deMatchObject\uff08True\uff09\nm=pat.search('CBD')\nprint m\nNone                                   #\u6ca1\u6709\u5339\u914d\u5230\uff0c\u8fd4\u56deNone\uff08False\uff09\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#searchpatternstring","title":"search(pattern,string)\uff1a\u5728\u5b57\u7b26\u4e32\u4e2d\u5bfb\u627e\u6a21\u5f0f","text":"<pre><code>m = re.search('asd','ASDasd')\nprint m\n&lt;_sre.SRE_Match object at 0xb72cd6e8&gt;  #\u5339\u914d\u5230\u4e86\uff0c\u8fd4\u56deMatchObject\uff08True\uff09\nm = re.search('asd','ASDASD')\nprint m\nNone                                   #\u6ca1\u6709\u5339\u914d\u5230\uff0c\u8fd4\u56deNone\uff08False\uff09\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#matchpatternstring","title":"match(pattern,string)\uff1a\u5728\u5b57\u7b26\u4e32\u5f00\u59cb\u5904\u5339\u914d\u6a21\u5f0f","text":"<pre><code>m = re.search('asd','ASDasd')\nprint m\n&lt;_sre.SRE_Match object at 0xb72cd6e8&gt;  #\u5339\u914d\u5230\u4e86\uff0c\u8fd4\u56deMatchObject\uff08True\uff09\nm = re.search('asd','ASDASD')\nprint m\nNone                                   #\u6ca1\u6709\u5339\u914d\u5230\uff0c\u8fd4\u56deNone\uff08False\uff09\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_1","title":"\u7b49\u4ef7\u4e8e","text":"<pre><code>pat=re.compile('a')\nprint pat.match('Aasd')\nNone\nprintpat.match('aASD')\n&lt;_sre.SRE_Match object at 0xb72cd6e8&gt;\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#if","title":"\u4e0a\u9762\u7684\u51fd\u6570\u8fd4\u56de\u90fd\u53ef\u4ee5\u5728if\u6761\u4ef6\u8bed\u53e5\u4e2d\u8fdb\u884c\u5224\u65ad\uff1a","text":"<pre><code>if pat.search('asd'):\n...     print 'OK'\n...\nOK        #\u627e\u5230\u8fd4\u56de\nif re.search('a','ASD'):\n...     print \"OK\"\n...       #\u6ca1\u6709\u627e\u5230\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#splitpatternstring","title":"split(pattern,string)\uff1a\u6839\u636e\u6a21\u5f0f\u5206\u5272\u5b57\u7b26\u4e32,\u8fd4\u56de\u5217\u8868","text":"<pre><code>re.split(',','a,s,d,asd')\n['a', 's', 'd', 'asd']          #\u8fd4\u56de\u5217\u8868\npat = re.compile(',')\npat.split('a,s,d,asd')\n['a', 's', 'd', 'asd']          #\u8fd4\u56de\u5217\u8868\nre.split('[, ]+','a ,  s  ,d     ,,,,,asd')   #\u6b63\u5219\u5339\u914d\uff1a[, ]+\uff0c\u540e\u9762\u8bf4\u660e\n['a', 's', 'd', 'asd']\nre.split('[, ]+','a ,  s  ,d     ,,,,,asd',maxsplit=2) # maxsplit \u6700\u591a\u5206\u5272\u6b21\u6570\n['a', 's', 'd     ,,,,,asd']\npat = re.compile('[, ]+')                     #\u6b63\u5219\u5339\u914d\uff1a[, ]+\uff0c\u540e\u9762\u8bf4\u660e\npat.split('a ,  s  ,d     ,,,,,asd',maxsplit=2)        # maxsplit \u6700\u591a\u5206\u5272\u6b21\u6570\n['a', 's', 'd     ,,,,,asd']\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#findallpatternstring","title":"findall(pattern,string)\uff1a\u5217\u8868\u5f62\u5f0f\u8fd4\u56de\u5339\u914d\u9879","text":"<pre><code>re.findall('a','ASDaDFGAa')\n['a', 'a']                           #\u5217\u8868\u5f62\u5f0f\u8fd4\u56de\u5339\u914d\u5230\u7684\u5b57\u7b26\u4e32\npat = re.compile('a')\npat.findall('ASDaDFGAa')\n['a', 'a']                           #\u5217\u8868\u5f62\u5f0f\u8fd4\u56de\u5339\u914d\u5230\u7684\u5b57\u7b26\u4e32\npat = re.compile('[A-Z]+')       #\u6b63\u5219\u5339\u914d\uff1a'[A-Z]+' \u540e\u9762\u6709\u8bf4\u660e\npat.findall('ASDcDFGAa')\n['ASD', 'DFGA']                      #\u627e\u5230\u5339\u914d\u5230\u7684\u5b57\u7b26\u4e32\npat = re.compile('[A-Z]')\npat.findall('ASDcDFGAa')         #\u6b63\u5219\u5339\u914d\uff1a'[A-Z]+' \u540e\u9762\u6709\u8bf4\u660e\n['A', 'S', 'D', 'D', 'F', 'G', 'A']  #\u627e\u5230\u5339\u914d\u5230\u7684\u5b57\u7b26\u4e32\npat = re.compile('[A-Za-z]')     #\u6b63\u5219\u5339\u914d\uff1a'[A-Za-z]+' \u5339\u914d\u6240\u6709\u5355\u8bcd\uff0c\u540e\u9762\u6709\u8bf4\u660e\npat.findall('ASDcDFGAa')\n['A', 'S', 'D', 'c', 'D', 'F', 'G', 'A', 'a']\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#subpatreplstring-repl-pat","title":"sub(pat,repl,string) \uff1a\u7528repl\u66ff\u6362 pat\u5339\u914d\u9879","text":"<p>(\u7559\u7684\u662f\u4e2d\u95f4\u7684\uff0c\u56e0\u4e3a\u4e2d\u95f4\u5728\u4e2d\u5fc3)</p> <pre><code>re.sub('a','A','abcasd')   #\u627e\u5230a\u7528A\u66ff\u6362\uff0c\u540e\u9762\u89c1\u548cgroup\u7684\u914d\u5408\u4f7f\u7528\n'AbcAsd'\npat = re.compile('a')\npat.sub('A','abcasd')\n'AbcAsd'\npat=re.compile(r'www\\.(.*)\\..{3}') #\u6b63\u5219\u8868\u8fbe\u5f0f\n#\u5728Python\u7684string\u524d\u9762\u52a0\u4e0a\u2018r\u2019\uff0c \u662f\u4e3a\u4e86\u544a\u8bc9\u7f16\u8bd1\u5668\u8fd9\u4e2astring\u662f\u4e2araw string\uff0c\u4e0d\u8981\u8f6c\u8bd1\u53cd\u659c\u6760 '\\' \u3002\n#\u4f8b\u5982\uff0c\\n \u5728raw string\u4e2d\uff0c\u662f\u4e24\u4e2a\u5b57\u7b26\uff0c\\\u548cn\uff0c \u800c\u4e0d\u4f1a\u8f6c\u8bd1\u4e3a\u6362\u884c\u7b26\u3002\n#\u7531\u4e8e\u6b63\u5219\u8868\u8fbe\u5f0f\u548c \\ \u4f1a\u6709\u51b2\u7a81\uff0c\u56e0\u6b64\uff0c\u5f53\u4e00\u4e2a\u5b57\u7b26\u4e32\u4f7f\u7528\u4e86\u6b63\u5219\u8868\u8fbe\u5f0f\u540e\uff0c\u6700\u597d\u5728\u524d\u9762\u52a0\u4e0a'r'\u3002\n#\u4e0e\u5927\u591a\u6570\u7f16\u7a0b\u8bed\u8a00\u76f8\u540c\uff0c\u6b63\u5219\u8868\u8fbe\u5f0f\u91cc\u4f7f\u7528\"\\\"\u4f5c\u4e3a\u8f6c\u4e49\u5b57\u7b26\uff0c\u8fd9\u5c31\u53ef\u80fd\u9020\u6210\u53cd\u659c\u6760\u56f0\u6270\u3002\n#\u5047\u5982\u4f60\u9700\u8981\u5339\u914d\u6587\u672c\u4e2d\u7684\u5b57\u7b26\"\\\"\uff0c\u90a3\u4e48\u4f7f\u7528\u7f16\u7a0b\u8bed\u8a00\u8868\u793a\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u91cc\u5c06\u9700\u89814\u4e2a\u53cd\u659c\u6760\"\\\\\\\\\"\uff1a\n#\u524d\u4e24\u4e2a\u548c\u540e\u4e24\u4e2a\u5206\u522b\u7528\u4e8e\u5728\u7f16\u7a0b\u8bed\u8a00\u91cc\u8f6c\u4e49\u6210\u53cd\u659c\u6760\uff0c\u8f6c\u6362\u6210\u4e24\u4e2a\u53cd\u659c\u6760\u540e\u518d\u5728\u6b63\u5219\u8868\u8fbe\u5f0f\u91cc\u8f6c\u4e49\u6210\u4e00\u4e2a\u53cd\u659c\u6760\u3002\n#Python\u91cc\u7684\u539f\u751f\u5b57\u7b26\u4e32\u5f88\u597d\u5730\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\uff0c\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u53ef\u4ee5\u4f7f\u7528r\"\\\\\"\u8868\u793a\u3002\n#\u540c\u6837\uff0c\u5339\u914d\u4e00\u4e2a\u6570\u5b57\u7684\"\\\\d\"\u53ef\u4ee5\u5199\u6210r\"\\d\"\u3002\n#\u6709\u4e86\u539f\u751f\u5b57\u7b26\u4e32\uff0c\u4f60\u518d\u4e5f\u4e0d\u7528\u62c5\u5fc3\u662f\u4e0d\u662f\u6f0f\u5199\u4e86\u53cd\u659c\u6760\uff0c\u5199\u51fa\u6765\u7684\u8868\u8fbe\u5f0f\u4e5f\u66f4\u76f4\u89c2\u3002\n#\u4e0d\u662f\u8bf4 \u52a0\u4e86r \\\u5c31\u6ca1\u6709\u8f6c\u8bd1\u529f\u80fd\uff0c\u597d\u4e71\uff0c\u5c31\u76f4\u63a5\u8bb0\u4f4f1\u53e5\u8bdd\uff1a\n#\u5f53\u4e00\u4e2a\u5b57\u7b26\u4e32\u4f7f\u7528\u4e86\u6b63\u5219\u8868\u8fbe\u5f0f\u540e\uff0c\u6700\u597d\u5728\u524d\u9762\u52a0\u4e0a'r'\uff0c\u8fd9\u6837\u4f60\u518d\u4e5f\u4e0d\u7528\u62c5\u5fc3\u662f\u4e0d\u662f\u6f0f\u5199\u4e86\u53cd\u659c\u6760\uff0c\u5199\u51fa\u6765\u7684\u8868\u8fbe\u5f0f\u4e5f\u66f4\u76f4\u89c2\npat.match('www.dxy.com').group(1)\n'dxy'\nre.sub(r'www\\.(.*)\\..{3}',r'\\1','hello,www.dxy.com')\npat.sub(r'\\1','hello,www.dxy.com')\n'hello,dxy'\n# r'1' \u662f\u7b2c\u4e00\u7ec4\u7684\u610f\u601d\n#\u901a\u8fc7\u6b63\u5219\u5339\u914d\u627e\u5230\u7b26\u5408\u89c4\u5219\u7684\"www.dxy.com\" \uff0c\u53d6\u5f97 \u7ec41\u5b57\u7b26\u4e32 \u53bb\u66ff\u6362 \u6574\u4e2a\u5339\u914d\u3002\npat=re.compile(r'(\\w+) (\\w+)')     #\u6b63\u5219\u8868\u8fbe\u5f0f\ns='hello world ! hello hz !'\npat.findall('hello world ! hello hz !')\n[('hello', 'world'), ('hello', 'hz')]\npat.sub(r'\\2 \\1',s)                #\u901a\u8fc7\u6b63\u5219\u5f97\u5230\u7ec41(hello)\uff0c\u7ec42(world)\uff0c\u518d\u901a\u8fc7sub\u53bb\u66ff\u6362\u3002\u5373\u7ec41\u66ff\u6362\u7ec42\uff0c\u7ec42\u66ff\u6362\u7ec41\uff0c\u8c03\u6362\u4f4d\u7f6e\u3002  \n'world hello!hz hello!'\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#escapestring","title":"escape(string) \uff1a\u5bf9\u5b57\u7b26\u4e32\u91cc\u9762\u7684\u7279\u6b8a\u5b57\u7b26\u4e32\u8fdb\u884c\u8f6c\u4e49","text":"<pre><code>re.escape('www.dxy.cn')\n'www\\\\.dxy\\\\.cn'                   #\u8f6c\u4e49\n</code></pre> <p>\u4e0a\u9762\u7684\u51fd\u6570\u4e2d\uff0c\u53ea\u6709match\u3001search\u6709group\u65b9\u6cd5\uff0c\u5176\u4ed6\u7684\u51fd\u6570\u6ca1\u6709\u3002</p>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_2","title":"\u51fd\u6570\u7684\u65b9\u6cd5","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#group","title":"group\uff1a\u83b7\u53d6\u5b50\u6a21\u5f0f(\u7ec4)\u7684\u5339\u914d\u9879","text":"<pre><code>pat = re.compile(r'www\\.(.*)\\.(.*)')       #\u7528()\u8868\u793a1\u4e2a\u7ec4\uff0c2\u4e2a\u7ec4\nm = pat.match('www.dxy.com')\nm.group()                                  #\u9ed8\u8ba4\u4e3a0\uff0c\u8868\u793a\u5339\u914d\u6574\u4e2a\u5b57\u7b26\u4e32  \n'www.dxy.com'\nm.group(1)                                 #\u8fd4\u56de\u7ed9\u5b9a\u7ec41\u5339\u914d\u7684\u5b50\u5b57\u7b26\u4e32\n'dxy'\nm.group(2)\n'com'\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#start","title":"start\uff1a\u7ed9\u5b9a\u7ec4\u5339\u914d\u9879\u7684\u5f00\u59cb\u4f4d\u7f6e","text":"<pre><code>m.start(2)                                 #\u7ec42\u5f00\u59cb\u7684\u7d22\u5f15\n8\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#end","title":"end\uff1a\u7ed9\u5b9a\u7ec4\u5339\u914d\u9879\u7684\u7ed3\u675f\u4f4d\u7f6e","text":"<pre><code>m.end(2)                                   #\u7ec42\u7ed3\u675f\u7684\u7d22\u5f15\n11\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#span","title":"span\uff1a \u7ed9\u5b9a\u7ec4\u5339\u914d\u9879\u7684\u5f00\u59cb\u7ed3\u675f\u4f4d\u7f6e","text":"<pre><code>m.span(2)                                  #\u7ec42\u5f00\u59cb\u3001\u7ed3\u675f\u7684\u7d22\u5f15\n(8, 11)\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_3","title":"\u6b63\u5219\u8868\u8fbe\u5f0f","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_4","title":"\u5143\u5b57\u7b26","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#1","title":"\u201c.\u201d \uff1a\u901a\u914d\u7b26,\u9664\u6362\u884c\u7b26\u5916\u7684\u4efb\u610f\u76841\u4e2a\u5b57\u7b26","text":"<pre><code>pat=re.compile('.')\npat.match('abc')\n&lt;_sre.SRE_Match object at 0xb72b6170&gt;\npat.match('abc').group()\n'a'                                #\u5339\u914d\u5230\u4e86\u9996\u4e2a\u5b57\u7b26\npat.search('abc').group()\n'a'\npat.match('\\n').group()        #\u6362\u884c\u7b26\u5339\u914d\u51fa\u9519\nTraceback (most recent call last):\nFile \"&lt;stdin&gt;\", line 1, in &lt;module&gt;\nAttributeError: 'NoneType' object has no attribute 'group'\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_5","title":"\u201c\\\u201d : \u8f6c\u4e49\u7b26","text":"<pre><code>pat=re.compile('\\.')\npat.search('abc.efg').group()  #\u5339\u914d\u5230.\n'.'\npat.findall('abc.efg')         #\u4e0d\u7528group,\u8fd4\u56de\u5217\u8868\n['.']\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_6","title":"\u201c[\u2026]\u201d : \u5b57\u7b26\u96c6\u5408\uff0c\u5339\u914d\u91cc\u9762\u7684\u4efb\u610f\u4e00\u4e2a\u5143\u7d20","text":"<pre><code>&gt;&gt;&gt; pat=re.compile('[abc]')\n&gt;&gt;&gt; pat.match('axbycz').group()\n'a'\n&gt;&gt;&gt; pat.search('axbycz').group()\n'a'\n&gt;&gt;&gt; pat.findall('axbycz')\n['a', 'b', 'c']\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#d","title":"\u201c\\d\u201d : \u6570\u5b57","text":"<pre><code>&gt;&gt;&gt; pat=re.compile('\\d')          \n&gt;&gt;&gt; pat.search('ax1by2cz3').group()   #\u5339\u914d\u5230\u7b2c\u4e00\u4e2a\u6570\u5b57:1\uff0c\u8fd4\u56de\n'1'\n&gt;&gt;&gt; pat.match('ax1by2cz3').group()    #\u5339\u914d\u4e0d\u5230\uff08\u9996\u4e2a\u4e0d\u662f\uff09\u8fd4\u56deNone\uff0c\u62a5\u9519\uff0cmatch\u5339\u914d\u5b57\u7b26\u4e32\u5934\nTraceback (most recent call last):\nFile \"&lt;stdin&gt;\", line 1, in &lt;module&gt;\nAttributeError: 'NoneType' object has no attribute 'group'\n&gt;&gt;&gt; pat.findall('ax1by2cz3')          #\u5339\u914d\u6240\u6709\u7684\u6570\u5b57\uff0c\u5217\u8868\u8fd4\u56de\n['1', '2', '3']\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#d_1","title":"\u201c\\D\u201d : \u975e\u6570\u5b57","text":"<pre><code>&gt;&gt;&gt; pat=re.compile('\\D')\n&gt;&gt;&gt; pat.match('ax1by2cz3').group()\n'a'\n&gt;&gt;&gt; pat.search('ax1by2cz3').group()\n'a'\n&gt;&gt;&gt; pat.findall('ax1by2cz3')\n['a', 'x', 'b', 'y', 'c', 'z']\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#s-trn","title":"\u201c\\s\u201d \uff1a\u7a7a\u767d\u5b57\u7b26 \u3001 \\t\u3001\\r\u3001\\n\u3001\u7a7a\u683c","text":"<pre><code>&gt;&gt;&gt; pat=re.compile('\\s')\n&gt;&gt;&gt; pat.findall('\\rax1 \\nby2 \\tcz3')\n['\\r', ' ', '\\n', ' ', '\\t']\n&gt;&gt;&gt; pat.search('\\rax1 \\nby2 \\tcz3').group()\n'\\r'\n&gt;&gt;&gt; pat.match('\\rax1 \\nby2 \\tcz3').group()\n'\\r'\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#s","title":"\u201cS\u201d :\u975e\u7a7a\u767d\u5b57\u7b26","text":"<pre><code>&gt;&gt;&gt; pat=re.compile('\\S')\n&gt;&gt;&gt; pat.search('\\rax1 \\nby2 \\tcz3').group()\n'a'\n&gt;&gt;&gt; pat.findall('\\rax1 \\nby2 \\tcz3')\n['a', 'x', '1', 'b', 'y', '2', 'c', 'z', '3']\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#w-a-za-z0-9","title":"\u201c\\w\u201d \uff1a\u5355\u4e2a\u7684 \u6570\u5b57\u548c\u5b57\u6bcd\uff0c[A-Za-z0-9]","text":"<pre><code>&gt;&gt;&gt; pat=re.compile('\\w')\n&gt;&gt;&gt; pat.search('1a2b3c').group()\n'1'\n&gt;&gt;&gt; pat.findall('1a2b3c')\n['1', 'a', '2', 'b', '3', 'c']\n&gt;&gt;&gt; pat.match('1a2b3c').group()\n'1'\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#w","title":"\u201c\\W\u201d:\u975e\u5355\u8bcd\u5b57\u7b26,\u9664\u6570\u5b57\u548c\u5b57\u6bcd\u5916","text":"<pre><code>&gt;&gt;&gt; pat=re.compile('\\W')\n&gt;&gt;&gt; pat.findall('1a2\u6211b3c') #python\u662f\u7528\u4e09\u5b57\u8282\u8868\u793a\u4e00\u4e2a\u6c49\u5b57\n['\\xe6', '\\x88', '\\x91']\n&gt;&gt;&gt; pat.search('1a2\u6211b3c').group()\n'\\xe6'\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_7","title":"\u6570\u91cf\u8bcd","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#0","title":"\u201c*\u201d \uff1a0\u6b21\u6216\u591a\u6b21","text":"<p>\uff08 \u4e580\u4f1a\u53d8\u62100\uff09</p> <pre><code>&gt;&gt;&gt; pat = re.compile('[abc]*')\n&gt;&gt;&gt; pat.match('abcabcdefabc').group()\n'abcabc'                              #2\u6b21\n&gt;&gt;&gt; pat.search('abcabcdefabc').group()\n'abcabc'                              #2\u6b21\n&gt;&gt;&gt; pat.findall('abcabcdefabc')\n['abcabc', '', '', '', 'abc', '']     #2\u6b21\u548c1\u6b21,\u56e0\u4e3a\u67090\u6b21\uff0c\u6240\u4ee5\u5339\u914d\u4e86''\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#1_1","title":"\u201c+\u201d \uff1a1\u6b21\u6216\u591a\u6b21","text":"<p>\uff08 \u52a00\u4e0d\u4f1a\u53d8\u62100\uff09</p> <pre><code>&gt;&gt;&gt; pat = re.compile('[abc]+')\n&gt;&gt;&gt; pat.match('abcdefabcabc').group()\n'abc'\n&gt;&gt;&gt; pat.search('abcdefabcabc').group()\n'abc'\n&gt;&gt;&gt; pat.findall('abcdefabcabc')\n['abc', 'abcabc']\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#01matchsearch-none-0","title":"\u201c?\u201d \uff1a0\u6b21\u62161\u6b21\uff0cmatch,search \u4e0d\u4f1a\u51fa\u73b0none\uff0c\u4f1a\u51fa\u73b0\u2019 \u2018 \uff08\u56e0\u4e3a0\u6b21\u4e5f\u662f\u7b26\u5408\u7684\uff09","text":"<p>0\u6b21\u62161\u6b21\u4e0d\u662f\u6307<code>[xxx]</code>\u8fd9\u4e2a\u96c6\u5408\uff0c\u800c\u662f\u5176\u4e2d\u7684\u4efb\u4f55\u7684\u4e00\u4e2a\u5b57\u7b26</p> <pre><code>&gt;&gt;&gt; pat = re.compile('[abc]?')\n&gt;&gt;&gt; pat.match('defabc').group()     #0\u6b21\n''\n&gt;&gt;&gt; pat.match('abcdefabc').group()\n'a'\n&gt;&gt;&gt; pat.search('defabc').group()    #0\u6b21\n''\n&gt;&gt;&gt; pat.findall('defabc')           #0\u6b21\u548c1\u6b21\n['', '', '', 'a', 'b', 'c', '']     #\u540e\u9762\u603b\u518d\u52a0\u4e2a''\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_8","title":"\u201c\u6570\u91cf\u8bcd?\u201d \uff1a\u975e\u8d2a\u5a6a\u6a21\u5f0f\uff1a\u53ea\u5339\u914d\u6700\u5c11\u7684\uff08\u5c3d\u53ef\u80fd\u5c11\uff09\uff1b\u9ed8\u8ba4\u8d2a\u5a6a\u6a21\u5f0f\uff1a\u5339\u914d\u6700\u591a\u7684\uff08\u5c3d\u53ef\u80fd\u591a\uff09","text":"<pre><code>&gt;&gt;&gt; pat = re.compile('[abc]+')         #\u8d2a\u5a6a\u6a21\u5f0f\n&gt;&gt;&gt; pat.match('abcdefabcabc').group()  #\u5339\u914d\u5c3d\u53ef\u80fd\u591a\u7684\uff1aabc\n'abc'\n&gt;&gt;&gt; pat.match('bbabcdefabcabc').group()\n'bbabc'\n&gt;&gt;&gt; pat.search('dbbabcdefabcabc').group()\n'bbabc'\n&gt;&gt;&gt; pat.findall('abcdefabcabc')\n['abc', 'abcabc']\n&gt;&gt;&gt; pat = re.compile('[abc]+?')        #\u975e\u8d2a\u5a6a\u6a21\u5f0f\uff1a+?\n&gt;&gt;&gt; pat.match('abcdefabcabc').group()  #\u5339\u914d\u5c3d\u53ef\u80fd\u5c11\u7684\uff1aa\u3001b\u3001c\n'a'\n&gt;&gt;&gt; pat.search('dbbabcdefabcabc').group()\n'b'\n&gt;&gt;&gt; pat.findall('abcdefabcabc')\n['a', 'b', 'c', 'a', 'b', 'c', 'a', 'b', 'c']\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#m-m","title":"\u201c{m}\u201d \uff1a\u5339\u914d\u5b57\u7b26\u4e32\u51fa\u73b0m\u6b21","text":"<pre><code>&gt;&gt;&gt; pat = re.compile('[op]{2}')     #o\u6216p\u51fa\u73b02\u6b21\n&gt;&gt;&gt; pat.search('abcooapp').group()  #\u5339\u914d\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684\u5b57\u7b26\u4e32,o\u6bd4p\u5148\u51fa\u73b0\n'oo'\n&gt;&gt;&gt; pat.findall('abcooapp')         #\u5339\u914d\u51fa\u73b0\u7684\u6240\u6709\u5b57\u7b26\u4e32\uff0c\u5217\u8868\u5f62\u5f0f\u8fd4\u56de\n['oo', 'pp']\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#mn-mn","title":"\u201c{m,n}\u201d \uff1a\u5339\u914d\u5b57\u7b26\u4e32\u51fa\u73b0m\u5230n\u6b21","text":"<pre><code>&gt;&gt;&gt; pat = re.compile('[op]{2,4}')     #o\u6216\u5219p\u51fa\u73b02\u52304\u6b21\n&gt;&gt;&gt; pat.match('pppabcooapp').group()  #\u5339\u914d\u5f00\u5934\n'ppp'\n&gt;&gt;&gt; pat.search('pppabcooapp').group() #\u5339\u914d\u7b2c\u4e00\u6b21\u51fa\u73b0\n'ppp'\n&gt;&gt;&gt; pat.findall('pppabcooapp')        #\u5339\u914d\u6240\u6709\n['ppp', 'oo', 'pp']\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#group_1","title":".group() #\u5339\u914d\u7b2c\u4e00\u6b21\u51fa\u73b0","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_9","title":"\u8fb9\u754c","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_10","title":"\u201c^\u201d \uff1a\u5339\u914d\u5b57\u7b26\u4e32\u5f00\u5934\u6216\u884c\u5934","text":"<pre><code>&gt;&gt;&gt; pat = re.compile('^[abc]')     #\u5f00\u5934\u662fa\u3001b\u3001c\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\n&gt;&gt;&gt; pat.search('defabc').group()    \n&gt;&gt;&gt; pat.match('defabc').group()    #\u5747\u627e\u4e0d\u5230\n&gt;&gt;&gt; pat.findall('defabc')\n[]\n&gt;&gt;&gt; pat.search('adefabc').group()\n'a'\n&gt;&gt;&gt; pat.match('adefabc').group()   #\u5f00\u5934\u662fa\u3001b\u3001c\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\n'a'\n&gt;&gt;&gt; pat.findall('adefabc')\n['a']\n&gt;&gt;&gt; pat = re.compile('^[abc]+')    #\u5f00\u5934\u662fa\u3001b\u3001c\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u7684\u4e00\u6b21\u6216\u5219\u591a\u6b21\uff0c\u8d2a\u5a6a\uff1a\u5339\u914d\u591a\u4e2a\n&gt;&gt;&gt; pat.findall('cbadefab')\n['cba']\n&gt;&gt;&gt; pat = re.compile(r'^[abc]+?')  #\u5f00\u5934\u662fa\u3001b\u3001c\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u7684\u4e00\u6b21\u6216\u5219\u591a\u6b21\uff0c\u975e\u8d2a\u5a6a\uff1a\u5339\u914d\u4e00\u4e2a\n&gt;&gt;&gt; pat.findall('cbadefab')\n['c']\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_11","title":"\u201c$\u201d \uff1a\u5339\u914d\u5b57\u7b26\u4e32\u7ed3\u5c3e\u6216\u5219\u884c\u5c3e","text":"<pre><code>&gt;&gt;&gt; pat = re.compile('[abc]$')\n&gt;&gt;&gt; pat.match('adefAbc').group()   #match\u5339\u914d\u7684\u662f\u5b57\u7b26\u4e32\u5f00\u5934\uff0c\u6240\u4ee5\u67e5\u627e$\u7684\u65f6\uff0c\u603b\u662f\u8fd4\u56deNone\n&gt;&gt;&gt; pat.search('adefAbc').group()  #\u7ed3\u5c3e\u662fa\u3001b\u3001c\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\n'c'\n&gt;&gt;&gt; pat.findall('adefAbc')        \n['c']\n&gt;&gt;&gt; pat = re.compile('[abc]+$')\n&gt;&gt;&gt; pat.search('adefAbc').group()  #\u7ed3\u5c3e\u662fa\u3001b\u3001c\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u7684\u4e00\u6b21\u6216\u5219\u591a\u6b21\uff0c\u8d2a\u5a6a\uff1a\u5339\u914d\u591a\u4e2a\n'bc'\n&gt;&gt;&gt; pat.findall('adefAbc')\n['bc']\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#a","title":"\u201c\\A\u201d\uff1a\u5339\u914d\u5b57\u7b26\u4e32\u5f00\u5934","text":"<pre><code>&gt;&gt;&gt; pat = re.compile('\\A[abc]+')\n&gt;&gt;&gt; pat.findall('cbadefab')\n['cba']\n&gt;&gt;&gt; pat.search('cbadefab').group()\n'cba'\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#z","title":"\u201c\\Z\u201d\uff1a\u5339\u914d\u5b57\u7b26\u4e32\u7ed3\u5c3e","text":"<pre><code>&gt;&gt;&gt; pat = re.compile('[abc]+\\Z')\n&gt;&gt;&gt; pat.search('cbadefab').group()\n'ab'\n&gt;&gt;&gt; pat.findall('cbadefab')\n['ab']\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_12","title":"\u5206\u7ec4","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#1_2","title":"(\u2026)\uff1a\u5206\u7ec4\u5339\u914d,\u4ece\u5de6\u5230\u53f3,\u6bcf\u9047\u5230\u4e00\u4e2a ( \u7f16\u53f7+1\uff0c\u5206\u7ec4\u540e\u9762\u53ef\u52a0\u6570\u91cf\u8bcd","text":"<pre><code>&gt;&gt;&gt; pat=re.compile(r'(a)\\w(c)')  #\\w:\u5355\u4e2a\u7684\u6570\u5b57\u6216\u5b57\u6bcd [A-Za-z0-9]\n&gt;&gt;&gt; pat.match('abcdef').group()\n'abc'\n&gt;&gt;&gt; pat=re.compile('(a)b(c)')    #\u52062\u7ec4\uff0c\u533f\u540d\u5206\u7ec4\n&gt;&gt;&gt; pat.match('abcdef').group()  #\u9ed8\u8ba4\u8fd4\u56de\u5339\u914d\u7684\u5b57\u7b26\u4e32\n'abc'\n&gt;&gt;&gt; pat.match('abcdef').group(1) #\u53d6\u5206\u7ec41\uff0c\u9002\u7528\u4e8esearch\n'a'\n&gt;&gt;&gt; pat.match('abcdef').group(2) #\u53d6\u5206\u7ec42\uff0c\u9002\u7528\u4e8esearch\n'c'\n&gt;&gt;&gt; pat.match('abcdef').groups() #\u53d6\u6240\u6709\u5206\u7ec4\uff0c\u5143\u7ec4\u5f62\u5f0f\u8fd4\u56de\n('a', 'c')\n</code></pre>"},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_13","title":"\uff1a\u5f15\u7528\u7f16\u53f7\u4e3a\u7684\u5206\u7ec4\u5339\u914d\u5230\u7684\u5b57\u7b26\u4e32 <pre><code>&gt;&gt;&gt; pat=re.compile(r'www\\.(.*)\\..{3}')\n&gt;&gt;&gt; pat.match('www.dxy.com').group(1)\n'dxy'\n</code></pre>","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#p","title":"\u201c(?P\u2026)\u201d \uff1a\u5728\u6a21\u5f0f\u91cc\u9762\u7528()\u6765\u8868\u793a\u5206\u7ec4\uff08\u547d\u540d\u5206\u7ec4\uff09,\u9002\u7528\u4e8e\u63d0\u53d6\u76ee\u6807\u5b57\u7b26\u4e32\u4e2d\u7684\u67d0\u4e00\u4e9b\u90e8\u4f4d\u3002 <pre><code>&gt;&gt;&gt; pat=re.compile(r'(?P&lt;K&gt;a)\\w(c)')    #\u52062\u7ec4\uff1a\u547d\u540d\u5206\u7ec4+\u533f\u540d\u5206\u7ec4\n&gt;&gt;&gt; pat.search('abcdef').groups()       #\u53d6\u6240\u6709\u5206\u7ec4\uff0c\u5143\u7ec4\u5f62\u5f0f\u8fd4\u56de\n('a', 'c')\n&gt;&gt;&gt; pat.search('abcdef').group(1)       #\u53d6\u5206\u7ec41\uff0c\u9002\u7528\u4e8ematch\n'a'\n&gt;&gt;&gt; pat.search('abcdef').group(2)       #\u53d6\u5206\u7ec42\uff0c\u9002\u7528\u4e8ematch\n'c'\n&gt;&gt;&gt; pat.search('abcdef').group()        #\u9ed8\u8ba4\u8fd4\u56de\u5339\u914d\u7684\u5b57\u7b26\u4e32\n'abc'\n&gt;&gt;&gt; pat.search('abcdef').groupdict()    #\u547d\u540d\u5206\u7ec4\u53ef\u4ee5\u8fd4\u56de\u4e00\u4e2a\u5b57\u5178\u3010\u4e13\u6709\u3011\uff0c\u533f\u540d\u5206\u7ec4\u4e5f\u6ca1\u6709\n{'K': 'a'}\n</code></pre>","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#pname","title":"\u201c(?P=name)\u201d\uff1a\u5f15\u7528\u522b\u540d\u4e3a\u7684\u5206\u7ec4\u5339\u914d\u5230\u7684\u4e32 <pre><code>&gt;&gt;&gt; pat=re.compile(r'(?P&lt;K&gt;a)\\w(c)(?P=K)')    #(?P=K)\u5f15\u7528\u5206\u7ec41\u7684\u503c\uff0c\u5c31\u662fa\n&gt;&gt;&gt; pat.search('abcdef').group()              #\u5339\u914d\u4e0d\u5230\uff0c\u56e0\u4e3a\u5b8c\u6574'a\\wca',\u6a21\u5f0f\u7684\u7b2c4\u4f4d\u662fa\nTraceback (most recent call last):\n  File \"&lt;stdin&gt;\", line 1, in &lt;module&gt;\nAttributeError: 'NoneType' object has no attribute 'group'\n\n&gt;&gt;&gt; pat.search('abcadef').group()             #\u5339\u914d\u5230\uff0c\u6a21\u5f0f\u7684\u7b2c4\u4f4d\u548c\u7ec41\u4e00\u6837,\u503c\u662fc\n'abca'\n&gt;&gt;&gt; pat.search('abcadef').groups()\n('a', 'c')\n&gt;&gt;&gt; pat.search('abcadef').group(1)\n'a'\n&gt;&gt;&gt; pat.search('abcadef').group(2)\n'c\n</code></pre>","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_14","title":"\u201c\u201d \uff1a\u5f15\u7528\u5206\u7ec4\u7f16\u53f7\u5339\u914d\uff1a <pre><code>&gt;&gt;&gt; pat=re.compile(r'(?P&lt;K&gt;a)\\w(c)(?P=K)\\2')  #\\2\u5f15\u7528\u5206\u7ec42\u7684\u503c\uff0c\u5c31\u662fc\n&gt;&gt;&gt; pat.findall('Aabcadef')                   #\u5339\u914d\u4e0d\u5230\uff0c\u56e0\u4e3a\u5b8c\u6574'a\\wcac',\u6a21\u5f0f\u7684\u7b2c5\u4f4d\u662fc\n[]\n&gt;&gt;&gt; pat.findall('Aabcacdef')                  #\u5339\u914d\u5230\uff0c\u6a21\u5f0f\u7684\u7b2c5\u4f4d\u548c\u7ec42\u4e00\u6837,\u503c\u662fc\n[('a', 'c')]\n&gt;&gt;&gt; pat.search('Aabcacdef').groups()\n('a', 'c')\n&gt;&gt;&gt; pat.search('Aabcacdef').group()\n'abcac'\n&gt;&gt;&gt; pat.search('Aabcacdef').group(1)\n'a'\n&gt;&gt;&gt; pat.search('Aabcacdef').group(2)\n'c'\n</code></pre>","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_15","title":"\u7279\u6b8a\u6784\u9020 <ul> <li><code>(?:\u2026) (\u2026)</code>\u4e0d\u5206\u7ec4\u7248\u672c,\u7528\u4e8e\u4f7f\u7528 <code>|</code> \u6216\u8005\u540e\u63a5\u6570\u91cf\u8bcd</li> <li><code>(?iLmsux)</code> iLmsux\u7684\u6bcf\u4e2a\u5b57\u7b26\u4ee3\u8868\u4e00\u4e2a\u5339\u914d\u6a21\u5f0f,\u53ea\u80fd\u7528\u5728\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5f00\u5934,\u53ef\u9009\u591a\u4e2a</li> <li><code>(?#\u2026)</code> #\u53f7\u540e\u7684\u5185\u5bb9\u5c06\u4f5c\u4e3a\u6ce8\u91ca</li> <li><code>(?=\u2026)</code> \u4e4b\u540e\u7684\u5b57\u7b26\u4e32\u5185\u5bb9\u9700\u8981\u5339\u914d\u8868\u8fbe\u5f0f\u624d\u80fd\u6210\u529f\u5339\u914d</li> <li><code>(?!\u2026)</code> \u4e4b\u540e\u7684\u5b57\u7b26\u4e32\u4e0d\u5339\u914d\u8868\u8fbe\u5f0f\u624d\u80fd\u6210\u529f</li> <li><code>(?(?(?(id/name) yes |no)</code> \u5982\u679c\u7f16\u53f7\u4e3aid/\u540d\u5b57\u4e3aname\u7684\u7ec4\u5339\u914d\u5230\u5b57\u7b26\u4e32,\u5219\u9700\u8981\u5339\u914dyes,\u5426\u5219\u5339\u914dno,no\u53ef\u4ee5\u7701\u7565</li> </ul>","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_16","title":"\u201c(?:\u2026)\u201d \uff1a()\u91cc\u9762\u6709?:\u8868\u793a\u8be5()\u4e0d\u662f\u5206\u7ec4 <pre><code>&gt;&gt;&gt; pat=re.compile(r'a(?:bc)')\n&gt;&gt;&gt; pat.findall('abc')\n['abc']\n&gt;&gt;&gt; pat.match('abc').groups()      #\u663e\u793a\u4e0d\u51fa\u5206\u7ec4\n</code></pre>","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_17","title":"\u201c(?=\u2026)\u201d\uff1a\u5339\u914d\u2026\u8868\u8fbe\u5f0f\uff0c\u8fd4\u56de\u3002\u5bf9\u540e\u8fdb\u884c\u5339\u914d\uff0c\u603b\u662f\u5bf9\u540e\u9762\u8fdb\u884c\u5339\u914d <pre><code>&gt;&gt;&gt; pat=re.compile(r'\\w(?=\\d)')    #\u5339\u914d\u8868\u8fbe\u5f0f\\d\uff0c\u8fd4\u56de\u6570\u5b57\u7684\u524d\u4e00\u4f4d\uff0c\\w\uff1a\u5355\u8bcd\u5b57\u7b26[A-Za-z0-9]\n&gt;&gt;&gt; pat.findall('abc1 def1 xyz1')\n['c', 'f', 'z']\n&gt;&gt;&gt; pat.findall('zhoujy20130628hangzhou')  #\u5339\u914d\u6570\u5b57\u7684\u524d\u4e00\u4f4d\uff0c\u5217\u8868\u8fd4\u56de\n['y', '2', '0', '1', '3', '0', '6', '2']\n&gt;&gt;&gt; pat=re.compile(r'\\w+(?=\\d)')\n&gt;&gt;&gt; pat.findall('abc1,def1,xyz1')          #\u5339\u914d\u6700\u672b\u6570\u5b57\u7684\u524d\u5b57\u7b26\u4e32\uff0c\u5217\u8868\u8fd4\u56de\n['abc', 'def', 'xyz']\n&gt;&gt;&gt; pat.findall('abc21,def31,xyz41')\n['abc2', 'def3', 'xyz4']\n&gt;&gt;&gt; pat.findall('zhoujy20130628hangzhou')\n['zhoujy2013062']\n&gt;&gt;&gt; pat=re.compile(r'[A-Za-z]+(?=\\d)')       #[A-Za-z],\u5339\u914d\u5b57\u6bcd,\u53ef\u4ee5\u7528\u5176\u4ed6\u7684\u6b63\u5219\u65b9\u6cd5\n&gt;&gt;&gt; pat.findall('zhoujy20130628hangzhou123') #\u5339\u914d\u540e\u9762\u5e26\u6709\u6570\u5b57\u7684\u5b57\u7b26\u4e32\uff0c\u5217\u8868\u8fd4\u56de\n['zhoujy', 'hangzhou']\n&gt;&gt;&gt; pat.findall('abc21,def31,xyz41')\n['abc', 'def', 'xyz']\n</code></pre>","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_18","title":"\u201c(?!\u2026)\u201d \u4e0d\u5339\u914d\u2026\u8868\u8fbe\u5f0f\uff0c\u8fd4\u56de\u3002\u5bf9\u540e\u8fdb\u884c\u5339\u914d <pre><code>&gt;&gt;&gt; pat=re.compile(r'[A-Za-z]+(?!\\d)')       #[A-Za-z],\u5339\u914d\u5b57\u6bcd,\u53ef\u4ee5\u7528\u5176\u4ed6\u7684\u6b63\u5219\u65b9\u6cd5\n&gt;&gt;&gt; pat.findall('zhoujy20130628hangzhou123,12,binjiang310')  #\u5339\u914d\u540e\u9762\u4e0d\u662f\u6570\u5b57\u7684\u5b57\u7b26\u4e32\uff0c\u5217\u8868\u8fd4\u56de\n['zhouj', 'hangzho', 'binjian']\n&gt;&gt;&gt; pat.findall('abc21,def31,xyz41')\n['ab', 'de', 'xy']\n</code></pre>","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_19","title":"\u201c(?&lt;=\u2026)\u201d\uff1a\u5339\u914d\u2026\u8868\u8fbe\u5f0f\uff0c\u8fd4\u56de\u3002\u5bf9\u524d\u8fdb\u884c\u5339\u914d,\u603b\u662f\u5bf9\u524d\u9762\u8fdb\u884c\u5339\u914d <pre><code>&gt;&gt;&gt; pat=re.compile(r'(?&lt;=\\d)[A-Za-z]+')      #\u5339\u914d\u524d\u9762\u662f\u6570\u5b57\u7684\u5b57\u6bcd\n&gt;&gt;&gt; pat.findall('abc21,def31,xyz41')\n[]\n&gt;&gt;&gt; pat.findall('1abc21,2def31,3xyz41')\n['abc', 'def', 'xyz']\n&gt;&gt;&gt; pat.findall('zhoujy20130628hangzhou123,12,binjiang310')\n['hangzhou']\n</code></pre>","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#_20","title":"\u201c(?&lt;!\u2026)\u201d\uff1a\u4e0d\u5339\u914d\u2026\u8868\u8fbe\u5f0f\uff0c\u8fd4\u56de\u3002\u5bf9\u524d\u8fdb\u884c\u5339\u914d,\u603b\u662f\u5bf9\u524d\u9762\u8fdb\u884c\u5339\u914d <pre><code>&gt;&gt;&gt; pat=re.compile(r'(?&lt;!\\d)[A-Za-z]+')      #\u5339\u914d\u524d\u9762\u4e0d\u662f\u6570\u5b57\u7684\u5b57\u6bcd\n&gt;&gt;&gt; pat.findall('abc21,def31,xyz41')\n['abc', 'def', 'xyz']\n&gt;&gt;&gt; pat.findall('zhoujy20130628hangzhou123,12,binjiang310')\n['zhoujy', 'angzhou', 'binjiang']\n</code></pre>","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#idname-yes-no","title":"\u201c(?(id/name) yes |no)\u201d: \u7ec4\u662f\u5426\u5339\u914d\uff0c\u5339\u914d\u8fd4\u56de <pre><code>&gt;&gt;&gt; pat=re.compile(r'a(\\d)?bc(?(1)\\d)')   #no\u7701\u7565\u4e86\uff0c\u5b8c\u6574\u7684\u662fa\\dbc\\d ==&gt; a2bc3,\u603b\u51715\u4f4d\uff0c\u7b2c2\u4f4d\u662f\u53ef\u6709\u53ef\u65e0\u7684\u6570\u5b57\uff0c\u7b2c5\u4e3a\u662f\u6570\u5b57\n&gt;&gt;&gt; pat.findall('abc9')                   #\u8fd4\u56de\u7ec41\uff0c\u4f46\u7b2c2\u4f4d\uff08\u7ec41\uff09\u6ca1\u6709\uff0c\u5373\u8fd4\u56de\u4e86''\n['']\n&gt;&gt;&gt; pat.findall('a8bc9')                  #\u5b8c\u6574\u7684\u6a21\u5f0f\uff0c\u8fd4\u56de\u7ec41\n['8']\n&gt;&gt;&gt; pat.match('a8bc9').group()\n'a8bc9'\n&gt;&gt;&gt; pat.match('a8bc9').group(1)\n'8'\n&gt;&gt;&gt; pat.findall('a8bc')                   #\u7b2c5\u4f4d\u4e0d\u5b58\u5728\uff0c\u5219\u6ca1\u6709\u5339\u914d\u5230\n[]\n</code></pre>","text":""},{"location":"Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/#ilmsuxi","title":"\u201c(?iLmsux)\u201d:\u8fd9\u91cc\u5c31\u4ecb\u7ecd\u4e0bi\u53c2\u6570\uff1a\u5927\u5c0f\u5199\u533a\u5206\u5339\u914d <pre><code>&gt;&gt;&gt; pat=re.compile(r'abc')\n&gt;&gt;&gt; pat.findall('abc')\n['abc']\n&gt;&gt;&gt; pat.findall('ABC')\n[]\n&gt;&gt;&gt; pat=re.compile(r'(?i)abc')            #(?i) \u4e0d\u533a\u5206\u5927\u5c0f\u5199\n&gt;&gt;&gt; pat.findall('ABC')\n['ABC']\n&gt;&gt;&gt; pat.findall('abc')\n['abc']\n&gt;&gt;&gt; pat.findall('aBc')\n['aBc']\n&gt;&gt;&gt; pat.findall('aBC')\n['aBC']\n&gt;&gt;&gt; pat=re.compile(r'abc',re.I)           #re.I \u4f5c\u4e3a\u53c2\u6570\u4f7f\u7528\uff0c\u63a8\u8350\n&gt;&gt;&gt; pat.findall('aBC')\n['aBC']\n&gt;&gt;&gt; pat.findall('abc')\n['abc']\n&gt;&gt;&gt; pat.findall('ABC')\n['ABC']\n</code></pre>","text":""},{"location":"Python%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E6%80%BB%E7%BB%93/","title":"Python\u5b57\u7b26\u4e32\u62fc\u63a5\u603b\u7ed3","text":"<ul> <li>\u539f\u6587</li> </ul>"},{"location":"Python%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E6%80%BB%E7%BB%93/#1","title":"\u65b9\u6cd51\uff1a\u52a0\u53f7\u8fde\u63a5","text":"<p>\u5f88\u591a\u8bed\u8a00\u90fd\u652f\u6301\u4f7f\u7528\u52a0\u53f7\u8fde\u63a5\u5b57\u7b26\u4e32\uff0cPython\u4e5f\u4e0d\u4f8b\u5916\uff0c\u53ea\u9700\u8981\u7b80\u5355\u7684\u5c062\u4e2a\u6216\u591a\u4e2a\u5b57\u7b26\u4e32\u76f8\u52a0\u5c31\u53ef\u4ee5\u5b8c\u6210\u62fc\u63a5\u3002</p> <pre><code>a = 'Python'\nb = '\u79c1\u623f\u83dc'\nr = a + b  # \u8f93\u51fa'Python\u79c1\u623f\u83dc'\n</code></pre>"},{"location":"Python%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E6%80%BB%E7%BB%93/#2","title":"\u65b9\u6cd52\uff1a\u4f7f\u7528<code>%</code>\u64cd\u4f5c\u7b26","text":"<p>\u5728Python 2.6\u4ee5\u524d\uff0c<code>%</code>\u64cd\u4f5c\u7b26\u662f\u552f\u4e00\u4e00\u79cd\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u7684\u65b9\u6cd5\uff0c\u5b83\u4e5f\u53ef\u4ee5\u7528\u4e8e\u8fde\u63a5\u5b57\u7b26\u4e32\u3002</p> <pre><code>a = 'Python'\nb = '\u79c1\u623f\u83dc'\nr = '%s%s' % (a, b)  # \u8f93\u51fa'Python\u79c1\u623f\u83dc'\n</code></pre>"},{"location":"Python%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E6%80%BB%E7%BB%93/#3format","title":"\u65b9\u6cd53\uff1a\u4f7f\u7528<code>format</code>\u65b9\u6cd5","text":"<p>format\u65b9\u6cd5\u662fPython 2.6\u4e2d\u51fa\u73b0\u7684\u4e00\u79cd\u4ee3\u66ff<code>%</code>\u64cd\u4f5c\u7b26\u7684\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u65b9\u6cd5\uff0c\u540c\u6837\u53ef\u4ee5\u7528\u6765\u8fde\u63a5\u5b57\u7b26\u4e32\u3002</p> <pre><code>a = 'Python'\nb = '\u79c1\u623f\u83dc'\nr = '{}{}'.format(a, b)\n</code></pre>"},{"location":"Python%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E6%80%BB%E7%BB%93/#4f-string","title":"\u65b9\u6cd54\uff1a\u4f7f\u7528<code>f-string</code>","text":"<p>Python 3.6\u4e2d\u5f15\u5165\u4e86Formatted String Literals\uff08\u5b57\u9762\u91cf\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\uff09\uff0c\u7b80\u79f0f-string\uff0c<code>f-string</code>\u662f<code>%</code>\u64cd\u4f5c\u7b26\u548c<code>format</code>\u65b9\u6cd5\u7684\u8fdb\u5316\u7248\uff0c\u4f7f\u7528<code>f-string</code>\u8fde\u63a5\u5b57\u7b26\u4e32\u7684\u65b9\u6cd5\u548c\u4f7f\u7528<code>%</code>\u64cd\u4f5c\u7b26\u3001<code>format</code>\u65b9\u6cd5\u7c7b\u4f3c\u3002</p> <pre><code>a = 'Python'\nb = '\u79c1\u623f\u83dc'\nr = f'{a}{b}'\n</code></pre>"},{"location":"Python%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E6%80%BB%E7%BB%93/#5strjoin","title":"\u65b9\u6cd55\uff1a\u4f7f\u7528<code>str.join()</code>\u65b9\u6cd5","text":"<p>\u5b57\u7b26\u4e32\u6709\u4e00\u4e2a\u5185\u7f6e\u65b9\u6cd5<code>join</code>\uff0c\u5176\u53c2\u6570\u662f\u4e00\u4e2a\u5e8f\u5217\u7c7b\u578b\uff0c\u4f8b\u5982\u6570\u7ec4\u6216\u8005\u5143\u7ec4\u7b49\u3002</p> <pre><code>a = 'Python' \nb = '\u79c1\u623f\u83dc'\nr = ''.join([a, b])\n</code></pre>"},{"location":"Python%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E6%80%BB%E7%BB%93/#_1","title":"\u603b\u7ed3","text":"<p>\u8fde\u63a5\u5c11\u91cf\u5b57\u7b26\u4e32\u65f6 \u4f7f\u7528\u52a0\u53f7\u8fde\u63a5\u7b26\u5728\u6027\u80fd\u548c\u53ef\u8bfb\u6027\u4e0a\u90fd\u662f\u660e\u667a\u7684\uff0c\u5982\u679c\u5bf9\u53ef\u8bfb\u6027\u6709\u66f4\u9ad8\u7684\u8981\u6c42\uff0c\u5e76\u4e14\u4f7f\u7528\u7684Python 3.6\u4ee5\u4e0a\u7248\u672c\uff0c<code>f-string</code>\u4e5f\u662f\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u9009\u62e9\uff0c\u4f8b\u5982\u4e0b\u9762\u8fd9\u79cd\u60c5\u51b5\uff0c<code>f-string</code>\u7684\u53ef\u8bfb\u6027\u663e\u7136\u6bd4\u52a0\u53f7\u8fde\u63a5\u597d\u5f97\u591a\u3002</p> <pre><code>a = f'\u59d3\u540d\uff1a{name} \u5e74\u9f84\uff1a{age} \u6027\u522b\uff1a{gender}'\nb = '\u59d3\u540d\uff1a' + name + '\u5e74\u9f84\uff1a' + age + '\u6027\u522b\uff1a' + gender\n</code></pre> <p>\u8fde\u63a5\u5927\u91cf\u5b57\u7b26\u4e32\u65f6 <code>join</code>\u548c<code>f-string</code>\u90fd\u662f\u6027\u80fd\u6700\u597d\u7684\u9009\u62e9\uff0c\u9009\u62e9\u65f6\u4f9d\u7136\u53d6\u51b3\u4e8e\u4f60\u4f7f\u7528\u7684Python\u7248\u672c\u4ee5\u53ca\u5bf9\u53ef\u8bfb\u6027\u7684\u8981\u6c42\uff0c<code>f-string</code>\u5728\u8fde\u63a5\u5927\u91cf\u5b57\u7b26\u4e32\u65f6\u53ef\u8bfb\u6027\u5e76\u4e0d\u4e00\u5b9a\u597d\u3002\u5207\u8bb0\u4e0d\u8981\u4f7f\u7528\u52a0\u53f7\u8fde\u63a5\uff0c\u5c24\u5176\u662f\u5728for\u5faa\u73af\u4e2d\u3002</p>"},{"location":"Regular-Expression/","title":"\u6b63\u898f\u8868\u73fe\uff08Regular Expression\uff09\u3068\u306f\uff1f","text":"<ul> <li>\u5143URL</li> </ul>"},{"location":"Regular-Expression/#regular-expression","title":"\u6b63\u898f\u8868\u73fe\uff08Regular Expression\uff09\u3068\u306f\uff1f","text":"<ul> <li>\u6587\u5b57\u5217\u3092\u30d1\u30bf\u30fc\u30f3\u5316\u3057\u3001\u7279\u6b8a\u306a\u6587\u5b57\uff08\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf\u3001\u30e1\u30bf\u6587\u5b57\uff09\u3067\u8868\u73fe\u3057\u305f\u3082\u306e</li> </ul> <p>\u4f8b\u3048\u3070\u3001\u90f5\u4fbf\u756a\u53f7\u3092\u6b63\u898f\u8868\u73fe\u3092\u4f7f\u3063\u3066\u8868\u3059\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u73fe\u3067\u304d\u308b\u3002 <pre><code>\u90f5\u4fbf\u756a\u53f7\u306e\u6b63\u898f\u8868\u73fe\n\\d{3}-?\\d{4}\n# 3\u6841\u306e\u6570\u5b57 + \u30cf\u30a4\u30d5\u30f3\u6709\u308aor\u7121\u3057 + 4\u6841\u306e\u6570\u5b57\n</code></pre> \u3053\u306e<code>\u300c\\d\u300d\u300c{}\u300d\u300c?\u300d</code>\u306e\u3088\u3046\u306a\u6587\u5b57\u306e\u3053\u3068\u3092 \u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf\uff08\u30e1\u30bf\u6587\u5b57\uff09 \u3068\u3044\u3046\u3002</p>"},{"location":"Regular-Expression/#_1","title":"\u6b63\u898f\u8868\u73fe\u306e\u7531\u6765","text":"<ul> <li>1940\u5e74\u4ee3\u306b\u3055\u307e\u3056\u307e\u306a\u795e\u7d4c\u751f\u7406\u5b66\u8005\u305f\u3061\u304c\u3001\u795e\u7d4c\u56de\u8def\u3092\u6570\u5b66\u7684\u306b\u8aac\u660e\u3059\u308b\u305f\u3081\u306b\u958b\u767a\u3057\u305f\u3002</li> <li>1956\u5e74\u3001\u6570\u5b66\u8005 Stephen Kleene\uff08\u30b9\u30c6\u30a3\u30fc\u30d6\u30f3\u30fb\u30af\u30ea\u30fc\u30cd\uff09 \u304c\u3001\u305d\u306e\u8003\u3048\u65b9\u306b\u57fa\u3065\u304d\u8ad6\u6587\u3092\u8457\u8ff0\u3057\u3001\u521d\u3081\u3066\u6b63\u898f\u8868\u73fe\u306e\u6982\u5ff5\u304c\u7d39\u4ecb\u3055\u308c\u305f\u3002</li> <li>\u3053\u3053\u3067\u300c\u6b63\u5247\u96c6\u5408\u306e\u4ee3\u6570\u300d\u3092\u8aac\u660e\u3059\u308b\u305f\u3081\u306b\u300c\u6b63\u5247\u8868\u73fe\u30fb\u6b63\u898f\u8868\u73fe(regular expression)\u300d\u304c\u4f7f\u7528\u3055\u308c\u305f\u3002 \u4f55\u304c\u8a00\u3044\u305f\u304b\u3063\u305f\u306e\u304b\u3068\u3044\u3046\u3068\u3001\u5143\u3005\u306f\u795e\u7d4c\u56de\u8def\u306e\u7814\u7a76\u3067\u958b\u767a\u3055\u308c\u305f\u6570\u5b66\u7684\u306a\u6982\u5ff5\u3060\u3063\u305f\u3068\u3044\u3046\u3053\u3068\u3002</li> </ul> <p>\u6b63\u898f\u8868\u73fe\u3068\u3044\u3046\u82e5\u5e72\u5206\u304b\u308a\u306b\u304f\u3044\u30cd\u30fc\u30df\u30f3\u30b0\u306f\u3053\u306e\u305b\u3044</p> <p>\u53c2\u8003\uff1a\u6b63\u898f\u8868\u73fe\u306e\u7531\u6765</p>"},{"location":"Regular-Expression/#_2","title":"\u4f55\u306e\u5f79\u306b\u7acb\u3064\uff1f","text":"<ul> <li>\u6587\u5b57\u5217\u691c\u7d22\u306b\u5f79\u7acb\u3064</li> <li>grep\u691c\u7d22\u3001\u30a8\u30c7\u30a3\u30bf\u3084Excel\u306e\u691c\u7d22\u6a5f\u80fd</li> <li>\u2192 \u8abf\u67fb\u3001\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u304c\u6357\u308b</li> <li>\u6587\u5b57\u5217\u7f6e\u63db\u306b\u5f79\u7acb\u3064</li> <li>sed\u3001\u30a8\u30c7\u30a3\u30bf\u3084Excel\u306e\u7f6e\u63db\u6a5f\u80fd</li> <li>\u2192 \u6587\u5b57\u5217\u306e\u4e00\u62ec\u4fee\u6b63\u3001\u4e00\u62ec\u633f\u5165\u3001\u4e00\u62ec\u524a\u9664\u304c\u697d\u306b\u306a\u308b</li> <li>\u5165\u529b\u3055\u308c\u305f\u6587\u5b57\u5217\u304c\u3001\u898f\u5b9a\u3055\u308c\u305f\u30d1\u30bf\u30fc\u30f3\u901a\u308a\u306b\u5165\u529b\u3055\u308c\u3066\u3044\u308b\u304b\u306e\u78ba\u8a8d\uff08\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\uff09\u306b\u5f79\u7acb\u3064</li> <li>\u90f5\u4fbf\u756a\u53f7\u3001\u96fb\u8a71\u756a\u53f7\u3001\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306a\u3069\u306e\u5165\u529b\u5f62\u5f0f\u306e\u30c1\u30a7\u30c3\u30af\u306a\u3069</li> </ul>"},{"location":"Regular-Expression/#_3","title":"\u6b63\u898f\u8868\u73fe\u3068\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\u306e\u9055\u3044","text":"<p>\u6700\u521d\u306e\u9803\u306b\u6b63\u898f\u8868\u73fe\u3068\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\u3092\u52d8\u9055\u3044\u3057\u3066\u3044\u305f\u306e\u3067\u78ba\u8a8d\u3002</p> <p>\u305d\u3082\u305d\u3082\u3001\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\uff08Wild Card\uff09\u3068\u306f\u4f55\u304b\uff1f</p> <ul> <li>\u30c8\u30e9\u30f3\u30d7\u7528\u8a9e\u3067\uff0c\u3069\u306e\u30ab\u30fc\u30c9\u306e\u4ee3\u7528\u306b\u3082\u3067\u304d\u308b\u30ab\u30fc\u30c9\u306e\u3053\u3068\uff08\u30dd\u30fc\u30ab\u30fc\u306b\u304a\u3051\u308b\u30b8\u30e7\u30fc\u30ab\u30fc\u306a\u3069\uff09</li> <li>\u8ee2\u3058\u3066IT\u306b\u304a\u3051\u308b\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\u3068\u306f\u3001 \u4efb\u610f\u306e\u6587\u5b57\u5217 \u306b\u30de\u30c3\u30c1\u3059\u308b\u7279\u6b8a\u6587\u5b57</li> <li>OS\u3084\u8a00\u8a9e\u306b\u3088\u3063\u3066\u89e3\u91c8\u304c\u7570\u306a\u308b</li> </ul>"},{"location":"Regular-Expression/#_4","title":"\u30d5\u30a1\u30a4\u30eb\u691c\u7d22\u306b\u304a\u3051\u308b\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9","text":"<ul> <li>windows\u3084Unix/Linux\u306e\u30b7\u30a7\u30eb\u3067\u306e\u30d5\u30a1\u30a4\u30eb\u691c\u7d22\u3067\u306f\u3001\u4ee5\u4e0b\u306e\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\u304c\u4f7f\u3048\u308b</li> </ul> \u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9 \u5185\u5bb9 ? \u4efb\u610f\u306e1\u6587\u5b57\u306b\u30de\u30c3\u30c1 * 0\u6587\u5b57\u4ee5\u4e0a\u306e\u4efb\u610f\u306e\u6587\u5b57\u5217\u306b\u30de\u30c3\u30c1 <p><code>music.mp?</code> \u2192 \u300cmusic.mp3\u300d\u300cmusic.mp4\u300d\u306a\u3069\u306b\u30de\u30c3\u30c1</p> <p><code>*.txt</code> \u2192 \u62e1\u5f35\u5b50\u304c.txt\u3067\u3042\u308b\u3082\u306e\u5168\u3066\u306b\u30de\u30c3\u30c1</p>"},{"location":"Regular-Expression/#sql","title":"SQL\u306b\u304a\u3051\u308b\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9","text":"<ul> <li>SQL\u306eWHERE\u53e5\u306b\u304a\u3051\u308bLIKE\u6f14\u7b97\u5b50\u3067\u306f\u3001\u4ee5\u4e0b\u306e\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\u304c\u4f7f\u3048\u308b</li> </ul> \u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9 \u5185\u5bb9 % 0\u6587\u5b57\u4ee5\u4e0a\u306e\u4efb\u610f\u306e\u6587\u5b57\u5217\u306b\u30de\u30c3\u30c1 _ \u4efb\u610f\u306e\uff11\u6587\u5b57\u306b\u30de\u30c3\u30c1"},{"location":"Regular-Expression/#_5","title":"\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf\u3068\u306f\uff1f","text":"<ul> <li>\u305d\u306e\u6587\u5b57\u81ea\u8eab\u3068\u306f\u7570\u306a\u308b\u3001\u7279\u5225\u306a\u610f\u5473\u3084\u5f79\u5272\u3092\u6301\u3064\u6587\u5b57\u306e\u3053\u3068</li> </ul> <p>\u3056\u3063\u304f\u308a\u5206\u985e\u3059\u308b\u3068\u3001</p> <ul> <li>\u6587\u5b57\u3092\u8868\u3059\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf\uff1a<code>.\uff08\u30c9\u30c3\u30c8\uff09, \\w, \\W, \\s, \\S, \\d, \\D</code>\u306a\u3069</li> <li>\u7e70\u308a\u8fd4\u3057\u3092\u8868\u3059\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf\uff1a<code>+, *, ?, {n}, {n,m}, {n,}</code></li> <li>\u4f4d\u7f6e\u3092\u8868\u3059\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf\uff1a<code>^, $, \\b, \\B</code></li> <li>\u6587\u5b57\u96c6\u5408\u3084\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u308b\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf\uff1a<code>[], [^], |, (), (?:)</code></li> <li>\u305d\u306e\u4ed6\uff08\u5f8c\u65b9\u53c2\u7167\u306a\u3069\uff09\uff1a<code>\\1, \\2, \\3, ...</code></li> </ul> <p>\u203b\u6b63\u898f\u8868\u73fe\u306e\u5b9f\u88c5\u306b\u3088\u3063\u3066\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u308b\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf\u304c\u7570\u306a\u308b\u306e\u3067\u6ce8\u610f</p>"},{"location":"Regular-Expression/#_6","title":"\u6587\u5b57\u3092\u8868\u3059\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf","text":"\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf \u610f\u5473 \u5099\u8003 .\uff08\u30c9\u30c3\u30c8\uff09 \u4efb\u610f\u306e\uff11\u6587\u5b57\u306b\u30de\u30c3\u30c1 \u6539\u884c\u306b\u306f\u30de\u30c3\u30c1\u3057\u306a\u3044 \\w \u5358\u8a9e\u3092\u69cb\u6210\u3059\u308b\u6587\u5b57\u306b\u30de\u30c3\u30c1 w\u306fword\u306e\u982d\u6587\u5b57 \\W \u5358\u8a9e\u3092\u69cb\u6210\u3059\u308b\u6587\u5b57 \u4ee5\u5916\u306e\u6587\u5b57 \u306b\u30de\u30c3\u30c1 \\d \u6570\u5b57\uff080~9\uff09\u306b\u30de\u30c3\u30c1 d\u306fdigit\u306e\u982d\u6587\u5b57 \\D \u6570\u5b57 \u4ee5\u5916\u306e\u6587\u5b57 \u306b\u30de\u30c3\u30c1 \\s \u7a7a\u767d\u6587\u5b57\uff08\u534a\u89d2\u30b9\u30da\u30fc\u30b9\u3001\u30bf\u30d6\u6587\u5b57\u4ed6\uff09\u306b\u30de\u30c3\u30c1 s\u306fspace\u306e\u982d\u6587\u5b57 \\S \u7a7a\u767d\u6587\u5b57 \u4ee5\u5916\u306e\u6587\u5b57 \u306b\u30de\u30c3\u30c1"},{"location":"Regular-Expression/#_7","title":"\u5236\u5fa1\u6587\u5b57\u3092\u8868\u3059\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf","text":"\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf \u610f\u5473 \\t \u30bf\u30d6\u6587\u5b57 \\v \u5782\u76f4\u30bf\u30d6 \\n \u6539\u884c\u6587\u5b57 \\r \u6539\u884c\u6587\u5b57\uff08\u30ad\u30e3\u30ec\u30c3\u30b8\u30ea\u30bf\u30fc\u30f3\uff09 \\f \u7528\u7d19\u9001\u308a\u6587\u5b57 \\a \u8b66\u544a\u6587\u5b57 \\e \u30a8\u30b9\u30b1\u30fc\u30d7\u6587\u5b57"},{"location":"Regular-Expression/#_8","title":"\u7e70\u308a\u8fd4\u3057\u3092\u8868\u3059\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf\uff08\u91cf\u6307\u5b9a\u5b50\uff09","text":"\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf \u610f\u5473 \u5099\u8003 {n} n\u56de\u4ee5\u4e0a\u306e\u7e70\u308a\u8fd4\u3057\u306b\u30de\u30c3\u30c1 {n,m} n\u56de\u4ee5\u4e0am\u56de\u4ee5\u4e0b\u306e\u7e70\u308a\u8fd4\u3057\u306b\u30de\u30c3\u30c1 {n,} n\u56de\u4ee5\u4e0a\u306e\u7e70\u308a\u8fd4\u3057\u306b\u30de\u30c3\u30c1 * 0\u56de\u4ee5\u4e0a\u306e\u7e70\u308a\u8fd4\u3057\u306b\u30de\u30c3\u30c1 {0,}\u3068\u540c\u7fa9 + 1\u56de\u4ee5\u4e0a\u306e\u7e70\u308a\u8fd4\u3057\u306b\u30de\u30c3\u30c1 {1,}\u3068\u540c\u7fa9 ? 0\u56de\u307e\u305f\u306f1\u56de\u306e\u7e70\u308a\u8fd4\u3057\u306b\u30de\u30c3\u30c1 {0,1}\u3068\u540c\u7fa9"},{"location":"Regular-Expression/#_9","title":"\u4f4d\u7f6e\u3092\u8868\u3059\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf\uff08\u30a2\u30f3\u30ab\u30fc\uff09","text":"\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf \u610f\u5473 $ \u884c\u672b ^ \u884c\u982d \\b \u5358\u8a9e\u5883\u754c \\B \u5358\u8a9e\u5883\u754c\u4ee5\u5916"},{"location":"Regular-Expression/#_10","title":"\u6587\u5b57\u96c6\u5408\u3084\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u308b\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf","text":"\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf \u610f\u5473 [abc] a\u304bb\u304bc\u306e\u3069\u308c\u304b1\u6587\u5b57\u306b\u30de\u30c3\u30c1 [a-z] a\u304b\u3089z\u306e\u3069\u308c\u304b1\u6587\u5b57\u306b\u30de\u30c3\u30c1 [^abc] abc\u4ee5\u5916\u306e\u3069\u308c\u304b1\u6587\u5b57\u306b\u30de\u30c3\u30c1 <code>abc|def</code> abc\u307e\u305f\u306fdef\u306e\u30d1\u30bf\u30fc\u30f3\u306b\u30de\u30c3\u30c1 (abc) \u30b0\u30eb\u30fc\u30d7\u5316\u3068\u30ad\u30e3\u30d7\u30c1\u30e3\u3092\u884c\u3046 (?:abc) \u30b0\u30eb\u30fc\u30d7\u5316\u3092\u884c\u3046"},{"location":"Regular-Expression/#a-z","title":"[a-z]\u306b\u3064\u3044\u3066","text":"<ul> <li>[a-z]\u306ea-z\u306e\u7bc4\u56f2\u306f\u6587\u5b57\u30b3\u30fc\u30c9\u306e\u7bc4\u56f2</li> <li>Unicode\u306e\u6587\u5b57\u30b3\u30fc\u30c9\u756a\u53f7\u3092\u4f7f\u7528\u3057\u3066[\\u0061-\\u007A]\u306e\u3088\u3046\u306b\u8868\u3059\u3053\u3068\u3082\u3067\u304d\u308b</li> </ul>"},{"location":"Regular-Expression/#_11","title":"\u305d\u306e\u4ed6\u306e\u6b63\u898f\u8868\u73fe\u306e\u6a5f\u80fd","text":"<p>\u4ee5\u4e0b\u306e\u6a5f\u80fd\u306f\u3001\u51e6\u7406\u7cfb\u306b\u3088\u3063\u3066\u306f\u4f7f\u7528\u3067\u304d\u306a\u3044\u5834\u5408\u304c\u3042\u308b\u306e\u3067\u6ce8\u610f\u3059\u308b\u3053\u3068\u3002</p>"},{"location":"Regular-Expression/#_12","title":"\u30b0\u30eb\u30fc\u30d7\u5316","text":"<ul> <li>(abc)\u306e\u3088\u3046\u306b\u62ec\u5f27\u5185\u306e\u6587\u5b57\u5217\u3092\u3072\u3068\u307e\u3068\u3081\u306b\u6271\u3046\u3053\u3068</li> </ul> <p>\u4f8b1) hogehoge....\u3068\u300choge\u300d\u3092\u7e70\u308a\u8fd4\u3059\u6587\u5b57\u5217\u3092\u30de\u30c3\u30c1\u3055\u305b\u305f\u3044\u5834\u5408\u3001\u4ee5\u4e0b\u3067\u691c\u7d22\u3059\u308b\u3068\u30de\u30c3\u30c1\u3059\u308b\u3002 <pre><code>\u30b0\u30eb\u30fc\u30d7\u5316\u306e\u4f8b1\n(hoge)+  \n</code></pre> \u4f8b2) https://www.yahoo.co.jp/ \u3068 https://www.google.co.jp/ \u306e\u4e21\u65b9\u306b\u30de\u30c3\u30c1\u3055\u305b\u305f\u3044\u5834\u5408\u3001\u4ee5\u4e0b\u3067\u691c\u7d22\u3059\u308b\u3068\u30de\u30c3\u30c1\u3059\u308b</p> <p><pre><code>\u30b0\u30eb\u30fc\u30d7\u5316\u306e\u4f8b2\nhttps://www\\.(google|yahoo)\\.co\\.jp/\n</code></pre> \u3067\u691c\u7d22\u3059\u308b\u3068\u30de\u30c3\u30c1\u3059\u308b\u3002</p>"},{"location":"Regular-Expression/#_13","title":"\u30ad\u30e3\u30d7\u30c1\u30e3","text":"<ul> <li>(abc)\u62ec\u5f27\u5185\u306e\u6587\u5b57\u5217\u3092\u8a18\u61b6\u3057\u3001\u53c2\u7167\u51fa\u6765\u308b\u3088\u3046\u306b\u3059\u308b\u3053\u3068</li> <li>\\1 ,\\2 ,\\3...\u3067\u524d\u65b9\u3067\u8a18\u61b6\u3057\u305f\u6587\u5b57\u5217\u3092\u30de\u30c3\u30c1\u3055\u305b\u308b\u3053\u3068\u304c\u51fa\u6765\u308b</li> <li>$1 ,$2 ,$3...\u3067\u8a18\u61b6\u3057\u305f\u6587\u5b57\u5217\u3092\u5909\u6570\u3068\u3057\u3066\u53c2\u7167\u3067\u304d\u308b\uff08\u7f6e\u63db\u306b\u3082\u4f7f\u3048\u308b\uff09</li> </ul> <p>\u203b\u4f7f\u7528\u51fa\u6765\u308b\u304b\u3069\u3046\u304b\u304c\u8a00\u8a9e\u306b\u3088\u3063\u3066\u7570\u306a\u308b\u306e\u3067\u6ce8\u610f</p> <p>\u4f8b1) hoge_hoge \u306e\u3088\u3046\u306b\u3001\u524d\u5f8c\u304c\u540c\u3058\u3082\u306e\u3092\u30de\u30c3\u30c1\u3055\u305b\u305f\u3044 <pre><code>\u30ad\u30e3\u30d7\u30c1\u30e3\u306e\u306e\u4f8b1\n# \u691c\u7d22\u6587\u5b57\u5217\n(.+)_\\1\n</code></pre> \u3067\u691c\u7d22\u3059\u308b\u3068\u30de\u30c3\u30c1\u3059\u308b\u3002\u3053\u306e\u3088\u3046\u306b\u524d\u65b9\u3067\u30de\u30c3\u30c1\u3057\u305f\u3082\u306e\u3092\u53c2\u7167\u3059\u308b\u3053\u3068\u3092 \u5f8c\u65b9\u53c2\u7167 \u3068\u3044\u3046\u3002</p> <p>\u4f8b2) https://www.google.co.jp/ \u306ea\u30bf\u30b0\u5185\u306e\u5024\u3092href\u5c5e\u6027\u306b\u8a2d\u5b9a\u3057\u305f\u3044\u5834\u5408\u3001</p> <p><pre><code>\u30ad\u30e3\u30d7\u30c1\u30e3\u306e\u4f8b2\n# \u691c\u7d22\u6587\u5b57\u5217\n&lt;a&gt;(.+?)&lt;/a&gt;\n\n# \u7f6e\u63db\u6587\u5b57\u5217\n&lt;a href=\"$1\"&gt;$1&lt;/a&gt;\n</code></pre> \u3067\u7f6e\u63db\u3067\u304d\u308b\u3002</p> <p>\u4f8b3) hoge@fuga.com\u304b\u3089\u306e\u30ed\u30fc\u30ab\u30eb\u90e8\u3001\u30c9\u30e1\u30a4\u30f3\u90e8\u3001\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u5168\u4f53\u3092\u53d6\u308a\u51fa\u3057\u305f\u3044\u5834\u5408\u3001</p> <p><pre><code>\u30ad\u30e3\u30d7\u30c1\u30e3\u306e\u4f8b3\n# \u691c\u7d22\u6587\u5b57\u5217\n((.+)@(.+))\n\n# \u7f6e\u63db\u6587\u5b57\u5217\n\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9=$1\\n\u30ed\u30fc\u30ab\u30eb\u90e8=$2\\n\u30c9\u30e1\u30a4\u30f3\u90e8=$3\n</code></pre> \u3067\u7f6e\u63db\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u7d50\u679c\u306b\u306a\u308b\u3002</p> <p><pre><code>\u4f8b3\u306e\u7d50\u679c\n\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9=hoge@fuga.com\n\u30ed\u30fc\u30ab\u30eb\u90e8=hoge\n\u30c9\u30e1\u30a4\u30f3\u90e8=fuga.com\n</code></pre> \u30ad\u30e3\u30d7\u30c1\u30e3\u3059\u308b\u9806\u756a\u306f\u300c(\u300d\u304c\u73fe\u308c\u305f\u9806\u306b\u306a\u3063\u3066\u3044\u308b\u3002</p>"},{"location":"Regular-Expression/#_14","title":"\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u306a\u3044\u62ec\u5f27","text":"<ul> <li> <p>(?:)\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30b0\u30eb\u30fc\u30d7\u5316\u306e\u307f\u3092\u884c\u3044\u30ad\u30e3\u30d7\u30c1\u30e3\u3092\u884c\u308f\u306a\u3044</p> </li> <li> <p>\u30b0\u30eb\u30fc\u30d7\u5316\u306e\u307f\u304c\u76ee\u7684\u3067\u3042\u308b\u3053\u3068\u3092\u660e\u793a\u3057\u305f\u3044\u5834\u5408\u3053\u306e\u3088\u3046\u306b\u66f8\u304f</p> </li> <li>\u82e5\u5e72\u8aad\u307f\u306b\u304f\u304f\u306a\u308b\uff08\u53ef\u8aad\u6027\u304c\u4e0b\u304c\u308b\uff09\u306e\u3067\u3001\u3069\u3061\u3089\u3067\u66f8\u3044\u305f\u65b9\u304c\u3044\u3044\u304b\u306f\u72b6\u6cc1\u306b\u3088\u308b <pre><code>\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u306a\u3044\u62ec\u5f27\u306e\u4f8b\nhttps://www\\.(?:google|yahoo)\\.co\\.jp/ \n</code></pre></li> </ul>"},{"location":"Regular-Expression/#_15","title":"\u5148\u8aad\u307f\u3068\u5f8c\u8aad\u307f","text":"\u5148\u8aad\u307f\u30fb\u5f8c\u8aad\u307f \u6b63\u898f\u8868\u73fe \u610f\u5473 \u80af\u5b9a\u5148\u8aad\u307f(positive look forward) (?=abc) \u524d\u65b9\u3092\u898b\u3066abc\u304c\u3042\u308b\u4f4d\u7f6e\u306b\u30de\u30c3\u30c1 \u5426\u5b9a\u5148\u8aad\u307f(negative look forward) (?!abc) \u524d\u65b9\u3092\u898b\u3066abc\u304c\u306a\u3044\u4f4d\u7f6e\u306b\u30de\u30c3\u30c1 \u80af\u5b9a\u5f8c\u8aad\u307f(positive look behind) (?&lt;=abc) \u5f8c\u65b9\u3092\u898b\u3066abc\u304c\u3042\u308b\u4f4d\u7f6e\u306b\u30de\u30c3\u30c1 \u5426\u5b9a\u5f8c\u8aad\u307f(negative look behind) (?&lt;!abc) \u5f8c\u65b9\u3092\u898b\u3066abc\u304c\u306a\u3044\u4f4d\u7f6e\u306b\u30de\u30c3\u30c1 <p>\u203bJavaScript\u7cfb\u3067\u306f\u5f8c\u8aad\u307f\u306f\u5b9f\u88c5\u3055\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u6ce8\u610f <pre><code>\u4f8b\ncustomer.fullname\ncustomer.firstName\ncustomer.lastName\nemployee.firstName\nemployee.lastName\nofficer.firstName\nofficer.lastName\n</code></pre></p> <ul> <li>customer(?=.firstName)</li> <li>\u2192\u5f8c\u308d\u306bfirstName\u304c\u7d9a\u304fcustomer\u306b\u30de\u30c3\u30c1</li> <li>customer(?!.firstName)</li> <li>\u2192\u5f8c\u308d\u306bfullName\u304c\u6765\u306a\u3044customer\u306b\u30de\u30c3\u30c1</li> <li>(?&lt;=customer.)firstName</li> <li>\u2192customer\u306e\u5f8c\u308d\u306efirstName\u306b\u30de\u30c3\u30c1</li> <li>(?&lt;!customer.)firstName</li> <li>\u2192customer\u4ee5\u5916\u306e\u5f8c\u308d\u306efirstName\u306b\u30de\u30c3\u30c1</li> </ul>"},{"location":"Regular-Expression/#_16","title":"\uff5e\u3092\u542b\u3080\u30fb\u542b\u307e\u306a\u3044","text":"<ul> <li>\u5148\u8aad\u307f\u30fb\u5f8c\u8aad\u307f\u3092\u5fdc\u7528\u3059\u308b\u3068\u3001\uff5e\u3092\u542b\u3080\u30fb\u542b\u307e\u306a\u3044\u884c\u306f\u4ee5\u4e0b\u306e\u6b63\u898f\u8868\u73fe\u306e\u3088\u3046\u306b\u8868\u305b\u308b</li> </ul> <p><pre><code>abc\u3092\u542b\u3080\u884c\u30fb\u542b\u307e\u306a\u3044\u884c\n# abc\u3092\u542b\u3080\u884c\n^(?=.*abc).*\n\n# def\u3092\u542b\u307e\u306a\u3044\u884c\n^(?!.*def).*\n</code></pre> \u4f8b)</p> <p>\u30b9\u30da\u30fc\u30b9\u3092\u542b\u3080\u884c\u3092\u524a\u9664\u3057\u305f\u3044</p> <pre><code>\u30b9\u30da\u30fc\u30b9\u3092\u542b\u3080\u884c\u306e\u524a\u9664\n# \u691c\u7d22\u6587\u5b57\u5217\n^(?=.* ).*\\n\n\n# \u7f6e\u63db\u6587\u5b57\u5217\u306f\u7a7a\u6587\u5b57\n</code></pre>"},{"location":"Regular-Expression/#_17","title":"\u4fee\u98fe\u5b50","text":"<ul> <li>\u591a\u304f\u306e\u51e6\u7406\u7cfb\u306b\u306f\u30de\u30c3\u30c1\u30f3\u30b0\u306e\u51e6\u7406\u65b9\u6cd5\u3092\u5909\u66f4\u3059\u308b\u6307\u5b9a\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b</li> <li>\u672b\u5c3e\u306b\u4ed8\u3051\u308b\u4fee\u98fe\u5b50\u3092\u30d5\u30e9\u30b0\uff08flag\uff09\u3068\u547c\u3076</li> </ul> <pre><code>JavaScript\n// \u4fee\u98fe\u5b50i\u306f\u5927\u6587\u5b57\u3068\u5c0f\u6587\u5b57\u3092\u533a\u5225\u3057\u306a\u3044\uff08ignoreCase\uff09\n// \u4fee\u98fe\u5b50g\u306f\u5168\u3066\u306e\u30de\u30c3\u30c1\u30f3\u30b0\u7b87\u6240\u3092\u691c\u7d22\u3059\u308b\uff08global\uff09\nvar regex = /hoge/ig;\n</code></pre>"},{"location":"Regular-Expression/#_18","title":"\u6b63\u898f\u8868\u73fe\u306b\u304a\u3051\u308b\u6ce8\u610f\u70b9","text":""},{"location":"Regular-Expression/#_19","title":"\u6700\u9577\u30de\u30c3\u30c1\u3068\u6700\u77ed\u30de\u30c3\u30c1","text":"<p>\u601d\u3063\u305f\u3088\u308a\u3082\u9577\u3044\u7bc4\u56f2\u306b\u30de\u30c3\u30c1\u3057\u3066\u3057\u307e\u3046\u30fb\u30fb\u30fb\u3068\u3044\u3046\u6642\u306b\u78ba\u8a8d</p> <ul> <li>\u7e70\u308a\u8fd4\u3057\u6587\u5b57\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u30de\u30c3\u30c1\u3057\u3046\u308b\u6700\u5927\u306e\u6587\u5b57\u5217\u306b\u30de\u30c3\u30c1\u3059\u308b</li> <li>\u7e70\u308a\u8fd4\u3057\u306e\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf\u306e\u5f8c\u308d\u306b \u300c?\u300d \u3092\u4ed8\u3051\u308b\u3068\u30de\u30c3\u30c1\u3057\u3046\u308b\u6700\u5c0f\u306e\u6587\u5b57\u5217\u306b\u30de\u30c3\u30c1\u3059\u308b</li> </ul> <p>\u4f8b\u3048\u3070\u3001\u300choge@hoge.com\u300d\u304b\u3089hoge\u3092\u5225\u3005\u306b2\u3064\u30de\u30c3\u30c1\u3055\u305b\u305f\u3044\u3068\u3059\u308b\u3002</p> <p>\u6b63\u898f\u8868\u73fe\uff1a<code>h.*e</code></p> <p>\u3068\u3059\u308b\u3068\u3001\u300choge@hoge\u300d\u306b\u30de\u30c3\u30c1\u3057\u3066\u3057\u307e\u3046\u306e\u3067NG\u3001</p> <p>\u6b63\u898f\u8868\u73fe\uff1a<code>h.*?e</code></p> <p>\u306e\u3088\u3046\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002</p>"},{"location":"Regular-Expression/#_20","title":"\u57fa\u672c\u6b63\u898f\u8868\u73fe\u3068\u62e1\u5f35\u6b63\u898f\u8868\u73fe","text":"<p>\u3042\u308c\uff1f\u6b63\u898f\u8868\u73fe\u306f\u5408\u3063\u3066\u308b\u306e\u306b\u30de\u30c3\u30c1\u3057\u306a\u3044\u30fb\u30fb\u30fb\u3068\u3044\u3046\u5834\u5408\u306f\u305d\u3082\u305d\u3082\u6a5f\u80fd\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308b</p> <ul> <li>POSIX\u6b63\u898f\u8868\u73fe\u306b\u306f2\u7a2e\u985e\u3042\u308a\u3001\u5229\u7528\u3067\u304d\u308b\u30e1\u30bf\u30ad\u30e3\u30e9\u30af\u30bf\u3084\u6a5f\u80fd\u304c\u7570\u306a\u308b</li> </ul> \u7a2e\u985e \u7279\u5fb4 \u5bfe\u5fdc \u57fa\u672c\u6b63\u898f\u8868\u73fe(basic regular expression:BRE) grep, sed \u306a\u3069 \u300c<code>|</code>\u300d\u300c+\u300d\u300c?\u300d\u306f\u4f7f\u7528\u4e0d\u53ef\u300c()\u300d\u300c{}\u300d\u306f\u30a8\u30b9\u30b1\u30fc\u30d7\u304c\u5fc5\u8981 \u62e1\u5f35\u6b63\u898f\u8868\u73fe(extended regular expression:ERE) egrep\uff08grep -E\uff09, sed -E \u306a\u3069 \u300c+\u300d\u300c?\u300d\u306f\u4f7f\u7528\u3067\u304d\u308b\u300c()\u300d\u300c{}\u300d\u306f\u30a8\u30b9\u30b1\u30fc\u30d7\u4e0d\u8981 <ul> <li>\u3055\u3089\u306b\u3053\u308c\u306b\u6a5f\u80fd\u3092\u52a0\u3048\u305f\u6b63\u898f\u8868\u73fe\u304c\u3042\u308a\u3001\u8ffd\u52a0\u6a5f\u80fd\u304c\u4f7f\u3048\u308b\u304b\u3069\u3046\u304b\u306f\u5b9f\u88c5\u6bce\u306b\u78ba\u8a8d\u3059\u308b\u3057\u304b\u306a\u3044\u3002</li> </ul> <p>\u53c2\u8003\uff1a3\u3064\u306e\u6b63\u898f\u8868\u73fe\u3092\u77e5\u3089\u306a\u3044\u3068\u30cf\u30de\u308b\u30e8</p>"},{"location":"Regular-Expression/#_21","title":"\u30a8\u30b9\u30b1\u30fc\u30d7\u306e\u5fc5\u8981\u6027","text":"<p>\u30b3\u30fc\u30c9\u5185\u3067\u6b63\u898f\u8868\u73fe\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306b\u306f\u3001\u30a8\u30b9\u30b1\u30fc\u30d7\u304c\uff12\u91cd\u306b\u5fc5\u8981\u306a\u5834\u5408\u304c\u3042\u308b\u306e\u3067\u6ce8\u610f</p> <pre><code>java\n// \u6587\u5b57\u5217\u30ea\u30c6\u30e9\u30eb\nString regex = \"hoge\\\\.com\";\n\n// \u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5\u306e\u6b63\u898f\u8868\u73fe\u306f\\\\\\\\\u3068\u66f8\u304f\u3002\u3053\u308c\u3067\u300c\\\u300d\u306e\u307f\u306b\u30de\u30c3\u30c1\nString backslashRegex = \"\\\\\\\\\";\n</code></pre>"},{"location":"Regular-Expression/#_22","title":"\u6b63\u898f\u8868\u73fe\u30ea\u30c6\u30e9\u30eb","text":"<ul> <li>\u6b63\u898f\u8868\u73fe\u30ea\u30c6\u30e9\u30eb\u306b\u306f\u305d\u306e\u307e\u307e\u6b63\u898f\u8868\u73fe\u3092\u66f8\u3051\u308b\uff08\u6b63\u898f\u8868\u73fe\u306e\u307f\u306e\u30a8\u30b9\u30b1\u30fc\u30d7\u3067\u826f\u3044\uff09\u3002</li> <li>JavaScript\u3084Ruby\u306a\u3069\u306f\u6b63\u898f\u8868\u73fe\u30ea\u30c6\u30e9\u30eb\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u308b\u304c\u3001Java\u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044 <pre><code>JavaScript\n// \u6b63\u898f\u8868\u73fe\u30ea\u30c6\u30e9\u30eb\nvar regex = /hoge\\.com/;\n</code></pre></li> </ul>"},{"location":"Regular-Expression/#_23","title":"\u6b63\u898f\u8868\u73fe\u306e\u30c1\u30a7\u30c3\u30af\u306b\u5f79\u7acb\u3064\u30b5\u30a4\u30c8","text":"<ul> <li>Regexper\uff1a\u6b63\u898f\u8868\u73fe\u3092\u53ef\u8996\u5316\u3057\u3066\u78ba\u8a8d\u3067\u304d\u308b</li> <li>regex-testdrive\uff1aJava\u306e\u6b63\u898f\u8868\u73fe\u30c1\u30a7\u30c3\u30af</li> <li>okumocchi\uff1aPHP\u53ca\u3073JavaScript\u6b63\u898f\u8868\u73fe\u30c1\u30a7\u30c3\u30af</li> <li>Regexr\uff1aJavaScript\u306e\u6b63\u898f\u8868\u73fe\u30c1\u30a7\u30c3\u30af</li> <li>Rubular\uff1aRuby\u306e\u6b63\u898f\u8868\u73fe\u30c1\u30a7\u30c3\u30af\u3001\u30ad\u30e3\u30d7\u30c1\u30e3\u5185\u5bb9\u304c\u308f\u304b\u308b</li> </ul>"},{"location":"Regular-Expression/#_24","title":"\u88dc\u8db3\u30fb\u53c2\u8003","text":""},{"location":"Regular-Expression/#_25","title":"\u300c\\\u300d\uff08\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5\uff09\u3068\u300c\u00a5\u300d\uff08\u5186\u30de\u30fc\u30af\u306b\u3064\u3044\u3066\uff09","text":"<ul> <li>Unicode\u304c\u5e83\u307e\u308b\u4ee5\u524d\u3001\u548c\u6587\u30d5\u30a9\u30f3\u30c8\u3067\u306f\u300c/\u300d\u306e\u6587\u5b57\u30b3\u30fc\u30c9\uff080x5c\uff09\u306b\u300c\u00a5\u300d\u306e\u8868\u8a18\u3092\u5272\u308a\u5f53\u3066\u3066\u3044\u305f\u305f\u3081\u3001\u300c\\\u300d\u3092\u5165\u529b\u3059\u308b\u3068\u300c\u00a5\u300d\u304c\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002</li> <li>\u305d\u306e\u540d\u6b8b\u3067\u300c\\\u300d\u6587\u5b57\u30b3\u30fc\u30c9\uff080x5c\uff09\u3092\u5165\u529b\u3057\u305f\u5834\u5408\u3001\u300c\u00a5\u300d\u304c\u8868\u793a\u3055\u308c\u308b\u5834\u5408\u304c\u3042\u308b\u3002</li> <li>Unicode\u3067\u306f\u300c\\\u300d\u306e\u6587\u5b57\u30b3\u30fc\u30c9\uff08U+005c\uff09\u3068\u306f\u5225\u306b\u3001\u300c\u00a5\u300d\u306b\u6587\u5b57\u30b3\u30fc\u30c9\uff08U+00A5\uff09\u304c\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u308b\u3002</li> </ul>"},{"location":"Regular-Expression/#_26","title":"\u6539\u884c\u30b3\u30fc\u30c9\u306b\u3064\u3044\u3066","text":"<p>\u6b63\u898f\u8868\u73fe\u3068\u306f\u95a2\u4fc2\u306a\u3044\u3051\u3069\u30ad\u30e3\u30ec\u30c3\u30b8\u30ea\u30bf\u30fc\u30f3\u3063\u3066\u306a\u3093\u305e\uff1f\u3068\u601d\u3063\u305f\u306e\u3067\u8abf\u3079\u3066\u307f\u305f</p> <ul> <li>\u300cCR\u300d\u300cLF\u300d\u300cCRLF\u300d\u306e3\u7a2e\u985e\u3042\u308b</li> <li>\u6614\u306eMac\u3067\u306fCR,\u73fe\u5728\u306eMac\u3084Linux\u306a\u3069\u306eUnix\u7cfb\u3067\u306fLF,windows\u3067\u306fCRLF\u3092\u63a1\u7528\u3057\u3066\u3044\u308b</li> </ul> <p>\u30bf\u30a4\u30d7\u30e9\u30a4\u30bf\u30fc\u306b\u306f\u30ad\u30e3\u30ea\u30c3\u30b8\u3068\u3044\u3046\u30ed\u30fc\u30eb\u306b\u7d19\u3092\u631f\u3080\u5f79\u76ee\u3092\u6301\u3064\u90e8\u54c1\u304c\u3042\u308a\u3001\u305d\u306e\u4f4d\u7f6e\u3092\u8abf\u7bc0\u3059\u308b\u300c\u30ad\u30e3\u30ea\u30c3\u30b8\u30ea\u30bf\u30fc\u30f3\u30ec\u30d0\u30fc\u300d\u3068\u30011\u884c\u5206\u30ed\u30fc\u30eb\u3092\u56de\u3057\u7d19\u3092\u9001\u308b\u3053\u3068\uff08\u30e9\u30a4\u30f3\u30d5\u30a3\u30fc\u30c9\uff09\u304c\u51fa\u6765\u308b\u30ec\u30d0\u30fc\u3092\u9806\u306b\u64cd\u4f5c\u3059\u308b\u3053\u3068\u3067\u6539\u884c\u3092\u884c\u3063\u3066\u3044\u305f\u3002</p>"},{"location":"Regular-Expression/#carriage-returncr","title":"\u30ad\u30e3\u30ea\u30c3\u30b8\u30ea\u30bf\u30fc\u30f3\uff08carriage return:CR\u3001\u5fa9\u5e30\uff09","text":"<ul> <li>\u30ab\u30fc\u30bd\u30eb\u3092\u884c\u306e\u5148\u982d\u306b\u623b\u3059\u6307\u793a\uff08\u5de6\u306b\u79fb\u52d5\uff09</li> </ul>"},{"location":"Regular-Expression/#line-feedlf-newline-end-of-line","title":"\u30e9\u30a4\u30f3\u30d5\u30a3\u30fc\u30c9\uff08line feed:LF, newline, end-of-line\u3001\u72ed\u7fa9\u306e\u6539\u884c\uff09","text":"<ul> <li>\u30ab\u30fc\u30bd\u30eb\u3092\u4e00\u3064\u4e0b\u306e\u884c\u306b\u79fb\u3059\u6307\u793a\uff08\u4e0b\u306b\u79fb\u52d5\uff09</li> <li>\u4ee5\u524d\u306f\u30ab\u30fc\u30bd\u30eb\u3092\u4e0b\u306b\u79fb\u3059\u3060\u3051\u3067\u884c\u982d\u306b\u306f\u623b\u3089\u306a\u304b\u3063\u305f\uff08\u73fe\u5728\u306f\u884c\u982d\u306b\u623b\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\uff09</li> </ul>"},{"location":"Regular-Expression/#grep","title":"grep","text":"<ul> <li>grep\u3068\u306fed\u3068\u3044\u3046\u30e9\u30a4\u30f3\u30a8\u30c7\u30a3\u30bf\u306e\u30b3\u30de\u30f3\u30c9 g/re/p\u306e\u30b3\u30de\u30f3\u30c9\u304b\u3089\u304d\u3066\u3044\u308b</li> <li>global Regular Expression print\u306e\u7565</li> </ul>"},{"location":"Regular-Expression/#validation","title":"\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\uff08validation\uff09\u3068\u306f\uff1f","text":"<ul> <li>validate\uff1a\u691c\u8a3c\u3059\u308b\u30fb\uff08\u59a5\u5f53\u6027\u3092\uff09\u78ba\u8a8d\u3059\u308b\u3001\u6709\u52b9\u6027\u3092\u78ba\u304b\u3081\u308b</li> <li>IT\u5206\u91ce\u3067\u306f\u300c\u898f\u5b9a\u3055\u308c\u305f\u6587\u6cd5\u30fb\u4ed5\u69d8\u901a\u308a\u306b\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u691c\u8a3c\u3059\u308b\u3053\u3068\u300d</li> <li>\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3001\u96fb\u8a71\u756a\u53f7\u3001\u90f5\u4fbf\u756a\u53f7\u306a\u3069\u6587\u6cd5\u306e\u30c1\u30a7\u30c3\u30af\u306e\u610f\u5473\u3067\u4f7f\u308f\u308c\u308b</li> </ul>"},{"location":"about/","title":"Welcome to MkDocs","text":"<p>For full documentation visit mkdocs.org.</p>"},{"location":"about/#commands","title":"Commands","text":"<ul> <li><code>mkdocs new [dir-name]</code> - Create a new project.</li> <li><code>mkdocs serve</code> - Start the live-reloading docs server.</li> <li><code>mkdocs build</code> - Build the documentation site.</li> <li><code>mkdocs -h</code> - Print help message and exit.</li> </ul>"},{"location":"about/#project-layout","title":"Project layout","text":"<pre><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre>"},{"location":"ansbile/","title":"ansible","text":""},{"location":"ansbile/#_1","title":"\u30aa\u30d7\u30b7\u30e7\u30f3","text":"<ul> <li><code>-k, --ask-pass</code><ul> <li>SSH \u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5c0b\u306d\u308b(\u30d7\u30ed\u30f3\u30d7\u30c8\u304c\u51fa\u308b)</li> </ul> </li> <li><code>-K, --ask-sudo-pass</code><ul> <li>sudo \u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5c0b\u306d\u308b(\u30d7\u30ed\u30f3\u30d7\u30c8\u304c\u51fa\u308b)</li> </ul> </li> <li><code>-C, --check</code><ul> <li>\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306a\u3069\u306e\u5909\u66f4\u306f\u884c\u308f\u306a\u3044\u304c\u3001\u6761\u4ef6\u306e\u78ba\u8a8d\u306a\u3069\u306f\u5b9f\u884c\u3059\u308b</li> </ul> </li> <li><code>-c CONNECTION, --connection=CONNECTION</code><ul> <li>local, ssh, paramiko \u304b\u3089\u9078\u629e\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306f paramiko\u3002\u53e4\u3044 OpenSSH \u3067 ssh \u3092\u6307\u5b9a\u3059\u308b\u5834\u5408\u306f ANSIBLE_SSH_ARGS=\"\" \u3068\u74b0\u5883\u5909\u6570\u3092\u7a7a\u3067\u4e0a\u66f8\u304d\u3059 \u308b\u5fc5\u8981\u304c\u3042\u308b</li> </ul> </li> <li><code>-D, --diff</code><ul> <li>file \u3084 template \u306e\u5dee\u5206(diff)\u3092\u8868\u793a\u3059\u308b\u3002--check \u3068\u4e00\u7dd2\u306b\u4f7f\u3046\u3068\u4fbf\u5229</li> </ul> </li> <li><code>-e EXTRA_VARS, --extra-vars=EXTRA_VARS</code><ul> <li>\u8ffd\u52a0\u306e\u5909\u6570\u3092 key=value \u3067\u6307\u5b9a\u3059\u308b\u3002playbook \u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u5909\u6570\u306e\u4e0a\u66f8\u304d\u306f\u3055\u308c\u306a\u3044</li> </ul> </li> <li><code>-f FORKS, --forks=FORKS</code><ul> <li>\u4e26\u5217\u5b9f\u884c\u3059\u308b\u6570(\u30c7\u30d5\u30a9\u30eb\u30c8\u306f5)</li> </ul> </li> <li><code>-h, --help</code><ul> <li>\u3053\u306e\u30d8\u30eb\u30d7\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8868\u793a\u3057\u3066\u7d42\u4e86\u3059\u308b</li> </ul> </li> <li><code>-i INVENTORY, --inventory-file=INVENTORY</code><ul> <li>\u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3059\u308b(\u30c7\u30d5\u30a9\u30eb\u30c8\u306f /etc/ansible/hosts)</li> </ul> </li> <li><code>-l SUBNET, --limit=SUBNET</code><ul> <li>\u5bfe\u8c61\u30b5\u30fc\u30d0\u30fc\u3092\u6307\u5b9a\u306e\u3082\u306e\u3060\u3051\u306b\u5236\u9650\u3059\u308b</li> </ul> </li> <li><code>--list-hosts</code><ul> <li>\u305d\u308c\u305e\u308c\u306e playbook \u306e\u5bfe\u8c61\u30db\u30b9\u30c8\u4e00\u89a7\u3092\u8868\u793a\u3057\u3066\u7d42\u4e86\u3059\u308b\u3002playbook \u306e\u5b9f\u884c\u306f\u3055\u308c\u306a\u3044</li> </ul> </li> <li><code>--list-tasks</code><ul> <li>\u5404 playbook \u306e\u30bf\u30b9\u30af\u4e00\u89a7\u3092\u8868\u793a\u3057\u3066\u7d42\u4e86\u3059\u308b</li> </ul> </li> <li><code>-M MODULE_PATH, --module-path=MODULE_PATH</code><ul> <li>\u30e2\u30b8\u30e5\u30fc\u30eb\u30d5\u30a1\u30a4\u30eb\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3059\u308b(\u30c7\u30d5\u30a9\u30eb\u30c8\u306f /usr/share/ansible)</li> </ul> </li> <li><code>--private-key=PRIVATE_KEY_FILE</code><ul> <li>SSH \u306e\u79d8\u5bc6\u9375\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3059\u308b</li> </ul> </li> <li><code>--start-at-task=START_AT</code><ul> <li>\u6307\u5b9a\u306e task \u304b\u3089\u958b\u59cb\u3059\u308b</li> </ul> </li> <li><code>--step</code><ul> <li>\u3072\u3068\u3064\u306e task \u3054\u3068\u306b \"Perform task: \u30bf\u30b9\u30af\u540d (y/n/c):\" \u3068\u78ba\u8a8d\u3055\u308c\u308b\u3002y: (yes) \u5b9f\u884c\u3059\u308b\u3001n: (no) \u5b9f\u884c\u3057\u306a\u3044\u3001c: (continue) \u4ee5\u964d\u3092\u78ba\u8a8d\u306a \u3057\u3067\u5b9f\u884c\u3059\u308b</li> </ul> </li> <li><code>-s, --sudo</code><ul> <li>\u5bfe\u8c61\u30b5\u30fc\u30d0\u30fc\u3067\u306e task \u3092 sudo \u3067\u5b9f\u884c\u3059\u308b</li> </ul> </li> <li><code>-U SUDO_USER, --sudo-user=SUDO_USER</code><ul> <li>sudo \u3067\u306e\u5b9f\u884c\u30e6\u30fc\u30b6\u30fc\u3092\u6307\u5b9a\u3059\u308b(\u30c7\u30d5\u30a9\u30eb\u30c8\u306f root)</li> </ul> </li> <li><code>--syntax-check</code><ul> <li>playbook \u306e\u6587\u6cd5\u30c1\u30a7\u30c3\u30af\u3060\u3051\u3092\u884c\u3046</li> </ul> </li> <li><code>-t TAGS, --tags=TAGS</code><ul> <li>\u6307\u5b9a\u306e tag \u304c\u4ed8\u3051\u3089\u308c\u305f task \u306e\u307f\u3092\u5b9f\u884c\u3059\u308b</li> </ul> </li> <li><code>-T TIMEOUT, --timeout=TIMEOUT</code><ul> <li>SSH \u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3092\u6307\u5b9a\u3059\u308b(\u30c7\u30d5\u30a9\u30eb\u30c8\u306f10\u79d2)</li> </ul> </li> <li><code>-u REMOTE_USER, --user=REMOTE_USER</code><ul> <li>SSH \u3067\u63a5\u7d9a\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u540d\u3092\u6307\u5b9a\u3059\u308b</li> </ul> </li> <li><code>-v, --verbose</code><ul> <li>\u5197\u9577\u30e2\u30fc\u30c9 (-vvv \u3067\u3088\u308a\u5197\u9577\u306a\u51fa\u529b\u306b\u306a\u308b)</li> </ul> </li> <li><code>--version</code><ul> <li>\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u8868\u793a\u3057\u3066\u7d42\u4e86\u3059\u308b</li> </ul> </li> </ul>"},{"location":"ansbile/#become-user","title":"become-user","text":"<ul> <li>https://docs.ansible.com/ansible/2.9_ja/user_guide/become.html#id2</li> </ul> \u4f8b <pre><code>$ ansible -m ping  mysql-server --ask-pass --become-user root --ask-become-pass\nSSH password:\nBECOME password[defaults to SSH password]:\nmysql-server | SUCCESS =&gt; {\n\"ansible_facts\": {\n\"discovered_interpreter_python\": \"/usr/bin/python\"\n},\n    \"changed\": false,\n    \"ping\": \"pong\"\n}\n</code></pre> <ul> <li><code>ansible.cfg</code><ul> <li><code>remote_user = admin \u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u3092admin\u306b\u8a2d\u5b9a</code></li> </ul> </li> <li><code>--ask-pass</code><ul> <li><code>\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u306e\u30d1\u30b9\u30ef\u30fc\u30c9</code></li> </ul> </li> <li><code>--become-user root</code><ul> <li><code>become-user \u3092root\u306b\u8a2d\u5b9a</code></li> </ul> </li> <li><code>--ask-become-pass</code><ul> <li><code>become-user\u306e\u30d1\u30b9\u30ef\u30fc\u30c9</code></li> </ul> </li> </ul>"},{"location":"ansbile_async/","title":"ansbile_async","text":""},{"location":"ansbile_async/#ansible","title":"Ansible\u5e38\u7528\u529f\u80fd\u8bf4\u660e [\u5f02\u6b65\u3001\u5e76\u53d1\u3001\u59d4\u6258\u7b49]","text":"<ul> <li>\u539f\u6587</li> </ul>"},{"location":"ansbile_async/#ansible_1","title":"Ansible\u7684\u540c\u6b65\u6a21\u5f0f\u4e0e\u5f02\u6b65\u6a21\u5f0f","text":""},{"location":"ansbile_async/#_1","title":"\u540c\u6b65\u6a21\u5f0f\uff1a","text":"<p>\u5982\u679c\u8282\u70b9\u6570\u592a\u591a\uff0cansible\u65e0\u6cd5\u4e00\u6b21\u5728\u6240\u6709\u8fdc\u7a0b\u8282\u70b9\u4e0a\u6267\u884c\u4efb\u52a1\uff0c\u90a3\u4e48\u5c06\u5148\u5728\u4e00\u90e8\u5206\u8282\u70b9\u4e0a\u6267\u884c\u4e00\u4e2a\u4efb\u52a1(\u6bcf\u4e00\u6279\u8282\u70b9\u7684\u6570\u91cf\u53d6\u51b3\u4e8efork\u8fdb\u7a0b\u6570\u91cf\uff0c\u9ed8\u8ba4\u4e3a5\u4e2a\uff0c\u53ef\u8bbe\u7f6e)\uff0c\u76f4\u5230\u8fd9\u4e00\u6279\u6240\u6709\u8282\u70b9\u4e0a\u8be5\u4efb\u52a1\u5b8c\u5168\u6267\u884c\u5b8c\u6bd5\u624d\u4f1a\u63a5\u5165\u4e0b\u4e00\u4e2a\u6279\u8282\u70b9\uff0c\u76f4\u5230\u6240\u6709\u8282\u70b9\u5c06\u8be5\u4efb\u52a1\u90fd\u6267\u884c\u5b8c\u6bd5\uff0c\u7136\u540e\u91cd\u65b0\u56de\u5230\u7b2c\u4e00\u6279\u8282\u70b9\u5f00\u59cb\u6267\u884c\u7b2c\u4e8c\u4e2a\u4efb\u52a1\u3002\u4f9d\u6b21\u7c7b\u63a8\uff0c\u76f4\u5230\u6240\u6709\u8282\u70b9\u6267\u884c\u5b8c\u6240\u6709\u4efb\u52a1\uff0cansible\u7aef\u624d\u4f1a\u91ca\u653eshell\u3002\u8fd9\u662f\u9ed8\u8ba4\u540c\u6b65\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728\u672a\u6267\u884c\u5b8c\u6bd5\u65f6\uff0cansible\u662f\u5360\u7528\u5f53\u524dshell\u7684\uff0c\u4efb\u52a1\u6267\u884c\u5b8c\u540e\uff0c\u91ca\u653eshell\u4e86\u624d\u53ef\u4ee5\u8f93\u5165\u5176\u4ed6\u547d\u4ee4\u505a\u5176\u4ed6\u52a8\u4f5c\u3002</p>"},{"location":"ansbile_async/#_2","title":"\u5f02\u6b65\u6a21\u5f0f\uff1a","text":"<p>\u5047\u5982fork\u63a7\u5236\u7684\u5e76\u53d1\u8fdb\u7a0b\u6570\u4e3a5\uff0c\u8fdc\u7a0b\u63a7\u5236\u8282\u70b9\u4e3a24\u4e2a\uff0c\u5219ansible\u4e00\u5f00\u59cb\u4f1a\u5c065\u4e2a\u8282\u70b9\u7684\u4efb\u52a1\u6254\u5728\u540e\u53f0\uff0c\u5e76\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u53bb\u68c0\u67e5\u8fd9\u4e9b\u8282\u70b9\u7684\u4efb\u52a1\u5b8c\u6210\u60c5\u51b5\uff0c\u5f53\u67d0\u8282\u70b9\u5b8c\u6210\u4e0d\u4f1a\u7acb\u5373\u8fd4\u56de\uff0c\u800c\u662f\u7ee7\u7eed\u7b49\u5f85\u76f4\u52305\u4e2a\u8fdb\u7a0b\u90fd\u7a7a\u95f2\u4e86\uff0c\u624d\u4f1a\u5c06\u8fd95\u4e2a\u8282\u70b9\u7684\u7ed3\u679c\u8fd4\u56de\u7ed9ansible\u7aef\uff0cansible\u4f1a\u7ee7\u7eed\u5c06\u4e0b\u4e00\u62795\u4e2a\u8282\u70b9\u7684\u4efb\u52a1\u6254\u5728\u540e\u53f0\u5e76\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u8fdb\u884c\u68c0\u67e5\uff0c\u4f9d\u6b21\u7c7b\u63a8\uff0c\u76f4\u5230\u5b8c\u6210\u6240\u6709\u4efb\u52a1\u3002</p> <p>\u5728\u5f02\u6b65\u6a21\u5f0f\u4e0b\uff0c\u5982\u679c\u8bbe\u7f6e\u7684\u68c0\u67e5\u65f6\u95f4\u95f4\u9694\u4e3a0\uff0c\u5728\u5c06\u6bcf\u4e00\u6279\u8282\u70b9\u7684\u4efb\u52a1\u4e22\u5230\u540e\u53f0\u540e\u90fd\u4f1a\u7acb\u5373\u8fd4\u56deansible\uff0c\u5e76\u7acb\u5373\u5c06\u4e0b\u4e00\u6279\u8282\u70b9\u7684\u4efb\u52a1\u4e22\u5230\u540e\u53f0\uff0c\u76f4\u5230\u6240\u6709\u4efb\u52a1\u90fd\u4e22\u5230\u540e\u53f0\u5b8c\u540e\uff0c\u624d\u8fd4\u56deansible\u7aef\uff0cansible\u624d\u4f1a\u7acb\u5373\u91ca\u653e\u5360\u7528\u7684shell\u3002\u5373\u6b64\u65f6ansible\u662f\u4e0d\u4f1a\u7ba1\u5404\u4e2a\u8282\u70b9\u4efb\u52a1\u6267\u884c\u60c5\u51b5\u7684\uff0c\u4e0d\u7ba1\u6267\u884c\u6210\u529f\u6216\u5931\u8d25\u3002\u56e0\u6b64\u5728\u8f6e\u8bad\u68c0\u67e5\u65f6\u95f4\u5185\uff0cansible\u4ecd\u7136\u6b63\u5728\u8fd0\u884c(\u5c3d\u7ba1\u67d0\u6279\u4efb\u52a1\u5df2\u7ecf\u88ab\u653e\u5230\u540e\u53f0\u6267\u884c\u4e86)\uff0c\u5f53\u524dshell\u8fdb\u7a0b\u4ecd\u88ab\u5360\u7528\u5904\u4e8e\u7761\u7720\u72b6\u6001\uff0c\u53ea\u6709\u6307\u5b9a\u7684\u68c0\u67e5\u65f6\u95f4\u95f4\u9694\u4e3a0\uff0c\u624d\u4f1a\u5c3d\u5feb\u5c06\u6240\u6709\u4efb\u52a1\u653e\u5230\u540e\u53f0\u5e76\u91ca\u653eshell\u3002</p>"},{"location":"ansbile_async/#ansible-asyncpoll","title":"\u4e00\u3001Ansible\u7684\u5f02\u6b65\u548c\u8f6e\u8be2  [async\u3001poll]","text":"<p>Ansible\u6709\u65f6\u5019\u8981\u6267\u884c\u7b49\u5f85\u65f6\u95f4\u5f88\u957f\u7684\u64cd\u4f5c\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u53ef\u80fd\u8981\u6301\u7eed\u5f88\u957f\u65f6\u95f4\uff0c\u8bbe\u7f6e\u8d85\u8fc7ssh\u7684timeout\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\u53ef\u4ee5\u9009\u62e9\u5728step\u4e2d\u6307\u5b9aasync\u548cpoll\u6765\u5b9e\u73b0\u5f02\u6b65\u64cd\u4f5c\u3002\u5176\u4e2d\uff1a</p> <ul> <li>async\uff1a\u8868\u793a\u8fd9\u4e2astep\u7684\u6700\u957f\u7b49\u5f85\u65f6\u957f,  \u5982\u679c\u8bbe\u7f6e\u4e3a0, \u8868\u793a\u4e00\u76f4\u7b49\u5f85\u4e0b\u53bb\u76f4\u5230\u52a8\u4f5c\u5b8c\u6210\uff1b</li> <li>poll\uff1a\u8868\u793a\u68c0\u67e5step\u64cd\u4f5c\u7ed3\u679c\u7684\u95f4\u9694\u65f6\u957f\u3002</li> </ul> <pre><code>ansible\u9ed8\u8ba4\u7684\u6e05\u5355\u6587\u4ef6\u662f/etc/ansible/hosts\uff0c\u4e5f\u5c31\u662fansible\u548cansible-ploybook\u6267\u884c\u65f6\u9ed8\u8ba4\u8bfb\u7684\u6e05\u5355\u6587\u4ef6\u3002\u8fd9\u4e2a\u53ef\u4ee5\u81ea\u884c\u5b9a\u4e49\u3002\n[root@hostname ~]# cat /etc/ansible/ansible.cfg|grep inventory\n#inventory      = /etc/ansible/hosts\n[root@hostname ~]# cat /etc/ansible/hosts|tail -2             \n[test_server]                   #\u7ec4\u540d\u6700\u597d\u4e0d\u8981\u4f7f\u7528\"-\"\uff0c\u53ef\u4ee5\u4f7f\u7528\"_\"\n172.16.60.241\n\n1\uff09\u5148\u6765\u770b\u4e0b\u9762\u521d\u59cb\u914d\u7f6e\n[root@hostname ~]# cat /etc/ansible/test.yml\n- hosts : test_server\n  tasks :\n    - name : ansible-test\n      shell : sleep 10\n#async\u8868\u793a\u4e0a\u8ff0shell\u547d\u4ee4\u7684\u7b49\u5f85\u65f6\u95f4,\u8bbe\u7f6e\u4e3a0\u65f6\u4f1a\u4e00\u76f4\u7b49\u5f85\u547d\u4ee4\u7ed3\u675f\nasync : 5\n#poll\u8868\u793a\u68c0\u67e5step\u64cd\u4f5c\u7ed3\u679c\u7684\u95f4\u9694\u65f6\u957f,\u8bbe\u7f6e\u4e3a0\u8868\u793a \u4e0d\u7528\u7b49\u5f85\u7ed3\u679c,\u7ee7\u7eed\u505a\u4e0b\u9762\u7684\u64cd\u4f5c,\u6211\u4eec\u53ef\u4ee5\u5728\u4e0b\u9762\u7684step\u4e2d\u6765\u9a8c\u8bc1\u8fd9\u4e2a\u547d\u4ee4\u662f\u5426\u6210\u529f\u6267\u884c.\npoll : 2\n\u6267\u884c\u4e0b\u770b\u770b\u662f\u5426\u6210\u529f\uff1a\n[root@hostname ~]# ansible-playbook /etc/ansible/test.yml\nPLAY [test_server] *******************************************************************************************************************************\n\nTASK [Gathering Facts] ***************************************************************************************************************************\nok: [172.16.60.241]\nTASK [ansible-test] ******************************************************************************************************************************\nfatal: [172.16.60.241]: FAILED! =&gt; {\"changed\": false, \"msg\": \"async task did not complete within the requested time - 5s\"}\nPLAY RECAP ***************************************************************************************************************************************\n172.16.60.241              : ok=1    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0 \u5982\u4e0a\uff0c\u8fd9\u4e2astep\u5931\u8d25, \u56e0\u4e3aansible\u7684\u4efb\u52a1(\u5c31\u662f\u4e0a\u9762\u914d\u7f6e\u4e2d\u7684shell\u52a8\u4f5c)\u64cd\u4f5c\u65f6\u95f4(10s)\u8d85\u8fc7\u4e86\u6700\u5927\u7b49\u5f85\u65f6\u957f(5s)\n2\uff09\u5982\u679c\u5c06\u4e0a\u9762\u7684async\u5f02\u6b65\u7b49\u5f85\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u5927\u4e8e10s\uff0c\u6bd4\u598212s\uff0c\u5219\u6267\u884c\u5c31\u6210\u529f\u4e86\uff01\n[root@hostname ~]# cat /etc/ansible/test.yml\n- hosts : test_server\n  tasks :\n    - name : ansible-test\n      shell : sleep 10\n#async\u8868\u793a\u4e0a\u8ff0shell\u547d\u4ee4\u7684\u7b49\u5f85\u65f6\u95f4,\u8bbe\u7f6e\u4e3a0\u65f6\u4f1a\u4e00\u76f4\u7b49\u5f85\u547d\u4ee4\u7ed3\u675f\nasync : 12\n#poll\u8868\u793a\u68c0\u67e5step\u64cd\u4f5c\u7ed3\u679c\u7684\u95f4\u9694\u65f6\u957f,\u8bbe\u7f6e\u4e3a0\u8868\u793a \u4e0d\u7528\u7b49\u5f85\u7ed3\u679c,\u7ee7\u7eed\u505a\u4e0b\u9762\u7684\u64cd\u4f5c,\u6211\u4eec\u53ef\u4ee5\u5728\u4e0b\u9762\u7684step\u4e2d\u6765\u9a8c\u8bc1\u8fd9\u4e2a\u547d\u4ee4\u662f\u5426\u6210\u529f\u6267\u884c.\npoll : 2\n[root@hostname ~]# ansible-playbook /etc/ansible/test.yml             \nPLAY [test_server] *******************************************************************************************************************************\n\nTASK [Gathering Facts] ***************************************************************************************************************************\nok: [172.16.60.241]\nTASK [ansible-test] ******************************************************************************************************************************\nchanged: [172.16.60.241]\nPLAY RECAP ***************************************************************************************************************************************\n172.16.60.241              : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\u8fd9\u65f6\u5019\u5c31\u4e0d\u6015\u4efb\u52a1\u8d85\u65f6\u4e86\u3002\u53ef\u4ee5\u6267\u884c\u4e00\u4e2a12s\u7684\u4efb\u52a1\uff08\u5927\u4e8e\u4e0a\u9762shell\u6267\u884c\u7684\u65f6\u95f4\uff09\u3002\u53e6\u5916\uff0c\u5982\u679cpoll\u4e3a0\uff0c\u5c31\u76f8\u5f53\u4e8e\u4e00\u4e2a\u4e0d\u5173\u5fc3\u7ed3\u679c\u7684\u4efb\u52a1\u3002\n\n3\uff09\u6216\u8005\u5c06\u4e0a\u9762\u7684poll\u6570\u503c\u8bbe\u7f6e\u4e3a0\uff0c\u5373\u4e0d\u7528\u7b49\u5f85ansible\u4efb\u52a1\u6267\u884c\u7684\u7ed3\u679c\uff0c\u7acb\u5373\u6267\u884c\u4e0b\u4e00\u4e2astep\u3002\n\u5373\u53ea\u9700\u8981\u5c06\u4efb\u52a1\u547d\u4ee4\u63a8\u9001\u5230ansible\u5ba2\u6237\u673a\u4e0a\uff0c\u4e0d\u9700\u8981\u7b49\u5f85\u4efb\u52a1\u6267\u884c\u5b8c\u6210\u5c31\u7acb\u5373\u6267\u884c\u4e0b\u4e00\u4e2astep\u3002\n\n[root@hostname ~]# cat /etc/ansible/test.yml\n- hosts : test_server\n  tasks :\n    - name : ansible-test\n      shell : sleep 10\n#async\u8868\u793a\u4e0a\u8ff0shell\u547d\u4ee4\u7684\u7b49\u5f85\u65f6\u95f4,\u8bbe\u7f6e\u4e3a0\u65f6\u4f1a\u4e00\u76f4\u7b49\u5f85\u547d\u4ee4\u7ed3\u675f\nasync : 5\n#poll\u8868\u793a\u68c0\u67e5step\u64cd\u4f5c\u7ed3\u679c\u7684\u95f4\u9694\u65f6\u957f,\u8bbe\u7f6e\u4e3a0\u8868\u793a \u4e0d\u7528\u7b49\u5f85\u7ed3\u679c,\u7ee7\u7eed\u505a\u4e0b\u9762\u7684\u64cd\u4f5c,\u6211\u4eec\u53ef\u4ee5\u5728\u4e0b\u9762\u7684step\u4e2d\u6765\u9a8c\u8bc1\u8fd9\u4e2a\u547d\u4ee4\u662f\u5426\u6210\u529f\u6267\u884c.\npoll : 0\n[root@hostname ~]# ansible-playbook /etc/ansible/test.yml\nPLAY [test_server] *******************************************************************************************************************************\n\nTASK [Gathering Facts] ***************************************************************************************************************************\nok: [172.16.60.241]\nTASK [ansible-test] ******************************************************************************************************************************\nchanged: [172.16.60.241]\nPLAY RECAP ***************************************************************************************************************************************\n172.16.60.241              : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0  4\uff09\u5982\u679c\u8fd8\u60f3\u8981\u66f4\u65b9\u4fbf\u5730\u770b\u8f6e\u8be2\u7ed3\u679c\uff0cansible\u8fd8\u63d0\u4f9b\u4e86\u8fd9\u4e2a\u6a21\u5757async_status\u3002\n[root@hostname ~]# cat /etc/ansible/test.yml             \n- hosts : test_server\n  tasks :\n    - name : ansible-test\n      shell : sleep 3\nasync : 8\npoll : 2\nregister: kevin_result\n\n- name: 'check ansible-test task polling results '\nasync_status: jid={{ kevin_result.ansible_job_id }}\nregister: job_result\n      until: job_result.finished\n      retries: 10\n[root@hostname ~]# ansible-playbook /etc/ansible/test.yml\nPLAY [test_server] *******************************************************************************************************************************\n\nTASK [Gathering Facts] ***************************************************************************************************************************\nok: [172.16.60.241]\nTASK [ansible-test] ******************************************************************************************************************************\nchanged: [172.16.60.241]\nTASK [check ansible-test task polling results] ***************************************************************************************************\nchanged: [172.16.60.241]\nPLAY RECAP ***************************************************************************************************************************************\n172.16.60.241              : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \u7b2c\u4e00\u4e2ajob\u6267\u884c\u5f02\u6b65\u4efb\u52a1sleep\uff0c\u5e76\u4e14\u6ce8\u518c\u4e86\u4e00\u4e2a\u540d\u5b57\u53ebkevin-result\u7684register\u53d8\u91cf\uff0c\u7528\u4e8e\u63d0\u4f9b\u7ed9\u7b2c\u4e8c\u4e2ajob\u4f5c\u4e3a\u8f6e\u8be2\u5bf9\u8c61\uff0c\u5e76\u4e14\u5b83\u81ea\u5df1poll\u8bbe\u4e3a2 (\u5373\u81ea\u5df1\u8f6e\u8be22\u6b21)\u3002\nregister\u7528\u4e8e\u5728ansible\u7684playbook\u4e2dtask\u4e4b\u95f4\u7684\u76f8\u4e92\u4f20\u9012\u53d8\u91cf\uff0c\nregister \u8fd9\u4e2a\u529f\u80fd\u975e\u5e38\u6709\u7528\u3002\u5f53\u6211\u4eec\u9700\u8981\u5224\u65ad\u5bf9\u6267\u884c\u4e86\u67d0\u4e2a\u64cd\u4f5c\u6216\u8005\u67d0\u4e2a\u547d\u4ee4\u540e\uff0c\u5982\u4f55\u505a\u76f8\u5e94\u7684\u54cd\u5e94\u5904\u7406\uff08\u6267\u884c\u5176\u4ed6 ansible \u8bed\u53e5\uff09\uff0c\u5219\u4e00\u822c\u4f1a\u7528\u5230register \u3002\nuntil\u8868\u793a\u5faa\u73af\u3002\n\n\u7b2c\u4e8c\u4e2ajob\u4f7f\u7528async_status\u6a21\u5757\uff0c\u8fdb\u884c\u8f6e\u8be2\u5e76\u8fd4\u56de\u8f6e\u8be2\u7ed3\u679c\u3002\u51c6\u5907\u68c0\u67e510\u6b21\u3002\n</code></pre> <ul> <li><code>async</code>\u53c2\u6570\u503c\uff1a\u4ee3\u8868\u4e86\u8fd9\u4e2a\u4efb\u52a1\u6267\u884c\u65f6\u95f4\u7684\u4e0a\u9650\u503c\u3002\u5373\u4efb\u52a1\u6267\u884c\u6240\u7528\u65f6\u95f4\u5982\u679c\u8d85\u51fa\u8fd9\u4e2a\u65f6\u95f4\uff0c\u5219\u8ba4\u4e3a\u4efb\u52a1\u5931\u8d25\u3002\u6b64\u53c2\u6570\u82e5\u672a\u8bbe\u7f6e\uff0c\u5219\u4e3a\u540c\u6b65\u6267\u884c\u3002</li> <li><code>poll</code>\u53c2\u6570\u503c\uff1a\u4ee3\u8868\u4e86\u4efb\u52a1\u5f02\u6b65\u6267\u884c\u65f6\u8f6e\u8be2\u7684\u65f6\u95f4\u95f4\u9694\u3002</li> </ul>"},{"location":"ansbile_async/#ansible-serialmax_fail_percentage","title":"\u4e8c\u3001Ansible\u7684\u5e76\u53d1\u9650\u5236  [serial\u3001max_fail_percentage]","text":"<p>\u5f53ansible\u6e05\u5355\u6587\u4ef6\u91cc\u8bbe\u7f6e\u7684\u7ec4\u91cc\u6709\u5f88\u591a\u673a\u5668\uff0c\u53ef\u4ee5\u9650\u5236\u4e00\u4e0bansible\u4efb\u52a1\u7684\u5e76\u53d1\u3002ansible\u7684\u5e76\u53d1\u529f\u80fd\u53ef\u4ee5\u5728ansible.cfg\u91cc\u4fee\u6539\u914d\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u5728playbook\u4e2d\u9650\u5236\u670d\u52a1\u7aef\u7684\u5e76\u53d1\u6570\u91cf\uff0c\u8fd9\u662fansible\u7ecf\u5e38\u7528\u5230\u7684\u4e00\u4e2a\u5173\u952e\u529f\u80fd\u3002ansible\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u53ea\u4f1a\u521b\u5efa5\u4e2a\u8fdb\u7a0b\uff0c\u6240\u4ee5\u4e00\u6b21\u4efb\u52a1\u53ea\u80fd\u540c\u65f6\u63a7\u52365\u53f0\u673a\u5668\u6267\u884c\u3002\u5982\u679c\u6709\u5927\u91cf\u7684\u673a\u5668\u9700\u8981\u63a7\u5236\uff0c\u6216\u8005\u5e0c\u671b\u51cf\u5c11\u8fdb\u7a0b\u6570\uff0c\u90a3\u5c31\u53ef\u4ee5\u91c7\u53d6\u5f02\u6b65\u6267\u884c\uff08async\uff09\uff0cansible\u7684\u6a21\u5757\u53ef\u4ee5\u628atask\u653e\u8fdb\u540e\u53f0\uff0c\u7136\u540e\u8f6e\u8be2\u5b83\uff08poll\uff09\u3002</p> <p>\u4f7f\u7528async\u548cpoll\u8fd9\u4e24\u4e2a\u5173\u952e\u5b57\u4fbf\u53ef\u4ee5\u5e76\u884c\u8fd0\u884c\u4e00\u4e2a\u4efb\u52a1\uff0c\u5373\u5728\u6240\u6709\u673a\u5668\u4e0a\u4e00\u6b21\u6027\u8fd0\u884c\u3002async\u8fd9\u4e2a\u5173\u952e\u5b57\u4f1a\u89e6\u53d1ansible\u5e76\u884c\u8fd0\u4f5c\u4efb\u52a1\uff0casync\u7684\u503c\u662fansible\u7b49\u5f85\u8fd0\u884c\u8fd9\u4e2a\u4efb\u52a1\u7684\u6700\u5927\u8d85\u65f6\u503c(\u5982\u679c\u6267\u884c\u8d85\u65f6\u4efb\u52a1\u4f1a\u5f3a\u5236\u4e2d\u65ad\u5bfc\u81f4\u5931\u8d25)\uff0c\u800cpoll\u5c31\u662fansible\u68c0\u67e5\u8fd9\u4e2a\u4efb\u52a1\u662f\u5426\u5b8c\u6210\u7684\u9891\u7387\u65f6\u95f4\u3002</p> <pre><code>1) serial\u53c2\u6570\u8bbe\u7f6e\u5e76\u53d1\u6570\n=====================================================================\n\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c ansible\u4f1a\u540c\u65f6\u5728\u6240\u6709\u670d\u52a1\u5668\u4e0a\u6267\u884c\u7528\u6237\u5b9a\u4e49\u7684\u64cd\u4f5c\uff0c \u4f46\u662f\u7528\u6237\u53ef\u4ee5\u901a\u8fc7serial\u53c2\u6570\u6765\u5b9a\u4e49\u540c\u65f6\u53ef\u4ee5\u5728\u591a\u5c11\u592a\u673a\u5668\u4e0a\u6267\u884c\u64cd\u4f5c\u3002\n\n[root@hostname ~]# cat /etc/ansible/test.yml\n- hosts : test_server\n  serial: 3\ntasks :\n    - name: Install telnet\n      yum: name=telnet state=installed\n\n\u5373test_server\u7ec4\u5185\u76843\u53f0\u673a\u5668\u5b8c\u5168\u6267\u884c\u5b8c\u6210play\u540e\uff0c \u5176\u4ed6\u673a\u5668\u624d\u80fd\u5f00\u59cb\u6267\u884c\u3002\n\n\u63a5\u7740\u770b\u4e0b\u9762\u7684\u914d\u7f6e\n[root@hostname ~]# cat /etc/ansible/test.yml\n- hosts : all\n  serial: 7\ntasks :\n    - name: Install telnet\n      yum: name=telnet state=installed\n\n- name : Run Serverstart.sh\n      command : /bin/bash /opt/scripts/Serverstart.sh\n      async : 300\npoll : 10\nregister: kevin_result\n\n\u5982\u4e0a\u914d\u7f6e\uff0c\u53d1\u73b0\u5f53ansible\u914d\u7f6e\u63a7\u5236\u8d85\u8fc75\u53f0\u673a\u5668\u65f6\uff0c\u4e0a\u9762ansible\u4e2d\uff1a\na\uff09yum\u6a21\u5757\u4f1a\u5148\u57285\u53f0\u673a\u5668\u4e0a\u8dd1\uff0c\u5b8c\u6210\u540e\u518d\u7ee7\u7eed\u5269\u4f592\u53f0\u7684\u673a\u5668\uff1b\nb\uff09command\u6a21\u5757\u7684\u4efb\u52a1\u4f1a\u4e00\u6b21\u6027\u5728\u6240\u6709\u673a\u5668\u4e0a\u90fd\u6267\u884c\u4e86\uff0c\u7136\u540e\u76d1\u542c\u5b83\u7684\u56de\u8c03\u7ed3\u679c\uff1b\n\n\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u4e0b\u9762\u4e24\u79cd\u60c5\u51b5\na\uff09\u60c5\u51b5\u4e00\uff1a \u8bbe\u7f6epoll=0\n\u5982\u679c\u4e0a\u9762command\u6a21\u5757\u662f\u63a7\u5236\u673a\u5668\u5f00\u542f\u4e00\u4e2a\u8fdb\u7a0b\u653e\u5230\u540e\u53f0,\u90a3\u5c31\u4e0d\u9700\u8981\u68c0\u67e5\u8fd9\u4e2a\u4efb\u52a1\u662f\u5426\u5b8c\u6210\u4e86\uff0c\u53ea\u9700\u8981\u7ee7\u7eed\u5176\u4ed6\u7684\u52a8\u4f5c, \u6700\u540e\u518d\u4f7f\u7528wait_for\u8fd9\u4e2a\u6a21\u5757\u53bb\u68c0\u67e5\u4e4b\u524d\u7684\u8fdb\u7a0b\u662f\u5426\u6309\u9884\u671f\u4e2d\u5f00\u542f\u4e86\u4fbf\u53ef\u3002\n\u8fd9\u65f6\u53ea\u9700\u8981\u628apoll\u8fd9\u4e2a\u503c\u8bbe\u7f6e\u4e3a0, \u4fbf\u53ef\u4ee5\u6309\u4e0a\u9762\u7684\u8981\u6c42\u914d\u7f6eansible\u4e0d\u7b49\u5f85job\u7684\u5b8c\u6210\u3002\nb\uff09\u60c5\u51b5\u4e8c\uff1a \u8bbe\u7f6easync=0\n\u5982\u679c\u6709\u4e00\u79cd\u9700\u6c42\u662f\u6709\u4e00\u4e2atask\u5b83\u662f\u9700\u8981\u8fd0\u884c\u5f88\u957f\u7684\u65f6\u95f4,\u90a3\u5c31\u9700\u8981\u8bbe\u7f6e\u4e00\u76f4\u7b49\u5f85\u8fd9\u4e2ajob\u5b8c\u6210\u3002\n\u8fd9\u4e2a\u65f6\u5019\u53ea\u9700\u8981\u628aasync\u7684\u503c\u8bbe\u62100\u4fbf\u53ef\u3002\n\n\u7b80\u5355\u603b\u7ed3\u4e0b\uff0c\u9002\u5408\u4f7f\u7528\u5230ansible\u7684polling\u7279\u6027\u7684\u573a\u666f\n- \u6709\u4e00\u4e2atask\u9700\u8981\u8fd0\u884c\u5f88\u957f\u7684\u65f6\u95f4,\u8fd9\u4e2atask\u5f88\u53ef\u80fd\u4f1a\u8fbe\u5230timeout\uff1b\n- \u6709\u4e00\u4e2a\u4efb\u52a1\u9700\u8981\u5728\u5927\u91cf\u7684\u673a\u5668\u4e0a\u9762\u8fd0\u884c\uff1b\n- \u6709\u4e00\u4e2a\u4efb\u52a1\u662f\u4e0d\u9700\u8981\u7b49\u5f85\u5b83\u5b8c\u6210\u7684\uff1b\n\n\u4e0d\u9002\u5408\u4f7f\u7528polling\u7279\u6027\u7684\u573a\u666f\n- task\u4efb\u52a1\u662f\u9700\u8981\u8fd0\u884c\u5b8c\u540e\u624d\u80fd\u7ee7\u7eed\u53e6\u5916\u7684\u4efb\u52a1\u7684\uff1b\n- task\u4efb\u52a1\u80fd\u5f88\u5feb\u7684\u5b8c\u6210\uff1b\n\n2) max_fail_percentage\uff1a\u6700\u5927\u5931\u8d25\u767e\u5206\u6bd4\n=====================================================================\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b, \u53ea\u8981ansible\u7684group\u4e2d\u8fd8\u6709server\u6ca1\u6709\u5931\u8d25, ansible\u5c31\u662f\u7ee7\u7eed\u6267\u884ctasks\u3002\u5b9e\u9645\u4e0a, \u7528\u6237\u53ef\u4ee5\u901a\u8fc7max_fail_percentage\uff08\u6700\u5927\u5931\u8d25\u767e\u5206\u6bd4\uff09\u6765\u9650\u5236ansible\u7684\u5e76\u53d1\u6267\u884c\u3002\n\u53ea\u8981\u8d85\u8fc7max_fail_percentage\u7684server\u5931\u8d25, ansible\u5c31\u53ef\u4ee5\u4e2d\u6b62tasks\u7684\u6267\u884c\u3002serial\u53c2\u6570\u5728ansible-1.8\u4ee5\u540e\u5c31\u5f00\u59cb\u652f\u6301\u767e\u5206\u6bd4\u529f\u80fd\u4e86\uff01\uff01\n\n\u8bd5\u60f3\u4e00\u4e0b\u5982\u679cgroup\u7ec4\u91cc\u6709200\u53f0\u673a\u5668\uff0c\u90a3\u4e48\u5982\u679c\u4f7f\u7528serial\u6765\u9650\u5236\u5e76\u53d1\u6570\u91cf\uff0c\u6bd4\u5982\u8bbe\u7f6eserial=10\uff0c\u610f\u601d\u5c31\u662f\u4e00\u6b21\u53ea\u6267\u884c10\u53f0\uff0c\u4e00\u76f4\u5230200\u53f0\u5b8c\u6210\u3002\n\u53ea\u8981\u7ec4\u5185\u8fd8\u6709server\u6ca1\u6709\u5931\u8d25, ansible\u5c31\u662f\u7ee7\u7eed\u6267\u884ctasks\u3002\u8fd9\u6837\u5c31\u663e\u5f97\u6548\u7387\u5f88\u4f4e\u4e86\uff0c\u5f88\u4e0d\u65b9\u4fbf\uff01\u8fd9\u65f6\u5c31\u53ef\u4ee5\u4f7f\u7528\u7c7b\u4f3c\u63a7\u5236\u6d41\u7684max_fail_percentage\u529f\u80fd\u4e86\uff01\uff01\n\n[root@hostname ~]# cat /etc/ansible/test.yml\n- hosts : all\n  max_fail_percentage: 30\nserial: 10\ntasks :\n    - name: Install telnet\n      yum: name=telnet state=installed\n\n- name : Run Serverstart.sh\n      command : /bin/bash /opt/scripts/Serverstart.sh\n      async : 300\npoll : 10\nregister: kevin_result\n\n\u5982\u4e0a\u914d\u7f6e\uff0c\u537310\u53f0\u673a\u5668\u91cc\u670930%\u7684\u673a\u5668\u6267\u884cyum\u6a21\u5757\u7684task\u4efb\u52a1\u5931\u8d25\uff0c\u90a3\u4e48\u5c31\u7ec8\u6b62\u8fd9\u4e2a10\u53f0\u673a\u5668\u7684task\u4efb\u52a1\u7684\u6267\u884c\uff0c\u63a5\u7740\u6267\u884c\u4e0b\u4e00\u7ec410\u53f0\u673a\u5668\u7684task\u4efb\u52a1\uff0c\u8fd9\u6837\u6548\u679c\u5c31\u5f88\u68d2\u4e86\u3002\n\n\u6e29\u99a8\u63d0\u793a\uff1a\n\u5b9e\u9645\u5931\u8d25\u673a\u5668\u5fc5\u987b\u5927\u4e8e\u8fd9\u4e2a\u767e\u5206\u6bd4\u65f6, tasks\u4efb\u52a1\u624d\u4f1a\u88ab\u4e2d\u6b62\uff1b\u5982\u679c\u7b49\u4e8e\u8fd9\u4e2a\u767e\u5206\u6bd4\u65f6\uff0ctask\u4efb\u52a1\u662f\u4e0d\u4f1a\u88ab\u7ec8\u6b62\u7684\uff01\n</code></pre> <p>\u8e29\u5751\u7ecf\u9a8c\uff1aAnsible\u5e76\u53d1\u5931\u8d25\uff08fork=100. \u4f46\u662f\u771f\u6b63\u6267\u884cplaybook\u65f6\u5e76\u6ca1\u6709\u5b9e\u73b0\u5e76\u53d1\uff09</p> <pre><code>[root@hostname ~]# cd /usr/lib/python2.7/site-packages/ansible/\n[root@hostname ansible]# find . -name ssh.py\n./plugins/connection/ssh.py\n\n[root@hostname ansible]# vim plugins/connection/ssh.py\n.........\n.........\n   if C.HOST_KEY_CHECKING and not_in_host_file:\n        # lock around the initial SSH connectivity so the user prompt about whether to add\n# the host to known hosts is not intermingled with multiprocess output.\nfcntl.lockf(self.runner.process_lockfile, fcntl.LOCK_EX)\nfcntl.lockf(self.runner.output_lockfile, fcntl.LOCK_EX)\n# create process\n(p, stdin) = self._run(ssh_cmd, in_data)\n.........\n.........\n\n\u901a\u8fc7\u4ee5\u4e0a\u6587\u4ef6\u4ee3\u7801\u53ef\u4ee5\u770b\u51fa\uff1a\n\u5982\u679cansible\u914d\u7f6e\"HOST_KEY_CHECKING=True\", \u5e76\u4e14ansible\u5ba2\u6237\u673a\u4fe1\u606f\u6ca1\u6709\u5728ansible\u670d\u52a1\u7aef\u7684~/.ssh/known_hosts\u91cc\u9762, \u4e00\u4e2a\u8fdb\u7a0b\u5c31\u4f1a\u9501\u6b7b~/.ssh/known_hosts\u6587\u4ef6\u3002\n\u8fd9\u6837ansible\u5c31\u4e0d\u80fd\u5b9e\u73b0\u5e76\u53d1\uff01\n\n\u89e3\u51b3\u65b9\u6848:\n\u5728ansible\u670d\u52a1\u7aef\u7684/etc/ansible/ansible.cfg\u6587\u4ef6\u91cc\u914d\u7f6e\"host_key_checking = False\"    [\u5176\u5b9eansible.cfg\u6587\u4ef6\u91cc\u8be5\u9879\u9ed8\u8ba4\u914d\u7f6e\u7684\u5c31\u662fFalse]\n</code></pre>"},{"location":"ansbile_async/#ansible-delegate_todelegate_factsrun_once","title":"\u4e09\u3001Ansible\u7684\u4efb\u52a1\u59d4\u6258  [delegate_to\u3001delegate_facts\u3001run_once]","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cansible\u7684\u6240\u6709\u4efb\u52a1\u90fd\u662f\u5728\u6307\u5b9a\u7684\u673a\u5668\u4e0a\u8fd0\u884c\u7684\u3002\u5f53\u5728\u4e00\u4e2a\u72ec\u7acb\u7684\u7fa4\u96c6\u73af\u5883\u4e2d\u914d\u7f6e\u65f6\uff0c\u53ea\u662f\u60f3\u64cd\u4f5c\u5176\u4e2d\u7684\u67d0\u4e00\u53f0\u4e3b\u673a\uff0c\u6216\u8005\u5728\u7279\u5b9a\u7684\u4e3b\u673a\u4e0a\u8fd0\u884ctask\u4efb\u52a1\uff0c\u6b64\u65f6\u5c31\u9700\u8981\u7528\u5230ansible\u7684\u4efb\u52a1\u59d4\u6258\u529f\u80fd\u3002\u4f7f\u7528delegate_to\u5173\u952e\u5b57\u53ef\u4ee5\u914d\u7f6etask\u4efb\u52a1\u5728\u6307\u5b9a\u7684\u673a\u5668\u4e0a\u6267\u884c\uff0c\u5c31\u662f\u8bf4\u5176\u4ed6\u7684task\u4efb\u52a1\u8fd8\u662f\u5728hosts\u5173\u952e\u5b57\u914d\u7f6e\u7684\u673a\u5668\u4e0a\u8fd0\u884c\uff0c\u5230\u4e86\u8fd9\u4e2a\u5173\u952e\u5b57\u6240\u5728\u7684\u4efb\u52a1\u65f6\uff0c\u5c31\u4f7f\u7528\u59d4\u6258\u7684\u673a\u5668\u8fd0\u884c\u3002</p> <pre><code>1\uff09\u59d4\u6258\n=====================================================================\n\u901a\u8fc7\"delegate_to\", ansible\u53ef\u4ee5\u628a\u67d0\u4e00\u4e2atask\u4efb\u52a1\u653e\u5728\u59d4\u6258\u7684\u673a\u5668\u4e0a\u6267\u884c\u3002\u5373\u5728\u6307\u5b9a\u7684\u7ec4\u5185\u7684\u67d0\u4e00\u53f0\u6216\u591a\u53f0\u673a\u5668\u4e0a\u6267\u884ctask\u4efb\u52a1\u3002\n\n[root@hostname ~]# cat /etc/ansible/test.yml\n- hosts : test_server\n  serial: 10\ntasks :\n    - name: test-haha\n      shell: echo \"test\" &gt; /root/test.list\n      delegate_to: 172.16.60.245\n\n\u5219\u4e0a\u9762\u7684shell\u6a21\u5757\u7684task\u4efb\u52a1\u53ea\u4f1a\u5728172.16.60.245\u8fd9\u53f0\u8282\u70b9\u4e0a\u6267\u884c\uff0ctest_server\u7ec4\u5185\u5176\u4ed6\u7684\u673a\u5668\u4e0d\u4f1a\u6267\u884cshell\u4efb\u52a1\u3002\n\n---------------------\n\u5982\u679c \"delegate_to: 127.0.0.1\" \u5219\u53ef\u4ee5\u7528local_action\u6765\u4ee3\u66ff\u3002\u5373\u4e0b\u9762\u4e24\u4e2a\u914d\u7f6e\u6548\u679c\u662f\u4e00\u6837\u7684\uff01\uff01\n[root@hostname ~]# cat /etc/ansible/test.yml \n- hosts : test_server\n  serial: 10\ntasks :\n    - name: test-haha\n      shell: echo \"test\" &gt; /root/test.list\n      delegate_to: 127.0.0.1\n\n[root@hostname ~]# cat /etc/ansible/test.yml\n- hosts : test_server\n  serial: 10\ntasks :\n    - name: test-haha\n      local_action: shell echo \"test\" &gt; /root/test.list\n\n-------------------\n\u5982\u679c\u8bbe\u7f6e\u4e86\u591a\u4e2adelegate_to\uff0c\u5219\u6267\u884c\u65f6\u53ea\u4f1a\u5339\u914d\u6700\u4e0b\u9762\u90a3\u4e2a\u3002\n\u4f8b\u5982\u4e0b\u9762\u914d\u7f6e\u4e2d\uff0c\u53ea\u4f1a\u6267\u884c\"delegate_to: 172.16.60.245\", \u4e0a\u9762\u90a3\u4e2a\"delegate_to: 172.16.60.241\"\u5c31\u4f1a\u88ab\u5ffd\u7565\u4e86\u3002\n[root@hostname ansible]# cat /etc/ansible/test.yml\n- hosts : all\n  serial: 10\ntasks :\n    - name: test-haha\n      shell: echo \"test\" &gt; /root/test.list\n      delegate_to: 172.16.60.241\n      delegate_to: 172.16.60.245\n\n-------------------\ndelegate_to\u9ed8\u8ba4\u540e\u9762\u53ea\u80fd\u8ddf\u4e00\u4e2a\u4e3b\u673aip\uff0c\u4e0d\u80fd\u8ddf\u591a\u4e2a\u4e3b\u673aip\u3002\u5373\u9ed8\u8ba4\u59d4\u6258\u5230\u5355\u4e2a\u4e3b\u673a\u3002\n\u5982\u679c\u6709\u591a\u4e2aip\u9700\u8981\u59d4\u6258\uff0c\u5219\u53ef\u4ee5\u5c06\u8fd9\u4e9bip\u91cd\u65b0\u653e\u4e00\u4e2agroup\uff0c\u7136\u540edelegate_to\u59d4\u6258\u7ed9group\u7ec4\u3002\ndelegate_to\u59d4\u6258\u5230\u7ec4\u7684\u65b9\u5f0f\uff1a\u901a\u8fc7items\u53d8\u91cf\u65b9\u5f0f\uff01\uff01\uff01\n\n[root@hostname ansible]# cat /etc/ansible/hosts |tail -8\n[test_server]\n172.16.60.241\n172.16.60.245\n172.16.60.246\n127.0.0.1\n\n[kevin_server]\n172.16.60.246\n127.0.0.1\n\n[root@hostname ansible]# cat /etc/ansible/test.yml \n- hosts: all\n  tasks:\n    - name: test-haha\n      shell: echo \"test\" &gt; /root/test.list\n      delegate_to: \"{{item}}\"\nwith_items: \"{{groups['kevin_server']}}\"\n\u5373\u5c06shell\u8fd9\u4e2atask\u4efb\u52a1\u59d4\u6258\u7ed9kevin_server\u7ec4\u5185\u7684\u673a\u5668\u6267\u884c\u3002\n\n2\uff09\u59d4\u6258\u8005\u7684facts\n=====================================================================\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b, ansible\u59d4\u6258\u4efb\u52a1\u7684facts\u662finventory_hostname\u4e2d\u4e3b\u673a\u7684facts, \u800c\u4e0d\u662f\u88ab\u59d4\u6258\u673a\u5668\u7684facts\u3002\n\na) delegate_facts\n\u5728ansible 2.0 \u4e2d, \u901a\u8fc7\u8bbe\u7f6e\"delegate_facts: True\"\u53ef\u4ee5\u8ba9task\u4efb\u52a1\u53bb\u6536\u96c6\u88ab\u59d4\u6258\u673a\u5668\u7684facts\u3002\n[root@hostname ~]# cat /etc/ansible/test.yml\n- hosts: test_server\n  tasks:\n    - name: test-haha\n      shell: echo \"test\" &gt; /root/test.list\n      delegate_to: \"{{item}}\"\ndelegate_facts: True\n      with_items: \"{{groups['kevin_server']}}\"\n\u5982\u4e0a\u914d\u7f6e\uff0c\u8868\u793a\u4f1a\u6536\u96c6kevin_server\u7684facts\u5e76\u5206\u914d\u7ed9\u8fd9\u4e9b\u673a\u5668, \u800c\u4e0d\u4f1a\u53bb\u6536\u96c6test_server\u7684facts\n\nb\uff09RUN ONCE\n\u901a\u8fc7\u8bbe\u7f6e\"run_once: true\"\u6765\u6307\u5b9a\u8be5task\u53ea\u80fd\u5728\u59d4\u6258\u7684\u67d0\u4e00\u53f0\u673a\u5668\u6216\u59d4\u6258\u7684\u7ec4\u5185\u673a\u5668\u4e0a\u6267\u884c\u4e00\u6b21\uff01\uff01\u53ef\u4ee5\u548cdelegate_to \u7ed3\u5408\u4f7f\u7528\u3002\n\u5982\u679c\u6ca1\u6709delegate_to, \u90a3\u4e48\u8fd9\u4e2atask\u9ed8\u8ba4\u5c31\u4f1a\u5728\u7b2c\u4e00\u53f0\u673a\u5668\u4e0a\u6267\u884c\uff01\uff01\uff01\n[root@hostname ~]# cat /etc/ansible/test.yml\n- hosts: test_server\n  tasks:\n    - name: test-haha\n      shell: echo \"test\" &gt; /root/test.list\n      delegate_to: \"{{item}}\"\nrun_once: true\ndelegate_facts: True\n      with_items: \"{{groups['kevin_server']}}\"\n</code></pre>"},{"location":"awk/","title":"\u4e09\u5341\u5206\u949f\u5b66\u4f1aAWK","text":""},{"location":"awk/#awk","title":"\u4e09\u5341\u5206\u949f\u5b66\u4f1aAWK","text":"<ul> <li>\u4e09\u5341\u5206\u949f\u5b66\u4f1aAWK</li> <li>\u539f\u6587GITHUB</li> <li>mylxsw\u7684 GITHUB</li> <li>\u7a0b\u5e8f\u733f\u6210\u957f\u8ba1\u5212</li> </ul> <p><code>\u6a21\u5f0f</code>\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3a<code>\u6761\u4ef6</code></p> <pre><code>awk [option] 'pattern[action]' file...\nawk [option] '\u6a21\u5f0f {\u52a8\u4f5c}' \u6587\u4ef6\n</code></pre> <ul> <li>BEGIN\u6a21\u5f0f\u662f\u5904\u7406\u6587\u672c\u4e4b\u524d\u9700\u8981\u6267\u884c\u7684\u64cd\u4f5c</li> <li>END\u6a21\u5f0f\u662f\u5904\u7406\u5b8c\u6240\u6709\u884c\u4e4b\u540e\u6267\u884c\u7684\u64cd\u4f5c</li> </ul>"},{"location":"awk/#awk_1","title":"awk\u53c2\u6570","text":"\u53c2\u6570 \u89e3\u91ca -F \u6307\u5b9a\u5206\u5272\u5b57\u6bb5 -v \u5b9a\u4e49\u6216\u4fee\u6539awk\u5185\u90e8\u7684\u53d8\u91cf -f \u4ece\u811a\u672c\u6587\u4ef6\u4e2d\u8bfb\u53d6awk\u547d\u4ee4 <p>\u5bf9\u4e8eawk\u800c\u8a00,\u53d8\u91cf\u5206\u4e3a</p> <ul> <li>\u5185\u7f6e\u53d8\u91cf</li> <li>\u81ea\u5b9a\u4e49\u53d8\u91cf</li> </ul> \u5185\u7f6e\u53d8\u91cf \u89e3\u91ca FS FS: field separator, \u8f93\u5165\u5b57\u6bb5\u5206\u9694\u7b26,\u9ed8\u8ba4\u4e3a\u7a7a\u767d\u5b57\u7b26 OFS OFS:OFS is an output equivalent of awk FS variable,\u8f93\u51fa\u5b57\u6bb5\u5206\u9694\u7b26,\u9ed8\u8ba4\u4e3a\u7a7a\u767d\u5b57\u7b26 RS RS: record separator, \u8f93\u5165\u8bb0\u5f55\u5206\u9694\u7b26(\u8f93\u5165\u6362\u884c\u7b26),\u6307\u5b9a\u8f93\u5165\u65f6\u7684\u6362\u884c\u7b26 ORS ORS:ORS is an Output equivalent of RS\u8f93\u51fa\u8bb0\u5f55\u5206\u9694\u7b26(\u8f93\u51fa\u6362\u884c\u7b26),\u8f93\u51fa\u65f6\u7528\u6307\u5b9a\u7b26\u53f7\u4ee3\u66ff\u6362\u884c\u7b26 NF NF: number of Field, \u5f53\u524d\u884c\u7684\u5b57\u6bb5\u7684\u4e2a\u6570(\u5373\u5f53\u524d\u884c\u88ab\u5206\u5272\u4e86\u51e0\u5217),\u5b57\u6bb5\u6570\u91cf NR NR: number of records(\u884c\u53f7), \u5f53\u524d\u5904\u7406\u7684\u6587\u672c\u884c\u7684\u884c\u53f7. FNR FNR: Number of Records relative to the current input file\u5404\u6587\u4ef6\u5206\u522b\u8ba1\u6570\u7684\u884c\u53f7 FILENAME FILENAME: \u5f53\u524d\u6587\u4ef6\u540d ARGC ARGC: \u547d\u4ee4\u884c\u53c2\u6570\u7684\u4e2a\u6570 ARGV ARGV:\u6570\u7ec4,\u4fdd\u5b58\u7684\u662f\u547d\u4ee4\u884c\u6240\u7ed9\u5b9a\u7684\u5404\u53c2\u6570"},{"location":"awk/#_1","title":"\u5185\u7f6e\u53d8\u91cf","text":""},{"location":"awk/#nrnffnr","title":"NR,NF,FNR","text":"<ul> <li>awk\u7684\u5185\u7f6e\u53d8\u91cfNR,NF\u662f\u4e0d\u8981\u6dfb\u52a0$\u7b26\u53f7\u7684</li> <li>\u800c<code>$0 $1 $2...</code>\u662f\u9700\u8981\u6dfb\u52a0$\u7b26\u53f7\u7684</li> </ul>"},{"location":"awk/#_2","title":"\u6a21\u5f0f","text":"\u5173\u7cfb\u8fd0\u7b97\u7b26 \u89e3\u91ca \u793a\u4f8b &lt; \u5c0f\u4e8e x&lt;y &lt;= \u5c0f\u4e8e\u7b49\u4e8e x&lt;=y == \u7b49\u4e8e x==y != \u4e0d\u7b49\u4e8e x!=y &gt;= \u5927\u4e8e\u7b49\u4e8e x&gt;=y &gt; \u5927\u4e8e x&gt;y ~ \u5339\u914d\u6b63\u5219 x~/\u6b63\u5219/ !~ \u4e0d\u5339\u914d\u6b63\u5219 x!~/\u6b63\u5219/ <pre><code>$ awk -F \":\" 'BEGIN{print \"===\"} NR==3,NR==5 {printf \"%s %s\\n\", NR,$1} END{print \"@@@\"}' xxx_list\n===\n3 1-1\n4 1-8\n5 1000th\n@@@\n$ \n\n$ awk -v FS=\".\" 'BEGIN{print \"###\"} {print NR,NF,$1,$2,$3 }' xxx_list | head\n###\n1 5 xxx:mysql db xxx\n2 5 ttt:maria db ttt\n\n$ awk -v FS=\".\" 'BEGIN{print \"###\"} {print ARGV[1], NR,NF,$1,$2,$3 }' xxx_list | head\n###\nxxx_list 1 5 xxx:mysql db xxx\nxxx_list 2 5 ttt:maria db ttt\n</code></pre>"},{"location":"awk/#_3","title":"\u81ea\u5b9a\u4e49\u53d8\u91cf","text":"<ul> <li>\u65b9\u6cd5\u4e00: <code>-v varName=value</code></li> <li>\u65b9\u6cd5\u4e8c: \u5728\u7a0b\u5e8f\u4e2d\u76f4\u63a5\u5b9a\u4e49</li> </ul>"},{"location":"awk/#awk_2","title":"awk\u4e0e\u6b63\u5219\u8868\u8fbe\u5f0f","text":""},{"location":"awk/#_4","title":"\u6b63\u5219\u8868\u8fbe\u5f0f","text":"<pre><code>awk '/\u6b63\u5219\u8868\u8fbe\u5f0f/ {\u52a8\u4f5c}' file\n</code></pre>"},{"location":"awk/#_5","title":"\u884c\u8bbf\u95ee\u6a21\u5f0f","text":"<pre><code>awk '/\u6b63\u52191/,/\u6b63\u52192/ {\u52a8\u4f5c}' file\n</code></pre> <pre><code>$ awk -F \":\" '/^5may/ {print $1,$NF}' osn_mysql40_acc_list\n5may mysql31.db.google.com\n\nwww2323# cat /home/.logs/users/xxx/access_log.20230502 | awk '$1 ~ \"xxx.sa|xxx.org|xxx.xxx.ne.jp\" {print $3}' | uniq -n\n</code></pre>"},{"location":"awk/#awk_3","title":"awk\u547d\u4ee4\u6267\u884c\u6d41\u7a0b","text":"<p>\u89e3\u8bfb\u9700\u6c42: \u4ece\u6587\u4ef6\u4e2d\u5bfb\u627e\u60f3\u8981\u7684\u4fe1\u606f,\u6309\u7167\u4ee5\u4e0b\u987a\u5e8f\u6267\u884c</p> <pre><code>awk 'BEGIN {commands} pattern{commands} END{commands}' file...\n</code></pre> <ol> <li>\u4f18\u5148\u6267\u884c<code>BEGIN{}</code>\u6a21\u5f0f\u4e2d\u7684\u8bed\u53e5</li> <li>\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u7b2c\u4e00\u884c,\u7136\u540e\u6267\u884c<code>pattern{commads}</code>,\u8fdb\u884c\u6b63\u5219\u5339\u914d<code>/^n/</code>\u5bfb\u627en\u5f00\u5934\u7684\u884c,\u627e\u5230\u4e4b\u540e\u6267\u884c<code>{print}</code>\u8fdb\u884c\u6253\u5370</li> <li>\u5f53awk\u8bfb\u53d6\u6587\u4ef6\u6570\u636e\u6d41\u7684\u7ed3\u5c3e\u65f6, \u4f1a\u6267\u884c<code>END{commads}</code></li> </ol>"},{"location":"awk/#_6","title":"\u6982\u8ff0","text":"<p>AWK\u662f\u4e00\u95e8\u89e3\u91ca\u578b\u7684\u7f16\u7a0b\u8bed\u8a00\u3002\u5728\u6587\u672c\u5904\u7406\u9886\u57df\u5b83\u662f\u975e\u5e38\u5f3a\u5927\u7684\uff0c\u5b83\u7684\u540d\u5b57\u6765\u6e90\u4e8e\u5b83\u7684\u4e09\u4f4d\u4f5c\u8005\u7684\u59d3\u6c0f\uff1aAlfred Aho\uff0c Peter Weinberger \u548c Brian Kernighan\u3002</p> <p>GNU/Linux\u53d1\u5e03\u7684AWK\u76ee\u524d\u7531\u81ea\u7531\u8f6f\u4ef6\u57fa\u91d1\u4f1a\uff08FSF\uff09\u8fdb\u884c\u5f00\u53d1\u548c\u7ef4\u62a4\uff0c\u901a\u5e38\u4e5f\u79f0\u5b83\u4e3a GNU AWK\u3002</p>"},{"location":"awk/#awk_4","title":"AWK\u7684\u7c7b\u578b","text":"<p>\u4e0b\u9762\u662f\u51e0\u4e2aAWK\u7684\u53d8\u4f53\uff1a</p> <ul> <li>AWK - \u539f\u5148\u6765\u6e90\u4e8e AT &amp; T \u5b9e\u9a8c\u5ba4\u7684\u7684AWK</li> <li>NAWK - AT &amp; T \u5b9e\u9a8c\u5ba4\u7684AWK\u7684\u5347\u7ea7\u7248</li> <li>GAWK - \u8fd9\u5c31\u662fGNU AWK\u3002\u6240\u6709\u7684GNU/Linux\u53d1\u5e03\u7248\u90fd\u81ea\u5e26GAWK\uff0c\u5b83\u4e0eAWK\u548cNAWK\u5b8c\u5168\u517c\u5bb9</li> </ul>"},{"location":"awk/#awk_5","title":"AWK\u7684\u5178\u578b\u7528\u9014","text":"<p>\u4f7f\u7528AWK\u53ef\u4ee5\u505a\u5f88\u591a\u4efb\u52a1\uff0c\u4e0b\u9762\u662f\u5176\u4e2d\u4e00\u4e9b</p> <ul> <li>\u6587\u672c\u5904\u7406</li> <li>\u8f93\u51fa\u683c\u5f0f\u5316\u7684\u6587\u672c\u62a5\u8868</li> <li>\u6267\u884c\u7b97\u6570\u8fd0\u7b97</li> <li>\u6267\u884c\u5b57\u7b26\u4e32\u64cd\u4f5c\u7b49\u7b49</li> </ul>"},{"location":"awk/#_7","title":"\u5de5\u4f5c\u6d41","text":"<p>\u8981\u6210\u4e3aAWK\u7f16\u7a0b\u4e13\u5bb6\uff0c\u4f60\u9700\u8981\u5148\u77e5\u9053\u5b83\u7684\u5185\u90e8\u5b9e\u73b0\u673a\u5236\uff0cAWK\u9075\u5faa\u4e86\u975e\u5e38\u7b80\u5355\u7684\u5de5\u4f5c\u6d41 - \u8bfb\u53d6\uff0c\u6267\u884c\u548c\u91cd\u590d\uff0c\u4e0b\u56fe\u63cf\u8ff0\u4e86AWK\u7684\u5de5\u4f5c\u6d41\u3002</p> <p></p> <p>Read</p> <p>AWK\u4ece\u8f93\u5165\u6d41\uff08\u6587\u4ef6\uff0c\u7ba1\u9053\u6216\u8005\u6807\u51c6\u8f93\u5165\uff09\u4e2d\u8bfb\u53d6\u4e00\u884c\uff0c\u7136\u540e\u5b58\u50a8\u5230\u5185\u5b58\u4e2d\u3002</p> <p>Execute</p> <p>\u6240\u6709\u7684AWK\u547d\u4ee4\u90fd\u4f9d\u6b21\u5728\u8f93\u5165\u4e0a\u6267\u884c\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAWK\u4f1a\u5bf9\u6bcf\u4e00\u884c\u6267\u884c\u547d\u4ee4\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u63d0\u4f9b\u6a21\u5f0f\u9650\u5236\u8fd9\u79cd\u884c\u4e3a\u3002</p> <p>Repeat</p> <p>\u5904\u7406\u8fc7\u7a0b\u4e0d\u65ad\u91cd\u590d\uff0c\u76f4\u5230\u5230\u8fbe\u6587\u4ef6\u7ed3\u5c3e\u3002</p>"},{"location":"awk/#_8","title":"\u7a0b\u5e8f\u7ed3\u6784","text":"<p>\u73b0\u5728\uff0c\u8ba9\u6211\u4eec\u5148\u5b66\u4e60\u4e00\u4e0bAWK\u7684\u7a0b\u5e8f\u7ed3\u6784\u3002</p>"},{"location":"awk/#begin","title":"BEGIN \u8bed\u53e5\u5757","text":"<p>BEGIN\u8bed\u53e5\u5757\u7684\u8bed\u6cd5</p> <pre><code>BEGIN {awk-commands}\n</code></pre> <p>BEGIN\u8bed\u53e5\u5757\u5728\u7a0b\u5e8f\u5f00\u59cb\u7684\u4f7f\u7528\u6267\u884c\uff0c\u5b83\u53ea\u6267\u884c\u4e00\u6b21\uff0c\u5728\u8fd9\u91cc\u53ef\u4ee5\u521d\u59cb\u5316\u53d8\u91cf\u3002BEGIN\u662fAWK\u7684\u5173\u952e\u5b57\uff0c\u56e0\u6b64\u5b83\u5fc5\u987b\u4e3a\u5927\u5199\uff0c\u6ce8\u610f\uff0c\u8fd9\u4e2a\u8bed\u53e5\u5757\u662f\u53ef\u9009\u7684\u3002</p>"},{"location":"awk/#body","title":"BODY \u8bed\u53e5\u5757","text":"<p>BODY\u8bed\u53e5\u5757\u7684\u8bed\u6cd5</p> <pre><code>/pattern/ {awk-commands}\n</code></pre> <p>BODY\u8bed\u53e5\u5757\u4e2d\u7684\u547d\u4ee4\u4f1a\u5bf9\u8f93\u5165\u7684\u6bcf\u4e00\u884c\u6267\u884c\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u63d0\u4f9b\u6a21\u5f0f\u6765\u63a7\u5236\u8fd9\u79cd\u884c\u4e3a\u3002\u6ce8\u610f\uff0cBODY\u8bed\u53e5\u5757\u6ca1\u6709\u5173\u952e\u5b57\u3002</p>"},{"location":"awk/#end","title":"END \u8bed\u53e5\u5757","text":"<p>END\u8bed\u53e5\u5757\u7684\u8bed\u6cd5</p> <pre><code>END {awk-commands}\n</code></pre> <p>END\u8bed\u53e5\u5757\u5728\u7a0b\u5e8f\u7684\u6700\u540e\u6267\u884c\uff0cEND\u662fAWK\u7684\u5173\u952e\u5b57\uff0c\u56e0\u6b64\u5fc5\u987b\u4e3a\u5927\u5199\uff0c\u5b83\u4e5f\u662f\u53ef\u9009\u7684\u3002</p> <p>\u8ba9\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u5305\u542b\u5e8f\u53f7\uff0c\u5b66\u751f\u59d3\u540d\uff0c\u79d1\u76ee\u540d\u79f0\u548c\u5f97\u5206\u7684\u6587\u4ef6 marks.txt\u3002</p> <pre><code>1)  Amit    Physics  80\n2)  Rahul   Maths    90\n3)  Shyam   Biology  87\n4)  Kedar   English  85\n5)  Hari    History  89\n</code></pre> <p>\u4e0b\u9762\u7684\u4f8b\u5b50\u4e2d\u6211\u4eec\u5c06\u4f1a\u663e\u793a\u6587\u4ef6\u5185\u5bb9\uff0c\u5e76\u4e14\u6dfb\u52a0\u6bcf\u4e00\u5217\u7684\u6807\u9898</p> <pre><code>$ awk 'BEGIN{printf \"Sr No\\tName\\tSub\\tMarks\\n\"} {print}' marks.txt\n</code></pre> <p>\u4e0a\u8ff0\u4ee3\u7801\u6267\u884c\u540e\uff0c\u8f93\u51fa\u4ee5\u4e0b\u5185\u5bb9</p> <pre><code>Sr No     Name     Sub          Marks\n 1)       Amit     Physics      80\n 2)       Rahul    Maths        90\n 3)       Shyam    Biology      87\n 4)       Kedar    English      85\n 5)       Hari     History      89\n</code></pre> <p>\u5728\u7a0b\u5e8f\u7684\u5f00\u59cb\uff0cAWK\u5728BEGIN\u8bed\u53e5\u4e2d\u6253\u5370\u51fa\u6807\u9898\u3002\u7136\u540e\u518dBODY\u8bed\u53e5\u4e2d\uff0c\u5b83\u4f1a\u8bfb\u53d6\u6587\u4ef6\u7684\u6bcf\u4e00\u884c\u7136\u540e\u6267\u884cAWK\u7684print\u547d\u4ee4\u5c06\u6bcf\u4e00\u884c\u7684\u5185\u5bb9\u6253\u5370\u5230\u6807\u51c6\u8f93\u51fa\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u4e00\u76f4\u91cd\u590d\u76f4\u5230\u6587\u4ef6\u7684\u7ed3\u5c3e\u3002</p>"},{"location":"awk/#_9","title":"\u57fa\u7840\u8bed\u6cd5","text":"<p>AWK\u7684\u4f7f\u7528\u975e\u5e38\u7b80\u5355\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728\u547d\u4ee4\u884c\u4e2d\u6267\u884cAWK\u7684\u547d\u4ee4\uff0c\u4e5f\u53ef\u4ee5\u4ece\u5305\u542bAWK\u547d\u4ee4\u7684\u6587\u672c\u6587\u4ef6\u4e2d\u6267\u884c\u3002</p>"},{"location":"awk/#awk_6","title":"AWK\u547d\u4ee4\u884c","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5355\u5f15\u53f7\u5728\u547d\u4ee4\u884c\u4e2d\u6307\u5b9aAWK\u547d\u4ee4</p> <pre><code>awk [options] file ...\n</code></pre> <p>\u6bd4\u5982\u6211\u4eec\u6709\u4e00\u4e2a\u5305\u542b\u4e0b\u9762\u5185\u5bb9\u7684\u6587\u672c\u6587\u4ef6 marks.txt:</p> <pre><code>1) Amit     Physics    80\n2) Rahul    Maths      90\n3) Shyam    Biology    87\n4) Kedar    English    85\n5) Hari     History    89\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u663e\u793a\u8be5\u6587\u4ef6\u7684\u5b8c\u6574\u5185\u5bb9</p> <pre><code>$ awk '{print}' marks.txt\n</code></pre>"},{"location":"awk/#awk_7","title":"AWK\u7a0b\u5e8f\u6587\u4ef6","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u811a\u672c\u6587\u4ef6\u63d0\u4f9bAWK\u547d\u4ee4</p> <pre><code>awk [options] -f file ....\n</code></pre> <p>\u9996\u5148\uff0c\u521b\u5efa\u4e00\u4e2a\u5305\u542b\u4e0b\u9762\u5185\u5bb9\u7684\u6587\u672c\u6587\u4ef6 command.awk</p> <pre><code>{print}\n</code></pre> <p>\u73b0\u5728\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba9AWK\u6267\u884c\u8be5\u6587\u4ef6\u4e2d\u7684\u547d\u4ee4\uff0c\u8fd9\u91cc\u6211\u4eec\u5b9e\u73b0\u4e86\u548c\u4e0a\u4f8b\u540c\u6837\u7684\u7ed3\u679c</p> <pre><code>$ awk -f command.awk marks.txt\n</code></pre>"},{"location":"awk/#awk_8","title":"AWK\u6807\u51c6\u9009\u9879","text":"<p>AWK\u652f\u6301\u4e0b\u5217\u547d\u4ee4\u884c\u6807\u51c6\u9009\u9879</p>"},{"location":"awk/#-v","title":"<code>-v</code> \u53d8\u91cf\u8d4b\u503c\u9009\u9879","text":"<p>\u8be5\u9009\u9879\u5c06\u4e00\u4e2a\u503c\u8d4b\u4e88\u4e00\u4e2a\u53d8\u91cf\uff0c\u5b83\u4f1a\u5728\u7a0b\u5e8f\u5f00\u59cb\u4e4b\u524d\u8fdb\u884c\u8d4b\u503c\uff0c\u4e0b\u9762\u7684\u4f8b\u5b50\u63cf\u8ff0\u4e86\u8be5\u9009\u9879\u7684\u4f7f\u7528</p> <pre><code>$ awk -v name=Jerry 'BEGIN{printf \"Name = %s\\n\", name}'\nName = Jerry\n</code></pre>"},{"location":"awk/#-dump-variablesfile","title":"<code>--dump-variables[=file]</code> \u9009\u9879","text":"<p>\u8be5\u9009\u9879\u4f1a\u8f93\u51fa\u6392\u597d\u5e8f\u7684\u5168\u5c40\u53d8\u91cf\u5217\u8868\u548c\u5b83\u4eec\u6700\u7ec8\u7684\u503c\u5230\u6587\u4ef6\u4e2d\uff0c\u9ed8\u8ba4\u7684\u6587\u4ef6\u662f awkvars.out\u3002</p> <pre><code>$ awk --dump-variables ''\n$ cat awkvars.out \nARGC: 1\nARGIND: 0\nARGV: array, 1 elements\nBINMODE: 0\nCONVFMT: \"%.6g\"\nERRNO: \"\"\nFIELDWIDTHS: \"\"\nFILENAME: \"\"\nFNR: 0\nFPAT: \"[^[:space:]]+\"\nFS: \" \"\nIGNORECASE: 0\nLINT: 0\nNF: 0\nNR: 0\nOFMT: \"%.6g\"\nOFS: \" \"\nORS: \"\\n\"\nRLENGTH: 0\nRS: \"\\n\"\nRSTART: 0\nRT: \"\"\nSUBSEP: \"\\034\"\nTEXTDOMAIN: \"messages\"\n</code></pre>"},{"location":"awk/#-help","title":"<code>--help</code> \u9009\u9879","text":"<p>\u6253\u5370\u5e2e\u52a9\u4fe1\u606f\u3002</p> <pre><code>$ awk --help\nUsage: awk [POSIX or GNU style options] -f progfile [--] file ...\nUsage: awk [POSIX or GNU style options] [--] 'program' file ...\nPOSIX options : GNU long options: (standard)\n   -f progfile                --file=progfile\n   -F fs                      --field-separator=fs\n   -v var=val                 --assign=var=val\nShort options : GNU long options: (extensions)\n   -b                         --characters-as-bytes\n   -c                         --traditional\n   -C                         --copyright\n   -d[file]                   --dump-variables[=file]\n   -e 'program-text'          --source='program-text'\n   -E file                    --exec=file\n   -g                         --gen-pot\n   -h                         --help\n   -L [fatal]                 --lint[=fatal]\n   -n                         --non-decimal-data\n   -N                         --use-lc-numeric\n   -O                         --optimize\n   -p[file]                   --profile[=file]\n   -P                         --posix\n   -r                         --re-interval\n   -S                         --sandbox\n   -t                         --lint-old\n   -V                         --version\n</code></pre>"},{"location":"awk/#-lintfatal","title":"<code>--lint[=fatal]</code> \u9009\u9879","text":"<p>\u8be5\u9009\u9879\u5141\u8bb8\u68c0\u67e5\u7a0b\u5e8f\u7684\u4e0d\u517c\u5bb9\u6027\u6216\u8005\u6a21\u68f1\u4e24\u53ef\u7684\u4ee3\u7801\uff0c\u5f53\u63d0\u4f9b\u53c2\u6570 fatal\u7684\u65f6\u5019\uff0c\u5b83\u4f1a\u5bf9\u5f85Warning\u6d88\u606f\u4f5c\u4e3aError\u3002</p> <pre><code>$ awk --lint '' /bin/ls\nawk: cmd. line:1: warning: empty program text on command line\nawk: cmd. line:1: warning: source file does not end in newline\nawk: warning: no program text at all!\n</code></pre>"},{"location":"awk/#-posix","title":"<code>--posix</code> \u9009\u9879","text":"<p>\u8be5\u9009\u9879\u5f00\u542f\u4e25\u683c\u7684POSIX\u517c\u5bb9\u3002</p>"},{"location":"awk/#-profilefile","title":"<code>--profile[=file]</code>\u9009\u9879","text":"<p>\u8be5\u9009\u9879\u4f1a\u8f93\u51fa\u4e00\u4efd\u683c\u5f0f\u5316\u4e4b\u540e\u7684\u7a0b\u5e8f\u5230\u6587\u4ef6\u4e2d\uff0c\u9ed8\u8ba4\u6587\u4ef6\u662f awkprof.out\u3002</p> <pre><code>$ awk --profile 'BEGIN{printf\"---|Header|--\\n\"} {print} \nEND{printf\"---|Footer|---\\n\"}' marks.txt &gt; /dev/null \n$ cat awkprof.out\n    # gawk \u914d\u7f6e, \u521b\u5efa Wed Oct 26 15:05:49 2016\n\n    # BEGIN \u5757\n\n    BEGIN {\n        printf \"---|Header|--\\n\"\n    }\n\n    # \u89c4\u5219\n\n    {\n        print $0\n    }\n\n    # END \u5757\n\n    END {\n        printf \"---|Footer|---\\n\"\n    }\n</code></pre>"},{"location":"awk/#-traditional","title":"<code>--traditional</code> \u9009\u9879","text":"<p>\u8be5\u9009\u9879\u4f1a\u7981\u6b62\u6240\u6709\u7684gawk\u89c4\u8303\u7684\u6269\u5c55\u3002</p>"},{"location":"awk/#-version","title":"<code>--version</code> \u9009\u9879","text":"<p>\u8f93\u51fa\u7248\u672c\u53f7</p> <pre><code>$ awk --version\nGNU Awk 3.1.7\n\u7248\u6743\u6240\u6709 \u00a9 1989, 1991-2009 \u81ea\u7531\u8f6f\u4ef6\u57fa\u91d1\u4f1a(FSF)\u3002\n\n\u8be5\u7a0b\u5e8f\u4e3a\u81ea\u7531\u8f6f\u4ef6\uff0c\u4f60\u53ef\u4ee5\u5728\u81ea\u7531\u8f6f\u4ef6\u57fa\u91d1\u4f1a\u53d1\u5e03\u7684 GNU \u901a\u7528\u516c\u5171\u8bb8\u53ef\u8bc1(GPL)\u7b2c\n3\u7248\u6216\u4ee5\u540e\u7248\u672c\u4e0b\u4fee\u6539\u6216\u91cd\u65b0\u53d1\u5e03\u3002\n\n\u8be5\u7a0b\u5e8f\u4e4b\u6240\u4ee5\u88ab\u53d1\u5e03\u662f\u56e0\u4e3a\u5e0c\u671b\u4ed6\u80fd\u5bf9\u4f60\u6709\u6240\u7528\u5904\uff0c\u4f46\u6211\u4eec\u4e0d\u4f5c\u4efb\u4f55\u62c5\u4fdd\u3002\u8fd9\u5305\u542b\n\u4f46\u4e0d\u9650\u4e8e\u4efb\u4f55\u5546\u4e1a\u9002\u552e\u6027\u4ee5\u53ca\u9488\u5bf9\u7279\u5b9a\u76ee\u7684\u7684\u9002\u7528\u6027\u7684\u62c5\u4fdd\u3002\u8be6\u60c5\u53c2\u89c1 GNU \u901a\u7528\u516c\n\u5171\u8bb8\u53ef\u8bc1(GPL)\u3002\n\n\u4f60\u5e94\u8be5\u6536\u5230\u7a0b\u5e8f\u9644\u5e26\u7684\u4e00\u4efd GNU \u901a\u7528\u516c\u5171\u8bb8\u53ef\u8bc1(GPL)\u3002\u5982\u679c\u6ca1\u6709\u6536\u5230\uff0c\u8bf7\u53c2\u770b http://www.gnu.org/licenses/ \u3002\nYou have new mail in /var/spool/mail/root\n</code></pre>"},{"location":"awk/#_10","title":"\u57fa\u672c\u4f7f\u7528\u793a\u4f8b","text":"<p>\u672c\u90e8\u5206\u4f1a\u8bb2\u8ff0\u4e00\u4e9b\u6709\u7528\u7684AWK\u547d\u4ee4\u548c\u5b83\u4eec\u7684\u4f7f\u7528\u793a\u4f8b\uff0c\u6240\u6709\u7684\u4f8b\u5b50\u90fd\u662f\u4ee5\u4e0b\u9762\u7684\u6587\u672c\u6587\u4ef6 marks.txt \u4e3a\u57fa\u7840\u7684</p> <pre><code>1) Amit Physics     80\n2) Rahul    Maths       90\n3) Shyam    Biology     87\n4) Kedar    English     85\n5) Hari History     89\n</code></pre>"},{"location":"awk/#_11","title":"\u6253\u5370\u67d0\u5217\u6216\u8005\u5b57\u6bb5","text":"<p>AWK\u53ef\u4ee5\u53ea\u6253\u5370\u8f93\u5165\u5b57\u6bb5\u4e2d\u7684\u67d0\u4e9b\u5217\u3002</p> <pre><code>$ awk '{print $3 \"\\t\" $4}' marks.txt\nPhysics 80\nMaths   90\nBiology 87\nEnglish 85\nHistory 89\n</code></pre> <p>\u5728\u6587\u4ef6marks.txt\u4e2d\uff0c\u7b2c\u4e09\u5217\u5305\u542b\u4e86\u79d1\u76ee\u540d\uff0c\u7b2c\u56db\u5217\u5219\u662f\u5f97\u5206\uff0c\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u53ea\u6253\u5370\u51fa\u4e86\u8fd9\u4e24\u5217\uff0c$3 \u548c $4 \u4ee3\u8868\u4e86\u8f93\u5165\u8bb0\u5f55\u4e2d\u7684\u7b2c\u4e09\u548c\u7b2c\u56db\u4e2a\u5b57\u6bb5\u3002</p>"},{"location":"awk/#_12","title":"\u6253\u5370\u6240\u6709\u7684\u884c","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAWK\u4f1a\u6253\u5370\u51fa\u6240\u6709\u5339\u914d\u6a21\u5f0f\u7684\u884c</p> <pre><code>$ awk '/a/ {print $0}' marks.txt\n2)  Rahul   Maths    90\n3)  Shyam   Biology  87\n4)  Kedar   English  85\n5)  Hari    History  89\n</code></pre> <p>\u4e0a\u8ff0\u547d\u4ee4\u4f1a\u5224\u65ad\u6bcf\u4e00\u884c\u4e2d\u662f\u5426\u5305\u542b<code>a</code>\uff0c\u5982\u679c\u5305\u542b\u5219\u6253\u5370\u8be5\u884c\uff0c\u5982\u679cBODY\u90e8\u5206\u7f3a\u5931\u5219\u9ed8\u8ba4\u4f1a\u6267\u884c\u6253\u5370\uff0c\u56e0\u6b64\uff0c\u4e0a\u8ff0\u547d\u4ee4\u548c\u4e0b\u9762\u8fd9\u4e2a\u662f\u7b49\u4ef7\u7684</p> <pre><code>$ awk '/a/' marks.txt\n</code></pre>"},{"location":"awk/#_13","title":"\u6253\u5370\u5339\u914d\u6a21\u5f0f\u7684\u5217","text":"<p>\u5f53\u6a21\u5f0f\u5339\u914d\u6210\u529f\u65f6\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0bAWK\u4f1a\u6253\u5370\u8be5\u884c\uff0c\u4f46\u662f\u4e5f\u53ef\u4ee5\u8ba9\u5b83\u53ea\u6253\u5370\u6307\u5b9a\u7684\u5b57\u6bb5\u3002\u4f8b\u5982\uff0c\u4e0b\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u53ea\u4f1a\u6253\u5370\u51fa\u5339\u914d\u6a21\u5f0f\u7684\u7b2c\u4e09\u548c\u7b2c\u56db\u4e2a\u5b57\u6bb5\u3002</p> <pre><code>$ awk '/a/ {print $3 \"\\t\" $4}' marks.txt\nMaths   90\nBiology 87\nEnglish 85\nHistory 89\n</code></pre>"},{"location":"awk/#_14","title":"\u4efb\u610f\u987a\u5e8f\u6253\u5370\u5217","text":"<pre><code>$ awk '/a/ {print $4 \"\\t\" $3}' marks.txt\n90  Maths\n87  Biology\n85  English\n89  History\n</code></pre>"},{"location":"awk/#_15","title":"\u7edf\u8ba1\u5339\u914d\u6a21\u5f0f\u7684\u884c\u6570","text":"<pre><code>$ awk '/a/{++cnt} END {print \"Count = \", cnt}' marks.txt\nCount =  4\n</code></pre>"},{"location":"awk/#18","title":"\u6253\u5370\u8d85\u8fc718\u4e2a\u5b57\u7b26\u7684\u884c","text":"<pre><code>$ awk 'length($0) &gt; 18' marks.txt\n3) Shyam   Biology   87\n4) Kedar   English   85\n</code></pre>"},{"location":"awk/#_16","title":"\u5185\u5efa\u53d8\u91cf","text":"<p>AWK\u63d0\u4f9b\u4e86\u5f88\u591a\u5185\u7f6e\u7684\u53d8\u91cf\uff0c\u5b83\u4eec\u5728\u5f00\u53d1AWK\u811a\u672c\u7684\u8fc7\u7a0b\u4e2d\u8d77\u7740\u975e\u5e38\u91cd\u8981\u7684\u89d2\u8272\u3002</p>"},{"location":"awk/#awk_9","title":"\u6807\u51c6AWK\u53d8\u91cf","text":""},{"location":"awk/#argc","title":"ARGC \u547d\u4ee4\u884c\u53c2\u6570\u4e2a\u6570","text":"<p>\u547d\u4ee4\u884c\u4e2d\u63d0\u4f9b\u7684\u53c2\u6570\u4e2a\u6570</p> <pre><code>$ awk 'BEGIN {print \"Arguments =\", ARGC}' One Two Three Four\nArguments = 5\n</code></pre>"},{"location":"awk/#argv","title":"ARGV \u547d\u4ee4\u884c\u53c2\u6570\u6570\u7ec4","text":"<p>\u5b58\u50a8\u547d\u4ee4\u884c\u53c2\u6570\u7684\u6570\u7ec4\uff0c\u7d22\u5f15\u8303\u56f4\u4ece0 - ARGC - 1\u3002</p> <pre><code>$ awk 'BEGIN { \n   for (i = 0; i &lt; ARGC - 1; ++i) { \n      printf \"ARGV[%d] = %s\\n\", i, ARGV[i] \n   } \n}' one two three four\nARGV[0] = awk\nARGV[1] = one\nARGV[2] = two\nARGV[3] = three\n</code></pre>"},{"location":"awk/#convfmt","title":"CONVFMT \u6570\u5b57\u7684\u7ea6\u5b9a\u683c\u5f0f","text":"<p>\u4ee3\u8868\u4e86\u6570\u5b57\u7684\u7ea6\u5b9a\u683c\u5f0f\uff0c\u9ed8\u8ba4\u503c\u662f%.6g</p> <pre><code>$ awk 'BEGIN { print \"Conversion Format =\", CONVFMT }'\nConversion Format = %.6g\n</code></pre>"},{"location":"awk/#environ","title":"ENVIRON \u73af\u5883\u53d8\u91cf","text":"<p>\u73af\u5883\u53d8\u91cf\u7684\u5173\u8054\u6570\u7ec4</p> <pre><code>$ awk 'BEGIN { print ENVIRON[\"USER\"] }'\nmylxsw\n</code></pre>"},{"location":"awk/#filename","title":"FILENAME \u5f53\u524d\u6587\u4ef6\u540d","text":"<pre><code>$ awk 'END {print FILENAME}' marks.txt\nmarks.txt\n</code></pre>"},{"location":"awk/#fs","title":"FS \u8f93\u5165\u5b57\u6bb5\u7684\u5206\u9694\u7b26","text":"<p>\u4ee3\u8868\u4e86\u8f93\u5165\u5b57\u6bb5\u7684\u5206\u9694\u7b26\uff0c\u9ed8\u8ba4\u503c\u4e3a\u7a7a\u683c\uff0c\u53ef\u4ee5\u901a\u8fc7<code>-F</code>\u9009\u9879\u5728\u547d\u4ee4\u884c\u9009\u9879\u4e2d\u4fee\u6539\u5b83\u3002</p> <pre><code>$ awk 'BEGIN {print \"FS = \" FS}' | cat -vte\nFS =  $\n$ awk -F , 'BEGIN {print \"FS = \" FS}' | cat -vte\nFS = ,$\n</code></pre>"},{"location":"awk/#nf","title":"NF \u5b57\u6bb5\u6570\u76ee","text":"<p>\u4ee3\u8868\u4e86\u5f53\u524d\u884c\u4e2d\u7684\u5b57\u6bb5\u6570\u76ee\uff0c\u4f8b\u5982\u4e0b\u9762\u4f8b\u5b50\u6253\u5370\u51fa\u4e86\u5305\u542b\u5927\u4e8e\u4e24\u4e2a\u5b57\u6bb5\u7684\u884c</p> <pre><code>$ echo -e \"One Two\\nOne Two Three\\nOne Two Three Four\" | awk 'NF &gt; 2'\nOne Two Three\nOne Two Three Four\n</code></pre>"},{"location":"awk/#nr","title":"NR \u884c\u53f7","text":"<pre><code>$ echo -e \"One Two\\nOne Two Three\\nOne Two Three Four\" | awk 'NR &lt; 3'\nOne Two\nOne Two Three\n</code></pre>"},{"location":"awk/#fnr","title":"FNR \u884c\u53f7\uff08\u76f8\u5bf9\u5f53\u524d\u6587\u4ef6\uff09","text":"<p>\u4e0eNR\u76f8\u4f3c\uff0c\u4e0d\u8fc7\u5728\u5904\u7406\u591a\u6587\u4ef6\u65f6\u66f4\u6709\u7528\uff0c\u83b7\u53d6\u7684\u884c\u53f7\u76f8\u5bf9\u4e8e\u5f53\u524d\u6587\u4ef6\u3002</p>"},{"location":"awk/#ofmt","title":"OFMT \u8f93\u51fa\u683c\u5f0f\u6570\u5b57","text":"<p>\u9ed8\u8ba4\u503c\u4e3a%.6g</p> <pre><code>$ awk 'BEGIN {print \"OFMT = \" OFMT}'\nOFMT = %.6g\n</code></pre>"},{"location":"awk/#ofs","title":"OFS \u8f93\u51fa\u5b57\u6bb5\u5206\u9694\u7b26","text":"<p>\u8f93\u51fa\u5b57\u6bb5\u5206\u9694\u7b26\uff0c\u9ed8\u8ba4\u4e3a\u7a7a\u683c</p> <pre><code>$ awk 'BEGIN {print \"OFS = \" OFS}' | cat -vte\nOFS =  $\n</code></pre>"},{"location":"awk/#ors","title":"ORS \u8f93\u51fa\u884c\u5206\u9694\u7b26","text":"<p>\u9ed8\u8ba4\u503c\u4e3a\u6362\u884c\u7b26</p> <pre><code>$ awk 'BEGIN {print \"ORS = \" ORS}' | cat -vte\nORS = $\n$\n</code></pre>"},{"location":"awk/#rlength","title":"RLENGTH","text":"<p>\u4ee3\u8868\u4e86 match \u51fd\u6570\u5339\u914d\u7684\u5b57\u7b26\u4e32\u957f\u5ea6\u3002</p> <pre><code>$ awk 'BEGIN { if (match(\"One Two Three\", \"re\")) { print RLENGTH } }'\n2\n</code></pre>"},{"location":"awk/#rs","title":"RS \u8f93\u5165\u8bb0\u5f55\u5206\u9694\u7b26","text":"<pre><code>$ awk 'BEGIN {print \"RS = \" RS}' | cat -vte\nRS = $\n$\n</code></pre>"},{"location":"awk/#rstart","title":"RSTART","text":"<p>match\u51fd\u6570\u5339\u914d\u7684\u7b2c\u4e00\u6b21\u51fa\u73b0\u4f4d\u7f6e</p> <pre><code>$ awk 'BEGIN { if (match(\"One Two Three\", \"Thre\")) { print RSTART } }\n9\n</code></pre>"},{"location":"awk/#subsep","title":"SUBSEP \u6570\u7ec4\u5b50\u811a\u672c\u7684\u5206\u9694\u7b26","text":"<p>\u6570\u7ec4\u5b50\u811a\u672c\u7684\u5206\u9694\u7b26\uff0c\u9ed8\u8ba4\u4e3a\\034</p> <pre><code>$ awk 'BEGIN { print \"SUBSEP = \" SUBSEP }' | cat -vte\nSUBSEP = ^\\$\n</code></pre>"},{"location":"awk/#0","title":"$ 0 \u4ee3\u8868\u4e86\u5f53\u524d\u884c","text":"<p>\u4ee3\u8868\u4e86\u5f53\u524d\u884c</p> <pre><code>$ awk '{print $0}' marks.txt\n1) Amit     Physics   80\n2) Rahul    Maths     90\n3) Shyam    Biology   87\n4) Kedar    English   85\n5) Hari     History   89\n</code></pre>"},{"location":"awk/#n","title":"$n","text":"<p>\u5f53\u524d\u884c\u4e2d\u7684\u7b2cn\u4e2a\u5b57\u6bb5</p> <pre><code>$ awk '{print $3 \"\\t\" $4}' marks.txt\nPhysics   80\nMaths     90\nBiology   87\nEnglish   85\nHistory   89\n</code></pre>"},{"location":"awk/#gnu-awk","title":"GNU AWK\u7684\u53d8\u91cf","text":""},{"location":"awk/#argind","title":"ARGIND","text":"<p>\u5f53\u524d\u88ab\u5904\u7406\u7684ARGV\u7684\u7d22\u5f15</p> <pre><code>$ awk '{ \n   print \"ARGIND   = \", ARGIND; print \"Filename = \", ARGV[ARGIND] \n}' junk1 junk2 junk3\nARGIND   =  1\nFilename =  junk1\nARGIND   =  2\nFilename =  junk2\nARGIND   =  3\nFilename =  junk3\n</code></pre>"},{"location":"awk/#binmode","title":"BINMODE","text":"<p>\u5728\u975ePOSIX\u7cfb\u7edf\u4e0a\u6307\u5b9a\u5bf9\u6240\u6709\u7684\u6587\u4ef6I/O\u91c7\u7528\u4e8c\u8fdb\u5236\u6a21\u5f0f\u3002</p>"},{"location":"awk/#errorno","title":"ERRORNO","text":"<p>\u4e00\u4e2a\u4ee3\u8868\u4e86getline\u8df3\u8f6c\u5931\u8d25\u6216\u8005\u662fclose\u8c03\u7528\u5931\u8d25\u7684\u9519\u8bef\u7684\u5b57\u7b26\u4e32\u3002</p> <pre><code>$ awk 'BEGIN { ret = getline &lt; \"junk.txt\"; if (ret == -1) print \"Error:\", ERRNO }'\nError: No such file or directory\n</code></pre>"},{"location":"awk/#fieldwidths","title":"FIELDWIDTHS","text":"<p>\u8bbe\u7f6e\u4e86\u7a7a\u683c\u5206\u9694\u7684\u5b57\u6bb5\u5bbd\u5ea6\u53d8\u91cf\u5217\u8868\u7684\u8bdd\uff0cGAWK\u4f1a\u5c06\u8f93\u5165\u89e3\u6790\u4e3a\u56fa\u5b9a\u5bbd\u5ea6\u7684\u5b57\u6bb5\uff0c\u800c\u4e0d\u662f\u4f7f\u7528FS\u8fdb\u884c\u5206\u9694\u3002</p>"},{"location":"awk/#ignorecase","title":"IGNORECASE","text":"<p>\u8bbe\u7f6e\u4e86\u8fd9\u4e2a\u53d8\u91cf\u7684\u8bdd\uff0cAWK\u4f1a\u5ffd\u7565\u5927\u5c0f\u5199\u3002</p> <pre><code>$ awk 'BEGIN{IGNORECASE = 1} /amit/' marks.txt\n1) Amit  Physics   80\n</code></pre>"},{"location":"awk/#lint","title":"LINT","text":"<p>\u63d0\u4f9b\u4e86\u5bf9--lint\u9009\u9879\u7684\u52a8\u6001\u63a7\u5236\u3002</p> <pre><code>$ awk 'BEGIN {LINT = 1; a}'\nawk: cmd. line:1: warning: reference to uninitialized variable `a'\nawk: cmd. line:1: warning: statement has no effect\n</code></pre>"},{"location":"awk/#procinfo","title":"PROCINFO","text":"<p>\u5305\u542b\u8fdb\u7a0b\u4fe1\u606f\u7684\u5173\u8054\u6570\u7ec4\uff0c\u4f8b\u5982UID\uff0c\u8fdb\u7a0bID\u7b49</p> <pre><code>$ awk 'BEGIN { print PROCINFO[\"pid\"] }'\n4316\n</code></pre>"},{"location":"awk/#textdomain","title":"TEXTDOMAIN","text":"<p>\u4ee3\u8868\u4e86AWK\u7684\u6587\u672c\u57df\uff0c\u7528\u4e8e\u67e5\u627e\u5b57\u7b26\u4e32\u7684\u672c\u5730\u5316\u7ffb\u8bd1\u3002</p> <pre><code>$ awk 'BEGIN { print TEXTDOMAIN }'\nmessages\n</code></pre>"},{"location":"awk/#_17","title":"\u64cd\u4f5c\u7b26","text":"<p>\u4e0e\u5176\u5b83\u7f16\u7a0b\u8bed\u8a00\u4e00\u6837\uff0cAWK\u4e5f\u63d0\u4f9b\u4e86\u5927\u91cf\u7684\u64cd\u4f5c\u7b26\u3002</p>"},{"location":"awk/#_18","title":"\u7b97\u6570\u64cd\u4f5c\u7b26","text":"<p>\u7b97\u6570\u64cd\u4f5c\u7b26\u4e0d\u591a\u8bf4\uff0c\u76f4\u63a5\u770b\u4f8b\u5b50\uff0c\u65e0\u975e\u5c31\u662f+-*/%</p> <pre><code>$ awk 'BEGIN { a = 50; b = 20; print \"(a + b) = \", (a + b) }'\n(a + b) =  70\n\n$ awk 'BEGIN { a = 50; b = 20; print \"(a - b) = \", (a - b) }'\n(a - b) =  30\n\n$ awk 'BEGIN { a = 50; b = 20; print \"(a * b) = \", (a * b) }'\n(a * b) =  1000\n\n$ awk 'BEGIN { a = 50; b = 20; print \"(a / b) = \", (a / b) }'\n(a / b) =  2.5\n\n$ awk 'BEGIN { a = 50; b = 20; print \"(a % b) = \", (a % b) }'\n(a % b) =  10\n</code></pre>"},{"location":"awk/#_19","title":"\u589e\u51cf\u8fd0\u7b97\u7b26","text":"<p>\u81ea\u589e\u81ea\u51cf\u4e0eC\u8bed\u8a00\u4e00\u81f4\u3002</p> <pre><code>$ awk 'BEGIN { a = 10; b = ++a; printf \"a = %d, b = %d\\n\", a, b }'\na = 11, b = 11\n\n$ awk 'BEGIN { a = 10; b = --a; printf \"a = %d, b = %d\\n\", a, b }'\na = 9, b = 9\n\n$ awk 'BEGIN { a = 10; b = a++; printf \"a = %d, b = %d\\n\", a, b }'\na = 11, b = 10\n\n$ awk 'BEGIN { a = 10; b = a--; printf \"a = %d, b = %d\\n\", a, b }'\na = 9, b = 10\n</code></pre>"},{"location":"awk/#_20","title":"\u8d4b\u503c\u64cd\u4f5c\u7b26","text":"<pre><code>$ awk 'BEGIN { name = \"Jerry\"; print \"My name is\", name }'\nMy name is Jerry\n$ awk 'BEGIN { cnt = 10; cnt += 10; print \"Counter =\", cnt }'\nCounter = 20\n$ awk 'BEGIN { cnt = 100; cnt -= 10; print \"Counter =\", cnt }'\nCounter = 90\n$ awk 'BEGIN { cnt = 10; cnt *= 10; print \"Counter =\", cnt }'\nCounter = 100\n$ awk 'BEGIN { cnt = 100; cnt /= 5; print \"Counter =\", cnt }'\nCounter = 20\n$ awk 'BEGIN { cnt = 100; cnt %= 8; print \"Counter =\", cnt }'\nCounter = 4\n$ awk 'BEGIN { cnt = 2; cnt ^= 4; print \"Counter =\", cnt }'\nCounter = 16\n$ awk 'BEGIN { cnt = 2; cnt **= 4; print \"Counter =\", cnt }'\nCounter = 16\n</code></pre>"},{"location":"awk/#_21","title":"\u5173\u7cfb\u64cd\u4f5c\u7b26","text":"<pre><code>$ awk 'BEGIN { a = 10; b = 10; if (a == b) print \"a == b\" }'\na == b\n$ awk 'BEGIN { a = 10; b = 20; if (a != b) print \"a != b\" }'\na != b\n$ awk 'BEGIN { a = 10; b = 20; if (a &lt; b) print \"a  &lt; b\" }'\na  &lt; b\n$ awk 'BEGIN { a = 10; b = 10; if (a &lt;= b) print \"a &lt;= b\" }'\na &lt;= b\n$ awk 'BEGIN { a = 10; b = 20; if (b &gt; a ) print \"b &gt; a\" }'\nb &gt; a\n</code></pre>"},{"location":"awk/#_22","title":"\u903b\u8f91\u64cd\u4f5c\u7b26","text":"<pre><code>$ awk 'BEGIN {\n   num = 5; if (num &gt;= 0 &amp;&amp; num &lt;= 7) printf \"%d is in octal format\\n\", num\n}'\n5 is in octal format\n$ awk 'BEGIN {\n   ch = \"\\n\"; if (ch == \" \" || ch == \"\\t\" || ch == \"\\n\")\n   print \"Current character is whitespace.\"\n}'\nCurrent character is whitespace.\n$ awk 'BEGIN { name = \"\"; if (! length(name)) print \"name is empty string.\" }'\nname is empty string.\n</code></pre>"},{"location":"awk/#_23","title":"\u4e09\u5143\u64cd\u4f5c\u7b26","text":"<pre><code>$ awk 'BEGIN { a = 10; b = 20; (a &gt; b) ? max = a : max = b; print \"Max =\", max}'\nMax = 20\n</code></pre>"},{"location":"awk/#_24","title":"\u4e00\u5143\u64cd\u4f5c\u7b26","text":"<pre><code>$ awk 'BEGIN { a = -10; a = +a; print \"a =\", a }'\na = -10\n$ awk 'BEGIN { a = -10; a = -a; print \"a =\", a }'\na = 10\n</code></pre>"},{"location":"awk/#_25","title":"\u6307\u6570\u64cd\u4f5c\u7b26","text":"<pre><code>$ awk 'BEGIN { a = 10; a = a ^ 2; print \"a =\", a }'\na = 100\n\n$ awk 'BEGIN { a = 10; a ^= 2; print \"a =\", a }'\na = 100\n</code></pre>"},{"location":"awk/#_26","title":"\u5b57\u7b26\u4e32\u8fde\u63a5\u64cd\u4f5c\u7b26","text":"<pre><code>$ awk 'BEGIN { str1 = \"Hello, \"; str2 = \"World\"; str3 = str1 str2; print str3 }'\nHello, World\n</code></pre>"},{"location":"awk/#_27","title":"\u6570\u7ec4\u6210\u5458\u64cd\u4f5c\u7b26","text":"<pre><code>$ awk 'BEGIN { \n   arr[0] = 1; arr[1] = 2; arr[2] = 3; for (i in arr) printf \"arr[%d] = %d\\n\", i, arr[i]\n}'\narr[2] = 3\narr[0] = 1\narr[1] = 2\n</code></pre>"},{"location":"awk/#_28","title":"\u6b63\u5219\u8868\u8fbe\u5f0f\u64cd\u4f5c\u7b26","text":"<p>\u6b63\u5219\u8868\u8fbe\u5f0f\u64cd\u4f5c\u7b26\u4f7f\u7528 ~ \u548c !~ \u5206\u522b\u4ee3\u8868\u5339\u914d\u548c\u4e0d\u5339\u914d\u3002</p> <pre><code>$ awk '$0 ~ 9' marks.txt\n2) Rahul   Maths    90\n5) Hari    History  89\n\n$ awk '$0 !~ 9' marks.txt\n1) Amit     Physics   80\n3) Shyam    Biology   87\n4) Kedar    English   85\n\n# \u5339\u914d\u6b63\u5219\u8868\u8fbe\u5f0f\u9700\u8981\u5728\u8868\u8fbe\u5f0f\u524d\u540e\u6dfb\u52a0\u53cd\u659c\u7ebf\uff0c\u4e0ejs\u7c7b\u4f3c\u5427\n$ tail -n 40 /var/log/nginx/access.log | awk '$0 ~ /ip\\[127\\.0\\.0\\.1\\]/'\n</code></pre> <p>\u66f4\u591a\u5173\u4e8e\u6b63\u5219\u8868\u8fbe\u5f0f\u8bf7\u770b\u540e\u9762\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u90e8\u5206</p>"},{"location":"awk/#_29","title":"\u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p>AWK\u5728\u5904\u7406\u6b63\u5219\u8868\u8fbe\u5f0f\u65b9\u9762\u662f\u975e\u5e38\u5f3a\u5927\u7684\uff0c\u4f7f\u7528\u7b80\u5355\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u53ef\u4ee5\u5904\u7406\u975e\u5e38\u590d\u6742\u7684\u95ee\u9898\u3002</p> <pre><code>$ echo -e \"cat\\nbat\\nfun\\nfin\\nfan\" | awk '/f.n/'\nfun\nfin\nfan\n\n$ echo -e \"This\\nThat\\nThere\\nTheir\\nthese\" | awk '/^The/'\nThere\nTheir\n\n$ echo -e \"knife\\nknow\\nfun\\nfin\\nfan\\nnine\" | awk '/n$/'\nfun\nfin\nfan\n\n$ echo -e \"Call\\nTall\\nBall\" | awk '/[CT]all/'\nCall\nTall\n\n$ echo -e \"Call\\nTall\\nBall\" | awk '/[^CT]all/'\nBall\n\n$ echo -e \"Call\\nTall\\nBall\\nSmall\\nShall\" | awk '/Call|Ball/'\nCall\nBall\n\n$ echo -e \"Colour\\nColor\" | awk '/Colou?r/'\nColour\nColor\n\n$ echo -e \"ca\\ncat\\ncatt\" | awk '/cat*/'\nca\ncat\ncatt\n\n$ echo -e \"111\\n22\\n123\\n234\\n456\\n222\"  | awk '/2+/'\n22\n123\n234\n222\n\n$ echo -e \"Apple Juice\\nApple Pie\\nApple Tart\\nApple Cake\" | awk '/Apple (Juice|Cake)/'\nApple Juice\nApple Cake\n</code></pre>"},{"location":"awk/#_30","title":"\u6570\u7ec4","text":"<p>AWK\u652f\u6301\u5173\u8054\u6570\u7ec4\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u4f7f\u7528\u6570\u5b57\u7d22\u5f15\u7684\u6570\u7ec4\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u5b57\u7b26\u4e32\u4f5c\u4e3a\u7d22\u5f15\uff0c\u800c\u4e14\u6570\u5b57\u7d22\u5f15\u4e5f\u4e0d\u8981\u6c42\u662f\u8fde\u7eed\u7684\u3002\u6570\u7ec4\u4e0d\u9700\u8981\u58f0\u660e\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff0c\u8bed\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>array_name[index] = value\n</code></pre> <p>\u521b\u5efa\u6570\u7ec4\u7684\u65b9\u5f0f\u975e\u5e38\u7b80\u5355\uff0c\u76f4\u63a5\u4e3a\u53d8\u91cf\u8d4b\u503c\u5373\u53ef</p> <pre><code>$ awk 'BEGIN {\n   fruits[\"mango\"] = \"yellow\";\n   fruits[\"orange\"] = \"orange\"\n   print fruits[\"orange\"] \"\\n\" fruits[\"mango\"]\n}'\norange\nyellow\n</code></pre> <p>\u5220\u9664\u6570\u7ec4\u5143\u7d20\u4f7f\u7528<code>delete</code>\u8bed\u53e5</p> <pre><code>$ awk 'BEGIN {\n   fruits[\"mango\"] = \"yellow\";\n   fruits[\"orange\"] = \"orange\";\n   delete fruits[\"orange\"];\n   print fruits[\"orange\"]\n}'\n</code></pre> <p>\u5728AWK\u4e2d\uff0c\u53ea\u652f\u6301\u4e00\u7ef4\u6570\u7ec4\uff0c\u4f46\u662f\u53ef\u4ee5\u901a\u8fc7\u4e00\u7ef4\u6570\u7ec4\u6a21\u62df\u591a\u7ef4\uff0c\u4f8b\u5982\u6211\u4eec\u6709\u4e00\u4e2a3x3\u7684\u4e09\u7ef4\u6570\u7ec4</p> <pre><code>100   200   300\n400   500   600\n700   800   900\n</code></pre> <p>\u53ef\u4ee5\u8fd9\u6837\u64cd\u4f5c</p> <pre><code>$ awk 'BEGIN {\n   array[\"0,0\"] = 100;\n   array[\"0,1\"] = 200;\n   array[\"0,2\"] = 300;\n   array[\"1,0\"] = 400;\n   array[\"1,1\"] = 500;\n   array[\"1,2\"] = 600;\n\n   # print array elements\n   print \"array[0,0] = \" array[\"0,0\"];\n   print \"array[0,1] = \" array[\"0,1\"];\n   print \"array[0,2] = \" array[\"0,2\"];\n   print \"array[1,0] = \" array[\"1,0\"];\n   print \"array[1,1] = \" array[\"1,1\"];\n   print \"array[1,2] = \" array[\"1,2\"];\n}'\narray[0,0] = 100\narray[0,1] = 200\narray[0,2] = 300\narray[1,0] = 400\narray[1,1] = 500\narray[1,2] = 600\n</code></pre>"},{"location":"awk/#_31","title":"\u6d41\u7a0b\u63a7\u5236","text":"<p>\u6d41\u7a0b\u63a7\u5236\u8bed\u53e5\u4e0e\u5927\u591a\u6570\u8bed\u8a00\u4e00\u6837\uff0c\u57fa\u672c\u683c\u5f0f\u5982\u4e0b</p> <pre><code>if (condition)\n   action\n\nif (condition) {\n   action-1\n   action-1\n   .\n   .\n   action-n\n}\n\nif (condition)\n   action-1\nelse if (condition2)\n   action-2\nelse\n   action-3\n</code></pre> <p>\u4f8b\u5982\uff1a</p> <pre><code>$ awk 'BEGIN {\n   num = 11; if (num % 2 == 0) printf \"%d is even number.\\n\", num; \n      else printf \"%d is odd number.\\n\", num \n}'\n\n$ awk 'BEGIN {\n   a = 30;\n\n   if (a==10)\n   print \"a = 10\";\n   else if (a == 20)\n   print \"a = 20\";\n   else if (a == 30)\n   print \"a = 30\";\n}'\n</code></pre>"},{"location":"awk/#_32","title":"\u5faa\u73af","text":"<p>\u5faa\u73af\u64cd\u4f5c\u4e0e\u5176\u4ed6C\u7cfb\u8bed\u8a00\u4e00\u6837\uff0c\u4e3b\u8981\u5305\u62ec <code>for</code>\uff0c<code>while</code>\uff0c<code>do...while</code>\uff0c<code>break</code>\uff0c<code>continue</code> \u8bed\u53e5\uff0c\u5f53\u7136\uff0c\u8fd8\u6709\u4e00\u4e2a <code>exit</code>\u8bed\u53e5\u7528\u4e8e\u9000\u51fa\u811a\u672c\u6267\u884c\u3002</p> <pre><code>for (initialisation; condition; increment/decrement)\n   action\n\nwhile (condition)\n   action\n\ndo\n   action\nwhile (condition)\n</code></pre> <p>\u4f8b\u5b50\uff1a</p> <pre><code>$ awk 'BEGIN { for (i = 1; i &lt;= 5; ++i) print i }'\n\n$ awk 'BEGIN {i = 1; while (i &lt; 6) { print i; ++i } }'\n\n$ awk 'BEGIN {i = 1; do { print i; ++i } while (i &lt; 6) }'\n\n$ awk 'BEGIN {\n   sum = 0; for (i = 0; i &lt; 20; ++i) { \n      sum += i; if (sum &gt; 50) break; else print \"Sum =\", sum \n   } \n}'\n\n$ awk 'BEGIN {\n   for (i = 1; i &lt;= 20; ++i) {\n      if (i % 2 == 0) print i ; else continue\n   } \n}'\n\n$ awk 'BEGIN {\n   sum = 0; for (i = 0; i &lt; 20; ++i) {\n      sum += i; if (sum &gt; 50) exit(10); else print \"Sum =\", sum \n   } \n}'\n</code></pre> <p><code>exit</code>\u7528\u4e8e\u9000\u51fa\u811a\u672c\uff0c\u53c2\u6570\u4e3a\u9000\u51fa\u7684\u72b6\u6001\u7801\uff0c\u53ef\u4ee5\u901a\u8fc7shell\u4e2d\u7684<code>$?</code>\u83b7\u53d6</p>"},{"location":"awk/#_33","title":"\u51fd\u6570","text":""},{"location":"awk/#_34","title":"\u5185\u5efa\u51fd\u6570","text":"<p>AWK\u63d0\u4f9b\u4e86\u5f88\u591a\u65b9\u4fbf\u7684\u5185\u5efa\u51fd\u6570\u4f9b\u7f16\u7a0b\u4eba\u5458\u4f7f\u7528\u3002\u7531\u4e8e\u51fd\u6570\u6bd4\u8f83\u591a\uff0c\u4e2a\u4eba\u89c9\u5f97\u5355\u7eaf\u770b\u6bcf\u4e2a\u51fd\u6570\u7684\u4f7f\u7528\u4e5f\u6ca1\u6709\u4ec0\u4e48\u5b9e\u9645\u610f\u4e49\uff0c\u6bd4\u8f83\u5bb9\u6613\u9057\u5fd8\uff0c\u56e0\u6b64\uff0c\u8fd9\u91cc\u53ea\u7b80\u5355\u7684\u5217\u51fa\u5e38\u7528\u7684\u4e00\u4e9b\u51fd\u6570\uff0c\u53ea\u9700\u8981\u5bf9\u5176\u6709\u4e2a\u5370\u8c61\u5373\u53ef\uff0c\u4f7f\u7528\u7684\u65f6\u5019\u518d\u53bb \u67e5\u624b\u518c \u6548\u679c\u4f1a\u66f4\u597d\u4e00\u4e9b\u5427\u3002</p>"},{"location":"awk/#_35","title":"\u6570\u5b66\u51fd\u6570","text":"<ul> <li><code>atan2(y, x)</code> </li> <li><code>cos(expr)</code> </li> <li><code>exp(expr)</code> </li> <li><code>int(expr)</code> </li> <li><code>log(expr)</code> </li> <li><code>rand</code> </li> <li><code>sin(expr)</code> </li> <li><code>sqrt(expr)</code> </li> <li><code>srand([expr])</code> </li> </ul>"},{"location":"awk/#_36","title":"\u5b57\u7b26\u4e32\u51fd\u6570","text":"<ul> <li><code>asort(arr [, d [, how] ])</code> </li> <li><code>asorti(arr [, d [, how] ])</code> </li> <li><code>gsub(regex, sub, string)</code> </li> <li><code>index(str, sub)</code> </li> <li><code>length(str)</code> </li> <li><code>match(str, regex)</code> </li> <li><code>split(str, arr, regex)</code> </li> <li><code>sprintf(format, expr-list)</code> </li> <li><code>strtonum(str)</code> </li> <li><code>sub(regex, sub, string)</code> </li> <li><code>substr(str, start, l)</code> </li> <li><code>tolower(str)</code> </li> <li><code>toupper(str)</code></li> </ul>"},{"location":"awk/#_37","title":"\u65f6\u95f4\u51fd\u6570","text":"<ul> <li><code>systime</code> </li> <li><code>mktime(datespec)</code> </li> <li><code>strftime([format [, timestamp[, utc-flag]]])</code> </li> </ul>"},{"location":"awk/#_38","title":"\u5b57\u8282\u64cd\u4f5c\u51fd\u6570","text":"<ul> <li><code>and</code> </li> <li><code>compl</code> </li> <li><code>lshift</code> </li> <li><code>rshift</code> </li> <li><code>or</code> </li> <li><code>xor</code> </li> </ul>"},{"location":"awk/#_39","title":"\u5176\u5b83","text":"<ul> <li> <p><code>close(expr)</code> \u5173\u95ed\u7ba1\u9053\u6587\u4ef6</p> <p>\u8bf7\u770b\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801</p> <pre><code>$ awk 'BEGIN {\n   cmd = \"tr [a-z] [A-Z]\"\n   print \"hello, world !!!\" |&amp; cmd\n\n   close(cmd, \"to\")\n   cmd |&amp; getline out\n   print out;\n\n   close(cmd);\n}'\nHELLO, WORLD !!!\n</code></pre> <p>\u662f\u4e0d\u662f\u611f\u89c9\u5f88\u96be\u61c2\uff1f\u8ba9\u6211\u6765\u89e3\u91ca\u4e00\u4e0b</p> <ul> <li>\u7b2c\u4e00\u4e2a\u8bed\u53e5<code>cmd = \"tr [a-z] [A-Z]\"</code>\u662f\u6211\u4eec\u5728AWK\u4e2d\u8981\u7528\u6765\u5efa\u7acb\u53cc\u5411\u8fde\u63a5\u7684\u547d\u4ee4\u3002</li> <li>\u7b2c\u4e8c\u4e2a\u8bed\u53e5<code>print</code>\u63d0\u4f9b\u4e86<code>tr</code>\u547d\u4ee4\u7684\u8f93\u5165\uff0c\u4f7f\u7528 &amp;| \u8868\u540d\u5efa\u7acb\u53cc\u5411\u8fde\u63a5\u3002</li> <li>\u7b2c\u4e09\u4e2a\u8bed\u53e5<code>close(cmd, \"to\")</code>\u7528\u4e8e\u6267\u884c\u5b8c\u6210\u540e\u5173\u95edto\u8fdb\u7a0b</li> <li>\u7b2c\u56db\u4e2a\u8bed\u53e5<code>cmd |&amp; getline out</code>\u4f7f\u7528<code>getline</code>\u51fd\u6570\u5b58\u50a8\u8f93\u51fa\u5230out\u53d8\u91cf</li> <li>\u63a5\u4e0b\u6765\u6253\u5370\u53d8\u91cfout\u7684\u5185\u5bb9\uff0c\u7136\u540e\u5173\u95edcmd</li> </ul> </li> <li> <p><code>delete</code>  \u7528\u4e8e\u5220\u9664\u6570\u7ec4\u5143\u7d20</p> </li> <li><code>exit</code>  \u9000\u51fa\u811a\u672c\u6267\u884c\uff0c\u5e76\u8fd4\u56de\u72b6\u6001\u7801\u53c2\u6570</li> <li><code>fflush</code> </li> <li> <p><code>getline</code> \u8be5\u547d\u4ee4\u8ba9awk\u8bfb\u53d6\u4e0b\u4e00\u884c\u5185\u5bb9</p> <p>\u8be5\u547d\u4ee4\u8ba9awk\u8bfb\u53d6\u4e0b\u4e00\u884c\u5185\u5bb9\uff0c\u6bd4\u5982</p> <pre><code>$ awk '{getline; print $0}' marks.txt\n2) Rahul   Maths     90\n4) Kedar   English   85\n5) Hari    History   89\n</code></pre> <p>\u4f7f\u7528<code>getline var &lt; file</code>\u53ef\u4ee5\u4ecefile\u4e2d\u8bfb\u53d6\u8f93\u5165\uff0c\u5b58\u50a8\u5230\u53d8\u91cfvar\u4e2d</p> <pre><code>{\n     if (NF == 2 &amp;&amp; $1 == \"@include\") {\n          while ((getline line &lt; $2) &gt; 0)\n               print line\n          # \u8fd9\u91cc\u7684close\u786e\u4fdd\u5982\u679c\u6587\u4ef6\u4e2d\u4e24\u4e2a@include\uff0c\u53ef\u4ee5\u8ba9\u5176\u8bfb\u53d6\u4e24\u6b21\n          close($2)\n     } else\n          print\n}\n</code></pre> <p>\u547d\u4ee4\u7684\u8f93\u51fa\u4e5f\u53ef\u4ee5\u901a\u8fc7\u7ba1\u9053\u8f93\u5165\u5230<code>getline</code>\uff0c\u4f7f\u7528<code>command | getline</code>\u8fd9\u79cd\u65b9\u5f0f\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b57\u7b26\u4e32\u547d\u4ee4\u4f1a\u4f5c\u4e3ashell\u547d\u4ee4\u6267\u884c\uff0c\u5176\u6807\u51c6\u8f93\u51fa\u4f1a\u901a\u8fc7\u7ba1\u9053\u4f20\u9012\u4e2aawk\u4f5c\u4e3a\u5176\u8f93\u5165\uff0c\u8fd9\u79cd\u5f62\u5f0f\u7684getline\u4f1a\u4ece\u7ba1\u9053\u4e2d\u4e00\u6b21\u8bfb\u53d6\u4e00\u6761\u8bb0\u5f55\u3002\u4f8b\u5982\u4e0b\u9762\u7684\u547d\u4ee4\u4f1a\u4ece\u8f93\u5165\u4e2d\u9010\u884c\u8bfb\u53d6\uff0c\u5982\u679c\u9047\u5230<code>@execute</code>\uff0c\u5219\u5c06\u8be5\u884c\u4f5c\u4e3a\u547d\u4ee4\u6267\u884c\uff0c\u5c06\u547d\u4ee4\u7684\u8f93\u51fa\u4f5c\u4e3a\u6700\u7ec8\u7684\u8f93\u51fa\u5185\u5bb9</p> <pre><code>{\n     if ($1 == \"@execute\") {\n          tmp = substr($0, 10)        # Remove \"@execute\"\n          while ((tmp | getline) &gt; 0)\n               # \u8fd9\u91cc\u5b9e\u9645\u4e0a\u8bbe\u7f6e\u4e86$0\u4e3a\u8fd9\u4e00\u884c\u7684\u5185\u5bb9\n               print\n          close(tmp)\n     } else\n          print\n}\n</code></pre> <p>\u5982\u679c\u6587\u4ef6\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9</p> <pre><code>foo\nbar\nbaz\n@execute who\nbletch\n</code></pre> <p>\u5219\u4f1a\u8f93\u51fa</p> <pre><code>foo\nbar\nbaz\narnold     ttyv0   Jul 13 14:22\nmiriam     ttyp0   Jul 13 14:23     (murphy:0)\nbill       ttyp1   Jul 13 14:23     (murphy:0)\nbletch\n</code></pre> <p>\u4f7f\u7528<code>command | getline var</code>\u53ef\u4ee5\u5b9e\u73b0\u5c06\u547d\u4ee4\u7684\u8f93\u51fa\u5199\u5165\u5230\u53d8\u91cfvar\u3002</p> <pre><code>BEGIN {\n     \"date\" | getline current_time\n     close(\"date\")\n     print \"Report printed on \" current_time\n}\n</code></pre> <p><code>getline</code>\u4f7f\u7528\u7ba1\u9053\u8bfb\u53d6\u8f93\u5165\u662f\u4e00\u79cd\u5355\u5411\u7684\u64cd\u4f5c\uff0c\u5728\u67d0\u4e9b\u573a\u666f\u4e0b\uff0c\u4f60\u53ef\u80fd\u5e0c\u671b\u53d1\u9001\u6570\u636e\u5230\u53e6\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u7136\u540e\u4ece\u8fd9\u4e2a\u8fdb\u7a0b\u4e2d\u8bfb\u53d6\u5904\u7406\u540e\u7684\u7ed3\u679c\uff0c  \u8fd9\u5c31\u7528\u5230\u4e86\u534f\u540c\u8fdb\u7a0b\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528<code>|&amp;</code>\u6253\u5f00\u4e00\u4e2a\u53cc\u5411\u7ba1\u9053\u3002</p> <pre><code>print \"some query\" |&amp; \"db_server\"\n\"db_server\" |&amp; getline\n</code></pre> <p>\u540c\u6837\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528<code>command |&amp; getline var</code>\u5c06\u534f\u540c\u8fdb\u7a0b\u7684\u8f93\u51fa\u5199\u5165\u5230\u53d8\u91cfvar\u3002</p> </li> <li> <p><code>next</code> </p> </li> <li><code>nextfile</code> </li> <li> <p><code>return</code> </p> <p>\u7528\u4e8e\u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570\u7684\u8fd4\u56de\u503c\u3002 \u9996\u5148\uff0c\u521b\u5efa\u4e00\u4e2afunctions.awk\u6587\u4ef6\uff0c\u5305\u542b\u4e0b\u9762\u7684awk\u547d\u4ee4</p> <pre><code>function addition(num1, num2) {\n   result = num1 + num2\n   return result\n}\nBEGIN {\n   res = addition(10, 20)\n   print \"10 + 20 = \" res\n}\n</code></pre> <p>\u6267\u884c\u4e0a\u8ff0\u4ee3\u7801\uff0c\u8f93\u51fa</p> <pre><code>10 + 20 = 30\n</code></pre> </li> <li> <p><code>system</code> </p> <p>\u8be5\u51fd\u6570\u7528\u4e8e\u6267\u884c\u6307\u5b9a\u7684\u547d\u4ee4\u5e76\u4e14\u8fd4\u56de\u5b83\u7684\u9000\u51fa\u72b6\u6001\uff0c\u8fd4\u56de\u72b6\u6001\u78010\u8868\u793a\u547d\u4ee4\u6210\u529f\u6267\u884c\u3002</p> <pre><code>$ awk 'BEGIN { ret = system(\"date\"); print \"Return value = \" ret }'\n2016\u5e74 10\u6708 27\u65e5 \u661f\u671f\u56db 22:08:36 CST\nReturn value = 0\n</code></pre> </li> </ul>"},{"location":"awk/#_40","title":"\u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570","text":"<p>\u51fd\u6570\u662f\u7a0b\u5e8f\u57fa\u672c\u7684\u7ec4\u6210\u90e8\u5206\uff0cAWK\u5141\u8bb8\u6211\u4eec\u81ea\u5df1\u521b\u5efa\u81ea\u5b9a\u4e49\u7684\u51fd\u6570\u3002\u4e00\u4e2a\u5927\u578b\u7684\u7a0b\u5e8f\u53ef\u4ee5\u88ab\u5212\u5206\u4e3a\u591a\u4e2a\u51fd\u6570\uff0c\u6bcf\u4e2a\u51fd\u6570\u4e4b\u95f4\u53ef\u4ee5\u72ec\u7acb\u7684\u5f00\u53d1\u548c\u6d4b\u8bd5\uff0c\u63d0\u4f9b\u53ef\u91cd\u7528\u7684\u4ee3\u7801\u3002</p> <p>\u4e0b\u9762\u662f\u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570\u7684\u57fa\u672c\u8bed\u6cd5</p> <pre><code>function function_name(argument1, argument2, ...) { \n   function body\n}\n</code></pre> <p>\u4f8b\u5982\uff0c\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u540d\u4e3afunctions.awk\u7684\u6587\u4ef6\uff0c\u5305\u542b\u4e0b\u9762\u7684\u4ee3\u7801</p> <pre><code># Returns minimum number\nfunction find_min(num1, num2){\n   if (num1 &lt; num2)\n   return num1\n   return num2\n}\n# Returns maximum number\nfunction find_max(num1, num2){\n   if (num1 &gt; num2)\n   return num1\n   return num2\n}\n# Main function\nfunction main(num1, num2){\n   # Find minimum number\n   result = find_min(10, 20)\n   print \"Minimum =\", result\n\n   # Find maximum number\n   result = find_max(10, 20)\n   print \"Maximum =\", result\n}\n# Script execution starts here\nBEGIN {\n   main(10, 20)\n}\n</code></pre> <p>\u6267\u884c\u4e0a\u8ff0\u4ee3\u7801\uff0c\u4f1a\u5f97\u5230\u4e0b\u9762\u7684\u8f93\u51fa</p> <pre><code>Minimum = 10\nMaximum = 20\n</code></pre>"},{"location":"awk/#_41","title":"\u8f93\u51fa\u91cd\u5b9a\u5411","text":""},{"location":"awk/#_42","title":"\u91cd\u5b9a\u5411\u64cd\u4f5c\u7b26","text":"<p>\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u6211\u4eec\u6240\u6709\u7684\u7a0b\u5e8f\u90fd\u662f\u76f4\u63a5\u663e\u793a\u6570\u636e\u5230\u4e86\u6807\u51c6\u8f93\u51fa\u6d41\uff0c\u5176\u5b9e\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c06\u8f93\u51fa\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\u3002\u91cd\u5b9a\u5411\u64cd\u4f5c\u7b26\u8ddf\u5728<code>print</code>\u548c<code>printf</code>\u51fd\u6570\u7684\u540e\u9762\uff0c\u4e0eshell\u4e2d\u7684\u7528\u6cd5\u57fa\u672c\u4e00\u81f4\u3002</p> <pre><code>print DATA &gt; output-file\nprint DATA &gt;&gt; output-file\n</code></pre> <p>\u4f8b\u5982\uff0c\u4e0b\u9762\u4e24\u6761\u547d\u4ee4\u8f93\u51fa\u662f\u4e00\u81f4\u7684</p> <pre><code>$ echo \"Hello, World !!!\" &gt; /tmp/message.txt\n$ awk 'BEGIN { print \"Hello, World !!!\" &gt; \"/tmp/message.txt\" }'\n</code></pre> <p>\u4e0eshell\u4e2d\u4e00\u6837\uff0c<code>&gt;</code>\u7528\u4e8e\u5c06\u8f93\u51fa\u5199\u5165\u5230\u6307\u5b9a\u7684\u6587\u4ef6\u4e2d\uff0c\u5982\u679c\u6587\u4ef6\u4e2d\u6709\u5185\u5bb9\u5219\u8986\u76d6\uff0c\u800c<code>&gt;&gt;</code>\u5219\u4e3a\u8ffd\u52a0\u6a21\u5f0f\u5199\u5165\u3002</p> <pre><code>$ awk 'BEGIN { print \"Hello, World !!!\" &gt;&gt; \"/tmp/message.txt\" }'\n$ cat /tmp/message.txt\n</code></pre>"},{"location":"awk/#_43","title":"\u7ba1\u9053","text":"<p>\u9664\u4e86\u5c06\u8f93\u51fa\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\u4e4b\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u5c06\u8f93\u51fa\u91cd\u5b9a\u5411\u5230\u5176\u5b83\u7a0b\u5e8f\uff0c\u4e0eshell\u4e2d\u4e00\u6837\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u7ba1\u9053\u64cd\u4f5c\u7b26<code>|</code>\u3002</p> <pre><code>$ awk 'BEGIN { print \"hello, world !!!\" | \"tr [a-z] [A-Z]\" }'\nHELLO, WORLD !!!\n</code></pre> <p>AWK\u4e2d\u53ef\u4ee5\u4f7f\u7528<code>|&amp;</code>\u8fdb\u884c\u53cc\u5411\u8fde\u63a5\uff0c\u90a3\u4e48\u4ec0\u4e48\u662f\u53cc\u5411\u8fde\u63a5\u5462\uff1f\u4e00\u79cd\u5e38\u89c1\u7684\u573a\u666f\u662f\u6211\u4eec\u53d1\u9001\u6570\u636e\u5230\u53e6\u4e00\u4e2a\u7a0b\u5e8f\u5904\u7406\uff0c\u7136\u540e\u8bfb\u53d6\u5904\u7406\u7ed3\u679c\uff0c\u8fd9\u79cd\u573a\u666f\u4e0b\u5c31\u9700\u8981\u6253\u5f00\u4e00\u4e2a\u5230\u53e6\u5916\u4e00\u4e2a\u8fdb\u7a0b\u7684\u53cc\u5411\u7ba1\u9053\u4e86\u3002\u7b2c\u4e8c\u4e2a\u8fdb\u7a0b\u4f1a\u4e0egawk\u7a0b\u5e8f\u5e76\u884c\u6267\u884c\uff0c\u8fd9\u91cc\u79f0\u5176\u4e3a \u534f\u4f5c\u8fdb\u7a0b\u3002\u4e0e\u5355\u5411\u8fde\u63a5\u4f7f\u7528<code>|</code>\u64cd\u4f5c\u7b26\u4e0d\u540c\u7684\u662f\uff0c\u53cc\u5411\u8fde\u63a5\u4f7f\u7528<code>|&amp;</code>\u64cd\u4f5c\u7b26\u3002</p> <pre><code>do {\n    print data |&amp; \"subprogram\"\n    \"subprogram\" |&amp; getline results\n} while (data left to process)\nclose(\"subprogram\")\n</code></pre> <p>\u7b2c\u4e00\u6b21I/O\u64cd\u4f5c\u4f7f\u7528\u4e86<code>|&amp;</code>\u64cd\u4f5c\u7b26\uff0cgawk\u4f1a\u521b\u5efa\u4e00\u4e2a\u5230\u8fd0\u884c\u5176\u5b83\u7a0b\u5e8f\u7684\u5b50\u8fdb\u7a0b\u7684\u53cc\u5411\u7ba1\u9053\uff0c<code>print</code>\u7684\u8f93\u51fa\u88ab\u5199\u5165\u5230\u4e86<code>subprogram</code>\u7684\u6807\u51c6\u8f93\u5165\uff0c\u800c\u8fd9\u4e2a<code>subprogram</code>\u7684\u6807\u51c6\u8f93\u51fa\u5728gawk\u4e2d\u4f7f\u7528<code>getline</code>\u51fd\u6570\u8fdb\u884c\u8bfb\u53d6\u3002</p> <p>\u6ce8\u610f\uff1a\u76ee\u524d\u534f\u540c\u8fdb\u7a0b\u7684\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u5c06\u4f1a\u548cgawk\u7684\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u6df7\u6742\u5728\u4e00\u8d77\uff0c\u65e0\u6cd5\u5355\u72ec\u83b7\u53d6\u6807\u51c6\u9519\u8bef\u8f93\u51fa\u3002\u53e6\u5916\uff0cI/O\u7f13\u51b2\u53ef\u80fd\u5b58\u5728\u95ee\u9898\uff0cgawk\u7a0b\u5e8f\u4f1a\u81ea\u52a8\u7684\u5237\u65b0\u6240\u6709\u8f93\u51fa\u5230\u4e0b\u6e38\u7684\u534f\u540c\u8fdb\u7a0b\u7684\u7ba1\u9053\u3002\u4f46\u662f\uff0c\u5982\u679c\u534f\u540c\u8fdb\u7a0b\u6ca1\u6709\u5237\u65b0\u5176\u6807\u51c6\u8f93\u51fa\u7684\u8bdd\uff0cgawk\u5c06\u53ef\u80fd\u4f1a\u5728\u4f7f\u7528<code>getline</code>\u51fd\u6570\u4ece\u534f\u540c\u8fdb\u7a0b\u8bfb\u53d6\u8f93\u51fa\u7684\u65f6\u5019\u6302\u8d77\uff0c\u8fd9\u5c31\u53ef\u80fd\u5f15\u8d77\u6b7b\u9501\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528<code>close</code>\u51fd\u6570\u5173\u95ed\u53cc\u5411\u7ba1\u9053\u7684to\u6216\u8005from\u4e00\u7aef\uff0c\u8fd9\u4e24\u4e2a\u5b57\u7b26\u4e32\u503c\u544a\u8bc9gawk\u53d1\u9001\u6570\u636e\u5230\u534f\u540c\u8fdb\u7a0b\u5b8c\u6210\u65f6\u6216\u8005\u4ece\u534f\u540c\u8fdb\u7a0b\u8bfb\u53d6\u5b8c\u6bd5\u65f6\u5173\u95ed\u7ba1\u9053\u3002\u5728\u4f7f\u7528\u7cfb\u7edf\u547d\u4ee4<code>sort</code>\u7684\u65f6\u5019\u662f\u8fd9\u6837\u505a\u662f\u975e\u5e38\u5fc5\u8981\u7684\uff0c\u56e0\u4e3a\u5b83\u5fc5\u987b\u7b49\u6240\u6709\u8f93\u51fa\u90fd\u8bfb\u53d6\u5b8c\u6bd5\u65f6\u624d\u80fd\u8fdb\u884c\u6392\u5e8f\u3002</p> <pre><code>BEGIN {\n    command = \"LC_ALL=C sort\"\n    n = split(\"abcdefghijklmnopqrstuvwxyz\", a, \"\")\n\n    for (i = n; i &gt; 0; i--)\n        print a[i] |&amp; command\n    close(command, \"to\")\n\n    while ((command |&amp; getline line) &gt; 0)\n        print \"got\", line\n    close(command)\n}\n</code></pre> <p>\u4f8b\u5982\uff0c\u4e0b\u9762\u7684\u4f8b\u5b50\u4e2d\u4f7f\u7528<code>tr</code>\u547d\u4ee4\u8f6c\u6362\u5c0f\u5199\u4e3a\u5927\u5199\u3002\u6211\u4eec\u7684command.awk\u6587\u4ef6\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9</p> <pre><code>BEGIN {\n   cmd = \"tr [a-z] [A-Z]\"\n   print \"hello, world !!!\" |&amp; cmd\n   close(cmd, \"to\")\n\n   cmd |&amp; getline out\n   print out;\n   close(cmd);\n}\n</code></pre> <p>\u8f93\u51fa </p> <pre><code>HELLO, WORLD !!!\n</code></pre> <p>\u4e0a\u4f8b\u770b\u8d77\u6765\u6709\u4e9b\u590d\u6742\uff0c\u6211\u4eec\u9010\u884c\u5206\u6790\u4e00\u4e0b</p> <ul> <li>\u9996\u5148\uff0c\u7b2c\u4e00\u884c cmd = \"tr [a-z] [A-Z]\" \u662f\u5728AWK\u4e2d\u8981\u5efa\u7acb\u53cc\u5411\u8fde\u63a5\u7684\u547d\u4ee4</li> <li>\u7b2c\u4e8c\u884c\u7684print\u547d\u4ee4\u7528\u4e8e\u4e3atr\u547d\u4ee4\u63d0\u4f9b\u8f93\u5165\uff0c\u800c <code>|&amp;</code> \u7528\u4e8e\u6307\u51fa\u8981\u5efa\u7acb\u53cc\u5411\u8fde\u63a5</li> <li>\u7b2c\u4e09\u884c\u7528\u4e8e\u5728\u4e0a\u9762\u7684\u8bed\u53e5close(cmd, \"to\"),\u5728\u6267\u884c\u5b8c\u6210\u540e\u5173\u95ed\u5176to\u8fdb\u7a0b</li> <li>\u7b2c\u56db\u884c cmd |&amp; getline out\u4f7f\u7528getline\u51fd\u6570\u5b58\u50a8\u8f93\u51fa\u5230\u53d8\u91cfout\u4e2d</li> <li>\u6700\u540e\u4e00\u884c\u4f7f\u7528close\u51fd\u6570\u5173\u95ed\u547d\u4ee4</li> </ul>"},{"location":"awk/#_44","title":"\u7f8e\u5316\u8f93\u51fa","text":"<p>\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u6211\u4eec\u5df2\u7ecf\u4f7f\u7528\u8fc7<code>print</code>\u548c<code>printf</code>\u51fd\u6570\u663e\u793a\u6570\u636e\u5230\u6807\u51c6\u8f93\u51fa\uff0c\u4f46\u662f<code>printf</code>\u51fd\u6570\u5b9e\u9645\u4e0a\u8981\u6bd4\u6211\u4eec\u4e4b\u524d\u4f7f\u7528\u7684\u60c5\u51b5\u66f4\u52a0\u5f3a\u5927\u5f97\u591a\u3002\u8be5\u51fd\u6570\u662f\u4eceC\u8bed\u8a00\u4e2d\u501f\u9274\u6765\u7684\uff0c\u5728\u5904\u7406\u683c\u5f0f\u5316\u7684\u8f93\u51fa\u65f6\u975e\u5e38\u6709\u7528\u3002</p> <pre><code>$ awk 'BEGIN { printf \"Hello\\nWorld\\n\" }'\nHello\nWorld\n\n$ awk 'BEGIN { printf \"ASCII value 65 = character %c\\n\", 65 }'\nASCII value 65 = character A\n</code></pre> <p>\u683c\u5f0f\u5316\u8f93\u51fa\u6807\u8bc6\u6709 <code>%c</code>\uff0c <code>%d</code>\uff0c<code>%s</code> \u7b49\uff0c\u57fa\u672c\u4e0eC\u8bed\u8a00\u4e00\u81f4\uff0c\u8fd9\u91cc\u5c31\u4e0d\u591a\u8d58\u8ff0\u4e86\u3002</p>"},{"location":"awk/#shell","title":"\u6267\u884cshell\u547d\u4ee4","text":"<p>\u5728AWK\u4e2d\u6267\u884cshell\u547d\u4ee4\u6709\u4e24\u79cd\u65b9\u5f0f</p> <ul> <li>\u4f7f\u7528<code>system</code>\u51fd\u6570</li> <li>\u4f7f\u7528\u7ba1\u9053</li> </ul>"},{"location":"awk/#system","title":"\u4f7f\u7528system\u51fd\u6570","text":"<p>system\u51fd\u6570\u7528\u4e8e\u6267\u884c\u64cd\u4f5c\u7cfb\u7edf\u547d\u4ee4\u5e76\u4e14\u8fd4\u56de\u547d\u4ee4\u7684\u9000\u51fa\u7801\u5230awk\u3002</p> <pre><code>END {\n     system(\"date | mail -s 'awk run done' root\")\n}\n</code></pre>"},{"location":"awk/#_45","title":"\u4f7f\u7528\u7ba1\u9053","text":"<p>\u5982\u679c\u8981\u6267\u884c\u7684\u547d\u4ee4\u5f88\u591a\uff0c\u53ef\u4ee5\u5c06\u8f93\u51fa\u7684\u547d\u4ee4\u76f4\u63a5\u7528\u7ba1\u9053\u4f20\u9012\u7ed9\"/bin/sh\"\u6267\u884c</p> <pre><code>while (more stuff to do)\n    print command | \"/bin/sh\"\nclose(\"/bin/sh\")\n</code></pre>"},{"location":"awk/#_46","title":"\u53c2\u8003","text":"<ul> <li>AWK Tutorial</li> <li>The GNU Awk User's Guide</li> </ul> <p>\u672c\u6587\u5c06\u4f1a\u6301\u7eed\u4fee\u6b63\u548c\u66f4\u65b0\uff0c\u6700\u65b0\u5185\u5bb9\u8bf7\u53c2\u8003\u6211\u7684 GITHUB \u4e0a\u7684 \u7a0b\u5e8f\u733f\u6210\u957f\u8ba1\u5212 \u9879\u76ee\uff0c\u6b22\u8fce Star\u3002</p>"},{"location":"buffer-pool/","title":"buffer-pool","text":"MySQL log \u8aac\u660e <pre><code>expire_logs_days={0..99}\n\u8bbe\u5b9a\u4e8c\u8fdb\u5236\u65e5\u5fd7\u7684\u8fc7\u671f\u5929\u6570\uff0c\u8d85\u51fa\u6b64\u5929\u6570\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u5c06\u88ab\u81ea\u52a8\u5220\u9664\u3002\u9ed8\u8ba4\u4e3a0\uff0c\u8868\u793a\u4e0d\u542f\u7528\u8fc7\u671f\u81ea\u52a8\u5220\u9664\u529f\u80fd\u3002\u5982\u679c\u542f\u7528\u6b64\u529f\u80fd\uff0c\u81ea\u52a8\u5220\u9664\u5de5\u4f5c\u901a\u5e38\u53d1\u751f\u5728MySQL\u542f\u52a8\u65f6\u6216FLUSH\u65e5\u5fd7\u65f6\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\uff0c\u53ef\u7528\u4e8e\u914d\u7f6e\u6587\u4ef6\uff0c\u5c5e\u52a8\u6001\u53d8\u91cf\u3002\n\ngeneral_log={ON|OFF}\n\u8bbe\u5b9a\u662f\u5426\u542f\u7528\u67e5\u8be2\u65e5\u5fd7\uff0c\u9ed8\u8ba4\u503c\u4e3a\u53d6\u51b3\u4e8e\u5728\u542f\u52a8mysqld\u65f6\u662f\u5426\u4f7f\u7528\u4e86--general_log\u9009\u9879\u3002\u5982\u82e5\u542f\u7528\u6b64\u9879\uff0c\u5176\u8f93\u51fa\u4f4d\u7f6e\u5219\u7531--log_output\u9009\u9879\u8fdb\u884c\u5b9a\u4e49\uff0c\u5982\u679clog_output\u7684\u503c\u8bbe\u5b9a\u4e3aNONE\uff0c\u5373\u4f7f\u7528\u542f\u7528\u67e5\u8be2\u65e5\u5fd7\uff0c\u5176\u4e5f\u4e0d\u4f1a\u8bb0\u5f55\u4efb\u4f55\u65e5\u5fd7\u4fe1\u606f\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\uff0c\u53ef\u7528\u4e8e\u914d\u7f6e\u6587\u4ef6\uff0c\u5c5e\u52a8\u6001\u53d8\u91cf\u3002\n\ngeneral_log_file=FILE_NAME\n\u67e5\u8be2\u65e5\u5fd7\u7684\u65e5\u5fd7\u6587\u4ef6\u540d\u79f0\uff0c\u9ed8\u8ba4\u4e3a\u201chostname.log\"\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\uff0c\u53ef\u7528\u4e8e\u914d\u7f6e\u6587\u4ef6\uff0c\u5c5e\u52a8\u6001\u53d8\u91cf\u3002\nbinlog-format={ROW|STATEMENT|MIXED}\n\u6307\u5b9a\u4e8c\u8fdb\u5236\u65e5\u5fd7\u7684\u7c7b\u578b\uff0c\u9ed8\u8ba4\u4e3aSTATEMENT\u3002\u5982\u679c\u8bbe\u5b9a\u4e86\u4e8c\u8fdb\u5236\u65e5\u5fd7\u7684\u683c\u5f0f\uff0c\u5374\u6ca1\u6709\u542f\u7528\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff0c\u5219MySQL\u542f\u52a8\u65f6\u4f1a\u4ea7\u751f\u8b66\u544a\u65e5\u5fd7\u4fe1\u606f\u5e76\u8bb0\u5f55\u4e8e\u9519\u8bef\u65e5\u5fd7\u4e2d\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u6216\u4f1a\u8bdd\uff0c\u53ef\u7528\u4e8e\u914d\u7f6e\u6587\u4ef6\uff0c\u4e14\u5c5e\u4e8e\u52a8\u6001\u53d8\u91cf\u3002\nlog={YES|NO}\n\u662f\u5426\u542f\u7528\u8bb0\u5f55\u6240\u6709\u8bed\u53e5\u7684\u65e5\u5fd7\u4fe1\u606f\u4e8e\u4e00\u822c\u67e5\u8be2\u65e5\u5fd7(general query log)\u4e2d\uff0c\u9ed8\u8ba4\u901a\u5e38\u4e3aOFF\u3002MySQL 5.6\u5df2\u7ecf\u5f03\u7528\u6b64\u9009\u9879\u3002\nlog-bin={YES|NO}\n\u662f\u5426\u542f\u7528\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff0c\u5982\u679c\u4e3amysqld\u8bbe\u5b9a\u4e86--log-bin\u9009\u9879\uff0c\u5219\u5176\u503c\u4e3aON\uff0c\u5426\u5219\u5219\u4e3aOFF\u3002\u5176\u4ec5\u7528\u4e8e\u663e\u793a\u662f\u5426\u542f\u7528\u4e86\u4e8c\u8fdb\u5236\u65e5\u5fd7\uff0c\u5e76\u4e0d\u53cd\u5e94log-bin\u7684\u8bbe\u5b9a\u503c\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u5c5e\u975e\u52a8\u6001\u53d8\u91cf\u3002\nlog_bin_trust_function_creators={TRUE|FALSE}\n\u6b64\u53c2\u6570\u4ec5\u5728\u542f\u7528\u4e8c\u8fdb\u5236\u65e5\u5fd7\u65f6\u6709\u6548\uff0c\u7528\u4e8e\u63a7\u5236\u521b\u5efa\u5b58\u50a8\u51fd\u6570\u65f6\u5982\u679c\u4f1a\u5bfc\u81f4\u4e0d\u5b89\u5168\u7684\u4e8b\u4ef6\u8bb0\u5f55\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6761\u4ef6\u4e0b\u662f\u5426\u7981\u6b62\u521b\u5efa\u5b58\u50a8\u51fd\u6570\u3002\u9ed8\u8ba4\u503c\u4e3a0\uff0c\u8868\u793a\u9664\u975e\u7528\u6237\u9664\u4e86CREATE ROUTING\u6216ALTER ROUTINE\u6743\u9650\u5916\u8fd8\u6709SUPER\u6743\u9650\uff0c\u5426\u5219\u5c06\u7981\u6b62\u521b\u5efa\u6216\u4fee\u6539\u5b58\u50a8\u51fd\u6570\uff0c\u540c\u65f6\uff0c\u8fd8\u8981\u6c42\u5728\u521b\u5efa\u51fd\u6570\u65f6\u5fc5\u9700\u4e3a\u4e4b\u4f7f\u7528DETERMINISTIC\u5c5e\u6027\uff0c\u518d\u4e0d\u7136\u5c31\u662f\u9644\u5e26READS SQL DATA\u6216NO SQL\u5c5e\u6027\u3002\u8bbe\u7f6e\u5176\u503c\u4e3a1\u65f6\u5219\u4e0d\u542f\u7528\u8fd9\u4e9b\u9650\u5236\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u914d\u7f6e\u6587\u4ef6\uff0c\u5c5e\u52a8\u6001\u53d8\u91cf\u3002\nlog_error=/PATH/TO/ERROR_LOG_FILENAME\n\u5b9a\u4e49\u9519\u8bef\u65e5\u5fd7\u6587\u4ef6\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u6216\u4f1a\u8bdd\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u914d\u7f6e\u6587\u4ef6\uff0c\u5c5e\u975e\u52a8\u6001\u53d8\u91cf\u3002\nlog_output={TABLE|FILE|NONE}\n\u5b9a\u4e49\u4e00\u822c\u67e5\u8be2\u65e5\u5fd7\u548c\u6162\u67e5\u8be2\u65e5\u5fd7\u7684\u4fdd\u5b58\u65b9\u5f0f\uff0c\u53ef\u4ee5\u662fTABLE\u3001FILE\u3001NONE\uff0c\u4e5f\u53ef\u4ee5\u662fTABLE\u53caFILE\u7684\u7ec4\u5408(\u7528\u9017\u53f7\u9694\u5f00)\uff0c\u9ed8\u8ba4\u4e3aTABLE\u3002\u5982\u679c\u7ec4\u5408\u4e2d\u51fa\u73b0\u4e86NONE\uff0c\u90a3\u4e48\u5176\u5b83\u8bbe\u5b9a\u90fd\u5c06\u5931\u6548\uff0c\u540c\u65f6\uff0c\u65e0\u8bba\u662f\u5426\u542f\u7528\u65e5\u5fd7\u529f\u80fd\uff0c\u4e5f\u4e0d\u4f1a\u8bb0\u5f55\u4efb\u4f55\u76f8\u5173\u7684\u65e5\u5fd7\u4fe1\u606f\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u914d\u7f6e\u6587\u4ef6\uff0c\u5c5e\u52a8\u6001\u53d8\u91cf\u3002\nlog_query_not_using_indexes={ON|OFF}\n\u8bbe\u5b9a\u662f\u5426\u5c06\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\u7684\u67e5\u8be2\u64cd\u4f5c\u8bb0\u5f55\u5230\u6162\u67e5\u8be2\u65e5\u5fd7\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u914d\u7f6e\u6587\u4ef6\uff0c\u5c5e\u52a8\u6001\u53d8\u91cf\u3002\nlog_slave_updates\n\u7528\u4e8e\u8bbe\u5b9a\u590d\u5236\u573a\u666f\u4e2d\u7684\u4ece\u670d\u52a1\u5668\u662f\u5426\u5c06\u4ece\u4e3b\u670d\u52a1\u5668\u6536\u5230\u7684\u66f4\u65b0\u64cd\u4f5c\u8bb0\u5f55\u8fdb\u672c\u673a\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u3002\u672c\u53c2\u6570\u8bbe\u5b9a\u7684\u751f\u6548\u9700\u8981\u5728\u4ece\u670d\u52a1\u5668\u4e0a\u542f\u7528\u4e8c\u8fdb\u5236\u65e5\u5fd7\u529f\u80fd\u3002\nlog_slow_queries={YES|NO}\n\u662f\u5426\u8bb0\u5f55\u6162\u67e5\u8be2\u65e5\u5fd7\u3002\u6162\u67e5\u8be2\u662f\u6307\u67e5\u8be2\u7684\u6267\u884c\u65f6\u95f4\u8d85\u51falong_query_time\u53c2\u6570\u6240\u8bbe\u5b9a\u65f6\u957f\u7684\u4e8b\u4ef6\u3002MySQL 5.6\u5c06\u6b64\u53c2\u6570\u4fee\u6539\u4e3a\u4e86slow_query_log\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u914d\u7f6e\u6587\u4ef6\uff0c\u5c5e\u52a8\u6001\u53d8\u91cf\u3002\nlog_warnings=#\n\u8bbe\u5b9a\u662f\u5426\u5c06\u8b66\u544a\u4fe1\u606f\u8bb0\u5f55\u8fdb\u9519\u8bef\u65e5\u5fd7\u3002\u9ed8\u8ba4\u8bbe\u5b9a\u4e3a1\uff0c\u8868\u793a\u542f\u7528\uff1b\u53ef\u4ee5\u5c06\u5176\u8bbe\u7f6e\u4e3a0\u4ee5\u7981\u7528\uff1b\u800c\u5176\u503c\u4e3a\u5927\u4e8e1\u7684\u6570\u503c\u65f6\u8868\u793a\u5c06\u65b0\u53d1\u8d77\u8fde\u63a5\u65f6\u4ea7\u751f\u7684\u201c\u5931\u8d25\u7684\u8fde\u63a5\u201d\u548c\u201c\u62d2\u7edd\u8bbf\u95ee\u201d\u7c7b\u7684\u9519\u8bef\u4fe1\u606f\u4e5f\u8bb0\u5f55\u8fdb\u9519\u8bef\u65e5\u5fd7\u3002\nlong_query_time=#\n\u8bbe\u5b9a\u533a\u522b\u6162\u67e5\u8be2\u4e0e\u4e00\u822c\u67e5\u8be2\u7684\u8bed\u53e5\u6267\u884c\u65f6\u95f4\u957f\u5ea6\u3002\u8fd9\u91cc\u7684\u8bed\u53e5\u6267\u884c\u65f6\u957f\u4e3a\u5b9e\u9645\u7684\u6267\u884c\u65f6\u95f4\uff0c\u800c\u975e\u5728CPU\u4e0a\u7684\u6267\u884c\u65f6\u957f\uff0c\u56e0\u6b64\uff0c\u8d1f\u8f7d\u8f83\u91cd\u7684\u670d\u52a1\u5668\u4e0a\u66f4\u5bb9\u6613\u4ea7\u751f\u6162\u67e5\u8be2\u3002\u5176\u6700\u5c0f\u503c\u4e3a0\uff0c\u9ed8\u8ba4\u503c\u4e3a10\uff0c\u5355\u4f4d\u662f\u79d2\u949f\u3002\u5b83\u4e5f\u652f\u6301\u6beb\u79d2\u7ea7\u7684\u89e3\u6790\u5ea6\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u6216\u4f1a\u8bdd\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u914d\u7f6e\u6587\u4ef6\uff0c\u5c5e\u52a8\u6001\u53d8\u91cf\u3002\nmax_binlog_cache_size{4096 .. 18446744073709547520}\n\u4e8c\u8fdb\u5b9a\u65e5\u5fd7\u7f13\u5b58\u7a7a\u95f4\u5927\u5c0f\uff0c5.5.9\u53ca\u4ee5\u540e\u7684\u7248\u672c\u4ec5\u5e94\u7528\u4e8e\u4e8b\u52a1\u7f13\u5b58\uff0c\u5176\u4e0a\u9650\u7531max_binlog_stmt_cache_size\u51b3\u5b9a\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u914d\u7f6e\u6587\u4ef6\uff0c\u5c5e\u52a8\u6001\u53d8\u91cf\u3002\nmax_binlog_size={4096 .. 1073741824}\n\u8bbe\u5b9a\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u4e0a\u9650\uff0c\u5355\u4f4d\u4e3a\u5b57\u8282\uff0c\u6700\u5c0f\u503c\u4e3a4K\uff0c\u6700\u5927\u503c\u4e3a1G\uff0c\u9ed8\u8ba4\u4e3a1G\u3002\u67d0\u4e8b\u52a1\u6240\u4ea7\u751f\u7684\u65e5\u5fd7\u4fe1\u606f\u53ea\u80fd\u5199\u5165\u4e00\u4e2a\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\uff0c\u56e0\u6b64\uff0c\u5b9e\u9645\u4e0a\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u53ef\u80fd\u5927\u4e8e\u8fd9\u4e2a\u6307\u5b9a\u7684\u4e0a\u9650\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u914d\u7f6e\u6587\u4ef6\uff0c\u5c5e\u52a8\u6001\u53d8\u91cf\u3002\nmax_relay_log_size={4096..1073741824}\n\u8bbe\u5b9a\u4ece\u670d\u52a1\u5668\u4e0a\u4e2d\u7ee7\u65e5\u5fd7\u7684\u4f53\u79ef\u4e0a\u9650\uff0c\u5230\u8fbe\u6b64\u9650\u5ea6\u65f6\u5176\u4f1a\u81ea\u52a8\u8fdb\u884c\u4e2d\u7ee7\u65e5\u5fd7\u6eda\u52a8\u3002\u6b64\u53c2\u6570\u503c\u4e3a0\u65f6\uff0cmysqld\u5c06\u4f7f\u7528max_binlog_size\u53c2\u6570\u540c\u65f6\u4e3a\u4e8c\u8fdb\u5236\u65e5\u5fd7\u548c\u4e2d\u7ee7\u65e5\u5fd7\u8bbe\u5b9a\u65e5\u5fd7\u6587\u4ef6\u4f53\u79ef\u4e0a\u9650\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u914d\u7f6e\u6587\u4ef6\uff0c\u5c5e\u52a8\u6001\u53d8\u91cf\u3002\ninnodb_log_buffer_size={262144 .. 4294967295}\n\u8bbe\u5b9aInnoDB\u7528\u4e8e\u8f85\u52a9\u5b8c\u6210\u65e5\u5fd7\u6587\u4ef6\u5199\u64cd\u4f5c\u7684\u65e5\u5fd7\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u5355\u4f4d\u662f\u5b57\u8282\uff0c\u9ed8\u8ba4\u4e3a8MB\u3002\u8f83\u5927\u7684\u4e8b\u52a1\u53ef\u4ee5\u501f\u52a9\u4e8e\u66f4\u5927\u7684\u65e5\u5fd7\u7f13\u51b2\u533a\u6765\u907f\u514d\u5728\u4e8b\u52a1\u5b8c\u6210\u4e4b\u524d\u5c06\u65e5\u5fd7\u7f13\u51b2\u533a\u7684\u6570\u636e\u5199\u5165\u65e5\u5fd7\u6587\u4ef6\uff0c\u4ee5\u51cf\u5c11I/O\u64cd\u4f5c\u8fdb\u800c\u63d0\u5347\u7cfb\u7edf\u6027\u80fd\u3002\u56e0\u6b64\uff0c\u5728\u6709\u7740\u8f83\u5927\u4e8b\u52a1\u7684\u5e94\u7528\u573a\u666f\u4e2d\uff0c\u5efa\u8bae\u4e3a\u6b64\u53d8\u91cf\u8bbe\u5b9a\u4e00\u4e2a\u66f4\u5927\u7684\u503c\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u9009\u9879\u6587\u4ef6\uff0c\u5c5e\u975e\u52a8\u6001\u53d8\u91cf\u3002\ninnodb_log_file_size={108576 .. 4294967295}\n\u8bbe\u5b9a\u65e5\u5fd7\u7ec4\u4e2d\u6bcf\u4e2a\u65e5\u5fd7\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u5355\u4f4d\u662f\u5b57\u8282\uff0c\u9ed8\u8ba4\u503c\u662f5MB\u3002\u8f83\u4e3a\u660e\u667a\u7684\u53d6\u503c\u8303\u56f4\u662f\u4ece1MB\u5230\u7f13\u5b58\u6c60\u4f53\u79ef\u76841/n\uff0c\u5176\u4e2dn\u8868\u793a\u65e5\u5fd7\u7ec4\u4e2d\u65e5\u5fd7\u6587\u4ef6\u7684\u4e2a\u6570\u3002\u65e5\u5fd7\u6587\u4ef6\u8d8a\u5927\uff0c\u5728\u7f13\u5b58\u6c60\u4e2d\u9700\u8981\u6267\u884c\u7684\u68c0\u67e5\u70b9\u5237\u5199\u64cd\u4f5c\u5c31\u8d8a\u5c11\uff0c\u8fd9\u610f\u5473\u7740\u6240\u9700\u7684I/O\u64cd\u4f5c\u4e5f\u5c31\u8d8a\u5c11\uff0c\u7136\u800c\u8fd9\u4e5f\u4f1a\u5bfc\u81f4\u8f83\u6162\u7684\u6545\u969c\u6062\u590d\u901f\u5ea6\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u9009\u9879\u6587\u4ef6\uff0c\u5c5e\u975e\u52a8\u6001\u53d8\u91cf\u3002\ninnodb_log_files_in_group={2 .. 100}\n\u8bbe\u5b9a\u65e5\u5fd7\u7ec4\u4e2d\u65e5\u5fd7\u6587\u4ef6\u7684\u4e2a\u6570\u3002InnoDB\u4ee5\u5faa\u73af\u7684\u65b9\u5f0f\u4f7f\u7528\u8fd9\u4e9b\u65e5\u5fd7\u6587\u4ef6\u3002\u9ed8\u8ba4\u503c\u4e3a2\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u9009\u9879\u6587\u4ef6\uff0c\u5c5e\u975e\u52a8\u6001\u53d8\u91cf\u3002\ninnodb_log_group_home_dir=/PATH/TO/DIR\n\u8bbe\u5b9aInnoDB\u91cd\u505a\u65e5\u5fd7\u6587\u4ef6\u7684\u5b58\u50a8\u76ee\u5f55\u3002\u5728\u7f3a\u7701\u4f7f\u7528InnoDB\u65e5\u5fd7\u76f8\u5173\u7684\u6240\u6709\u53d8\u91cf\u65f6\uff0c\u5176\u9ed8\u8ba4\u4f1a\u5728\u6570\u636e\u76ee\u5f55\u4e2d\u521b\u5efa\u4e24\u4e2a\u5927\u5c0f\u4e3a5MB\u7684\u540d\u4e3aib_logfile0\u548cib_logfile1\u7684\u65e5\u5fd7\u6587\u4ef6\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u9009\u9879\u6587\u4ef6\uff0c\u5c5e\u975e\u52a8\u6001\u53d8\u91cf\u3002\nrelay_log=file_name\n\u8bbe\u5b9a\u4e2d\u7ee7\u65e5\u5fd7\u7684\u6587\u4ef6\u540d\u79f0\uff0c\u9ed8\u8ba4\u4e3ahost_name-relay-bin\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\uff0c\u4ee5\u6307\u5b9a\u975e\u6570\u636e\u76ee\u5f55\u6765\u5b58\u50a8\u4e2d\u7ee7\u65e5\u5fd7\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u9009\u9879\u6587\u4ef6\uff0c\u5c5e\u975e\u52a8\u6001\u53d8\u91cf\u3002\nrelay_log_index=file_name\n\u8bbe\u5b9a\u4e2d\u7ee7\u65e5\u5fd7\u7684\u7d22\u5f15\u6587\u4ef6\u540d\uff0c\u9ed8\u8ba4\u4e3a\u4e3a\u6570\u636e\u76ee\u5f55\u4e2d\u7684host_name-relay-bin.index\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u9009\u9879\u6587\u4ef6\uff0c\u5c5e\u975e\u52a8\u6001\u53d8\u91cf\u3002\nrelay-log-info-file=file_name\n\u8bbe\u5b9a\u4e2d\u7ee7\u670d\u52a1\u7528\u4e8e\u8bb0\u5f55\u4e2d\u7ee7\u4fe1\u606f\u7684\u6587\u4ef6\uff0c\u9ed8\u8ba4\u4e3a\u6570\u636e\u76ee\u5f55\u4e2d\u7684relay-log.info\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u9009\u9879\u6587\u4ef6\uff0c\u5c5e\u975e\u52a8\u6001\u53d8\u91cf\u3002\nrelay_log_purge={ON|OFF}\n\u8bbe\u5b9a\u5bf9\u4e0d\u518d\u9700\u8981\u7684\u4e2d\u7ee7\u65e5\u5fd7\u662f\u5426\u81ea\u52a8\u8fdb\u884c\u6e05\u7406\u3002\u9ed8\u8ba4\u503c\u4e3aON\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u9009\u9879\u6587\u4ef6\uff0c\u5c5e\u52a8\u6001\u53d8\u91cf\u3002\nrelay_log_space_limit=#\n\u8bbe\u5b9a\u7528\u4e8e\u5b58\u50a8\u6240\u6709\u4e2d\u7ee7\u65e5\u5fd7\u6587\u4ef6\u7684\u53ef\u7528\u7a7a\u95f4\u5927\u5c0f\u3002\u9ed8\u8ba4\u4e3a0\uff0c\u8868\u793a\u4e0d\u9650\u5b9a\u3002\u6700\u5927\u503c\u53d6\u51b3\u4e8e\u7cfb\u7edf\u5e73\u53f0\u4f4d\u6570\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u9009\u9879\u6587\u4ef6\uff0c\u5c5e\u975e\u52a8\u6001\u53d8\u91cf\u3002\nslow_query_log={ON|OFF}\n\u8bbe\u5b9a\u662f\u5426\u542f\u7528\u6162\u67e5\u8be2\u65e5\u5fd7\u30020\u6216OFF\u8868\u793a\u7981\u7528\uff0c1\u6216ON\u8868\u793a\u542f\u7528\u3002\u65e5\u5fd7\u4fe1\u606f\u7684\u8f93\u51fa\u4f4d\u7f6e\u53d6\u51b3\u4e8elog_output\u53d8\u91cf\u7684\u5b9a\u4e49\uff0c\u5982\u679c\u5176\u503c\u4e3aNONE\uff0c\u5219\u5373\u4fbfslow_query_log\u4e3aON\uff0c\u4e5f\u4e0d\u4f1a\u8bb0\u5f55\u4efb\u4f55\u6162\u67e5\u8be2\u4fe1\u606f\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u9009\u9879\u6587\u4ef6\uff0c\u5c5e\u52a8\u6001\u53d8\u91cf\u3002\nslow_query_log_file=/PATH/TO/SOMEFILE\n\u8bbe\u5b9a\u6162\u67e5\u8be2\u65e5\u5fd7\u6587\u4ef6\u7684\u540d\u79f0\u3002\u9ed8\u8ba4\u4e3ahostname-slow.log\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7--slow_query_log_file\u9009\u9879\u4fee\u6539\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u7ea7\u522b\uff0c\u53ef\u7528\u4e8e\u9009\u9879\u6587\u4ef6\uff0c\u5c5e\u52a8\u6001\u53d8\u91cf\u3002\nsql_log_bin={ON|OFF}\n\u7528\u4e8e\u63a7\u5236\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4fe1\u606f\u662f\u5426\u8bb0\u5f55\u8fdb\u65e5\u5fd7\u6587\u4ef6\u3002\u9ed8\u8ba4\u4e3aON\uff0c\u8868\u793a\u542f\u7528\u8bb0\u5f55\u529f\u80fd\u3002\u7528\u6237\u53ef\u4ee5\u5728\u4f1a\u8bdd\u7ea7\u522b\u4fee\u6539\u6b64\u53d8\u91cf\u7684\u503c\uff0c\u4f46\u5176\u5fc5\u987b\u5177\u6709SUPER\u6743\u9650\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u548c\u4f1a\u8bdd\u7ea7\u522b\uff0c\u5c5e\u52a8\u6001\u53d8\u91cf\u3002\nsql_log_off={ON|OFF}\n\u7528\u4e8e\u63a7\u5236\u662f\u5426\u7981\u6b62\u5c06\u4e00\u822c\u67e5\u8be2\u65e5\u5fd7\u7c7b\u4fe1\u606f\u8bb0\u5f55\u8fdb\u67e5\u8be2\u65e5\u5fd7\u6587\u4ef6\u3002\u9ed8\u8ba4\u4e3aOFF\uff0c\u8868\u793a\u4e0d\u7981\u6b62\u8bb0\u5f55\u529f\u80fd\u3002\u7528\u6237\u53ef\u4ee5\u5728\u4f1a\u8bdd\u7ea7\u522b\u4fee\u6539\u6b64\u53d8\u91cf\u7684\u503c\uff0c\u4f46\u5176\u5fc5\u987b\u5177\u6709SUPER\u6743\u9650\u3002\u4f5c\u7528\u8303\u56f4\u4e3a\u5168\u5c40\u548c\u4f1a\u8bdd\u7ea7\u522b\uff0c\u5c5e\u52a8\u6001\u53d8\u91cf\u3002\nsync_binlog=#\n\u8bbe\u5b9a\u591a\u4e45\u540c\u6b65\u4e00\u6b21\u4e8c\u8fdb\u5236\u65e5\u5fd7\u81f3\u78c1\u76d8\u6587\u4ef6\u4e2d\uff0c0\u8868\u793a\u4e0d\u540c\u6b65\uff0c\u4efb\u4f55\u6b63\u6570\u503c\u90fd\u8868\u793a\u5bf9\u4e8c\u8fdb\u5236\u6bcf\u591a\u5c11\u6b21\u5199\u64cd\u4f5c\u4e4b\u540e\u540c\u6b65\u4e00\u6b21\u3002\u5f53autocommit\u7684\u503c\u4e3a1\u65f6\uff0c\u6bcf\u6761\u8bed\u53e5\u7684\u6267\u884c\u90fd\u4f1a\u5f15\u8d77\u4e8c\u8fdb\u5236\u65e5\u5fd7\u540c\u6b65\uff0c\u5426\u5219\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u7684\u63d0\u4ea4\u4f1a\u5f15\u8d77\u4e8c\u8fdb\u5236\u65e5\u5fd7\u540c\u6b65\u3002\n</code></pre>"},{"location":"buffer-pool/#innodb-pluginbuffer-pool","title":"InnoDB Plugin\u7279\u6027\u4ecb\u7ecd\uff1a\u8ba9Buffer Pool\u4e0d\u88ab\u6c61\u67d3","text":"<ul> <li>https://www.orczhou.com/index.php/2010/05/innodb-plugin-make-buffer-cache-scan-resistant/</li> <li>https://www.orczhou.com/index.php/2010/05/innodb-plugin-make-buffer-cache-scan-resistant/comment-page-1/</li> <li>https://dev.mysql.com/doc/refman/8.0/ja/innodb-buffer-pool.html</li> </ul> <p>\u8f83\u4e4bMyISAM\u7684\u4e00\u4e2a\u5f88\u5927\u7684\u4f18\u52bf\u662f\uff0cInnoDB\u4f1a\u7f13\u5b58\u6570\u636e\u5757\u3002\u5982\u679c\u7cfb\u7edf\u4e2d\u7684\u6570\u636e\u91cf\u5e76\u4e0d\u5927\uff0c\u6216\u8005\u6216\u8005\u6d3b\u8dc3\u6570\u636e\u91cf\u5e76\u4e0d\u5927\u65f6\uff0cInnoDB\u4f1a\u5c06\u8fd9\u4e9b\u6570\u636e\u5757\u5168\u90e8\u7f13\u5b58\u5230Buffer Pool\uff08\u5185\u5b58\uff09\u4e2d\uff0c\u8fd9\u6837\u53ef\u4ee5\u6700\u5927\u9650\u5ea6\u7684\u63d0\u9ad8\u63d0\u4f9b\u7684\u54cd\u5e94\u901f\u5ea6\uff0c\u7279\u522b\u662f\u8bfb\u53d6\u3002\u5f53\u7528\u6237\u8bf7\u6c42\u9700\u8981\u67e5\u8be2\u6570\u636e\u5757\u65f6\uff0cInnoDB\u4f1a\u9996\u5148\u5728Buffer Pool\u4e2d\u67e5\u627e\u6570\u636e\uff0c\u5982\u679cBuffer Pool\u4e2d\u6ca1\u6709\u8be5\u6570\u636e\u5757\u65f6\uff0cInnoDB\u4f1a\u4ece\u78c1\u76d8\u4e0aLoad\u5bf9\u5e94\u7684\u6570\u636e\u5757\uff0c\u5e76\u901a\u8fc7LRU\u7b97\u6cd5\u66ff\u4ee3\u5f53\u524dBuffer Pool\u7684\u7f13\u5b58\u5757\u3002</p> <ol> <li>Buffer Pool\u4e2dLRU\u7f3a\u70b9\u3001\u7ec6\u8282</li> </ol> <p>\u8fd9\u6837LRU\u7b97\u6cd5\u7684\u4e00\u4e2a\u7f3a\u70b9\u662f\uff0c\u5982\u679c\u6709\u67d0\u4e00\u4e2a\u67e5\u8be2\u505a\u4e86\u4e00\u6b21\u5168\u8868\u626b\u63cf\uff08\u4f8b\u5982\u5907\u4efd\uff0c\u4e34\u65f6DDL\u7b49\uff09\uff0c\u90fd\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6574\u4e2aBuffer Pool\u4e2dLRU\u94fe\u8868\u4e2d\u7684\u6570\u636e\u5757\u90fd\u88ab\u66ff\u6362\u4e86\uff0c\u751a\u81f3\u5f88\u591a\u70ed\u70b9\u6570\u636e\u4e5f\u4f1a\u88ab\u66ff\u6362\uff0c\u800c\u8fd9\u4e9b\u65b0\u8fdb\u7684\u6570\u636e\u5757\u53ef\u80fd\u5728\u8fd9\u4e00\u6b21\u67e5\u8be2\u4e4b\u540e\u5c31\u518d\u4e5f\u4e0d\u4f1a\u88ab\u8bfb\u5230\u4e86\u3002\u6211\u4eec\u4e5f\u79f0\u8fd9\u79cd\u60c5\u51b5\u4e3a\u201cBuffer Pool\u88ab\u6c61\u67d3\u201d\u4e86\u3002</p> <p>\u5728InnoDB\u5219\u5f15\u5165\u4e86\u4e00\u4e9b\u65b0\u7684\u673a\u5236\u6765\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u3002\u7b97\u6cd5\u4ecd\u7136\u662fLRU\u7b97\u6cd5\uff0c\u4f46\u662f\u52a0\u4e0a\u4e86\u4e2d\u70b9\u7b56\u7565\uff08\u7c7b\u4f3c\u4e8eMyISAM\u7684key buffer\u4e2d\u7684midpoint strategy \uff09\u3002\u540c\u65f6\u5f15\u5165\u4e86\u53c2\u6570innodb_old_blocks_time\u6765\u63a7\u5236Buffer Pool\u4e0d\u88ab\u6c61\u67d3\u3002</p> <p>LRU\u94fe\u8868\u4e2d\u7684\u6570\u636e\u5206\u4e3a\u4e24\u90e8\u5206\uff1aSublist of new\u548cSublist of old\u3002\u540e\u8005\u5305\u542b\u8bbf\u95ee\u6700\u8fd1\u6ca1\u6709\u8bbf\u95ee\u7684\u6570\u636e\u5757\uff08\u94fe\u8868\u8d8a\u540e\u9762\u7684\u6570\u636e\u5757\uff0c\u6700\u8fd1\u8d8a\u6ca1\u6709\u88ab\u8bbf\u95ee\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\uff0c\u524d\u8005\u536063%\uff085/8\uff09\uff0c\u540e\u800537%\uff083/8\uff09\u3002</p> <p></p> <p>\u5f53\u6570\u636e\u5757\u9700\u8981\u4ece\u6570\u636e\u6587\u4ef6\u4e2d\u8bfb\u53d6\u65f6\uff0c\u9996\u5148\u4f1a\u653e\u5230old sublist\u7684\u5934\u90e8\uff08midpoint\uff09\u3002\u7136\u540e\uff0c\u5982\u679c\u6709\u5bf9\u8fd9\u4e2a\u6570\u636e\u5757\u7684\u8bbf\u95ee\uff0c\u90a3\u4e48\u5c31\u5c06\u8fd9\u4e2a\u6570\u636e\u5757\u653e\u5230new sublist\u7684\u9996\u90e8\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u4e00\u4e2a\u6570\u636e\u5757\u88ab\u53d6\u51fa\u540e\uff0c\u7acb\u523b\u4f1a\u6709\u8bfb\u53d6\uff0c\u4e5f\u5c31\u5f88\u5feb\u4f1a\u88ab\u653e\u5230new sublist\u7684\u5934\u90e8\u3002\u4e00\u79cd\u7cdf\u7cd5\u7684\u60c5\u51b5\u662f\uff0c\u5982\u679c\u662fmysqldump\u8bbf\u95ee\u5168\u90e8\u6570\u636e\u5757\uff0c\u4e5f\u5c31\u4f1a\u5bfc\u81f4\u6240\u6709\u7684\u6570\u636e\u5757\u88ab\u653e\u5230new sublist\u3002\u8fd9\u6837Buffer Pool\u4e5f\u5c31\u5168\u90e8\u88ab\u6c61\u67d3\u4e86\u3002</p> <ol> <li>Buffer Pool\u4e2dLRU\u961f\u5217\u5982\u4f55\u9632\u6b62\u6c61\u67d3</li> </ol> <p>InnoDB Plugin\u901a\u8fc7\u5f15\u5165\u5982\u4e0b\u7684\u53c2\u6570\u6765\u9632\u6b62\u201c\u6c61\u67d3\u201d\uff1a</p> <p>innodb_old_blocks_pct\uff1a \u63a7\u5236old sublist\u5728LRU\u961f\u5217\u7684\u957f\u5ea6</p> <p>innodb_old_blocks_time\uff1a\u8be5\u53c2\u6570\u51b3\u5b9a\u4e86\uff0c\u5f53Block\u88ab\u63d2\u5165\u5230midpoint\uff08old sublist\uff09\u540e\uff0c\u5fc5\u987b\u8981\u5728old sublist\u505c\u7559\u8d85\u8fc7innodb_old_blocks_time\uff08ms\uff09\u65f6\u95f4\u540e\uff0c\u624d\u6709\u53ef\u80fd\u88ab\u8f6c\u79fb\u5230new sublist\u3002\u4f8b\u5982\uff0c\u5c06innodb_old_blocks_time\u8bbe\u7f6e\u4e3a1000\uff08\u53731s\uff09\uff0c\u5f53\u51fa\u73b0Table scan\u51fa\u73b0\u65f6\uff0cInnoDB\u5148\u5c06\u6570\u636e\u5757\u8f7d\u5165\u5230midpoint\uff08old sublist\uff09\u4e0a\uff0c\u7a0b\u5e8f\u8bfb\u53d6\u6570\u636e\u5757\uff0c\u56e0\u4e3a\u8fd9\u65f6\uff0c\u6570\u636e\u5757\u5728old sublist\u4e2d\u7684\u505c\u7559\u65f6\u95f4\u8fd8\u4e0d\u5230innodb_old_blocks_time\uff0c\u6240\u4ee5\u4e0d\u4f1a\u88ab\u8f6c\u79fb\u5230new sublist\u4e2d\u3002\u8fd9\u5c31\u907f\u514d\u4e86Buffer Pool\u88ab\u6c61\u67d3\u7684\u60c5\u51b5\u3002\u66f4\u9177\u7684\u662f\uff0c\u8fd9\u4e2a\u53c2\u6570\u662f\u52a8\u6001\u8c03\u6574\u7684\uff0c\u6240\u4ee5\u5728\u505a\u610f\u5916\u7684Table scan\u65f6\uff0c\u52a8\u6001\u8c03\u6574\u4e00\u4e0b\u8be5\u53c2\u6570\u5c31\u53ef\u4ee5\u4e86\u3002</p> <ol> <li>\u9632\u6c61\u67d3\u7684\u6548\u7387\u89c2\u5bdf</li> </ol> <p>\u53ef\u4ee5\u6839\u636eSHOW INNODB STATUS\\G\u4e2dBuffer Pool\u6bb5\u5f00\u770b\u770b\u76f8\u5173\u6548\u7387\uff1a</p> <pre><code>Total memory allocated 1107296256; in additional pool allocated 0\nDictionary memory allocated 80360\nBuffer pool size 65535\nFree buffers 0\nDatabase pages 63920\nOld database pages 23600\nModified db pages 34969\nPending reads 32\nPending writes: LRU 0, flush list 0, single page 0\nPages made young 414946, not young 2930673\n1274.75 youngs/s, 16521.90 non-youngs/s\nPages read 486005, created 3178, written 160585\n2132.37 reads/s, 3.40 creates/s, 323.74 writes/s\nBuffer pool hit rate 950 / 1000, young-making rate 30 / 1000 not 392 / 1000\nPages read ahead 1510.10/s, evicted without access 0.00/s\nLRU len: 63920, unzip_LRU len: 0\nI/O sum[43690]:cur[221], unzip sum[0]:cur[0]\n</code></pre> <ul> <li>\u89e3\u91ca\uff1aOld database pages \u8868\u793aLRU\u5217\u8868\u4e2dold sublist\u4e2d\u7684\u6570\u636e\u5757\u6570\u91cf\u3002</li> <li>Pages made young and not young\u8868\u793aold sublist\u4e2d\u6709\u591a\u5c11\u6570\u636e\u5757\u662f\uff08\u6ca1\uff09\u88ab\u8f6c\u79fb\u5230new sublist\u3002</li> </ul> <p>youngs/s and non-young/s \u4ece\u4e0a\u6b21\u6267\u884cSHOW INNODB STATUS\u5230\u73b0\u5728\u4e3a\u6b62\uff0c\u8bbf\u95eeOld sublist\u65f6\u6709\u591a\u5c11\u5c06\u6570\u636e\u5757\u8f6c\u79fb\u5230new sublist\uff0c\u6709\u591a\u5c11\u662f\u6ca1\u6709\u8f6c\u79fb\u7684\uff08\u8fd9\u91cc\u53ef\u4ee5\u770b\u51fa\u53c2\u6570innodb_old_blocks_time\u7684\u6548\u7387\uff09\u3002</p> <p>young-making rate and not \u53cd\u6620\u7684\u662f\u5168\u90e8Buffer Pool\u8bbf\u95ee\u4e2d\uff0c\u5c06\uff08\u6ca1\u6709\u5c06\uff09old sublist\u4e2d\u8f6c\u79fbnew sublist\u7684\u6bd4\u7387\u3002</p>"},{"location":"buffer-pool/#_1","title":"\u53c2\u8003\uff1a","text":"<ul> <li>Making Buffer Cache Scan Resistant</li> </ul>"},{"location":"buffer-pool/#mysql","title":"mysql\u914d\u7f6e\u8be6\u89e3\uff08\u4e0d\u65ad\u66f4\u65b0\uff09","text":"<ul> <li>https://www.cnblogs.com/loveus/articles/1505410.html</li> </ul> mysql\u914d\u7f6e\u8be6 <pre><code>1. back_log\n\n\u6307\u5b9aMySQL\u53ef\u80fd\u7684\u8fde\u63a5\u6570\u91cf\u3002\u5f53MySQL\u4e3b\u7ebf\u7a0b\u5728\u5f88\u77ed\u7684\u65f6\u95f4\u5185\u5f97\u5230\u975e\u5e38\u591a\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u8be5\u53c2\u6570\u5c31\u8d77\u4f5c\u7528\uff0c\u4e4b\u540e\u4e3b\u7ebf\u7a0b\u82b1\u4e9b\u65f6\u95f4\uff08\u5c3d\u7ba1\u5f88\u77ed\uff09\u68c0\u67e5\u8fde\u63a5\u5e76\u4e14\u542f\u52a8\u4e00\u4e2a\u65b0\u7ebf\u7a0b\u3002\n\nback_log\u53c2\u6570\u7684\u503c\u6307\u51fa\u5728MySQL\u6682\u65f6\u505c\u6b62\u54cd\u5e94\u65b0\u8bf7\u6c42\u4e4b\u524d\u7684\u77ed\u65f6\u95f4\u5185\u591a\u5c11\u4e2a\u8bf7\u6c42\u53ef\u4ee5\u88ab\u5b58\u5728\u5806\u6808\u4e2d\u3002\u5982\u679c\u7cfb\u7edf\u5728\u4e00\u4e2a\u77ed\u65f6\u95f4\u5185\u6709\u5f88\u591a\u8fde\u63a5\uff0c\u5219\u9700\u8981\u589e\u5927\u8be5\u53c2\u6570\u7684\u503c\uff0c\u8be5\u53c2\u6570\u503c\u6307\u5b9a\u5230\u6765\u7684TCP/IP\u8fde\u63a5\u7684\u4fa6\u542c\u961f\u5217\u7684\u5927\u5c0f\u3002\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\u5728\u8fd9\u4e2a\u961f\u5217\u5927\u5c0f\u4e0a\u6709\u5b83\u81ea\u5df1\u7684\u9650\u5236\u3002 \u8bd5\u56fe\u8bbe\u5b9aback_log\u9ad8\u4e8e\u4f60\u7684\u64cd\u4f5c\u7cfb\u7edf\u7684\u9650\u5236\u5c06\u662f\u65e0\u6548\u7684\u3002\n\n\u5f53\u89c2\u5bdfMySQL\u8fdb\u7a0b\u5217\u8868\uff0c\u53d1\u73b0\u5927\u91cf 264084 | unauthenticated user | xxx.xxx.xxx.xxx | NULL | Connect | NULL | login | NULL \u7684\u5f85\u8fde\u63a5\u8fdb\u7a0b\u65f6\uff0c\u5c31\u8981\u52a0\u5927 back_log \u7684\u503c\u3002back_log\u9ed8\u8ba4\u503c\u4e3a50\u3002\n\n2. basedir\n\nMySQL\u4e3b\u7a0b\u5e8f\u6240\u5728\u8def\u5f84\uff0c\u5373\uff1a--basedir\u53c2\u6570\u7684\u503c\u3002\n\n3. bdb_cache_size\n\n\u5206\u914d\u7ed9BDB\u7c7b\u578b\u6570\u636e\u8868\u7684\u7f13\u5b58\u7d22\u5f15\u548c\u884c\u6392\u5217\u7684\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u5982\u679c\u4e0d\u4f7f\u7528DBD\u7c7b\u578b\u6570\u636e\u8868\uff0c\u5219\u5e94\u8be5\u5728\u542f\u52a8MySQL\u65f6\u52a0\u8f7d --skip-bdb \u53c2\u6570\u4ee5\u907f\u514d\u5185\u5b58\u6d6a\u8d39\u3002\n\n4.bdb_log_buffer_size\n\n\u5206\u914d\u7ed9BDB\u7c7b\u578b\u6570\u636e\u8868\u7684\u7f13\u5b58\u7d22\u5f15\u548c\u884c\u6392\u5217\u7684\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u5982\u679c\u4e0d\u4f7f\u7528DBD\u7c7b\u578b\u6570\u636e\u8868\uff0c\u5219\u5e94\u8be5\u5c06\u8be5\u53c2\u6570\u503c\u8bbe\u7f6e\u4e3a0\uff0c\u6216\u8005\u5728\u542f\u52a8MySQL\u65f6\u52a0\u8f7d --skip-bdb \u53c2\u6570\u4ee5\u907f\u514d\u5185\u5b58\u6d6a\u8d39\u3002\n\n5.bdb_home\n\n\u53c2\u89c1 --bdb-home \u9009\u9879\u3002\n\n6. bdb_max_lock\n\n\u6307\u5b9a\u6700\u5927\u7684\u9501\u8868\u8fdb\u7a0b\u6570\u91cf\uff08\u9ed8\u8ba4\u4e3a10000\uff09\uff0c\u5982\u679c\u4f7f\u7528BDB\u7c7b\u578b\u6570\u636e\u8868\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u8be5\u53c2\u6570\u3002\u5982\u679c\u5728\u6267\u884c\u5927\u578b\u4e8b\u7269\u5904\u7406\u6216\u8005\u67e5\u8be2\u65f6\u53d1\u73b0 bdb: Lock table is out of available locks or Got error 12 from ... \u9519\u8bef\uff0c\u5219\u5e94\u8be5\u52a0\u5927\u8be5\u53c2\u6570\u503c\u3002\n\n7. bdb_logdir\n\n\u6307\u5b9a\u4f7f\u7528BDB\u7c7b\u578b\u6570\u636e\u8868\u63d0\u4f9b\u670d\u52a1\u65f6\u7684\u65e5\u5fd7\u5b58\u653e\u4f4d\u7f6e\u3002\u5373\u4e3a --bdb-logdir \u7684\u503c\u3002\n\n8. bdb_shared_data\n\n\u5982\u679c\u4f7f\u7528 --bdb-shared-data \u9009\u9879\u5219\u8be5\u53c2\u6570\u503c\u4e3aOn\u3002\n\n9. bdb_tmpdir\n\nBDB\u7c7b\u578b\u6570\u636e\u8868\u7684\u4e34\u65f6\u6587\u4ef6\u76ee\u5f55\u3002\u5373\u4e3a --bdb-tmpdir \u7684\u503c\u3002\n\n10. binlog_cache_size\n\n\u4e3abinary log\u6307\u5b9a\u5728\u67e5\u8be2\u8bf7\u6c42\u5904\u7406\u8fc7\u7a0b\u4e2dSQL \u67e5\u8be2\u8bed\u53e5\u4f7f\u7528\u7684\u7f13\u5b58\u5927\u5c0f\u3002\u5982\u679c\u9891\u7e41\u5e94\u7528\u4e8e\u5927\u91cf\u3001\u590d\u6742\u7684SQL\u8868\u8fbe\u5f0f\u5904\u7406\uff0c\u5219\u5e94\u8be5\u52a0\u5927\u8be5\u53c2\u6570\u503c\u4ee5\u83b7\u5f97\u6027\u80fd\u63d0\u5347\u3002\n\n11. bulk_insert_buffer_size\n\n\u6307\u5b9a MyISAM \u7c7b\u578b\u6570\u636e\u8868\u8868\u4f7f\u7528\u7279\u6b8a\u7684\u6811\u5f62\u7ed3\u6784\u7684\u7f13\u5b58\u3002\u4f7f\u7528\u6574\u5757\u65b9\u5f0f(bulk)\u80fd\u591f\u52a0\u5feb\u63d2\u5165\u64cd\u4f5c( INSERT ... SELECT, INSERT ... VALUES (...), (...), ..., \u548c LOAD DATA INFILE) \u7684\u901f\u5ea6\u548c\u6548\u7387\u3002\u8be5\u53c2\u6570\u9650\u5236\u6bcf\u4e2a\u7ebf\u7a0b\u4f7f\u7528\u7684\u6811\u5f62\u7ed3\u6784\u7f13\u5b58\u5927\u5c0f\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3a0\u5219\u7981\u7528\u8be5\u52a0\u901f\u7f13\u5b58\u529f\u80fd\u3002\u6ce8\u610f\uff1a\u8be5\u53c2\u6570\u5bf9\u5e94\u7684\u7f13\u5b58\u64cd\u4f5c\u53ea\u80fd\u7528\u6237\u5411\u975e\u7a7a\u6570\u636e\u8868\u4e2d\u6267\u884c\u63d2\u5165\u64cd\u4f5c\uff01\u9ed8\u8ba4\u503c\u4e3a 8MB\u3002\n\n12. character_set\n\nMySQL\u7684\u9ed8\u8ba4\u5b57\u7b26\u96c6\u3002\n\n13. character_sets\n\nMySQL\u6240\u80fd\u63d0\u4f9b\u652f\u6301\u7684\u5b57\u7b26\u96c6\u3002\n\n14. concurrent_inserts\n\n\u5982\u679c\u5f00\u542f\u8be5\u53c2\u6570\uff0cMySQL\u5219\u5141\u8bb8\u5728\u6267\u884c SELECT \u64cd\u4f5c\u7684\u540c\u65f6\u8fdb\u884c INSERT \u64cd\u4f5c\u3002\u5982\u679c\u8981\u5173\u95ed\u8be5\u53c2\u6570\uff0c\u53ef\u4ee5\u5728\u542f\u52a8 mysqld \u65f6\u52a0\u8f7d --safe \u9009\u9879\uff0c\u6216\u8005\u4f7f\u7528 --skip-new \u9009\u9879\u3002\u9ed8\u8ba4\u4e3aOn\u3002\n\n15. connect_timeout\n\n\u6307\u5b9aMySQL\u670d\u52a1\u7b49\u5f85\u5e94\u7b54\u4e00\u4e2a\u8fde\u63a5\u62a5\u6587\u7684\u6700\u5927\u79d2\u6570\uff0c\u8d85\u51fa\u8be5\u65f6\u95f4\uff0cMySQL\u5411\u5ba2\u6237\u7aef\u8fd4\u56de bad handshake\u3002\n\n16. datadir\n\n\u6307\u5b9a\u6570\u636e\u5e93\u8def\u5f84\u3002\u5373\u4e3a --datadir \u9009\u9879\u7684\u503c\u3002\n\n17. delay_key_write\n\n\u8be5\u53c2\u6570\u53ea\u5bf9 MyISAM \u7c7b\u578b\u6570\u636e\u8868\u6709\u6548\u3002\u6709\u5982\u4e0b\u7684\u53d6\u503c\u79cd\u7c7b\uff1a\n\noff: \u5982\u679c\u5728\u5efa\u8868\u8bed\u53e5\u4e2d\u4f7f\u7528 CREATE TABLE ... DELAYED_KEY_WRITES\uff0c\u5219\u5168\u90e8\u5ffd\u7565\n\nDELAYED_KEY_WRITES\uff1b\n\non: \u5982\u679c\u5728\u5efa\u8868\u8bed\u53e5\u4e2d\u4f7f\u7528 CREATE TABLE ... DELAYED_KEY_WRITES\uff0c\u5219\u4f7f\u7528\u8be5\u9009\u9879\uff08\u9ed8\u8ba4\uff09\uff1b\n\nall: \u6240\u6709\u6253\u5f00\u7684\u6570\u636e\u8868\u90fd\u5c06\u6309\u7167 DELAYED_KEY_WRITES \u5904\u7406\u3002\n\n\u5982\u679c DELAYED_KEY_WRITES \u5f00\u542f\uff0c\u5bf9\u4e8e\u5df2\u7ecf\u6253\u5f00\u7684\u6570\u636e\u8868\u800c\u8a00\uff0c\u5728\u6bcf\u6b21\u7d22\u5f15\u66f4\u65b0\u65f6\u90fd\u4e0d\u5237\u65b0\u5e26\u6709\n\nDELAYED_KEY_WRITES \u9009\u9879\u7684\u6570\u636e\u8868\u7684key buffer\uff0c\u9664\u975e\u8be5\u6570\u636e\u8868\u5173\u95ed\u3002\u8be5\u53c2\u6570\u4f1a\u5927\u5e45\u63d0\u5347\u5199\u5165\u952e\u503c\u7684\u901f\n\n\u5ea6\u3002\u5982\u679c\u4f7f\u7528\u8be5\u53c2\u6570\uff0c\u5219\u5e94\u8be5\u68c0\u67e5\u6240\u6709\u6570\u636e\u8868\uff1amyisamchk --fast --force\u3002\n\n18.delayed_insert_limit\n\n\u5728\u63d2\u5165delayed_insert_limit\u884c\u540e\uff0cINSERT DELAYED\u5904\u7406\u6a21\u5757\u5c06\u68c0\u67e5\u662f\u5426\u6709\u672a\u6267\u884c\u7684SELECT\u8bed\u53e5\u3002\u5982\u679c\u6709\uff0c\u5728\u7ee7\u7eed\u5904\u7406\u524d\u6267\u884c\u5141\u8bb8\u8fd9\u4e9b\u8bed\u53e5\u3002\n\n19. delayed_insert_timeout\n\n\u4e00\u4e2aINSERT DELAYED\u7ebf\u7a0b\u5e94\u8be5\u5728\u7ec8\u6b62\u4e4b\u524d\u7b49\u5f85INSERT\u8bed\u53e5\u7684\u65f6\u95f4\u3002\n\n20. delayed_queue_size\n\n\u4e3a\u5904\u7406INSERT DELAYED\u5206\u914d\u7684\u961f\u5217\u5927\u5c0f\uff08\u4ee5\u884c\u4e3a\u5355\u4f4d\uff09\u3002\u5982\u679c\u6392\u961f\u6ee1\u4e86\uff0c\u4efb\u4f55\u8fdb\u884cINSERT DELAYED\u7684\u5ba2\u6237\u5fc5\u987b\u7b49\u5f85\u961f\u5217\u7a7a\u95f4\u91ca\u653e\u540e\u624d\u80fd\u7ee7\u7eed\u3002\n\n21. flush\n\n\u5728\u542f\u52a8MySQL\u65f6\u52a0\u8f7d --flush \u53c2\u6570\u6253\u5f00\u8be5\u529f\u80fd\u3002\n\n22. flush_time\n\n\u5982\u679c\u8be5\u8bbe\u7f6e\u4e3a\u975e0\u503c\uff0c\u90a3\u4e48\u6bcfflush_time\u79d2\uff0c\u6240\u6709\u6253\u5f00\u7684\u8868\u5c06\u88ab\u5173\uff0c\u4ee5\u91ca\u653e\u8d44\u6e90\u548csync\u5230\u78c1\u76d8\u3002\u6ce8\u610f\uff1a\u53ea\u5efa\u8bae\u5728\u4f7f\u7528 Windows9x/Me \u6216\u8005\u5f53\u524d\u64cd\u4f5c\u7cfb\u7edf\u8d44\u6e90\u4e25\u91cd\u4e0d\u8db3\u65f6\u624d\u4f7f\u7528\u8be5\u53c2\u6570\uff01\n\n23. ft_boolean_syntax\n\n\u641c\u7d22\u5f15\u64ce\u7ef4\u62a4\u5458\u5e0c\u671b\u66f4\u6539\u5141\u8bb8\u7528\u4e8e\u903b\u8f91\u5168\u6587\u641c\u7d22\u7684\u64cd\u4f5c\u7b26\u3002\u8fd9\u4e9b\u5219\u7531\u53d8\u91cf ft_boolean_syntax \u63a7\u5236\u3002\n\n24. ft_min_word_len\n\n\u6307\u5b9a\u88ab\u7d22\u5f15\u7684\u5173\u952e\u8bcd\u7684\u6700\u5c0f\u957f\u5ea6\u3002\u6ce8\u610f\uff1a\u5728\u66f4\u6539\u8be5\u53c2\u6570\u503c\u540e\uff0c\u7d22\u5f15\u5fc5\u987b\u91cd\u5efa\uff01\n\n25. ft_max_word_len\n\n\u6307\u5b9a\u88ab\u7d22\u5f15\u7684\u5173\u952e\u8bcd\u7684\u6700\u5927\u957f\u5ea6\u3002\u6ce8\u610f\uff1a\u5728\u66f4\u6539\u8be5\u53c2\u6570\u503c\u540e\uff0c\u7d22\u5f15\u5fc5\u987b\u91cd\u5efa\uff01\n\n26. ft_max_word_len_for_sort\n\n\u6307\u5b9a\u5728\u4f7f\u7528REPAIR, CREATE INDEX, or ALTER TABLE\u7b49\u65b9\u6cd5\u8fdb\u884c\u5feb\u901f\u5168\u6587\u7d22\u5f15\u91cd\u5efa\u8fc7\u7a0b\u4e2d\u6240\u80fd\u4f7f\u7528\u7684\u5173\u952e\u8bcd\u7684\u6700\u5927\u957f\u5ea6\u3002\u8d85\u51fa\u8be5\u957f\u5ea6\u9650\u5236\u7684\u5173\u952e\u8bcd\u5c06\u4f7f\u7528\u4f4e\u901f\u65b9\u5f0f\u8fdb\u884c\u63d2\u5165\u3002\u52a0\u5927\u8be5\u53c2\u6570\u7684\u503c\uff0cMySQL\u5c06\u4f1a\u5efa\u7acb\u66f4\u5927\u7684\u4e34\u65f6\u6587\u4ef6\uff08\u8fd9\u4f1a\u51cf\u8f7bCPU\u8d1f\u8f7d\uff0c\u4f46\u6548\u7387\u5c06\u53d6\u51b3\u4e8e\u78c1\u76d8I/O\u6548\u7387\uff09\uff0c\u5e76\u4e14\u5728\u4e00\u4e2a\u6392\u5e8f\u53d6\u5185\u5b58\u653e\u66f4\u5c11\u7684\u952e\u503c\u3002\n\n27. ft_stopword_file\n\n\u4ece ft_stopword_file \u53d8\u91cf\u6307\u5b9a\u7684\u6587\u4ef6\u4e2d\u8bfb\u53d6\u5217\u8868\u3002\u5728\u4fee\u6539\u4e86 stopword \u5217\u8868\u540e\uff0c\u5fc5\u987b\u91cd\u5efa FULLTEXT \u7d22\u5f15\u3002\n\n28. have_innodb\n\nYES: MySQL\u652f\u6301InnoDB\u7c7b\u578b\u6570\u636e\u8868\uff1b DISABLE: \u4f7f\u7528 --skip-innodb \u5173\u95ed\u5bf9InnoDB\u7c7b\u578b\u6570\u636e\u8868\u7684\u652f\u6301\u3002\n\n29. have_bdb\n\nYES: MySQL\u652f\u6301\u4f2f\u514b\u5229\u7c7b\u578b\u6570\u636e\u8868\uff1b DISABLE: \u4f7f\u7528 --skip-bdb \u5173\u95ed\u5bf9\u4f2f\u514b\u5229\u7c7b\u578b\u6570\u636e\u8868\u7684\u652f\u6301\u3002\n\n30. have_raid\n\nYES: \u4f7fMySQL\u652f\u6301RAID\u529f\u80fd\u3002\n\n31. have_openssl\n\nYES: \u4f7fMySQL\u652f\u6301SSL\u52a0\u5bc6\u534f\u8bae\u3002\n\n32. init_file\n\n\u6307\u5b9a\u4e00\u4e2a\u5305\u542bSQL\u67e5\u8be2\u8bed\u53e5\u7684\u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u5728MySQL\u542f\u52a8\u65f6\u5c06\u88ab\u52a0\u8f7d\uff0c\u6587\u4ef6\u4e2d\u7684SQL\u8bed\u53e5\u4e5f\u4f1a\u88ab\u6267\u884c\u3002\n\n33. interactive_timeout\n\n\u670d\u52a1\u5668\u5728\u5173\u4e0a\u5b83\u524d\u5728\u4e00\u4e2a\u4ea4\u4e92\u8fde\u63a5\u4e0a\u7b49\u5f85\u884c\u52a8\u7684\u79d2\u6570\u3002\u4e00\u4e2a\u4ea4\u4e92\u7684\u5ba2\u6237\u88ab\u5b9a\u4e49\u4e3a\u5bf9mysql_real_connect()\u4f7f\u7528CLIENT_INTERACTIVE\u9009\u9879\u7684\u5ba2\u6237\u3002\u4e5f\u53ef\u89c1wait_timeout\u3002\n\n34. join_buffer_size\n\n\u7528\u4e8e\u5168\u90e8\u8054\u5408(join)\u7684\u7f13\u51b2\u533a\u5927\u5c0f(\u4e0d\u662f\u7528\u7d22\u5f15\u7684\u8054\u7ed3)\u3002\u7f13\u51b2\u533a\u5bf92\u4e2a\u8868\u95f4\u7684\u6bcf\u4e2a\u5168\u90e8\u8054\u7ed3\u5206\u914d\u4e00\u6b21\u7f13\u51b2\u533a\uff0c\u5f53\u589e\u52a0\u7d22\u5f15\u4e0d\u53ef\u80fd\u65f6\uff0c\u589e\u52a0\u8be5\u503c\u53ef\u5f97\u5230\u4e00\u4e2a\u66f4\u5feb\u7684\u5168\u90e8\u8054\u7ed3\u3002\uff08\u901a\u5e38\u5f97\u5230\u5feb\u901f\u8054\u7ed3\u7684\u6700\u4f73\u65b9\u6cd5\u662f\u589e\u52a0\u7d22\u5f15\u3002\uff09\n\n35. key_buffer_size\n\n\u7528\u4e8e\u7d22\u5f15\u5757\u7684\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u589e\u52a0\u5b83\u53ef\u5f97\u5230\u66f4\u597d\u5904\u7406\u7684\u7d22\u5f15(\u5bf9\u6240\u6709\u8bfb\u548c\u591a\u91cd\u5199)\uff0c\u5230\u4f60\u80fd\u8d1f\u62c5\u5f97\u8d77\u90a3\u6837\u591a\u3002\u5982\u679c\u4f60\u4f7f\u5b83\u592a\u5927\uff0c\u7cfb\u7edf\u5c06\u5f00\u59cb\u53d8\u6162\u6162\u3002\u5fc5\u987b\u4e3aOS\u6587\u4ef6\u7cfb\u7edf\u7f13\u5b58\u7559\u4e0b\u4e00\u4e9b\u7a7a\u95f4\u3002\u4e3a\u4e86\u5728\u5199\u5165\u591a\u4e2a\u884c\u65f6\u5f97\u5230\u66f4\u591a\u7684\u901f\u5ea6\u3002\n\n36. language\n\n\u7528\u6237\u8f93\u51fa\u62a5\u9519\u4fe1\u606f\u7684\u8bed\u8a00\u3002\n\n37. large_file_support\n\n\u5f00\u542f\u5927\u6587\u4ef6\u652f\u6301\u3002\n\n38. locked_in_memory\n\n\u4f7f\u7528 --memlock \u5c06mysqld\u9501\u5b9a\u5728\u5185\u5b58\u4e2d\u3002\n\n39. log\n\n\u8bb0\u5f55\u6240\u6709\u67e5\u8be2\u64cd\u4f5c\u3002\n\n40. log_update\n\n\u5f00\u542fupdate log\u3002\n\n41. log_bin\n\n\u5f00\u542f binary log\u3002\n\n42. log_slave_updates\n\n\u5982\u679c\u4f7f\u7528\u94fe\u72b6\u540c\u6b65\u6216\u8005\u591a\u53f0Slave\u4e4b\u95f4\u8fdb\u884c\u540c\u6b65\u5219\u9700\u8981\u5f00\u542f\u6b64\u53c2\u6570\u3002\n\n43. long_query_time\n\n\u5982\u679c\u4e00\u4e2a\u67e5\u8be2\u6240\u7528\u65f6\u95f4\u8d85\u8fc7\u8be5\u53c2\u6570\u503c\uff0c\u5219\u8be5\u67e5\u8be2\u64cd\u4f5c\u5c06\u88ab\u8bb0\u5f55\u5728Slow_queries\u4e2d\u3002\n\n44. lower_case_table_names\n\n1: MySQL\u603b\u4f7f\u7528\u5c0f\u5199\u5b57\u6bcd\u8fdb\u884cSQL\u64cd\u4f5c\uff1b\n\n0: \u5173\u95ed\u8be5\u529f\u80fd\u3002\n\n\u6ce8\u610f\uff1a\u5982\u679c\u4f7f\u7528\u8be5\u53c2\u6570\uff0c\u5219\u5e94\u8be5\u5728\u542f\u7528\u524d\u5c06\u6240\u6709\u6570\u636e\u8868\u8f6c\u6362\u4e3a\u5c0f\u5199\u5b57\u6bcd\u3002\n\n45. max_allowed_packet\n\n\u4e00\u4e2a\u67e5\u8be2\u8bed\u53e5\u5305\u7684\u6700\u5927\u5c3a\u5bf8\u3002\u6d88\u606f\u7f13\u51b2\u533a\u88ab\u521d\u59cb\u5316\u4e3anet_buffer_length\u5b57\u8282\uff0c\u4f46\u662f\u53ef\u5728\u9700\u8981\u65f6\u589e\u52a0\u5230max_allowed_packet\u4e2a\u5b57\u8282\u3002\u8be5\u503c\u592a\u5c0f\u5219\u4f1a\u5728\u5904\u7406\u5927\u5305\u65f6\u4ea7\u751f\u9519\u8bef\u3002\u5982\u679c\u4f7f\u7528\u5927\u7684BLOB\u5217\uff0c\u5fc5\u987b\u589e\u52a0\u8be5\u503c\u3002\n\n46. net_buffer_length\n\n\u901a\u4fe1\u7f13\u51b2\u533a\u5728\u67e5\u8be2\u671f\u95f4\u88ab\u91cd\u7f6e\u5230\u8be5\u5927\u5c0f\u3002\u901a\u5e38\u4e0d\u8981\u6539\u53d8\u8be5\u53c2\u6570\u503c\uff0c\u4f46\u662f\u5982\u679c\u5185\u5b58\u4e0d\u8db3\uff0c\u53ef\u4ee5\u5c06\u5b83\u8bbe\u7f6e\u4e3a\u67e5\u8be2\u671f\u671b\u7684\u5927\u5c0f\u3002\uff08\u5373\uff0c\u5ba2\u6237\u53d1\u51fa\u7684SQL\u8bed\u53e5\u671f\u671b\u7684\u957f\u5ea6\u3002\u5982\u679c\u8bed\u53e5\u8d85\u8fc7\u8fd9\u4e2a\u957f\u5ea6\uff0c\u7f13\u51b2\u533a\u81ea\u52a8\u5730\u88ab\u6269\u5927\uff0c\u76f4\u5230max_allowed_packet\u4e2a\u5b57\u8282\u3002\uff09\n\n47. max_binlog_cache_size\n\n\u6307\u5b9abinary log\u7f13\u5b58\u7684\u6700\u5927\u5bb9\u91cf\uff0c\u5982\u679c\u8bbe\u7f6e\u7684\u8fc7\u5c0f\uff0c\u5219\u5728\u6267\u884c\u590d\u6742\u67e5\u8be2\u8bed\u53e5\u65f6MySQL\u4f1a\u51fa\u9519\u3002\n\n48. max_binlog_size\n\n\u6307\u5b9abinary log\u6587\u4ef6\u7684\u6700\u5927\u5bb9\u91cf\uff0c\u9ed8\u8ba4\u4e3a1GB\u3002\n\n49. max_connections\n\n\u5141\u8bb8\u540c\u65f6\u8fde\u63a5MySQL\u670d\u52a1\u5668\u7684\u5ba2\u6237\u6570\u91cf\u3002\u5982\u679c\u8d85\u51fa\u8be5\u503c\uff0cMySQL\u4f1a\u8fd4\u56deToo many connections\u9519\u8bef\uff0c\u4f46\u901a\u5e38\u60c5\u51b5\u4e0b\uff0cMySQL\u80fd\u591f\u81ea\u884c\u89e3\u51b3\u3002\n\n50. max_connect_errors\n\n\u5bf9\u4e8e\u540c\u4e00\u4e3b\u673a\uff0c\u5982\u679c\u6709\u8d85\u51fa\u8be5\u53c2\u6570\u503c\u4e2a\u6570\u7684\u4e2d\u65ad\u9519\u8bef\u8fde\u63a5\uff0c\u5219\u8be5\u4e3b\u673a\u5c06\u88ab\u7981\u6b62\u8fde\u63a5\u3002\u5982\u9700\u5bf9\u8be5\u4e3b\u673a\u8fdb\u884c\u89e3\u7981\uff0c\u6267\u884c\uff1aFLUSH HOST;\u3002\n\n51. max_delayed_threads\n\n\u4e0d\u8981\u542f\u52a8\u591a\u4e8e\u7684\u8fd9\u4e2a\u6570\u5b57\u7684\u7ebf\u7a0b\u6765\u5904\u7406INSERT DELAYED\u8bed\u53e5\u3002\u5982\u679c\u4f60\u8bd5\u56fe\u5728\u6240\u6709INSERT DELAYED\u7ebf\u7a0b\u5728\u7528\u540e\u5411\u4e00\u5f20\u65b0\u8868\u63d2\u5165\u6570\u636e\uff0c\u884c\u5c06\u88ab\u63d2\u5165\uff0c\u5c31\u50cfDELAYED\u5c5e\u6027\u6ca1\u88ab\u6307\u5b9a\u90a3\u6837\u3002\n\n52. max_heap_table_size\n\n\u5185\u5b58\u8868\u6240\u80fd\u4f7f\u7528\u7684\u6700\u5927\u5bb9\u91cf\u3002\n\n53. max_join_size\n\n\u5982\u679c\u8981\u67e5\u8be2\u591a\u4e8emax_join_size\u4e2a\u8bb0\u5f55\u7684\u8054\u5408\u5c06\u8fd4\u56de\u4e00\u4e2a\u9519\u8bef\u3002\u5982\u679c\u8981\u6267\u884c\u6ca1\u6709\u4e00\u4e2aWHERE\u7684\u8bed\u53e5\u5e76\u4e14\u8017\u8d39\u5927\u91cf\u65f6\u95f4\uff0c\u4e14\u8fd4\u56de\u4e0a\u767e\u4e07\u884c\u7684\u8054\u7ed3\uff0c\u5219\u9700\u8981\u52a0\u5927\u8be5\u53c2\u6570\u503c\u3002\n\n54. max_sort_length\n\n\u5728\u6392\u5e8fBLOB\u6216TEXT\u503c\u65f6\u4f7f\u7528\u7684\u5b57\u8282\u6570(\u6bcf\u4e2a\u503c\u4ec5\u5934max_sort_length\u4e2a\u5b57\u8282\u88ab\u4f7f\u7528\uff1b\u5176\u4f59\u7684\u88ab\u5ffd\u7565)\u3002\n\n55. max_user_connections\n\n\u6307\u5b9a\u6765\u81ea\u540c\u4e00\u7528\u6237\u7684\u6700\u591a\u8fde\u63a5\u6570\u3002\u8bbe\u7f6e\u4e3a0\u5219\u4ee3\u8868\u4e0d\u9650\u5236\u3002\n\n56. max_tmp_tables\n\n\uff08\u8be5\u53c2\u6570\u76ee\u524d\u8fd8\u6ca1\u6709\u4f5c\u7528\uff09\u3002\u4e00\u4e2a\u5ba2\u6237\u80fd\u540c\u65f6\u4fdd\u6301\u6253\u5f00\u7684\u4e34\u65f6\u8868\u7684\u6700\u5927\u6570\u91cf\u3002\n\n57. max_write_lock_count\n\n\u5f53\u51fa\u73b0max_write_lock_count\u4e2a\u5199\u5165\u9501\u5b9a\u6570\u91cf\u540e\uff0c\u5f00\u59cb\u5141\u8bb8\u4e00\u4e9b\u88ab\u9501\u5b9a\u7684\u8bfb\u64cd\u4f5c\u5f00\u59cb\u6267\u884c\u3002\u907f\u514d\u5199\u5165\u9501\u5b9a\u8fc7\u591a\uff0c\u8bfb\u53d6\u64cd\u4f5c\u5904\u4e8e\u957f\u65f6\u95f4\u7b49\u5f85\u72b6\u6001\u3002\n\n58. myisam_recover_options\n</code></pre>"},{"location":"buffer-pool/#innodb-buffer-pool","title":"InnoDB Buffer Pool\u8be6\u89e3","text":"<ul> <li>https://zhuanlan.zhihu.com/p/65811829</li> </ul>"},{"location":"buffer-pool/#_2","title":"\u4e00\u3001\u524d\u8a00","text":"<p>MySQ InnoDB Buffer Pool\uff0c\u4ece\u5b57\u9762\u610f\u601d\u7406\u89e3\u5c31\u662f:MySQL InnoDB\u7f13\u51b2\u6c60\uff0c\u65e2\u7136\u662f\u7f13\u51b2\u6c60\uff0c\u90a3\u4e48\u91cc\u9762\u5e94\u8be5\u7f13\u5b58\u7740\u5927\u91cf\u7684\u6570\u636e\uff0c\u4f7fCPU\u8bfb\u53d6\u6216\u8005\u5199\u5165\u6570\u636e\u65f6\uff0c\u4e0d\u76f4\u63a5\u548c\u4f4e\u901f\u7684\u78c1\u76d8\u6253\u4ea4\u9053\uff0c\u76f4\u63a5\u548c\u7f13\u51b2\u533a\u8fdb\u884c\u4ea4\u4e92\uff0c\u4ece\u800c\u89e3\u51b3\u4e86\u56e0\u4e3a\u78c1\u76d8\u6027\u80fd\u6162\u5bfc\u81f4\u7684\u6570\u636e\u5e93\u6027\u80fd\u5dee\u7684\u95ee\u9898\uff0c\u5f25\u8865\u4e86\u4e24\u8005\u4e4b\u95f4\u7684\u901f\u5ea6\u5dee\u5f02\u3002\u4f46\u5c0f\u7f16\u5c31\u4f1a\u6709\u4e9b\u7591\u95ee:</p> <ul> <li>Innodb buffer pool\u6709\u54ea\u4e9b\u9700\u8981\u63d0\u524d\u4e86\u89e3\u7684\u57fa\u7840\u77e5\u8bc6\uff1f</li> <li>Innodb buffer pool\u4e2d\u5b58\u7684\u5177\u4f53\u662f\u4ec0\u4e48\u5185\u5bb9\uff1f</li> <li>Innodb bufferp pool\u4e2d\u7684\u6570\u636e\u662f\u5982\u4f55\u52a0\u8f7d\u8fdb\u53bb\u7684\uff1f</li> <li>InnoDB\u5982\u4f55\u7ba1\u7406buffer pool\u7684\uff1f</li> <li>Innodb Buffer Pool \u6709\u54ea\u4e9b\u914d\u7f6e\u9879\uff1f</li> </ul>"},{"location":"buffer-pool/#_3","title":"\u4e8c\u3001\u57fa\u7840\u77e5\u8bc6","text":"<p>2.1 Buffer Pool Instance</p> <p>Buffer Pool\u5b9e\u4f8b\uff0c\u5927\u5c0f\u7b49\u4e8einnodb_buffer_pool_size/innodb_buffer_pool_instances\uff0c\u6bcf\u4e2aBuffer Pool Instance\u90fd\u6709\u81ea\u5df1\u7684\u9501\uff0c\u4fe1\u53f7\u91cf\uff0c\u7269\u7406\u5757(Buffer chunks)\u4ee5\u53ca\u903b\u8f91\u94fe\u8868(List)\u3002\u5373\u5404\u4e2ainstance\u4e4b\u95f4\u6ca1\u6709\u7ade\u4e89\u5173\u7cfb\uff0c\u53ef\u4ee5\u5e76\u53d1\u8bfb\u53d6\u4e0e\u5199\u5165\u3002\u6240\u6709instance\u7684\u7269\u7406\u5757(Buffer chunks)\u5728\u6570\u636e\u5e93\u542f\u52a8\u7684\u65f6\u5019\u88ab\u5206\u914d\uff0c\u76f4\u5230\u6570\u636e\u5e93\u5173\u95ed\u5185\u5b58\u624d\u4e88\u4ee5\u91ca\u653e\u3002\u6bcf\u4e2aBuffer Pool Instance\u6709\u4e00\u4e2apage hash\u94fe\u8868\uff0c\u901a\u8fc7\u5b83\uff0c\u4f7f\u7528space_id\u548cpage_no\u5c31\u80fd\u5feb\u901f\u627e\u5230\u5df2\u7ecf\u88ab\u8bfb\u5165\u5185\u5b58\u7684\u6570\u636e\u9875\uff0c\u800c\u4e0d\u7528\u7ebf\u6027\u904d\u5386LRU List\u53bb\u67e5\u627e\u3002\u6ce8\u610f\u8fd9\u4e2ahash\u8868\u4e0d\u662fInnoDB\u7684\u81ea\u9002\u5e94\u54c8\u5e0c\uff0c\u81ea\u9002\u5e94\u54c8\u5e0c\u662f\u4e3a\u4e86\u51cf\u5c11Btree\u7684\u626b\u63cf\uff0c\u800cpage hash\u662f\u4e3a\u4e86\u907f\u514d\u626b\u63cfLRU List\u3002</p> <p>\u5f53innodb_buffer_pool_size\u5c0f\u4e8e1GB\u65f6\u5019\uff0cinnodb_buffer_pool_instances\u88ab\u91cd\u7f6e\u4e3a1\uff0c\u4e3b\u8981\u662f\u9632\u6b62\u6709\u592a\u591a\u5c0f\u7684instance\u4ece\u800c\u5bfc\u81f4\u6027\u80fd\u95ee\u9898\u3002</p> <p>2.2 \u6570\u636e\u9875</p> <p>InnoDB\u4e2d\uff0c\u6570\u636e\u7ba1\u7406\u7684\u6700\u5c0f\u5355\u4f4d\u4e3a\u9875\uff0c\u9ed8\u8ba4\u662f16KB\uff0c\u9875\u4e2d\u9664\u4e86\u5b58\u50a8\u7528\u6237\u6570\u636e\uff0c\u8fd8\u53ef\u4ee5\u5b58\u50a8\u63a7\u5236\u4fe1\u606f\u7684\u6570\u636e\u3002InnoDB IO\u5b50\u7cfb\u7edf\u7684\u8bfb\u5199\u6700\u5c0f\u5355\u4f4d\u4e5f\u662f\u9875\u3002</p> <p>2.3 Buffer Chunks</p> <p>\u5305\u62ec\u4e24\u90e8\u5206\uff1a\u6570\u636e\u9875\u548c\u6570\u636e\u9875\u5bf9\u5e94\u7684\u63a7\u5236\u4f53\uff0c\u63a7\u5236\u4f53\u4e2d\u6709\u6307\u9488\u6307\u5411\u6570\u636e\u9875\u3002Buffer Chunks\u662f\u6700\u4f4e\u5c42\u7684\u7269\u7406\u5757\uff0c\u5728\u542f\u52a8\u9636\u6bb5\u4ece\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\uff0c\u76f4\u5230\u6570\u636e\u5e93\u5173\u95ed\u624d\u91ca\u653e\u3002\u901a\u8fc7\u904d\u5386chunks\u53ef\u4ee5\u8bbf\u95ee\u51e0\u4e4e\u6240\u6709\u7684\u6570\u636e\u9875\uff0c\u6709\u4e24\u79cd\u72b6\u6001\u7684\u6570\u636e\u9875\u9664\u5916\uff1a\u6ca1\u6709\u88ab\u89e3\u538b\u7684\u538b\u7f29\u9875(BUF_BLOCK_ZIP_PAGE)\u4ee5\u53ca\u88ab\u4fee\u6539\u8fc7\u4e14\u89e3\u538b\u9875\u5df2\u7ecf\u88ab\u9a71\u9010\u7684\u538b\u7f29\u9875(BUF_BLOCK_ZIP_DIRTY)\u3002\u6b64\u5916\u6570\u636e\u9875\u91cc\u9762\u4e0d\u4e00\u5b9a\u90fd\u5b58\u7684\u662f\u7528\u6237\u6570\u636e\uff0c\u5f00\u59cb\u662f\u63a7\u5236\u4fe1\u606f\uff0c\u6bd4\u5982\u884c\u9501\uff0c\u81ea\u9002\u5e94\u54c8\u5e0c\u7b49\u3002</p> <p>2.4 \u903b\u8f91\u94fe\u8868</p> <p>\u94fe\u8868\u8282\u70b9\u662f\u6570\u636e\u9875\u7684\u63a7\u5236\u4f53(\u63a7\u5236\u4f53\u4e2d\u6709\u6307\u9488\u6307\u5411\u771f\u6b63\u7684\u6570\u636e\u9875)\uff0c\u94fe\u8868\u4e2d\u7684\u6240\u6709\u8282\u70b9\u90fd\u6709\u540c\u4e00\u7684\u5c5e\u6027\uff0c\u5f15\u5165\u5176\u7684\u76ee\u7684\u662f\u65b9\u4fbf\u7ba1\u7406\u3002Innodb Buffer Pool \u76f8\u5173\u7684\u94fe\u8868\u6709:</p> <p>2.4.1 Free List</p> <p>\u5176\u4e0a\u7684\u8282\u70b9\u90fd\u662f\u672a\u88ab\u4f7f\u7528\u7684\u8282\u70b9\uff0c\u5982\u679c\u9700\u8981\u4ece\u6570\u636e\u5e93\u4e2d\u5206\u914d\u65b0\u7684\u6570\u636e\u9875\uff0c\u76f4\u63a5\u4ece\u4e0a\u83b7\u53d6\u5373\u53ef\u3002InnoDB\u9700\u8981\u4fdd\u8bc1Free List\u6709\u8db3\u591f\u7684\u8282\u70b9\uff0c\u63d0\u4f9b\u7ed9\u7528\u6237\u7ebf\u7a0b\u7528\uff0c\u5426\u5219\u9700\u8981\u4eceFLU List\u6216\u8005LRU List\u6dd8\u6c70\u4e00\u5b9a\u7684\u8282\u70b9\u3002InnoDB\u521d\u59cb\u5316\u540e\uff0cBuffer Chunks\u4e2d\u7684\u6240\u6709\u6570\u636e\u9875\u90fd\u88ab\u52a0\u5165\u5230Free List\uff0c\u8868\u793a\u6240\u6709\u8282\u70b9\u90fd\u53ef\u7528\u3002</p> <p>2.4.2 LRU List</p> <p>\u8fd1\u671f\u6700\u5c11\u4f7f\u7528\u94fe\u8868(Least Recently Used)\uff0c\u8fd9\u4e2a\u662fInnoDB\u4e2d\u6700\u91cd\u8981\u7684\u94fe\u8868\u3002\u6240\u6709\u65b0\u8bfb\u53d6\u8fdb\u6765\u7684\u6570\u636e\u9875\u90fd\u88ab\u653e\u5728\u4e0a\u9762\u3002\u94fe\u8868\u6309\u7167\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7b97\u6cd5\u6392\u5e8f\uff0c\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u8282\u70b9\u88ab\u653e\u5728\u94fe\u8868\u672b\u5c3e\uff0c\u5982\u679cFree List\u91cc\u9762\u6ca1\u6709\u8282\u70b9\u4e86\uff0c\u5c31\u4f1a\u4ece\u4e2d\u6dd8\u6c70\u672b\u5c3e\u7684\u8282\u70b9\u3002LRU List\u8fd8\u5305\u542b\u6ca1\u6709\u88ab\u89e3\u538b\u7684\u538b\u7f29\u9875\uff0c\u8fd9\u4e9b\u538b\u7f29\u9875\u521a\u4ece\u78c1\u76d8\u8bfb\u53d6\u51fa\u6765\uff0c\u8fd8\u6ca1\u6765\u5f97\u53ca\u88ab\u89e3\u538b\u3002LRU List\u88ab\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u9ed8\u8ba4\u524d5/8\u4e3ayoung list\uff0c\u5b58\u50a8\u7ecf\u5e38\u88ab\u4f7f\u7528\u7684\u70ed\u70b9page\uff0c\u540e3/8\u4e3aold list\u3002\u65b0\u8bfb\u5165\u7684page\u9ed8\u8ba4\u88ab\u52a0\u5728old list\u5934\uff0c\u53ea\u6709\u6ee1\u8db3\u4e00\u5b9a\u6761\u4ef6\u540e\uff0c\u624d\u88ab\u79fb\u5230young list\u4e0a\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u9884\u8bfb\u7684\u6570\u636e\u9875\u548c\u5168\u8868\u626b\u63cf\u6c61\u67d3buffer pool\u3002</p> <p>2.4.3 FLU List</p> <p>\u8fd9\u4e2a\u94fe\u8868\u4e2d\u7684\u6240\u6709\u8282\u70b9\u90fd\u662f\u810f\u9875\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd9\u4e9b\u6570\u636e\u9875\u90fd\u88ab\u4fee\u6539\u8fc7\uff0c\u4f46\u662f\u8fd8\u6ca1\u6765\u5f97\u53ca\u88ab\u5237\u65b0\u5230\u78c1\u76d8\u4e0a\u3002\u5728FLU List\u4e0a\u7684\u9875\u9762\u4e00\u5b9a\u5728LRU List\u4e0a\uff0c\u4f46\u662f\u53cd\u4e4b\u5219\u4e0d\u6210\u7acb\u3002\u4e00\u4e2a\u6570\u636e\u9875\u53ef\u80fd\u4f1a\u5728\u4e0d\u540c\u7684\u65f6\u523b\u88ab\u4fee\u6539\u591a\u6b21\uff0c\u5728\u6570\u636e\u9875\u4e0a\u8bb0\u5f55\u4e86\u6700\u8001(\u4e5f\u5c31\u662f\u7b2c\u4e00\u6b21)\u7684\u4e00\u6b21\u4fee\u6539\u7684lsn\uff0c\u5373oldest_modification\u3002\u4e0d\u540c\u6570\u636e\u9875\u6709\u4e0d\u540c\u7684oldest_modification\uff0cFLU List\u4e2d\u7684\u8282\u70b9\u6309\u7167oldest_modification\u6392\u5e8f\uff0c\u94fe\u8868\u5c3e\u662f\u6700\u5c0f\u7684\uff0c\u4e5f\u5c31\u662f\u6700\u65e9\u88ab\u4fee\u6539\u7684\u6570\u636e\u9875\uff0c\u5f53\u9700\u8981\u4eceFLU List\u4e2d\u6dd8\u6c70\u9875\u9762\u65f6\u5019\uff0c\u4ece\u94fe\u8868\u5c3e\u90e8\u5f00\u59cb\u6dd8\u6c70\u3002\u52a0\u5165FLU List\uff0c\u9700\u8981\u4f7f\u7528flush_list_mutex\u4fdd\u62a4\uff0c\u6240\u4ee5\u80fd\u4fdd\u8bc1FLU List\u4e2d\u8282\u70b9\u7684\u987a\u5e8f\u3002</p> <p>2.4.4 Unzip LRU List</p> <p>\u8fd9\u4e2a\u94fe\u8868\u4e2d\u5b58\u50a8\u7684\u6570\u636e\u9875\u90fd\u662f\u89e3\u538b\u9875\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u4e2a\u6570\u636e\u9875\u662f\u4ece\u4e00\u4e2a\u538b\u7f29\u9875\u901a\u8fc7\u89e3\u538b\u800c\u6765\u7684\u3002</p> <p>2.4.5 Zip Clean List</p> <p>\u8fd9\u4e2a\u94fe\u8868\u53ea\u5728Debug\u6a21\u5f0f\u4e0b\u6709\uff0c\u4e3b\u8981\u662f\u5b58\u50a8\u6ca1\u6709\u88ab\u89e3\u538b\u7684\u538b\u7f29\u9875\u3002\u8fd9\u4e9b\u538b\u7f29\u9875\u521a\u521a\u4ece\u78c1\u76d8\u8bfb\u53d6\u51fa\u6765\uff0c\u8fd8\u6ca1\u6765\u7684\u53ca\u88ab\u89e3\u538b\uff0c\u4e00\u65e6\u88ab\u89e3\u538b\u540e\uff0c\u5c31\u4ece\u6b64\u94fe\u8868\u4e2d\u5220\u9664\uff0c\u7136\u540e\u52a0\u5165\u5230Unzip LRU List\u4e2d\u3002</p> <p>2.4.6 Zip Free</p> <p>\u538b\u7f29\u9875\u6709\u4e0d\u540c\u7684\u5927\u5c0f\uff0c\u6bd4\u59828K\uff0c4K\uff0cInnoDB\u4f7f\u7528\u4e86\u7c7b\u4f3c\u5185\u5b58\u7ba1\u7406\u7684\u4f19\u4f34\u7cfb\u7edf\u6765\u7ba1\u7406\u538b\u7f29\u9875\u3002Zip Free\u53ef\u4ee5\u7406\u89e3\u4e3a\u75315\u4e2a\u94fe\u8868\u6784\u6210\u7684\u4e00\u4e2a\u4e8c\u7ef4\u6570\u7ec4\uff0c\u6bcf\u4e2a\u94fe\u8868\u5206\u522b\u5b58\u50a8\u4e86\u5bf9\u5e94\u5927\u5c0f\u7684\u5185\u5b58\u788e\u7247\uff0c\u4f8b\u59828K\u7684\u94fe\u8868\u91cc\u5b58\u50a8\u7684\u90fd\u662f8K\u7684\u788e\u7247\uff0c\u5982\u679c\u65b0\u8bfb\u5165\u4e00\u4e2a8K\u7684\u9875\u9762\uff0c\u9996\u5148\u4ece\u8fd9\u4e2a\u94fe\u8868\u4e2d\u67e5\u627e\uff0c\u5982\u679c\u6709\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u5982\u679c\u6ca1\u6709\u5219\u4ece16K\u7684\u94fe\u8868\u4e2d\u5206\u88c2\u51fa\u4e24\u4e2a8K\u7684\u5757\uff0c\u4e00\u4e2a\u88ab\u4f7f\u7528\uff0c\u53e6\u5916\u4e00\u4e2a\u653e\u51658K\u94fe\u8868\u4e2d\u3002</p> <p>2.6 Frame</p> <p>\u5e27\uff0c16K\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c \u5728\u7f13\u51b2\u6c60\u7684\u7ba1\u7406\u4e0a\uff0c\u6574\u4e2a\u7f13\u51b2\u533a\u662f\u662f\u4ee5\u5927\u5c0f\u4e3a16k\u7684frame(\u53ef\u4ee5\u7406\u89e3\u4e3a\u6570\u636e\u5757)\u4e3a\u5355\u4f4d\u6765\u8fdb\u884c\u7684\uff0cframe\u662finnodb\u4e2d\u9875\u7684\u5927\u5c0f\u3002</p> <p>2.7 Page</p> <p>\u9875\uff0c16K\u7684\u7269\u7406\u5185\u5b58\uff0c page\u4e0a\u5b58\u7684\u662f\u9700\u8981\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\u7684\u6570\u636e\uff0c \u8fd9\u4e9b\u6570\u636e\u53ef\u80fd\u662f\u6570\u636e\u8bb0\u5f55\u4fe1\u606f\uff0c \u4e5f\u53ef\u4ee5\u662f\u7d22\u5f15\u4fe1\u606f\u6216\u5176\u4ed6\u7684\u5143\u6570\u636e\u7b49\uff1b</p> <p>2.8 Control Block</p> <p>\u63a7\u5236\u5757\uff0c\u5bf9\u4e8e\u6bcf\u4e2aframe, \u5bf9\u5e94\u4e00\u4e2ablock\uff0c block\u4e0a\u7684\u4fe1\u606f\u662f\u4e13\u95e8\u7528\u4e8e\u8fdb\u884cframe\u63a7\u5236\u7684\u7ba1\u7406\u4fe1\u606f\uff0c \u4f46\u662f\u8fd9\u4e9b\u4fe1\u606f\u4e0d\u9700\u8981\u8bb0\u5f55\u5230\u78c1\u76d8\uff0c\u800c\u662f\u6839\u636e\u8bfb\u5165\u6570\u636e\u5757\u5728\u5185\u5b58\u4e2d\u7684\u72b6\u6001\u52a8\u6001\u751f\u6210\u7684\uff0c \u4e3b\u8981\u5305\u62ec\uff1a</p> <ol> <li>\u9875\u9762\u7ba1\u7406\u7684\u666e\u901a\u4fe1\u606f\uff0c\u4e92\u65a5\u9501\uff0c \u9875\u9762\u7684\u72b6\u6001\u7b49</li> <li>\u810f\u56de\u5199(flush)\u7ba1\u7406\u4fe1\u606f</li> <li>lru\u63a7\u5236\u4fe1\u606f</li> <li>\u5feb\u901f\u67e5\u627e\u7684\u7ba1\u7406\u4fe1\u606f\uff0c \u4e3a\u4e86\u4fbf\u4e8e\u5feb\u901f\u7684\u8d85\u627e\u67d0\u4e00\u4e2ablock\u6216frame\uff0c \u7f13\u51b2\u533a\u91cc\u9762\u7684block\u88ab\u7ec4\u7ec7\u5230\u4e00\u4e9bhash\u8868\u4e2d; \u7f13\u51b2\u533a\u4e2d\u7684block\u6570\u91cf\u662f\u4e00\u5b9a\u7684\uff0c innodb\u7f13\u51b2\u533a\u5bf9\u6240\u7ba1\u7406\u7684block\u7528lru(last recently used)\u7b56\u7565\u8fdb\u884c\u66ff\u6362\u3002</li> </ol> <p>2.9 Buffer Pool\u5206\u914d\u65b9\u5f0f</p> <p>MySQL\u4f7f\u7528mmap\u5206\u914dBuffer Pool\uff0c\u4f46\u662f\u90fd\u662f\u865a\u5b58\uff0c\u5728top\u547d\u4ee4\u4e2d\u5360\u7528VIRT\u8fd9\u4e00\u5217\uff0c\u800c\u4e0d\u662fRES\u8fd9\u4e00\u5217\uff0c\u53ea\u6709\u76f8\u5e94\u7684\u5185\u5b58\u88ab\u771f\u6b63\u4f7f\u7528\u5230\u4e86\uff0c\u624d\u4f1a\u88ab\u7edf\u8ba1\u5230RES\u4e2d\uff0c\u4ece\u800c\u63d0\u9ad8\u5185\u5b58\u4f7f\u7528\u7387\u3002\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u5e38\u5e38\u770b\u5230MySQL\u4e00\u542f\u52a8\u5c31\u88ab\u5206\u914d\u4e86\u5f88\u591a\u7684VIRT\uff0c\u800cRES\u5374\u662f\u6162\u6162\u6da8\u4e0a\u6765\u7684\u539f\u56e0\u3002\u8fd9\u91cc\u5927\u5bb6\u53ef\u80fd\u6709\u4e2a\u7591\u95ee\uff0c\u4e3a\u5565\u4e0d\u7528malloc\u3002\u5176\u5b9e\u67e5\u9605malloc\u6587\u6863\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0c\u5f53\u8bf7\u6c42\u7684\u5185\u5b58\u6570\u91cf\u5927\u4e8eMMAP_THRESHOLD(\u9ed8\u8ba4\u4e3a128KB)\u65f6\u5019\uff0cmalloc\u5e95\u5c42\u5c31\u662f\u8c03\u7528\u4e86mmap\u3002\u5728InnoDB\u4e2d\uff0c\u9ed8\u8ba4\u4f7f\u7528mmap\u6765\u5206\u914d\u3002 \u5206\u914d\u5b8c\u4e86\u5185\u5b58\uff0cbuf_chunk_init\u51fd\u6570\u4e2d\uff0c\u628a\u8fd9\u7247\u5185\u5b58\u5212\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff0c\u524d\u4e00\u90e8\u5206\u662f\u6570\u636e\u9875\u63a7\u5236\u4f53(buf_block_t)\uff0c\u540e\u4e00\u90e8\u5206\u662f\u771f\u6b63\u7684\u6570\u636e\u9875\uff0c\u6309\u7167UNIV_PAGE_SIZE\u5206\u9694\u3002\u5047\u8bbepage\u5927\u5c0f\u4e3a16KB\uff0c\u5219\u6570\u636e\u9875\u63a7\u5236\u4f53\u5360\u7684\u5185\u5b58:\u6570\u636e\u9875\u7ea6\u7b49\u4e8e1:38.6\uff0c\u4e5f\u5c31\u662f\u8bf4\u5982\u679cinnodb_buffer_pool_size\u88ab\u914d\u7f6e\u4e3a40G\uff0c\u5219\u9700\u8981\u989d\u5916\u76841G\u591a\u7a7a\u95f4\u6765\u5b58\u6570\u636e\u9875\u7684\u63a7\u5236\u4f53\u3002 \u5212\u5206\u5b8c\u7a7a\u95f4\u540e\uff0c\u904d\u5386\u6570\u636e\u9875\u63a7\u5236\u4f53\uff0c\u8bbe\u7f6ebuf_block_t::frame\u6307\u9488\uff0c\u6307\u5411\u771f\u6b63\u7684\u6570\u636e\u9875\uff0c\u7136\u540e\u628a\u8fd9\u4e9b\u6570\u636e\u9875\u52a0\u5165\u5230Free List\u4e2d\u5373\u53ef\u3002\u521d\u59cb\u5316\u5b8cBuffer Chunks\u7684\u5185\u5b58\uff0c\u8fd8\u9700\u8981\u521d\u59cb\u5316BUF_BLOCK_POOL_WATCH\u7c7b\u578b\u7684\u6570\u636e\u9875\u63a7\u5236\u5757\uff0cpage hash\u7684\u7ed3\u6784\u4f53\uff0czip hash\u7684\u7ed3\u6784\u4f53(\u6240\u6709\u88ab\u538b\u7f29\u9875\u7684\u4f19\u4f34\u7cfb\u7edf\u5206\u914d\u8d70\u7684\u6570\u636e\u9875\u9762\u4f1a\u52a0\u5165\u5230\u8fd9\u4e2a\u54c8\u5e0c\u8868\u4e2d)\u3002\u6ce8\u610f\u8fd9\u4e9b\u5185\u5b58\u662f\u989d\u5916\u5206\u914d\u7684\uff0c\u4e0d\u5305\u542b\u5728Buffer Chunks\u4e2d\u3002</p> <p>2.10 \u4e92\u65a5\u8bbf\u95ee</p> <p>\u7f13\u51b2\u6c60\u7684\u6574\u4e2a\u7f13\u51b2\u533a\u4e00\u4e2a\u6570\u636e\u7ed3\u6784buf_pool\u8fdb\u884c\u7ba1\u7406\u548c\u63a7\u5236\uff0c \u4e00\u4e2a\u4e13\u95e8\u7684mutex\u4fdd\u62a4\u7740\uff0c \u8fd9\u4e2amutex\u662f\u7528\u6765\u4fdd\u62a4buf_pool\u8fd9\u4e2a\u63a7\u5236\u7ed3\u6784\u4e2d\u7684\u6570\u636e\u57df\u7684\uff0c \u5e76\u4e0d\u4fdd\u62a4\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636eframe\u4ee5\u53ca\u7528\u4e8e\u7ba1\u7406\u7684block, \u7f13\u51b2\u533a\u91ccblock\u6216\u8005frame\u4e2d\u7684\u8bbf\u95ee\u662f\u7531\u4e13\u95e8\u7684\u8bfb\u5199\u9501\u6765\u4fdd\u62a4\u7684\uff0c \u6bcf\u4e2ablock/frame\u4e00\u4e2a\u3002\u57285.1\u4ee5\u524d\uff0c \u6bcf\u4e2ablock\u662f\u6ca1\u4e13\u95e8\u7684mutex\u4fdd\u62a4\u7684\uff0c\u5982\u679c\u9700\u8981\u8fdb\u884c\u4e92\u65a5\u4fdd\u62a4\uff0c\u76f4\u63a5\u4f7f\u7528\u7f13\u51b2\u533a\u7684mutex, \u7ed3\u679c\u5bfc\u81f4\u5f88\u9ad8\u7684\u4e89\u7528\uff1b 5.1\u4ee5\u540e\uff0c\u6bcf\u4e2ablock\u4e00\u4e2amutex\u5bf9\u5176\u8fdb\u884c\u4fdd\u62a4\uff0c \u4ece\u800c\u5728\u5f88\u5927\u7a0b\u5ea6\u4e0a\u89e3\u7f13\u4e86\u5bf9buf_pool\u7684mutex\u7684\u4e89\u7528\u3002</p>"},{"location":"buffer-pool/#buffer-pool_1","title":"\u4e09\u3001 Buffer Pool \u5b58\u50a8\u5185\u5bb9","text":"<p>BUffer Pool\u4e2d\u7f13\u5b58\u7684\u6570\u636e\u9875\u7c7b\u578b\u6709: \u7d22\u5f15\u9875\u3001\u6570\u636e\u9875\u3001undo\u9875\u3001\u63d2\u5165\u7f13\u51b2\uff08insert buffer)\u3001\u81ea\u9002\u5e94\u54c8\u5e0c\u7d22\u5f15\uff08adaptive hash index)\u3001InnoDB\u5b58\u50a8\u7684\u9501\u4fe1\u606f\uff08lock info)\u3001\u6570\u636e\u5b57\u5178\u4fe1\u606f\uff08data dictionary)\u7b49\u3002</p>"},{"location":"buffer-pool/#buffer-pool_2","title":"\u56db\u3001Buffer Pool \u6570\u636e\u52a0\u8f7d","text":"<p>4.1 Buffer Pool\u9884\u70ed</p> <p>MySQL\u5728\u91cd\u542f\u540e\uff0cBuffer Pool\u91cc\u9762\u6ca1\u6709\u4ec0\u4e48\u6570\u636e\uff0c\u8fd9\u4e2a\u65f6\u5019\u4e1a\u52a1\u4e0a\u5bf9\u6570\u636e\u5e93\u7684\u6570\u636e\u64cd\u4f5c\uff0cMySQL\u5c31\u53ea\u80fd\u4ece\u78c1\u76d8\u4e2d\u8bfb\u53d6\u6570\u636e\u5230\u5185\u5b58\u4e2d\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53ef\u80fd\u9700\u8981\u5f88\u4e45\u624d\u80fd\u662f\u5185\u5b58\u4e2d\u7684\u6570\u636e\u662f\u4e1a\u52a1\u9891\u7e41\u4f7f\u7528\u7684\u3002Buffer Pool\u4e2d\u6570\u636e\u4ece\u65e0\u5230\u4e1a\u52a1\u9891\u7e41\u4f7f\u7528\u70ed\u6570\u636e\u7684\u8fc7\u7a0b\u79f0\u4e4b\u4e3a\u9884\u70ed\u3002\u6240\u4ee5\u5728\u9884\u70ed\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0cMySQL\u6570\u636e\u5e93\u7684\u6027\u80fd\u4e0d\u4f1a\u7279\u522b\u597d\uff0c\u5e76\u4e14Buffer Pool\u8d8a\u5927\uff0c\u9884\u70ed\u8fc7\u7a0b\u8d8a\u957f\u3002</p> <p>\u4e3a\u4e86\u51cf\u77ed\u8fd9\u4e2a\u9884\u70ed\u8fc7\u7a0b\uff0c\u5728MySQL\u5173\u95ed\u524d\uff0c\u628aBuffer Pool\u4e2d\u7684\u9875\u9762\u4fe1\u606f\u4fdd\u5b58\u5230\u78c1\u76d8\uff0c\u7b49\u5230MySQL\u542f\u52a8\u65f6\uff0c\u518d\u6839\u636e\u4e4b\u524d\u4fdd\u5b58\u7684\u4fe1\u606f\u628a\u78c1\u76d8\u4e2d\u7684\u6570\u636e\u52a0\u8f7d\u5230Buffer Pool\u4e2d\u5373\u53ef\u3002</p> <p>4.1.1 Buffer Pool Dump</p> <p>\u904d\u5386\u6240\u6709Buffer Pool Instance\u7684LRU List\uff0c\u5bf9\u4e8e\u5176\u4e2d\u7684\u6bcf\u4e2a\u6570\u636e\u9875\uff0c\u6309\u7167space_id\u548cpage_no\u7ec4\u6210\u4e00\u4e2a64\u4f4d\u7684\u6570\u5b57\uff0c\u5199\u5230\u5916\u90e8\u6587\u4ef6\u4e2d</p> <p>4.1.2 Buffer Pool Load</p> <p>\u8bfb\u53d6\u6307\u5b9a\u7684\u5916\u90e8\u6587\u4ef6\uff0c\u628a\u6240\u6709\u7684\u6570\u636e\u8bfb\u5165\u5185\u5b58\u540e\uff0c\u4f7f\u7528\u5f52\u5e76\u6392\u5e8f\u5bf9\u6570\u636e\u6392\u5e8f\uff0c\u4ee564\u4e2a\u6570\u636e\u9875\u4e3a\u5355\u4f4d\u8fdb\u884cIO\u5408\u5e76\uff0c\u7136\u540e\u53d1\u8d77\u4e00\u6b21\u771f\u6b63\u7684\u8bfb\u53d6\u64cd\u4f5c\u3002\u6392\u5e8f\u7684\u4f5c\u7528\u5c31\u662f\u4fbf\u4e8eIO\u5408\u5e76\u3002</p> <p>4.2 \u9884\u8bfb\u673a\u5236</p> <p>InnoDB\u5728I/O\u7684\u4f18\u5316\u4e0a\u6709\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u7279\u6027\u4e3a\u9884\u8bfb\uff0c\u9884\u8bfb\u8bf7\u6c42\u662f\u4e00\u4e2ai/o\u8bf7\u6c42\uff0c\u5b83\u4f1a\u5f02\u6b65\u5730\u5728\u7f13\u51b2\u6c60\u4e2d\u9884\u5148\u56de\u8fc1\u591a\u4e2a\u9875\u9762\uff0c\u9884\u8ba1\u5f88\u5feb\u5c31\u4f1a\u9700\u8981\u8fd9\u4e9b\u9875\u9762\uff0c\u8fd9\u4e9b\u8bf7\u6c42\u5728\u4e00\u4e2a\u8303\u56f4\u5185\u5f15\u5165\u6240\u6709\u9875\u9762\u3002InnoDB\u4ee564\u4e2apage\u4e3a\u4e00\u4e2aextent\uff0c\u90a3\u4e48InnoDB\u7684\u9884\u8bfb\u662f\u4ee5page\u4e3a\u5355\u4f4d\u8fd8\u662f\u4ee5extent\uff1f</p> <p></p> <p>\u6570\u636e\u5e93\u8bf7\u6c42\u6570\u636e\u7684\u65f6\u5019\uff0c\u4f1a\u5c06\u8bfb\u8bf7\u6c42\u4ea4\u7ed9\u6587\u4ef6\u7cfb\u7edf\uff0c\u653e\u5165\u8bf7\u6c42\u961f\u5217\u4e2d\uff1b\u76f8\u5173\u8fdb\u7a0b\u4ece\u8bf7\u6c42\u961f\u5217\u4e2d\u5c06\u8bfb\u8bf7\u6c42\u53d6\u51fa\uff0c\u6839\u636e\u9700\u6c42\u5230\u76f8\u5173\u6570\u636e\u533a(\u5185\u5b58\u3001\u78c1\u76d8)\u8bfb\u53d6\u6570\u636e\uff1b\u53d6\u51fa\u7684\u6570\u636e\uff0c\u653e\u5165\u54cd\u5e94\u961f\u5217\u4e2d\uff0c\u6700\u540e\u6570\u636e\u5e93\u5c31\u4f1a\u4ece\u54cd\u5e94\u961f\u5217\u4e2d\u5c06\u6570\u636e\u53d6\u8d70\uff0c\u5b8c\u6210\u4e00\u6b21\u6570\u636e\u8bfb\u64cd\u4f5c\u8fc7\u7a0b\u3002</p> <p>\u63a5\u7740\u8fdb\u7a0b\u7ee7\u7eed\u5904\u7406\u8bf7\u6c42\u961f\u5217\uff0c(\u5982\u679c\u6570\u636e\u5e93\u662f\u5168\u8868\u626b\u63cf\u7684\u8bdd\uff0c\u6570\u636e\u8bfb\u8bf7\u6c42\u5c06\u4f1a\u5360\u6ee1\u8bf7\u6c42\u961f\u5217)\uff0c\u5224\u65ad\u540e\u9762\u51e0\u4e2a\u6570\u636e\u8bfb\u8bf7\u6c42\u7684\u6570\u636e\u662f\u5426\u76f8\u90bb\uff0c\u518d\u6839\u636e\u81ea\u8eab\u7cfb\u7edfIO\u5e26\u5bbd\u5904\u7406\u91cf\uff0c \u8fdb\u884c\u9884\u8bfb\uff0c\u8fdb\u884c\u8bfb\u8bf7\u6c42\u7684\u5408\u5e76\u5904\u7406 \uff0c\u4e00\u6b21\u6027\u8bfb\u53d6\u591a\u5757\u6570\u636e\u653e\u5165\u54cd\u5e94\u961f\u5217\u4e2d\uff0c\u518d\u88ab\u6570\u636e\u5e93\u53d6\u8d70\u3002(\u5982\u6b64\uff0c\u4e00\u6b21\u7269\u7406\u8bfb\u64cd\u4f5c\uff0c\u5b9e\u73b0\u591a\u9875\u6570\u636e\u8bfb\u53d6\uff0crrqm&gt;0\uff08 # iostat -x \uff09\uff0c\u5047\u8bbe\u662f4\u4e2a\u8bfb\u8bf7\u6c42\u5408\u5e76\uff0c\u5219rrqm\u53c2\u6570\u663e\u793a\u7684\u5c31\u662f4)</p> <p>InnoDB\u4f7f\u7528\u4e24\u79cd\u9884\u8bfb\u7b97\u6cd5\u6765\u63d0\u9ad8I/O\u6027\u80fd\uff1a \u7ebf\u6027\u9884\u8bfb\uff08linear read-ahead\uff09\u548c\u968f\u673a\u9884\u8bfb\uff08randomread-ahead\uff09</p> <p>\u4e3a\u4e86\u533a\u5206\u8fd9\u4e24\u79cd\u9884\u8bfb\u7684\u65b9\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u7ebf\u6027\u9884\u8bfb\u4ee5extent\u4e3a\u5355\u4f4d\uff0c\u800c\u968f\u673a\u9884\u8bfb\u4ee5extent\u4e2d\u7684page\u4e3a\u5355\u4f4d\u3002\u7ebf\u6027\u9884\u8bfb\u7740\u773c\u4e8e\u5c06\u4e0b\u4e00\u4e2aextent\u63d0\u524d\u8bfb\u53d6\u5230buffer pool\u4e2d\uff0c\u800c\u968f\u673a\u9884\u8bfb\u7740\u773c\u4e8e\u5c06\u5f53\u524dextent\u4e2d\u7684\u5269\u4f59\u7684page\u63d0\u524d\u8bfb\u53d6\u5230buffer pool\u4e2d\u3002</p> <p>4.2.1 \u7ebf\u6027\u9884\u8bfb\uff08linear read-ahead\uff09</p> <p>\u7ebf\u6027\u9884\u8bfb\u65b9\u5f0f\u6709\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u53d8\u91cf\u63a7\u5236\u662f\u5426\u5c06\u4e0b\u4e00\u4e2aextent\u9884\u8bfb\u5230buffer pool\u4e2d\uff0c\u901a\u8fc7\u4f7f\u7528\u914d\u7f6e\u53c2\u6570 innodb_read_ahead_threshold \uff0c\u63a7\u5236\u89e6\u53d1innodb\u6267\u884c\u9884\u8bfb\u64cd\u4f5c\u7684\u65f6\u95f4\u3002</p> <p>\u5982\u679c\u4e00\u4e2aextent\u4e2d\u7684\u88ab\u987a\u5e8f\u8bfb\u53d6\u7684page\u8d85\u8fc7\u6216\u8005\u7b49\u4e8e\u8be5\u53c2\u6570\u53d8\u91cf\u65f6\uff0cInnodb\u5c06\u4f1a\u5f02\u6b65\u7684\u5c06\u4e0b\u4e00\u4e2aextent\u8bfb\u53d6\u5230buffer pool\u4e2d\uff0cinnodb_read_ahead_threshold\u53ef\u4ee5\u8bbe\u7f6e\u4e3a0-64\u7684\u4efb\u4f55\u503c(\u56e0\u4e3a\u4e00\u4e2aextent\u4e2d\u4e5f\u5c31\u53ea\u670964\u9875)\uff0c\u9ed8\u8ba4\u503c\u4e3a56\uff0c\u503c\u8d8a\u9ad8\uff0c\u8bbf\u95ee\u6a21\u5f0f\u68c0\u67e5\u8d8a\u4e25\u683c\u3002</p> <pre><code>mysql&gt; show variables like 'innodb_read_ahead_threshold';\n+-----------------------------+-------+\n| Variable_name               | Value |\n+-----------------------------+-------+\n| innodb_read_ahead_threshold | 56    |\n+-----------------------------+-------+\n</code></pre> <p>\u4f8b\u5982 \uff0c\u5982\u679c\u5c06\u503c\u8bbe\u7f6e\u4e3a48\uff0c\u5219InnoDB\u53ea\u6709\u5728\u987a\u5e8f\u8bbf\u95ee\u5f53\u524dextent\u4e2d\u768448\u4e2apages\u65f6\u624d\u89e6\u53d1\u7ebf\u6027\u9884\u8bfb\u8bf7\u6c42\uff0c\u5c06\u4e0b\u4e00\u4e2aextent\u8bfb\u5230\u5185\u5b58\u4e2d\u3002\u5982\u679c\u503c\u4e3a8\uff0cInnoDB\u89e6\u53d1\u5f02\u6b65\u9884\u8bfb\uff0c\u5373\u4f7f\u7a0b\u5e8f\u6bb5\u4e2d\u53ea\u67098\u9875\u88ab\u987a\u5e8f\u8bbf\u95ee\u3002</p> <p>\u53ef\u4ee5\u5728MySQL\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u6b64\u53c2\u6570\u7684\u503c\uff0c\u6216\u8005\u4f7f\u7528SET GLOBAL\u9700\u8981\u8be5SUPER\u6743\u9650\u7684\u547d\u4ee4\u52a8\u6001\u66f4\u6539\u8be5\u53c2\u6570\u3002</p> <p>\u5728\u6ca1\u6709\u8be5\u53d8\u91cf\u4e4b\u524d\uff0c\u5f53\u8bbf\u95ee\u5230extent\u7684\u6700\u540e\u4e00\u4e2apage\u7684\u65f6\u5019\uff0cinnodb\u4f1a\u51b3\u5b9a\u662f\u5426\u5c06\u4e0b\u4e00\u4e2aextent\u653e\u5165\u5230buffer pool\u4e2d\u3002</p> <p>4.2.2 \u968f\u673a\u9884\u8bfb\uff08randomread-ahead\uff09 \u968f\u673a\u9884\u8bfb\u65b9\u5f0f\u5219\u662f\u8868\u793a\u5f53\u540c\u4e00\u4e2aextent\u4e2d\u7684\u4e00\u4e9bpage\u5728buffer pool\u4e2d\u53d1\u73b0\u65f6\uff0cInnodb\u4f1a\u5c06\u8be5extent\u4e2d\u7684\u5269\u4f59page\u4e00\u5e76\u8bfb\u5230buffer pool\u4e2d\u3002</p> <pre><code>mysql&gt; show variables like 'innodb_random_read_ahead';\n+--------------------------+-------+\n| Variable_name            | Value |\n+--------------------------+-------+\n| innodb_random_read_ahead | OFF   |\n+--------------------------+-------+\n</code></pre> <p>\u7531\u4e8e\u968f\u673a\u9884\u8bfb\u65b9\u5f0f\u7ed9innodb code\u5e26\u6765\u4e86\u4e00\u4e9b\u4e0d\u5fc5\u8981\u7684\u590d\u6742\u6027\uff0c\u540c\u65f6\u5728\u6027\u80fd\u4e5f\u5b58\u5728\u4e0d\u7a33\u5b9a\u6027\uff0c\u57285.5\u4e2d\u5df2\u7ecf\u5c06\u8fd9\u79cd\u9884\u8bfb\u65b9\u5f0f \u5e9f\u5f03\uff0c\u9ed8\u8ba4\u662fOFF \u3002\u82e5\u8981\u542f\u7528\u6b64\u529f\u80fd\uff0c\u5373\u5c06\u914d\u7f6e\u53d8\u91cf\u8bbe\u7f6einnodb_random_read_ahead\u4e3aON\u3002</p> <p>4.2.3 \u76d1\u63a7Innodb\u7684\u9884\u8bfb</p> <ol> <li>\u53ef\u4ee5\u901a\u8fc7show engine innodb status\\G\u663e\u793a\u7edf\u8ba1\u4fe1\u606f</li> </ol> <pre><code>mysql&gt; show engine innodb status\\G\n----------------------\nBUFFER POOL AND MEMORY\n----------------------\n\u2026\u2026\nPages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s\n\u2026\u2026\n</code></pre> <ul> <li>Pages read ahead\uff1a\u8868\u793a\u6bcf\u79d2\u8bfb\u5165\u7684pages\uff1b</li> <li>evicted without access\uff1a\u8868\u793a\u6bcf\u79d2\u8bfb\u51fa\u7684pages\uff1b</li> <li> <p>\u4e00\u822c\u968f\u673a\u9884\u8bfb\u90fd\u662f\u5173\u95ed\u7684\uff0c\u4e5f\u5c31\u662f0\u3002</p> </li> <li> <p>\u901a\u8fc7\u4e24\u4e2a\u72b6\u6001\u503c\uff0c\u8bc4\u4f30\u9884\u8bfb\u7b97\u6cd5\u7684\u6709\u6548\u6027</p> </li> </ul> <pre><code>mysql&gt; show global status like '%read_ahead%';\n+---------------------------------------+-------+\n| Variable_name                         | Value |\n+---------------------------------------+-------+\n| Innodb_buffer_pool_read_ahead_rnd     | 0     |\n| Innodb_buffer_pool_read_ahead         | 2303  |\n| Innodb_buffer_pool_read_ahead_evicted | 0     |\n+---------------------------------------+-------+\n3 rows in set (0.01 sec)\n</code></pre> <ul> <li>Innodb_buffer_pool_read_ahead\uff1a\u901a\u8fc7\u9884\u8bfb(\u540e\u53f0\u7ebf\u7a0b)\u8bfb\u5165innodb buffer pool\u4e2d\u6570\u636e\u9875\u6570</li> <li>Innodb_buffer_pool_read_ahead_evicted\uff1a\u901a\u8fc7\u9884\u8bfb\u6765\u7684\u6570\u636e\u9875\u6ca1\u6709\u88ab\u67e5\u8be2\u8bbf\u95ee\u5c31\u88ab\u6e05\u7406\u7684pages\uff0c\u65e0\u6548\u9884\u8bfb\u9875\u6570</li> </ul>"},{"location":"buffer-pool/#innodb-buffer-pool_1","title":"\u4e94\u3001Innodb \u5982\u4f55\u7ba1\u7406Buffer Pool","text":"<p>5.1 Buffer Pool\u7684\u5de5\u4f5c\u673a\u5236</p> <p>buffer pool\u4e24\u4e2a\u6700\u4e3b\u8981\u7684\u529f\u80fd\uff1a\u4e00\u4e2a\u662f\u52a0\u901f\u8bfb\uff0c\u4e00\u4e2a\u662f\u52a0\u901f\u5199\u3002\u52a0\u901f\u8bfb\u5462\uff1f \u5c31\u662f\u5f53\u9700\u8981\u8bbf\u95ee\u4e00\u4e2a\u6570\u636e\u9875\u9762\u7684\u65f6\u5019\uff0c\u5982\u679c\u8fd9\u4e2a\u9875\u9762\u5df2\u7ecf\u5728\u7f13\u5b58\u6c60\u4e2d\uff0c\u90a3\u4e48\u5c31\u4e0d\u518d\u9700\u8981\u8bbf\u95ee\u78c1\u76d8\uff0c\u76f4\u63a5\u4ece\u7f13\u51b2\u6c60\u4e2d\u5c31\u80fd\u83b7\u53d6\u8fd9\u4e2a\u9875\u9762\u7684\u5185\u5bb9\u3002\u52a0\u901f\u5199\u5462\uff1f\u5c31\u662f\u5f53\u9700\u8981\u4fee\u6539\u4e00\u4e2a\u9875\u9762\u7684\u65f6\u5019\uff0c\u5148\u5c06\u8fd9\u4e2a\u9875\u9762\u5728\u7f13\u51b2\u6c60\u4e2d\u8fdb\u884c\u4fee\u6539\uff0c\u8bb0\u4e0b\u76f8\u5173\u7684\u91cd\u505a\u65e5\u5fd7\uff0c\u8fd9\u4e2a\u9875\u9762\u7684\u4fee\u6539\u5c31\u7b97\u5df2\u7ecf\u5b8c\u6210\u4e86\u3002\u81f3\u4e8e\u8fd9\u4e2a\u88ab\u4fee\u6539\u7684\u9875\u9762\u4ec0\u4e48\u65f6\u5019\u771f\u6b63\u5237\u65b0\u5230\u78c1\u76d8\uff0c\u8fd9\u4e2a\u662fbuffer pool\u540e\u53f0\u5237\u65b0\u7ebf\u7a0b\u6765\u5b8c\u6210\u7684\u3002</p> <p>\u5728\u5b9e\u73b0\u4e0a\u9762\u4e24\u4e2a\u529f\u80fd\u7684\u540c\u65f6\uff0c\u9700\u8981\u8003\u8651\u5ba2\u89c2\u6761\u4ef6\u7684\u9650\u5236\uff0c\u56e0\u4e3a\u673a\u5668\u7684\u5185\u5b58\u5927\u5c0f\u662f\u6709\u9650\u7684\uff0c\u6240\u4ee5MySQL\u7684innodb buffer pool\u7684\u5927\u5c0f\u540c\u6837\u662f\u6709\u9650\u7684\u3002\u5728\u901a\u5e38\u7684\u60c5\u51b5\u4e0b\uff0c\u5f53\u6570\u636e\u5e93\u7684\u6570\u636e\u91cf\u6bd4\u8f83\u5927\u7684\u65f6\u5019\uff0c\u7f13\u5b58\u6c60\u5e76\u4e0d\u80fd\u7f13\u5b58\u6240\u6709\u7684\u6570\u636e\u9875\uff0c\u6240\u4ee5\u4e5f\u5c31\u53ef\u80fd\u4f1a\u51fa\u73b0\uff0c\u5f53\u9700\u8981\u8bbf\u95ee\u7684\u67d0\u4e2a\u9875\u9762\u65f6\uff0c\u8be5\u9875\u9762\u5374\u4e0d\u5728\u7f13\u5b58\u6c60\u4e2d\u7684\u60c5\u51b5\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u4ece\u78c1\u76d8\u4e2d\u5c06\u8fd9\u4e2a\u9875\u9762\u8bfb\u51fa\u6765\uff0c\u52a0\u8f7d\u5230\u7f13\u5b58\u6c60\u4e2d\uff0c\u7136\u540e\u518d\u53bb\u8bbf\u95ee\u3002\u8fd9\u6837\u5c31\u6d89\u53ca\u5230\u968f\u673a\u7684\u7269\u7406io\uff0c\u4e5f\u5c31\u5ef6\u957f\u4e86\u8bbf\u95ee\u9875\u9762\u6240\u6d88\u8017\u7684\u65f6\u95f4\u3002</p> <p>\u8fd9\u6837\u7684\u60c5\u51b5\u662f\u4e00\u4e2abad case\uff0c\u662f\u6211\u4eec\u671f\u671b\u5c3d\u91cf\u907f\u514d\u7684\u2014\u2014\u56e0\u6b64\u9700\u8981\u60f3\u529e\u6cd5\u6765\u63d0\u9ad8\u7f13\u5b58\u7684\u547d\u4e2d\u7387\u3002 innodb buffer pool\u91c7\u7528\u7ecf\u5178\u7684LRU\u5217\u8868\u7b97\u6cd5\u6765\u8fdb\u884c\u9875\u9762\u6dd8\u6c70\uff0c\u4ee5\u63d0\u9ad8\u7f13\u5b58\u547d\u4e2d\u7387\u3002\u5c06\u7f13\u5b58\u7684\u9875\u9762\u6309\u7167\u6700\u8fd1\u4f7f\u7528\u7684\u6b21\u6570\u8ddf\u65f6\u95f4\u8fdb\u884c\u6392\u5e8f\uff0c\u961f\u5217\u6700\u672b\u5c3e\u7684\u9875\u9762\u5c06\u4f1a\u6700\u5148\u88ab\u6dd8\u6c70\u3002\u540c\u65f6\uff0c\u5728LRU\u5217\u8868\u7684\u4e2d\u95f4\u4f4d\u7f6e\u6253\u4e86\u4e00\u4e2aold\u6807\u8bc6\uff0c\u53ef\u4ee5\u7b80\u5355\u7684\u7406\u89e3\u4e3a\u5c06LRU\u5217\u8868\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff0c\u8fd9\u4e2a\u6807\u8bb0\u5230LRU\u5217\u8868\u5934\u90e8\u7684\u9875\u9762\u79f0\u4e4b\u4e3ayoung\u7684\u9875\u9762\uff0c\u8fd9\u4e2a\u6807\u5fd7\u5230LRU\u5217\u8868\u5c3e\u90e8\u7684\u9875\u9762\u79f0\u4e4b\u4e3aold\u9875\u9762\u3002\u518d\u8fdb\u884c\u62bd\u8c61\u7684\u8bdd\uff0c\u6211\u4eec\u7b80\u5355\u5730\u7406\u89e3\u4e3a\u7f13\u5b58\u6c60\u88ab\u5206\u6210\u4e24\u4e2a\u6c60\u5b50\uff0c\u4e00\u4e2a\u53ebyoung\u6c60\u5b50\uff0c\u4e00\u4e2a\u53ebold\u6c60\u5b50\u3002\u5f53\u4e00\u4e2a\u9875\u9762\u4ece\u78c1\u76d8\u4e0a\u52a0\u8f7d\u7f13\u5b58\u6c60\u4e2d\u7684\u65f6\u5019\uff0c\u4f1a\u5c06\u5b83\u6392\u653e\u5728\u8fd9\u4e2aold\u6807\u8bc6\u4e4b\u540e\u7684\u7b2c\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u4e5f\u5c31\u662f\u8bf4\u653e\u5728\u4e86old\u6c60\u5b50\u4e2d\u3002\u8fd9\u4e2a\u673a\u5236\u7684\u4f5c\u7528\u5c31\u662f\uff0c\u5728\u505a\u5927\u8868\u7684\u4e00\u6b21\u6027\u5168\u8868\u626b\u63cf\u7684\u65f6\u5019\uff0c\u5927\u91cf\u65b0\u8fdb\u6765\u7684\u9875\u9762\uff0c\u662f\u5b58\u653e\u5728old\u6c60\u5b50\u4e2d\u7684\uff0c\u5f53old\u6c60\u5b50\u7684\u5927\u5c0f\u4e0d\u591f\u7f13\u5b58\u65b0\u8fdb\u6765\u7684\u9875\u9762\u7684\u65f6\u5019\uff0c\u4e5f\u53ea\u662f\u5728old\u6c60\u5b50\u4e2d\u5185\u90e8\u8fdb\u884c\u5faa\u73af\u51b2\u6d17\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u51b2\u6d17young\u6c60\u5b50\u4e2d\u7684\u70ed\u70b9\u9875\u9762\uff0c\u4ece\u800c\u4fdd\u62a4\u4e86\u70ed\u70b9\u9875\u9762\u3002\u8fd9\u5c31\u662fLRU\u5217\u8868\u7684\u7b80\u5355\u673a\u5236\u3002</p> <p>\u53e6\u5916\uff0c\u524d\u9762\u6211\u4eec\u8bb2\u5230\u9875\u9762\u66f4\u65b0\u662f\u5728\u7f13\u5b58\u6c60\u4e2d\u5148\u8fdb\u884c\u7684\uff0c\u6240\u4ee5\u9700\u8981\u8003\u8651\u8fd9\u4e9b\u88ab\u4fee\u6539\u7684\u9875\u9762\u4ec0\u4e48\u65f6\u5019\u5237\u65b0\u5230\u78c1\u76d8\uff1f\u4ee5\u4ec0\u4e48\u6837\u7684\u987a\u5e8f\u5237\u65b0\u5230\u78c1\u76d8\uff1f\u5728innodb buffer pool\u4e2d\uff0c\u91c7\u7528\u7684\u65b9\u5f0f\u662f\u5c06\u9875\u9762\u5728\u7f13\u5b58\u4e2d\u7684\u6309\u7167\u7b2c\u4e00\u6b21\u4fee\u6539\u65f6\u95f4\uff0c\u4e5f\u5c31\u662f\u53d8\u6210\u810f\u9875\u7684\u65f6\u95f4\u8fdb\u884c\u6392\u5e8f\uff0cflush\u5217\u8868\u8fdb\u884c\u6392\u5e8f\uff0c\u7531\u540e\u53f0\u5237\u65b0\u7ebf\u7a0b\u4f9d\u6b21\u5237\u65b0\u5230\u78c1\u76d8\uff0c\u5b9e\u73b0\u4fee\u6539\u843d\u5730\u5230\u78c1\u76d8\u3002</p> <p>\u7b80\u5355\u4ecb\u7ecd\u4e86buffer pool\u7684\u5de5\u4f5c\u673a\u5236\uff0c\u6211\u4eec\u73b0\u5728\u6765\u770bbuffer pool\u91cc\u9762\u6700\u91cd\u8981\u7684\u51e0\u4e2a\u5217\u8868\uff0c\u524d\u9762\u5df2\u7ecf\u8bb2\u4e86\u4e24\u4e2a\u5217\u8868\uff0cLRU\u5217\u8868\u4ee5\u53caflush\u5217\u8868\uff0c\u4e5f\u5c31\u662f\u810f\u9875\u5237\u65b0\u5217\u8868\u3002\u73b0\u5728\u518d\u8865\u5145\u4e00\u4e2a\u5217\u8868\u2014\u7a7a\u95f2\uff08free\uff09\u5217\u8868\u3002\u7a7a\u95f2\u5217\u8868\u4e2d\u7684\u5185\u5b58\u5757\uff0c\u662f\u6ca1\u6709\u5b58\u653e\u4efb\u4f55\u6570\u636e\u9875\u7684\u5185\u5b58\u5757\u3002\u5f53\u6ca1\u6709\u5728\u7f13\u5b58\u6c60\u4e2d\u7684\u9875\u9762\u9700\u8981\u88ab\u8bbf\u95ee\u65f6\uff0c\u5b83\u9700\u8981\u5148\u88ab\u52a0\u8f7d\u5230\u7f13\u5b58\u6c60\u4e2d\uff0c\u4ece\u800c\u9700\u8981\u4ece\u7a7a\u95f2\u5217\u8868\u4e2d\u53d6\u51fa\u4e00\u4e2a\u7a7a\u95f2\u5185\u5b58\u5757\u6765\u7f13\u5b58\u8fd9\u4e2a\u9875\u9762\u3002</p> <p>\u6240\u4ee5\uff0c\u603b\u7ed3\u4e00\u4e0b\u3002\u4e3a\u4e86\u7ba1\u7406buffer pool\uff0c\u6bcf\u4e2abuffer pool instance\u4f7f\u7528\u5982\u4e0b\u51e0\u4e2a\u94fe\u8868\u6765\u7ba1\u7406\uff1a</p> <ul> <li>lru\u94fe\u8868\uff1a\u7f13\u5b58\u4e86\u6240\u6709\u8bfb\u5165\u5185\u5b58\u7684\u6570\u636e\u9875\uff0c\u5305\u542b\u4e09\u7c7b</li> <li>1\uff09\u672a\u4fee\u6539\u7684\u9875\u9762\uff0c\u53ef\u4ee5\u4ece\u8be5\u5217\u8868\u4e2d\u6458\u9664\uff0c\u7136\u540e\u79fb\u5230free\u5217\u8868\u4e2d\u3002</li> <li>2\uff09\u5df2\u4fee\u6539\u8fd8\u672a\u5237\u65b0\u5230\u78c1\u76d8\u7684\u9875\u9762\u3002</li> <li> <p>3\uff09\u5df2\u4fee\u6539\u4e14\u5df2\u7ecf\u5237\u65b0\u5230\u78c1\u76d8\u7684\u9875\u9762\uff0c\u53ef\u5e76\u4e3a\u7b2c\u4e00\u7c7b\u3002</p> </li> <li> <p>free\u94fe\u8868\uff1a\u7a7a\u95f2\u5185\u5b58\u9875\uff08\u5757\uff09\u5217\u8868\uff0c\u9700\u8981\u88c5\u8f7d\uff08\u7f13\u5b58\uff09\u78c1\u76d8\u4e0a\u7684\u6570\u636e\u9875\u7684\u65f6\u5019\uff0c\u4ece\u6b64\u5217\u8868\u53d6\u5185\u5b58\u5757\u3002</p> </li> <li>flush\u94fe\u8868\uff1a\u5728\u5185\u5b58\u4e2d\u88ab\u4fee\u6539\u4f46\u8fd8\u6ca1\u6709\u5237\u65b0\u5230\u78c1\u76d8\u7684\u6570\u636e\u9875\u5217\u8868\uff0c\u5c31\u662f\u6240\u8c13\u7684\u810f\u9875\u5217\u8868\uff0c\u5185\u5b58\u4e2d\u7684\u6570\u636e\u8ddf\u5bf9\u5e94\u7684\u78c1\u76d8\u4e0a\u7684\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u5c5e\u4e8e\u8be5\u5217\u8868\u7684\u9875\u9762\u540c\u6837\u5b58\u5728\u4e8elru\u5217\u8868\u4e2d\uff0c\u4f46\u53cd\u4e4b\u672a\u5fc5\u3002</li> <li>unzip_lru\u94fe\u8868\uff1a\u5305\u542b\u6240\u6709\u89e3\u538b\u9875\u3002</li> </ul> <p>5.2 LRU\uff08least recently used\uff09</p> <p>InnoDB\u7ba1\u7406buffer poll\u662f\u5c06buffer pool\u4f5c\u4e3a\u4e00\u4e2alist\u7ba1\u7406\uff0c\u57fa\u4e8eLRU\u7b97\u6cd5\u7684\u7ba1\u7406\u3002\u5f53\u6709\u65b0\u7684\u9875\u4fe1\u606f\u8981\u8bfb\u5165\u5230buffer pool\u91cc\u9762\u7684\u65f6\u5019\uff0cbuffer pool\u5c31\u5c06\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u9875\u4fe1\u606f\u4ecebuffer pool\u5f53\u4e2d\u9a71\u9010\u51fa\u53bb\uff0c\u5e76\u4e14\u5c06\u65b0\u9875\u52a0\u5165\u5230list\u7684\u4e2d\u95f4\u4f4d\u7f6e\uff0c\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u201c\u4e2d\u70b9\u63d2\u5165\u7b56\u7565\u201d\u3002\u4e00\u822c\u60c5\u51b5\u4e0blist\u5934\u90e8\u5b58\u653e\u7684\u662f\u70ed\u6570\u636e\uff0c\u5c31\u662f\u6240\u8c13\u7684young page\uff08\u6700\u8fd1\u7ecf\u5e38\u8bbf\u95ee\u7684\u6570\u636e\uff09\uff0clist\u5c3e\u90e8\u5b58\u653e\u7684\u5c31\u662fold page\uff08\u6700\u8fd1\u4e0d\u88ab\u8bbf\u95ee\u7684\u6570\u636e\uff09\u3002\u8fd9\u4e2a\u7b97\u6cd5\u5c31\u4fdd\u8bc1\u4e86\u6700\u8fd1\u7ecf\u5e38\u4f7f\u7528\u7684page\u4fe1\u606f\u4f1a\u88ab\u4fdd\u5b58\u5728\u6700\u8fd1\u8bbf\u95ee\u7684sublist\u4e2d\uff0c\u76f8\u53cd\u7684\u4e0d\u88ab\u7ecf\u5e38\u8bbf\u95ee\u7684\u5c31\u4f1a\u4fdd\u5b58\u5728old sublist\uff0c\u800cold sublist\u5f53\u4e2d\u7684page\u4fe1\u606f\u90fd\u662f\u4f1a\u88ab\u5728\u65b0\u6570\u636e\u5199\u5165\u7684\u65f6\u5019\u88ab\u9a71\u9010\u7684\u3002</p> <p>LRU\u7b97\u6cd5\u6709\u4ee5\u4e0b\u7684\u6807\u51c6\u7b97\u6cd5\uff1a1\uff093/8\u7684list\u4fe1\u606f\u662f\u4f5c\u4e3aold list\uff0c\u8fd9\u4e9b\u4fe1\u606f\u662f\u88ab\u9a71\u9010\u7684\u5bf9\u8c61\u30022\uff09list\u7684\u4e2d\u70b9\u5c31\u662f\u6211\u4eec\u6240\u8c13\u7684old list\u5934\u90e8\u548cnew list\u5c3e\u90e8\u7684\u8fde\u63a5\u70b9\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u754c\u9650\u30023\uff09\u65b0\u6570\u636e\u7684\u8bfb\u5165\u9996\u5148\u4f1a\u63d2\u5165\u5230old list\u7684\u5934\u90e8\u30024\uff09\u5982\u679c\u662fold list\u7684\u6570\u636e\u88ab\u8bbf\u95ee\u5230\u4e86\uff0c\u8fd9\u4e2a\u9875\u4fe1\u606f\u5c31\u4f1a\u53d8\u6210new list\uff0c\u53d8\u6210young page\uff0c\u5c31\u4f1a\u5c06\u6570\u636e\u9875\u4fe1\u606f\u79fb\u52a8\u5230new sublist\u7684\u5934\u90e8\u30025\uff09\u5728\u6570\u636e\u5e93\u7684buffer pool\u91cc\u9762\uff0c\u4e0d\u7ba1\u662fnew sublist\u8fd8\u662fold sublist\u7684\u6570\u636e\u5982\u679c\u4e0d\u4f1a\u88ab\u8bbf\u95ee\u5230\uff0c\u6700\u540e\u90fd\u4f1a\u88ab\u79fb\u52a8\u5230list\u7684\u5c3e\u90e8\u4f5c\u4e3a\u727a\u7272\u8005\u3002</p> <p>\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u9875\u4fe1\u606f\u4f1a\u88ab\u67e5\u8be2\u8bed\u53e5\u7acb\u9a6c\u67e5\u8be2\u5230\u800c\u88ab\u79fb\u52a8\u5230new sublist\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u4ed6\u4eec\u4f1a\u5728buffer pool\u91cc\u9762\u4fdd\u7559\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\u3002\u8868\u626b\u63cf\uff08\u5305\u62ecmysqldump\u6216\u8005\u6ca1\u6709where\u6761\u4ef6\u7684select\u7b49\u64cd\u4f5c\uff09\u7b49\u64cd\u4f5c\u5c06\u4f1a\u5237\u5165\u5927\u91cf\u7684\u6570\u636e\u8fdb\u5165buffer pool\uff0c\u540c\u65f6\u4e5f\u4f1a\u5c06\u66f4\u591a\u7684buffer pool\u5f53\u4e2d\u7684\u4fe1\u606f\u5237\u51fa\u53bb\uff0c\u5373\u4f7f\u8fd9\u4e2a\u64cd\u4f5c\u53ef\u80fd\u53ea\u4f1a\u4f7f\u7528\u5230\u4e00\u6b21\u800c\u5df2\u3002\u540c\u6837\u7684\uff0c\u5982\u679cread-ahead\uff08\u7ebf\u6027\u9884\u8bfb\uff09\u540e\u53f0\u8fdb\u7a0b\u8bfb\u5165\u5927\u91cf\u6570\u636e\u7684\u60c5\u51b5\u4e0b\u4e5f\u662f\u4f1a\u9020\u6210buffer pool\u5927\u91cf\u9ad8\u9891\u7684\u5237\u65b0\u6570\u636e\u9875\uff0c\u4f46\u662f\u8fd9\u4e9b\u64cd\u4f5c\u662f\u53ef\u63a7\u7684\uff0c\u4e0b\u97623\uff0c4\u4f1a\u8bf4\u5f97\u5230\u3002read-ahead\u64cd\u4f5c\u7b80\u5355\u8bf4\u4e00\u4e0b\u5c31\u662fMySQL\u7684\u4e00\u4e2a\u540e\u53f0\u9884\u8bfb\u8fdb\u7a0b\uff0c\u80fd\u591f\u4fdd\u8bc1MySQL\u9884\u8bfb\u5165\u6570\u636e\u8fdb\u5165buffer pool\u5f53\u4e2d</p> <p>\u5f53\u4f60\u505abackup\u6216\u8005report\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u9891\u7e41\u7684\u5f80buffer pool\u91cc\u9762\u8bfb\u53d6\u6570\u636e\uff0c\u4e0d\u7528\u6709\u592a\u591a\u7684\u987e\u8651\u3002</p> <p>InnoDB\u91c7\u7528\u7684\u662f\u4e00\u79cd\u4e0d\u662f\u50cfLRU\u90a3\u4e48\u4e25\u683c\u7684\u65b9\u6cd5\u6765\u4fdd\u8bc1\u5c06\u6700\u8fd1\u8bbf\u95ee\u7684\u6570\u636e\u5199\u5165\u5230buffer pool\u91cc\u9762\uff0c\u5e76\u4e14\u6700\u5927\u53ef\u80fd\u7684\u964d\u4f4e\u51cf\u5c11\u6570\u636e\u7684\u5e26\u5165\u91cf\u3002\u8fd9\u4e2a\u8bed\u53e5\u662f\u5168\u8868\u626b\u63cf\u6216\u8005\u4ee5\u540e\u8fd9\u4e2a\u6570\u636e\u5c06\u4e0d\u4f1a\u518d\u88ab\u8bbf\u95ee\u5230\uff0c\u4f46\u662f\u7f13\u51b2\u6570\u636e\u8fd8\u662f\u4f1a\u5199\u5165\u5230buffer pool\u91cc\u9762\u3002</p> <p>\u65b0\u5199\u5165\u7684\u6570\u636e\u4f1a\u88ab\u63d2\u5165\u5230LRU list\u7684\u4e2d\u95f4\u4f4d\u7f6e\uff0c\u9ed8\u8ba4\u4f1a\u63d2\u5165\u5230\u4ecelist\u5c3e\u90e8\u7b97\u8d77\u6765\u76843/8\u7684\u4f4d\u7f6e\uff0c\u5f53\u8fd9\u4e9b\u5199\u5165\u7684\u6570\u636e\u5728buffer pool\u4e2d\u88ab\u7b2c\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u5728list\u4e2d\u7684\u4f4d\u7f6e\u5c31\u4f1a\u5411\u524d\u79fb\u52a8\uff0c\u8fd9\u6837\u5176\u5b9e\u5c31\u4f1a\u5728list\u4fdd\u7559\u4e24\u4e2a\u4f4d\u7f6e\uff0c\u8001\u7684\u4f4d\u7f6e\u5e76\u4e0d\u4f1a\u88ab\u7acb\u5373\u6e05\u9664\uff0c\u76f4\u5230\u8001\u7684LRU list\u7684\u4f4d\u7f6e\u88ab\u6807\u8bb0\u4e3aold\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u5728\u4e0b\u4e00\u6b21\u63d2\u5165\u6570\u636e\u7684\u65f6\u5019\u88ab\u4f5c\u4e3a\u727a\u7272\u8005\u6e05\u9664\u6389\u3002</p> <p>\u6211\u4eec\u672c\u8eab\u662f\u53ef\u4ee5\u6307\u5b9a\u63d2\u5165LRU list\u7684\u4f4d\u7f6e\uff0c\u5e76\u4e14\u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u5f53\u7d22\u5f15\u626b\u63cf\u6216\u8005\u662f\u5168\u8868\u626b\u63cf\u7684\u65f6\u5019\u662f\u4e0d\u662f\u91c7\u7528\u8fd9\u4e2a\u76f8\u540c\u7684\u4f18\u5316\u65b9\u6cd5\u3002innodb_old_blocks_pct\u8fd9\u4e2a\u53c2\u6570\u8bbe\u7f6e\u7684\u662f\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u9ed8\u8ba4\u7684\u503c\u662f37\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e\u7684\u503c\u662f5-95\u4e4b\u95f4\uff0c\u5176\u4f59\u90e8\u5206\u5e76\u4e0d\u7528\u6765\u4fdd\u5b58\u70ed\u6570\u636e\u3002\u4f46\u662f\u8fd8\u6709\u4e00\u4e2a\u4e25\u91cd\u7684\u95ee\u9898\u5c31\u662f\u5f53\u4e00\u4e2a\u5168\u8868\u626b\u63cf\u6216\u8005\u7d22\u5f15\u7684\u626b\u63cf\u7ecf\u5e38\u88ab\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u5b58\u50a8\u5f88\u5927\u7684\u6570\u636e\u5230buffer pool\u91cc\u9762\uff0c\u6211\u4eec\u90fd\u77e5\u9053\u8fd9\u662f\u5f88\u5371\u9669\u7684\u4e00\u4ef6\u4e8b\u3002\u6240\u4ee5MySQL\u7ed9\u6211\u4eec\u4ee5\u4e0b\u53c2\u6570\u6765\u8bbe\u7f6e\u4fdd\u7559\u5728buffer pool\u91cc\u9762\u7684\u6570\u636e\u5728\u63d2\u5165\u65f6\u5019\u6ca1\u6709\u88ab\u6539\u53d8list\u4f4d\u7f6e\u7684\u65f6\u5019\u7684\u4fdd\u5b58\u65f6\u95f4innodb_old_blocks_time\uff0c\u5355\u4f4d\u662f\u6beb\u79d2\uff0c\u8fd9\u4e2a\u503c\u7684\u9ed8\u8ba4\u503c\u662f1000\u3002\u5982\u679c\u589e\u5927\u8fd9\u4e2a\u503c\u7684\u8bdd\uff0c\u5c31\u4f1a\u8ba9buffer pool\u91cc\u9762\u5f88\u591a\u9875\u4fe1\u606f\u53d8\u8001\u7684\u901f\u5ea6\u53d8\u5feb\uff0c\u8fd9\u4e2a\u5f88\u597d\u7406\u89e3\u628a\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u6570\u636e\u4e0d\u4f1a\u5f88\u5feb\u88ab\u5185\u5b58\u4e2d\u64e6\u9664\u7684\u8bdd\uff0c\u5c31\u4f1a\u53d8\u6210\u70ed\u6570\u636e\u800c\u6324\u6389\u539f\u6709\u7f13\u5b58\u7684\u6570\u636e\u3002</p> <p>\u4ee5\u4e0a\u7684\u4e24\u4e2a\u53c2\u6570\u90fd\u662f\u53ef\u4ee5\u52a8\u6001\u8bbe\u7f6e\u7684\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u5728my.cnf\u91cc\u9762\u8bbe\u7f6e\u3002\u5f53\u7136\u8bbe\u7f6e\u8fd9\u4e9b\u524d\u4e00\u5b9a\u8981\u5bf9\u673a\u5668\u914d\u7f6e\uff0c\u8868\u4fe1\u606f\uff0c\u8d1f\u8f7d\u60c5\u51b5\u6709\u5145\u5206\u7684\u4e86\u89e3\u624d\u80fd\u8fdb\u884c\u8bbe\u7f6e\uff0c\u751f\u4ea7\u5e93\u5c3d\u91cf\u4e0d\u8981\u968f\u4fbf\u4fee\u6539\u3002\u5982\u679cOLTP\u7cfb\u7edf\u4e2d\u6709\u5927\u91cf\u7684\u5927\u67e5\u8be2\u7684\u8bdd\uff0c\u8bbe\u7f6einnodb_old_blocks_time\u80fd\u591f\u8f83\u5927\u7684\u63d0\u4f9b\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u3002\u5982\u679c\u5f53\u4e00\u4e2a\u5927\u67e5\u8be2\u5f88\u5927\u4e0d\u8db3\u591f\u5b58\u50a8\u5230buffer pool\u5f53\u4e2d\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u6307\u5b9ainnodb_old_blocks_pct\u7684\u503c\u5c0f\u4e00\u70b9\uff0c\u4ee5\u4fdd\u8bc1\u8fd9\u4e9b\u6570\u636e\u53ea\u4f1a\u88ab\u8bfb\u53d6\u4e00\u6b21\uff0c\u6bd4\u5982\u8bf4\u8bbe\u7f6e\u4e3a5\u7684\u65f6\u5019\uff0c\u5c31\u9650\u5236\u4e86\u4e00\u6b21\u8bfb\u53d6\u6570\u636e\u6700\u591a\u53ea\u80fd\u88ab\u8bfb\u53d6\u5230buffer pool\u5f53\u4e2d5%\u3002\u5f53\u7136\u4e00\u4e9b\u5c0f\u8868\u5e76\u4e14\u662f\u7ecf\u5e38\u8bbf\u95ee\u5230\u7684\u6570\u636e\u7684\u8bdd\u5c31\u53ef\u4ee5\u9002\u5f53\u8bbe\u7f6e\u8f83\u5927\u7684\u503c\uff0c\u6bd4\u598250\u3002\u5f53\u7136\u8bbe\u7f6e\u8fd9\u4e24\u4e2a\u503c\u7684\u65f6\u5019\u4e00\u5b9a\u8981\u5efa\u7acb\u5728\u4f60\u5145\u5206\u4e86\u89e3\u4f60\u7684\u6570\u636e\u8d1f\u8f7d\u7684\u57fa\u7840\u4e0a\uff0c\u4e0d\u7136\u5343\u4e07\u4e0d\u8981\u4e71\u6539\u3002</p> <p>5.3 \u6570\u636e\u9875\u8bbf\u95ee\u673a\u5236</p> <p>\u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u4e00\u4e2a\u6570\u636e\u9875\u7684\u8bbf\u95ee\u6d41\u7a0b\u3002</p> <ol> <li>\u5f53\u8bbf\u95ee\u7684\u9875\u9762\u5728\u7f13\u5b58\u6c60\u4e2d\u547d\u4e2d\uff0c\u5219\u76f4\u63a5\u4ece\u7f13\u51b2\u6c60\u4e2d\u8bbf\u95ee\u8be5\u9875\u9762\u3002\u53e6\u5916\u4e3a\u4e86\u907f\u514d\u67e5\u8be2\u6570\u636e\u9875\u65f6\u626b\u63cfLRU\uff0c\u8fd8\u4e3a\u6bcf\u4e2abuffer pool instance\u7ef4\u62a4\u4e86\u4e00\u4e2apage hash\uff0c\u901a\u8fc7space id\u548cpage no\u53ef\u4ee5\u76f4\u63a5\u627e\u5230\u5bf9\u5e94\u7684page\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5f53\u6211\u4eec\u9700\u8981\u8bfb\u5165\u4e00\u4e2aPage\u65f6\uff0c\u9996\u5148\u6839\u636espace id\u548cpage no\u627e\u5230\u5bf9\u5e94\u7684buffer pool instance\u3002\u7136\u540e\u67e5\u8be2page hash\uff0c\u5982\u679cpage hash\u4e2d\u6ca1\u6709\uff0c\u5219\u8868\u793a\u9700\u8981\u4ece\u78c1\u76d8\u8bfb\u53d6\u3002</li> <li>\u5982\u679c\u6ca1\u6709\u547d\u4e2d\uff0c\u5219\u9700\u8981\u5c06\u8fd9\u4e2a\u9875\u9762\u4ece\u78c1\u76d8\u4e0a\u52a0\u8f7d\u5230\u7f13\u5b58\u6c60\u4e2d\uff0c\u56e0\u6b64\u9700\u8981\u5728\u7f13\u5b58\u6c60\u4e2d\u7684\u7a7a\u95f2\u5217\u8868\u4e2d\u627e\u4e00\u4e2a\u7a7a\u95f2\u7684\u5185\u5b58\u5757\u6765\u7f13\u5b58\u8fd9\u4e2a\u4ece\u78c1\u76d8\u8bfb\u5165\u7684\u9875\u9762\u3002</li> <li>\u4f46\u5b58\u5728\u7a7a\u95f2\u5185\u5b58\u5757\u88ab\u4f7f\u7528\u5b8c\u7684\u60c5\u51b5\uff0c\u4e0d\u4fdd\u8bc1\u4e00\u5b9a\u6709\u7a7a\u95f2\u7684\u5185\u5b58\u5757\u3002\u5047\u5982\u7a7a\u95f2\u5217\u8868\u4e3a\u7a7a\uff0c\u6ca1\u6709\u7a7a\u95f2\u7684\u5185\u5b58\u5757\uff0c\u5219\u9700\u8981\u60f3\u529e\u6cd5\u53bb\u4ea7\u751f\u7a7a\u95f2\u7684\u5185\u5b58\u5757\u3002</li> <li>\u9996\u5148\u53bbLRU\u5217\u8868\u4e2d\u627e\u53ef\u4ee5\u66ff\u6362\u7684\u5185\u5b58\u9875\u9762\uff0c\u67e5\u627e\u65b9\u5411\u662f\u4ece\u5217\u8868\u7684\u5c3e\u90e8\u5f00\u59cb\u627e\uff0c\u5982\u679c\u627e\u5230\u53ef\u4ee5\u66ff\u6362\u7684\u9875\u9762\uff0c\u5c06\u5176\u4eceLRU\u5217\u8868\u4e2d\u6458\u9664\uff0c\u52a0\u5165\u7a7a\u95f2\u5217\u8868\uff0c\u7136\u540e\u518d\u53bb\u7a7a\u95f2\u5217\u8868\u4e2d\u627e\u7a7a\u95f2\u7684\u5185\u5b58\u5757\u3002\u7b2c\u4e00\u6b21\u67e5\u627e\u6700\u591a\u53ea\u626b\u63cf100\u4e2a\u9875\u9762\uff0c\u5faa\u73af\u8fdb\u884c\u5230\u7b2c\u4e8c\u6b21\u65f6\uff0c\u4f1a\u67e5\u627e\u6df1\u5ea6\u5c31\u662f\u6574\u4e2aLRU\u5217\u8868\u3002\u8fd9\u5c31\u662fLRU\u5217\u8868\u4e2d\u7684\u9875\u9762\u6dd8\u6c70\u673a\u5236\u3002</li> <li>\u5982\u679c\u5728LRU\u5217\u8868\u4e2d\u6ca1\u6709\u627e\u5230\u53ef\u4ee5\u66ff\u6362\u7684\u9875\uff0c\u5219\u8fdb\u884c\u5355\u9875\u5237\u65b0\uff0c\u5c06\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8\u4e4b\u540e\uff0c\u7136\u540e\u5c06\u91ca\u653e\u7684\u5185\u5b58\u5757\u52a0\u5165\u5230\u7a7a\u95f2\u5217\u8868\u3002\u7136\u540e\u518d\u53bb\u7a7a\u95f2\u5217\u8868\u4e2d\u53d6\u3002\u4e3a\u4ec0\u4e48\u53ea\u505a\u5355\u9875\u5237\u65b0\u5462\uff1f\u56e0\u4e3a\u8fd9\u4e2a\u51fd\u6570\u7684\u76ee\u7684\u662f\u83b7\u53d6\u7a7a\u95f2\u5185\u5b58\u9875\uff0c\u8fdb\u884c\u810f\u9875\u5237\u65b0\u662f\u4e0d\u5f97\u5df2\u800c\u4e3a\u4e4b\uff0c\u6240\u4ee5\u53ea\u4f1a\u8fdb\u884c\u4e00\u4e2a\u9875\u9762\u7684\u5237\u65b0\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u5c3d\u5feb\u7684\u83b7\u53d6\u7a7a\u95f2\u5185\u5b58\u5757\u3002</li> </ol> <p>\u56e0\u4e3a\u7a7a\u95f2\u5217\u8868\u662f\u4e00\u4e2a\u516c\u5171\u7684\u5217\u8868\uff0c\u6240\u6709\u7684\u7528\u6237\u7ebf\u7a0b\u90fd\u53ef\u4ee5\u4f7f\u7528\uff0c\u5b58\u5728\u4e89\u7528\u7684\u60c5\u51b5\u3002\u56e0\u6b64\uff0c\u81ea\u5df1\u4ea7\u751f\u7684\u7a7a\u95f2\u5185\u5b58\u5757\u6709\u53ef\u80fd\u4f1a\u521a\u597d\u88ab\u5176\u4ed6\u7ebf\u7a0b\u6240\u4f7f\u7528\uff0c\u6240\u4ee5\u7528\u6237\u7ebf\u7a0b\u53ef\u80fd\u4f1a\u91cd\u590d\u6267\u884c\u4e0a\u9762\u7684\u67e5\u627e\u6d41\u7a0b\uff0c\u76f4\u5230\u627e\u5230\u7a7a\u95f2\u7684\u5185\u5b58\u5757\u4e3a\u6b62\u3002</p> <p>\u901a\u8fc7\u6570\u636e\u9875\u8bbf\u95ee\u673a\u5236\uff0c\u53ef\u4ee5\u77e5\u9053\u5176\u4e2d\u5f53\u65e0\u7a7a\u95f2\u9875\u65f6\u4ea7\u751f\u7a7a\u95f2\u9875\u5c31\u6210\u4e3a\u4e00\u4e2a\u5fc5\u987b\u8981\u505a\u7684\u4e8b\u60c5\u4e86\u3002\u5982\u679c\u9700\u8981\u5237\u65b0\u810f\u9875\u6765\u4ea7\u751f\u7a7a\u95f2\u9875\u9762\u6216\u8005\u9700\u8981\u626b\u63cf\u6574\u4e2aLRU\u5217\u8868\u6765\u4ea7\u751f\u7a7a\u95f2\u9875\u9762\u7684\u65f6\u5019\uff0c\u67e5\u627e\u7a7a\u95f2\u5185\u5b58\u5757\u7684\u65f6\u95f4\u5c31\u4f1a\u5ef6\u957f\uff0c\u8fd9\u4e2a\u662f\u4e00\u4e2abad case\uff0c\u662f\u6211\u4eec\u5e0c\u671b\u5c3d\u91cf\u907f\u514d\u7684\u3002\u56e0\u6b64\uff0cinnodb buffer pool\u4e2d\u5b58\u5728\u5927\u91cf\u53ef\u4ee5\u66ff\u6362\u7684\u9875\u9762\uff0c\u6216\u8005free\u5217\u8868\u4e2d\u4e00\u76f4\u5b58\u5728\u7740\u7a7a\u95f2\u5185\u5b58\u5757\uff0c\u5bf9\u5feb\u901f\u83b7\u53d6\u5230\u7a7a\u95f2\u5185\u5b58\u5757\u8d77\u51b3\u5b9a\u6027\u7684\u4f5c\u7528\u3002\u5728innodb buffer pool\u7684\u673a\u5236\u4e2d\uff0c\u662f\u91c7\u7528\u4f55\u79cd\u65b9\u5f0f\u6765\u4ea7\u751f\u7684\u7a7a\u95f2\u5185\u5b58\u5757\uff0c\u4ee5\u53ca\u53ef\u4ee5\u66ff\u6362\u7684\u5185\u5b58\u9875\u7684\u5462\uff1f\u8fd9\u5c31\u662f\u6211\u4eec\u4e0b\u9762\u8981\u8bb2\u7684\u5185\u5bb9\u2014\u2014\u901a\u8fc7\u540e\u53f0\u5237\u65b0\u673a\u5236\u6765\u4ea7\u751f\u7a7a\u95f2\u7684\u5185\u5b58\u5757\u4ee5\u53ca\u53ef\u4ee5\u66ff\u6362\u7684\u9875\u9762\u3002</p> <p>5.4 \u7f13\u51b2\u6c60\u5237\u65b0\u7b56\u7565 InnoDB\u4f1a\u5728\u540e\u53f0\u6267\u884c\u67d0\u4e9b\u4efb\u52a1\uff0c\u5305\u62ec\u4ece\u7f13\u51b2\u6c60\u5237\u65b0\u810f\u9875\uff08\u90a3\u4e9b\u5df2\u66f4\u6539\u4f46\u5c1a\u672a\u5199\u5165\u6570\u636e\u5e93\u6587\u4ef6\u7684\u9875\uff09\u3002</p> <p>\u5f53\u542f\u7528innodb_max_dirty_pages_pct_lwm\uff08\u9ed8\u8ba4\u503c0\uff09\u53c2\u6570\u65f6\uff0c\u8868\u793a\u542f\u7528\u4e86\u810f\u9875\u9762\u9884\u5237\u65b0\u884c\u4e3a\uff0c\u4ee5\u63a7\u5236\u810f\u9875\u9762\u5360\u6bd4\u3002\u4e5f\u662f\u4e3a\u4e86\u9632\u6b62\u810f\u9875\u5360\u6709\u7387\u8d85\u8fc7innodb_max_dirty_pages_pct\uff08\u9ed8\u8ba4\u503c75%\uff09\u7684\u8bbe\u5b9a\u503c\u3002\u9ed8\u8ba4\u7981\u7528\u201c\u9884\u5237\u65b0\u201d\u884c\u4e3a\u3002\u5982\u679c\u5f53\u810f\u9875\u7684\u5360\u6709\u7387\u8fbe\u5230\u4e86innodb_max_dirty_pages_pct\u7684\u8bbe\u5b9a\u503c\u7684\u65f6\u5019\uff0cInnoDB\u5c31\u4f1a\u5f3a\u5236\u5237\u65b0buffer pool pages\u3002\u53e6\u5916\u5f53free\u5217\u8868\u5c0f\u4e8einnodb_lru_scan_depth\u503c\u65f6\u4e5f\u4f1a\u89e6\u53d1\u5237\u65b0\u673a\u5236\uff0cinnodb_lru_scan_depth\u63a7\u5236LRU\u5217\u8868\u4e2d\u53ef\u7528\u9875\u7684\u6570\u91cf\uff0c\u8be5\u503c\u9ed8\u8ba4\u4e3a1024\u3002</p> <p>\u540e\u53f0\u5237\u65b0\u7684\u52a8\u4f5c\u7531\u540e\u53f0\u5237\u65b0\u534f\u8c03\u7ebf\u7a0b\u89e6\u53d1\uff0c\u8be5\u7ebf\u7a0b\u7684\u6240\u6709\u5de5\u4f5c\u5185\u5bb9\u5747\u7531buf_flush_page_cleaner_coordinator\u51fd\u6570\u5b8c\u6210\uff0c\u6211\u4eec\u540e\u9762\u7b80\u79f0\u5b83\u4e3a\u534f\u8c03\u51fd\u6570\u3002\u63a5\u4e0b\u6765\uff0c\u6765\u770b\u540e\u53f0\u5237\u65b0\u534f\u8c03\u51fd\u6570\u7684\u4e3b\u4f53\u6d41\u7a0b\u3002</p> <ol> <li>\u8c03\u7528page_cleaner_flush_pages_recommendation\u5efa\u8bae\u51fd\u6570\uff0c\u5bf9\u6bcf\u4e2a\u7f13\u51b2\u6c60\u5b9e\u4f8b\u751f\u6210\u810f\u9875\u5237\u65b0\u6570\u91cf\u7684\u5efa\u8bae\u3002\u5728\u6267\u884c\u5237\u65b0\u4e4b\u524d\uff0c\u4f1a\u7528\u5efa\u8bae\u51fd\u6570\u751f\u6210\u6bcf\u4e2abuffer pool\u9700\u8981\u5237\u65b0\u591a\u5c11\u4e2a\u810f\u9875\u7684\u5efa\u8bae\u3002</li> <li>\u751f\u6210\u5237\u65b0\u5efa\u8bae\u4e4b\u540e\uff0c\u901a\u8fc7\u8bbe\u7f6e\u4e8b\u4ef6\u7684\u65b9\u5f0f\uff0c\u5411\u5237\u65b0\u7ebf\u7a0b\uff08Page Cleaner\u7ebf\u7a0b\uff09\u53d1\u51fa\u5237\u65b0\u8bf7\u6c42\u3002\u540e\u53f0\u5237\u65b0\u7ebf\u7a0b\u5728\u6536\u5230\u8bf7\u6c42\u5237\u65b0\u7684\u4e8b\u4ef6\u540e\uff0c\u4f1a\u6267\u884cpc_flush_slot\u51fd\u6570\u5bf9\u67d0\u4e2a\u7f13\u5b58\u6c60\u8fdb\u884c\u5237\u65b0\uff0c\u5237\u65b0\u7684\u8fc7\u7a0b\u9996\u5148\u662f\u5bf9lru\u5217\u8868\u8fdb\u884c\u5237\u65b0\uff0c\u6267\u884c\u7684\u51fd\u6570\u4e3abuf_flush_LRU_list\uff0c\u5b8c\u6210LRU\u5217\u8868\u7684\u5237\u65b0\u4e4b\u540e\uff0c\u5c31\u4f1a\u6839\u636e\u5efa\u8bae\u51fd\u6570\u751f\u6210\u7684\u5efa\u8bae\u5bf9\u810f\u9875\u5217\u8868\u8fdb\u884c\u5237\u65b0\uff0c\u6267\u884c\u7684\u51fd\u6570\u4e3abuf_flush_do_batch\u3002</li> <li>\u540e\u53f0\u5237\u65b0\u7684\u534f\u8c03\u7ebf\u7a0b\u4f1a\u4f5c\u4e3a\u5237\u65b0\u8c03\u5ea6\u603b\u8d1f\u8d23\u4eba\u7684\u89d2\u8272\uff0c\u5b83\u4f1a\u786e\u4fdd\u6bcf\u4e2abuffer pool\u90fd\u5df2\u7ecf\u5f00\u59cb\u6267\u884c\u5237\u65b0\u3002\u5982\u679c\u54ea\u4e2abuffer pool\u7684\u5237\u65b0\u8bf7\u6c42\u8fd8\u6ca1\u6709\u88ab\u5904\u7406\uff0c\u5219\u7531\u5237\u65b0\u534f\u8c03\u7ebf\u7a0b\u4eb2\u81ea\u5237\u65b0\uff0c\u4e14\u76f4\u5230\u6240\u6709\u7684buffer pool instance\u90fd\u5df2\u5f00\u59cb/\u8fdb\u884c\u4e86\u5237\u65b0\uff0c\u624d\u9000\u51fa\u8fd9\u4e2awhile\u5faa\u73af\u3002</li> <li>\u5f53\u6240\u6709\u7684buffer pool instance\u7684\u5237\u65b0\u8bf7\u6c42\u90fd\u5df2\u7ecf\u5f00\u59cb\u5904\u7406\u4e4b\u540e\uff0c\u534f\u8c03\u51fd\u6570\uff08\u6216\u534f\u8c03\u7ebf\u7a0b\uff09\u5c31\u7b49\u5f85\u6240\u6709buffer pool instance\u7684\u5237\u65b0\u7684\u5b8c\u6210\uff0c\u7b49\u5f85\u51fd\u6570\u4e3apc_wait_finished\u3002\u5982\u679c\u8fd9\u6b21\u5237\u65b0\u7684\u603b\u8017\u65f6\u8d85\u8fc74000ms\uff0c\u4e0b\u6b21\u5faa\u73af\u4e4b\u524d\uff0c\u4f1a\u5728\u6570\u636e\u5e93\u7684\u9519\u8bef\u65e5\u5fd7\u8bb0\u5f55\u76f8\u5173\u7684\u8d85\u65f6\u4fe1\u606f\u3002\u5b83\u671f\u671b\u6bcf\u79d2\u949f\u5bf9buffer pool\u8fdb\u884c\u4e00\u6b21\u5237\u65b0\u8c03\u5ea6\u3002\u5982\u679c\u76f8\u90bb\u4e24\u6b21\u5237\u65b0\u8c03\u5ea6\u7684\u95f4\u9694\u8d85\u8fc74000ms \uff0c\u4e5f\u5c31\u662f4\u79d2\u949f\uff0cMySQL\u7684\u9519\u8bef\u65e5\u5fd7\u4e2d\u4f1a\u8bb0\u5f55\u76f8\u5173\u4fe1\u606f\uff0c\u610f\u601d\u5c31\u662f\u201c\u672c\u6765\u9884\u8ba11000ms\u7684\u5faa\u73af\u82b1\u8d39\u4e86\u8d85\u8fc74000ms\u7684\u65f6\u95f4\u3002</li> </ol> <p>\u524d\u9762\u6211\u4eec\u53cd\u590d\u8bb2\u5230\uff0c\u6bcf\u4e2abuffer pool\u9700\u8981\u5237\u65b0\u591a\u5c11\u9875\u9762\u662f\u7531\u5efa\u8bae\u51fd\u6570\u751f\u6210\u7684\uff0c\u5b83\u5728\u505a\u5237\u65b0\u5efa\u8bae\u7684\u65f6\u5019\uff0c\u5177\u4f53\u8003\u8651\u4e86\u54ea\u4e9b\u56e0\u7d20\uff1f\u73b0\u5728\u6211\u4eec\u6765\u8be6\u7ec6\u89e3\u6790\u3002</p> <p>\u5728\u8bb2\u8fd9\u6bb5\u5185\u5bb9\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u4e86\u89e3\u4e24\u4e2a\u53c2\u6570\uff1ainnodb_io_capacity\u4e0einnodb_io_capacity_max\uff0c\u8fd9\u4e24\u4e2a\u53c2\u6570\u5927\u90e8\u5206\u670b\u53cb\u90fd\u4e0d\u964c\u751f\uff0c\u8bbe\u7f6e\u8fd9\u4e2a\u53c2\u6570\u7684\u76ee\u7684\uff0c\u662f\u544a\u8bc9MySQL\u6570\u636e\u5e93\uff0c\u5b83\u6240\u5728\u670d\u52a1\u5668\u7684\u78c1\u76d8\u7684\u968f\u673aIO\u80fd\u529b\u3002MySQL\u6570\u636e\u5e93\u76ee\u524d\u8fd8\u6ca1\u6709\u53bb\u81ea\u5df1\u8bc4\u4f30\u670d\u52a1\u5668\u78c1\u76d8IO\u80fd\u529b\u7684\u529f\u80fd\uff0c\u6240\u4ee5\u78c1\u76d8io\u80fd\u529b\u5927\u5c0f\u7531\u8fd9\u4e2a\u53c2\u6570\u63d0\u4f9b\uff0c\u4ee5\u4fbf\u8ba9\u6570\u636e\u5e93\u77e5\u9053\u78c1\u76d8\u7684\u5b9e\u9645IO\u80fd\u529b\u3002\u8fd9\u4e2a\u53c2\u6570\u5c06\u76f4\u63a5\u5f71\u54cd\u5efa\u8bae\u5237\u65b0\u7684\u9875\u9762\u7684\u6570\u91cf\u3002</p> <p>\u5efa\u8bae\u51fd\u6570\u5b83\u4f1a\u8ba1\u7b97\u5f53\u524d\u7684\u810f\u9875\u5237\u65b0\u5e73\u5747\u901f\u5ea6\uff08\u4e5f\u5c31\u662f\u4e00\u79d2\u949f\u5237\u65b0\u4e86\u591a\u5c11\u810f\u9875\uff09\u4ee5\u53ca\u91cd\u505a\u65e5\u5fd7\u7684\u751f\u6210\u5e73\u5747\u901f\u5ea6\u3002\u4f46\u8fd9\u4e2a\u51fd\u6570\u5e76\u4e0d\u662f\u6bcf\u6b21\u88ab\u8c03\u7528\u65f6\uff0c\u90fd\u8ba1\u7b97\u4e00\u6b21\u5e73\u5747\u901f\u5ea6\u3002\u5b83\u662f\u591a\u4e45\u8ba1\u7b97\u4e00\u6b21\u7684\u5462\uff1f\u8fd9\u4e2a\u662f\u7531\u6570\u636e\u5e93\u53c2\u6570innodb_flushing_avg_loops\u6765\u51b3\u5b9a\u7684\uff0c\u9ed8\u8ba4\u662f30\uff0c\u5f53\u8fd9\u4e2a\u51fd\u6570\u88ab\u8c03\u7528\u4e8630\u6b21\u4e4b\u540e\u6216\u8005\u7ecf\u8fc730\u79d2\u4e4b\u540e\uff0c\u91cd\u65b0\u8ba1\u7b97\u4e00\u6b21\u5e73\u5747\u503c\u3002\u6211\u4eec\u6682\u4e14\u7b80\u5355\u7406\u89e3\u4e3a30\u79d2\u949f\u3002\u8ba1\u7b97\u89c4\u5219\u662f\u5f53\u524d\u7684\u5e73\u5747\u901f\u5ea6\u52a0\u4e0a\u6700\u8fd130\u79d2\u949f\u671f\u95f4\u7684\u5e73\u5747\u901f\u5ea6\u518d\u9664\u4ee52\u5f97\u51fa\u65b0\u7684\u5e73\u5747\u901f\u5ea6\u3002\u4e24\u4e2a\u5e73\u5747\u503c\u76f8\u52a0\u518d\u5e73\u5747\uff0c\u5f97\u51fa\u65b0\u7684\u5e73\u5747\u503c\u3002\u8fd9\u6837\u7684\u5e73\u5747\u503c\u80fd\u660e\u663e\u7684\u4f53\u73b0\u51fa\u6700\u8fd130\u79d2\u7684\u901f\u5ea6\u7684\u53d8\u5316\u3002</p> <p>\u5e73\u5747\u503c\u8ba1\u7b97\u89c4\u5219\u5c31\u662f\u65b0\u5e73\u5747\u901f\u5ea6=(\u5f53\u524d\u7684\u5e73\u5747\u901f\u5ea6+\u6700\u8fd1\u8fd9\u6bb5\u671f\u95f4\u5e73\u5747\u901f\u5ea6)%2\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5b83\u4f1a\u6839\u636einnodb buffer pool\u7684\u810f\u9875\u767e\u5206\u6bd4\u6765\u8ba1\u7b97innodb_io_capacity\u7684\u767e\u5206\u6bd4\u3002\u7136\u540e\u4f1a\u6839\u636e\u91cd\u505a\u65e5\u5fd7\u4e2d\u7684\u6d3b\u8dc3\u65e5\u5fd7\u91cf\u7684\u5927\u5c0f\uff0c\u4e5f\u5c31\u662flsn\u7684age\uff0c\u6700\u8fd1\u751f\u6210\u91cf\uff0c\u5360\u91cd\u505a\u65e5\u5fd7\u6587\u4ef6\u5927\u5c0f\u7684\u767e\u5206\u6bd4\u6765\u8ba1\u7b97innodb_io_capacity\u7684\u767e\u5206\u6bd4\u3002\u8c03\u7528\u76f8\u5173\u51fd\u6570\u6839\u636e\u810f\u9875\u767e\u5206\u6bd4\u6765\u8ba1\u7b97io_capacity\u7684\u767e\u5206\u6bd4\uff0c\u7528\u53d8\u91cfpct_for_dirty\u4fdd\u5b58\uff0c\u7136\u540e\u6839\u636e\u6d3b\u8dc3\u65e5\u5fd7\u91cf\u7684\u5927\u5c0f\u6765\u8ba1\u7b97io_capacity\u7684\u767e\u5206\u6bd4\uff0c\u7528\u53d8\u91cfpct_for_lsn\u6765\u4fdd\u5b58\uff0c\u8fd9\u4e2a\u503c\u540e\u9762\u4f1a\u88ab\u662f\u4f7f\u7528\u5230\uff0c\u7528\u6765\u51b3\u5b9a\u6bcf\u4e2abuffer pool\u662f\u5efa\u8bae\u5237\u65b0\u76f8\u540c\u7684\u6570\u91cf\u7684\u810f\u9875\uff0c\u8fd8\u662f\u5237\u65b0\u4e0d\u540c\u7684\u6570\u91cf\u3002\u5f53pct_for_lsn&lt;30\u7684\u65f6\u5019\uff0c\u5efa\u8bae\u6bcf\u4e2abuffer\u5237\u65b0\u76f8\u540c\u6570\u91cf\u7684\u9875\u9762\u3002\u5426\u5219\uff0c\u5efa\u8bae\u5237\u65b0\u4e0d\u540c\u6570\u91cf\u7684\u9875\u9762\u3002\u6700\u540e\u6bd4\u8f83\u8fd9\u4e24\u4e2a\u53d8\u91cf\u7684\u5927\u5c0f\uff0c\u5927\u7684\u503c\u4f5c\u4e3a\u6700\u7ec8\u7684io_capacity\u7684\u767e\u5206\u6bd4\uff0c\u7528\u53d8\u91cfpct_total\u4fdd\u5b58\u3002\u5047\u5982\u8ba1\u7b97\u51fa\u6765\u7684\u5f97\u5230pctl_total\u4e3a90\uff0c\u800c\u6570\u636e\u5e93\u53c2\u6570innodb_io_capacity\u8bbe\u7f6e\u4e3a1000\uff0c\u5219\u6839\u636e\u8fd9\u4e24\u4e2a\u56e0\u7d20\u518d\u7ed3\u5408\u6240\u8bbe\u7f6e\u7684\u78c1\u76d8io\u80fd\u529b\uff0c\u5f97\u51fa\u7684\u5efa\u8bae\u5c31\u4e3a\u5237\u65b0900\u4e2a\u810f\u9875\uff0c\u6240\u4ee5innodb_io_capacity\u53c2\u6570\u4e5f\u662f\u5237\u65b0\u591a\u5c11\u7684\u4e00\u4e2a\u91cd\u8981\u53c2\u6570\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u5c06\u6765\u770b\u770b\u662f\u5982\u4f55\u5177\u4f53\u8ddf\u636e\u8fd9\u4e24\u9879\u6765\u8ba1\u7b97io_capacity\u7684\u767e\u5206\u6bd4\u7684\u3002</p> <p>5.4.1 \u5982\u4f55\u6839\u636e\u810f\u9875\u767e\u5206\u6bd4\u6765\u8ba1\u7b97innodb_io_capacity\u767e\u5206\u6bd4\uff1f</p> <p>\u9996\u5148\u83b7\u53d6\u7f13\u5b58\u6c60\u7684\u810f\u9875\u767e\u5206\u6bd4\uff0c\u7136\u540e\u6839\u636e\u8fd9\u4e2a\u503c\u8fdb\u884c\u5224\u65ad\u3002\u5982\u679c\u53c2\u6570\u6700\u5927\u810f\u9875\u767e\u5206\u6bd4\u7684\u4f4e\u6c34\u4f4d\u8bbe\u7f6e\u4e3a0(\u9ed8\u8ba4\u503c\uff09\uff0c\u5f53dirty_pct\u5927\u4e8e\u53c2\u6570innodb_max_dirty_pages_pct\uff08\u9ed8\u8ba4\u503c75%\uff09\uff0c\u5219\u8fd4\u56de100\uff0c\u5426\u5219\u8fd4\u56de0\u3002\u5982\u679c\u8bbe\u7f6e\u4e86\u6700\u5927\u810f\u9875\u767e\u5206\u6bd4\u7684\u4f4e\u6c34\u4f4d\uff0c\u5f53\u810f\u9875\u767e\u5206\u6bd4\u8d85\u8fc7\u8be5\u503c\u65f6\uff0c\u5219\u8fd4\u56de\u76f8\u5e94\u7684\u6bd4\u4f8b\u3002\u5f53\u810f\u9875\u767e\u5206\u6bd4\u8d8a\u63a5\u8fd1\u6700\u5927\u810f\u9875\u767e\u5206\u6bd4\uff0c\u8fd4\u56de\u6bd4\u4f8b\u8d8a\u63a5\u8fd1100\u3002\u5426\u5219\u4e3a0\u3002</p> <p>5.4.2 \u5982\u4f55\u6839\u636e\u91cd\u505a\u65e5\u5fd7\u6d3b\u8dc3\u65e5\u5fd7\u91cf\u6765\u8ba1\u7b97innodb_io_capacity\u767e\u5206\u6bd4\uff1f</p> <p>\u5982\u679c\u6d3b\u8dc3\u65e5\u5fd7\u91cf\u5360\u65e5\u5fd7\u6587\u4ef6\u5927\u5c0f\u7684\u767e\u5206\u6bd4\u5c0f\u4e8e\u53c2\u6570innodb_adaptive_flushing_lwm\uff0c\u5373\u81ea\u9002\u5e94\u5237\u65b0\u7684\u4f4e\u6c34\u4f4d\uff0c\u9ed8\u8ba4\u662f10\uff0c\u5219\u76f4\u63a5\u8fd4\u56de0\u3002\u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\u81ea\u9002\u5e94\u5237\u65b0\u53c2\u6570innodb_adaptive_flushing\uff0c\uff08InnoDB 1.0\u5f15\u5165\u7684\u53c2\u6570\uff0c\u81ea\u9002\u5e94\u5237\u65b0\uff0c\u5c31\u662f\u6211\u4eec\u8fd9\u91cc\u8bb2\u7684\u5237\u65b0\u65b9\u5f0f\u3002\u65e7\u7684\u5237\u65b0\u65b9\u5f0f\u65f6\u53ea\u6709\u810f\u9875\u5728\u7f13\u51b2\u6c60\u4e2d\u5360\u7684\u6bd4\u4f8b\u5927\u4e8einnodb_max_dirty_pages_pct\u53c2\u6570\u65f6\u5c31\u4f1a\u5237\u65b0100\u4e2a\u810f\u9875\uff09\uff0c\u9ed8\u8ba4\u4e3aon\uff0c\u5219\u9700\u8981\u7b49\u5f85\u6d3b\u8dc3\u7684\u65e5\u5fd7\u91cf\u5927\u4e8emax_async_age\u7684\u503c\uff0c\u624d\u4f1a\u8fd4\u56de\u76f8\u5e94\u7684\u767e\u5206\u6bd4\uff0c\u5426\u5219\u8fd4\u56de0\u3002\u53ef\u4ee5\u7b80\u5355\u7684\u7406\u89e3\u4e3a\uff0c\u5982\u679c\u6ca1\u6709\u5f00\u542f\u81ea\u9002\u5e94\u5237\u65b0\uff0c\u5219\u5fc5\u987b\u7b49\u5f85\u6d3b\u8dc3\u65e5\u5fd7\u91cf\u7684\u8fc7\u5927\uff0c\u5927\u5230\u5b58\u5728\u5371\u5bb3\u6570\u636e\u5e93\u7684\u53ef\u7528\u6027\u98ce\u9669\u65f6\uff0c\u624d\u5f00\u59cb\u8003\u8651\u57fa\u4e8e\u6d3b\u8dc3\u65e5\u5fd7\u91cf\u7684\u5927\u5c0f\u6765\u8fdb\u884c\u810f\u9875\u5237\u65b0\u3002\u5982\u679c\u5f00\u542f\u4e86\u81ea\u9002\u5e94\u5237\u65b0\uff0c\u6d3b\u8dc3\u65e5\u5fd7\u91cf\u6240\u5360\u767e\u5206\u6bd4\u5927\u4e8e\u81ea\u9002\u5e94\u5237\u65b0\u7684\u4f4e\u6c34\u4f4d\u65f6\uff0c\u8fd4\u56de\u76f8\u5e94\u7684\u767e\u5206\u6bd4\u3002</p> <p>\u7136\u540e\uff0c\u4f1a\u6839\u636e\u524d\u9762\u8ba1\u7b97\u7684\u91cd\u505a\u65e5\u5fd7\u751f\u6210\u7684\u5e73\u5747\u901f\u5ea6\uff0c\u6765\u8ba1\u7b97\u5efa\u8bae\u6bcf\u4e2abuffer pool instance\u5237\u65b0\u591a\u5c11\u810f\u9875\u4ee5\u53ca\u6240\u6709pool buffer\u7684\u5237\u65b0\u603b\u91cf\u3002\u4e4b\u6240\u4ee5\u4f1a\u57fa\u4e8e\u8fd9\u4e2a\u56e0\u7d20\u6765\u8003\u8651\uff0c\u6211\u8ba4\u4e3a\u662f\u8fd9\u6837\u7684\uff1a\u65b0\u4ea7\u751f\u7684\u91cd\u505a\u65e5\u5fd7\u662f\u6d3b\u8dc3\u7684\u91cd\u505a\u65e5\u5fd7\uff0c\u6839\u636e\u6d3b\u8dc3\u65e5\u5fd7\u7684\u751f\u6210\u901f\u5ea6\u6765\u8ba1\u7b97\u9700\u8981\u5237\u65b0\u7684\u810f\u9875\u7684\u6570\u91cf\uff0c\u4ece\u800c\u5c06\u4f7f\u6d3b\u8dc3\u65e5\u5fd7\u7684\u8fc7\u671f\u901f\u5ea6\u8ddf\u751f\u6210\u901f\u5ea6\u8fbe\u5230\u4e00\u4e2a\u5747\u8861\uff0c\u8fd9\u6837\u63a7\u5236\u4e86\u6d3b\u8dc3\u7684\u91cd\u505a\u65e5\u5fd7\u5728\u4e00\u4e2a\u6b63\u5e38\u7684\u8303\u56f4\uff0c\u4fdd\u969c\u4e86\u91cd\u505a\u65e5\u5fd7\u6587\u4ef6\u4e00\u76f4\u6709\u53ef\u4ee5\u4f7f\u7528\u7684\u7a7a\u95f4\uff0c\u4e0d\u7136\u5c31\u4f1a\u6709\u95ee\u9898\uff08\u53ef\u4ee5\u770bMySQL InnoDB checkpoint\uff09\u3002\u5728\u8fd9\u91cc\u7b80\u5355\u8bf4\u660e\u4e00\u4e0b\u6d3b\u8dc3\u7684\u91cd\u505a\u65e5\u5fd7\u8ddf\u4e0d\u6d3b\u8dc3\u7684\u91cd\u505a\u65e5\u5fd7\u7684\u533a\u522b\uff1a\u6d3b\u8dc3\u65e5\u5fd7\u662f\u6307\u5176\u8bb0\u5f55\u7684\u88ab\u4fee\u6539\u7684\u810f\u9875\u8fd8\u6ca1\u6709\u88ab\u5237\u65b0\u5230\u78c1\u76d8\uff0c\u5f53MySQL\u5b9e\u4f8bcrash\u4e4b\u540e\uff0c\u9700\u8981\u4f7f\u7528\u8fd9\u4e9b\u65e5\u5fd7\u6765\u505a\u5b9e\u4f8b\u6062\u590d\u3002</p> <p>5.4.3 \u5982\u4f55\u8ba1\u7b97\u6bcf\u4e2abuffer pool instance\u9700\u8981\u5237\u65b0\u7684\u9875\u9762\uff1f</p> <p>\u9996\u5148\uff0c\u6839\u636e\u524d\u9762\u8ba1\u7b97\u5f97\u51fa\u7684lsn_avg_rate\uff0c\u5373\u91cd\u505a\u65e5\u5fd7\u4ea7\u751f\u7684\u5e73\u5747\u901f\u5ea6\uff0c\u8ba1\u7b97\u51fa\u4e00\u4e2atarget_lsn\u53f7\u3002</p> <p>\u7136\u540e\u4ece\u6bcf\u4e00\u4e2abuffer pool\u7684\u810f\u9875\u5217\u8868\u7684\u961f\u5c3e\u5f00\u59cb\u53d6\u51fa\u810f\u9875\uff0c\u5c06\u810f\u9875\u7684old_modifiaction(\u6700\u5c0f\u7684lsn)\u8ddftarget_lsn\u8fdb\u884c\u6bd4\u8f83\uff0c\u8fd9\u91cc\u7b80\u5355\u7684\u8bf4\u660e\u4e00\u4e0b\u810f\u9875\u7684oldest_modification\u7684\u542b\u4e49\uff0c\u5b83\u8868\u793a\u7684\u662f\u810f\u9875\u7b2c\u4e00\u6b21\u4fee\u6539\u65f6\u7684lsn\u53f7\uff0c\u4e5f\u5c31\u662f\u810f\u9875\u7684\u6700\u5c0flsn\u53f7\u3002\u5982\u679c\u5b83\u5c0f\u4e8etarget_lsn\uff0c\u7136\u540e\u5c06\u5176\u4f5c\u4e3a\u5237\u65b0\u5bf9\u8c61\u8fdb\u884c\u8ba1\u6570\uff0c\u5426\u5219\uff0c\u9000\u51fa\u8fd9\u4e2abuffer pool\u5185\u7684\u5faa\u73af\u3002\u56e0\u4e3a\u5237\u65b0\u5217\u8868\u65f6\u6309\u7167\u810f\u9875\u7684\u6700\u5c0flsn\u53f7\u8fdb\u884c\u6392\u5e8f\u7684\uff0c\u524d\u9762\u7684\u810f\u9875\u7684\u6700\u5c0flsn\u90fd\u5927\u4e8etarget_lsn \uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u518d\u7ee7\u7eed\u627e\u4e0b\u53bb\u3002</p> <p>\u4ece\u4e0a\u9762\u7684\u8ba1\u7b97\u65b9\u5f0f\u53ef\u4ee5\u770b\u51fa\uff0c\u5f53\u91cd\u505a\u65e5\u5fd7\u751f\u6210\u7684\u5e73\u5747\u901f\u5ea6\u8d8a\u5927\uff0ctarget_lsn\u5c31\u8d8a\u5927\uff0c\u540c\u65f6\uff0c\u5982\u679cbuffer_pool\u4e2d\u7684\u810f\u9875\u7684old_modition\u5c0f\u4e8etarget_lsn\u7684\u6570\u91cf\u8d8a\u591a\uff0c\u4e5f\u5c31\u662f\u8001\u7684\u810f\u9875\u8d8a\u591a\uff0c\u88ab\u5efa\u8bae\u5237\u65b0\u7684\u9875\u9762\u5c31\u8d8a\u591a\u3002</p> <p>\u518d\u63a5\u4e0b\u6765\uff0c\u901a\u8fc7\u4e0a\u9762\u7684\u8ba1\u7b97\uff0c\u6211\u4eec\u4ece\u4e0d\u540c\u7ef4\u5ea6\u5206\u522b\u5f97\u51fa\u4e09\u4e2a\u5efa\u8bae\u5237\u65b0\u7684\u6570\u91cf\uff1a\u5206\u522b\u4e3a\u5f53\u524d\u7684\u810f\u9875\u5237\u65b0\u7684\u5e73\u5747\u901f\u5ea6\uff0c\u4e5f\u5c31\u662f\u4e00\u79d2\u949f\u5237\u65b0\u4e86\u591a\u5c11\u810f\u9875\uff1b\u6839\u636e\u810f\u9875\u767e\u5206\u6bd4\uff0c\u4ee5\u53ca\u6d3b\u8dc3\u65e5\u5fd7\u91cf\u7684\u5927\u5c0f\uff0c\u4ee5\u53ca\u6240\u8bbe\u7f6e\u7684innodb_io_capacity\u53c2\u6570\u6240\u5f97\u51fa\u5efa\u8bae\u5237\u65b0\u7684\u6570\u91cf\uff1b\u4ee5\u53ca\u6839\u636e\u91cd\u505a\u65e5\u5fd7\u4ea7\u751f\u901f\u5ea6\u8ba1\u7b97\u5f97\u51fa\u7684\u5efa\u8bae\u5237\u65b0\u6570\u91cf\u3002\u5c06\u8fd9\u4e09\u4e2a\u503c\u76f8\u52a0\u4e4b\u540e\u518d\u5e73\u5747\uff0c\u5f97\u51fa\u7684\u5c31\u662f\u8003\u8651\u4e86\u4e0a\u9762\u6240\u6709\u56e0\u7d20\u7684\u4e00\u4e2a\u7efc\u5408\u5efa\u8bae\uff0c\u7531\u53d8\u91cfn_pages\u4fdd\u5b58\u3002\u63a5\u4e0b\u6765\uff0c\u8fd9\u4e2a\u5efa\u8bae\u5237\u65b0\u7684\u603b\u91cfn_pages\u4f1a\u8ddfinnodb_io_capacity_max\u8fd9\u4e2a\u53c2\u6570\u8fdb\u884c\u6bd4\u8f83\uff0c\u4e5f\u5c31\u662f\u5efa\u8bae\u5237\u65b0\u7684\u603b\u91cf\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7\u6240\u8bbe\u7f6e\u7684\u78c1\u76d8\u6700\u5927\u968f\u673aio\u80fd\u529b\u3002</p> <p>\u6700\u540e\uff0c\u751f\u6210\u6700\u7ec8\u7684\u5237\u65b0\u5efa\u8bae\u3002\u751f\u6210\u6700\u7ec8\u7684\u5237\u65b0\u5efa\u8bae\u65f6\uff0c\u4f1a\u8003\u8651\u5f53\u524d\u6570\u636e\u5e93\u7684\u6d3b\u8dc3\u65e5\u5fd7\u91cf\u7684\u5927\u5c0f\uff0c\u5f53\u524d\u6d3b\u8dc3\u65e5\u5fd7\u6bd4\u8f83\u5c11\u7684\u65f6\u5019\uff0c\u8ba4\u4e3a\u91cd\u505a\u65e5\u5fd7\u6587\u4ef6\u6709\u8db3\u591f\u53ef\u4ee5\u4f7f\u7528\u7684\u7a7a\u95f4(\u4ee5\u53d8\u91cfpct_for_lsn\u5c0f\u4e8e30\u4e3a\u4f9d\u636e\uff09\uff0c\u5219\u4e0d\u9700\u8981\u8003\u8651\u6bcf\u4e2abuffer pool\u4e4b\u95f4\u7684\u810f\u9875\u5e74\u9f84\u5206\u5e03\u4e0d\u5747\u7684\u60c5\u51b5\uff0c\u6bcf\u4e2abuffer pool\u5237\u65b0\u76f8\u540c\u7684\u6570\u91cf\uff0c\u6570\u91cf\u5c31\u5237\u65b0\u603b\u91cf\u9664\u4ee5buffer pool\u7684\u4e2a\u6570\u3002\u5982\u679c\u6d3b\u8dc3\u65e5\u5fd7\u6bd4\u8f83\u591a(\u4ee5\u53d8\u91cfpct_for_lsn\u5927\u4e8e\u7b49\u4e8e30\u4e3a\u4f9d\u636e\uff09\uff0c\u5219\u9700\u8981\u8003\u8651\u810f\u9875\u7684\u5e74\u9f84\u5728\u6bcf\u4e2abuffer pool\u7684\u5206\u5e03\u4e0d\u540c\uff0c\u6bcf\u4e2abuffer\u5237\u65b0\u4e0d\u540c\u7684\u6570\u91cf\u7684\u810f\u9875\uff0c\u8001\u7684\u810f\u9875\u6bd4\u8f83\u591a\u7684buffer pool instance\u5237\u65b0\u7684\u6570\u91cf\u4e5f\u5c31\u591a\u3002</p> <p>5.4.4 \u751f\u6210\u6700\u7ec8\u5237\u65b0\u5efa\u8bae\u540e\u7684\u5237\u65b0\u903b\u8f91\uff1f</p> <p>\u5f53\u751f\u6210\u5237\u65b0\u5efa\u8bae\u4e4b\u540e\uff0c\u5c31\u8bbe\u7f6e\u5237\u65b0\u8bf7\u6c42\u4e8b\u4ef6\uff0c\u8bf7\u6c42\u5237\u65b0\u7ebf\u7a0b\u8fdb\u884c\u810f\u9875\u6279\u91cf\u5237\u65b0\u3002\u8bf7\u6c42\u51fd\u6570pc_request\u4e5f\u5f88\u7b80\u5355\u3002</p> <ol> <li>\u5c06\u6240\u6709buffer pool instances\u7684\u5237\u65b0\u72b6\u6001\u8bbe\u7f6e\u4e3aPAGE_CLEANER_STATE_REQUESTED\uff0c\u5373\u7533\u8bf7\u5237\u65b0\u3002</li> <li>\u901a\u8fc7\u8bbe\u7f6e\u4e8b\u4ef6\uff0c\u5524\u9192/\u89e6\u53d1page cleaner\u7ebf\u7a0b\u8c03\u7528pc_flush_slot\u51fd\u6570\u6765\u8fdb\u884cbuffer pool\u7684\u6279\u91cf\u5237\u65b0\u3002</li> </ol> <p>Page_cleaner\u7ebf\u7a0b\u6536\u5230\u5237\u65b0\u8bf7\u6c42\u4e4b\u540e\uff0c\u5c31\u5f00\u59cb\u8fdb\u884c\u6279\u91cf\u5237\u65b0\u3002</p> <ol> <li>\u5bfb\u627e\u4e00\u4e2a\u72b6\u6001\u4e3a\u7533\u8bf7\u5237\u65b0\u7684\u7f13\u5b58\u6c60\u5b9e\u4f8b\uff0c\u7136\u540e\u9009\u4e3a\u5237\u65b0\u5bf9\u8c61\uff0c\u5c06\u72b6\u6001\u4fee\u6539\u4e3aflushing.\u3002\u7136\u540e\u6267\u884c\u540e\u9762\u7684\u5237\u65b0\u3002</li> <li>\u6267\u884cbuf_flush_LRU_list\u51fd\u6570\u8fdb\u884cLRU\u5217\u8868\u7684\u5237\u65b0\u3002</li> <li>\u6267\u884cbuf_flush_do_batch\u6279\u91cf\u5237\u65b0\u810f\u9875\u5217\u8868\uff0c\u8be5buffer pool instance\u5efa\u8bae\u5237\u65b0\u7684\u6570\u91cfslot-&gt;n_pages_requested\u4f5c\u4e3a\u8be5\u51fd\u6570\u53c2\u6570\u503c\uff0c\u4e5f\u5c31\u662f\u4f9d\u636e\u5efa\u8bae\u5237\u65b0\u7684\u9875\u9762\u6570\u6765\u8fdb\u884c\u5237\u65b0\u3002</li> </ol> <p>\u5bf9\u4e8eLRU\u5217\u8868\u7684\u5237\u65b0\u7684\u51fd\u6570buf_flush_LRU_list\u5c06scan_depth\u53d8\u91cf\u4f20\u9012\u6700\u7ec8\u4f20\u9012\u7ed9buf_flush_LRU_list_batch\u51fd\u6570\uff0c\u5728\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u7b80\u5355\u7684\u7406\u89e3scan_depth\u7684\u503c\u6765\u81ea\u4e8e\u6570\u636e\u5e93\u53c2\u6570innodb_lru_scan_deptch\uff08\u7b80\u5355\u7406\u89e3innodb_lru_scan_depth\u53c2\u6570\u63a7\u5236LRU\u5217\u8868\u4e2d\u53ef\u7528\u9875\u7684\u6570\u91cf\uff0c\u8be5\u503c\u9ed8\u8ba4\u4e3a1024\uff09\u53c2\u6570\u3002\u63a5\u4e0b\u6765\u770bbuf_flush_LRU_list_batch\u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u4e00\u4e2a\u91cd\u8981\u70b9\u5c31\u662f\u5982\u679cfree\u5217\u8868\u7684\u957f\u5ea6\u5927\u4e8einnodb_lru_scan_depth\u53c2\u6570\u503c\uff0c\u5219\u7ec8\u6b62\u5185\u90e8\u5faa\u5e8f\u3002\u5426\u5219\u5c31\u5f80\u4e0b\u8d70\uff0c\u7136\u540e\u5c31\u8be5\u5224\u65ad\u5982\u679c\u662f\u4e00\u4e2a\u53ef\u66ff\u6362\u7684\u9875\uff0c\u5219\u5c06\u4eceLRU\u5217\u8868\u4e2d\u6458\u9664\uff0c\u5176\u52a0\u5165free\u5217\u8868\u3002\u5982\u679c\u662f\u810f\u9875\uff0c\u5219\u8fdb\u884c\u5237\u65b0\uff0c\u76f4\u5230\u6ee1\u8db3\u5c0f\u4e8einnodb_lru_scan_depth\u7684\u6761\u4ef6\u5219\u7ec8\u6b62\u5faa\u73af\u4f53\u3002\u7531\u6b64\u6211\u4eec\u53ef\u4ee5\u770b\u51fainnodb_lru_scan_depth\u53c2\u6570\uff0c\u5728\u6b64\u8d77\u975e\u5e38\u5173\u952e\u7684\u4f5c\u7528\uff0c\u5b9e\u9645\u4e0a\u4e5f\u76f4\u63a5\u5f71\u54cd\u4e86buffer bool instance\u4e2d\u7684free\u5217\u8868\u7684\u957f\u5ea6\u3002</p> <p>\u5237\u65b0\u534f\u8c03\u51fd\u6570\u7684\u6267\u884c\u4e00\u4e2a\u5237\u65b0\u5faa\u73af\u7684\u6700\u540e\u4e00\u6b65\uff0c\u5c31\u662f\u8bbe\u7f6e\u4e8b\u4ef6\u7b49\u5f85\uff0c\u7b49\u5f85\u6240\u6709buffer pool instance\u5237\u65b0\u5b8c\u6210\u7684\u4e8b\u4ef6\u89e6\u53d1\u3002\u5237\u65b0\u5b8c\u6210\u4e4b\u540e\uff0c\u7136\u540e\u5f00\u59cb\u4e0b\u4e00\u8f6e\u5faa\u73af\uff0c\u5982\u679c\u5237\u65b0\u57281\u79d2\u4e4b\u5185\u5b8c\u6210\uff0c\u5219\u5237\u65b0\u534f\u8c03\u7ebf\u7a0b\u4f1a\u6709\u77ed\u6682\u7684sleep\u624d\u4f1a\u53d1\u8d77\u4e0b\u4e00\u6b21\u5237\u65b0\u3002\u671f\u671b\u662f1\u79d2\u949f\u8fdb\u884c\u4e00\u6b21\u6240\u6709buffer pool instance\u7684\u6279\u91cf\u5237\u65b0\u3002</p>"},{"location":"buffer-pool/#buffer-pool_3","title":"\u516d\u3001Buffer Pool \u72b6\u6001\u67e5\u8be2","text":"<p>InnoDB\u7f13\u51b2\u6c60\u5c06\u8868\u7684\u7d22\u5f15\u548c\u6570\u636e\u8fdb\u884c\u7f13\u5b58\uff0c\u7f13\u51b2\u6c60\u5141\u8bb8\u4ece\u5185\u5b58\u76f4\u63a5\u5904\u7406\u9891\u7e41\u4f7f\u7528\u7684\u6570\u636e\uff0c\u8fd9\u52a0\u5feb\u4e86\u5904\u7406\u901f\u5ea6\u3002\u5728\u4e13\u7528\u6570\u636e\u5e93\u670d\u52a1\u5668\u4e0a\uff0c\u901a\u5e38\u5c06\u591a\u8fbe80\uff05\u7684\u7269\u7406\u5185\u5b58\u5206\u914d\u7ed9InnoDB\u7f13\u51b2\u6c60\u3002\u56e0\u4e3aInnoDB\u7684\u5b58\u50a8\u5f15\u64ce\u7684\u5de5\u4f5c\u65b9\u5f0f\u603b\u662f\u5c06\u6570\u636e\u5e93\u6587\u4ef6\u6309\u9875\u8bfb\u53d6\u5230\u7f13\u51b2\u6c60\uff0c\u6bcf\u4e2a\u987516k\u9ed8\u8ba4\uff08innodb_page_size=16k\uff09\uff0c\u5728MySQL 5.7\u4e2d\u589e\u52a0\u4e8632KB\u548c64KB\u9875\u9762\u5927\u5c0f\u7684\u652f\u6301\uff0c\u4e4b\u524d\u7248\u672c\u662f\u4e0d\u5141\u8bb8\u5927\u4e8e16k\u7684\uff1b\u4f46\u4f60\u53ea\u80fd\u5728\u521d\u59cb\u5316MySQL\u5b9e\u4f8b\u4e4b\u524d\u8fdb\u884c\u914d\u7f6e\uff0c\u4e00\u65e6\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u5b9e\u4f8b\u7684\u9875\u9762\u5927\u5c0f\uff0c\u5c31\u4e0d\u80fd\u6539\u53d8\u5b83\uff0c\u5177\u4f53\u770binnodb_page_size\u53c2\u6570\u3002</p> <p>\u7136\u540e\u6309\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\uff08LRU\uff09\u7b97\u6cd5\u6765\u4fdd\u7559\u5728\u7f13\u51b2\u6c60\u4e2d\u7684\u7f13\u5b58\u6570\u636e\u3002\u5982\u679c\u6570\u636e\u5e93\u6587\u4ef6\u9700\u8981\u4fee\u6539\uff0c\u603b\u662f\u9996\u5148\u4fee\u6539\u5728\u7f13\u5b58\u6c60\u4e2d\u7684\u9875\uff08\u53d1\u751f\u4fee\u6539\u540e\uff0c\u8be5\u9875\u5373\u4e3a\u810f\u9875\uff09\uff0c\u7136\u540e\u518d\u6309\u7167\u4e00\u5b9a\u7684\u9891\u7387\u5c06\u7f13\u51b2\u6c60\u7684\u810f\u4e5f\u5237\u65b0\u5230\u6587\u4ef6\u4e2d\u3002\u53ef\u4ee5\u901a\u8fc7show engine innodb status\u6765\u67e5\u770binnodb_buffer_pool\u7684\u5177\u4f53\u4f7f\u7528\u60c5\u51b5\u3002\u4e00\u4e2abuffer pool\u53ef\u80fd\u4f1a\u5206\u6210\u597d\u51e0\u4e2abuffer pool instance\uff0c\u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd\u51cf\u5c11\u4e89\u7528\uff0c\u5728MySQL 5.7\u4e2d\uff0c\u5982\u679c\u4e0d\u663e\u5f0f\u8bbe\u7f6einnodb_buffer_pool_instances\u8fd9\u4e2a\u53c2\u6570\uff0c\u5f53innodb buffer size\u5927\u4e8e1G\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u9ed8\u8ba4\u4f1a\u5206\u62108\u4e2ainstances\uff0c\u5982\u679c\u5c0f\u4e8e1G\uff0c\u5c31\u53ea\u67091\u4e2ainstance\u3002\u5982\u4e0b:</p> <pre><code>mysql&gt; show engine innodb status\\G\nPer second averages calculated from the last 38 seconds\uff08\u4ee5\u4e0b\u4fe1\u606f\u6765\u4e4b\u8fc7\u53bb\u768438\u79d2\uff09\n----------------------\nBUFFER POOL AND MEMORY\n----------------------\nTotal memory allocated 1098907648; in additional pool allocated 0\nDictionary memory allocated 59957\nBuffer pool size   65536\nFree buffers  65371\nDatabase pages  165\nOld database pages  3\nModified db pages  9\n..........\n</code></pre> <p>\u5728Buffer pool size\u4e2d\u53ef\u4ee5\u770b\u5230\u5185\u5b58\u6c60\u7684\u4f7f\u7528\u60c5\u51b5\uff1a</p> <ul> <li>Total memory allocated\uff1a\u4e3a\u7f13\u51b2\u6c60\u5206\u914d\u7684\u603b\u5185\u5b58\uff08\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\uff09\u3002</li> <li>Dictionary memory allocated\uff1a\u5206\u914d\u7ed9InnoDB\u6570\u636e\u5b57\u5178\u7684\u603b\u5185\u5b58\uff08\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\uff09\u3002</li> <li>Buffer pool size\uff1a\u5206\u914d\u7ed9\u7f13\u51b2\u6c60\u7684\u9875\u9762\u603b\u6570\u91cf\uff08\u6570\u91cf*\u9875\u9762\u5927\u5c0f=\u7f13\u51b2\u6c60\u5927\u5c0f\uff09\uff0c\u9ed8\u8ba4\u6bcf\u4e2aPage\u4e3a16k\u3002</li> <li>Free buffers\uff1a\u7f13\u51b2\u6c60\u4e2d\u7a7a\u95f2\u5217\u8868\u7684\u9875\u9762\u603b\u6570\u91cf\uff08Buffer pool size \u2013 Database pages\uff09\u3002</li> <li>Database pages\uff1a\u7f13\u51b2\u6c60\u4e2dLRU LIST\u7684\u9875\u9762\u603b\u6570\u91cf\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a\u5df2\u7ecf\u4f7f\u7528\u7684\u9875\u9762\uff09\u3002</li> <li>Old database pages\uff1a\u7f13\u51b2\u6c60\u4e2dLRU old SUBLIST\u7684\u9875\u9762\u603b\u5927\u5c0f\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e0d\u7ecf\u5e38\u8bbf\u95ee\u7684\u9875\u9762\uff0c\u5373\u5c06\u53ef\u80fd\u88abLRU\u7b97\u6cd5\u6dd8\u6c70\u7684\u9875\u9762\uff09\u3002</li> <li>Modified db pages\uff1a\u7f13\u51b2\u6c60\u4e2d\u5df2\u7ecf\u4fee\u6539\u4e86\u7684\u9875\u6570\uff0c\u6240\u8c13\u810f\u6570\u636e\u3002</li> </ul> <p>\u6240\u4ee5\u8fd9\u91cc\u4e00\u5171\u5206\u914d\u4e8663336*16/1024=1G\u5185\u5b58\u7684\u7f13\u51b2\u6c60\uff0c\u7a7a\u95f265371\u4e2a\u9875\u9762\uff0c\u5df2\u7ecf\u4f7f\u7528\u4e86165\u4e2a\u9875\u9762\uff0c\u4e0d\u7ecf\u5e38\u4fee\u6539\u7684\u6570\u636e\u9875\u67093\u4e2a\uff08\u4e00\u822c\u5360\u7528\u5185\u5b58\u76841/3\uff09\uff0c\u810f\u9875\u7684\u9875\u9762\u67099\u4e2a\uff0c\u8fd9\u4e9b\u6570\u636e\u80fd\u5206\u6790\u5f53\u524d\u6570\u636e\u5e93\u7684\u538b\u529b\u503c\u3002</p>"},{"location":"buffer-pool/#innodb-buffer-pool_2","title":"\u4e03\u3001InnoDB Buffer Pool\u914d\u7f6e\u9879","text":"<ul> <li>innodb_buffer_pool_size</li> </ul> <p>\u6307\u5b9a\u7f13\u51b2\u6c60\u7684\u5927\u5c0f\u3002 \u5982\u679c\u7f13\u51b2\u6c60\u5f88\u5c0f\u5e76\u4e14\u6709\u8db3\u591f\u7684\u5185\u5b58\uff0c\u90a3\u4e48\u901a\u8fc7\u51cf\u5c11\u67e5\u8be2\u8bbf\u95eeInnoDB\u8868\u6240\u9700\u7684\u78c1\u76d8I / O\u91cf\u53ef\u4ee5\u63d0\u9ad8\u7f13\u51b2\u6c60\u7684\u6027\u80fd\uff0c\u4ece\u800c\u63d0\u9ad8\u6027\u80fd\u3002 innodb_buffer_pool_size\u9009\u9879\u662f\u52a8\u6001\u7684\uff0c\u5141\u8bb8\u5728\u4e0d\u91cd\u65b0\u542f\u52a8\u670d\u52a1\u5668\u7684\u60c5\u51b5\u4e0b\u914d\u7f6e\u7f13\u51b2\u6c60\u5927\u5c0f\u3002</p> <ul> <li>innodb_buffer_pool_chunk_size</li> </ul> <p>\u5b9a\u4e49InnoDB\u7f13\u51b2\u6c60\u8c03\u6574\u5927\u5c0f\u64cd\u4f5c\u7684\u5757\u5927\u5c0f</p> <ul> <li>innodb_buffer_pool_instances</li> </ul> <p>\u5c06\u7f13\u51b2\u6c60\u5212\u5206\u4e3a\u7528\u6237\u6307\u5b9a\u6570\u91cf\u7684\u5355\u72ec\u533a\u57df\uff0c\u6bcf\u4e2a\u533a\u57df\u90fd\u6709\u81ea\u5df1\u7684LRU\u5217\u8868\u548c\u76f8\u5173\u6570\u636e\u7ed3\u6784\uff0c\u4ee5\u51cf\u5c11\u5e76\u53d1\u5185\u5b58\u8bfb\u53d6\u548c\u5199\u5165\u64cd\u4f5c\u671f\u95f4\u7684\u4e89\u7528\u3002 \u53ea\u6709\u5c06innodb_buffer_pool_size\u8bbe\u7f6e\u4e3a1GB\u6216\u66f4\u5927\u7684\u503c\u65f6\uff0c\u6b64\u9009\u9879\u624d\u4f1a\u751f\u6548\u3002 \u60a8\u6307\u5b9a\u7684\u603b\u5927\u5c0f\u88ab\u5206\u914d\u5230\u6240\u6709\u7f13\u51b2\u6c60\u4e2d\u3002 \u4e3a\u4e86\u83b7\u5f97\u6700\u4f73\u6548\u7387\uff0c\u8bf7\u6307\u5b9ainnodb_buffer_pool_instances\u548cinnodb_buffer_pool_size\u7684\u7ec4\u5408\uff0c\u4ee5\u4fbf\u6bcf\u4e2a\u7f13\u51b2\u6c60\u5b9e\u4f8b\u81f3\u5c11\u4e3a1 GB\u3002</p> <ul> <li>innodb_old_blocks_pct</li> </ul> <p>\u6307\u5b9aInnoDB\u7528\u4e8e\u65e7\u5757\u5b50\u5217\u8868\u7684\u7f13\u51b2\u6c60\u7684\u8fd1\u4f3c\u767e\u5206\u6bd4\u3002 \u503c\u7684\u8303\u56f4\u662f5\u523095.\u9ed8\u8ba4\u503c\u662f37\uff08\u5373\u6c60\u76843/8\uff09\u3002</p> <ul> <li>innodb_old_blocks_time</li> </ul> <p>\u6307\u5b9a\u63d2\u5165\u5230\u65e7\u5b50\u5217\u8868\u4e2d\u7684\u9875\u9762\u5728\u7b2c\u4e00\u6b21\u8bbf\u95ee\u540e\u5fc5\u987b\u5728\u6beb\u79d2\uff08ms\uff09\u5185\u4fdd\u7559\u591a\u957f\u65f6\u95f4\uff0c\u7136\u540e\u624d\u80fd\u79fb\u52a8\u5230\u65b0\u5b50\u5217\u8868\u4e2d\u3002 \u5982\u679c\u503c\u4e3a0\uff0c\u5219\u65e0\u8bba\u63d2\u5165\u540e\u4f55\u65f6\u53d1\u751f\u8bbf\u95ee\uff0c\u63d2\u5165\u65e7\u5b50\u5217\u8868\u7684\u9875\u9762\u5728\u7b2c\u4e00\u6b21\u8bbf\u95ee\u65f6\u90fd\u4f1a\u7acb\u5373\u79fb\u81f3\u65b0\u5b50\u5217\u8868\u3002 \u5982\u679c\u8be5\u503c\u5927\u4e8e0\uff0c\u5219\u9875\u9762\u5c06\u4fdd\u7559\u5728\u65e7\u7684\u5b50\u5217\u8868\u4e2d\uff0c\u76f4\u5230\u5728\u7b2c\u4e00\u6b21\u8bbf\u95ee\u540e\u81f3\u5c11\u51e0\u6beb\u79d2\u5185\u53d1\u751f\u8bbf\u95ee\u3002 \u4f8b\u5982\uff0c\u503c\u4e3a1000\uff08\u9ed8\u8ba4\u503c\uff09\u4f1a\u5bfc\u81f4\u9875\u9762\u5728\u7b2c\u4e00\u6b21\u8bbf\u95ee\u540e\u505c\u7559\u5728\u65e7\u5b50\u8868\u4e2d1\u79d2\u949f\uff0c\u7136\u540e\u624d\u6709\u8d44\u683c\u79fb\u52a8\u5230\u65b0\u5b50\u5217\u8868\u3002</p> <p>\u5c06innodb_old_blocks_time\u8bbe\u7f6e\u4e3a\u5927\u4e8e0\u53ef\u9632\u6b62\u4e00\u6b21\u6027\u8868\u626b\u63cf\u4f7f\u7528\u4ec5\u7528\u4e8e\u626b\u63cf\u7684\u9875\u9762\u586b\u5145\u65b0\u7684\u5b50\u5217\u8868\u3002 \u8bfb\u53d6\u7684\u626b\u63cf\u9875\u9762\u4e2d\u7684\u884c\u4f1a\u8fde\u7eed\u5feb\u901f\u8bbf\u95ee\u591a\u6b21\uff0c\u4f46\u8be5\u9875\u9762\u5728\u6b64\u4e4b\u540e\u672a\u88ab\u4f7f\u7528\u3002 \u5982\u679cinnodb_old_blocks_time\u8bbe\u7f6e\u4e3a\u5927\u4e8e\u5904\u7406\u9875\u9762\u7684\u65f6\u95f4\u7684\u503c\uff0c\u5219\u8be5\u9875\u9762\u4fdd\u7559\u5728\u201c\u65e7\u201d\u5b50\u5217\u8868\u4e2d\uff0c\u5e76\u4e14\u8001\u5316\u5230\u5217\u8868\u7684\u5c3e\u90e8\u4ee5\u88ab\u5feb\u901f\u9a71\u9010\u3002 \u8fd9\u6837\uff0c\u4ec5\u7528\u4e8e\u4e00\u6b21\u626b\u63cf\u7684\u9875\u9762\u4e0d\u4f1a\u5f71\u54cd\u65b0\u5b50\u5217\u8868\u4e2d\u5927\u91cf\u4f7f\u7528\u7684\u9875\u9762\u3002</p> <p>innodb_old_blocks_time\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u8bbe\u7f6e\u3002</p> <ul> <li>innodb_read_ahead_threshold</li> </ul> <p>\u63a7\u5236InnoDB\u7528\u4e8e\u9884\u53d6\u9875\u9762\u5230\u7f13\u51b2\u6c60\u4e2d\u7684\u7ebf\u6027\u9884\u8bfb\u7684\u7075\u654f\u5ea6\u3002</p> <ul> <li>innodb_random_read_ahead</li> </ul> <p>\u4f7f\u7528\u968f\u673a\u9884\u8bfb\u6280\u672f\u5c06\u9875\u9762\u9884\u53d6\u5230\u7f13\u51b2\u6c60\u4e2d\u3002 \u968f\u673a\u9884\u8bfb\u662f\u4e00\u9879\u6280\u672f\uff0c\u53ef\u6839\u636e\u7f13\u51b2\u6c60\u4e2d\u5df2\u6709\u7684\u9875\u9762\u5feb\u901f\u9884\u6d4b\u4f55\u65f6\u9700\u8981\u9875\u9762\uff0c\u800c\u4e0d\u7ba1\u8fd9\u4e9b\u9875\u9762\u7684\u8bfb\u53d6\u987a\u5e8f\u5982\u4f55\u3002 innodb_random_read_ahead\u9ed8\u8ba4\u662f\u7981\u7528\u7684\u3002</p> <ul> <li>innodb_adaptive_flushing</li> </ul> <p>\u6307\u5b9a\u662f\u5426\u6839\u636e\u5de5\u4f5c\u8d1f\u8f7d\u52a8\u6001\u8c03\u6574\u7f13\u51b2\u6c60\u4e2d\u5237\u65b0\u810f\u9875\u7684\u901f\u7387\u3002 \u52a8\u6001\u8c03\u6574\u51b2\u5237\u901f\u7387\u65e8\u5728\u907f\u514dI / O\u6d3b\u52a8\u7684\u7206\u53d1\u3002 \u8be5\u8bbe\u7f6e\u9ed8\u8ba4\u542f\u7528\u3002</p> <ul> <li>innodb_flush_neighbors</li> </ul> <p>\u6307\u5b9a\u662f\u5426\u4ece\u7f13\u51b2\u6c60\u4e2d\u6e05\u9664\u9875\u9762\u4e5f\u4f1a\u5728\u76f8\u540c\u8303\u56f4\u5185\u5237\u65b0\u5176\u4ed6\u810f\u9875\u9762\u3002\u9ed8\u8ba4\u662f1 \u542f\u7528\u3002</p> <ul> <li>innodb_flushing_avg_loops</li> </ul> <p>InnoDB\u4fdd\u5b58\u4e4b\u524d\u8ba1\u7b97\u7684\u5237\u65b0\u72b6\u6001\u5feb\u7167\u7684\u8fed\u4ee3\u6b21\u6570\uff0c\u63a7\u5236\u81ea\u9002\u5e94\u5237\u65b0\u5bf9\u66f4\u6539\u5de5\u4f5c\u8d1f\u8f7d\u7684\u54cd\u5e94\u901f\u5ea6\u3002\u9ed8\u8ba4\u662f 30</p> <ul> <li>innodb_lru_scan_depth</li> </ul> <p>\u5f71\u54cd\u7f13\u51b2\u6c60\u5237\u65b0\u64cd\u4f5c\u7684\u7b97\u6cd5\u548c\u542f\u53d1\u5f0f\u7684\u53c2\u6570\u3002 \u6027\u80fd\u4e3b\u8981\u5173\u6ce8\u8c03\u6574I / O\u5bc6\u96c6\u578b\u5de5\u4f5c\u8d1f\u8f7d\u3002 \u5b83\u4e3a\u6bcf\u4e2a\u7f13\u51b2\u6c60\u5b9e\u4f8b\u6307\u5b9a\u4e86\u7f13\u51b2\u6c60LRU\u4e0b\u591a\u8fdc\uff0cpage_cleaner\u7ebf\u7a0b\u626b\u63cf\u5bfb\u627e\u8981\u5237\u65b0\u7684\u810f\u9875\u3002\u9ed8\u8ba4\u662f1024</p> <ul> <li>innodb_max_dirty_pages_pct</li> </ul> <p>InnoDB\u4f1a\u5c1d\u8bd5\u4ece\u7f13\u51b2\u6c60\u4e2d\u5237\u65b0\u6570\u636e\uff0c\u4ee5\u4fbf\u810f\u9875\u9762\u7684\u767e\u5206\u6bd4\u4e0d\u8d85\u8fc7\u6b64\u503c\u3002 \u6307\u5b9a\u8303\u56f4\u4ece0\u523099\u7684\u6574\u6570\u3002\u9ed8\u8ba4\u503c\u4e3a75\u3002</p> <ul> <li>innodb_max_dirty_pages_pct_lwm</li> </ul> <p>\u4f4e\u6c34\u4f4d\u7684\u767e\u5206\u6bd4\u8868\u793a\u542f\u7528\u6765\u63a7\u5236\u810f\u9875\u9884flush\u7684\u6bd4\u7387\u3002 \u9ed8\u8ba4\u503c\u4e3a0\u5c06\u5b8c\u5168\u7981\u7528\u9884\u51b2\u6d17\u884c\u4e3a\u3002\u9ed8\u8ba4\u662f0</p> <ul> <li>innodb_buffer_pool_filename</li> </ul> <p>\u6307\u5b9a\u4fdd\u5b58\u7531innodb_buffer_pool_dump_at_shutdown\u6216innodb_buffer_pool_dump_now\u751f\u6210\u7684\u8868\u7a7a\u95f4ID\u548c\u9875\u9762ID\u5217\u8868\u7684\u6587\u4ef6\u7684\u540d\u79f0\u3002</p> <ul> <li>innodb_buffer_pool_dump_at_shutdown</li> </ul> <p>\u6307\u5b9a\u5728MySQL\u670d\u52a1\u5668\u5173\u95ed\u65f6\u662f\u5426\u8bb0\u5f55\u7f13\u51b2\u6c60\u4e2d\u7f13\u5b58\u7684\u9875\u9762\uff0c\u4ee5\u7f29\u77ed\u4e0b\u6b21\u91cd\u65b0\u542f\u52a8\u65f6\u7684\u9884\u70ed\u8fc7\u7a0b\u3002\u9ed8\u8ba4\u662f\u542f\u7528</p> <ul> <li>innodb_buffer_pool_load_at_startup</li> </ul> <p>\u6307\u5b9a\u5728MySQL\u670d\u52a1\u5668\u542f\u52a8\u65f6\uff0c\u901a\u8fc7\u52a0\u8f7d\u5b83\u5728\u5148\u524d\u4fdd\u5b58\u7684\u76f8\u540c\u9875\u9762\uff0c\u7f13\u51b2\u6c60\u81ea\u52a8\u9884\u70ed\u3002 \u901a\u5e38\u4e0einnodb_buffer_pool_dump_at_shutdown\u7ed3\u5408\u4f7f\u7528\u3002\u9ed8\u8ba4\u662fon</p> <ul> <li>innodb_buffer_pool_dump_now</li> </ul> <p>\u7acb\u5373\u8bb0\u5f55\u5728\u7f13\u51b2\u6c60\u4e2d\u7f13\u5b58\u7684\u9875\u9762\u3002\u9ed8\u8ba4\u662fOFF</p> <ul> <li>innodb_buffer_pool_load_now</li> </ul> <p>\u7acb\u5373\u901a\u8fc7\u52a0\u8f7d\u4e00\u7ec4\u6570\u636e\u9875\u9762\u6765\u52a0\u70ed\u7f13\u51b2\u6c60\uff0c\u800c\u65e0\u9700\u7b49\u5f85\u670d\u52a1\u5668\u91cd\u65b0\u542f\u52a8\u3002 \u5728\u57fa\u51c6\u6d4b\u8bd5\u671f\u95f4\u5c06\u9ad8\u901f\u7f13\u5b58\u6062\u590d\u5230\u5df2\u77e5\u72b6\u6001\uff0c\u6216\u8005\u5728\u8fd0\u884c\u67e5\u8be2\u62a5\u544a\u6216\u7ef4\u62a4\u540e\uff0c\u4f7fMySQL\u670d\u52a1\u5668\u6062\u590d\u6b63\u5e38\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u53ef\u80fd\u4f1a\u5f88\u6709\u7528\u3002 \u901a\u5e38\u4e0einnodb_buffer_pool_dump_now\u4e00\u8d77\u4f7f\u7528\u3002</p> <ul> <li>innodb_buffer_pool_dump_pct</li> </ul> <p>\u6307\u5b9a\u6bcf\u4e2a\u7f13\u51b2\u6c60\u8bfb\u51fa\u548c\u8f6c\u50a8\u7684\u6700\u8fd1\u4f7f\u7528\u9875\u9762\u7684\u767e\u5206\u6bd4\u3002 \u8303\u56f4\u662f1\u5230100\u3002\u9ed8\u8ba4\u662f25</p> <ul> <li>innodb_buffer_pool_load_abort</li> </ul> <p>\u4e2d\u65ad\u7531innodb_buffer_pool_load_at_startup\u6216innodb_buffer_pool_load_now\u89e6\u53d1\u7684\u7f13\u51b2\u6c60\u5185\u5bb9\u6062\u590d\u8fc7\u7a0b\u3002\u9ed8\u8ba4\u662fOFF</p>"},{"location":"buffer-pool/#innodb","title":"\u516b\u3001\u914d\u7f6eInnoDB\u7f13\u51b2\u6c60\u6848\u4f8b","text":"<p>\u4ee5\u914d\u7f6eInnoDB\u7f13\u51b2\u6c60\u7684\u5404\u4e2a\u65b9\u9762\u6765\u63d0\u9ad8\u6027\u80fd\u3002</p> <ul> <li>\u7406\u60f3\u60c5\u51b5\u4e0b\uff0c\u4f60\u5c06\u7f13\u51b2\u6c60\u7684\u5927\u5c0f\u8bbe\u7f6e\u4e3a\u5c3d\u53ef\u80fd\u5927\u7684\u503c\uff0c\u4e00\u822cbuffer pool\u7684\u5927\u5c0f\u4e3a\u7269\u7406\u5185\u5b58\u768470%-80%\u3002\u7f13\u51b2\u6c60\u8d8a\u5927\uff0cInnoDB\u5185\u5b58\u6570\u636e\u5e93\u7684\u884c\u4e3a\u8d8a\u591a\uff0c\u4ece\u78c1\u76d8\u8bfb\u53d6\u6570\u636e\u4e00\u6b21\uff0c\u7136\u540e\u5728\u540e\u7eed\u8bfb\u53d6\u671f\u95f4\u4ece\u5185\u5b58\u8bbf\u95ee\u6570\u636e\u3002</li> <li>\u5bf9\u4e8e\u5177\u6709\u5927\u5185\u5b58\u768464\u4f4d\u7cfb\u7edf\uff0c\u4f60\u53ef\u4ee5\u5c06\u7f13\u51b2\u6c60\u62c6\u5206\u6210\u591a\u4e2a\u5b9e\u4f8b\uff08\u9ed8\u8ba48\u4e2a\uff09\uff0c\u4ee5\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5e76\u53d1\u64cd\u4f5c\u4e2d\u5185\u5b58\u7ed3\u6784\u7684\u4e89\u7528\u3002</li> </ul> <p>8.1 \u914d\u7f6eInnoDB\u7f13\u51b2\u6c60\u5927\u5c0f</p> <p>8.1.1 \u5728\u7ebf\u914d\u7f6eInnoDB\u7f13\u51b2\u6c60\u5927\u5c0f</p> <p>\u7f13\u51b2\u6c60\u652f\u6301\u8131\u673a\u548c\u8054\u673a\u4e24\u79cd\u914d\u7f6e\u65b9\u5f0f\uff0c\u5f53\u589e\u52a0\u6216\u51cf\u5c11innodb_buffer_pool_size\u65f6\uff0c\u64cd\u4f5c\u4ee5\u5757\uff08chunk\uff09\u5f62\u5f0f\u6267\u884c\u3002\u5757\u5927\u5c0f\u7531innodb_buffer_pool_chunk_size\u914d\u7f6e\u9009\u9879\u5b9a\u4e49\uff0c\u9ed8\u8ba4\u503c128M\u3002</p> <p>\u5728\u7ebf\u914d\u7f6eInnoDB\u7f13\u51b2\u6c60\u5927\u5c0f\uff0c\u8be5innodb_buffer_pool_size\u914d\u7f6e\u9009\u9879\u53ef\u4ee5\u52a8\u6001\u4f7f\u7528\u8bbe\u7f6eSET\u58f0\u660e\uff0c\u8ba9\u4f60\u8c03\u6574\u7f13\u51b2\u6c60\u65e0\u9700\u91cd\u65b0\u542f\u52a8\u670d\u52a1\u5668\u3002\u4f8b\u5982\uff1a</p> <pre><code>mysql&gt; SET GLOBAL innodb_buffer_pool_size=8589934592;\n</code></pre> <p>\u7f13\u51b2\u6c60\u5927\u5c0f\u914d\u7f6e\u5fc5\u987b\u59cb\u7ec8\u7b49\u4e8einnodb_buffer_pool_chunk_sizeinnodb_buffer_pool_instances\u7684\u500d\u6570\u3002\u5982\u679c\u914d\u7f6einnodb_buffer_pool_size\u4e3a\u4e0d\u7b49\u4e8einnodb_buffer_pool_chunk_sizeinnodb_buffer_pool_instances\u7684\u500d\u6570\uff0c\u5219\u7f13\u51b2\u6c60\u5927\u5c0f\u5c06\u81ea\u52a8\u8c03\u6574\u4e3a\u7b49\u4e8e\u6216\u4e0d\u5c0f\u4e8e\u6307\u5b9a\u7f13\u51b2\u6c60\u5927\u5c0f\u7684innodb_buffer_pool_chunk_size*innodb_buffer_pool_instances\u7684\u500d\u6570\u3002</p> <p>\u5728\u4ee5\u4e0b\u793a\u4f8b\u4e2d\uff0c innodb_buffer_pool_size\u8bbe\u7f6e\u4e3a8G\uff0cinnodb_buffer_pool_instances\u8bbe\u7f6e\u4e3a16\uff0cinnodb_buffer_pool_chunk_size\u662f128M\uff0c\u8fd9\u662f\u9ed8\u8ba4\u503c\u30028G\u662f\u4e00\u4e2a\u6709\u6548\u7684innodb_buffer_pool_size\u503c\uff0c\u56e0\u4e3a\u5b83\u662finnodb_buffer_pool_instances=16\u4e58\u4ee5innodb_buffer_pool_chunk_size=128M\u7684\u500d\u6570\u3002</p> <pre><code>mysql&gt; select 8*1024 / (16*128);\n+-------------------+\n| 8*1024 / (16*128) |\n+-------------------+\n|            4.0000 |\n+-------------------+\n1 row in set (0.00 sec)\n</code></pre> <p>\u5982\u679cinnodb_buffer_pool_size\u8bbe\u7f6e\u4e3a9G\uff0cinnodb_buffer_pool_instances\u8bbe\u7f6e\u4e3a16\uff0c innodb_buffer_pool_chunk_size\u662f128M\uff0c\u8fd9\u662f\u9ed8\u8ba4\u503c\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c 9G\u4e0d\u662finnodb_buffer_pool_instances=16innodb_buffer_pool_chunk_size=128M\u7684\u500d\u6570 \uff0c \u6240\u4ee5innodb_buffer_pool_size\u88ab\u8c03\u6574\u4e3a10G\uff0c\u8fd9\u662f\u4e0d\u5c0f\u4e8e\u6307\u5b9a\u7f13\u51b2\u6c60\u5927\u5c0f\u7684\u4e0b\u4e00\u4e2ainnodb_buffer_pool_chunk_sizeinnodb_buffer_pool_instances\u7684\u500d\u6570\u3002</p> <p>8.1.2 \u76d1\u63a7\u5728\u7ebf\u7f13\u51b2\u6c60\u8c03\u6574\u5927\u5c0f\u8fdb\u5ea6</p> <p>\u8be5Innodb_buffer_pool_resize_status\u62a5\u544a\u7f13\u51b2\u6c60\u5927\u5c0f\u8c03\u6574\u7684\u8fdb\u5c55\u3002\u4f8b\u5982\uff1a</p> <pre><code>mysql&gt; SHOW STATUS WHERE Variable_name ='InnoDB_buffer_pool_resize_status';\n+----------------------------------+-------+\n| Variable_name                    | Value |\n+----------------------------------+-------+\n| Innodb_buffer_pool_resize_status |       |\n+----------------------------------+-------+\n1 row in set (0.01 sec)\n</code></pre> <p>8.2 \u8131\u673a\u914d\u7f6eInnoDB\u7f13\u51b2\u6c60\u5757\uff08chunk\uff09\u5927\u5c0f</p> <p>innodb_buffer_pool_chunk_size\u53ef\u4ee5\u57281MB\uff081048576\u5b57\u8282\uff09\u5355\u4f4d\u4e2d\u589e\u52a0\u6216\u51cf\u5c11\uff0c\u4f46\u53ea\u80fd\u5728\u542f\u52a8\u65f6\uff0c\u5728\u547d\u4ee4\u884c\u5b57\u7b26\u4e32\u6216MySQL\u914d\u7f6e\u6587\u4ef6\u4e2d\u8fdb\u884c\u4fee\u6539\u3002</p> <pre><code>[mysqld]\ninnodb_buffer_pool_chunk_size = 134217728\n</code></pre> <p>\u4fee\u6539innodb_buffer_pool_chunk_size\u65f6\u9002\u7528\u4ee5\u4e0b\u6761\u4ef6\uff1a</p> <p>\u5982\u679c\u65b0innodb_buffer_pool_chunk_size\u503c\u4e58\u4ee5innodb_buffer_pool_instances\u5927\u4e8e\u521d\u59cb\u5316\u7f13\u51b2\u6c60\u5927\u5c0f\u65f6\uff0c innodb_buffer_pool_chunk_size\u5219\u622a\u65ad\u4e3ainnodb_buffer_pool_size / innodb_buffer_pool_instances\u3002</p> <p>\u4f8b\u5982\uff0c\u5982\u679c\u7f13\u51b2\u6c60\u521d\u59cb\u5316\u5927\u5c0f\u4e3a2GB\uff082147483648\u5b57\u8282\uff09\uff0c 4\u4e2a\u7f13\u51b2\u6c60\u5b9e\u4f8b\u548c\u5757\u5927\u5c0f1GB\uff081073741824\u5b57\u8282\uff09\uff0c\u5219\u5757\u5927\u5c0f\u5c06\u88ab\u622a\u65ad\u4e3a\u7b49\u4e8einnodb_buffer_pool_size / innodb_buffer_pool_instances\uff0c\u503c\u4e3a\uff1a</p> <pre><code>mysql&gt; select 2147483648 / 4;\n+----------------+\n| 2147483648 / 4 |\n+----------------+\n| 536870912.0000 |\n+----------------+\n1 row in set (0.00 sec)\n</code></pre> <p>\u7f13\u51b2\u6c60\u5927\u5c0f\u5fc5\u987b\u59cb\u7ec8\u7b49\u4e8e\u6216\u4e0d\u5c0f\u4e8einnodb_buffer_pool_chunk_size * innodb_buffer_pool_instances\u7684\u500d\u6570\u3002\u5982\u679c\u66f4\u6539innodb_buffer_pool_chunk_size\uff0cinnodb_buffer_pool_size\u5219\u4f1a\u81ea\u52a8\u8c03\u6574\u4e3a\u7b49\u4e8e\u6216\u4e0d\u5c0f\u4e8e\u5f53\u524d\u7f13\u51b2\u6c60\u5927\u5c0f\u7684innodb_buffer_pool_chunk_size * innodb_buffer_pool_instances\u7684\u500d\u6570\u3002\u7f13\u51b2\u6c60\u521d\u59cb\u5316\u65f6\u4f1a\u53d1\u751f\u8c03\u6574\u3002</p> <p>\u66f4\u6539\u65f6\u5e94\u5c0f\u5fc3innodb_buffer_pool_chunk_size\uff0c\u56e0\u4e3a\u66f4\u6539\u6b64\u503c\u53ef\u4ee5\u589e\u52a0\u7f13\u51b2\u6c60\u7684\u5927\u5c0f\uff0c\u5982\u4e0a\u9762\u7684\u793a\u4f8b\u6240\u793a\u3002\u5728\u66f4\u6539innodb_buffer_pool_chunk_size\u4e4b\u524d\uff0c\u8ba1\u7b97innodb_buffer_pool_size\u4ee5\u786e\u4fdd\u751f\u6210\u7684\u7f13\u51b2\u6c60\u5927\u5c0f\u662f\u53ef\u63a5\u53d7\u7684\u3002</p> <p>8.3 \u914d\u7f6e\u591a\u4e2a\u7f13\u51b2\u6c60\u5b9e\u4f8b</p> <p>\u5bf9\u4e8e\u5177\u6709\u591aGB\u7ea7\u7f13\u51b2\u6c60\u7684\u7cfb\u7edf\uff0c\u5c06\u7f13\u51b2\u6c60\u5212\u5206\u4e3a\u5355\u72ec\u7684\u5b9e\u4f8b\u53ef\u4ee5\u901a\u8fc7\u51cf\u5c11\u4e0d\u540c\u7ebf\u7a0b\u8bfb\u53d6\u548c\u5199\u5165\u7f13\u5b58\u9875\u9762\u7684\u4e89\u7528\u6765\u63d0\u9ad8\u5e76\u53d1\u6027\u3002\u6b64\u529f\u80fd\u901a\u5e38\u9002\u7528\u4e8e\u7f13\u51b2\u6c60\u5927\u5c0f\u5728\u5343\u5146\u5b57\u8282\u8303\u56f4\u5185\u7684\u7cfb\u7edf\u3002\u4f7f\u7528innodb_buffer_pool_instances\u914d\u7f6e\u9009\u9879\u914d\u7f6e\u591a\u4e2a\u7f13\u51b2\u6c60\u5b9e\u4f8b\uff0c\u4f60\u4e5f\u53ef\u4ee5\u8c03\u6574\u8be5innodb_buffer_pool_size\u503c\u3002</p> <p>\u5f53InnoDB\u7f13\u51b2\u6c60\u5927\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ece\u5185\u5b58\u68c0\u7d22\u6765\u6ee1\u8db3\u8bb8\u591a\u6570\u636e\u8bf7\u6c42\u3002\u4f60\u53ef\u80fd\u4f1a\u9047\u5230\u591a\u4e2a\u8bf7\u6c42\u4e00\u6b21\u8bbf\u95ee\u7f13\u51b2\u6c60\u7684\u7ebf\u7a0b\u7684\u74f6\u9888\u3002\u4f60\u53ef\u4ee5\u542f\u7528\u591a\u4e2a\u7f13\u51b2\u6c60\u4ee5\u6700\u5c0f\u5316\u6b64\u4e89\u7528\u3002\u4f7f\u7528\u6563\u5217\u51fd\u6570\uff0c\u5c06\u7f13\u51b2\u6c60\u4e2d\u5b58\u50a8\u6216\u8bfb\u53d6\u7684\u6bcf\u4e2a\u9875\u9762\u968f\u673a\u5206\u914d\u7ed9\u5176\u4e2d\u4e00\u4e2a\u7f13\u51b2\u6c60\u3002\u6bcf\u4e2a\u7f13\u51b2\u6c60\u7ba1\u7406\u81ea\u5df1\u7684\u7a7a\u95f2\u5217\u8868\uff0c\u5237\u65b0\u5217\u8868\uff0cLRU\u548c\u8fde\u63a5\u5230\u7f13\u51b2\u6c60\u7684\u6240\u6709\u5176\u4ed6\u6570\u636e\u7ed3\u6784\uff0c\u5e76\u7531\u5176\u81ea\u5df1\u7684\u7f13\u51b2\u6c60\u4e92\u65a5\u9501\u4fdd\u62a4\u3002</p> <p>\u8981\u542f\u7528\u591a\u4e2a\u7f13\u51b2\u6c60\u5b9e\u4f8b\uff0c\u8bf7\u5c06innodb_buffer_pool_instances\u914d\u7f6e\u9009\u9879\u8bbe\u7f6e\u4e3a\u5927\u4e8e1\uff08\u9ed8\u8ba4\u503c\uff09\u9ad8\u8fbe64\uff08\u6700\u5927\u503c\uff09\u7684\u503c\u3002\u6b64\u9009\u9879\u4ec5\u5728\u8bbe\u7f6einnodb_buffer_pool_size\u4e3a1GB\u6216\u66f4\u5927\u7684\u5927\u5c0f\u65f6\u751f\u6548\u3002\u4f60\u6307\u5b9a\u7684\u603b\u5927\u5c0f\u5728\u6240\u6709\u7f13\u51b2\u6c60\u4e4b\u95f4\u5206\u914d\uff0c\u4e3a\u4e86\u83b7\u5f97\u6700\u4f73\u6548\u7387\uff0c\u6307\u5b9a\u7684\u7ec4\u5408innodb_buffer_pool_instances\u548cinnodb_buffer_pool_size\uff0c\u4f7f\u5f97\u6bcf\u4e2a\u7f13\u51b2\u6c60\u5b9e\u4f8b\u662f\u81f3\u5c11\u4e3a1GB\u3002\u5728MySQL 5.7\u4e2d\uff0c\u5982\u679c\u4e0d\u663e\u5f0f\u8bbe\u7f6einnodb_buffer_pool_instances\u8fd9\u4e2a\u53c2\u6570\uff0c\u5f53innodb buffer size\u5927\u4e8e1G\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u9ed8\u8ba4\u4f1a\u5206\u62108\u4e2ainstances\uff0c\u5982\u679c\u5c0f\u4e8e1G\uff0c\u5c31\u53ea\u67091\u4e2ainstance\u3002</p> <p>8.4 \u914d\u7f6eInnoDB\u7f13\u51b2\u6c60\u9884\u8bfb</p> <p>InnoDB\u5728io\u7684\u4f18\u5316\u4e0a\u6709\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u7279\u6027\u4e3a\u9884\u8bfb\uff0c\u9884\u8bfb\u8bf7\u6c42\u662f\u4e00\u4e2ai/o\u8bf7\u6c42\uff0c\u5b83\u4f1a\u5f02\u6b65\u5730\u5728\u7f13\u51b2\u6c60\u4e2d\u9884\u5148\u56de\u8fc1\u591a\u4e2a\u9875\u9762\uff0c\u9884\u8ba1\u5f88\u5feb\u5c31\u4f1a\u9700\u8981\u8fd9\u4e9b\u9875\u9762\uff0c\u8fd9\u4e9b\u8bf7\u6c42\u5728\u4e00\u4e2a\u8303\u56f4\u5185\u5f15\u5165\u6240\u6709\u9875\u9762\u3002InnoDB\u4ee564\u4e2apage\u4e3a\u4e00\u4e2aextent\uff0c\u90a3\u4e48InnoDB\u7684\u9884\u8bfb\u662f\u4ee5page\u4e3a\u5355\u4f4d\u8fd8\u662f\u4ee5extent\uff1f</p> <p>\u8fd9\u6837\u5c31\u8fdb\u5165\u4e86\u4e0b\u9762\u7684\u8bdd\u9898\uff0cInnoDB\u4f7f\u7528\u4e24\u79cd\u9884\u8bfb\u7b97\u6cd5\u6765\u63d0\u9ad8I/O\u6027\u80fd\uff1a\u7ebf\u6027\u9884\u8bfb\uff08linear read-ahead\uff09\u548c\u968f\u673a\u9884\u8bfb\uff08randomread-ahead\uff09</p> <p>\u4e3a\u4e86\u533a\u5206\u8fd9\u4e24\u79cd\u9884\u8bfb\u7684\u65b9\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u7ebf\u6027\u9884\u8bfb\u653e\u5230\u4ee5extent\u4e3a\u5355\u4f4d\uff0c\u800c\u968f\u673a\u9884\u8bfb\u653e\u5230\u4ee5extent\u4e2d\u7684page\u4e3a\u5355\u4f4d\u3002\u7ebf\u6027\u9884\u8bfb\u7740\u773c\u4e8e\u5c06\u4e0b\u4e00\u4e2aextent\u63d0\u524d\u8bfb\u53d6\u5230buffer pool\u4e2d\uff0c\u800c\u968f\u673a\u9884\u8bfb\u7740\u773c\u4e8e\u5c06\u5f53\u524dextent\u4e2d\u7684\u5269\u4f59\u7684page\u63d0\u524d\u8bfb\u53d6\u5230buffer pool\u4e2d\u3002</p> <p>8.4.1 \u7ebf\u6027\u9884\u8bfb\uff08linear read-ahead\uff09</p> <p>\u5b83\u53ef\u4ee5\u6839\u636e\u987a\u5e8f\u8bbf\u95ee\u7f13\u51b2\u6c60\u4e2d\u7684\u9875\u9762\uff0c\u9884\u6d4b\u54ea\u4e9b\u9875\u9762\u53ef\u80fd\u9700\u8981\u5f88\u5feb\u3002\u901a\u8fc7\u4f7f\u7528\u914d\u7f6e\u53c2\u6570innodb_read_ahead_threshold\uff0c\u901a\u8fc7\u8c03\u6574\u89e6\u53d1\u5f02\u6b65\u8bfb\u53d6\u8bf7\u6c42\u6240\u9700\u7684\u987a\u5e8f\u9875\u8bbf\u95ee\u6570\uff0c\u53ef\u4ee5\u63a7\u5236Innodb\u6267\u884c\u63d0\u524d\u8bfb\u64cd\u4f5c\u7684\u65f6\u95f4\u3002\u5728\u6dfb\u52a0\u6b64\u53c2\u6570\u4e4b\u524d\uff0cInnoDB\u53ea\u4f1a\u8ba1\u7b97\u5f53\u5728\u5f53\u524d\u8303\u56f4\u7684\u6700\u540e\u4e00\u9875\u4e2d\u8bfb\u53d6\u6574\u4e2a\u4e0b\u4e00\u4e2a\u533a\u6bb5\u65f6\u662f\u5426\u53d1\u51fa\u5f02\u6b65\u9884\u53d6\u8bf7\u6c42\u3002</p> <p>\u7ebf\u6027\u9884\u8bfb\u65b9\u5f0f\u6709\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u53d8\u91cf\u63a7\u5236\u662f\u5426\u5c06\u4e0b\u4e00\u4e2aextent\u9884\u8bfb\u5230buffer pool\u4e2d\uff0c\u901a\u8fc7\u4f7f\u7528\u914d\u7f6e\u53c2\u6570innodb_read_ahead_threshold\uff0c\u53ef\u4ee5\u63a7\u5236Innodb\u6267\u884c\u9884\u8bfb\u64cd\u4f5c\u7684\u65f6\u95f4\u3002\u5982\u679c\u4e00\u4e2aextent\u4e2d\u7684\u88ab\u987a\u5e8f\u8bfb\u53d6\u7684page\u8d85\u8fc7\u6216\u8005\u7b49\u4e8e\u8be5\u53c2\u6570\u53d8\u91cf\u65f6\uff0cInnodb\u5c06\u4f1a\u5f02\u6b65\u7684\u5c06\u4e0b\u4e00\u4e2aextent\u8bfb\u53d6\u5230buffer pool\u4e2d\uff0cinnodb_read_ahead_threshold\u53ef\u4ee5\u8bbe\u7f6e\u4e3a0-64\u7684\u4efb\u4f55\u503c\uff0c\u9ed8\u8ba4\u503c\u4e3a56\uff0c\u503c\u8d8a\u9ad8\uff0c\u8bbf\u95ee\u6a21\u5f0f\u68c0\u67e5\u8d8a\u4e25\u683c\u3002</p> <pre><code>mysql&gt; show global variables like '%innodb_read_ahead_threshold%';\n+-----------------------------+-------+\n| Variable_name               | Value |\n+-----------------------------+-------+\n| innodb_read_ahead_threshold | 56    |\n+-----------------------------+-------+\n1 row in set (0.00 sec)\n</code></pre> <p>\u4f8b\u5982\uff0c\u5982\u679c\u5c06\u503c\u8bbe\u7f6e\u4e3a48\uff0c\u5219InnoDB\u53ea\u6709\u5728\u987a\u5e8f\u8bbf\u95ee\u5f53\u524dextent\u4e2d\u768448\u4e2apages\u65f6\u624d\u89e6\u53d1\u7ebf\u6027\u9884\u8bfb\u8bf7\u6c42\uff0c\u5c06\u4e0b\u4e00\u4e2aextent\u8bfb\u5230\u5185\u5b58\u4e2d\u3002\u5982\u679c\u503c\u4e3a8\uff0cInnoDB\u89e6\u53d1\u5f02\u6b65\u9884\u8bfb\uff0c\u5373\u4f7f\u7a0b\u5e8f\u6bb5\u4e2d\u53ea\u67098\u9875\u88ab\u987a\u5e8f\u8bbf\u95ee\u3002\u4f60\u53ef\u4ee5\u5728MySQL\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u6b64\u53c2\u6570\u7684\u503c\uff0c\u6216\u8005\u4f7f\u7528SET GLOBAL\u9700\u8981\u8be5SUPER\u6743\u9650\u7684\u547d\u4ee4\u52a8\u6001\u66f4\u6539\u8be5\u53c2\u6570\u3002</p> <p>\u5728\u6ca1\u6709\u8be5\u53d8\u91cf\u4e4b\u524d\uff0c\u5f53\u8bbf\u95ee\u5230extent\u7684\u6700\u540e\u4e00\u4e2apage\u7684\u65f6\u5019\uff0cInnodb\u4f1a\u51b3\u5b9a\u662f\u5426\u5c06\u4e0b\u4e00\u4e2aextent\u653e\u5165\u5230buffer pool\u4e2d\u3002</p> <p>8.4.2 \u968f\u673a\u9884\u8bfb\uff08randomread-ahead\uff09</p> <p>\u968f\u673a\u9884\u8bfb\u65b9\u5f0f\u5219\u662f\u8868\u793a\u5f53\u540c\u4e00\u4e2aextent\u4e2d\u7684\u4e00\u4e9bpage\u5728buffer pool\u4e2d\u53d1\u73b0\u65f6\uff0cInnodb\u4f1a\u5c06\u8be5extent\u4e2d\u7684\u5269\u4f59page\u4e00\u5e76\u8bfb\u5230buffer pool\u4e2d\uff0c\u7531\u4e8e\u968f\u673a\u9884\u8bfb\u65b9\u5f0f\u7ed9Innodb code\u5e26\u6765\u4e86\u4e00\u4e9b\u4e0d\u5fc5\u8981\u7684\u590d\u6742\u6027\uff0c\u540c\u65f6\u5728\u6027\u80fd\u4e5f\u5b58\u5728\u4e0d\u7a33\u5b9a\u6027\uff0c\u57285.5\u4e2d\u5df2\u7ecf\u5c06\u8fd9\u79cd\u9884\u8bfb\u65b9\u5f0f\u5e9f\u5f03\u3002\u8981\u542f\u7528\u6b64\u529f\u80fd\uff0c\u8bf7\u5c06\u914d\u7f6e\u53d8\u91cf\u8bbe\u7f6einnodb_random_read_ahead\u4e3aON\u3002</p> <pre><code>mysql&gt; show global variables like '%innodb_random_read_ahead%';\n+--------------------------+-------+\n| Variable_name            | Value |\n+--------------------------+-------+\n| innodb_random_read_ahead | OFF   |\n+--------------------------+-------+\n1 row in set (0.01 sec)\n</code></pre> <p>\u5728\u76d1\u63a7Innodb\u7684\u9884\u8bfb\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7SHOW ENGINE INNODB STATUS\u547d\u4ee4\u663e\u793a\u7edf\u8ba1\u4fe1\u606f\uff0c\u901a\u8fc7Pages read ahead\u548cevicted without access\u4e24\u4e2a\u503c\u6765\u89c2\u5bdf\u9884\u8bfb\u7684\u60c5\u51b5\uff0c\u6216\u8005\u901a\u8fc7\u4e24\u4e2a\u72b6\u6001\u503c\uff0c\u4ee5\u5e2e\u52a9\u60a8\u8bc4\u4f30\u9884\u8bfb\u7b97\u6cd5\u7684\u6709\u6548\u6027\u3002</p> <pre><code>mysql&gt; show global status like '%Innodb_buffer_pool_read_ahead%';\n+---------------------------------------+-------+\n| Variable_name                         | Value |\n+---------------------------------------+-------+\n| Innodb_buffer_pool_read_ahead_rnd     | 0     |\n| Innodb_buffer_pool_read_ahead         | 0     |\n| Innodb_buffer_pool_read_ahead_evicted | 0     |\n+---------------------------------------+-------+\n3 rows in set (0.00 sec)\n</code></pre> <p>\u800c\u901a\u8fc7SHOW ENGINE INNODB STATUS\u5f97\u5230\u7684Pages read ahead\u548cevicted without access\u5219\u8868\u793a\u6bcf\u79d2\u8bfb\u5165\u548c\u8bfb\u51fa\u7684pages\uff1aPages read ahead 1.00/s, evicted without access 9.99/s\u3002</p> <p>\u5f53\u5fae\u8c03innodb_random_read_ahead\u8bbe\u7f6e\u65f6\uff0c\u6b64\u4fe1\u606f\u53ef\u80fd\u5f88\u6709\u7528 \u3002</p> <p>8.5 \u914d\u7f6eInnoDB\u7f13\u51b2\u6c60\u5237\u65b0</p> <p>\u4e0a\u9762\u8be6\u7ec6\u8bf4\u4e86\u7f13\u51b2\u6c60\u5237\u65b0\u673a\u5236\uff0c\u7b80\u5355\u6765\u8bf4\u57fa\u672c\u539f\u7406\u53ef\u4ee5\u603b\u7ed3\u5982\u4e0b\uff1a</p> <p>\u5f53\u542f\u7528innodb_max_dirty_pages_pct_lwm\uff08\u9ed8\u8ba4\u503c0\uff09\u53c2\u6570\u65f6\uff0c\u8868\u793a\u542f\u7528\u4e86\u810f\u9875\u9762\u9884\u5237\u65b0\u884c\u4e3a\uff0c\u4ee5\u63a7\u5236\u810f\u9875\u9762\u5360\u6bd4\u3002\u4e5f\u662f\u4e3a\u4e86\u9632\u6b62\u810f\u9875\u5360\u6709\u7387\u8d85\u8fc7innodb_max_dirty_pages_pct\uff08\u9ed8\u8ba4\u503c75%\uff09\u7684\u8bbe\u5b9a\u503c\u3002\u9ed8\u8ba4\u7981\u7528\u201c\u9884\u5237\u65b0\u201d\u884c\u4e3a\u3002\u5982\u679c\u5f53\u810f\u9875\u7684\u5360\u6709\u7387\u8fbe\u5230\u4e86innodb_max_dirty_pages_pct\u7684\u8bbe\u5b9a\u503c\u7684\u65f6\u5019\uff0cInnoDB\u5c31\u4f1a\u5f3a\u5236\u5237\u65b0buffer pool pages\u3002\u53e6\u5916\u5f53free\u5217\u8868\u5c0f\u4e8einnodb_lru_scan_depth\u503c\u65f6\u4e5f\u4f1a\u89e6\u53d1\u5237\u65b0\u673a\u5236\uff0cinnodb_lru_scan_depth\u63a7\u5236LRU\u5217\u8868\u4e2d\u53ef\u7528\u9875\u7684\u6570\u91cf\uff0c\u8be5\u503c\u9ed8\u8ba4\u4e3a1024\u3002</p> <p>InnoDB\u91c7\u7528\u4e00\u79cd\u57fa\u4e8eredo log\u7684\u6700\u8fd1\u751f\u6210\u91cf\uff08\u6d3b\u8dc3\u65e5\u5fd7\u91cf\u7684\u5927\u5c0f\uff0c\u4e5f\u5c31\u662flsn\u7684age\uff09\u548c\u810f\u9875\u5237\u65b0\u5e73\u5747\u901f\u5ea6\uff08\u4e00\u79d2\u5237\u65b0\u4e86\u591a\u5c11\u6b21\uff09\u53cainnodb_io_capacity\u53c2\u6570\u7684\u7b97\u6cd5\u6765\u51b3\u5b9a\u5237\u65b0\u810f\u9875\u6570\u91cf\u3002\u8fd9\u6837\u7684\u7b97\u6cd5\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u5e93\u7684\u5237\u65b0\u4e0d\u4f1a\u5f71\u54cd\u5230\u6570\u636e\u5e93\u7684\u6027\u80fd\uff0c\u4e5f\u80fd\u4fdd\u8bc1\u6570\u636e\u5e93buffer pool\u4e2d\u7684\u6570\u636e\u7684\u810f\u6570\u636e\u7684\u5360\u7528\u6bd4\u3002\u8fd9\u79cd\u81ea\u52a8\u8c03\u6574\u5237\u65b0\u901f\u7387\u6709\u52a9\u4e8e\u907f\u514d\u8fc7\u591a\u7684\u7f13\u51b2\u6c60\u5237\u65b0\u9650\u5236\u4e86\u666e\u901a\u8bfb\u5199\u8bf7\u6c42\u53ef\u7528\u7684I/O\u5bb9\u91cf\uff0c\u4ece\u800c\u907f\u514d\u541e\u5410\u91cf\u7a81\u7136\u4e0b\u964d\uff0c\u4f46\u8fd8\u662f\u5bf9\u6b63\u5e38IO\u6709\u5f71\u54cd\u3002\u5185\u90e8\u57fa\u51c6\u6d4b\u8bd5\u663e\u793a\uff0c\u8be5\u7b97\u6cd5\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\u53ef\u4ee5\u663e\u8457\u63d0\u9ad8\u6574\u4f53\u541e\u5410\u91cf\u3002\u8fd9\u79cd\u7b97\u6cd5\u662f\u7ecf\u5f97\u4f4f\u8003\u9a8c\u7684\uff0c\u6240\u4ee5\u8bf4\u5343\u4e07\u4e0d\u8981\u968f\u4fbf\u8bbe\u7f6e\uff0c\u6700\u597d\u662f\u9ed8\u8ba4\u503c\u3002</p> <p>\u914d\u7f6e\u53c2\u6570innodb_flush_neighbors\uff08\u5237\u65b0\u90bb\u63a5\u9875\uff09\uff0cinnodb_lru_scan_depth\u53ef\u4ee5\u8ba9\u4f60\u5fae\u8c03\u7f13\u51b2\u6c60\u5237\u65b0\u8fc7\u7a0b\u7684\u67d0\u4e9b\u65b9\u9762\uff0c\u8fd9\u4e9b\u9009\u9879\u4e3b\u8981\u662f\u5e2e\u52a9\u5199\u5bc6\u96c6\u578b\u7684\u5de5\u4f5c\u8d1f\u8f7d\u3002\u5982\u679cDML\u64cd\u4f5c\u8f83\u4e3a\u4e25\u91cd\uff0c\u5982\u679c\u6ca1\u6709\u8f83\u9ad8\u7684\u503c\uff0c\u5219\u5237\u65b0\u53ef\u80fd\u4f1a\u4e0b\u964d\uff0c\u4f1a\u5bfc\u81f4\u7f13\u51b2\u6c60\u4e2d\u7684\u5185\u5b58\u8fc7\u591a\u3002\u6216\u8005\uff0c\u5982\u679c\u8fd9\u79cd\u673a\u5236\u8fc7\u4e8e\u6fc0\u8fdb\uff0c\u78c1\u76d8\u5199\u5165\u5c06\u4f1a\u4f7f\u4f60\u7684I/O\u5bb9\u91cf\u9971\u548c\uff0c\u7406\u60f3\u7684\u8bbe\u7f6e\u53d6\u51b3\u4e8e\u4f60\u7684\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u6570\u636e\u8bbf\u95ee\u6a21\u5f0f\u548c\u5b58\u50a8\u914d\u7f6e\uff08\u4f8b\u5982\u6570\u636e\u662f\u5426\u5b58\u50a8\u5728HDD\u6216SSD\u8bbe\u5907\u4e0a\uff09\u3002</p> <p>InnoDB\u5b58\u50a8\u5f15\u631a\u63d0\u4f9b\u4e86flush Neighbor page\uff08\u5237\u65b0\u90bb\u63a5\u9875\uff09\u7684\u7279\u6027\u3002\u5176\u5de5\u4f5c\u539f\u7406\u4e3a\uff1a\u5f53\u5237\u65b0\u4e00\u4e2a\u810f\u9875\u65f6\uff0cInnoDB\u5b58\u50a8\u5f15\u631a\u4f1a\u68c0\u6d4b\u8be5\u9875\u6240\u5728\u533a\uff08extent\uff09\u7684\u6240\u6709\u9875\uff0c\u5982\u679c\u662f\u810f\u9875\uff0c\u90a3\u4e48\u4e00\u8d77\u8fdb\u884c\u5237\u65b0\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u663e\u800c\u6613\u89c1\uff0c\u901a\u8fc7AIO\u53ef\u4ee5\u5c06\u591a\u4e2aIO\u5199\u5165\u64cd\u4f5c\u5408\u5e76\u4e3a\u4e00\u4e2aIO\u64cd\u4f5c\uff0c\u6545\u8be5\u5de5\u4f5c\u673a\u5236\u5728\u4f20\u7edf\u7684\u673a\u68b0\u786c\u76d8\u4e0b\u6709\u7740\u663e\u8457\u7684\u4f18\u52bf\u3002\u4f46\u9700\u8981\u8003\u8651\u5230\u4e0b\u9762\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ol> <li>\u662f\u4e0d\u662f\u53ef\u80fd\u5c06\u4e0d\u600e\u4e48\u810f\u7684\u9875\u8fdb\u884c\u4e86\u5199\u5165\uff0c\u800c\u8be5\u9875\u4e4b\u540e\u53c8\u4f1a\u5f88\u5feb\u53d8\u6210\u810f\u9875\uff1f</li> <li>\u56fa\u6001\u786c\u76d8\u6709\u7740\u8f83\u9ad8\u7684IOPS\uff0c\u662f\u5426\u8fd8\u9700\u8981\u8fd9\u4e2a\u7279\u6027\uff1f</li> </ol> <p>\u4e3a\u6b64\uff0cInnoDB\u5b58\u50a8\u5f15\u631a\u4ece1.2.x\u7248\u672c\u5f00\u59cb\u63d0\u4f9b\u4e86\u53c2\u6570innodb_flush_neighbors\uff0c\u7528\u6765\u63a7\u5236\u662f\u5426\u5f00\u542f\u8fd9\u4e2a\u7279\u6027\u3002\u5bf9\u4e8e\u4f20\u7edf\u7684\u673a\u68b0\u786c\u76d8\u5efa\u8bae\u5f00\u542f\u8be5\u7279\u6027\uff0c\u800c\u5bf9\u4e8e\u56fa\u6001\u786c\u76d8\u6709\u7740\u8d85\u9ad8\u7684IOPS\u6027\u80fd\uff0c\u5219\u5efa\u8bae\u5c06\u8be5\u53c2\u6570\u8bbe\u7f6e\u4e3a0\uff0c\u5373\u5173\u95ed\u6b64\u7279\u6027\u3002</p> <p>InnoDB\u5bf9\u4e8e\u5177\u6709\u4e0d\u65ad\u7e41\u91cd\u5de5\u4f5c\u8d1f\u8f7d\u7684\u7cfb\u7edf\u6216\u8005\u5de5\u4f5c\u8d1f\u8f7d\u6ce2\u52a8\u5f88\u5927\u7684\u7cfb\u7edf\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u51e0\u4e2a\u914d\u7f6e\u9009\u9879\u6765\u8c03\u6574\u8868\u7684\u5237\u65b0\u884c\u4e3a\uff1a</p> <ul> <li>innodb_adaptive_flushing_lwm\uff1a\u9ed8\u8ba4\u503c10\uff0c\u6307\u5b9a\u91cd\u505a\u65e5\u5fd7\u5bb9\u91cf\u7684\u201c \u4f4e\u6c34\u4f4d \u201d\u767e\u5206\u6bd4\uff0c\u5f53\u8be5\u9608\u503c\u8d8a\u8fc7\u65f6\uff0cInnoDB\u5373\u4f7f\u6ca1\u6709\u5f00\u542finnodb_adaptive_flushing\u9009\u9879\u4e5f\u4f1a\u81ea\u52a8\u542f\u7528\u81ea\u9002\u5e94\u5237\u65b0\u3002</li> <li>innodb_max_dirty_pages_pct_lwm\uff1a\u9ed8\u8ba4\u503c0\uff0cInnoDB\u5c1d\u8bd5\u4ece\u7f13\u51b2\u6c60\u4e2d\u5237\u65b0\u6570\u636e\uff0c\u4ee5\u4f7f\u810f\u9875\u9762\u7684\u767e\u5206\u6bd4\u4e0d\u8d85\u8fc7\u8be5\u503cinnodb_max_dirty_pages_pct\u3002\u9ed8\u8ba4\u503c\u4e3a75\u3002\u8be5innodb_max_dirty_pages_pct_lwm\u9009\u9879\u662f\u7528\u6765\u6307\u5b9a\u201c \u4f4e\u6c34\u4f4d \u201d\u503c\uff0c\u5176\u8868\u793a\u4f7f\u7528\u9884\u51b2\u6d17\u6765\u63a7\u5236\u810f\u9875\u6bd4\u4f8b\u7684\u767e\u5206\u6bd4\uff0c\u9632\u6b62\u810f\u9875\u7684\u767e\u5206\u6bd4\u8fbe\u5230innodb_max_dirty_pages_pct\u7684\u503c\uff0cinnodb_max_dirty_pages_pct_lwm\u9ed8\u8ba40\uff0c\u7981\u7528\u201c \u9884\u51b2\u6d17\u201d\u884c\u4e3a\u3002</li> <li>innodb_io_capacity_max\uff0c\u9ed8\u8ba42000\uff0c\u5982\u679c\u5237\u65b0\u52a8\u4f5c\u8fdc\u8fdc\u843d\u540e\uff0cInnoDB\u5237\u65b0\u810f\u9875\u91cf\u53ef\u4ee5\u8d85\u51fainnodb_io_capacity\u503c\u3002innodb_io_capacity_max\u8868\u793a\u5728\u8fd9\u79cd\u7d27\u6025\u60c5\u51b5\u4e0b\u4f7f\u7528\u7684I/O\u5bb9\u91cf\u7684\u4e0a\u9650\uff0c\u4ee5\u4fbfI/O\u4e2d\u7684\u5c16\u5cf0\u6d88\u8017\u4e0d\u5230\u670d\u52a1\u5668\u7684\u6240\u6709\u5bb9\u91cf\u3002</li> <li>innodb_flushing_avg_loops\uff0c\u9ed8\u8ba430\uff0c\u5b9a\u4e49\u4e86innodb\u4fdd\u7559\u5148\u524d\u8ba1\u7b97\u7684\u5237\u65b0\u72b6\u6001\u5feb\u7167\u7684\u8fed\u4ee3\u6b21\u6570, \u5b83\u63a7\u5236\u4e86\u81ea\u9002\u5e94\u5237\u65b0\u5bf9\u6b64\u524d\u8d1f\u8f7d\u66f4\u6539\u7684\u54cd\u5e94\u901f\u5ea6\u3002\u4e3ainnodb_flushing_avg_loops\u8bbe\u7f6e\u9ad8\u503c\u610f\u5473\u7740innodb\u4fdd\u7559\u4ee5\u524d\u8ba1\u7b97\u7684\u5feb\u7167\u7684\u65f6\u95f4\u66f4\u957f\uff0c\u56e0\u6b64\u81ea\u9002\u5e94\u5237\u65b0\u7684\u54cd\u5e94\u901f\u5ea6\u66f4\u6162\uff0c\u9ad8\u503c\u8fd8\u53ef\u4ee5\u51cf\u5c11\u524d\u53f0\u548c\u540e\u53f0\u5de5\u4f5c\u4e4b\u95f4\u7684\u6b63\u9762\u53cd\u9988\u3002\u4f46\u662f\uff0c\u5728\u8bbe\u7f6e\u9ad8\u503c\u65f6\uff0c\u786e\u4fddinnodb\u91cd\u505a\u65e5\u5fd7\u5229\u7528\u7387\u4e0d\u8fbe\u523075% (\u5f02\u6b65\u5237\u65b0\u5f00\u59cb\u65f6\u7684\u786c\u7f16\u7801\u9650\u5236) \u548cinnodb_max_dirty_pages_pct\u8bbe\u7f6e\u5c06\u810f\u9875\u7684\u6570\u91cf\u4fdd\u6301\u4e3a\u9002\u5408\u4e8e\u5de5\u4f5c\u8d1f\u8377\u7684\u7ea7\u522b\u662f\u5f88\u91cd\u8981\u7684\u3002</li> </ul> <p>\u4e0a\u9762\u63d0\u5230\u7684\u5927\u591a\u6570\u9009\u9879\u6700\u9002\u7528\u4e8e\u957f\u65f6\u95f4\u8fd0\u884c\u5199\u5165\u7e41\u91cd\u5de5\u4f5c\u8d1f\u8f7d\u7684\u670d\u52a1\u5668\u3002</p> <p>8.6 \u4fdd\u5b58\u548c\u6062\u590d\u7f13\u51b2\u6c60\u72b6\u6001</p> <p>8.6.1 \u5728\u5173\u95ed\u65f6\u4fdd\u5b58\u7f13\u51b2\u6c60\u72b6\u6001\u5e76\u5728\u542f\u52a8\u65f6\u6062\u590d\u7f13\u51b2\u6c60\u72b6\u6001</p> <p>\u53ef\u4ee5\u914d\u7f6e\u5728MySQL\u5173\u95ed\u4e4b\u524d\uff0c\u4fdd\u5b58InnoDB\u5f53\u524d\u7684\u7f13\u51b2\u6c60\u7684\u72b6\u6001\uff0c\u4ee5\u907f\u514d\u5728\u670d\u52a1\u5668\u91cd\u65b0\u542f\u52a8\u540e\uff0c\u8fd8\u8981\u7ecf\u5386\u4e00\u4e2a\u9884\u70ed\u7684\u6696\u673a\u65f6\u95f4\u3002\u901a\u8fc7innodb_buffer_pool_dump_at_shutdown\uff08\u670d\u52a1\u5668\u5173\u95ed\u524d\u8bbe\u7f6e\uff09\u6765\u8bbe\u7f6e\uff0c\u5f53\u8bbe\u7f6e\u8fd9\u4e2a\u53c2\u6570\u4ee5\u540eMySQL\u5c31\u4f1a\u5728\u673a\u5668\u5173\u95ed\u65f6\u4fdd\u5b58InnoDB\u5f53\u524d\u7684\u72b6\u6001\u4fe1\u606f\u5230\u78c1\u76d8\u4e0a\u3002</p> <p>\u5f53\u542f\u52a8MySQL\u670d\u52a1\u5668\u65f6\u8981\u6062\u590d\u670d\u52a1\u5668\u7f13\u51b2\u6c60\u72b6\u6001\uff0c\u8bf7\u5728\u542f\u52a8\u670d\u52a1\u5668\u65f6\u5f00\u542finnodb_buffer_pool_load_at_startup\u53c2\u6570\u3002\u4e2a\u4eba\u8ba4\u4e3a\u8fd9\u4e2a\u503c\u8fd8\u662f\u9700\u8981\u914d\u7f6e\u4e00\u4e0b\u7684\uff0cMySQL 5.7.6\u7248\u672c\u4e4b\u524d\u8fd9\u4e24\u4e2a\u503c\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\uff0c\u4f46\u4eceMySQL 5.7.7\u7248\u672c\u5f00\u59cb\u8fd9\u4e24\u4e2a\u503c\u5c31\u9ed8\u8ba4\u4e3a\u5f00\u542f\u72b6\u6001\u4e86\u3002\u8fd9\u4e9b\u6570\u636e\u662f\u4ece\u78c1\u76d8\u91cd\u65b0\u8bfb\u53d6\u5230buffer pool\u5f53\u4e2d\u7684\uff0c\u8fd9\u4f1a\u82b1\u8d39\u4e00\u4e9b\u65f6\u95f4\uff0c\u5e76\u4e14\u6062\u590d\u65f6\u65b0\u7684DML\u64cd\u4f5c\u662f\u4e0d\u80fd\u591f\u8fdb\u884c\u64cd\u4f5c\u7684\u3002\u8fd9\u4e9b\u6570\u636e\u662f\u600e\u4e48\u6062\u590d\u5462\uff1f\u5176\u5b9eINNODB_BUFFER_PAGE_LRU\u8868\uff08INFORMATION_SCHEMA\uff09\u4f1a\u8bb0\u5f55\u7f13\u5b58\u7684tablespace ID\u548cpage ID\uff0c\u901a\u8fc7\u8fd9\u4e2a\u6765\u6062\u590d\u3002\u53e6\u5916\u7f13\u51b2\u6c60\u72b6\u6001\u4fdd\u5b58\u6587\u4ef6\u9ed8\u8ba4\u5728\u6570\u636e\u76ee\u5f55\u4e0b\uff0c\u540d\u4e3a\u201dib_buffer_pool\u201d\uff0c\u53ef\u4ee5\u4f7f\u7528innodb_buffer_pool_filename\u53c2\u6570\u6765\u4fee\u6539\u6587\u4ef6\u540d\u548c\u4f4d\u7f6e\u3002</p> <p>8.6.2 \u914d\u7f6e\u7f13\u51b2\u6c60\u9875\u9762\u4fdd\u5b58\u7684\u767e\u5206\u6bd4</p> <p>\u5728\u52a0\u8f7d\u6570\u636e\u8fdb\u5165buffer pool\u4e4b\u524d\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6einnodb_buffer_pool_dump_pct\u53c2\u6570\u6765\u51b3\u5b9a\u6062\u590dbuffer pool\u4e2d\u591a\u5c11\u6570\u636e\u3002MySQL 5.7.6\u7248\u672c\u4e4b\u524d\u7684\u9ed8\u8ba4\u503c\u662f100\uff0c\u6062\u590d\u5168\u90e8\uff0c\u4eceMySQL 5.7.7\u7248\u672c\u4e4b\u540e\u9ed8\u8ba4\u8c03\u6574\u4e3a25\u4e86\u3002\u53ef\u4ee5\u52a8\u6001\u8bbe\u7f6e\u6b64\u53c2\u6570\uff1a</p> <pre><code>mysql&gt; SET GLOBAL innodb_buffer_pool_dump_pct = 40;\n</code></pre> <p>8.6.3 \u5728\u7ebf\u4fdd\u5b58\u548c\u6062\u590d\u7f13\u51b2\u6c60\u72b6\u6001</p> <p>\u8981\u5728\u8fd0\u884cMySQL\u670d\u52a1\u5668\u65f6\u4fdd\u5b58\u7f13\u51b2\u6c60\u7684\u72b6\u6001\uff0c\u8bf7\u53d1\u51fa\u4ee5\u4e0b\u8bed\u53e5\uff1a</p> <pre><code>mysql&gt; SET GLOBAL innodb_buffer_pool_dump_now=ON;\n</code></pre> <p>\u8981\u5728MySQL\u8fd0\u884c\u65f6\u6062\u590d\u7f13\u51b2\u6c60\u72b6\u6001\uff0c\u8bf7\u53d1\u51fa\u4ee5\u4e0b\u8bed\u53e5\uff1a</p> <pre><code>mysql&gt; SET GLOBAL innodb_buffer_pool_load_now = ON;\n</code></pre> <p>\u5982\u679c\u8981\u7ec8\u6b62buffer pool\u52a0\u8f7d\uff0c\u53ef\u4ee5\u6307\u5b9a\u8fd0\u884c\uff1a</p> <pre><code>mysql&gt; SET GLOBAL innodb_buffer_pool_load_abort=ON;\n</code></pre> <p>8.6.4 \u663e\u793a\u7f13\u51b2\u6c60\u4fdd\u5b58\u548c\u52a0\u8f7d\u8fdb\u5ea6</p> <p>\u663e\u793a\u5c06\u7f13\u51b2\u6c60\u72b6\u6001\u4fdd\u5b58\u5230\u78c1\u76d8\u65f6\u7684\u8fdb\u5ea6\uff1a</p> <pre><code>mysql&gt; SHOW STATUS LIKE 'Innodb_buffer_pool_dump_status';\n+--------------------------------+------------------------------------+\n| Variable_name                  | Value                              |\n+--------------------------------+------------------------------------+\n| Innodb_buffer_pool_dump_status | Dumping of buffer pool not started |\n+--------------------------------+------------------------------------+\n1 row in set (0.03 sec)\n</code></pre> <p>\u663e\u793a\u52a0\u8f7d\u7f13\u51b2\u6c60\u65f6\u7684\u8fdb\u5ea6:</p> <pre><code>mysql&gt; SHOW STATUS LIKE 'Innodb_buffer_pool_load_status';\n+--------------------------------+--------------------------------------------------+\n| Variable_name                  | Value                                            |\n+--------------------------------+--------------------------------------------------+\n| Innodb_buffer_pool_load_status | Buffer pool(s) load completed at 170428 16:13:21 |\n+--------------------------------+--------------------------------------------------+\n1 row in set (0.00 sec)\n</code></pre> <p>\u4ee5\u901a\u8fc7innodb\u7684performance schema\u76d1\u63a7buffer pool\u7684LOAD\u72b6\u6001\uff0c\u6253\u5f00\u6216\u8005\u5173\u95edstage/innodb/buffer pool load\u3002</p> <pre><code>mysql&gt; UPDATE performance_schema.setup_instruments SET ENABLED = 'YES' WHERE NAME LIKE 'stage/innodb/buffer%';\n</code></pre> <p>\u542f\u52a8events_stages_current\uff0cevents_stages_history\uff0cevents_stages_history_long\u8868\u76d1\u63a7\u3002</p> <pre><code>mysql&gt; UPDATE performance_schema.setup_consumers SET ENABLED = 'YES' WHERE NAME LIKE '%stages%';\n</code></pre> <p>\u901a\u8fc7\u542f\u7528\u4fdd\u5b58\u5f53\u524d\u7684\u7f13\u51b2\u6c60\u72b6\u6001\u6765\u83b7\u53d6\u6700\u8fd1\u7684buffer pool\u72b6\u6001\u3002</p> <pre><code>mysql&gt; SHOW STATUS LIKE 'Innodb_buffer_pool_dump_status'\\G\n*************************** 1. row ***************************\nVariable_name: Innodb_buffer_pool_dump_status\n        Value: Buffer pool(s) dump completed at 170525 18:41:06\n1 row in set (0.01 sec)\n</code></pre> <p>\u901a\u8fc7\u542f\u7528\u6062\u590d\u5f53\u524d\u7684\u7f13\u51b2\u6c60\u72b6\u6001\u6765\u83b7\u53d6\u6700\u8fd1\u52a0\u8f7d\u5230buffer pool\u72b6\u6001\u3002</p> <pre><code>mysql&gt; SET GLOBAL innodb_buffer_pool_load_now=ON;\nQuery OK, 0 rows affected (0.00 sec)\n</code></pre> <p>\u901a\u8fc7\u67e5\u8be2\u6027\u80fd\u6a21\u5f0fevents_stages_current\u8868\u6765\u68c0\u67e5\u7f13\u51b2\u6c60\u52a0\u8f7d\u64cd\u4f5c\u7684\u5f53\u524d\u72b6\u6001\uff0c\u8be5WORK_COMPLETED\u5217\u663e\u793a\u52a0\u8f7d\u7684\u7f13\u51b2\u6c60\u9875\u6570\uff0c\u8be5WORK_ESTIMATED\u5217\u63d0\u4f9b\u5269\u4f59\u5de5\u4f5c\u7684\u4f30\u8ba1\uff0c\u4ee5\u9875\u4e3a\u5355\u4f4d\u3002</p> <pre><code>mysql&gt; SELECT EVENT_NAME, WORK_COMPLETED, WORK_ESTIMATED FROM performance_schema.events_stages_current;\n+-------------------------------+----------------+----------------+\n| EVENT_NAME                    | WORK_COMPLETED | WORK_ESTIMATED |\n+-------------------------------+----------------+----------------+\n| stage/innodb/buffer pool load |           5353 |           7167 |\n+-------------------------------+----------------+----------------+\n</code></pre> <p>\u5982\u679c\u7f13\u51b2\u6c60\u52a0\u8f7d\u64cd\u4f5c\u5df2\u7ecf\u5b8c\u6210\uff0c\u8be5\u8868\u5c06\u8fd4\u56de\u4e00\u4e2a\u7a7a\u96c6\u5408\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u4ee5\u68c0\u67e5events_stages_history\u8868\u4ee5\u67e5\u770b\u5df2\u5b8c\u6210\u4e8b\u4ef6\u7684\u6570\u636e\u3002\u4f8b\u5982\uff1a</p> <pre><code>mysql&gt; SELECT EVENT_NAME, WORK_COMPLETED, WORK_ESTIMATED FROM performance_schema.events_stages_history;\n+-------------------------------+----------------+----------------+\n| EVENT_NAME                    | WORK_COMPLETED | WORK_ESTIMATED |\n+-------------------------------+----------------+----------------+\n| stage/innodb/buffer pool load |           7167 |           7167 |\n+-------------------------------+----------------+----------------+\n</code></pre> <p>\u6ce8\u610f\uff1a\u5728\u4f7f\u7528innodb_buffer_pool_load_at_startup\u542f\u52a8\u65f6\u52a0\u8f7d\u7f13\u51b2\u6c60\u65f6\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528performance scheme\u6765\u76d1\u89c6\u7f13\u51b2\u6c60\u8d1f\u8f7d\u8fdb\u5ea6\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u9700\u8981\u5f00\u542fstage/innodb/buffer pool load\u3002</p>"},{"location":"buffer-pool/#_4","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>MySQL \u00b7 \u6027\u80fd\u4f18\u5316\u00b7</li> <li>InnoDB buffer pool flush\u7b56\u7565\u6f2b\u8c08</li> <li>\u8be6\u89e3MySQL buffer pool\u9884\u8bfb\u673a\u5236</li> <li>Mysql Buffer Pool</li> <li>mysql-5.7 saving and restore buffer pool state \u8be6\u89e3</li> <li>Mysql\u7684Innodb\u5b58\u50a8\u5f15\u64ce\u7f13\u51b2\u6c60\u4e2a\u4eba\u7406\u89e3</li> <li>InnoDB\u7f13\u51b2\u6c60MySQL \u00b7 \u5f15\u64ce\u7279\u6027 \u00b7 InnoDB Buffer Pool</li> </ul>"},{"location":"buffer-pool/#_5","title":"\u5185\u5b58\u4f18\u5316\u914d\u7f6e","text":"<ul> <li>https://blog.csdn.net/mshxuyi/article/details/94901212</li> </ul>"},{"location":"buffer-pool/#performance_schema","title":"performance_schema\u7684\u4ecb\u7ecd","text":"<ul> <li>https://www.cnblogs.com/Courage129/p/14188422.html</li> </ul>"},{"location":"buffer-pool/#mysqlinnodb_buffer_pool_size","title":"Mysql\u4f18\u5316\u4e4binnodb_buffer_pool_size\u7bc7","text":"<ul> <li>https://www.cnblogs.com/innocenter/p/14948857.html</li> </ul>"},{"location":"buffer-pool/#mysql-oom","title":"MySQL OOM\uff08\u5185\u5b58\u6ea2\u51fa\uff09\u7684\u89e3\u51b3\u601d\u8def","text":"<ul> <li>https://www.jb51.net/article/192694.htm</li> </ul>"},{"location":"buffer-pool/#mysql8-mysql","title":"mysql8 \u53c2\u8003\u624b\u518c\u2013mysql\u4f7f\u7528\u5185\u5b58\u4f18\u5316","text":"<ul> <li>https://www.1024sky.cn/blog/article/1074</li> </ul>"},{"location":"buffer-pool/#performance_schema_1","title":"\u901a\u8fc7performance_schema\u83b7\u53d6\u9020\u6210\u6b7b\u9501\u7684\u4e8b\u52a1\u8bed\u53e5","text":"<ul> <li>https://www.jianshu.com/p/268889c997e8</li> </ul>"},{"location":"buffer-pool/#mysqlinnodb-page-clean","title":"MySQL:Innodb page clean \u7ebf\u7a0b (\u4e00) \u57fa\u7840","text":"<ul> <li>http://blog.itpub.net/7728585/viewspace-2157988/</li> </ul>"},{"location":"buffer-pool/#mysql-buffer-pool-and-memory","title":"MYSQL buffer pool and memory\u89e3\u6790","text":"<ul> <li> <p>https://blog.csdn.net/liu911025/article/details/115479142 <pre><code>----------------------\nBUFFER POOL AND MEMORY\n----------------------\nTotal large memory allocated 44589645824\nDictionary memory allocated 24341116\nBuffer pool size   2640000\nFree buffers       7032\nDatabase pages     2632968\nOld database pages 971772\nModified db pages  50101\nPending reads      0\nPending writes: LRU 0, flush list 120, single page 0\nPages made young 59102, not young 10118954\n0.00 youngs/s, 0.00 non-youngs/s\nPages read 12279286, created 13976023, written 14775298\n0.00 reads/s, 0.00 creates/s, 0.00 writes/s\nBuffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000\nPages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s\nLRU len: 2632968, unzip_LRU len: 0\nI/O sum[1960144]:cur[42208], unzip sum[0]:cur[0]\n----------------------\n</code></pre></p> </li> <li> <p>\uff081\uff09Total memory allocated\uff0c\u8fd9\u5c31\u662f\u8bf4buffer pool\u6700\u7ec8\u7684\u603b\u5927\u5c0f\u662f\u591a\u5c11</p> </li> <li>\uff082\uff09Buffer pool size\uff0c\u8fd9\u5c31\u662f\u8bf4buffer pool\u4e00\u5171\u80fd\u5bb9\u7eb3\u591a\u5c11\u4e2a\u7f13\u5b58\u9875</li> <li>\uff083\uff09Free buffers\uff0c\u8fd9\u5c31\u662f\u8bf4free\u94fe\u8868\u4e2d\u4e00\u5171\u6709\u591a\u5c11\u4e2a\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\u662f\u53ef\u7528\u7684</li> <li>\uff084\uff09Database pages\u548cOld database pages\uff0c\u5c31\u662f\u8bf4lru\u94fe\u8868\u4e2d\u4e00\u5171\u6709\u591a\u5c11\u4e2a\u7f13\u5b58\u9875\uff0c\u4ee5\u53ca\u51b7\u6570\u636e\u533a\u57df\u91cc\u7684\u7f13\u5b58\u9875\u6570\u91cf</li> <li>\uff085\uff09Modified db pages\uff0c\u8fd9\u5c31\u662fflush\u94fe\u8868\u4e2d\u7684\u7f13\u5b58\u9875\u6570\u91cf</li> <li>\uff086\uff09Pending reads\u548cPending writes\uff0c\u7b49\u5f85\u4ece\u78c1\u76d8\u4e0a\u52a0\u8f7d\u8fdb\u7f13\u5b58\u9875\u7684\u6570\u91cf\uff0c\u8fd8\u6709\u5c31\u662f\u5373\u5c06\u4ecelru\u94fe\u8868\u4e2d\u5237\u5165\u78c1\u76d8\u7684\u6570\u91cf\u3001\u5373\u5c06\u4eceflush\u94fe\u8868\u4e2d\u5237\u5165\u78c1\u76d8\u7684\u6570\u91cf</li> <li>\uff087\uff09Pages made young\u548cnot young\uff0c\u8fd9\u5c31\u662f\u8bf4\u5df2\u7ecflru\u51b7\u6570\u636e\u533a\u57df\u91cc\u8bbf\u95ee\u4e4b\u540e\u8f6c\u79fb\u5230\u70ed\u6570\u636e\u533a\u57df\u7684\u7f13\u5b58\u9875\u7684\u6570\u91cf\uff0c\u4ee5\u53ca\u5728lru\u51b7\u6570\u636e\u533a\u57df\u91cc1s\u5185\u88ab\u8bbf\u95ee\u4e86\u6ca1\u8fdb\u5165\u70ed\u6570\u636e\u533a\u57df\u7684\u7f13\u5b58\u9875\u7684\u6570\u91cf</li> <li>\uff088\uff09youngs/s\u548cnot youngs/s\uff0c\u8fd9\u5c31\u662f\u8bf4\u6bcf\u79d2\u4ece\u51b7\u6570\u636e\u533a\u57df\u8fdb\u5165\u70ed\u6570\u636e\u533a\u57df\u7684\u7f13\u5b58\u9875\u7684\u6570\u91cf\uff0c\u4ee5\u53ca\u6bcf\u79d2\u5728\u51b7\u6570\u636e\u533a\u57df\u91cc\u88ab\u8bbf\u95ee\u4e86\u4f46\u662f\u4e0d\u80fd\u8fdb\u5165\u70ed\u6570\u636e\u533a\u57df\u7684\u7f13\u5b58\u9875\u7684\u6570\u91cf</li> <li>\uff089\uff09Pages read xxxx, created xxx, written xxx\uff0cxx reads/s, xx creates/s, 1xx writes/s\uff0c\u8fd9\u91cc\u5c31\u662f\u8bf4\u5df2\u7ecf\u8bfb\u53d6\u3001\u521b\u5efa\u548c\u5199\u5165\u4e86\u591a\u5c11\u4e2a\u7f13\u5b58\u9875\uff0c\u4ee5\u53ca\u6bcf\u79d2\u949f\u8bfb\u53d6\u3001\u521b\u5efa\u548c\u5199\u5165\u7684\u7f13\u5b58\u9875\u6570\u91cf</li> <li>\uff0810\uff09Buffer pool hit rate xxx / 1000\uff0c\u8fd9\u5c31\u662f\u8bf4\u6bcf1000\u6b21\u8bbf\u95ee\uff0c\u6709\u591a\u5c11\u6b21\u662f\u76f4\u63a5\u547d\u4e2d\u4e86buffer pool\u91cc\u7684\u7f13\u5b58\u7684</li> <li>\uff0811\uff09young-making rate xxx / 1000 not xx / 1000\uff0c\u6bcf1000\u6b21\u8bbf\u95ee\uff0c\u6709\u591a\u5c11\u6b21\u8bbf\u95ee\u8ba9\u7f13\u5b58\u9875\u4ece\u51b7\u6570\u636e\u533a\u57df\u79fb\u52a8\u5230\u4e86\u70ed\u6570\u636e\u533a\u57df\uff0c\u4ee5\u53ca\u6ca1\u79fb\u52a8\u7684\u7f13\u5b58\u9875\u6570\u91cf</li> <li>\uff0812\uff09LRU len\uff1a\u8fd9\u5c31\u662flru\u94fe\u8868\u91cc\u7684\u7f13\u5b58\u9875\u7684\u6570\u91cf</li> <li>\uff0813\uff09I/O sum\uff1a\u6700\u8fd150s\u8bfb\u53d6\u78c1\u76d8\u9875\u7684\u603b\u6570</li> <li>\uff0814\uff09I/O cur\uff1a\u73b0\u5728\u6b63\u5728\u8bfb\u53d6\u78c1\u76d8\u9875\u7684\u6570\u91cf</li> </ul>"},{"location":"buffer-pool/#innodb-status","title":"\u89e3\u6790innodb status\u5404\u9879\u53c2\u6570","text":"<ul> <li>https://blog.csdn.net/victory0508/article/details/24373499</li> </ul>"},{"location":"busybox/","title":"busybox","text":"<ul> <li>https://www.cnblogs.com/aWxvdmVseXc0/p/15553891.html</li> <li>http://blog.chinaunix.net/uid-342534-id-3032921.html</li> <li>https://blog.csdn.net/zhaojia92/article/details/100717580?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164419790016780255229301%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=164419790016780255229301&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-1-100717580.first_rank_v2_pc_rank_v29&amp;utm_term=kernel+busybox&amp;spm=1018.2226.3001.4187</li> <li>https://zhuanlan.zhihu.com/p/383583821</li> <li>https://blog.csdn.net/wangyijieonline/article/details/103181899</li> <li>https://www.jianshu.com/p/83fbf5af0bcc</li> <li>http://blog.chinaunix.net/uid-31446765-id-5781962.html</li> <li>https://www.pianshen.com/article/95111993556/</li> </ul>"},{"location":"busybox/#vmpxe","title":"VM\u3092\u4f5c\u6210\u3057\u3001PXE\u8d77\u52d5","text":"VM\u3092\u4f5c\u6210\u3057\u3001PXE\u8d77\u52d5 <pre><code># virsh pool-define-as tank logical - - /dev/sda4 tank /dev/tank\n# vgscan 2&gt;&amp;1 | fgrep -q 'No volume groups found' &amp;&amp; virsh pool-build tank\n# virsh pool-start tank\n# virsh pool-autostart tank\nvirsh undefine vm-test\nvirsh destroy vm-test\nvirsh vol-delete /dev/tank/vm-test\n\n# virsh vol-create-as tank vm-test 50G\nvirt-install --connect qemu:///system \\\n--pxe --name vm-test --vcpus=4 --ram 8192 \\\n--os-type=linux --os-variant=ubuntu20.04 \\\n--disk vol=tank/vm-test,bus=virtio,cache=none \\\n--network bridge=br100,model=virtio \\\n--graphics vnc,listen=0.0.0.0,keymap=en-us \\\n--console pty,target_type=serial --autostart \\\n--noautoconsole\n</code></pre>"},{"location":"busybox/#iso","title":"ISO\u4f5c\u6210","text":"ISO\u4f5c\u6210 <pre><code>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\nfind . | cpio -R root:root -H newc -o | gzip &gt; ../rootfs.gz\ncd ../isobios/\ncp ../rootfs.gz ./rootfs.gz\nxorriso -as mkisofs -o ../testbios.iso -b isolinux.bin -c boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table ./\nscp ../testbios.iso    node:/home/tftpboot/test/\n---------------------------\n\nroot@node :~/work/ramdisk# find . | cpio -R root:root -H newc -o | gzip &gt; ../rootfs.gz\n467989 blocks\nroot@node:~/work/ramdisk# cd ../isobios/\nroot@node:~/work/isobios# cp ../rootfs.gz ./rootfs.gz\ncp: overwrite './rootfs.gz'? y\nroot@node:~/work/isobios# xorriso -as mkisofs -o ../testbios.iso -b isolinux.bin -c boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table ./\nxorriso 1.5.2 : RockRidge filesystem manipulator, libburnia project.\n\nDrive current: -outdev 'stdio:../testbios.iso'\nMedia current: stdio file, overwriteable\nMedia status : is blank\nMedia summary: 0 sessions, 0 data blocks, 0 data, 45.1g free\nAdded to ISO image: directory '/'='/root/work/isobios'\nxorriso : UPDATE :       5 files added in 1 seconds\nxorriso : UPDATE :       5 files added in 1 seconds\nxorriso : UPDATE : Thank you for being patient. Working since 0 seconds.\nISO image produced: 42338 sectors\nWritten to medium : 42338 sectors at LBA 0\nWriting to 'stdio:../testbios.iso' completed successfully.\n\nroot@node:~/work/isobios# scp ../testbios.iso    test-server:/home/tftpboot/test/\ntestbios.iso                                      100%   83MB 109.7MB/s   00:00\nroot@node:~/work/isobios#\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n</code></pre>"},{"location":"busybox/#rootfs","title":"rootfs\u4f5c\u6210","text":"rootfs\u4f5c\u6210 <pre><code># busybox\ntar xf busybox-1.34.1.tar.bz2\ncd busybox-1.34.1/\nmake menuconfig\nmake\nmake install\n\nroot@node:~/work/ramdisk# pwd\n/root/work/ramdisk\n\nmkdir dev var sys mnt etc proc lib home tmp\nmkdir var/log\nmkdir lib/modules\ntouch var/log/dmesg\ntouch var/log/messages\ntouch var/log/kern.log\nln -s bin/busybox init\n\nchmod 755 bin/*\nchmod 755 sbin/*\nchmod 777 init\nchmod 666 var/log/*\n\n## \u4e3a\u4e86\u7b80\u4fbf\u76f4\u63a5\u501f\u7528busybox\u7684example\uff0c\u5c06busybox\u6e90\u76ee\u5f55example/bootfloopy/etc\u76ee\u5f55\u4e0b\u7684\u5185\u5bb9\u62f7\u8d1d\u5230ramdisk/etc\u4e0b\uff0c\u65b0\u5efasyslog.conf\u7a7a\u6587\u4ef6\u3002\nroot@node:~/work/ramdisk# cp -rf ../busybox-1.34.1/examples/bootfloppy/etc/* etc/\nroot@node:~/work/ramdisk# touch etc/syslog.conf\n\n## \u4fee\u6539inittab\u6587\u4ef6\u5982\u4e0b\uff1a\n::sysinit:/etc/init.d/rcS\n::askfirst:-/bin/sh\n::restart:/sbin/init\n::ctrlaltdel:/sbin/reboot\n::respawn:/sbin/klogd -n\n::respawn:/sbin/syslogd -n\n::shutdown:/bin/umount -a -r\n::shutdown:/sbin/swapoff -a\n::shutdown:/bin/killall klogd\n::shutdown:/bin/killall syslogd\n\n## \u4fee\u6539init.d/rcS\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff0c\u5176\u4e2d\u6dfb\u52a0\u4e00\u4e9b\u6253\u5370\u4fe1\u606f\u8bb0\u5f55init\u542f\u52a8\u72b6\u6001\uff0c\u6536\u96c6kernel\u542f\u52a8\u4fe1\u606f\u5230dmesg\u6587\u4ef6\u4e2d\u3002\n#! /bin/sh\nmount -o remount,rw /\nmount -a\nclear\necho \"Start Busybox Linux...\"\necho \"Now remount\"\ndmesg &gt; /var/log/dmesg\n\n## \u4fee\u6539syslog.conf\u5185\u5bb9\u5982\u4e0b\uff0c\u5206\u53d1\u4e0d\u540c\u7b49\u7ea7\u7684\u6d88\u606f\u5230\u4e0d\u540c\u7684Log\u6587\u4ef6\u5185\u3002\nuser.* /var/log/messages\nkern.* /var/log/kern.log\nauthpriv.* /var/log/messages\n\n## \u5728ramdisk/dev\u76ee\u5f55\u4e0b\u65b0\u5efa\u8bbe\u5907\u6587\u4ef6\ncd dev\nmknod console c 5 1\nmknod null c 1 3\n## \u6dfb\u52a0shutdown\u547d\u4ee4\u3002\u8fd9\u91cc\u76f4\u63a5\u501f\u7528busybox\u7684example\uff0c\u5c06example/shutdown-1.0/script/shutdown\u811a\u672c\u62f7\u8d1d\u5230ramdiak/bin\u4e0b\uff0c\u5e76\u6dfb\u52a0\u6267\u884c\u6743\u9650 chmod +x bin/shutdown \u3002\nroot@node:~/work/ramdisk# cp ../busybox-1.34.1/examples/shutdown-1.0/script/shutdown bin/\nroot@node:~/work/ramdisk# chmod +x bin/shutdown\n\n# linux kernel\nroot@node:~/work/linux-5.4.178# apt install bison flex git fakeroot build-essential ncurses-dev xz-utils libssl-dev bc\napt install libelf-dev\n\nwget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.4.178.tar.xz\ntar xf linux-5.4.178.tar.xz\ncd /root/work/disk\ndd if=/dev/zero of=disk bs=1M count=32\nmkfs.ext2 -m0 disk\n\n# image disk\nroot@node:~/work/disk# mkdir /mnt/disk\nroot@node:~/work/disk# mount -o loop disk /mnt/disk/\n\n# busybox \u306eFS\u3092image\u306b\u30b3\u30d4\u30fc\nroot@node:~/work# cp -R ramdisk/* /mnt/disk/\nroot@node:~/work# umount /mnt/disk\n\n# inird.img\u3092\u751f\u6210\nroot@node:~/work# dd if=disk/disk of=initrd.img\n65536\n65536+0 records out\n33554432 bytes (34 MB, 32 MiB) copied, 0.108505 s, 309 MB/s\nroot@node:~/work# ll initrd.img\n-rw-r--r-- 1 root root 32M Feb  9 14:48 initrd.img\nroot@node:~/work#\n\n# \u5236\u4f5c\u81ea\u5df1\u7684isolinux\u542f\u52a8\u76d8\u7684\u811a\u672c\u3002\n#!/bin/sh\nmkdir -p miniLinux/isolinux\ncp isolinux.bin isolinux.cfg vmlinuz initrd.img miniLinux/isolinux\nmkisofs -o minilinux.iso -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table miniLinux\n\nroot@node:~/work# cp /mnt/ubuntu/isolinux/iso* miniLinux/isolinux/\nroot@node:~/work# cp /boot/vmlinuz miniLinux/isolinux/\nroot@node:~/work# cp initrd.img miniLinux/isolinux/\nroot@node:~/work# chmod 644 miniLinux/isolinux/*\nroot@node:~/work# ll miniLinux/isolinux/\ntotal 46M\ndrwxr-xr-x 2 root root 4.0K Feb  9 14:54 .\ndrwxr-xr-x 3 root root 4.0K Feb  9 14:50 ..\n-rw-r--r-- 1 root root  32M Feb  9 14:54 initrd.img\n-rw-r--r-- 1 root root  40K Feb  9 14:51 isolinux.bin\n-rw-r--r-- 1 root root  178 Feb  9 14:51 isolinux.cfg\n-rw-r--r-- 1 root root  14M Feb  9 14:54 vmlinuz\nroot@node:~/work#\n\nfind . -print0 | cpio --block-size=8 --null -ov --format=newc | gzip -9 &gt; ../initramfs-busybox.cpio.gz\nqemu-system-x86_64 -m 10240 -kernel bzImage -initrd initramfs-busybox.cpio.gz\n\n# \u4ece\u96f6\u5f00\u59cb\u5236\u4f5c\u4e00\u4e2alinux iso\u955c\u50cf\nhttps://www.cnblogs.com/aWxvdmVseXc0/p/15553891.html\nroot@node:~/work/isobios# apt install xorriso\n\nhttps://mirrors.edge.kernel.org/pub/linux/utils/boot/syslinux/6.xx/syslinux-6.03.tar.gz\n\nroot@node:~/work/isobios# xorriso -as mkisofs -o ../testbios.iso -b isolinux.bin -e boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table ./\nxorriso 1.5.2 : RockRidge filesystem manipulator, libburnia project.\n\nDrive current: -outdev 'stdio:../testbios.iso'\nMedia current: stdio file, overwriteable\nMedia status : is blank\nMedia summary: 0 sessions, 0 data blocks, 0 data, 46.1g free\nAdded to ISO image: directory '/'='/root/work/isobios'\nxorriso : UPDATE :       5 files added in 1 seconds\nxorriso : UPDATE :       5 files added in 1 seconds\nxorriso : FAILURE : Cannot find path '/boot.cat' in loaded ISO image\nxorriso : NOTE : -return_with SORRY 32 triggered by problem severity FAILURE\nroot@node:~/work/isobios#\n</code></pre>"},{"location":"centos-network-device-naming/","title":"centos-network-device-naming","text":"<p>\u8f6c\u81ea: https://www.cnblogs.com/zyd112/p/8143464.html</p>"},{"location":"centos-network-device-naming/#centos7","title":"centos7\u4e2d\u7684\u7f51\u5361\u4e00\u81f4\u6027\u547d\u540d\u89c4\u5219\u3001\u7f51\u5361\u91cd\u547d\u540d\u65b9\u6cd5","text":"<p>\u4e00\u81f4\u6027\u7f51\u7edc\u8bbe\u5907\u547d\u540d(Consistent Network Device Naming)</p> <p>\u80cc\u666f\u4ecb\u7ecd\uff1a</p> <p>\u5728centos5\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4e60\u60ef\u4e86eth0\u8fd9\u6837\u7684\u7f51\u7edc\u8bbe\u5907\u547d\u540d\uff0c\u5728centos6\u53d1\u73b0\u7f51\u7edc\u8bbe\u5907\u53d8\u6210\u4e86em1\u8fd9\u6837\u7684\u547d\u540d\u3002 \u90a3\u65f6\u6211\u4eec\u5728\u5b89\u88c5\u7684\u65f6\u5019\uff0c\u7ed9\u542f\u52a8\u53c2\u6570\u52a0\u4e0a biosdevname=0\uff0c\u5c31\u53ef\u4ee5\u7ee7\u7eed\u4f7f\u7528eth0\u8fd9\u6837\u7684\u547d\u540d\u3002 \u5347\u7ea7\u5230centos7\u540e\uff0c\u53d1\u73b0\u539f\u6709\u7684\u53c2\u6570biosdevname=0\u4e0d\u8d77\u4f5c\u7528\u4e86\uff0c\u7f51\u7edc\u8bbe\u5907\u53d8\u6210\u4e86eno1\u8fd9\u6837\u7684\u540d\u79f0\u3002 centos7\u8fd9\u79cd\u53d8\u5316\u7684\u539f\u56e0\u662f\u7531\u4e8esystemd\u548cudev\u5f15\u5165\u4e86\u4e00\u79cd\u65b0\u7684\u7f51\u7edc\u8bbe\u5907\u547d\u540d\u65b9\u5f0f\uff1a\u4e00\u81f4\u7f51\u7edc\u8bbe\u5907\u547d\u540d\uff08CONSISTENT NETWORK DEVICE NAMING\uff09\u3002</p>"},{"location":"centos-network-device-naming/#_1","title":"\u4e00\u3001\u4e3a\u4ec0\u4e48\u9700\u8981\u8fd9\u4e2a","text":"<p>\u670d\u52a1\u5668\u901a\u5e38\u6709\u591a\u5757\u7f51\u5361\uff0c\u6709\u677f\u8f7d\u96c6\u6210\u7684\uff0c\u540c\u65f6\u4e5f\u6709\u63d2\u5728PCIe\u63d2\u69fd\u7684\u3002 Linux\u7cfb\u7edf\u7684\u547d\u540d\u539f\u6765\u662feth0,eth1\u8fd9\u6837\u7684\u5f62\u5f0f\uff0c\u4f46\u662f\u8fd9\u4e2a\u7f16\u53f7\u5f80\u5f80\u4e0d\u4e00\u5b9a\u51c6\u786e\u5bf9\u5e94\u7f51\u5361\u63a5\u53e3\u7684\u7269\u7406\u987a\u5e8f\u3002 \u4e3a\u89e3\u51b3\u8fd9\u7c7b\u95ee\u9898,dell\u5f00\u53d1\u4e86biosdevname\u65b9\u6848(systemd v197\u7248\u672c\u4e2d\u5c06dell\u7684\u65b9\u6848\u4f5c\u4e86\u8fdb\u4e00\u6b65\u7684\u4e00\u822c\u5316\u62d3\u5c55)\u3002  </p> <p>\u76ee\u524d\u7684Centos\u65e2\u652f\u6301dell\u7684biosdevname\uff0c\u4e5f\u652f\u6301systemd\u7684\u65b9\u6848\u3002</p>"},{"location":"centos-network-device-naming/#centos7_1","title":"\u4e8c\u3001Centos7\u4e2d\u7684\u547d\u540d\u7b56\u7565","text":"<pre><code>Scheme 1: \u5982\u679c\u4eceBIOS\u4e2d\u80fd\u591f\u53d6\u5230\u53ef\u7528\u7684\uff0c\u677f\u8f7d\u7f51\u5361\u7684\u7d22\u5f15\u53f7\uff0c\u5219\u4f7f\u7528\u8fd9\u4e2a\u7d22\u5f15\u53f7\u547d\u540d\uff0c\u4f8b\u5982: eno1\uff0c\u5982\u4e0d\u80fd\u5219\u5c1d\u8bd5Scheme 2\nScheme 2: \u5982\u679c\u4eceBIOS\u4e2d\u80fd\u591f\u53d6\u5230\u53ef\u4ee5\u7528\u7684\uff0c\u7f51\u5361\u6240\u5728\u7684PCI-E\u70ed\u63d2\u62d4\u63d2\u69fd\u7684\u7d22\u5f15\u53f7\uff0c\u5219\u4f7f\u7528\u8fd9\u4e2a\u7d22\u5f15\u53f7\u547d\u540d\uff0c\u4f8b\u5982: ens1\uff0c\u5982\u4e0d\u80fd\u5219\u5c1d\u8bd5Scheme 3\nScheme 3: \u5982\u679c\u80fd\u62ff\u5230\u8bbe\u5907\u6240\u8fde\u63a5\u7684\u7269\u7406\u4f4d\u7f6e\u4fe1\u606f\uff0c\u5219\u4f7f\u7528\u8fd9\u4e2a\u4fe1\u606f\u547d\u540d\uff0c\u4f8b\u5982:enp2s0\uff0c\u5982\u4e0d\u80fd\u5219\u5c1d\u8bd5Scheme 5\nScheme 4: \u4f7f\u7528\u7f51\u5361\u7684MAC\u5730\u5740\u6765\u547d\u540d\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4e00\u822c\u4e0d\u4f7f\u7528\u3002\nScheme 5\uff1a\u4f20\u7edf\u7684kernel\u547d\u540d\u65b9\u6cd5\uff0c\u4f8b\u5982: eth0\uff0c\u8fd9\u79cd\u547d\u540d\u65b9\u6cd5\u7684\u7ed3\u679c\u4e0d\u53ef\u9884\u77e5\u7684\uff0c\u5373\u53ef\u80fd\u7b2c\u4e8c\u5757\u7f51\u5361\u5bf9\u5e94eth0\uff0c\u7b2c\u4e00\u5757\u7f51\u5361\u5bf9\u5e94eth1\u3002\n</code></pre>"},{"location":"centos-network-device-naming/#biosdevnamenetifnames","title":"\u4e09\u3001biosdevname\u548cnet.ifnames\u4e24\u79cd\u547d\u540d\u89c4\u8303","text":"<p>net.ifnames\u547d\u540d\u89c4\u8303\u4e3a:\u8bbe\u5907\u7c7b\u578b+\u8bbe\u5907\u4f4d\u7f6e+\u6570\u5b57</p> <p></p> <p>\u8bbe\u5907\u7c7b\u578b\uff1a   - en \u8868\u793aEthernet   - wl \u8868\u793aWLAN   - ww \u8868\u793a\u65e0\u7ebf\u5e7f\u57df\u7f51WWAN</p> <p>\u5b9e\u9645\u7684\u4f8b\u5b50:   - eno1 \u677f\u8f7d\u7f51\u5361   - enp0s2  pci\u7f51\u5361   - ens33   pci\u7f51\u5361   - wlp3s0  PCI\u65e0\u7ebf\u7f51\u5361   - wwp0s29f7u2i2   4G modem   - wlp0s2f1u4u1   \u8fde\u63a5\u5728USB Hub\u4e0a\u7684\u65e0\u7ebf\u7f51\u5361   - enx78e7d1ea46da pci\u7f51\u5361</p> <p>biosdevname\u7684\u547d\u540d\u89c4\u8303\u4e3a:</p> <p></p> <p>\u5b9e\u9645\u7684\u4f8b\u5b50:   - em1 \u677f\u8f7d\u7f51\u5361   - p3p4 pci\u7f51\u5361   - p3p4_1 \u865a\u62df\u7f51\u5361</p>"},{"location":"centos-network-device-naming/#systemd","title":"\u56db\u3001systemd\u4e2d\u7684\u5b9e\u9645\u6267\u884c\u987a\u5e8f","text":"<p>\u6309\u7167\u5982\u4e0b\u987a\u5e8f\u6267\u884cudev\u7684rule</p> <ol> <li><code>/usr/lib/udev/rules.d/60-net.rules</code></li> <li><code>/usr/lib/udev/rules.d/71-biosdevname.rules</code></li> <li><code>/lib/udev/rules.d/75-net-description.rules</code></li> <li> <p><code>/usr/lib/udev/rules.d/80-net-name-slot.rules</code></p> </li> <li> <p>60-net.rules  \u4f7f\u7528/lib/udev/rename_device\u8fd9\u4e2a\u7a0b\u5e8f\uff0c\u53bb\u67e5\u8be2/etc/sysconfig/network-scripts/\u4e0b\u6240\u6709\u4ee5ifcfg-\u5f00\u5934\u7684\u6587\u4ef6 \u5982\u679c\u5728ifcfg-xx\u4e2d\u5339\u914d\u5230HWADDR=xx:xx:xx:xx:xx:xx\u53c2\u6570\u7684\u7f51\u5361\u63a5\u53e3 \u5219\u9009\u53d6DEVICE=yyyy\u4e2d\u8bbe\u7f6e\u7684\u540d\u5b57\u4f5c\u4e3a\u7f51\u5361\u540d\u79f0\u3002  </p> </li> <li> <p>71-biosdevname.rules \u5982\u679c\u7cfb\u7edf\u4e2d\u5b89\u88c5\u4e86biosdevname\uff0c\u4e14\u5185\u6838\u53c2\u6570\u672a\u6307\u5b9abiosdevname=0\uff0c\u4e14\u4e0a\u4e00\u6b65\u6ca1\u6709\u91cd\u547d\u540d\u7f51\u5361\uff0c\u5219\u6309\u7167biosdevname\u7684\u547d\u540d\u89c4\u8303\uff0c\u4eceBIOS\u4e2d\u53d6\u76f8\u5173\u4fe1\u606f\u6765\u547d\u540d\u7f51\u5361\u3002 \u4e3b\u8981\u662f\u53d6SMBIOS\u4e2d\u7684type 9 (System Slot) \u548c type 41 (Onboard Devices Extended Information) \u4e0d\u8fc7\u8981\u6c42SMBIOS\u7684\u7248\u672c\u8981\u9ad8\u4e8e2.6\uff0c\u4e14\u7cfb\u7edf\u4e2d\u8981\u5b89\u88c5biosdevname\u7a0b\u5e8f\u3002  </p> </li> <li> <p>75-net-description.rules udev\u901a\u8fc7\u68c0\u67e5\u7f51\u5361\u4fe1\u606f\uff0c\u586b\u5199\u5982\u4e0b\u8fd9\u4e9budev\u7684\u5c5e\u6027\u503c  </p> </li> <li> <p>ID_NET_NAME_ONBOARD</p> </li> <li>ID_NET_NAME_SLOT</li> <li>ID_NET_NAME_PATH</li> <li> <p>ID_NET_NAME_MAC</p> </li> <li> <p>80-net-name-slot.rules \u5982\u679c\u572860-net.rules \uff0c71-biosdevname.rules\u8fd9\u4e24\u6761\u89c4\u5219\u4e2d\u6ca1\u6709\u91cd\u547d\u540d\u7f51\u5361\uff0c\u4e14\u5185\u6838\u672a\u6307\u5b9anet.ifnames=0\u53c2\u6570 \u5219udev\u4f9d\u6b21\u5c1d\u8bd5\u4f7f\u7528\u4ee5\u4e0b\u5c5e\u6027\u503c\u6765\u547d\u540d\u7f51\u5361\uff0c\u5982\u679c\u8fd9\u4e9b\u5c5e\u6027\u503c\u90fd\u6ca1\u6709\uff0c\u5219\u7f51\u5361\u4e0d\u4f1a\u88ab\u91cd\u547d\u540d\u3002  </p> </li> <li> <p>ID_NET_NAME_ONBOARD</p> </li> <li>ID_NET_NAME_SLOT</li> <li>ID_NET_NAME_PATH</li> </ol> <p>\u4e0a\u8fb9\u768471-biosdevname.rules \u662f\u5b9e\u9645\u6267\u884cbiosdevname\u7684policy 75-net-description.rules\u548c80-net-name-slot.rules\u5b9e\u9645\u6267\u884cScheme 1,2,3  </p> <p>\u6839\u636e\u4e0a\u8ff0\u7684\u8fc7\u7a0b\uff0c\u53ef\u89c1\u7f51\u5361\u547d\u540d\u53d7 biosdevname\u548cnet.ifnames\u8fd9\u4e24\u4e2a\u5185\u6838\u53c2\u6570\u5f71\u54cd\u3002</p>"},{"location":"centos-network-device-naming/#biosdevnamenetifnames_1","title":"\u4e94\u3001biosdevname/net.ifnames\u5e94\u7528","text":"<p>\u8fd9\u4e24\u4e2a\u53c2\u6570\u90fd\u53ef\u4ee5\u5728grub\u914d\u7f6e\u4e2d\u63d0\u4f9b\uff0cbiosdevname=0\u662f\u7cfb\u7edf\u9ed8\u8ba4\u503c\uff08dell\u670d\u52a1\u5668\u9ed8\u8ba4\u662f1\uff09\uff0cnet.ifnames=1\u662f\u7cfb\u7edf\u9ed8\u8ba4\u503c\u3002</p> <pre><code>#vi /boot/grub/grub.conf\nkernel /boot/vmlinuz biosdevname=1\ninitrd /boot/initrd.img\n</code></pre> <p>\u7b2c\u4e8c\u8282\u6240\u8bf4\u7684Scheme\u7684\u7b56\u7565\u987a\u5e8f\u662f\u7cfb\u7edf\u9ed8\u8ba4\u7684\u3002 \u5982\u7cfb\u7edfBIOS\u7b26\u5408\u8981\u6c42\uff0c\u4e14\u7cfb\u7edf\u4e2d\u5b89\u88c5\u4e86biosdevname\uff0c\u4e14biosdevname=1\u542f\u7528\uff0c\u5219biosdevname\u4f18\u5148\uff1b \u5982\u679cBIOS\u4e0d\u7b26\u5408biosdevname\u8981\u6c42\u6216biosdevname=0\uff0c\u5219\u4ecd\u7136\u662fsystemd\u7684\u89c4\u5219\u4f18\u5148\u3002 \u5982\u679c\u7528\u6237\u81ea\u5df1\u5b9a\u4e49\u4e86udev rule\u6765\u4fee\u6539\u5185\u6838\u8bbe\u5907\u540d\u5b57\uff0c\u5219\u7528\u6237\u89c4\u5219\u4f18\u5148\u3002  </p> <p>\u5185\u6838\u53c2\u6570\u7ec4\u5408\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u5176\u7ed3\u679c\u5982\u4e0b\uff1a \u9ed8\u8ba4\u5185\u6838\u53c2\u6570(biosdevname=0\uff0cnet.ifnames=1):  \u7f51\u5361\u540d \"enp5s2\" biosdevname=1\uff0cnet.ifnames=0\uff1a\u7f51\u5361\u540d \"em1\" biosdevname=0\uff0cnet.ifnames=0\uff1a\u7f51\u5361\u540d \"eth0\" (\u6700\u4f20\u7edf\u7684\u65b9\u5f0f,eth0 eth1 \u50bb\u50bb\u5206\u4e0d\u6e05)  </p>"},{"location":"centos-network-device-naming/#centos7ethx","title":"\u516d\u3001centos7\u7f51\u5361\u91cd\u547d\u540d\u4e3aethx\u683c\u5f0f","text":"<p>\u5982\u679c\u4f60\u5e0c\u671b\u7ee7\u7eed\u4f7f\u7528 eth0 \u8fd9\u6837\u7684\u4f20\u7edf\u540d\u79f0\uff0c\u90a3\u4e48\u5728\u5b89\u88c5\u542f\u52a8\uff08pxe\uff09\u65f6\u52a0\u4e0a\u53c2\u6570\uff1a net.ifnames=0 biosdevname=0</p> <p>cobbler profile \u4fee\u6539\u65b9\u6cd5\uff1a</p> <p><code>cobbler profile edit --name=Centos-7.3-x86_64 --kopts='net.ifnames=0 biosdevname=0'</code></p> <p>\u5982\u679c\u4f60\u5df2\u7ecf\u5b89\u88c5\u5b8c\u4e86\uff0c\u5e0c\u671b\u6539\u6210eth0\u8fd9\u6837\u7684\u540d\u79f0\uff0c\u90a3\u4e48\u6267\u884c\u5982\u4e0b\u64cd\u4f5c\u9700\u8981\uff1a</p> <p>1.\u4fee\u6539grub2\u542f\u52a8\u53c2\u6570\uff0c\u5728GRUB_CMDLINE_LINUX\u7684\u4e2d\u52a0\u4e0a\"net.ifnames=0 biosdevname=0\"\u7684\u53c2\u6570</p> <pre><code>vi /etc/sysconfig/grub\nGRUB_CMDLINE_LINUX=\u201drd.lvm.lv=vg0/swap vconsole.keymap=us crashkernel=auto vconsole.font=latarcyrheb-sun16 net.ifnames=0 biosdevname=0 rd.lvm.lv=vg0/usr rhgb quiet\u201d\n</code></pre> <p>2.\u91cd\u65b0\u52a0\u8f7d\u5230\u542f\u52a8\u4e2d</p> <p><code>grub2-mkconfig -o /boot/grub2/grub.cfg</code></p> <p>3.\u91cd\u65b0\u5bf9\u7f51\u5361\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u547d\u540d\uff08\u7f51\u5361\u6587\u4ef6\u5168\u90e8\u91cd\u547d\u540d\uff0c\u987a\u4fbf\u4fee\u6539\u914d\u7f6e\u6587\u4ef6NAME\u3001DEVICE\u7684\u540d\u79f0\uff09</p> <p><code>mv /etc/sysconfig/network-scripts/ifcfg-enp0s3 /etc/sysconfig/network-scripts/ifcfg-eth0</code></p> <p>4.reboot\u91cd\u542f\u751f\u6548</p> <p>\u53c2\u8003\u6587\u6863\uff1a - https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/ch-Consistent_Network_Device_Naming.html - https://bugzilla.redhat.com/show_bug.cgi?id=965718</p> <p>\u6709\u4ec0\u4e48\u95ee\u9898\u5c3d\u7ba1\u8bf4\uff0c\u53cd\u6b63\u6211\u4e5f\u4e0d\u4f1a\u5e2e\u4f60\u7684</p> <p>\u8f6c\u81ea: https://blog.csdn.net/maomao5945/article/details/79354204</p> <p>\u4ececentos7\u5f00\u59cb\uff0c\u7cfb\u7edf\u9ed8\u8ba4\u7684\u7f51\u5361\u547d\u540d\u6709\u5df2\u7ecf\u4e0d\u662f\u6211\u4eec\u719f\u6089\u7684ethX\u65b9\u5f0f\u4e86\uff0c\u7ec6\u5fc3\u7684\u540c\u5b66\u4f1a\u7559\u610f\u5230\u4e00\u4e9b\u6bd4\u5982ens enp\u7b49\u5f00\u5934\u7684\u7f51\u5361\u540d\u79f0\uff0c\u7b80\u5355\u4e86\u89e3\uff0c\u53ef\u4ee5\u89e3\u91ca\u4e3acentos7\u5f00\u59cb\uff0c\u7f51\u5361\u547d\u540d\u4f1a\u6839\u636e\u7f51\u5361\u7684\u786c\u4ef6\u4fe1\u606f\uff0c\u63d2\u69fd\u4f4d\u7f6e\u7b49\u6709\u5173\uff1b</p> <p>\u800c\u7f51\u4e0a\u4e5f\u6709\u4e3a\u90a3\u4e9b\u4f9d\u7136\u60f3\u4f7f\u7528ethX\u65b9\u5f0f\u547d\u540d\u7684\u63d0\u4f9b\u4e86\u7b56\u7565\u3002\u6bd4\u5982\u5728\u5185\u6838\u542f\u52a8\u53c2\u6570\u91cc\u589e\u52a0biosdevname=0 net.ifnames=0\uff1b</p> <p>\u4f46\u662f\u8fd9\u91cc\u5ffd\u7565\u4e86 \u4e00\u4e2a\u95ee\u9898\uff0c\u90a3\u5c31\u662f\u4e3a\u4ec0\u4e48centos7\u4e0d\u518d\u4f7f\u7528\u4ee5\u524d\u7684ethX\u65b9\u5f0f\uff1f\u6839\u672c\u662f\u56e0\u4e3a\u4e4b\u524dethX\u65b9\u5f0f\u662f\u4e0d\u786e\u5b9a\u7684\uff0c\u6bcf\u6b21\u542f\u52a8\u53ef\u80fd\u90fd\u4e0d\u540c\uff08\u5982\u679c\u6ca1\u6709\u7528\u6237\u81ea\u5b9a\u4e49\u7f51\u5361\u540d\u79f0\u7684\u524d\u63d0\u4e0b\uff09\uff1b</p> <p>\u6240\u4ee5\u5927\u5bb6\u63d0\u4f9b\u7684\u8fd9\u79cd\u529e\u6cd5\u5176\u5b9e\u662f\u4e0d\u597d\u7684\uff1b</p> <p>\u89e3\u91ca\u5b8c\u4e0a\u9762\u5185\u5bb9\u4e4b\u540e\uff0c\u54b1\u4eec\u6765\u770b\u4e0b\u5230\u5e95\u7f51\u5361\u540d\u79f0\u662f\u5982\u4f55\u547d\u540d\u7684\u3002</p> <p>\u6838\u5fc3\u6d41\u7a0b\uff1a\u660e\u786e\u4e00\u70b9\u662f\uff0clinux\u5185\u6838\u542f\u52a8\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u9ed8\u8ba4\u7ed9\u7f51\u5361\u4ee5ethX\u65b9\u5f0f\u968f\u673a\u547d\u540d\uff0c\u7136\u540e\u518d\u901a\u8fc7systemd\u53bbrename\u6210\u5176\u4ed6\u540d\u79f0\u3002\u5173\u952e\u5b57\uff0crename!</p>"},{"location":"centos-network-device-naming/#rename","title":"\u4e00\u3001\u5982\u4f55rename\uff1f","text":""},{"location":"centos-network-device-naming/#rename_1","title":"\u9ed8\u8ba4rename\u6d41\u7a0b\uff1a","text":"<ul> <li> <p>step1 \u4f9d\u636e/usr/lib/udev/rules.d/60-net.rules\uff0c \u67e5\u770b\u662f\u5426\u6709ifcfg-xx\u914d\u7f6e\u6587\u4ef6\uff08\u8def\u5f84\u5728/etc/sysconfig/network-scripts/),\u662f\u5426\u6709\u5b9a\u4e49\u4e86\u6307\u5b9aMAC\u5730\u5740\u7684\u914d\u7f6e\u6587\u4ef6\uff08ifcfg-xx \uff0cxx\u5fc5\u987b\u548c\u914d\u7f6e\u6587\u4ef6\u7684\u5185\u5bb9DEVICE\u4e00\u81f4\uff09\uff0c\u5982\u679c\u6709\uff0c\u5219\u547d\u540d\u6539\u7f51\u5361\uff1b</p> </li> <li> <p>step2 \u4f9d\u636e/usr/lib/udev/rules.d/71-biosdevname.rules\uff0c\u5982\u679cbiosdevname\u4f7f\u80fd\u4e86\uff08\u5b89\u88c5\u4e86biosdevname\u8fd9\u4e2a\u5305\uff0c\u4e14\u5185\u6838\u542f\u52a8\u53c2\u6570\u663e\u5f0f\u8bbe\u7f6e\u4e3a1\uff09\uff0c\u4e14\u7f51\u5361\u6ca1\u6709\u5728step1\u4e2d\u5b9a\u4e49\uff0c\u5219\u6309\u7167biosdevname\u547d\u540d\u89c4\u5219rename\u7f51\u5361\uff1b\uff08\u6ce8\u610f\uff0c\u5982\u679c\u6ca1\u6709\u5b89\u88c5biosdevname\u8fd9\u4e2a\u5305\uff0c\u5c31\u6ca1\u6709\u8fd9\u4e2a\u6587\u4ef6\uff09</p> </li> <li>step3, \u4f9d\u636e/lib/udev/rules.d/75-net-description.rules\uff0c\u5c06udev\u5de5\u5177\u4f1a\u6839\u636edevice\u5c5e\u6027\u5c06\u586b\u5199\u7f51\u5361\u7684\u5c5e\u6027\u547d\u540d\uff0c\u53ef\u80fd\u4e00\u4e2a\u7f51\u5361\u4f1a\u6709\u591a\u4e2a\u7ef4\u5ea6\u7684\u540d\u79f0\u54e6\uff1b</li> <li>step4\uff0cudev \u6839\u636estep3\u4e2d\u7684\u8d4b\u503c\uff0c\u6309\u7167\u6307\u5b9a\u7684scheme\u89c4\u5219\uff0c\u53bb\u7ed9\u5728step1 step2\u4e2d\u6ca1\u6709\u547d\u540d\u7684\u7f51\u5361\u547d\u540d\uff1b \u00a0 \u00a0 \u5f3a\u8c03\uff1a\u8fd9\u4e2astep\u987a\u5e8f\u662f\u5728\u6211\u4eec\u6ca1\u6709\u81ea\u5b9a\u4e49\u81ea\u5df1\u7684rules\u7684\u524d\u63d0\u4e0b\uff0c\u5982\u679c\u7528\u6237\u81ea\u5b9a\u4e49\u4e86\u81ea\u5df1\u7684rules\uff0c\u5219\u7528\u6237\u81ea\u5b9a\u4e49\u4e3a\u4f18\u5148\u7ea7\u6700\u9ad8\uff1b</li> </ul>"},{"location":"centos-network-device-naming/#scheme","title":"\u4e8c\u3001scheme\u6b21\u5e8f","text":""},{"location":"centos-network-device-naming/#step4scheme","title":"\u4e0a\u9762step4\u4e2d\u63d0\u5230\uff0c\u6309\u7167\u6307\u5b9a\u7684scheme\u89c4\u5219\uff0c\u8fd9\u4e2a\u89c4\u5219\u662f\u4ec0\u4e48\u5462\uff1f","text":"<ul> <li>\u9996\u5148\u8bf4step3\u4e2d\uff0c\u63d0\u5230\u6309\u7167\u7f51\u5361\u7684\u4e0d\u540c\u5c5e\u6027\u547d\u540d\uff0c\u7cfb\u7edf\u8bc6\u522b\u7f51\u5361\u6709\u597d\u51e0\u79cd\u7ef4\u5ea6\uff1a\u00a0\u00a0</li> <li>\u6bd4\u5982\u00a0BIOS provided index numbers for on-board devices (example:\u00a0eno1),</li> <li>\u6bd4\u5982\uff1aBIOS provided PCI Express hotplug slot index numbers (example:\u00a0ens1)\u00a0</li> <li>\u6bd4\u5982\uff1aphysical location of the connector of the hardware (example:\u00a0enp2s0),\u00a0</li> <li>\u6bd4\u5982\uff1amac\u5730\u5740</li> <li>\u540c\u4e00\u4e2a\u7f51\u5361\u901a\u5e38\u540c\u65f6\u5177\u6709\u591a\u4e2a\u7ef4\u5ea6\u7684\u540d\u79f0\uff0csystemd\u5728\u9009\u53d6\u7684\u65f6\u5019\uff0c\u6309\u7167\u6709\u5148\u540e\u6b21\u5e8f\uff0c\u4f7f\u7528\u5148\u547d\u4e2d\u7684\uff1b</li> <li>\u987a\u5e8f\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a\uff08eno1-ens1-enp1\uff09</li> </ul> <ul> <li>eth2\u8fd9\u4e2a\u7f51\u5361\uff0cscheme\u540d\u79f0\u67093\u4e2a\uff0c\u5982\u679csystemd\u81ea\u9009\uff0c\u4f1a\u4f7f\u7528\u54ea\u4e2a\uff1fens5f0.(\u90a3\u8fd9\u4e2a\u4e3a\u4ec0\u4e48\u662f/sys/class/net/eth2 \u800c\u4e0d\u662f/sys/class/net/ens5f0 \uff0c\u90a3\u662f\u56e0\u4e3a\u81ea\u5b9a\u4e49\u7684\u7f18\u6545\uff1b)</li> </ul>"},{"location":"centos-network-device-naming/#_2","title":"\u4e09\u3001\u7528\u6237\u81ea\u5b9a\u4e49\u7f51\u5361\u540d\u79f0","text":"<ul> <li> <p>1\u3001\u5728\u7528\u6237\u6ca1\u6709\u81ea\u5b9a\u4e49rules\u6587\u4ef6\u524d\u63d0\u4e0b\uff0cstep1\u4e2d\u7684\u7f51\u5361\u547d\u540d\u65b9\u5f0f\u4e5f\u53ef\u8ba4\u4e3a\u662f \u4e00\u79cd\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u7f51\u5361\u547d\u540d\uff0c\u5373\u5728/etc/sysconfig/network-scripts/ifcfg-xx \u6587\u4ef6\uff0cxx\u5c31\u662f\u8fd9\u4e2a\u7f51\u5361\u540d\u79f0\uff0c\u6587\u4ef6\u5185\u5bb9\u4e2d\u4f53\u73b0MAC_ADDRESS\u3001NAME\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5219\u4f1a\u6309\u7167\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u7684\u540d\u79f0\u6765\u547d\u540d\u7f51\u5361\uff1b</p> </li> <li> <p>2\u3001\u5982\u679c\u7528\u6237\u81ea\u5b9a\u4e49\u4e86rules\u6587\u4ef6\uff0c\u653e\u5728/etc/udev/rules.d/\u76ee\u5f55\u4e0b\uff0c\u5219\u8fd9\u4e2a\u4f18\u5148\u7ea7\u662f\u6700\u9ad8\u7684\uff1b\u6bd41\u4e2difcfg-xx\u65b9\u5f0f\u4f18\u5148\u7ea7\u66f4\u9ad8\uff0c\u4f46\u662f\u5982\u679c\u4e24\u8005\u4e0d\u4e00\u81f4\uff0c\u5219\u5728\u91cd\u542fnetwork\u670d\u52a1\u65f6\uff0c\u4f1a\u4f9d\u636eifcfg-xx\uff0c\u6240\u4ee5\u7528\u6237\u4e0d\u5e94\u8be5\u540c\u65f6\u91c7\u7528\u91cc\u4e24\u79cd\u65b9\u5f0f\u7ed9\u540c\u4e00\u4e2a\u7f51\u5361\u547d\u4e0d\u540c\u7684\u540d\u79f0\uff1b</p> </li> </ul>"},{"location":"centos-network-device-naming/#biosdevnanenetifnames","title":"\u56db\u3001\u5185\u6838\u542f\u52a8\u53c2\u6570biosdevnane\u3001net.ifnames","text":"<p>\u9ed8\u8ba4\u5c31\u662f\u5185\u6838\u542f\u52a8\u53c2\u6570\u6ca1\u6709biosdevname \u4e5f\u6ca1\u6709net.ifnames \u53c2\u6570\uff08\u5176\u5b9e\u9ed8\u8ba4\u662fnet.ifnames=1,biosdevname=0\uff09\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5c31\u6309\u7167\u4e00 \u4e2d\u8fdb\u884c\u7f51\u5361\u547d\u540d\uff1beno-ens-enp\u7684\u65b9\u5f0f\u9010\u4e2a\u5339\u914d\u3002\u4f46\u662f\u5982\u679c\u4f7f\u80fd\u4e86biosdevname.\u5219\u4f1a\u4f7f\u7528biosdevname\u7684\u547d\u540d step1\u6ca1\u6709\u547d\u540d\u7684\u7f51\u5361\uff1b</p>"},{"location":"centos-network-device-naming/#bios","title":"bios\u547d\u540d\u89c4\u5219\uff1a","text":"<ul> <li>\u8981\u4e48\u662fem\u5f00\u5934\uff0c\u8981\u4e48\u662fp\u5f00\u5934\uff1b</li> <li>\u600e\u4e48\u6837\u4f7f\u80fdbiosdevname\u5462\uff1f2\u4e2a\u6761\u4ef6\uff0c\u5b89\u88c5biosdevname\u5305\uff0c\u4e14\u5728\u5185\u6838\u542f\u52a8\u53c2\u6570\u4e2d\u660e\u786e biosdevname=1. \u5426\u5219\u4f7f\u80fd\u4e0d\u4e86\uff1b</li> <li>\u4f46\u662f\u4e0d\u7ba1\u600e\u4e48\u6837\uff0c\u5982\u679c\u7528\u6237\u81ea\u5b9a\u4e49\u4e86udev rules\uff0c\u5219\u7528\u6237\u81ea\u5b9a\u4e49\u7684rules\u4f18\u5148\uff01</li> <li>\u8fd9\u662f\u603b\u8ff0\uff0c\u4f46\u51e1\u7528\u6237\u81ea\u5b9a\u4e49rules\uff0c\u4f18\u5148\u7ea7\u6700\u9ad8\uff1b</li> </ul>"},{"location":"centos-network-device-naming/#netifname","title":"\u5185\u6838\u542f\u52a8\u53c2\u6570net.ifname,","text":"<p>\u5982\u679c\u5728\u542f\u52a8\u53c2\u6570\u4e2d\u589e\u52a0net.ifname=0\uff0c\u8fd9\u4e2a\u6587\u4ef6\u4f1a\u5728/lib/udev/rule.d/80-net-name-slot.rules\u4f53\u73b0\u4f7f\u7528\u4ef7\u503c\uff0c\u5219\u544a\u8bc9\u7cfb\u7edf\u4e0d\u7528scheme\u7684\u65b9\u5f0f\u6765\u547d\u540d\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u4f1a\u6062\u590dethx\u8fd9\u79cd\u4e0d\u786e\u5b9a\u6027\u7684\u547d\u540d\u65b9\u5f0f\uff1b</p>"},{"location":"centos-network-device-naming/#ethx","title":"\u4e94\u3001 \u4e0d\u8981\u7528ethX\u53bb\u547d\u540d","text":"<p>\u5185\u6838\u5728boot \u8fc7\u7a0b\u662f\u9ed8\u8ba4\u4f7f\u7528ethX\u65b9\u5f0f\u6765\u547d\u540d\u7684\uff0c\u6bcf\u6b21\u542f\u52a8\u7684\u65f6\u5019\u90fd\u4e0d\u786e\u5b9a\uff0c\u542f\u52a8\u4f1a\u540e\u518d\u901a\u8fc7udev\u7b49\u65b9\u5f0f\u53bbrename,</p> <p>\u53c2\u8003\u6587\u6863\uff1a https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/sec-troubleshooting_network_device_naming \u00a0 \u00a0</p>"},{"location":"centos7-set-kernel/","title":"centos7-set-kernel","text":"<p>CentOS 7\u3067\u30ab\u30fc\u30cd\u30eb\u3092\u30d3\u30eb\u30c9\u3059\u308b\u6a5f\u4f1a\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30ab\u30fc\u30cd\u30eb\u3092\u5909\u66f4\u3059\u308b\u65b9\u6cd5\u3092\u30e1\u30e2\u3057\u3066\u304a\u304d\u307e\u3059\u3002\u30c6\u30ad\u30b9\u30c8\u30a8\u30c7\u30a3\u30bf\u3067grub.cfg\u3092\u7de8\u96c6\u3059\u308b\u3082\u306e\u3060\u3068\u3059\u3063\u304b\u308a\u601d\u3044\u8fbc\u3093\u3067\u305f\u306e\u3067\u3057\u3070\u3089\u304fgrub.cfg\u3092\u3058\u30fc\u30fc\u3063\u3068\u773a\u3081\u3066\u305f\u306e\u3067\u3059\u304c\u3001\u8abf\u3079\u3066\u307f\u305f\u3068\u3053\u308d\u6e96\u5099\u3055\u308c\u3066\u3044\u308bgrub2-set-default\u30b3\u30de\u30f3\u30c9\u3067\u5909\u66f4\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"centos7-set-kernel/#_1","title":"\u73fe\u5728\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u3092\u8abf\u3079\u308b","text":"<pre><code>[root@backup ~]# grub2-editenv list\nsaved_entry=CentOS Linux (3.10.0-693.2.2.el7.x86_64) 7 (Core)\n[root@backup ~]#\n</code></pre>"},{"location":"centos7-set-kernel/#_2","title":"\u30ab\u30fc\u30cd\u30eb\u306e\u30ea\u30b9\u30c8\u3092\u8868\u793a\u3059\u308b","text":"<pre><code>[root@backup ~]# awk -F\\' '$1==\"menuentry \" {print i++ \" : \" $2}' /etc/grub2.cfg\n0 : CentOS Linux (3.10.0-693.2.2.el7.x86_64) 7 (Core)\n1 : CentOS Linux, with Linux 3.10.0-229.20.1.el7.x86_64\n2 : CentOS Linux, with Linux 3.10.0-123.el7.x86_64\n3 : CentOS Linux, with Linux 0-rescue-1857a64194e64a80a83a91324b8169d5\n[root@backup ~]#\n</code></pre>"},{"location":"centos7-set-kernel/#_3","title":"\u5229\u7528\u3057\u305f\u3044\u30ab\u30fc\u30cd\u30eb\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u306b\u8a2d\u5b9a\u3059\u308b","text":"<p>\u4f8b\u3048\u3070 <code>1 : CentOS Linux, with Linux 3.10.0-229.20.1.el7.x86_64</code> \u306b\u5909\u66f4\u3059\u308b\u5834\u5408\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3067\u3059\u3002</p> <pre><code>[root@backup ~]# grub2-set-default 1\n[root@backup ~]# grub2-editenv list\nsaved_entry=1\n</code></pre>"},{"location":"centos7-set-kernel/#_4","title":"\u518d\u8d77\u52d5\u3057\u3066\u78ba\u8a8d\u3059\u308b","text":""},{"location":"iptables/","title":"iptables","text":""},{"location":"iptables/#iptables","title":"\u30b3\u30d4\u30da\u304b\u3089\u8131\u51fa\uff01iptables\u306e\u4ed5\u7d44\u307f\u3092\u7406\u89e3\u3057\u3066\u74b0\u5883\u306b\u5408\u308f\u305b\u305f\u8a2d\u5b9a\u3092\u3057\u3088\u3046","text":"<ul> <li>https://oxynotes.com/?p=6361</li> </ul>"},{"location":"iptables/#iptables_1","title":"iptables\u8be6\u89e3","text":"<ul> <li>\u539f\u6587</li> </ul>"},{"location":"iptables/#iptables_2","title":"iptables\u6982\u5ff5","text":"<ol> <li>iptables\u8be6\u89e3\uff081\uff09\uff1aiptables\u6982\u5ff5</li> <li>iptables\u8be6\u89e3\uff082\uff09\uff1aiptables\u5b9e\u9645\u64cd\u4f5c\u4e4b\u89c4\u5219\u67e5\u8be2</li> <li>iptables\u8be6\u89e3\uff083\uff09\uff1aiptables\u89c4\u5219\u7ba1\u7406</li> <li>iptables\u8be6\u89e3\uff084\uff09\uff1aiptables\u5339\u914d\u6761\u4ef6\u603b\u7ed3\u4e4b\u4e00</li> <li>iptables\u8be6\u89e3\uff085\uff09\uff1aiptables\u5339\u914d\u6761\u4ef6\u603b\u7ed3\u4e4b\u4e8c\uff08\u5e38\u7528\u6269\u5c55\u6a21\u5757\uff09</li> <li>iptables\u8be6\u89e3\uff086\uff09\uff1aiptables\u6269\u5c55\u5339\u914d\u6761\u4ef6\u4e4b\u2019\u2013tcp-flags\u2019</li> <li>iptables\u8be6\u89e3\uff087\uff09\uff1aiptables\u6269\u5c55\u4e4budp\u6269\u5c55\u4e0eicmp\u6269\u5c55</li> <li>iptables\u8be6\u89e3\uff088\uff09\uff1aiptables\u6269\u5c55\u6a21\u5757\u4e4bstate\u6269\u5c55</li> <li>iptables\u8be6\u89e3\uff089\uff09\uff1aiptables\u7684\u9ed1\u767d\u540d\u5355\u673a\u5236</li> <li>iptables\u8be6\u89e3\uff0810\uff09\uff1aiptables\u81ea\u5b9a\u4e49\u94fe</li> <li>iptables\u8be6\u89e3\uff0811\uff09\uff1aiptables\u4e4b\u7f51\u7edc\u9632\u706b\u5899</li> <li>iptables\u8be6\u89e3\uff0812\uff09\uff1aiptables\u52a8\u4f5c\u603b\u7ed3\u4e4b\u4e00</li> <li>iptables\u8be6\u89e3\uff0813\uff09\uff1aiptables\u52a8\u4f5c\u603b\u7ed3\u4e4b\u4e8c</li> <li>iptables\u8be6\u89e3\uff0814\uff09\uff1aiptables\u5c0f\u7ed3\u4e4b\u5e38\u7528\u5957\u8def</li> </ol>"},{"location":"iptables_1/","title":"iptables\u8be6\u89e3\uff081\uff09\uff1aiptables\u6982\u5ff5","text":"<p>\u8fd9\u7bc7\u6587\u7ae0\u4f1a\u5c3d\u91cf\u4ee5\u901a\u4fd7\u6613\u61c2\u7684\u65b9\u5f0f\u63cf\u8ff0iptables\u7684\u76f8\u5173\u6982\u5ff5\uff0c\u8bf7\u8010\u5fc3\u7684\u8bfb\u5b8c\u5b83\u3002</p>"},{"location":"iptables_1/#_1","title":"\u9632\u706b\u5899\u76f8\u5173\u6982\u5ff5","text":"<p>\u6b64\u5904\u5148\u63cf\u8ff0\u4e00\u4e9b\u76f8\u5173\u6982\u5ff5\u3002</p> <p>\u4ece\u903b\u8f91\u4e0a\u8bb2\u3002\u9632\u706b\u5899\u53ef\u4ee5\u5927\u4f53\u5206\u4e3a\u4e3b\u673a\u9632\u706b\u5899\u548c\u7f51\u7edc\u9632\u706b\u5899\u3002</p> <p>\u4e3b\u673a\u9632\u706b\u5899\uff1a\u9488\u5bf9\u4e8e\u5355\u4e2a\u4e3b\u673a\u8fdb\u884c\u9632\u62a4\u3002</p> <p>\u7f51\u7edc\u9632\u706b\u5899\uff1a\u5f80\u5f80\u5904\u4e8e\u7f51\u7edc\u5165\u53e3\u6216\u8fb9\u7f18\uff0c\u9488\u5bf9\u4e8e\u7f51\u7edc\u5165\u53e3\u8fdb\u884c\u9632\u62a4\uff0c\u670d\u52a1\u4e8e\u9632\u706b\u5899\u80cc\u540e\u7684\u672c\u5730\u5c40\u57df\u7f51\u3002</p> <p>\u7f51\u7edc\u9632\u706b\u5899\u548c\u4e3b\u673a\u9632\u706b\u5899\u5e76\u4e0d\u51b2\u7a81\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\uff0c\u7f51\u7edc\u9632\u706b\u5899\u4e3b\u5916\uff08\u96c6\u4f53\uff09\uff0c \u4e3b\u673a\u9632\u706b\u5899\u4e3b\u5185\uff08\u4e2a\u4eba\uff09\u3002</p> <p>\u4ece\u7269\u7406\u4e0a\u8bb2\uff0c\u9632\u706b\u5899\u53ef\u4ee5\u5206\u4e3a\u786c\u4ef6\u9632\u706b\u5899\u548c\u8f6f\u4ef6\u9632\u706b\u5899\u3002</p> <p>\u786c\u4ef6\u9632\u706b\u5899\uff1a\u5728\u786c\u4ef6\u7ea7\u522b\u5b9e\u73b0\u90e8\u5206\u9632\u706b\u5899\u529f\u80fd\uff0c\u53e6\u4e00\u90e8\u5206\u529f\u80fd\u57fa\u4e8e\u8f6f\u4ef6\u5b9e\u73b0\uff0c\u6027\u80fd\u9ad8\uff0c\u6210\u672c\u9ad8\u3002</p> <p>\u8f6f\u4ef6\u9632\u706b\u5899\uff1a\u5e94\u7528\u8f6f\u4ef6\u5904\u7406\u903b\u8f91\u8fd0\u884c\u4e8e\u901a\u7528\u786c\u4ef6\u5e73\u53f0\u4e4b\u4e0a\u7684\u9632\u706b\u5899\uff0c\u6027\u80fd\u4f4e\uff0c\u6210\u672c\u4f4e\u3002</p> <p></p> <p>\u90a3\u4e48\u5728\u6b64\u5904\uff0c\u6211\u4eec\u5c31\u6765\u804a\u804aLinux\u7684iptables</p> <p>iptables\u5176\u5b9e\u4e0d\u662f\u771f\u6b63\u7684\u9632\u706b\u5899\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u7406\u89e3\u6210\u4e00\u4e2a\u5ba2\u6237\u7aef\u4ee3\u7406\uff0c\u7528\u6237\u901a\u8fc7iptables\u8fd9\u4e2a\u4ee3\u7406\uff0c\u5c06\u7528\u6237\u7684\u5b89\u5168\u8bbe\u5b9a\u6267\u884c\u5230\u5bf9\u5e94\u7684\u201d\u5b89\u5168\u6846\u67b6\u201d\u4e2d\uff0c\u8fd9\u4e2a\u201d\u5b89\u5168\u6846\u67b6\u201d\u624d\u662f\u771f\u6b63\u7684\u9632\u706b\u5899\uff0c\u8fd9\u4e2a\u6846\u67b6\u7684\u540d\u5b57\u53ebnetfilter</p> <p>netfilter\u624d\u662f\u9632\u706b\u5899\u771f\u6b63\u7684\u5b89\u5168\u6846\u67b6\uff08framework\uff09\uff0cnetfilter\u4f4d\u4e8e\u5185\u6838\u7a7a\u95f4\u3002</p> <p>iptables\u5176\u5b9e\u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u4f4d\u4e8e\u7528\u6237\u7a7a\u95f4\uff0c\u6211\u4eec\u7528\u8fd9\u4e2a\u5de5\u5177\u64cd\u4f5c\u771f\u6b63\u7684\u6846\u67b6\u3002</p> <p>netfilter/iptables\uff08\u4e0b\u6587\u4e2d\u7b80\u79f0\u4e3aiptables\uff09\u7ec4\u6210Linux\u5e73\u53f0\u4e0b\u7684\u5305\u8fc7\u6ee4\u9632\u706b\u5899\uff0c\u4e0e\u5927\u591a\u6570\u7684Linux\u8f6f\u4ef6\u4e00\u6837\uff0c\u8fd9\u4e2a\u5305\u8fc7\u6ee4\u9632\u706b\u5899\u662f\u514d\u8d39\u7684\uff0c\u5b83\u53ef\u4ee5\u4ee3\u66ff\u6602\u8d35\u7684\u5546\u4e1a\u9632\u706b\u5899\u89e3\u51b3\u65b9\u6848\uff0c\u5b8c\u6210\u5c01\u5305\u8fc7\u6ee4\u3001\u5c01\u5305\u91cd\u5b9a\u5411\u548c\u7f51\u7edc\u5730\u5740\u8f6c\u6362\uff08NAT\uff09\u7b49\u529f\u80fd\u3002</p> <p>Netfilter\u662fLinux\u64cd\u4f5c\u7cfb\u7edf\u6838\u5fc3\u5c42\u5185\u90e8\u7684\u4e00\u4e2a\u6570\u636e\u5305\u5904\u7406\u6a21\u5757\uff0c\u5b83\u5177\u6709\u5982\u4e0b\u529f\u80fd\uff1a</p> <p>\u7f51\u7edc\u5730\u5740\u8f6c\u6362(Network Address Translate)</p> <p>\u6570\u636e\u5305\u5185\u5bb9\u4fee\u6539</p> <p>\u4ee5\u53ca\u6570\u636e\u5305\u8fc7\u6ee4\u7684\u9632\u706b\u5899\u529f\u80fd</p> <p>\u6240\u4ee5\u8bf4\uff0c\u867d\u7136\u6211\u4eec\u4f7f\u7528service iptables start\u542f\u52a8iptables\u201d\u670d\u52a1\u201d\uff0c\u4f46\u662f\u5176\u5b9e\u51c6\u786e\u7684\u6765\u8bf4\uff0ciptables\u5e76\u6ca1\u6709\u4e00\u4e2a\u5b88\u62a4\u8fdb\u7a0b\uff0c\u6240\u4ee5\u5e76\u4e0d\u80fd\u7b97\u662f\u771f\u6b63\u610f\u4e49\u4e0a\u7684\u670d\u52a1\uff0c\u800c\u5e94\u8be5\u7b97\u662f\u5185\u6838\u63d0\u4f9b\u7684\u529f\u80fd\u3002</p>"},{"location":"iptables_1/#iptables","title":"iptables\u57fa\u7840","text":"<p>\u6211\u4eec\u77e5\u9053iptables\u662f\u6309\u7167\u89c4\u5219\u6765\u529e\u4e8b\u7684\uff0c\u6211\u4eec\u5c31\u6765\u8bf4\u8bf4\u89c4\u5219\uff08rules\uff09\uff0c\u89c4\u5219\u5176\u5b9e\u5c31\u662f\u7f51\u7edc\u7ba1\u7406\u5458\u9884\u5b9a\u4e49\u7684\u6761\u4ef6\uff0c\u89c4\u5219\u4e00\u822c\u7684\u5b9a\u4e49\u4e3a\u201d\u5982\u679c\u6570\u636e\u5305\u5934\u7b26\u5408\u8fd9\u6837\u7684\u6761\u4ef6\uff0c\u5c31\u8fd9\u6837\u5904\u7406\u8fd9\u4e2a\u6570\u636e\u5305\u201d\u3002\u89c4\u5219\u5b58\u50a8\u5728\u5185\u6838\u7a7a\u95f4\u7684\u4fe1\u606f\u5305\u8fc7\u6ee4\u8868\u4e2d\uff0c\u8fd9\u4e9b\u89c4\u5219\u5206\u522b\u6307\u5b9a\u4e86\u6e90\u5730\u5740\u3001\u76ee\u7684\u5730\u5740\u3001\u4f20\u8f93\u534f\u8bae\uff08\u5982TCP\u3001UDP\u3001ICMP\uff09\u548c\u670d\u52a1\u7c7b\u578b\uff08\u5982HTTP\u3001FTP\u548cSMTP\uff09\u7b49\u3002\u5f53\u6570\u636e\u5305\u4e0e\u89c4\u5219\u5339\u914d\u65f6\uff0ciptables\u5c31\u6839\u636e\u89c4\u5219\u6240\u5b9a\u4e49\u7684\u65b9\u6cd5\u6765\u5904\u7406\u8fd9\u4e9b\u6570\u636e\u5305\uff0c\u5982\u653e\u884c\uff08accept\uff09\u3001\u62d2\u7edd\uff08reject\uff09\u548c\u4e22\u5f03\uff08drop\uff09\u7b49\u3002\u914d\u7f6e\u9632\u706b\u5899\u7684\u4e3b\u8981\u5de5\u4f5c\u5c31\u662f\u6dfb\u52a0\u3001\u4fee\u6539\u548c\u5220\u9664\u8fd9\u4e9b\u89c4\u5219\u3002</p> <p>\u8fd9\u6837\u8bf4\u53ef\u80fd\u5e76\u4e0d\u5bb9\u6613\u7406\u89e3\uff0c\u6211\u4eec\u6765\u6362\u4e2a\u5bb9\u6613\u7406\u89e3\u7684\u89d2\u5ea6\uff0c\u4ece\u5934\u8bf4\u8d77.</p> <p>\u5f53\u5ba2\u6237\u7aef\u8bbf\u95ee\u670d\u52a1\u5668\u7684web\u670d\u52a1\u65f6\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u62a5\u6587\u5230\u7f51\u5361\uff0c\u800ctcp/ip\u534f\u8bae\u6808\u662f\u5c5e\u4e8e\u5185\u6838\u7684\u4e00\u90e8\u5206\uff0c\u6240\u4ee5\uff0c\u5ba2\u6237\u7aef\u7684\u4fe1\u606f\u4f1a\u901a\u8fc7\u5185\u6838\u7684TCP\u534f\u8bae\u4f20\u8f93\u5230\u7528\u6237\u7a7a\u95f4\u4e2d\u7684web\u670d\u52a1\u4e2d\uff0c\u800c\u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u62a5\u6587\u7684\u76ee\u6807\u7ec8\u70b9\u4e3aweb\u670d\u52a1\u6240\u76d1\u542c\u7684\u5957\u63a5\u5b57\uff08IP\uff1aPort\uff09\u4e0a\uff0c\u5f53web\u670d\u52a1\u9700\u8981\u54cd\u5e94\u5ba2\u6237\u7aef\u8bf7\u6c42\u65f6\uff0cweb\u670d\u52a1\u53d1\u51fa\u7684\u54cd\u5e94\u62a5\u6587\u7684\u76ee\u6807\u7ec8\u70b9\u5219\u4e3a\u5ba2\u6237\u7aef\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0cweb\u670d\u52a1\u6240\u76d1\u542c\u7684IP\u4e0e\u7aef\u53e3\u53cd\u800c\u53d8\u6210\u4e86\u539f\u70b9\uff0c\u6211\u4eec\u8bf4\u8fc7\uff0cnetfilter\u624d\u662f\u771f\u6b63\u7684\u9632\u706b\u5899\uff0c\u5b83\u662f\u5185\u6838\u7684\u4e00\u90e8\u5206\uff0c\u6240\u4ee5\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8981\u9632\u706b\u5899\u80fd\u591f\u8fbe\u5230\u201d\u9632\u706b\u201d\u7684\u76ee\u7684\uff0c\u5219\u9700\u8981\u5728\u5185\u6838\u4e2d\u8bbe\u7f6e\u5173\u5361\uff0c\u6240\u6709\u8fdb\u51fa\u7684\u62a5\u6587\u90fd\u8981\u901a\u8fc7\u8fd9\u4e9b\u5173\u5361\uff0c\u7ecf\u8fc7\u68c0\u67e5\u540e\uff0c\u7b26\u5408\u653e\u884c\u6761\u4ef6\u7684\u624d\u80fd\u653e\u884c\uff0c\u7b26\u5408\u963b\u62e6\u6761\u4ef6\u7684\u5219\u9700\u8981\u88ab\u963b\u6b62\uff0c\u4e8e\u662f\uff0c\u5c31\u51fa\u73b0\u4e86input\u5173\u5361\u548coutput\u5173\u5361\uff0c\u800c\u8fd9\u4e9b\u5173\u5361\u5728iptables\u4e2d\u4e0d\u88ab\u79f0\u4e3a\u201d\u5173\u5361\u201d,\u800c\u88ab\u79f0\u4e3a\u201d\u94fe\u201d\u3002</p> <p></p> <p>\u5176\u5b9e\u6211\u4eec\u4e0a\u9762\u63cf\u8ff0\u7684\u573a\u666f\u5e76\u4e0d\u5b8c\u5584\uff0c\u56e0\u4e3a\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u62a5\u6587\u8bbf\u95ee\u7684\u76ee\u6807\u5730\u5740\u53ef\u80fd\u5e76\u4e0d\u662f\u672c\u673a\uff0c\u800c\u662f\u5176\u4ed6\u670d\u52a1\u5668\uff0c\u5f53\u672c\u673a\u7684\u5185\u6838\u652f\u6301IP_FORWARD\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u62a5\u6587\u8f6c\u53d1\u7ed9\u5176\u4ed6\u670d\u52a1\u5668\uff0c\u6240\u4ee5\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u4f1a\u63d0\u5230iptables\u4e2d\u7684\u5176\u4ed6\u201d\u5173\u5361\u201d\uff0c\u4e5f\u5c31\u662f\u5176\u4ed6\u201d\u94fe\u201d\uff0c\u4ed6\u4eec\u5c31\u662f \u00a0\u201c\u8def\u7531\u524d\u201d\u3001\u201d\u8f6c\u53d1\u201d\u3001\u201d\u8def\u7531\u540e\u201d\uff0c\u4ed6\u4eec\u7684\u82f1\u6587\u540d\u662f</p> <p>PREROUTING\u3001FORWARD\u3001POSTROUTING</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u6211\u4eec\u542f\u7528\u4e86\u9632\u706b\u5899\u529f\u80fd\u65f6\uff0c\u62a5\u6587\u9700\u8981\u7ecf\u8fc7\u5982\u4e0b\u5173\u5361\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u7684\u4e0d\u540c\uff0c\u62a5\u6587\u7ecf\u8fc7\u201d\u94fe\u201d\u53ef\u80fd\u4e0d\u540c\u3002\u5982\u679c\u62a5\u6587\u9700\u8981\u8f6c\u53d1\uff0c\u90a3\u4e48\u62a5\u6587\u5219\u4e0d\u4f1a\u7ecf\u8fc7input\u94fe\u53d1\u5f80\u7528\u6237\u7a7a\u95f4\uff0c\u800c\u662f\u76f4\u63a5\u5728\u5185\u6838\u7a7a\u95f4\u4e2d\u7ecf\u8fc7forward\u94fe\u548cpostrouting\u94fe\u8f6c\u53d1\u51fa\u53bb\u7684\u3002</p> <p></p> <p>\u6240\u4ee5\uff0c\u6839\u636e\u4e0a\u56fe\uff0c\u6211\u4eec\u80fd\u591f\u60f3\u8c61\u51fa\u67d0\u4e9b\u5e38\u7528\u573a\u666f\u4e2d\uff0c\u62a5\u6587\u7684\u6d41\u5411\uff1a</p> <p>\u5230\u672c\u673a\u67d0\u8fdb\u7a0b\u7684\u62a5\u6587\uff1aPREROUTING \u2013&gt; INPUT</p> <p>\u7531\u672c\u673a\u8f6c\u53d1\u7684\u62a5\u6587\uff1aPREROUTING \u2013&gt; FORWARD \u2013&gt; POSTROUTING</p> <p>\u7531\u672c\u673a\u7684\u67d0\u8fdb\u7a0b\u53d1\u51fa\u62a5\u6587\uff08\u901a\u5e38\u4e3a\u54cd\u5e94\u62a5\u6587\uff09\uff1aOUTPUT \u2013&gt; POSTROUTING</p>"},{"location":"iptables_1/#_2","title":"\u94fe\u7684\u6982\u5ff5","text":"<p>\u73b0\u5728\uff0c\u6211\u4eec\u60f3\u8c61\u4e00\u4e0b\uff0c\u8fd9\u4e9b\u201d\u5173\u5361\u201d\u5728iptables\u4e2d\u4e3a\u4ec0\u4e48\u88ab\u79f0\u4f5c\u201d\u94fe\u201d\u5462\uff1f\u6211\u4eec\u77e5\u9053\uff0c\u9632\u706b\u5899\u7684\u4f5c\u7528\u5c31\u5728\u4e8e\u5bf9\u7ecf\u8fc7\u7684\u62a5\u6587\u5339\u914d\u201d\u89c4\u5219\u201d\uff0c\u7136\u540e\u6267\u884c\u5bf9\u5e94\u7684\u201d\u52a8\u4f5c\u201d,\u6240\u4ee5\uff0c\u5f53\u62a5\u6587\u7ecf\u8fc7\u8fd9\u4e9b\u5173\u5361\u7684\u65f6\u5019\uff0c\u5219\u5fc5\u987b\u5339\u914d\u8fd9\u4e2a\u5173\u5361\u4e0a\u7684\u89c4\u5219\uff0c\u4f46\u662f\uff0c\u8fd9\u4e2a\u5173\u5361\u4e0a\u53ef\u80fd\u4e0d\u6b62\u6709\u4e00\u6761\u89c4\u5219\uff0c\u800c\u662f\u6709\u5f88\u591a\u6761\u89c4\u5219\uff0c\u5f53\u6211\u4eec\u628a\u8fd9\u4e9b\u89c4\u5219\u4e32\u5230\u4e00\u4e2a\u94fe\u6761\u4e0a\u7684\u65f6\u5019\uff0c\u5c31\u5f62\u6210\u4e86\u201d\u94fe\u201d,\u6240\u4ee5\uff0c\u6211\u4eec\u628a\u6bcf\u4e00\u4e2a\u201d\u5173\u5361\u201d\u60f3\u8c61\u6210\u5982\u4e0b\u56fe\u4e2d\u7684\u6a21\u6837 \u00a0\uff0c\u8fd9\u6837\u6765\u8bf4\uff0c\u628a\u4ed6\u4eec\u79f0\u4e3a\u201d\u94fe\u201d\u66f4\u4e3a\u5408\u9002\uff0c\u6bcf\u4e2a\u7ecf\u8fc7\u8fd9\u4e2a\u201d\u5173\u5361\u201d\u7684\u62a5\u6587\uff0c\u90fd\u8981\u5c06\u8fd9\u6761\u201d\u94fe\u201d\u4e0a\u7684\u6240\u6709\u89c4\u5219\u5339\u914d\u4e00\u904d\uff0c\u5982\u679c\u6709\u7b26\u5408\u6761\u4ef6\u7684\u89c4\u5219\uff0c\u5219\u6267\u884c\u89c4\u5219\u5bf9\u5e94\u7684\u52a8\u4f5c\u3002</p> <p></p>"},{"location":"iptables_1/#_3","title":"\u8868\u7684\u6982\u5ff5","text":"<p>\u6211\u4eec\u518d\u60f3\u60f3\u53e6\u5916\u4e00\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5bf9\u6bcf\u4e2a\u201d\u94fe\u201d\u4e0a\u90fd\u653e\u7f6e\u4e86\u4e00\u4e32\u89c4\u5219\uff0c\u4f46\u662f\u8fd9\u4e9b\u89c4\u5219\u6709\u4e9b\u5f88\u76f8\u4f3c\uff0c\u6bd4\u5982\uff0cA\u7c7b\u89c4\u5219\u90fd\u662f\u5bf9IP\u6216\u8005\u7aef\u53e3\u7684\u8fc7\u6ee4\uff0cB\u7c7b\u89c4\u5219\u662f\u4fee\u6539\u62a5\u6587\uff0c\u90a3\u4e48\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u662f\u4e0d\u662f\u80fd\u628a\u5b9e\u73b0\u76f8\u540c\u529f\u80fd\u7684\u89c4\u5219\u653e\u5728\u4e00\u8d77\u5462\uff0c\u5fc5\u987b\u80fd\u7684\u3002</p> <p>\u6211\u4eec\u628a\u5177\u6709\u76f8\u540c\u529f\u80fd\u7684\u89c4\u5219\u7684\u96c6\u5408\u53eb\u505a\u201d\u8868\u201d\uff0c\u6240\u4ee5\u8bf4\uff0c\u4e0d\u540c\u529f\u80fd\u7684\u89c4\u5219\uff0c\u6211\u4eec\u53ef\u4ee5\u653e\u7f6e\u5728\u4e0d\u540c\u7684\u8868\u4e2d\u8fdb\u884c\u7ba1\u7406\uff0c\u800ciptables\u5df2\u7ecf\u4e3a\u6211\u4eec\u5b9a\u4e49\u4e864\u79cd\u8868\uff0c\u6bcf\u79cd\u8868\u5bf9\u5e94\u4e86\u4e0d\u540c\u7684\u529f\u80fd\uff0c\u800c\u6211\u4eec\u5b9a\u4e49\u7684\u89c4\u5219\u4e5f\u90fd\u9003\u8131\u4e0d\u4e86\u8fd94\u79cd\u529f\u80fd\u7684\u8303\u56f4\uff0c\u6240\u4ee5\uff0c\u5b66\u4e60iptables\u4e4b\u524d\uff0c\u6211\u4eec\u5fc5\u987b\u5148\u641e\u660e\u767d\u6bcf\u79cd\u8868 \u7684\u4f5c\u7528\u3002</p> <p>iptables\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u5982\u4e0b\u89c4\u5219\u7684\u5206\u7c7b\uff0c\u6216\u8005\u8bf4\uff0ciptables\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u5982\u4e0b\u201d\u8868\u201d</p> <p>filter\u8868\uff1a\u8d1f\u8d23\u8fc7\u6ee4\u529f\u80fd\uff0c\u9632\u706b\u5899\uff1b\u5185\u6838\u6a21\u5757\uff1aiptables_filter</p> <p>nat\u8868\uff1anetwork address translation\uff0c\u7f51\u7edc\u5730\u5740\u8f6c\u6362\u529f\u80fd\uff1b\u5185\u6838\u6a21\u5757\uff1aiptable_nat</p> <p>mangle\u8868\uff1a\u62c6\u89e3\u62a5\u6587\uff0c\u505a\u51fa\u4fee\u6539\uff0c\u5e76\u91cd\u65b0\u5c01\u88c5 \u7684\u529f\u80fd\uff1biptable_mangle</p> <p>raw\u8868\uff1a\u5173\u95ednat\u8868\u4e0a\u542f\u7528\u7684\u8fde\u63a5\u8ffd\u8e2a\u673a\u5236\uff1biptable_raw</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u6240\u6709\u89c4\u5219\uff0c\u90fd\u662f\u8fd9\u56db\u79cd\u5206\u7c7b\u4e2d\u7684\u89c4\u5219\uff0c\u6216\u8005\u8bf4\uff0c\u6240\u6709\u89c4\u5219\u90fd\u5b58\u5728\u4e8e\u8fd94\u5f20\u201d\u8868\u201d\u4e2d\u3002</p>"},{"location":"iptables_1/#_4","title":"\u8868\u94fe\u5173\u7cfb","text":"<p>\u4f46\u662f\u6211\u4eec\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u67d0\u4e9b\u201d\u94fe\u201d\u4e2d\u6ce8\u5b9a\u4e0d\u4f1a\u5305\u542b\u201d\u67d0\u7c7b\u89c4\u5219\u201d\uff0c\u5c31\u50cf\u67d0\u4e9b\u201d\u5173\u5361\u201d\u5929\u751f\u5c31\u4e0d\u5177\u5907\u67d0\u4e9b\u529f\u80fd\u4e00\u6837\uff0c\u6bd4\u5982\uff0cA\u201d\u5173\u5361\u201d\u53ea\u8d1f\u8d23\u6253\u51fb\u9646\u5730\u654c\u4eba\uff0c\u6ca1\u6709\u9632\u7a7a\u80fd\u529b\uff0cB\u201d\u5173\u5361\u201d\u53ea\u8d1f\u8d23\u6253\u51fb\u7a7a\u4e2d\u654c\u4eba\uff0c\u6ca1\u6709\u9632\u5fa1\u6b65\u5175\u7684\u80fd\u529b\uff0cC\u201d\u5173\u5361\u201d\u53ef\u80fd\u6bd4\u8f83NB\uff0c\u65e2\u80fd\u9632\u7a7a\uff0c\u4e5f\u80fd\u9632\u5fa1\u9646\u5730\u654c\u4eba\uff0cD\u201d\u5173\u5361\u201d\u6700\u5c4c\uff0c\u6d77\u9646\u7a7a\u90fd\u80fd\u9632\u3002</p> <p>\u90a3\u8ba9\u6211\u4eec\u6765\u770b\u770b\uff0c\u6bcf\u4e2a\u201d\u5173\u5361\u201d\u90fd\u6709\u54ea\u4e9b\u80fd\u529b\uff0c\u6216\u8005\u8bf4\uff0c\u8ba9\u6211\u4eec\u770b\u770b\u6bcf\u4e2a\u201d\u94fe\u201d\u4e0a\u7684\u89c4\u5219\u90fd\u5b58\u5728\u4e8e\u54ea\u4e9b\u201d\u8868\u201d\u4e2d\u3002</p> <p>\u6211\u4eec\u8fd8\u662f\u4ee5\u56fe\u4e3a\u4f8b\uff0c\u5148\u770b\u770bprerouting\u201d\u94fe\u201d\u4e0a\u7684\u89c4\u5219\u90fd\u5b58\u5728\u4e8e\u54ea\u4e9b\u8868\u4e2d\u3002</p> <p>\u6ce8\u610f\uff1a\u4e0b\u56fe\u53ea\u7528\u4e8e\u8bf4\u660eprerouting\u94fe\u4e0a\u7684\u89c4\u5219\u5b58\u5728\u4e8e\u54ea\u4e9b\u8868\u4e2d\uff0c\u5e76\u6ca1\u6709\u63cf\u8ff0\u8868\u7684\u987a\u5e8f\u3002</p> <p></p> <p>\u8fd9\u5e45\u56fe\u662f\u4ec0\u4e48\u610f\u601d\u5462\uff1f\u5b83\u7684\u610f\u601d\u662f\u8bf4\uff0cprerouting\u201d\u94fe\u201d\u53ea\u62e5\u6709nat\u8868\u3001raw\u8868\u548cmangle\u8868\u6240\u5bf9\u5e94\u7684\u529f\u80fd\uff0c\u6240\u4ee5\uff0cprerouting\u4e2d\u7684\u89c4\u5219\u53ea\u80fd\u5b58\u653e\u4e8enat\u8868\u3001raw\u8868\u548cmangle\u8868\u4e2d\u3002</p> <p>\u90a3\u4e48\uff0c\u6839\u636e\u4e0a\u8ff0\u601d\u8def\uff0c\u6211\u4eec\u6765\u603b\u7ed3\u4e00\u4e0b\uff0c\u6bcf\u4e2a\u201d\u5173\u5361\u201d\u90fd\u62e5\u6709\u4ec0\u4e48\u529f\u80fd\uff0c</p> <p>\u6216\u8005\u8bf4\uff0c\u6bcf\u4e2a\u201d\u94fe\u201d\u4e2d\u7684\u89c4\u5219\u90fd\u5b58\u5728\u4e8e\u54ea\u4e9b\u201d\u8868\u201d\u4e2d\u3002</p> <p>PREROUTING \u00a0 \u00a0 \u00a0\u7684\u89c4\u5219\u53ef\u4ee5\u5b58\u5728\u4e8e\uff1araw\u8868\uff0cmangle\u8868\uff0cnat\u8868\u3002</p> <p>INPUT \u00a0 \u00a0 \u00a0 \u00a0 \u00a0\u7684\u89c4\u5219\u53ef\u4ee5\u5b58\u5728\u4e8e\uff1amangle\u8868\uff0cfilter\u8868\uff0c\uff08centos7\u4e2d\u8fd8\u6709nat\u8868\uff0ccentos6\u4e2d\u6ca1\u6709\uff09\u3002</p> <p>FORWARD \u00a0 \u00a0 \u00a0 \u00a0 \u7684\u89c4\u5219\u53ef\u4ee5\u5b58\u5728\u4e8e\uff1amangle\u8868\uff0cfilter\u8868\u3002</p> <p>OUTPUT \u00a0 \u00a0 \u00a0 \u00a0 \u7684\u89c4\u5219\u53ef\u4ee5\u5b58\u5728\u4e8e\uff1araw\u8868mangle\u8868\uff0cnat\u8868\uff0cfilter\u8868\u3002</p> <p>POSTROUTING \u00a0 \u00a0 \u00a0\u7684\u89c4\u5219\u53ef\u4ee5\u5b58\u5728\u4e8e\uff1amangle\u8868\uff0cnat\u8868\u3002</p> <p>\u4f46\u662f\uff0c\u6211\u4eec\u5728\u5b9e\u9645\u7684\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u5f80\u5f80\u662f\u901a\u8fc7\u201d\u8868\u201d\u4f5c\u4e3a\u64cd\u4f5c\u5165\u53e3\uff0c\u5bf9\u89c4\u5219\u8fdb\u884c\u5b9a\u4e49\u7684\uff0c\u4e4b\u6240\u4ee5\u6309\u7167\u4e0a\u8ff0\u8fc7\u7a0b\u4ecb\u7ecdiptables\uff0c\u662f\u56e0\u4e3a\u4ece\u201d\u5173\u5361\u201d\u7684\u89d2\u5ea6\u66f4\u5bb9\u6613\u4ece\u5165\u95e8\u7684\u89d2\u5ea6\u7406\u89e3\uff0c\u4f46\u662f\u4e3a\u4e86\u4ee5\u4fbf\u5728\u5b9e\u9645\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u66f4\u52a0\u987a\u7545\u7684\u7406\u89e3\u5b83\u4eec\uff0c\u6b64\u5904\u6211\u4eec\u8fd8\u8981\u5c06\u5404\u201d\u8868\u201d\u4e0e\u201d\u94fe\u201d\u7684\u5173\u7cfb\u7f57\u5217\u51fa\u6765\uff0c</p> <p>\u8868\uff08\u529f\u80fd\uff09&lt;\u2013&gt; \u00a0 \u94fe\uff08\u94a9\u5b50\uff09\uff1a</p> <p>raw \u00a0 \u00a0 \u8868\u4e2d\u7684\u89c4\u5219\u53ef\u4ee5\u88ab\u54ea\u4e9b\u94fe\u4f7f\u7528\uff1aPREROUTING\uff0cOUTPUT</p> <p>mangle \u00a0\u8868\u4e2d\u7684\u89c4\u5219\u53ef\u4ee5\u88ab\u54ea\u4e9b\u94fe\u4f7f\u7528\uff1aPREROUTING\uff0cINPUT\uff0cFORWARD\uff0cOUTPUT\uff0cPOSTROUTING</p> <p>nat \u00a0 \u00a0 \u8868\u4e2d\u7684\u89c4\u5219\u53ef\u4ee5\u88ab\u54ea\u4e9b\u94fe\u4f7f\u7528\uff1aPREROUTING\uff0cOUTPUT\uff0cPOSTROUTING\uff08centos7\u4e2d\u8fd8\u6709INPUT\uff0ccentos6\u4e2d\u6ca1\u6709\uff09</p> <p>filter \u00a0\u8868\u4e2d\u7684\u89c4\u5219\u53ef\u4ee5\u88ab\u54ea\u4e9b\u94fe\u4f7f\u7528\uff1aINPUT\uff0cFORWARD\uff0cOUTPUT</p> <p>\u5176\u5b9e\u6211\u4eec\u8fd8\u9700\u8981\u6ce8\u610f\u4e00\u70b9\uff0c\u56e0\u4e3a\u6570\u636e\u5305\u7ecf\u8fc7\u4e00\u4e2a\u201d\u94fe\u201d\u7684\u65f6\u5019\uff0c\u4f1a\u5c06\u5f53\u524d\u94fe\u7684\u6240\u6709\u89c4\u5219\u90fd\u5339\u914d\u4e00\u904d\uff0c\u4f46\u662f\u5339\u914d\u65f6\u603b\u5f52\u8981\u6709\u987a\u5e8f\uff0c\u6211\u4eec\u5e94\u8be5\u4e00\u6761\u4e00\u6761\u7684\u53bb\u5339\u914d\uff0c\u800c\u4e14\u6211\u4eec\u8bf4\u8fc7\uff0c\u76f8\u540c\u529f\u80fd\u7c7b\u578b\u7684\u89c4\u5219\u4f1a\u6c47\u805a\u5728\u4e00\u5f20\u201d\u8868\u201d\u4e2d\uff0c\u90a3\u4e48\uff0c\u54ea\u4e9b\u201d\u8868\u201d\u4e2d\u7684\u89c4\u5219\u4f1a\u653e\u5728\u201d\u94fe\u201d\u7684\u6700\u524d\u9762\u6267\u884c\u5462\uff0c\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u6709\u4e00\u4e2a\u4f18\u5148\u7ea7\u7684\u95ee\u9898\uff0c\u6211\u4eec\u8fd8\u62ffprerouting\u201d\u94fe\u201d\u505a\u56fe\u793a\u3002</p> <p></p> <p>prerouting\u94fe\u4e2d\u7684\u89c4\u5219\u5b58\u653e\u4e8e\u4e09\u5f20\u8868\u4e2d\uff0c\u800c\u8fd9\u4e09\u5f20\u8868\u4e2d\u7684\u89c4\u5219\u6267\u884c\u7684\u4f18\u5148\u7ea7\u5982\u4e0b\uff1a</p> <p>raw \u2013&gt; mangle \u2013&gt; nat</p> <p>\u4f46\u662f\u6211\u4eec\u77e5\u9053\uff0ciptables\u4e3a\u6211\u4eec\u5b9a\u4e49\u4e864\u5f20\u201d\u8868\u201d,\u5f53\u4ed6\u4eec\u5904\u4e8e\u540c\u4e00\u6761\u201d\u94fe\u201d\u65f6\uff0c\u6267\u884c\u7684\u4f18\u5148\u7ea7\u5982\u4e0b\u3002</p> <p>\u4f18\u5148\u7ea7\u6b21\u5e8f\uff08\u7531\u9ad8\u800c\u4f4e\uff09\uff1a</p> <p>raw \u2013&gt; mangle \u2013&gt; nat \u2013&gt; filter</p> <p>\u4f46\u662f\u6211\u4eec\u524d\u9762\u8bf4\u8fc7\uff0c\u67d0\u4e9b\u94fe\u5929\u751f\u5c31\u4e0d\u80fd\u4f7f\u7528\u67d0\u4e9b\u8868\u4e2d\u7684\u89c4\u5219\uff0c\u6240\u4ee5\uff0c4\u5f20\u8868\u4e2d\u7684\u89c4\u5219\u5904\u4e8e\u540c\u4e00\u6761\u94fe\u7684\u76ee\u524d\u53ea\u6709output\u94fe\uff0c\u5b83\u5c31\u662f\u4f20\u8bf4\u4e2d\u6d77\u9646\u7a7a\u90fd\u80fd\u9632\u5b88\u7684\u5173\u5361\u3002</p> <p>\u4e3a\u4e86\u66f4\u65b9\u4fbf\u7684\u7ba1\u7406\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u5728\u67d0\u4e2a\u8868\u91cc\u9762\u521b\u5efa\u81ea\u5b9a\u4e49\u94fe\uff0c\u5c06\u9488\u5bf9\u67d0\u4e2a\u5e94\u7528\u7a0b\u5e8f\u6240\u8bbe\u7f6e\u7684\u89c4\u5219\u653e\u7f6e\u5728\u8fd9\u4e2a\u81ea\u5b9a\u4e49\u94fe\u4e2d\uff0c\u4f46\u662f\u81ea\u5b9a\u4e49\u94fe\u63a5\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528\uff0c\u53ea\u80fd\u88ab\u67d0\u4e2a\u9ed8\u8ba4\u7684\u94fe\u5f53\u505a\u52a8\u4f5c\u53bb\u8c03\u7528\u624d\u80fd\u8d77\u4f5c\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u60f3\u8c61\uff0c\u81ea\u5b9a\u4e49\u94fe\u5c31\u662f\u4e00\u6bb5\u6bd4\u8f83\u201d\u77ed\u201d\u7684\u94fe\u5b50\uff0c\u8fd9\u6761\u201d\u77ed\u201d\u94fe\u5b50\u4e0a\u7684\u89c4\u5219\u90fd\u662f\u9488\u5bf9\u67d0\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5236\u5b9a\u7684\uff0c\u4f46\u662f\u8fd9\u6761\u77ed\u7684\u94fe\u5b50\u5e76\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528\uff0c\u800c\u662f\u9700\u8981\u201d\u710a\u63a5\u201d\u5728iptables\u9ed8\u8ba4\u5b9a\u4e49\u94fe\u5b50\u4e0a\uff0c\u624d\u80fd\u88abIPtables\u4f7f\u7528\uff0c\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u9ed8\u8ba4\u5b9a\u4e49\u7684\u201d\u94fe\u201d\u9700\u8981\u628a\u201d\u81ea\u5b9a\u4e49\u94fe\u201d\u5f53\u505a\u201d\u52a8\u4f5c\u201d\u53bb\u5f15\u7528\u7684\u539f\u56e0\u3002\u8fd9\u662f\u540e\u8bdd\uff0c\u540e\u9762\u518d\u804a\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\u6211\u4eec\u5373\u53ef\u66f4\u52a0\u7684\u660e\u767d\u3002</p>"},{"location":"iptables_1/#_5","title":"\u6570\u636e\u7ecf\u8fc7\u9632\u706b\u5899\u7684\u6d41\u7a0b","text":"<p>\u7ed3\u5408\u4e0a\u8ff0\u6240\u6709\u7684\u63cf\u8ff0\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6570\u636e\u5305\u901a\u8fc7\u9632\u706b\u5899\u7684\u6d41\u7a0b\u603b\u7ed3\u4e3a\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6211\u4eec\u5728\u5199Iptables\u89c4\u5219\u7684\u65f6\u5019\uff0c\u8981\u65f6\u523b\u7262\u8bb0\u8fd9\u5f20\u8def\u7531\u6b21\u5e8f\u56fe\uff0c\u7075\u6d3b\u914d\u7f6e\u89c4\u5219\u3002</p> <p>\u6211\u4eec\u5c06\u7ecf\u5e38\u7528\u5230\u7684\u5bf9\u5e94\u5173\u7cfb\u91cd\u65b0\u5199\u5728\u6b64\u5904\uff0c\u65b9\u4fbf\u5bf9\u5e94\u56fe\u4f8b\u67e5\u770b\u3002</p> <p>\u94fe\u7684\u89c4\u5219\u5b58\u653e\u4e8e\u54ea\u4e9b\u8868\u4e2d\uff08\u4ece\u94fe\u5230\u8868\u7684\u5bf9\u5e94\u5173\u7cfb\uff09\uff1a</p> <p>PREROUTING \u00a0 \u7684\u89c4\u5219\u53ef\u4ee5\u5b58\u5728\u4e8e\uff1araw\u8868\uff0cmangle\u8868\uff0cnat\u8868\u3002</p> <p>INPUT \u00a0 \u00a0 \u00a0 \u00a0\u7684\u89c4\u5219\u53ef\u4ee5\u5b58\u5728\u4e8e\uff1amangle\u8868\uff0cfilter\u8868\uff0c\uff08centos7\u4e2d\u8fd8\u6709nat\u8868\uff0ccentos6\u4e2d\u6ca1\u6709\uff09\u3002</p> <p>FORWARD \u00a0 \u00a0 \u00a0\u7684\u89c4\u5219\u53ef\u4ee5\u5b58\u5728\u4e8e\uff1amangle\u8868\uff0cfilter\u8868\u3002</p> <p>OUTPUT \u00a0 \u00a0 \u00a0 \u7684\u89c4\u5219\u53ef\u4ee5\u5b58\u5728\u4e8e\uff1araw\u8868mangle\u8868\uff0cnat\u8868\uff0cfilter\u8868\u3002</p> <p>POSTROUTING \u00a0\u7684\u89c4\u5219\u53ef\u4ee5\u5b58\u5728\u4e8e\uff1amangle\u8868\uff0cnat\u8868\u3002</p> <p>\u8868\u4e2d\u7684\u89c4\u5219\u53ef\u4ee5\u88ab\u54ea\u4e9b\u94fe\u4f7f\u7528\uff08\u4ece\u8868\u5230\u94fe\u7684\u5bf9\u5e94\u5173\u7cfb\uff09\uff1a</p> <p>raw \u00a0 \u00a0 \u8868\u4e2d\u7684\u89c4\u5219\u53ef\u4ee5\u88ab\u54ea\u4e9b\u94fe\u4f7f\u7528\uff1aPREROUTING\uff0cOUTPUT</p> <p>mangle \u00a0\u8868\u4e2d\u7684\u89c4\u5219\u53ef\u4ee5\u88ab\u54ea\u4e9b\u94fe\u4f7f\u7528\uff1aPREROUTING\uff0cINPUT\uff0cFORWARD\uff0cOUTPUT\uff0cPOSTROUTING</p> <p>nat \u00a0 \u00a0 \u8868\u4e2d\u7684\u89c4\u5219\u53ef\u4ee5\u88ab\u54ea\u4e9b\u94fe\u4f7f\u7528\uff1aPREROUTING\uff0cOUTPUT\uff0cPOSTROUTING\uff08centos7\u4e2d\u8fd8\u6709INPUT\uff0ccentos6\u4e2d\u6ca1\u6709\uff09</p> <p>filter \u00a0\u8868\u4e2d\u7684\u89c4\u5219\u53ef\u4ee5\u88ab\u54ea\u4e9b\u94fe\u4f7f\u7528\uff1aINPUT\uff0cFORWARD\uff0cOUTPUT</p> <p>\u4e0b\u56fe\u4e2dnat\u8868\u5728centos7\u4e2d\u7684\u60c5\u51b5\u5c31\u4e0d\u518d\u6807\u660e\u3002</p> <p></p>"},{"location":"iptables_1/#_6","title":"\u89c4\u5219\u7684\u6982\u5ff5","text":"<p>\u8bf4\u4e86\u4e00\u5708\u53c8\u8bf4\u56de\u6765\u4e86\uff0c\u5728\u4e0a\u8ff0\u63cf\u8ff0\u4e2d\u6211\u4eec\u4e00\u76f4\u5728\u63d0\u89c4\u5219\uff0c\u53ef\u662f\u6ca1\u6709\u7ec6\u8bf4\uff0c\u73b0\u5728\u8bf4\u8bf4\u5b83\u3002</p> <p>\u5148\u8bf4\u8bf4\u89c4\u5219\u7684\u6982\u5ff5\uff0c\u7136\u540e\u518d\u901a\u4fd7\u7684\u89e3\u91ca\u5b83\u3002</p> <p>\u89c4\u5219\uff1a\u6839\u636e\u6307\u5b9a\u7684\u5339\u914d\u6761\u4ef6\u6765\u5c1d\u8bd5\u5339\u914d\u6bcf\u4e2a\u6d41\u7ecf\u6b64\u5904\u7684\u62a5\u6587\uff0c\u4e00\u65e6\u5339\u914d\u6210\u529f\uff0c\u5219\u7531\u89c4\u5219\u540e\u9762\u6307\u5b9a\u7684\u5904\u7406\u52a8\u4f5c\u8fdb\u884c\u5904\u7406\uff1b</p> <p>\u90a3\u4e48\u6211\u4eec\u6765\u901a\u4fd7\u7684\u89e3\u91ca\u4e00\u4e0b\u4ec0\u4e48\u662fiptables\u7684\u89c4\u5219\uff0c\u4e4b\u524d\u6253\u8fc7\u4e00\u4e2a\u6bd4\u65b9\uff0c\u6bcf\u6761\u201d\u94fe\u201d\u90fd\u662f\u4e00\u4e2a\u201d\u5173\u5361\u201d\uff0c\u6bcf\u4e2a\u901a\u8fc7\u8fd9\u4e2a\u201d\u5173\u5361\u201d\u7684\u62a5\u6587\u90fd\u8981\u5339\u914d\u8fd9\u4e2a\u5173\u5361\u4e0a\u7684\u89c4\u5219\uff0c\u5982\u679c\u5339\u914d\uff0c\u5219\u5bf9\u62a5\u6587\u8fdb\u884c\u5bf9\u5e94\u7684\u5904\u7406\uff0c\u6bd4\u5982\u8bf4\uff0c\u4f60\u6211\u4e8c\u4eba\u6b64\u523b\u5c31\u597d\u50cf\u4e24\u4e2a\u201d\u62a5\u6587\u201d\uff0c\u4f60\u6211\u4e8c\u4eba\u6b64\u523b\u90fd\u8981\u5165\u5173\uff0c\u53ef\u662f\u57ce\u4e3b\u6709\u547d\uff0c\u53ea\u6709\u5668\u5b87\u8f69\u6602\u7684\u4eba\u624d\u80fd\u5165\u5173\uff0c\u4e0d\u7b26\u5408\u6b64\u6761\u4ef6\u7684\u4eba\u4e0d\u80fd\u5165\u5173\uff0c\u4e8e\u662f\u5b88\u5173\u5c06\u58eb\u6309\u7167\u57ce\u4e3b\u5236\u5b9a\u7684\u201d\u89c4\u5219\u201d\uff0c\u5f00\u59cb\u6253\u91cf\u4f60\u6211\u4e8c\u4eba\uff0c\u6700\u7ec8\uff0c\u4f60\u987a\u5229\u5165\u5173\u4e86\uff0c\u800c\u6211\u5df2\u88ab\u62d2\u4e4b\u95e8\u5916\uff0c\u56e0\u4e3a\u4f60\u7b26\u5408\u201d\u5668\u5b87\u8f69\u6602\u201d\u7684\u6807\u51c6\uff0c\u6240\u4ee5\u628a\u4f60\u201d\u653e\u884c\u201d\u4e86\uff0c\u800c\u6211\u4e0d\u7b26\u5408\u6807\u51c6\uff0c\u6240\u4ee5\u6ca1\u6709\u88ab\u653e\u884c\uff0c\u5176\u5b9e\uff0c\u201d\u5668\u5b87\u8f69\u6602\u201d\u5c31\u662f\u4e00\u79cd\u201d\u5339\u914d\u6761\u4ef6\u201d\uff0c\u201d\u653e\u884c\u201d\u5c31\u662f\u4e00\u79cd\u201d\u52a8\u4f5c\u201d\uff0c\u201d\u5339\u914d\u6761\u4ef6\u201d\u4e0e\u201d\u52a8\u4f5c\u201d\u7ec4\u6210\u4e86\u89c4\u5219\u3002</p> <p>\u4e86\u89e3\u4e86\u89c4\u5219\u7684\u6982\u5ff5\uff0c\u90a3\u6211\u4eec\u6765\u804a\u804a\u89c4\u5219\u7684\u7ec4\u6210\u90e8\u5206,\u6b64\u5904\u53ea\u662f\u5927\u6982\u7684\u5c06\u89c4\u5219\u7684\u7ed3\u6784\u5217\u51fa\uff0c\u540e\u9762\u7684\u6587\u7ae0\u4e2d\u4f1a\u5355\u72ec\u5bf9\u89c4\u5219\u8fdb\u884c\u603b\u7ed3\u3002</p> <p>\u89c4\u5219\u7531\u5339\u914d\u6761\u4ef6\u548c\u5904\u7406\u52a8\u4f5c\u7ec4\u6210\u3002</p>"},{"location":"iptables_1/#_7","title":"\u5339\u914d\u6761\u4ef6","text":"<p>\u5339\u914d\u6761\u4ef6\u5206\u4e3a\u57fa\u672c\u5339\u914d\u6761\u4ef6\u4e0e\u6269\u5c55\u5339\u914d\u6761\u4ef6</p> <p>\u57fa\u672c\u5339\u914d\u6761\u4ef6\uff1a</p> <p>\u6e90\u5730\u5740Source IP\uff0c\u76ee\u6807\u5730\u5740 Destination IP</p> <p>\u4e0a\u8ff0\u5185\u5bb9\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u57fa\u672c\u5339\u914d\u6761\u4ef6\u3002</p> <p>\u6269\u5c55\u5339\u914d\u6761\u4ef6\uff1a</p> <p>\u9664\u4e86\u4e0a\u8ff0\u7684\u6761\u4ef6\u53ef\u4ee5\u7528\u4e8e\u5339\u914d\uff0c\u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u7684\u6761\u4ef6\u53ef\u4ee5\u7528\u4e8e\u5339\u914d\uff0c\u8fd9\u4e9b\u6761\u4ef6\u6cdb\u79f0\u4e3a\u6269\u5c55\u6761\u4ef6\uff0c\u8fd9\u4e9b\u6269\u5c55\u6761\u4ef6\u5176\u5b9e\u4e5f\u662fnetfilter\u4e2d\u7684\u4e00\u90e8\u5206\uff0c\u53ea\u662f\u4ee5\u6a21\u5757\u7684\u5f62\u5f0f\u5b58\u5728\uff0c\u5982\u679c\u60f3\u8981\u4f7f\u7528\u8fd9\u4e9b\u6761\u4ef6\uff0c\u5219\u9700\u8981\u4f9d\u8d56\u5bf9\u5e94\u7684\u6269\u5c55\u6a21\u5757\u3002</p> <p>\u6e90\u7aef\u53e3Source Port, \u76ee\u6807\u7aef\u53e3Destination Port</p> <p>\u4e0a\u8ff0\u5185\u5bb9\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u6269\u5c55\u5339\u914d\u6761\u4ef6</p>"},{"location":"iptables_1/#_8","title":"\u5904\u7406\u52a8\u4f5c","text":"<p>\u5904\u7406\u52a8\u4f5c\u5728iptables\u4e2d\u88ab\u79f0\u4e3atarget\uff08\u8fd9\u6837\u8bf4\u5e76\u4e0d\u51c6\u786e\uff0c\u6211\u4eec\u6682\u4e14\u8fd9\u6837\u79f0\u547c\uff09\uff0c\u52a8\u4f5c\u4e5f\u53ef\u4ee5\u5206\u4e3a\u57fa\u672c\u52a8\u4f5c\u548c\u6269\u5c55\u52a8\u4f5c\u3002</p> <p>\u6b64\u5904\u5217\u51fa\u4e00\u4e9b\u5e38\u7528\u7684\u52a8\u4f5c\uff0c\u4e4b\u540e\u7684\u6587\u7ae0\u4f1a\u5bf9\u5b83\u4eec\u8fdb\u884c\u8be6\u7ec6\u7684\u793a\u4f8b\u4e0e\u603b\u7ed3\uff1a</p> <p>ACCEPT\uff1a\u5141\u8bb8\u6570\u636e\u5305\u901a\u8fc7\u3002</p> <p>DROP\uff1a\u76f4\u63a5\u4e22\u5f03\u6570\u636e\u5305\uff0c\u4e0d\u7ed9\u4efb\u4f55\u56de\u5e94\u4fe1\u606f\uff0c\u8fd9\u65f6\u5019\u5ba2\u6237\u7aef\u4f1a\u611f\u89c9\u81ea\u5df1\u7684\u8bf7\u6c42\u6ce5\u725b\u5165\u6d77\u4e86\uff0c\u8fc7\u4e86\u8d85\u65f6\u65f6\u95f4\u624d\u4f1a\u6709\u53cd\u5e94\u3002</p> <p>REJECT\uff1a\u62d2\u7edd\u6570\u636e\u5305\u901a\u8fc7\uff0c\u5fc5\u8981\u65f6\u4f1a\u7ed9\u6570\u636e\u53d1\u9001\u7aef\u4e00\u4e2a\u54cd\u5e94\u7684\u4fe1\u606f\uff0c\u5ba2\u6237\u7aef\u521a\u8bf7\u6c42\u5c31\u4f1a\u6536\u5230\u62d2\u7edd\u7684\u4fe1\u606f\u3002</p> <p>SNAT\uff1a\u6e90\u5730\u5740\u8f6c\u6362\uff0c\u89e3\u51b3\u5185\u7f51\u7528\u6237\u7528\u540c\u4e00\u4e2a\u516c\u7f51\u5730\u5740\u4e0a\u7f51\u7684\u95ee\u9898\u3002</p> <p>MASQUERADE\uff1a\u662fSNAT\u7684\u4e00\u79cd\u7279\u6b8a\u5f62\u5f0f\uff0c\u9002\u7528\u4e8e\u52a8\u6001\u7684\u3001\u4e34\u65f6\u4f1a\u53d8\u7684ip\u4e0a\u3002</p> <p>DNAT\uff1a\u76ee\u6807\u5730\u5740\u8f6c\u6362\u3002</p> <p>REDIRECT\uff1a\u5728\u672c\u673a\u505a\u7aef\u53e3\u6620\u5c04\u3002</p> <p>LOG\uff1a\u5728/var/log/messages\u6587\u4ef6\u4e2d\u8bb0\u5f55\u65e5\u5fd7\u4fe1\u606f\uff0c\u7136\u540e\u5c06\u6570\u636e\u5305\u4f20\u9012\u7ed9\u4e0b\u4e00\u6761\u89c4\u5219\uff0c\u4e5f\u5c31\u662f\u8bf4\u9664\u4e86\u8bb0\u5f55\u4ee5\u5916\u4e0d\u5bf9\u6570\u636e\u5305\u505a\u4efb\u4f55\u5176\u4ed6\u64cd\u4f5c\uff0c\u4ecd\u7136\u8ba9\u4e0b\u4e00\u6761\u89c4\u5219\u53bb\u5339\u914d\u3002</p>"},{"location":"iptables_1/#_9","title":"\u5c0f\u7ed3","text":"<p>iptables\u7684\u5b9e\u9645\u64cd\u4f5c\u6211\u4eec\u4f1a\u53e6\u5916\u603b\u7ed3\u4e3a\u5176\u4ed6\u6587\u7ae0\uff0ciptables\u7cfb\u5217\u6587\u7ae0\u5217\u8868\u76f4\u8fbe\u94fe\u63a5\u5982\u4e0b\uff1a</p> <p>iptables\u96f6\u57fa\u7840\u5feb\u901f\u5165\u95e8\u7cfb\u5217</p> <p>\u597d\u4e86\uff0ciptables\u7684\u6982\u5ff5\u6682\u65f6\u603b\u7ed3\u5230\u8fd9\u91cc\uff0c\u61c2\u5f97\u6982\u5ff5\u4e4b\u540e\uff0c\u518d\u7ed3\u5408\u5b9e\u9645\u7684\u547d\u4ee4\u53bb\u7ec3\u4e60\uff0c\u641e\u5b9aiptables\u7edd\u5bf9\u59a5\u59a5\u7684\u3002</p> <p>\u6700\u540e\u8bf4\u4e00\u53e5\uff0c\u5ba2\u5b98\u60a8\u7684\u8bc4\u8bba\u3001\u6536\u85cf\u3001\u63a8\u8350\u662f\u6211\u5199\u535a\u5ba2\u7684\u6700\u5927\u52a8\u529b\uff0c\u5e0c\u671b\u4eb2\u4ee5\u540e\u591a\u6367\u573a\u54e6\uff0c\u4e48\u4e48\u54d2~~~~</p>"},{"location":"iptables_10/","title":"iptables\u8be6\u89e3\uff0810\uff09\uff1aiptables\u81ea\u5b9a\u4e49\u94fe","text":"<p>\u5728\u672c\u535a\u5ba2\u4e2d\uff0c\u4ece\u7406\u8bba\u5230\u5b9e\u8df5\uff0c\u7cfb\u7edf\u7684\u4ecb\u7ecd\u4e86iptables\uff0c\u5982\u679c\u4f60\u60f3\u8981\u4ece\u5934\u5f00\u59cb\u4e86\u89e3iptables\uff0c\u53ef\u4ee5\u67e5\u770biptables\u6587\u7ae0\u5217\u8868\uff0c\u76f4\u8fbe\u94fe\u63a5\u5982\u4e0b</p> <p>iptables\u96f6\u57fa\u7840\u5feb\u901f\u5165\u95e8\u7cfb\u5217</p> <p>\u524d\u6587\u4e2d\uff0c\u6211\u4eec\u4e00\u76f4\u5728\u5b9a\u4e49\u89c4\u5219\uff0c\u51c6\u786e\u7684\u8bf4\uff0c\u6211\u4eec\u4e00\u76f4\u5728iptables\u7684\u9ed8\u8ba4\u94fe\u4e2d\u5b9a\u4e49\u89c4\u5219\uff0c\u90a3\u4e48\u6b64\u5904\uff0c\u6211\u4eec\u5c31\u6765\u4e86\u89e3\u4e00\u4e0b\u81ea\u5b9a\u4e49\u94fe\u3002</p> <p>\u4f60\u53ef\u80fd\u4f1a\u95ee\uff0ciptables\u7684\u9ed8\u8ba4\u94fe\u5c31\u5df2\u7ecf\u80fd\u591f\u6ee1\u8db3\u6211\u4eec\u4e86\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981\u81ea\u5b9a\u4e49\u94fe\u5462\uff1f</p> <p>\u539f\u56e0\u5982\u4e0b\uff1a</p> <p>\u5f53\u9ed8\u8ba4\u94fe\u4e2d\u7684\u89c4\u5219\u975e\u5e38\u591a\u65f6\uff0c\u4e0d\u65b9\u4fbf\u6211\u4eec\u7ba1\u7406\u3002</p> <p>\u60f3\u8c61\u4e00\u4e0b\uff0c\u5982\u679cINPUT\u94fe\u4e2d\u5b58\u653e\u4e86200\u6761\u89c4\u5219\uff0c\u8fd9200\u6761\u89c4\u5219\u6709\u9488\u5bf9httpd\u670d\u52a1\u7684\uff0c\u6709\u9488\u5bf9sshd\u670d\u52a1\u7684\uff0c\u6709\u9488\u5bf9\u79c1\u7f51IP\u7684\uff0c\u6709\u9488\u5bf9\u516c\u7f51IP\u7684\uff0c\u5047\u5982\uff0c\u6211\u4eec\u7a81\u7136\u60f3\u8981\u4fee\u6539\u9488\u5bf9httpd\u670d\u52a1\u7684\u76f8\u5173\u89c4\u5219\uff0c\u96be\u9053\u6211\u4eec\u8fd8\u8981\u4ece\u5934\u770b\u4e00\u904d\u8fd9200\u6761\u89c4\u5219\uff0c\u627e\u51fa\u54ea\u4e9b\u89c4\u5219\u662f\u9488\u5bf9httpd\u7684\u5417\uff1f\u8fd9\u663e\u7136\u4e0d\u5408\u7406\u3002</p> <p>\u6240\u4ee5\uff0ciptables\u4e2d\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u94fe\uff0c\u901a\u8fc7\u81ea\u5b9a\u4e49\u94fe\u5373\u53ef\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\u3002</p> <p>\u5047\u8bbe\uff0c\u6211\u4eec\u81ea\u5b9a\u4e49\u4e00\u6761\u94fe\uff0c\u94fe\u540d\u53ebIN_WEB\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6240\u6709\u9488\u5bf980\u7aef\u53e3\u7684\u5165\u7ad9\u89c4\u5219\u90fd\u5199\u5165\u5230\u8fd9\u6761\u81ea\u5b9a\u4e49\u94fe\u4e2d\uff0c\u5f53\u4ee5\u540e\u60f3\u8981\u4fee\u6539\u9488\u5bf9web\u670d\u52a1\u7684\u5165\u7ad9\u89c4\u5219\u65f6\uff0c\u5c31\u76f4\u63a5\u4fee\u6539IN_WEB\u94fe\u4e2d\u7684\u89c4\u5219\u5c31\u597d\u4e86\uff0c\u5373\u4f7f\u9ed8\u8ba4\u94fe\u4e2d\u6709\u518d\u591a\u7684\u89c4\u5219\uff0c\u6211\u4eec\u4e5f\u4e0d\u4f1a\u5bb3\u6015\u4e86\uff0c\u56e0\u4e3a\u6211\u4eec\u77e5\u9053\uff0c\u6240\u6709\u9488\u5bf980\u7aef\u53e3\u7684\u5165\u7ad9\u89c4\u5219\u90fd\u5b58\u653e\u5728IN_WEB\u94fe\u4e2d\uff0c\u540c\u7406\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u9488\u5bf9sshd\u7684\u51fa\u7ad9\u89c4\u5219\u653e\u5165\u5230OUT_SSH\u81ea\u5b9a\u4e49\u94fe\u4e2d\uff0c\u5c06\u9488\u5bf9Nginx\u7684\u5165\u7ad9\u89c4\u5219\u653e\u5165\u5230IN_NGINX\u81ea\u5b9a\u4e49\u94fe\u4e2d\uff0c\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u80fd\u60f3\u6539\u54ea\u91cc\u6539\u54ea\u91cc\uff0c\u518d\u4e5f\u4e0d\u540c\u62c5\u5fc3\u627e\u4e0d\u5230\u89c4\u5219\u5728\u54ea\u91cc\u4e86\u3002</p> <p>\u4f46\u662f\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u81ea\u5b9a\u4e49\u94fe\u5e76\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528\uff0c\u800c\u662f\u9700\u8981\u88ab\u9ed8\u8ba4\u94fe\u5f15\u7528\u624d\u80fd\u591f\u4f7f\u7528\uff0c\u7a7a\u53e3\u767d\u8bdd\u8bf4\u4e0d\u660e\u767d\uff0c\u7b49\u5230\u793a\u4f8b\u65f6\u6211\u4eec\u81ea\u7136\u4f1a\u660e\u767d\u3002</p> <p>\u8bf4\u4e86\u8fd9\u4e48\u591a\uff0c\u6211\u4eec\u6765\u52a8\u624b\u521b\u5efa\u4e00\u6761\u81ea\u5b9a\u4e49\u94fe\uff0c\u4f7f\u7528-N\u9009\u9879\u53ef\u4ee5\u521b\u5efa\u81ea\u5b9a\u4e49\u94fe\uff0c\u793a\u4f8b\u5982\u4e0b</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u201d-t filter\u201d\u8868\u793a\u64cd\u4f5c\u7684\u8868\u4e3afilter\u8868\uff0c\u4e0e\u4e4b\u524d\u7684\u793a\u4f8b\u76f8\u540c\uff0c\u7701\u7565-t\u9009\u9879\u65f6\uff0c\u7f3a\u7701\u64cd\u4f5c\u7684\u5c31\u662ffilter\u8868\u3002</p> <p>\u201c-N IN_WEB\u201d\u8868\u793a\u521b\u5efa\u4e00\u4e2a\u81ea\u5b9a\u4e49\u94fe\uff0c\u81ea\u5b9a\u4e49\u94fe\u7684\u540d\u79f0\u4e3a\u201dIN_WEB\u201d</p> <p>\u81ea\u5b9a\u4e49\u94fe\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u67e5\u770bfilter\u8868\u4e2d\u7684\u94fe\uff0c\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u81ea\u5b9a\u4e49\u94fe\u5df2\u7ecf\u88ab\u521b\u5efa\uff0c\u800c\u4e14\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u6761\u81ea\u5b9a\u4e49\u94fe\u7684\u5f15\u7528\u8ba1\u6570\u4e3a0 (0 references)\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u6761\u81ea\u5b9a\u4e49\u94fe\u8fd8\u6ca1\u6709\u88ab\u4efb\u4f55\u9ed8\u8ba4\u94fe\u6240\u5f15\u7528\uff0c\u6240\u4ee5\uff0c\u5373\u4f7fIN_WEB\u4e2d\u914d\u7f6e\u4e86\u89c4\u5219\uff0c\u4e5f\u4e0d\u4f1a\u751f\u6548\uff0c\u6211\u4eec\u73b0\u5728\u4e0d\u7528\u5728\u610f\u5b83\uff0c\u7ee7\u7eed\u804a\u6211\u4eec\u7684\u81ea\u5b9a\u4e49\u94fe\u3002</p> <p>\u597d\u4e86\uff0c\u81ea\u5b9a\u4e49\u94fe\u5df2\u7ecf\u521b\u5efa\u5b8c\u6bd5\uff0c\u73b0\u5728\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u5728\u81ea\u5b9a\u4e49\u94fe\u4e2d\u914d\u7f6e\u89c4\u5219\u4e86\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u6211\u4eec\u914d\u7f6e\u4e00\u4e9b\u89c4\u5219\u7528\u4e8e\u4e3e\u4f8b\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5bf9\u81ea\u5b9a\u4e49\u94fe\u7684\u64cd\u4f5c\u4e0e\u5bf9\u9ed8\u8ba4\u94fe\u7684\u64cd\u4f5c\u5e76\u6ca1\u6709\u4ec0\u4e48\u4e0d\u540c\uff0c\u4e00\u5207\u6309\u7167\u64cd\u4f5c\u9ed8\u8ba4\u94fe\u7684\u65b9\u6cd5\u64cd\u4f5c\u81ea\u5b9a\u4e49\u94fe\u5373\u53ef\u3002</p> <p>\u73b0\u5728\uff0c\u81ea\u5b9a\u4e49\u94fe\u4e2d\u5df2\u7ecf\u6709\u4e86\u4e00\u4e9b\u89c4\u5219\uff0c\u4f46\u662f\u76ee\u524d\uff0c\u8fd9\u4e9b\u89c4\u5219\u65e0\u6cd5\u5339\u914d\u5230\u4efb\u4f55\u62a5\u6587\uff0c\u56e0\u4e3a\u6211\u4eec\u5e76\u6ca1\u6709\u5728\u4efb\u4f55\u9ed8\u8ba4\u94fe\u4e2d\u5f15\u7528\u5b83\u3002</p> <p>\u65e2\u7136IN_WEB\u94fe\u662f\u4e3a\u4e86\u9488\u5bf9web\u670d\u52a1\u7684\u5165\u7ad9\u89c4\u5219\u800c\u521b\u5efa\u7684\uff0c\u90a3\u4e48\u8fd9\u4e9b\u89c4\u5219\u5e94\u8be5\u53bb\u5339\u914d\u5165\u7ad9\u7684\u62a5\u6587\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5e94\u8be5\u7528INPUT\u94fe\u53bb\u5f15\u7528\u5b83\u3002</p> <p>\u5f53\u7136\uff0c\u81ea\u5b9a\u4e49\u94fe\u5728\u54ea\u91cc\u521b\u5efa\uff0c\u5e94\u8be5\u88ab\u54ea\u6761\u9ed8\u8ba4\u94fe\u5f15\u7528\uff0c\u53d6\u51b3\u4e8e\u5b9e\u9645\u7684\u5de5\u4f5c\u573a\u666f\uff0c\u56e0\u4e3a\u6b64\u5904\u793a\u4f8b\u7684\u89c4\u5219\u662f\u5339\u914d\u5165\u7ad9\u62a5\u6587\uff0c\u6240\u4ee5\u5728INPUT\u94fe\u4e2d\u5f15\u7528\u81ea\u5b9a\u4e49\u94fe\u3002</p> <p>\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u6211\u4eec\u5728INPUT\u94fe\u4e2d\u6dfb\u52a0\u4e86\u4e00\u6761\u89c4\u5219\uff0c\u8bbf\u95ee\u672c\u673a80\u7aef\u53e3\u7684tcp\u62a5\u6587\u5c06\u4f1a\u88ab\u8fd9\u6761\u89c4\u5219\u5339\u914d\u5230</p> <p>\u800c\u4e0a\u8ff0\u89c4\u5219\u4e2d\u7684\u201d-j IN_WEB\u201d\u8868\u793a\uff1a\u8bbf\u95ee80\u7aef\u53e3\u7684tcp\u62a5\u6587\u5c06\u7531\u81ea\u5b9a\u4e49\u94fe\u201dIN_WEB\u201d\u4e2d\u7684\u89c4\u5219\u8fdb\u884c\u5904\u7406\uff0c\u6ca1\u9519\uff0c\u5728\u4e4b\u524d\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u201d-j\u201d\u9009\u9879\u6307\u5b9a\u52a8\u4f5c\uff0c\u800c\u6b64\u5904\uff0c\u6211\u4eec\u5c06\u201d\u52a8\u4f5c\u201d\u66ff\u6362\u4e3a\u4e86\u201d\u81ea\u5b9a\u4e49\u94fe\u201d\uff0c\u5f53\u201d-j\u201d\u5bf9\u5e94\u7684\u503c\u4e3a\u4e00\u4e2a\u81ea\u5b9a\u4e49\u94fe\u65f6\uff0c\u5c31\u8868\u793a\u88ab\u5f53\u524d\u89c4\u5219\u5339\u914d\u5230\u7684\u62a5\u6587\u5c06\u4ea4\u7531\u5bf9\u5e94\u7684\u81ea\u5b9a\u4e49\u94fe\u5904\u7406\uff0c\u5177\u4f53\u600e\u6837\u5904\u7406\uff0c\u53d6\u51b3\u4e8e\u81ea\u5b9a\u4e49\u94fe\u4e2d\u7684\u89c4\u5219\uff0c\u5f53IN_WEB\u81ea\u5b9a\u4e49\u94fe\u88abINPUT\u94fe\u5f15\u7528\u4ee5\u540e\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0cIN_WEB\u94fe\u7684\u5f15\u7528\u8ba1\u6570\u5df2\u7ecf\u53d8\u4e3a1\uff0c\u8868\u793a\u8fd9\u6761\u81ea\u5b9a\u4e49\u94fe\u5df2\u7ecf\u88ab\u5f15\u7528\u4e861\u6b21\uff0c\u81ea\u5b9a\u4e49\u94fe\u8fd8\u53ef\u4ee5\u5f15\u7528\u5176\u4ed6\u7684\u81ea\u5b9a\u4e49\u94fe\uff0c\u611f\u5174\u8da3\u7684\u8bdd\uff0c\u52a8\u624b\u8bd5\u8bd5\u5427\u3002</p> <p>\u5728\u4e4b\u524d\u7684\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u8bf4\u8fc7\uff0c\u201d\u52a8\u4f5c\u201d\u5728iptables\u4e2d\u88ab\u79f0\u4e3a\u201dtarget\u201d\uff0c\u8fd9\u6837\u63cf\u8ff0\u5e76\u4e0d\u51c6\u786e\uff0c\u56e0\u4e3atarget\u4e3a\u76ee\u6807\u4e4b\u610f\uff0c\u62a5\u6587\u88ab\u89c4\u5219\u5339\u914d\u5230\u4ee5\u540e\uff0ctarget\u80fd\u662f\u4e00\u4e2a\u201d\u52a8\u4f5c\u201d\uff0ctarget\u4e5f\u80fd\u662f\u4e00\u4e2a\u201d\u81ea\u5b9a\u4e49\u94fe\u201d\uff0c\u5f53target\u4e3a\u4e00\u4e2a\u52a8\u4f5c\u65f6\uff0c\u8868\u793a\u62a5\u6587\u6309\u7167\u6307\u5b9a\u7684\u52a8\u4f5c\u5904\u7406\uff0c\u5f53target\u4e3a\u81ea\u5b9a\u4e49\u94fe\u65f6\uff0c\u8868\u793a\u62a5\u6587\u7531\u81ea\u5b9a\u4e49\u94fe\u4e2d\u7684\u89c4\u5219\u5904\u7406\uff0c\u73b0\u5728\u56de\u8fc7\u5934\u518d\u7406\u89e3\u4e4b\u524d\u7684\u672f\u8bed\uff0c\u4f3c\u4e4e\u66f4\u52a0\u660e\u4e86\u4e86\u3002</p> <p>\u90a3\u4e48\u6b64\u523b\uff0c\u6211\u4eec\u5728192.168.1.139\u4e0a\u5c1d\u8bd5\u8bbf\u95ee\u672c\u673a\u768480\u7aef\u53e3\uff0c\u5df2\u7ecf\u88ab\u62d2\u7edd\u8bbf\u95ee\uff0c\u8bc1\u660e\u521a\u624d\u81ea\u5b9a\u4e49\u94fe\u4e2d\u7684\u89c4\u5219\u5df2\u7ecf\u751f\u6548\u4e86\u3002</p> <p></p> <p>\u8fc7\u4e86\u4e00\u6bb5\u65f6\u95f4\uff0c\u6211\u4eec\u53d1\u73b0IN_WEB\u8fd9\u4e2a\u540d\u5b57\u4e0d\u592a\u5408\u9002\uff0c\u6211\u4eec\u60f3\u8981\u5c06\u8fd9\u6761\u81ea\u5b9a\u4e49\u94fe\u91cd\u547d\u540d\uff0c\u628a\u540d\u5b57\u6539\u6210WEB\uff0c\u53ef\u4ee5\u5417\uff1f\u5fc5\u987b\u80fd\u554a\uff0c\u793a\u4f8b\u5982\u4e0b</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u4f7f\u7528\u201d-E\u201d\u9009\u9879\u53ef\u4ee5\u4fee\u6539\u81ea\u5b9a\u4e49\u94fe\u540d\uff0c\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5f15\u7528\u81ea\u5b9a\u4e49\u94fe\u5904\u7684\u540d\u79f0\u4f1a\u81ea\u52a8\u53d1\u751f\u6539\u53d8\u3002</p> <p>\u597d\u4e86\uff0c\u6211\u4eec\u5df2\u7ecf\u80fd\u591f\u521b\u5efa\u81ea\u5b9a\u4e49\u4e86\uff0c\u90a3\u4e48\u600e\u6837\u5220\u9664\u81ea\u5b9a\u4e49\u94fe\u5462\uff1f</p> <p>\u4f7f\u7528\u201d-X\u201d\u9009\u9879\u53ef\u4ee5\u5220\u9664\u81ea\u5b9a\u4e49\u94fe\uff0c\u4f46\u662f\u5220\u9664\u81ea\u5b9a\u4e49\u94fe\u65f6\uff0c\u9700\u8981\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6\uff1a</p> <p>1\u3001\u81ea\u5b9a\u4e49\u94fe\u6ca1\u6709\u88ab\u4efb\u4f55\u9ed8\u8ba4\u94fe\u5f15\u7528\uff0c\u5373\u81ea\u5b9a\u4e49\u94fe\u7684\u5f15\u7528\u8ba1\u6570\u4e3a0\u3002</p> <p>2\u3001\u81ea\u5b9a\u4e49\u94fe\u4e2d\u6ca1\u6709\u4efb\u4f55\u89c4\u5219\uff0c\u5373\u81ea\u5b9a\u4e49\u94fe\u4e3a\u7a7a\u3002</p> <p>\u90a3\u4e48\uff0c\u6211\u4eec\u6765\u5220\u9664\u81ea\u5b9a\u4e49\u94feWEB\u8bd5\u8bd5\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u4f7f\u7528\u201d-X\u201d\u9009\u9879\u5220\u9664\u5bf9\u5e94\u7684\u81ea\u5b9a\u4e49\u94fe\uff0c\u4f46\u662f\u4e0a\u4f8b\u4e2d\uff0c\u5e76\u6ca1\u6709\u6210\u529f\u5220\u9664\u81ea\u5b9a\u4e49\u94feWEB\uff0c\u63d0\u793a\uff1aToo many links\uff0c\u662f\u56e0\u4e3aWEB\u94fe\u5df2\u7ecf\u88ab\u9ed8\u8ba4\u94fe\u6240\u5f15\u7528\uff0c\u4e0d\u6ee1\u8db3\u4e0a\u8ff0\u6761\u4ef61\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u5220\u9664\u5bf9\u5e94\u7684\u5f15\u7528\u89c4\u5219\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5220\u9664\u5f15\u7528\u81ea\u5b9a\u4e49\u94fe\u7684\u89c4\u5219\u540e\uff0c\u518d\u6b21\u5c1d\u8bd5\u5220\u9664\u81ea\u5b9a\u4e49\u94fe\uff0c\u63d0\u793a\uff1aDirectory not empty\uff0c\u662f\u56e0\u4e3aWEB\u94fe\u4e2d\u5b58\u5728\u89c4\u5219\uff0c\u4e0d\u6ee1\u8db3\u4e0a\u8ff0\u6761\u4ef62\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u6e05\u7a7a\u5bf9\u5e94\u7684\u81ea\u5b9a\u4e49\u94fe\uff0c\u793a\u4f8b\u5982\u4e0b</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u4f7f\u7528\u201d-X\u201d\u9009\u9879\u53ef\u4ee5\u5220\u9664\u4e00\u4e2a\u5f15\u7528\u8ba1\u6570\u4e3a0\u7684\u3001\u7a7a\u7684\u81ea\u5b9a\u4e49\u94fe\u3002</p>"},{"location":"iptables_10/#_1","title":"\u5c0f\u7ed3","text":"<p>\u4e3a\u4e86\u65b9\u4fbf\u4ee5\u540e\u56de\u987e\uff0c\u6211\u4eec\u5c06\u4e0a\u8ff0\u547d\u4ee4\u8fdb\u884c\u603b\u7ed3\u3002</p>"},{"location":"iptables_10/#_2","title":"\u521b\u5efa\u81ea\u5b9a\u4e49\u94fe","text":"<pre><code>#\u793a\u4f8b\uff1a\u5728filter\u8868\u4e2d\u521b\u5efaIN_WEB\u81ea\u5b9a\u4e49\u94fe\niptables\u00a0-t\u00a0filter\u00a0-N\u00a0IN_WEB\n</code></pre>"},{"location":"iptables_10/#_3","title":"\u5f15\u7528\u81ea\u5b9a\u4e49\u94fe","text":"<pre><code>#\u793a\u4f8b\uff1a\u5728INPUT\u94fe\u4e2d\u5f15\u7528\u521a\u624d\u521b\u5efa\u7684\u81ea\u5b9a\u4e49\u94fe\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-p\u00a0tcp\u00a0--dport\u00a080\u00a0-j\u00a0IN_WEB\n</code></pre>"},{"location":"iptables_10/#_4","title":"\u91cd\u547d\u540d\u81ea\u5b9a\u4e49\u94fe","text":"<pre><code>#\u793a\u4f8b\uff1a\u5c06IN_WEB\u81ea\u5b9a\u4e49\u94fe\u91cd\u547d\u540d\u4e3aWEB\niptables\u00a0-E\u00a0IN_WEB\u00a0WEB\n</code></pre>"},{"location":"iptables_10/#_5","title":"\u5220\u9664\u81ea\u5b9a\u4e49\u94fe","text":"<p>\u5220\u9664\u81ea\u5b9a\u4e49\u94fe\u9700\u8981\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6</p> <p>1\u3001\u81ea\u5b9a\u4e49\u94fe\u6ca1\u6709\u88ab\u5f15\u7528</p> <p>2\u3001\u81ea\u5b9a\u4e49\u94fe\u4e2d\u6ca1\u6709\u4efb\u4f55\u89c4\u5219</p> <pre><code>#\u793a\u4f8b\uff1a\u5220\u9664\u5f15\u7528\u8ba1\u6570\u4e3a0\u5e76\u4e14\u4e0d\u5305\u542b\u4efb\u4f55\u89c4\u5219\u7684WEB\u94fe\niptables\u00a0-X\u00a0WEB\n</code></pre> <p>\u597d\u4e86\uff0c\u81ea\u5b9a\u4e49\u94fe\u5c31\u603b\u7ed3\u5230\u8fd9\u91cc\uff0c\u5e0c\u671b\u8fd9\u7bc7\u6587\u7ae0\u80fd\u591f\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9~~~\u5404\u4f4d\u5ba2\u5b98\uff0c\u518d\u89c1\u5566\uff0c\u4e48\u4e48\u54d2~~~~</p>"},{"location":"iptables_11/","title":"iptables\u8be6\u89e3\uff0811\uff09\uff1aiptables\u4e4b\u7f51\u7edc\u9632\u706b\u5899","text":"<p>\u5728\u672c\u535a\u5ba2\u4e2d\uff0c\u4ece\u7406\u8bba\u5230\u5b9e\u8df5\uff0c\u7cfb\u7edf\u7684\u4ecb\u7ecd\u4e86iptables\uff0c\u5982\u679c\u4f60\u60f3\u8981\u4ece\u5934\u5f00\u59cb\u4e86\u89e3iptables\uff0c\u53ef\u4ee5\u67e5\u770biptables\u6587\u7ae0\u5217\u8868\uff0c\u76f4\u8fbe\u94fe\u63a5\u5982\u4e0b</p> <p>iptables\u96f6\u57fa\u7840\u5feb\u901f\u5165\u95e8\u7cfb\u5217</p> <p>\u9605\u8bfb\u8fd9\u7bc7\u6587\u7ae0\u9700\u8981\u7ad9\u5728\u524d\u6587\u7684\u57fa\u7840\u4e4b\u4e0a\uff0c\u5982\u679c\u5728\u9605\u8bfb\u65f6\u9047\u5230\u969c\u788d\uff0c\u8bf7\u56de\u987e\u524d\u6587\u3002</p> <p>\u6211\u4eec\u4e00\u8d77\u6765\u56de\u987e\u4e00\u4e0b\u4e4b\u524d\u7684\u77e5\u8bc6\uff0c\u5728\u7b2c\u4e00\u7bc7\u4ecb\u7ecdiptables\u7684\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u5c31\u63cf\u8ff0\u8fc7\u9632\u706b\u5899\u7684\u6982\u5ff5\uff0c\u6211\u4eec\u8bf4\u8fc7\uff0c\u9632\u706b\u5899\u4ece\u903b\u8f91\u4e0a\u8bb2\uff0c\u53ef\u4ee5\u5206\u4e3a\u4e3b\u673a\u9632\u706b\u5899\u4e0e\u7f51\u7edc\u9632\u706b\u5899\u3002</p> <p>\u4e3b\u673a\u9632\u706b\u5899\uff1a\u9488\u5bf9\u4e8e\u5355\u4e2a\u4e3b\u673a\u8fdb\u884c\u9632\u62a4\u3002</p> <p>\u7f51\u7edc\u9632\u706b\u5899\uff1a \u5f80\u5f80\u5904\u4e8e\u7f51\u7edc\u5165\u53e3\u6216\u8fb9\u7f18\uff0c\u9488\u5bf9\u4e8e\u7f51\u7edc\u5165\u53e3\u8fdb\u884c\u9632\u62a4\uff0c\u670d\u52a1\u4e8e\u9632\u706b\u5899\u80cc\u540e\u7684\u672c\u5730\u5c40\u57df\u7f51\u3002</p> <p>\u5728\u524d\u6587\u7684\u4e3e\u4f8b\u4e2d\uff0ciptables\u90fd\u662f\u4f5c\u4e3a\u4e3b\u673a\u9632\u706b\u5899\u7684\u89d2\u8272\u51fa\u73b0\u7684\uff0c\u90a3\u4e48\uff0ciptables\u600e\u6837\u4f5c\u4e3a\u7f51\u7edc\u9632\u706b\u5899\u5462\uff1f\u8fd9\u5c31\u662f\u6211\u4eec\u4eca\u5929\u8981\u804a\u7684\u8bdd\u9898\u3002</p> <p>\u56de\u5230\u521a\u624d\u7684\u6982\u5ff5\uff0c\u7f51\u7edc\u9632\u706b\u5899\u5f80\u5f80\u5904\u4e8e\u7f51\u7edc\u7684\u5165\u53e3\u6216\u8005\u8fb9\u7f18\uff0c\u90a3\u4e48\uff0c\u5982\u679c\u60f3\u8981\u4f7f\u7528iptables\u5145\u5f53\u7f51\u7edc\u9632\u706b\u5899\uff0ciptables\u6240\u5728\u7684\u4e3b\u673a\u5219\u9700\u8981\u5904\u4e8e\u7f51\u7edc\u5165\u53e3\u5904\uff0c\u793a\u610f\u56fe\u5982\u4e0b\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u6a58\u9ec4\u8272\u4e3b\u673a\u4e3aiptables\u6240\u5728\u4e3b\u673a\uff0c\u6b64\u65f6iptables\u5145\u5f53\u7684\u89d2\u8272\u5373\u4e3a\u7f51\u7edc\u9632\u706b\u5899\uff0c\u4e0a\u56fe\u4e2d\u7684\u6d45\u84dd\u8272\u5706\u5f62\u8868\u793a\u7f51\u7edc\u9632\u706b\u5899\u6240\u9632\u62a4\u7684\u7f51\u7edc\u533a\u57df\uff0c\u5706\u5f62\u5185\u7684\u84dd\u8272\u77e9\u5f62\u8868\u793a\u7f51\u7edc\u5185\u7684\u4e3b\u673a\u3002</p> <p>\u5f53\u5916\u90e8\u7f51\u7edc\u4e2d\u7684\u4e3b\u673a\u4e0e\u7f51\u7edc\u5185\u90e8\u4e3b\u673a\u901a\u8baf\u65f6\uff0c\u4e0d\u7ba1\u662f\u7531\u5916\u90e8\u4e3b\u673a\u53d1\u5f80\u5185\u90e8\u4e3b\u673a\u7684\u62a5\u6587\uff0c\u8fd8\u662f\u7531\u5185\u90e8\u4e3b\u673a\u53d1\u5f80\u5916\u90e8\u4e3b\u673a\u7684\u62a5\u6587\uff0c\u90fd\u9700\u8981\u7ecf\u8fc7iptables\u6240\u5728\u7684\u4e3b\u673a\uff0c\u7531iptables\u6240\u5728\u7684\u4e3b\u673a\u8fdb\u884c\u201d\u8fc7\u6ee4\u5e76\u8f6c\u53d1\u201d\uff0c\u6240\u4ee5\uff0c\u9632\u706b\u5899\u4e3b\u673a\u7684\u4e3b\u8981\u5de5\u4f5c\u5c31\u662f\u201d\u8fc7\u6ee4\u5e76\u8f6c\u53d1\u201d\uff0c\u90a3\u4e48\uff0c\u8bf4\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u5219\u4e0d\u5f97\u4e0d\u518d\u6b21\u56de\u987e\u4e4b\u524d\u7684iptables\u62a5\u6587\u6d41\u7a0b\u56fe\u4e86\uff0c\u5982\u4e0b\uff1a</p> <p></p> <p>\u524d\u6587\u4e2d\uff0ciptables\u90fd\u662f\u4f5c\u4e3a\u201d\u4e3b\u673a\u9632\u706b\u5899\u201d\u7684\u89d2\u8272\u51fa\u73b0\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u4e3e\u4f8b\u65f6\uff0c\u53ea\u7528\u5230\u4e86\u4e0a\u56fe\u4e2d\u7684INPUT\u94fe\u4e0eOUTPUT\u94fe\uff0c\u56e0\u4e3a\u62e5\u6709\u201d\u8fc7\u6ee4\u529f\u80fd\u201d\u7684\u94fe\u53ea\u67093\u6761\uff0cINPUT\u3001OUTPUT\u3001FORWARD\uff0c\u5f53\u62a5\u6587\u53d1\u5f80\u672c\u673a\u65f6\uff0c\u5982\u679c\u60f3\u8981\u8fc7\u6ee4\uff0c\u53ea\u80fd\u5728INPUT\u94fe\u4e0eOUTPUT\u94fe\u4e2d\u5b9e\u73b0\uff0c\u800c\u6b64\u65f6\uff0ciptables\u7684\u89d2\u8272\u53d1\u751f\u4e86\u8f6c\u53d8\uff0c\u6211\u4eec\u60f3\u8981\u5c06iptables\u6240\u5728\u7684\u4e3b\u673a\u6253\u9020\u6210\u201d\u7f51\u7edc\u9632\u706b\u5899\u201d\uff0c\u800c\u521a\u624d\u5df2\u7ecf\u8bf4\u8fc7\uff0c\u7f51\u7edc\u9632\u706b\u5899\u7684\u804c\u8d23\u5c31\u662f\u201d\u8fc7\u6ee4\u5e76\u8f6c\u53d1\u201d\uff0c\u8981\u60f3\u201d\u8fc7\u6ee4\u201d\uff0c\u53ea\u80fd\u5728INPUT\u3001OUTPUT\u3001FORWARD\u4e09\u6761\u94fe\u4e2d\u5b9e\u73b0\uff0c\u8981\u60f3\u201d\u8f6c\u53d1\u201d\uff0c\u62a5\u6587\u5219\u53ea\u4f1a\u7ecf\u8fc7FORWARD\u94fe\uff08\u53d1\u5f80\u672c\u673a\u7684\u62a5\u6587\u624d\u4f1a\u7ecf\u8fc7INPUT\u94fe\uff09\uff0c\u6240\u4ee5\uff0c\u7efc\u4e0a\u6240\u8ff0\uff0ciptables\u7684\u89d2\u8272\u53d8\u4e3a\u201d\u7f51\u7edc\u9632\u706b\u5899\u201d\u65f6\uff0c\u89c4\u5219\u53ea\u80fd\u5b9a\u4e49\u5728FORWARD\u94fe\u4e2d\u3002</p>"},{"location":"iptables_11/#_1","title":"\u73af\u5883\u51c6\u5907","text":"<p>\u90a3\u4e48\u4e3a\u4e86\u80fd\u591f\u8fdb\u884c\u5b9e\u9a8c\uff0c\u6211\u4eec\u6765\u8bbe\u7f6e\u4e00\u4e0b\u5b9e\u9a8c\u573a\u666f\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff08\u540e\u9762\u6709\u5bf9\u56fe\u7684\u89e3\u91ca\uff09</p> <p></p> <p>\u6211\u4eec\u5047\u8bbe\uff0c\u4e0a\u56fe\u4e2d\u5706\u5f62\u6240\u793a\u7684\u7f51\u7edc\u4e3a\u5185\u90e8\u7f51\u7edc</p> <p>\u6ce8\uff1a\u6b64\u5904\u6240\u63cf\u8ff0\u7684\u5185\u7f51\u3001\u5916\u7f51\u4e0e\u6211\u4eec\u5e73\u5e38\u6240\u8bf4\u7684\u516c\u7f51\u3001\u79c1\u7f51\u4e0d\u540c\u3002</p> <p>\u6b64\u5904\u63cf\u8ff0\u7684\u5185\u5916\u90e8\u7f51\u7edc\u4f60\u53ef\u4ee5\u7406\u89e3\u6210\u4e24\u4e2a\u7f51\u6bb5\uff0cA\u7f51\u7edc\u4e0eB\u7f51\u7edc\uff0c\u4e3a\u4e86\u65b9\u4fbf\u63cf\u8ff0\uff0c\u6211\u4eec\u628a\u5706\u5f62\u5185\u7684\u4e3b\u673a\u79f0\u4e3a\u5185\u90e8\u4e3b\u673a\uff0c\u628a\u4e0a\u56fe\u4e2d\u5706\u5f62\u6240\u8868\u793a\u7684\u7f51\u7edc\u79f0\u4e3a\u5185\u90e8\u7f51\u7edc\uff0c\u628a\u5706\u5f62\u5916\u7684\u7f51\u7edc\u79f0\u4e3a\u5916\u90e8\u7f51\u7edc\u3002</p> <p>\u5047\u8bbe\uff0c\u5185\u90e8\u7f51\u7edc\u7684\u7f51\u6bb5\u4e3a10.1.0.0/16\uff0c\u6b64\u5185\u90e8\u7f51\u7edc\u4e2d\u5b58\u5728\u4e3b\u673aC\uff0c\u4e3b\u673aC\u7684IP\u5730\u5740\u4e3a10.1.0.1\u3002</p> <p>\u4e0a\u56fe\u4e2d\u7684\u4e3b\u673aB\u5145\u5f53\u4e86\u7f51\u7edc\u9632\u706b\u5899\u7684\u89d2\u8272\uff0c\u4e3b\u673aB\u4e5f\u5c5e\u4e8e\u5185\u90e8\u7f51\u7edc\uff0c\u540c\u65f6\u4e3b\u673aB\u4e5f\u80fd\u4e0e\u5916\u90e8\u7f51\u7edc\u8fdb\u884c\u901a\u8baf\uff0c\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u4e3b\u673aB\u6709\u4e24\u5757\u7f51\u5361\uff0c\u7f51\u53611\u4e0e\u7f51\u53612\uff0c\u7f51\u53611\u7684IP\u5730\u5740\u4e3a10.1.0.3\uff0c\u7f51\u53612\u7684IP\u5730\u5740\u4e3a192.168.1.146\uff0c\u6240\u4ee5\uff0c\u9632\u706b\u5899\u4e3b\u673a\u5728\u5185\u90e8\u7f51\u7edc\u4e2d\u7684IP\u5730\u5740\u4e3a10.1.0.3\uff0c\u9632\u706b\u5899\u4e3b\u673a\u4e0e\u5916\u90e8\u7f51\u7edc\u901a\u8baf\u7684IP\u5730\u5740\u4e3a192.168.1.146\u3002</p> <p>\u4e0a\u56fe\u4e2d\u7684\u4e3b\u673aA\u5145\u5f53\u4e86\u201d\u5916\u90e8\u7f51\u7edc\u4e3b\u673a\u201d\u7684\u89d2\u8272\uff0cA\u4e3b\u673a\u7684IP\u5730\u5740\u4e3a192.168.1.147\uff0c\u6211\u4eec\u4f7f\u7528\u4e3b\u673aA\u8bbf\u95ee\u5185\u90e8\u7f51\u7edc\u4e2d\u7684\u4e3b\u673aC\uff0c\u4f46\u662f\u9700\u8981\u4e3b\u673aB\u8fdb\u884c\u8f6c\u53d1\uff0c\u4e3b\u673aB\u5728\u8f6c\u53d1\u62a5\u6587\u65f6\u4f1a\u8fdb\u884c\u8fc7\u6ee4\uff0c\u4ee5\u5b9e\u73b0\u7f51\u7edc\u9632\u706b\u5899\u7684\u529f\u80fd\u3002</p> <p>\u6211\u5df2\u7ecf\u51c6\u5907\u4e863\u53f0\u865a\u62df\u673a\uff0cA\u3001B\u3001C</p> <p>\u865a\u62df\u673aA\u4e0e\u865a\u62df\u673aB\u7684\u7f51\u53612\u90fd\u4f7f\u7528\u4e86\u6865\u63a5\u6a21\u5f0f\u3002</p> <p>\u4e3a\u4e86\u80fd\u591f\u5c3d\u91cf\u6a21\u62df\u5185\u90e8\u7f51\u7edc\u7684\u7f51\u7edc\u5165\u53e3\uff0c\u6211\u4eec\u5c06\u865a\u62df\u673aB\u7684\u7f51\u53611\u4e0e\u865a\u62df\u673aC\u540c\u65f6\u653e\u5728\u201d\u4ec5\u4e3b\u673a\u6a21\u5f0f\u201d\u7684\u865a\u62df\u7f51\u7edc\u4e2d\uff0c\u865a\u62df\u673a\u8bbe\u7f6e\u5982\u4e0b\u56fe\u6240\u793a</p> <p>\u70b9\u51fbvmware\u7f16\u8f91\u83dc\u5355\uff0c\u6253\u5f00\u865a\u62df\u7f51\u7edc\u7f16\u8f91\u5668\uff0c\u70b9\u51fb\u66f4\u6539\u8bbe\u7f6e\u6309\u94ae\uff0c\u6dfb\u52a0\u4e00\u4e2a\u4ec5\u4e3b\u673a\u6a21\u5f0f\u7684\u865a\u62df\u7f51\u7edc\uff0c\u4e0b\u56fe\u4e2d\u7684vmnet6\u4e3a\u5df2\u7ecf\u6dfb\u52a0\u8fc7\u7684\u865a\u62df\u7f51\u7edc\uff0c\u6b64\u5904\u4e0d\u518d\u91cd\u590d\u6dfb\u52a0\u3002</p> <p></p> <p>\u7531\u4e8eB\u4e3b\u673a\u73b0\u5728\u7684\u89d2\u8272\u662f10.1.0.0\u4e2d\u7684\u201d\u7f51\u7edc\u9632\u706b\u5899\u201d\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u76f4\u63a5\u5c06C\u4e3b\u673a\u7684\u7f51\u5173\u6307\u5411B\u4e3b\u673a\u7684\u5185\u90e8\u7f51\u7edcIP\uff0c\u5982\u4e0b\u56fe\u6240\u793a</p> <p></p> <p>\u540c\u65f6\uff0c\u4e3a\u4e86\u5c3d\u91cf\u7b80\u5316\u8def\u7531\u8bbe\u7f6e\uff0c\u6211\u4eec\u76f4\u63a5\u5c06A\u4e3b\u673a\u8bbf\u95ee10.1\u7f51\u7edc\u65f6\u7684\u7f51\u5173\u6307\u5411B\u4e3b\u673a\u7684\u7f51\u53612\u4e0a\u7684IP\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p>\u6ce8\uff1aroute\u547d\u4ee4\u914d\u7f6e\u7684\u8def\u7531\u6761\u76ee\u5728\u7f51\u7edc\u91cd\u542f\u540e\u5c06\u4f1a\u5931\u6548</p> <p></p> <p>\u73b0\u5728A\u4e3b\u673a\u901a\u5f8010.1\u7f51\u7edc\u7684\u7f51\u5173\u5df2\u7ecf\u6307\u5411\u4e86B\u4e3b\u673a\uff0c\u90a3\u4e48\uff0c\u73b0\u5728A\u4e3b\u673a\u80fd\u591f\u8fbe\u523010.1.0.0/16\u7f51\u7edc\u5417\uff1f\u6211\u4eec\u6765\u8bd5\u8bd5</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u6211\u4eec\u76f4\u63a5\u5728A\u4e3b\u673a\u4e0a\u5411C\u4e3b\u673a\u53d1\u8d77ping\u8bf7\u6c42\uff0c\u5e76\u6ca1\u6709\u5f97\u5230\u4efb\u4f55\u56de\u5e94\u3002</p> <p></p> <p>\u90a3\u4e48\uff0c\u6211\u4eec\u518d\u6765\u8bd5\u8bd5B\u4e3b\u673a\u4e0a\u7684\u5185\u90e8\u7f51IP\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u76f4\u63a5\u5728A\u4e3b\u673a\u4e0a\u5411B\u4e3b\u673a\u7684\u5185\u90e8\u7f51IP\u53d1\u8d77ping\u8bf7\u6c42\uff0c\u53d1\u73b0\u662f\u53ef\u4ee5ping\u901a\u7684\uff0c\u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f</p> <p></p> <p>\u6309\u7167\u9053\u7406\u6765\u8bf4\uff0c10.1.0.1\u4e0e10.1.0.3\u90fd\u5c5e\u4e8e10.1.0.0/16\u7f51\u6bb5\uff0c\u4e3a\u4ec0\u4e48B\u4e3b\u673a\u4e0a\u7684IP\u5c31\u80fd\u901a\uff0cC\u4e3b\u673a\u4e0a\u7684IP\u5374\u4e0d\u901a\u5462\uff1f</p> <p>\u54b1\u4eec\u5148\u6765\u804a\u804a\u4e3a\u4ec0\u4e4810.1.0.1\u6ca1\u6709\u56de\u5e94\u3002</p> <p>A\u4e3b\u673a\u901a\u8fc7\u8def\u7531\u8868\u5f97\u77e5\uff0c\u53d1\u5f8010.1.0.0/16\u7f51\u6bb5\u7684\u62a5\u6587\u7684\u7f51\u5173\u4e3aB\u4e3b\u673a\uff0c\u5f53\u62a5\u6587\u8fbe\u5230B\u4e3b\u673a\u65f6\uff0cB\u4e3b\u673a\u53d1\u73b0A\u7684\u76ee\u6807\u4e3a10.1.0.1\uff0c\u800c\u81ea\u5df1\u7684IP\u662f10.1.0.3\uff0c\u8fd9\u65f6\uff0cB\u4e3b\u673a\u5219\u9700\u8981\u5c06\u8fd9\u4e2a\u62a5\u6587\u8f6c\u53d1\u7ed910.1.0.1\uff08\u4e5f\u5c31\u662fC\u4e3b\u673a\uff09\uff0c\u4f46\u662f\uff0cLinux\u4e3b\u673a\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5e76\u4e0d\u4f1a\u8f6c\u53d1\u62a5\u6587\uff0c\u5982\u679c\u60f3\u8981\u8ba9Linux\u4e3b\u673a\u80fd\u591f\u8f6c\u53d1\u62a5\u6587\uff0c\u9700\u8981\u989d\u5916\u7684\u8bbe\u7f6e\uff0c\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e4810.1.0.1\u6ca1\u6709\u56de\u5e94\u7684\u539f\u56e0\uff0c\u56e0\u4e3aB\u4e3b\u673a\u538b\u6839\u5c31\u6ca1\u6709\u5c06A\u4e3b\u673a\u7684ping\u8bf7\u6c42\u8f6c\u53d1\u7ed9C\u4e3b\u673a\uff0cC\u4e3b\u673a\u538b\u6839\u5c31\u6ca1\u6709\u6536\u5230A\u7684ping\u8bf7\u6c42\uff0c\u6240\u4ee5A\u81ea\u7136\u5f97\u4e0d\u5230\u56de\u5e94\u3002</p> <p>\u73b0\u5728\u518d\u6765\u804a\u804a\u4e3a\u4ec0\u4e4810.1.0.3\u4f1a\u56de\u5e94\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a10.1.0.3\u8fd9\u4e2aIP\u4e0e192.168.1.146\u8fd9\u4e2aIP\u90fd\u5c5e\u4e8eB\u4e3b\u673a\uff0c\u5f53A\u4e3b\u673a\u901a\u8fc7\u8def\u7531\u8868\u5c06ping\u62a5\u6587\u53d1\u9001\u5230B\u4e3b\u673a\u4e0a\u65f6\uff0cB\u4e3b\u673a\u53d1\u73b0\u81ea\u5df1\u65e2\u662f192.168.1.146\u53c8\u662f10.1.0.3\uff0c\u6240\u4ee5\uff0cB\u4e3b\u673a\u5c31\u76f4\u63a5\u56de\u5e94\u4e86A\u4e3b\u673a\uff0c\u5e76\u6ca1\u6709\u5c06\u62a5\u6587\u8f6c\u53d1\u7ed9\u8c01\uff0c\u6240\u4ee5A\u4e3b\u673a\u5f97\u5230\u4e8610.1.0.3\u7684\u56de\u5e94\u3002</p> <p>\u6211\u60f3\u6211\u5e94\u8be5\u8bf4\u660e\u767d\u4e86\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u5e94\u8be5\u600e\u6837\u8bbe\u7f6e\uff0c\u624d\u80fd\u8ba9Linux\u4e3b\u673a\u8f6c\u53d1\u62a5\u6587\u5462\uff1f\u6211\u4eec\u4e00\u8d77\u6765\u8bbe\u7f6e\u4e00\u904d\u5c31\u597d\u4e86\u3002</p> <p>\u9996\u5148\uff0c\u6211\u4eec\u53ef\u4ee5\u67e5\u770b/proc/sys/net/ipv4/ip_forward\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\uff0c\u5982\u679c\u6587\u4ef6\u5185\u5bb9\u4e3a0\uff0c\u5219\u8868\u793a\u5f53\u524d\u4e3b\u673a\u4e0d\u652f\u6301\u8f6c\u53d1\u3002</p> <p></p> <p>\u5982\u679c\u6211\u4eec\u60f3\u8981\u8ba9\u5f53\u524d\u4e3b\u673a\u652f\u6301\u6838\u5fc3\u8f6c\u53d1\u529f\u80fd\uff0c\u53ea\u9700\u8981\u5c06\u6b64\u6587\u4ef6\u4e2d\u7684\u503c\u8bbe\u7f6e\u4e3a1\u5373\u53ef\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u597d\u4e86\uff0c\u73b0\u5728\u6211\u4eec\u5c31\u5f00\u542f\u4e86B\u4e3b\u673a\u7684\u6838\u5fc3\u8f6c\u53d1\u529f\u80fd\u3002</p> <p>\u9664\u4e86\u4e0a\u8ff0\u65b9\u6cd5\uff0c\u8fd8\u80fd\u4f7f\u7528sysctl\u547d\u4ee4\u53bb\u8bbe\u7f6e\u662f\u5426\u5f00\u542f\u6838\u5fc3\u8f6c\u53d1\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u4e0a\u8ff0\u4e24\u79cd\u65b9\u6cd5\u90fd\u80fd\u63a7\u5236\u662f\u5426\u5f00\u542f\u6838\u5fc3\u8f6c\u53d1\uff0c\u4f46\u662f\u901a\u8fc7\u4e0a\u8ff0\u4e24\u79cd\u65b9\u6cd5\u8bbe\u7f6e\u540e\uff0c\u53ea\u80fd\u4e34\u65f6\u751f\u6548\uff0c\u5f53\u91cd\u542f\u7f51\u7edc\u670d\u52a1\u4ee5\u540e\uff0c\u6838\u5fc3\u8f6c\u53d1\u529f\u80fd\u5c06\u4f1a\u5931\u6548\u3002</p> <p>\u5982\u679c\u60f3\u8981\u6c38\u4e45\u751f\u6548\uff0c\u5219\u9700\u8981\u8bbe\u7f6e/etc/sysctl.conf\u6587\u4ef6\uff08centos7\u4e2d\u914d\u7f6e/usr/lib/sysctl.d/00-system.conf\u6587\u4ef6\uff09\uff0c\u6dfb\u52a0\uff08\u6216\u4fee\u6539\uff09\u914d\u7f6e\u9879 net.ipv4.ip_forward = 1 \u5373\u53ef\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u73b0\u5728\uff0cB\u4e3b\u673a\u5df2\u7ecf\u5177\u5907\u4e86\u6838\u5fc3\u8f6c\u53d1\u529f\u80fd\uff0c\u5df2\u7ecf\u53ef\u4ee5\u8f6c\u53d1\u62a5\u6587\u4e86\uff0c\u73b0\u5728\uff0c\u6211\u4eec\u518d\u6b21\u56de\u5230A\u4e3b\u673a\u4e2d\uff0c\u5411C\u4e3b\u673a\u53d1\u8d77ping\u8bf7\u6c42\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5df2\u7ecf\u53ef\u4ee5ping\u901a\u3002</p> <p>\u6ce8\uff1a\u5982\u679c\u4f60\u4ecd\u7136\u65e0\u6cd5ping\u901a\uff0c\u53ef\u80fd\u662f\u56e0\u4e3a\u4f60\u4f7f\u7528route\u547d\u4ee4\u914d\u7f6e\u4e86C\u4e3b\u673a\u7684\u9ed8\u8ba4\u7f51\u5173\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8bf7\u67e5\u770bC\u4e3b\u673a\u7684\u8def\u7531\u914d\u7f6e\u662f\u5426\u81ea\u52a8\u6d88\u5931\u4e86\uff0c\u5982\u679c\u6ca1\u6709\u5bf9\u5e94\u7684\u8def\u7531\u6761\u76ee\uff0c\u8bf7\u91cd\u65b0\u914d\u7f6e\uff0c\u540c\u65f6\uff0c\u5982\u679c\u4f60\u7684\u4e3b\u673aC\u5982\u679c\u6709\u591a\u5757\u7f51\u5361\uff0c\u53ef\u4ee5\u6682\u65f6\u7981\u7528\u5176\u4ed6\u7f51\u5361\u8bd5\u8bd5</p> <p></p> <p>\u540c\u65f6\uff0c\u4ece\u4e3b\u673aC\u5411\u4e3b\u673aA\u53d1\u8d77ping\u8bf7\u6c42\uff0c\u4e5f\u53ef\u4ee5ping\u901a\uff0c\u5982\u4e0b\u56fe\u6240\u793a</p> <p></p> <p>\u597d\u4e86\uff0c\u6211\u4eec\u7684\u6d4b\u8bd5\u73af\u5883\u5df2\u7ecf\u51c6\u5907\u5b8c\u6bd5\uff0c\u73b0\u5728\u53ef\u4ee5\u5f00\u59cb\u6d4b\u8bd5\u4e86\u3002</p> <p>\u4f46\u662f\u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u8bf7\u786e\u5b9a\u4e3b\u673aA\u4e0e\u4e3b\u673aC\u4e0a\u6ca1\u6709\u5bf9\u5e94\u7684iptables\u89c4\u5219\uff0c\u56e0\u4e3a\u6b64\u5904\u6211\u4eec\u4e3b\u8981\u662f\u7528\u6765\u6d4b\u8bd5\u201d\u7f51\u7edc\u9632\u706b\u5899\u201d\u7684\uff0c\u4e3a\u4e86\u51cf\u5c11\u4e3b\u673a\u9632\u706b\u5899\u5e26\u6765\u7684\u5f71\u54cd\uff0c\u6211\u4eec\u76f4\u63a5\u5c06\u4e3b\u673aA\u4e0e\u4e3b\u673aC\u4e0a\u7684\u89c4\u5219\u6e05\u7a7a\u3002</p>"},{"location":"iptables_11/#_2","title":"\u7f51\u7edc\u9632\u706b\u5899\u6d4b\u8bd5","text":"<p>\u4e4b\u524d\u8bf4\u8fc7\uff0ciptables\u4f5c\u4e3a\u7f51\u7edc\u9632\u706b\u5899\u65f6\uff0c\u4e3b\u8981\u8d1f\u8d23\u201d\u8fc7\u6ee4\u4e0e\u8f6c\u53d1\u201d\uff0c\u65e2\u7136\u8981\u8fc7\u6ee4\uff0c\u5219\u9700\u914d\u7f6efilter\u8868\uff0c\u65e2\u7136\u8981\u8f6c\u53d1\uff0c\u5219\u9700\u5728FORWAED\u94fe\u4e2d\u5b9a\u4e49\u89c4\u5219\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5e94\u8be5\u5728filter\u8868\u4e2d\u7684FORWARD\u94fe\u4e2d\u914d\u7f6e\u89c4\u5219\u3002</p> <p>\u90a3\u4e48\uff0c\u6211\u4eec\u5148\u6765\u770b\u770b\u4e3b\u673aB\u4e0a\u7684filter\u8868\u4e2d\u662f\u5426\u5df2\u7ecf\u5b58\u5728\u89c4\u5219\uff0c\u5982\u4e0b</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff0cFORWARD\u94fe\u4e2d\u6ca1\u6709\u4efb\u4f55\u89c4\u5219\uff0c\u9ed8\u8ba4\u7b56\u7565\u4e3aACCEPT\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u201d\u767d\u540d\u5355\u673a\u5236\u201d\uff08\u5982\u679c\u5fd8\u4e86\u8bf7\u56de\u987e\u524d\u6587\uff1a\u9ed1\u767d\u540d\u5355\u673a\u5236\uff09</p> <p>\u5728\u4e3b\u673aB\u4e2dFORWARD\u94fe\u7684\u672b\u7aef\u6dfb\u52a0\u4e00\u6761\u9ed8\u8ba4\u62d2\u7edd\u7684\u89c4\u5219\uff0c\u7136\u540e\u5c06\u201d\u653e\u884c\u89c4\u5219\u201d\u8bbe\u7f6e\u5728\u8fd9\u6761\u201d\u9ed8\u8ba4\u62d2\u7edd\u89c4\u5219\u201d\u4e4b\u524d\u5373\u53ef\u3002</p> <p>\u793a\u4f8b\u5982\u4e0b</p> <p></p> <p>\u597d\u4e86\uff0c\u914d\u7f6e\u5b8c\u4e0a\u8ff0\u89c4\u5219\u540e\uff0c\u4e3b\u673aA\u4e0e\u4e3b\u673aC\u5df2\u7ecf\u65e0\u6cd5\u901a\u8baf\u4e86\uff0c\u56e0\u4e3a\u5b83\u4eec\u4e4b\u95f4\u5982\u679c\u60f3\u8981\u901a\u8baf\uff0c\u5219\u9700\u8981\u9760\u4e3b\u673aB\u8fdb\u884c\u8f6c\u53d1\uff0c\u800c\u4e0a\u8ff0\u89c4\u5219\u8bbe\u7f6e\u5b8c\u6210\u540e\uff0c\u6240\u6709\u62a5\u6587\u90fd\u65e0\u6cd5\u901a\u8fc7FORWARD\u94fe\u4e86\uff0c\u6240\u4ee5\u4efb\u4f55\u7ecf\u8fc7\u8f6c\u53d1\u7684\u62a5\u6587\u5728\u7ecf\u8fc7FORWARD\u94fe\u65f6\u90fd\u4f1a\u88ab\u62d2\u7edd\uff0c\u5916\u90e8\u4e3b\u673a\u7684\u62a5\u6587\u65e0\u6cd5\u8f6c\u53d1\u5230\u5185\u90e8\u4e3b\u673a\u4e2d\uff0c\u5185\u90e8\u7f51\u4e3b\u673a\u7684\u62a5\u6587\u4e5f\u65e0\u6cd5\u8f6c\u53d1\u5230\u5916\u90e8\u4e3b\u673a\u4e2d\uff0c\u56e0\u4e3a\u4e3b\u673aB\u5df2\u7ecf\u62d2\u7edd\u8f6c\u53d1\u6240\u6709\u62a5\u6587\u3002</p> <p>\u73b0\u5728\uff0c\u6211\u4eec\u540c\u65f6\u5c06A\u4e3b\u673a\u4e0eC\u4e3b\u673a\u4e2d\u7684web\u670d\u52a1\u542f\u52a8\uff0c\u4ee5\u4fbf\u8fdb\u884c\u6d4b\u8bd5\u3002</p> <p>\u9996\u5148\uff0c\u6211\u4eec\u542f\u52a8A\u4e3b\u673a\u7684httpd\u670d\u52a1</p> <p></p> <p>\u540c\u65f6\uff0c\u542f\u52a8C\u4e3b\u673a\u7684httpd\u670d\u52a1</p> <p></p> <p>\u7531\u4e8e\u521a\u624d\u5df2\u7ecf\u5728\u4e3b\u673aB\u4e2d\u8bbe\u7f6e\u4e86\u9ed8\u8ba4\u62d2\u7edd\u7684\u89c4\u5219\uff0c\u6240\u4ee5\u6b64\u523b\uff0cA\u4e3b\u673a\u65e0\u6cd5\u8bbf\u95eeC\u4e3b\u673a\u7684web\u670d\u52a1\uff0cC\u4e3b\u673a\u540c\u6837\u65e0\u6cd5\u8bbf\u95eeA\u4e3b\u673a\u7684web\u670d\u52a1\u3002</p> <p>\u90a3\u4e48\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8981\u4f7f\u5185\u90e8\u7684\u4e3b\u673a\u80fd\u591f\u8bbf\u95ee\u5916\u90e8\u4e3b\u673a\u7684web\u670d\u52a1\uff0c\u6211\u4eec\u5e94\u8be5\u600e\u6837\u505a\u5462\uff1f\u6ca1\u9519\uff0c\u6211\u4eec\u9700\u8981\u5728FORWARD\u94fe\u4e2d\u653e\u884c\u5185\u90e8\u4e3b\u673a\u5bf9\u5916\u90e8\u4e3b\u673a\u7684web\u8bf7\u6c42\uff0c\u53ea\u9700\u5982\u4e0b\u914d\u7f6e\u5373\u53ef\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u9632\u706b\u5899\u653e\u884c\u4e86\u5185\u90e8\u4e3b\u673a\u7684web\u8bf7\u6c42\uff0c\u56e0\u4e3a\u6211\u4eec\u5c06\u6765\u81ea\u5185\u90e8\u7f51\u7edc\u4e2d\u76ee\u6807\u7aef\u53e3\u4e3a80\u7684\u62a5\u6587\u90fd\u653e\u884c\u4e86\uff0c\u90a3\u4e48\u6b64\u65f6\uff0c\u6211\u4eec\u5728C\u4e3b\u673a\u4e0a\u8bbf\u95eeA\u4e3b\u673a\u7684web\u670d\u52a1\u8bd5\u8bd5</p> <p>\u6b64\u65f6\uff0c\u5728\u4e3b\u673aC\u4e0a\u8bbf\u95ee\u4e3b\u673aA\u7684web\u670d\u52a1\uff0c\u5982\u4e0b</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e3b\u673aC\u5e76\u65e0\u6cd5\u8bbf\u95ee\u5230\u4e3b\u673aA\u4e0a\u7684web\u670d\u52a1\uff0c\u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f</p> <p>\u806a\u660e\u5982\u4f60\u80af\u5b9a\u5df2\u7ecf\u60f3\u5230\u4e86\uff0c\u6211\u4eec\u53ea\u5728\u4e3b\u673aB\u4e0a\u653e\u884c\u4e86\u5185\u90e8\u4e3b\u673a\u8bbf\u95ee80\u7aef\u53e3\u7684\u8bf7\u6c42\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u653e\u884c\u5916\u90e8\u4e3b\u673a\u7684\u56de\u5e94\u62a5\u6587\uff0c\u867d\u7136\u5185\u90e8\u4e3b\u673a\u7684\u8bf7\u6c42\u80fd\u591f\u901a\u8fc7\u9632\u706b\u5899\u4e3b\u673aB\u8f6c\u53d1\u51fa\u53bb\uff0c\u4f46\u662f\u56de\u5e94\u7684\u62a5\u6587\u5219\u65e0\u6cd5\u8fdb\u5165\u9632\u706b\u5899\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u4ecd\u7136\u9700\u8981\u5728\u4e3b\u673aB\u4e0a\u8fdb\u884c\u5982\u4e0b\u8bbe\u7f6e\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5f53\u5916\u90e8\u4e3b\u673a\u4e2d\u7684web\u670d\u52a1\u54cd\u5e94\u5185\u90e8\u4e3b\u673a\u65f6\uff0c\u76ee\u6807\u5730\u5740\u80af\u5b9a\u4e3a\u5185\u90e8\u4e3b\u673a\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u653e\u884c\u76ee\u6807IP\u5c5e\u4e8e\u5185\u90e8\u4e3b\u673a\u7f51\u6bb5\u7684\u62a5\u6587\uff0c\u6e90\u7aef\u53e3\u4e3a80\uff0c\u56e0\u4e3a\u5916\u90e8\u4e3b\u673a\u80af\u5b9a\u4f1a\u4f7f\u752880\u7aef\u53e3\u8fdb\u884c\u56de\u5e94\u3002</p> <p>\u5b8c\u6210\u4e0a\u8ff0\u914d\u7f6e\u540e\uff0c\u518d\u6b21\u56de\u5230C\u4e3b\u673a\u4e0a\uff0c\u8bbf\u95eeA\u4e3b\u673a\u7684web\u670d\u52a1\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u5df2\u7ecf\u80fd\u591f\u6b63\u5e38\u8bbf\u95ee\u4e86\u3002</p> <p></p> <p>\u4ece\u4e0a\u8ff0\u793a\u4f8b\u53ef\u4ee5\u770b\u51fa\uff0c\u5f53iptables\u4f5c\u4e3a\u201d\u7f51\u7edc\u9632\u706b\u5899\u201d\u65f6\uff0c\u5728\u914d\u7f6e\u89c4\u5219\u65f6\uff0c\u5f80\u5f80\u9700\u8981\u8003\u8651\u201d\u53cc\u5411\u6027\u201d\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u4e3a\u4e86\u8fbe\u6210\u4e00\u4e2a\u76ee\u7684\uff0c\u5f80\u5f80\u9700\u8981\u4e24\u6761\u89c4\u5219\u624d\u80fd\u5b8c\u6210\u3002</p> <p>\u90a3\u4e48\u6b64\u65f6\uff0cA\u4e3b\u673a\u80fd\u591f\u8bbf\u95eeC\u4e3b\u673a\u4e2d\u7684web\u670d\u52a1\u5417\uff1f\u6211\u60f3\u4f60\u5df2\u7ecf\u77e5\u9053\u7b54\u6848\u4e86\uff0c\u6ca1\u9519\uff0cA\u4e3b\u673a\u6b64\u65f6\u65e0\u6cd5\u8bbf\u95eeC\u4e3b\u673a\u4e2d\u7684web\u670d\u52a1\uff0c\u56e0\u4e3aB\u4e3b\u673a\u4e2d\u5e76\u6ca1\u6709\u653e\u884c\u76f8\u5173\u62a5\u6587\u3002</p> <p>\u7ed3\u5408\u4e4b\u524d\u7684\u77e5\u8bc6\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u4e0a\u8ff0\u89c4\u5219\u914d\u7f6e\u8fdb\u884c\u4f18\u5316\uff0c\u6bd4\u5982\uff0c\u4e0d\u7ba1\u662f\u7531\u5185\u800c\u5916\uff0c\u8fd8\u662f\u7531\u5916\u800c\u5185\uff0c\u53ea\u8981\u662f\u201d\u54cd\u5e94\u62a5\u6587\u201d\uff0c\u6211\u4eec\u7edf\u7edf\u653e\u884c\uff0c\u914d\u7f6e\u5982\u4e0b</p> <p>\u6ce8\uff1a\u5982\u679c\u4f60\u6ca1\u6709\u660e\u767d\u5982\u4e0b\u914d\u7f6e\u7684\u542b\u4e49\uff0c\u8bf7\u56de\u987e\u4e4b\u524d\u7684\u6587\u7ae0</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5148\u5c06\u201dweb\u54cd\u5e94\u62a5\u6587\u653e\u884c\u89c4\u5219\u201d\u5220\u9664\uff0c\u540c\u65f6\u589e\u52a0\u4e86\u4e0a\u56fe\u4e2d\u7684\u89c4\u5219\uff0c\u53ea\u9700\u8981\u5728\u7f51\u7edc\u9632\u706b\u5899\u4e3b\u673a\u7684FORWARD\u94fe\u4e2d\u6dfb\u52a0\u5982\u4e0a\u4e00\u6761\u89c4\u5219\uff0c\u5c31\u53ef\u4ee5\u5c06\u7edd\u5927\u591a\u6570\u54cd\u5e94\u62a5\u6587\u653e\u884c\u4e86\uff0c\u4e0d\u7ba1\u662f\u5916\u90e8\u54cd\u5e94\u5185\u90e8\uff0c\u8fd8\u662f\u5185\u90e8\u54cd\u5e94\u5916\u90e8\uff0c\u4e00\u6761\u89c4\u5219\u5c31\u80fd\u641e\u5b9a\uff0c\u5f53iptables\u4f5c\u4e3a\u7f51\u7edc\u9632\u706b\u5899\u65f6\uff0c\u6bcf\u6b21\u914d\u7f6e\u89c4\u5219\u65f6\u90fd\u8981\u8003\u8651\u201d\u53cc\u5411\u201d\u7684\u95ee\u9898\uff0c\u4f46\u662f\u914d\u7f6e\u5b8c\u4e0a\u8ff0\u89c4\u5219\u540e\uff0c\u6211\u4eec\u53ea\u8981\u8003\u8651\u8bf7\u6c42\u62a5\u6587\u7684\u65b9\u5411\u5c31\u884c\u4e86\uff0c\u800c\u56de\u5e94\u62a5\u6587\uff0c\u4e0a\u8ff0\u4e00\u6761\u89c4\u5219\u5c31\u80fd\u641e\u5b9a\uff0c\u8fd9\u6837\u914d\u7f6e\uff0c\u5373\u4f7f\u4ee5\u540e\u6709\u66f4\u591a\u670d\u52a1\u7684\u54cd\u5e94\u62a5\u6587\u9700\u8981\u653e\u884c\uff0c\u6211\u4eec\u4e5f\u4e0d\u7528\u518d\u53bb\u9488\u5bf9\u54cd\u5e94\u62a5\u6587\u8bbe\u7f6e\u89c4\u5219\u4e86\uff08\u5177\u4f53\u539f\u56e0\u524d\u6587\u5df2\u7ecf\u8be6\u7ec6\u7684\u603b\u7ed3\u8fc7\uff09\uff0c\u5e94\u8be5\u4f1a\u8ba9\u6211\u4eec\u7701\u53bb\u4e0d\u5c11\u89c4\u5219\u5427\u3002</p> <p>\u6bd4\u5982\uff0c\u6211\u4eec\u9664\u4e86\u60f3\u8981\u8ba9\u5185\u90e8\u4e3b\u673a\u80fd\u591f\u8bbf\u95ee\u5916\u90e8\u7684web\u670d\u52a1\uff0c\u8fd8\u60f3\u8ba9\u5185\u90e8\u4e3b\u673a\u80fd\u591f\u8bbf\u95ee\u5916\u90e8\u7684sshd\u670d\u52a1\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u5219\u53ef\u4ee5\u8fdb\u884c\u5982\u4e0b\u8bbe\u7f6e\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u6211\u4eec\u53ea\u8981\u8003\u8651\u5185\u90e8\u4e3b\u673a\u7684\u8bf7\u6c42\u65b9\u5411\u7684\u62a5\u6587\u89c4\u5219\u5373\u53ef\uff0c\u56e0\u4e3a\u54cd\u5e94\u62a5\u6587\u7684\u89c4\u5219\u5df2\u7ecf\u88ab\u4e4b\u524d\u914d\u7f6e\u7684\u89c4\u5219\u201d\u627f\u5305\u4e86\u201d\u3002</p> <p>\u6b64\u523b\uff0c\u4f7f\u7528C\u4e3b\u673a\u5373\u53ef\u8bbf\u95eeA\u4e3b\u673a\u768422\u7aef\u53e3\u3002</p> <p></p> <p>\u76ee\u524d\uff0c\u6211\u4eec\u53ea\u5141\u8bb8\u5185\u90e8\u4e3b\u673a\u8bbf\u95ee\u5916\u90e8\u4e3b\u673a\u7684web\u670d\u52a1\u4e0esshd\u670d\u52a1\uff0c\u4f46\u662f\u5916\u90e8\u4e3b\u673a\u8fd8\u65e0\u6cd5\u8bbf\u95ee\u5185\u90e8\u4e3b\u673a\u7684\u670d\u52a1\uff0c\u90a3\u4e48\u5177\u4f53\u600e\u4e48\u914d\u7f6e\u6211\u4eec\u5c31\u4e0d\u8d58\u8ff0\u4e86\uff0c\u5c31\u7531\u5ba2\u5b98\u4f60\u53bb\u8d1f\u8d23\u5b9e\u73b0\u5427\u3002</p> <p>\u5907\u6ce8\uff1a\u5728\u4e4b\u524d\u7684\u4e00\u6b21\u5b9e\u9a8c\u4e2d\uff0c\u4f7f\u7528centos6.8\u4f5c\u4e3a\u7f51\u7edc\u9632\u706b\u5899\uff0c\u51fa\u73b0\u4e86\u5373\u4f7f\u5f00\u542f\u6838\u5fc3\u8f6c\u53d1\uff0c\u4e5f\u65e0\u6cd5\u8f6c\u53d1\u62a5\u6587\u7684\u60c5\u51b5\uff0c\u5177\u4f53\u539f\u56e0\u4ecd\u672a\u67e5\u660e\uff0c\u9047\u5230\u8fc7\u7c7b\u4f3c\u573a\u666f\u7684\u670b\u53cb\u5982\u679c\u6709\u89e3\u51b3\u65b9\u6cd5\uff0c\u6b22\u8fce\u8d50\u6559\u3002</p>"},{"location":"iptables_11/#_3","title":"\u5c0f\u7ed3","text":"<p>\u4e3a\u4e86\u65b9\u4fbf\u4ee5\u540e\u56de\u987e\uff0c\u6211\u4eec\u5c06\u4e0a\u8ff0\u8fc7\u7a0b\u63d0\u70bc\u603b\u7ed3\u4e00\u4e0b\u3002</p> <pre><code>#\u5982\u679c\u60f3\u8981iptables\u4f5c\u4e3a\u7f51\u7edc\u9632\u706b\u5899\uff0ciptables\u6240\u5728\u4e3b\u673a\u5f00\u542f\u6838\u5fc3\u8f6c\u53d1\u529f\u80fd\uff0c\u4ee5\u4fbf\u80fd\u591f\u8f6c\u53d1\u62a5\u6587\u3002\n#\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u67e5\u770b\u5f53\u524d\u4e3b\u673a\u662f\u5426\u5df2\u7ecf\u5f00\u542f\u4e86\u6838\u5fc3\u8f6c\u53d1\uff0c0\u8868\u793a\u672a\u5f00\u542f\uff0c1\u8868\u793a\u5df2\u5f00\u542f\ncat /proc/sys/net/ipv4/ip_forward\n#\u4f7f\u7528\u5982\u4e0b\u4e24\u79cd\u65b9\u6cd5\u5747\u53ef\u4e34\u65f6\u5f00\u542f\u6838\u5fc3\u8f6c\u53d1\uff0c\u7acb\u5373\u751f\u6548\uff0c\u4f46\u662f\u91cd\u542f\u7f51\u7edc\u914d\u7f6e\u540e\u4f1a\u5931\u6548\u3002\n\u65b9\u6cd5\u4e00\uff1aecho 1 &gt; /proc/sys/net/ipv4/ip_forward\n\u65b9\u6cd5\u4e8c\uff1asysctl -w net.ipv4.ip_forward=1\n#\u4f7f\u7528\u5982\u4e0b\u65b9\u6cd5\u5f00\u542f\u6838\u5fc3\u8f6c\u53d1\u529f\u80fd\uff0c\u91cd\u542f\u7f51\u7edc\u670d\u52a1\u540e\u6c38\u4e45\u751f\u6548\u3002\n\u914d\u7f6e/etc/sysctl.conf\u6587\u4ef6\uff08centos7\u4e2d\u914d\u7f6e/usr/lib/sysctl.d/00-system.conf\u6587\u4ef6\uff09\uff0c\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u5c06 net.ipv4.ip_forward\u8bbe\u7f6e\u4e3a1\n\u00a0\n#\u7531\u4e8eiptables\u6b64\u65f6\u7684\u89d2\u8272\u4e3a\"\u7f51\u7edc\u9632\u706b\u5899\"\uff0c\u6240\u4ee5\u9700\u8981\u5728filter\u8868\u4e2d\u7684FORWARD\u94fe\u4e2d\u8bbe\u7f6e\u89c4\u5219\u3002\n#\u53ef\u4ee5\u4f7f\u7528\"\u767d\u540d\u5355\u673a\u5236\"\uff0c\u5148\u6dfb\u52a0\u4e00\u6761\u9ed8\u8ba4\u62d2\u7edd\u7684\u89c4\u5219\uff0c\u7136\u540e\u518d\u4e3a\u9700\u8981\u653e\u884c\u7684\u62a5\u6587\u8bbe\u7f6e\u89c4\u5219\u3002\n#\u914d\u7f6e\u89c4\u5219\u65f6\u9700\u8981\u8003\u8651\"\u65b9\u5411\u95ee\u9898\"\uff0c\u9488\u5bf9\u8bf7\u6c42\u62a5\u6587\u4e0e\u56de\u5e94\u62a5\u6587\uff0c\u8003\u8651\u62a5\u6587\u7684\u6e90\u5730\u5740\u4e0e\u76ee\u6807\u5730\u5740\uff0c\u6e90\u7aef\u53e3\u4e0e\u76ee\u6807\u7aef\u53e3\u7b49\u3002\n#\u793a\u4f8b\u4e3a\u5141\u8bb8\u7f51\u7edc\u5185\u4e3b\u673a\u8bbf\u95ee\u7f51\u7edc\u5916\u4e3b\u673a\u7684web\u670d\u52a1\u4e0esshd\u670d\u52a1\u3002\niptables -A FORWARD -j REJECT\niptables -I FORWARD -s 10.1.0.0/16 -p tcp --dport 80 -j ACCEPT\niptables -I FORWARD -d 10.1.0.0/16 -p tcp --sport 80 -j ACCEPT\niptables -I FORWARD -s 10.1.0.0/16 -p tcp --dport 22 -j ACCEPT\niptables -I FORWARD -d 10.1.0.0/16 -p tcp --sport 22 -j ACCEPT\n\u00a0\n#\u53ef\u4ee5\u4f7f\u7528state\u6269\u5c55\u6a21\u5757\uff0c\u5bf9\u4e0a\u8ff0\u89c4\u5219\u8fdb\u884c\u4f18\u5316\uff0c\u4f7f\u7528\u5982\u4e0b\u914d\u7f6e\u53ef\u4ee5\u7701\u7565\u8bb8\u591a\"\u56de\u5e94\u62a5\u6587\u653e\u884c\u89c4\u5219\"\u3002\niptables -A FORWARD -j REJECT\niptables -I FORWARD -s 10.1.0.0/16 -p tcp --dport 80 -j ACCEPT\niptables -I FORWARD -s 10.1.0.0/16 -p tcp --dport 22 -j ACCEPT\niptables -I FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT\n</code></pre> <p>\u4e00\u4e9b\u6ce8\u610f\u70b9\uff1a</p> <p>1\u3001\u5f53\u6d4b\u8bd5\u7f51\u7edc\u9632\u706b\u5899\u65f6\uff0c\u9ed8\u8ba4\u524d\u63d0\u4e3a\u7f51\u7edc\u5df2\u7ecf\u6b63\u786e\u914d\u7f6e\u3002</p> <p>2\u3001\u5f53\u6d4b\u8bd5\u7f51\u7edc\u9632\u706b\u5899\u65f6\uff0c\u5982\u679c\u51fa\u73b0\u95ee\u9898\uff0c\u8bf7\u5148\u786e\u5b9a\u4e3b\u673a\u9632\u706b\u5899\u89c4\u5219\u7684\u914d\u7f6e\u6ca1\u6709\u95ee\u9898\u3002</p>"},{"location":"iptables_12/","title":"iptables\u8be6\u89e3\uff0812\uff09\uff1aiptables\u52a8\u4f5c\u603b\u7ed3\u4e4b\u4e00","text":"<p>\u5728\u672c\u535a\u5ba2\u4e2d\uff0c\u4ece\u7406\u8bba\u5230\u5b9e\u8df5\uff0c\u7cfb\u7edf\u7684\u4ecb\u7ecd\u4e86iptables\uff0c\u5982\u679c\u4f60\u60f3\u8981\u4ece\u5934\u5f00\u59cb\u4e86\u89e3iptables\uff0c\u53ef\u4ee5\u67e5\u770biptables\u6587\u7ae0\u5217\u8868\uff0c\u76f4\u8fbe\u94fe\u63a5\u5982\u4e0b</p> <p>iptables\u96f6\u57fa\u7840\u5feb\u901f\u5165\u95e8\u7cfb\u5217</p> <p>\u524d\u6587\u4e00\u76f4\u5728\u4ecb\u7ecdiptables\u7684\u5339\u914d\u6761\u4ef6\uff0c\u5e76\u6ca1\u6709\u5bf9\u52a8\u4f5c\u8fdb\u884c\u8fc7\u603b\u7ed3\uff0c\u90a3\u4e48\u6b64\u5904\uff0c\u6211\u4eec\u5c31\u6765\u603b\u7ed3\u4e00\u4e0biptables\u4e2d\u7684\u52a8\u4f5c\u3002</p> <p>\u4e4b\u524d\u7684\u4e3e\u4f8b\u4e2d\u5df2\u7ecf\u7528\u5230\u4e86\u4e00\u4e9b\u5e38\u7528\u52a8\u4f5c\uff0c\u6bd4\u5982ACCEPT\u3001DROP\u3001REJECT\u7b49\u3002</p> <p>\u5176\u5b9e\uff0c\u201d\u52a8\u4f5c\u201d\u4e0e\u201d\u5339\u914d\u6761\u4ef6\u201d\u4e00\u6837\uff0c\u4e5f\u6709\u201d\u57fa\u7840\u201d\u4e0e\u201d\u6269\u5c55\u201d\u4e4b\u5206\u3002</p> <p>\u540c\u6837\uff0c\u4f7f\u7528\u6269\u5c55\u52a8\u4f5c\u4e5f\u9700\u8981\u501f\u52a9\u6269\u5c55\u6a21\u5757\uff0c\u4f46\u662f\uff0c\u6269\u5c55\u52a8\u4f5c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff0c\u4e0d\u7528\u50cf\u4f7f\u7528\u201d\u6269\u5c55\u5339\u914d\u6761\u4ef6\u201d\u90a3\u6837\u6307\u5b9a\u7279\u5b9a\u7684\u6a21\u5757\u3002</p> <p>\u4e4b\u524d\u7528\u5230\u7684ACCEPT\u4e0eDROP\u90fd\u5c5e\u4e8e\u57fa\u7840\u52a8\u4f5c\u3002</p> <p>\u800cREJECT\u5219\u5c5e\u4e8e\u6269\u5c55\u52a8\u4f5c\u3002</p> <p>\u4e4b\u524d\u4e3e\u8fc7\u5f88\u591a\u4f8b\u5b50\uff0c\u6211\u4eec\u77e5\u9053\uff0c\u4f7f\u7528-j\u53ef\u4ee5\u6307\u5b9a\u52a8\u4f5c\uff0c\u6bd4\u5982</p> <p>-j ACCEPT</p> <p>-j DROP</p> <p>-j REJECT</p> <p>\u5176\u5b9e\uff0c\u201d\u52a8\u4f5c\u201d\u4e5f\u6709\u81ea\u5df1\u7684\u9009\u9879\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4f7f\u7528\u52a8\u4f5c\u65f6\uff0c\u8bbe\u7f6e\u5bf9\u5e94\u7684\u9009\u9879\uff0c\u6b64\u5904\u4ee5REJECT\u4e3a\u4f8b\uff0c\u5c55\u5f00\u4e0e\u201d\u52a8\u4f5c\u201d\u6709\u5173\u7684\u8bdd\u9898\u3002</p>"},{"location":"iptables_12/#reject","title":"\u52a8\u4f5cREJECT","text":"<p>REJECT\u52a8\u4f5c\u7684\u5e38\u7528\u9009\u9879\u4e3a\u2013reject-with</p> <p>\u4f7f\u7528\u2013reject-with\u9009\u9879\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u63d0\u793a\u4fe1\u606f\uff0c\u5f53\u5bf9\u65b9\u88ab\u62d2\u7edd\u65f6\uff0c\u4f1a\u63d0\u793a\u5bf9\u65b9\u4e3a\u4ec0\u4e48\u88ab\u62d2\u7edd\u3002</p> <p>\u53ef\u7528\u503c\u5982\u4e0b</p> <p>icmp-net-unreachable</p> <p>icmp-host-unreachable</p> <p>icmp-port-unreachable,</p> <p>icmp-proto-unreachable</p> <p>icmp-net-prohibited</p> <p>icmp-host-pro-hibited</p> <p>icmp-admin-prohibited</p> <p>\u5f53\u4e0d\u8bbe\u7f6e\u4efb\u4f55\u503c\u65f6\uff0c\u9ed8\u8ba4\u503c\u4e3aicmp-port-unreachable\u3002</p> <p>\u6211\u4eec\u6765\u52a8\u624b\u5b9e\u8df5\u4e00\u4e0b\uff0c\u5728\u4e3b\u673a139\u4e0a\u8bbe\u7f6e\u5982\u4e0b\u89c4\u5219\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5f53\u6ca1\u6709\u660e\u786e\u8bbe\u7f6e\u2013reject-with\u7684\u503c\u65f6\uff0c\u9ed8\u8ba4\u63d0\u793a\u4fe1\u606f\u4e3aicmp-port-unreachable\uff0c\u5373\u7aef\u53e3\u4e0d\u53ef\u8fbe\u4e4b\u610f\u3002</p> <p></p> <p>\u6b64\u65f6\u5728\u53e6\u4e00\u53f0\u4e3b\u673a\u4e0a\u5411\u4e3b\u673a139\u53d1\u8d77ping\u8bf7\u6c42\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u63d0\u793a\u76ee\u6807\u7aef\u53e3\u4e0d\u53ef\u8fbe\u3002</p> <p></p> <p>\u90a3\u4e48\u6211\u4eec\u5c06\u62d2\u7edd\u62a5\u6587\u7684\u63d0\u793a\u8bbe\u7f6e\u4e3a\u201d\u4e3b\u673a\u4e0d\u53ef\u8fbe\u201d\uff0c\u793a\u4f8b\u5982\u4e0b</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u6211\u4eec\u5728\u8bbe\u7f6e\u62d2\u7edd\u7684\u52a8\u4f5c\u65f6\uff0c\u4f7f\u7528\u4e86\u2013reject-with\u9009\u9879\uff0c\u5c06\u63d0\u793a\u4fe1\u606f\u8bbe\u7f6e\u4e3aicmp-host-unreachable\uff0c\u5b8c\u6210\u4e0a\u8ff0\u64cd\u4f5c\u540e\uff0c\u6211\u4eec\u518d\u6b21\u5728\u5728\u53e6\u4e00\u53f0\u4e3b\u673a\u4e0a\u5411\u4e3b\u673a139\u53d1\u8d77ping\u8bf7\u6c42\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0cping\u8bf7\u6c42\u88ab\u62d2\u7edd\u65f6\uff0c\u63d0\u793a\u4fe1\u606f\u5df2\u7ecf\u4ece\u201d\u76ee\u6807\u7aef\u53e3\u4e0d\u53ef\u8fbe\u201d\u53d8\u6210\u4e86\u201d\u76ee\u6807\u4e3b\u673a\u4e0d\u53ef\u8fbe\u201d\u3002</p>"},{"location":"iptables_12/#log","title":"\u52a8\u4f5cLOG","text":"<p>\u5728\u672c\u535a\u5ba2\u4e2d\uff0c\u524d\u6587\u5e76\u6ca1\u6709\u5bf9LOG\u52a8\u4f5c\u8fdb\u884c\u793a\u4f8b\uff0c\u6b64\u5904\u6211\u4eec\u6765\u4e86\u89e3\u4e00\u4e0bLOG\u52a8\u4f5c\u3002</p> <p>\u4f7f\u7528LOG\u52a8\u4f5c\uff0c\u53ef\u4ee5\u5c06\u7b26\u5408\u6761\u4ef6\u7684\u62a5\u6587\u7684\u76f8\u5173\u4fe1\u606f\u8bb0\u5f55\u5230\u65e5\u5fd7\u4e2d\uff0c\u4f46\u5f53\u524d\u62a5\u6587\u5177\u4f53\u662f\u88ab\u201d\u63a5\u53d7\u201d\uff0c\u8fd8\u662f\u88ab\u201d\u62d2\u7edd\u201d\uff0c\u90fd\u7531\u540e\u9762\u7684\u89c4\u5219\u63a7\u5236\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0cLOG\u52a8\u4f5c\u53ea\u8d1f\u8d23\u8bb0\u5f55\u5339\u914d\u5230\u7684\u62a5\u6587\u7684\u76f8\u5173\u4fe1\u606f\uff0c\u4e0d\u8d1f\u8d23\u5bf9\u62a5\u6587\u7684\u5176\u4ed6\u5904\u7406\uff0c\u5982\u679c\u60f3\u8981\u5bf9\u62a5\u6587\u8fdb\u884c\u8fdb\u4e00\u6b65\u7684\u5904\u7406\uff0c\u53ef\u4ee5\u5728\u4e4b\u540e\u8bbe\u7f6e\u5177\u4f53\u89c4\u5219\uff0c\u8fdb\u884c\u8fdb\u4e00\u6b65\u7684\u5904\u7406\u3002</p> <p>\u793a\u4f8b\u5982\u4e0b\uff0c\u4e0b\u4f8b\u8868\u793a\u5c06\u53d1\u5f8022\u53f7\u7aef\u53e3\u7684\u62a5\u6587\u76f8\u5173\u4fe1\u606f\u8bb0\u5f55\u5728\u65e5\u5fd7\u4e2d\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u4e0a\u8ff0\u89c4\u5219\u8868\u793a\u6240\u6709\u53d1\u5f8022\u53f7\u7aef\u53e3\u7684tcp\u62a5\u6587\u90fd\u7b26\u5408\u6761\u4ef6\uff0c\u6240\u4ee5\u90fd\u4f1a\u88ab\u8bb0\u5f55\u5230\u65e5\u5fd7\u4e2d\uff0c\u67e5\u770b/var/log/messages\u5373\u53ef\u770b\u5230\u5bf9\u5e94\u62a5\u6587\u7684\u76f8\u5173\u4fe1\u606f\uff0c\u4f46\u662f\u4e0a\u8ff0\u89c4\u5219\u53ea\u662f\u7528\u4e8e\u793a\u4f8b\uff0c\u56e0\u4e3a\u4e0a\u4f8b\u4e2d\u4f7f\u7528\u7684\u5339\u914d\u6761\u4ef6\u8fc7\u4e8e\u5bbd\u6cdb\uff0c\u6240\u4ee5\u5339\u914d\u5230\u7684\u62a5\u6587\u6570\u91cf\u5c06\u4f1a\u975e\u5e38\u4e4b\u591a\uff0c\u8bb0\u5f55\u5230\u7684\u4fe1\u606f\u4e5f\u4e0d\u5229\u4e8e\u5206\u6790\uff0c\u6240\u4ee5\u5728\u4f7f\u7528LOG\u52a8\u4f5c\u65f6\uff0c\u5339\u914d\u6761\u4ef6\u5e94\u8be5\u5c3d\u91cf\u5199\u7684\u7cbe\u786e\u4e00\u4e9b\uff0c\u5339\u914d\u5230\u7684\u62a5\u6587\u6570\u91cf\u4e5f\u4f1a\u5927\u5e45\u5ea6\u7684\u51cf\u5c11\uff0c\u8fd9\u6837\u5197\u4f59\u7684\u65e5\u5fd7\u4fe1\u606f\u5c31\u4f1a\u53d8\u5c11\uff0c\u540c\u65f6\u65e5\u540e\u5206\u6790\u65e5\u5fd7\u65f6\uff0c\u65e5\u5fd7\u4e2d\u7684\u4fe1\u606f\u53ef\u7528\u7a0b\u5ea6\u66f4\u9ad8\u3002</p> <p>\u6ce8\uff1a\u8bf7\u628a\u521a\u624d\u7528\u4e8e\u793a\u4f8b\u7684\u89c4\u5219\u5220\u9664\u3002</p> <p>\u4ece\u521a\u624d\u7684\u793a\u4f8b\u4e2d\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\u5230\uff0cLOG\u52a8\u4f5c\u4f1a\u5c06\u62a5\u6587\u7684\u76f8\u5173\u4fe1\u606f\u8bb0\u5f55\u5728/var/log/message\u6587\u4ef6\u4e2d\uff0c\u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c06\u76f8\u5173\u4fe1\u606f\u8bb0\u5f55\u5728\u6307\u5b9a\u7684\u6587\u4ef6\u4e2d\uff0c\u4ee5\u9632\u6b62iptables\u7684\u76f8\u5173\u4fe1\u606f\u4e0e\u5176\u4ed6\u65e5\u5fd7\u4fe1\u606f\u76f8\u6df7\u6dc6\uff0c\u4fee\u6539/etc/rsyslog.conf\u6587\u4ef6\uff08\u6216\u8005/etc/syslog.conf\uff09\uff0c\u5728rsyslog\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\u5373\u53ef\u3002</p>"},{"location":"iptables_12/#vim-etcrsyslogconf","title":"vim /etc/rsyslog.conf","text":"<p>kern.warning /var/log/iptables.log</p> <p>\u52a0\u5165\u4e0a\u8ff0\u914d\u7f6e\u540e\uff0c\u62a5\u6587\u7684\u76f8\u5173\u4fe1\u606f\u5c06\u4f1a\u88ab\u8bb0\u5f55\u5230/var/log/iptables.log\u6587\u4ef6\u4e2d\u3002</p> <p>\u5b8c\u6210\u4e0a\u8ff0\u914d\u7f6e\u540e\uff0c\u91cd\u542frsyslog\u670d\u52a1\uff08\u6216\u8005syslogd\uff09</p>"},{"location":"iptables_12/#service-rsyslog-restart","title":"service rsyslog restart","text":"<p>\u670d\u52a1\u91cd\u542f\u540e\uff0c\u914d\u7f6e\u5373\u53ef\u751f\u6548\uff0c\u5339\u914d\u5230\u7684\u62a5\u6587\u7684\u76f8\u5173\u4fe1\u606f\u5c06\u88ab\u8bb0\u5f55\u5230\u6307\u5b9a\u7684\u6587\u4ef6\u4e2d\u3002</p> <p>LOG\u52a8\u4f5c\u4e5f\u6709\u81ea\u5df1\u7684\u9009\u9879\uff0c\u5e38\u7528\u9009\u9879\u5982\u4e0b\uff08\u5148\u5217\u51fa\u6982\u5ff5\uff0c\u540e\u9762\u6709\u793a\u4f8b\uff09</p> <p>\u2013log-level\u9009\u9879\u53ef\u4ee5\u6307\u5b9a\u8bb0\u5f55\u65e5\u5fd7\u7684\u65e5\u5fd7\u7ea7\u522b\uff0c\u53ef\u7528\u7ea7\u522b\u6709emerg\uff0calert\uff0ccrit\uff0cerror\uff0cwarning\uff0cnotice\uff0cinfo\uff0cdebug\u3002</p> <p>\u2013log-prefix\u9009\u9879\u53ef\u4ee5\u7ed9\u8bb0\u5f55\u5230\u7684\u76f8\u5173\u4fe1\u606f\u6dfb\u52a0\u201d\u6807\u7b7e\u201d\u4e4b\u7c7b\u7684\u4fe1\u606f\uff0c\u4ee5\u4fbf\u533a\u5206\u5404\u79cd\u8bb0\u5f55\u5230\u7684\u62a5\u6587\u4fe1\u606f\uff0c\u65b9\u4fbf\u5728\u5206\u6790\u65f6\u8fdb\u884c\u8fc7\u6ee4\u3002</p> <p>\u6ce8\uff1a\u2013log-prefix\u5bf9\u5e94\u7684\u503c\u4e0d\u80fd\u8d85\u8fc729\u4e2a\u5b57\u7b26\u3002</p> <p>\u6bd4\u5982\uff0c\u6211\u60f3\u8981\u5c06\u4e3b\u52a8\u8fde\u63a522\u53f7\u7aef\u53e3\u7684\u62a5\u6587\u7684\u76f8\u5173\u4fe1\u606f\u90fd\u8bb0\u5f55\u5230\u65e5\u5fd7\u4e2d\uff0c\u5e76\u4e14\u628a\u8fd9\u7c7b\u8bb0\u5f55\u547d\u540d\u4e3a\u201dwant-in-from-port-22\u2033,\u5219\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4</p> <p></p> <p>\u5b8c\u6210\u4e0a\u8ff0\u914d\u7f6e\u540e\uff0c\u6211\u5728IP\u5730\u5740\u4e3a192.168.1.98\u7684\u5ba2\u6237\u7aef\u673a\u4e0a\uff0c\u5c1d\u8bd5\u4f7f\u7528ssh\u5de5\u5177\u8fde\u63a5\u4e0a\u4f8b\u4e2d\u7684\u4e3b\u673a\uff0c\u7136\u540e\u67e5\u770b\u5bf9\u5e94\u7684\u65e5\u5fd7\u6587\u4ef6\uff08\u5df2\u7ecf\u5c06\u65e5\u5fd7\u6587\u4ef6\u8bbe\u7f6e\u4e3a/var/log/iptables.log\uff09</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0cssh\u8fde\u63a5\u64cd\u4f5c\u7684\u62a5\u6587\u7684\u76f8\u5173\u4fe1\u606f\u5df2\u7ecf\u88ab\u8bb0\u5f55\u5230\u4e86iptables.log\u65e5\u5fd7\u6587\u4ef6\u4e2d\uff0c\u800c\u4e14\u8fd9\u6761\u65e5\u5fd7\u4e2d\u5305\u542b\u201d\u6807\u7b7e\u201d\uff1awant-in-from-port-22\uff0c\u5982\u679c\u6709\u5f88\u591a\u65e5\u5fd7\u8bb0\u5f55\uff0c\u6211\u4eec\u5c31\u80fd\u901a\u8fc7\u8fd9\u4e2a\u201d\u6807\u7b7e\u201d\u8fdb\u884c\u7b5b\u9009\u4e86\uff0c\u8fd9\u6837\u65b9\u4fbf\u6211\u4eec\u67e5\u770b\u65e5\u5fd7\uff0c\u540c\u65f6\uff0c\u4ece\u4e0a\u8ff0\u8bb0\u5f55\u4e2d\u8fd8\u80fd\u591f\u5f97\u77e5\u62a5\u6587\u7684\u6e90IP\u4e0e\u76ee\u6807IP\uff0c\u6e90\u7aef\u53e3\u4e0e\u76ee\u6807\u7aef\u53e3\u7b49\u4fe1\u606f\uff0c\u4ece\u4e0a\u8ff0\u65e5\u5fd7\u6211\u4eec\u80fd\u591f\u770b\u51fa\uff0c192.168.1.98\u8fd9\u4e2aIP\u60f3\u8981\u572814\u70b911\u5206\u8fde\u63a5\u5230192.168.1.139\uff08\u5f53\u524d\u4e3b\u673a\u7684IP\uff09\u768422\u53f7\u7aef\u53e3\uff0c\u62a5\u6587\u7531eth4\u7f51\u5361\u8fdb\u5165\uff0ceth4\u7f51\u5361\u7684MAC\u5730\u5740\u4e3a00:0C:29:B7:F4:D1\uff0c\u5ba2\u6237\u7aef\u7f51\u5361\u7684mac\u5730\u5740\u4e3aF4-8E-38-82-B1-29\u3002</p> <p>\u9664\u4e86ACCEPT\u3001DROP\u3001REJECT\u3001LOG\u7b49\u52a8\u4f5c\uff0c\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6\u7684\u5e38\u7528\u52a8\u4f5c\uff0c\u6bd4\u5982DNAT\u3001SNAT\u7b49\uff0c\u6211\u4eec\u4f1a\u5728\u4e4b\u540e\u7684\u6587\u7ae0\u4e2d\u5bf9\u5b83\u4eec\u8fdb\u884c\u603b\u7ed3\u3002</p> <p>\u5e0c\u671b\u8fd9\u7bc7\u6587\u7ae0\u80fd\u591f\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\u3002</p>"},{"location":"iptables_13/","title":"iptables\u8be6\u89e3\uff0813\uff09\uff1aiptables\u52a8\u4f5c\u603b\u7ed3\u4e4b\u4e8c","text":"<p>\u5728\u672c\u535a\u5ba2\u4e2d\uff0c\u4ece\u7406\u8bba\u5230\u5b9e\u8df5\uff0c\u7cfb\u7edf\u7684\u4ecb\u7ecd\u4e86iptables\uff0c\u5982\u679c\u4f60\u60f3\u8981\u4ece\u5934\u5f00\u59cb\u4e86\u89e3iptables\uff0c\u53ef\u4ee5\u67e5\u770biptables\u6587\u7ae0\u5217\u8868\uff0c\u76f4\u8fbe\u94fe\u63a5\u5982\u4e0b</p> <p>iptables\u96f6\u57fa\u7840\u5feb\u901f\u5165\u95e8\u7cfb\u5217</p>"},{"location":"iptables_13/#_1","title":"\u6982\u8ff0","text":"<p>\u9605\u8bfb\u8fd9\u7bc7\u6587\u7ae0\u9700\u8981\u7ad9\u5728\u524d\u6587\u7684\u57fa\u7840\u4e0a\uff0c\u5982\u679c\u4f60\u5728\u9605\u8bfb\u65f6\u9047\u5230\u969c\u788d\uff0c\u8bf7\u53c2\u8003\u4e4b\u524d\u7684\u6587\u7ae0\u3002</p> <p>\u524d\u6587\u4e2d\uff0c\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\u4e86\u5982\u4e0b\u52a8\u4f5c</p> <p>ACCEPT\u3001DROP\u3001REJECT\u3001LOG</p> <p>\u4eca\u5929\uff0c\u6211\u4eec\u6765\u8ba4\u8bc6\u51e0\u4e2a\u65b0\u52a8\u4f5c\uff0c\u5b83\u4eec\u662f\uff1a</p> <p>SNAT\u3001DNAT\u3001MASQUERADE\u3001REDIRECT</p> <p>\u5728\u8ba4\u8bc6\u5b83\u4eec\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u804a\u804aNAT\uff0c\u5982\u679c\u4f60\u5bf9NAT\u7684\u76f8\u5173\u6982\u5ff5\u5df2\u7ecf\u6eda\u74dc\u70c2\u719f\uff0c\u53ef\u4ee5\u8df3\u8fc7\u5982\u4e0b\u573a\u666f\u63cf\u8ff0\u3002</p> <p>NAT\u662fNetwork Address Translation\u7684\u7f29\u5199\uff0c\u8bd1\u4e3a\u201d\u7f51\u7edc\u5730\u5740\u8f6c\u6362\u201d\uff0cNAT\u8bf4\u767d\u4e86\u5c31\u662f\u4fee\u6539\u62a5\u6587\u7684IP\u5730\u5740\uff0cNAT\u529f\u80fd\u901a\u5e38\u4f1a\u88ab\u96c6\u6210\u5230\u8def\u7531\u5668\u3001\u9632\u706b\u5899\u3001\u6216\u72ec\u7acb\u7684NAT\u8bbe\u5907\u4e2d\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8981\u4fee\u6539\u62a5\u6587\u7684IP\u5730\u5740\u5462\uff1f\u6211\u4eec\u6765\u63cf\u8ff0\u4e00\u4e9b\u573a\u666f\uff0c\u5373\u53ef\u77e5\u9053\u4e3a\u4ec0\u4e48\u6709\u8fd9\u65b9\u9762\u7684\u9700\u6c42\u4e86\u3002</p>"},{"location":"iptables_13/#1","title":"\u573a\u666f1\uff1a","text":"<p>\u5047\u8bbe\uff0c\u7f51\u7edc\u5185\u90e8\u670910\u53f0\u4e3b\u673a\uff0c\u5b83\u4eec\u6709\u5404\u81ea\u7684IP\u5730\u5740\uff0c\u5f53\u7f51\u7edc\u5185\u90e8\u7684\u4e3b\u673a\u4e0e\u5176\u4ed6\u7f51\u7edc\u4e2d\u7684\u4e3b\u673a\u901a\u8baf\u65f6\uff0c\u5219\u4f1a\u66b4\u9732\u81ea\u5df1\u7684IP\u5730\u5740\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8981\u9690\u85cf\u8fd9\u4e9b\u4e3b\u673a\u7684IP\u5730\u5740\uff0c\u8be5\u600e\u4e48\u529e\u5462\uff1f\u53ef\u4ee5\u8fd9\u6837\u529e\uff0c\u5982\u4e0b\u3002</p> <p>\u5f53\u7f51\u7edc\u5185\u90e8\u7684\u4e3b\u673a\u5411\u7f51\u7edc\u5916\u90e8\u4e3b\u673a\u53d1\u9001\u62a5\u6587\u65f6\uff0c\u62a5\u6587\u4f1a\u7ecf\u8fc7\u9632\u706b\u5899\u6216\u8def\u7531\u5668\uff0c\u5f53\u62a5\u6587\u7ecf\u8fc7\u9632\u706b\u5899\u6216\u8def\u7531\u5668\u65f6\uff0c\u5c06\u62a5\u6587\u7684\u6e90IP\u4fee\u6539\u4e3a\u9632\u706b\u5899\u6216\u8005\u8def\u7531\u5668\u7684IP\u5730\u5740\uff0c\u5f53\u5176\u4ed6\u7f51\u7edc\u4e2d\u7684\u4e3b\u673a\u6536\u5230\u8fd9\u4e9b\u62a5\u6587\u65f6\uff0c\u663e\u793a\u7684\u6e90IP\u5730\u5740\u5219\u662f\u8def\u7531\u5668\u6216\u8005\u9632\u706b\u5899\u7684\uff0c\u800c\u4e0d\u662f\u90a310\u53f0\u4e3b\u673a\u7684IP\u5730\u5740\uff0c\u8fd9\u6837\uff0c\u5c31\u8d77\u5230\u9690\u85cf\u7f51\u7edc\u5185\u90e8\u4e3b\u673aIP\u7684\u4f5c\u7528\uff0c\u5f53\u7f51\u7edc\u5185\u90e8\u4e3b\u673a\u7684\u62a5\u6587\u7ecf\u8fc7\u8def\u7531\u5668\u65f6\uff0c\u8def\u7531\u5668\u4f1a\u7ef4\u62a4\u4e00\u5f20NAT\u8868\uff0c\u8868\u4e2d\u8bb0\u5f55\u4e86\u62a5\u6587\u6765\u81ea\u4e8e\u54ea\u4e2a\u5185\u90e8\u4e3b\u673a\u7684\u54ea\u4e2a\u8fdb\u7a0b\uff08\u5185\u90e8\u4e3b\u673aIP+\u7aef\u53e3\uff09\uff0c\u5f53\u62a5\u6587\u7ecf\u8fc7\u8def\u7531\u5668\u65f6\uff0c\u8def\u7531\u5668\u4f1a\u5c06\u62a5\u6587\u7684\u5185\u90e8\u4e3b\u673a\u6e90IP\u66ff\u6362\u4e3a\u8def\u7531\u5668\u7684IP\u5730\u5740\uff0c\u628a\u6e90\u7aef\u53e3\u4e5f\u6620\u5c04\u4e3a\u67d0\u4e2a\u7aef\u53e3\uff0cNAT\u8868\u4f1a\u628a\u8fd9\u79cd\u5bf9\u5e94\u5173\u7cfb\u8bb0\u5f55\u4e0b\u6765\u3002</p> <p>\u793a\u610f\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p>\u4e8e\u662f\uff0c\u5916\u90e8\u4e3b\u673a\u6536\u5230\u62a5\u6587\u65f6\uff0c\u6e90IP\u4e0e\u6e90\u7aef\u53e3\u663e\u793a\u7684\u90fd\u662f\u8def\u7531\u7684IP\u4e0e\u7aef\u53e3\uff0c\u5f53\u5916\u90e8\u7f51\u7edc\u4e2d\u7684\u4e3b\u673a\u8fdb\u884c\u56de\u5e94\u65f6\uff0c\u5916\u90e8\u4e3b\u673a\u5c06\u54cd\u5e94\u62a5\u6587\u53d1\u9001\u7ed9\u8def\u7531\u5668\uff0c\u8def\u7531\u5668\u6839\u636e\u521a\u624dNAT\u8868\u4e2d\u7684\u6620\u5c04\u8bb0\u5f55\uff0c\u5c06\u54cd\u5e94\u62a5\u6587\u4e2d\u7684\u76ee\u6807IP\u4e0e\u76ee\u6807\u7aef\u53e3\u518d\u6539\u4e3a\u5185\u90e8\u4e3b\u673a\u7684IP\u4e0e\u7aef\u53e3\u53f7\uff0c\u7136\u540e\u518d\u5c06\u54cd\u5e94\u62a5\u6587\u53d1\u9001\u7ed9\u5185\u90e8\u7f51\u7edc\u4e2d\u7684\u4e3b\u673a\u3002\u6574\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u5916\u90e8\u4e3b\u673a\u90fd\u4e0d\u77e5\u9053\u5185\u90e8\u4e3b\u673a\u7684IP\u5730\u5740\uff0c\u5185\u90e8\u4e3b\u673a\u8fd8\u80fd\u4e0e\u5916\u90e8\u4e3b\u673a\u901a\u8baf\uff0c\u4e8e\u662f\u8d77\u5230\u4e86\u9690\u85cf\u7f51\u7edc\u5185\u4e3b\u673aIP\u7684\u4f5c\u7528\u3002</p> <p>\u4e0a\u8ff0\u6574\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u5c31\u7528\u5230\u4e86NAT\u529f\u80fd\uff0c\u51c6\u786e\u7684\u8bf4\u662f\u7528\u5230\u4e86NAPT\u529f\u80fd\uff0cNAPT\u662fNAT\u7684\u4e00\u79cd\uff0c\u5168\u79f0\u4e3aNetwork Address Port Translation\uff0c\u8bf4\u767d\u4e86\u5c31\u662f\u6620\u5c04\u62a5\u6587IP\u5730\u5740\u7684\u540c\u65f6\u8fd8\u4f1a\u6620\u5c04\u5176\u7aef\u53e3\u53f7\uff0c\u5c31\u50cf\u521a\u624d\u63cf\u8ff0\u7684\u8fc7\u7a0b\u4e00\u6837\u3002</p> <p>\u521a\u624d\u63cf\u8ff0\u7684\u8fc7\u7a0b\u4e2d\uff0c\u201dIP\u5730\u5740\u7684\u8f6c\u6362\u201d\u4e00\u5171\u53d1\u751f\u4e86\u4e24\u6b21\u3002</p> <p>\u5185\u90e8\u7f51\u7edc\u7684\u62a5\u6587\u53d1\u9001\u51fa\u53bb\u65f6\uff0c\u62a5\u6587\u7684\u6e90IP\u4f1a\u88ab\u4fee\u6539\uff0c\u4e5f\u5c31\u662f\u6e90\u5730\u5740\u8f6c\u6362\uff1aSource Network Address Translation\uff0c\u7f29\u5199\u4e3aSNAT\u3002</p> <p>\u5916\u90e8\u7f51\u7edc\u7684\u62a5\u6587\u54cd\u5e94\u65f6\uff0c\u54cd\u5e94\u62a5\u6587\u7684\u76ee\u6807IP\u4f1a\u518d\u6b21\u88ab\u4fee\u6539\uff0c\u4e5f\u5c31\u662f\u76ee\u6807\u5730\u5740\u8f6c\u6362\uff1aDestinationnetwork\u00a0address\u00a0translation\uff0c\u7f29\u5199\u4e3aDNAT\u3002</p> <p>\u4f46\u662f\uff0c\u4e0a\u8ff0\u201d\u6574\u4e2a\u8fc7\u7a0b\u201d\u88ab\u79f0\u4e3aSNAT\uff0c\u56e0\u4e3a\u201d\u6574\u4e2a\u8fc7\u7a0b\u201d\u7684\u524d\u534a\u6bb5\u4f7f\u7528\u4e86SNAT\uff0c\u5982\u679c\u4e0a\u8ff0\u201d\u6574\u4e2a\u8fc7\u7a0b\u201d\u7684\u524d\u534a\u6bb5\u4f7f\u7528\u4e86DNAT\uff0c\u5219\u6574\u4e2a\u8fc7\u7a0b\u88ab\u79f0\u4e3aDNAT\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6574\u4e2a\u8fc7\u7a0b\u88ab\u79f0\u4e3aSNAT\u8fd8\u662fDNAT\uff0c\u53d6\u51b3\u4e8e\u6574\u4e2a\u8fc7\u7a0b\u7684\u524d\u534a\u6bb5\u4f7f\u7528\u4e86SNAT\u8fd8\u662fDNAT\u3002</p> <p>\u5176\u5b9e\u521a\u624d\u63cf\u8ff0\u7684\u573a\u666f\u4e0d\u4ec5\u4ec5\u80fd\u591f\u9690\u85cf\u7f51\u7edc\u5185\u90e8\u4e3b\u673a\u7684IP\u5730\u5740\uff0c\u8fd8\u80fd\u591f\u8ba9\u5c40\u57df\u7f51\u5185\u7684\u4e3b\u673a\u5171\u4eab\u516c\u7f51IP\uff0c\u8ba9\u4f7f\u7528\u79c1\u7f51IP\u7684\u4e3b\u673a\u80fd\u591f\u8bbf\u95ee\u4e92\u8054\u7f51\u3002</p> <p>\u6bd4\u5982\uff0c\u6574\u4e2a\u516c\u53f8\u53ea\u6709\u4e00\u4e2a\u516c\u7f51IP\uff0c\u4f46\u662f\u6574\u4e2a\u516c\u53f8\u670910\u53f0\u7535\u8111\uff0c\u6211\u4eec\u600e\u6837\u80fd\u8ba9\u8fd910\u53f0\u7535\u8111\u90fd\u8bbf\u95ee\u4e92\u8054\u7f51\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u4e3a\u8fd910\u53f0\u7535\u8111\u90fd\u914d\u7f6e\u4e0a\u5404\u81ea\u7684\u79c1\u7f51IP\uff0c\u6bd4\u5982\u201d192.168\u2033\u8fd9\u79cd\u79c1\u7f51IP\uff0c\u4f46\u662f\u4e92\u8054\u7f51\u662f\u4e0d\u4f1a\u8def\u7531\u79c1\u7f51IP\u7684\uff0c\u5982\u679c\u60f3\u8981\u8bbf\u95ee\u4e92\u8054\u7f51\uff0c\u5219\u5fc5\u987b\u4f7f\u7528\u516c\u7f51IP\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u9700\u8981\u60f3\u529e\u6cd5\uff0c\u80fd\u8ba9\u8fd910\u53f0\u4e3b\u673a\u5171\u4eab\u516c\u53f8\u4ec5\u6709\u7684\u4e00\u4e2a\u516c\u7f51IP\uff0c\u6ca1\u9519\uff0c\u8fd9\u4e0e\u521a\u624d\u63cf\u8ff0\u7684\u573a\u666f\u5176\u5b9e\u5b8c\u5168\u4e00\u81f4\uff0c\u6211\u4eec\u53ea\u8981\u5728\u8def\u7531\u5668\u4e0a\u914d\u7f6e\u516c\u7f51IP\uff0c\u5728\u79c1\u7f51\u4e3b\u673a\u8bbf\u95ee\u516c\u7f51\u670d\u52a1\u65f6\uff0c\u62a5\u6587\u7ecf\u8fc7\u8def\u7531\u5668\uff0c\u8def\u7531\u5668\u5c06\u62a5\u6587\u4e2d\u7684\u79c1\u7f51IP\u4e0e\u7aef\u53e3\u53f7\u8fdb\u884c\u4fee\u6539\u548c\u6620\u5c04\uff0c\u5c06\u5176\u6620\u5c04\u4e3a\u516c\u7f51IP\u4e0e\u7aef\u53e3\u53f7\uff0c\u8fd9\u65f6\uff0c\u5185\u7f51\u4e3b\u673a\u5373\u53ef\u5171\u4eab\u516c\u7f51IP\u8bbf\u95ee\u4e92\u8054\u7f51\u4e0a\u7684\u670d\u52a1\u4e86\uff0cNAT\u8868\u793a\u610f\u56fe\u5982\u4e0b</p> <p></p> <p>\u7efc\u4e0a\u6240\u8ff0\uff0cSNAT\u4e0d\u4ec5\u80fd\u591f\u9690\u85cf\u7f51\u5185\u7684\u4e3b\u673aIP\uff0c\u8fd8\u80fd\u591f\u5171\u4eab\u516c\u7f51IP\uff0c\u8fd9\u5728IPV4\u5730\u5740\u8f83\u4e3a\u7d27\u5f20\u7684\u4eca\u5929\uff0c\u662f\u975e\u5e38\u6709\u7528\u7684\u3002</p>"},{"location":"iptables_13/#2","title":"\u573a\u666f2\uff1a","text":"<p>\u573a\u666f1\u4e2d\uff0c\u6211\u4eec\u63cf\u8ff0\u7684\u8fc7\u7a0b\u4e3aSNAT\u7684\u8fc7\u7a0b\uff0c\u867d\u7136\u5176\u8fc7\u7a0b\u4e2d\u4e5f\u7275\u626f\u5230DNAT\uff0c\u4f46\u662f\u7531\u4e8e\u6574\u4e2a\u8fc7\u7a0b\u7684\u524d\u534a\u6bb5\u4f7f\u7528\u4e86SNAT\uff0c\u6240\u4ee5\u6574\u4e2a\u8fc7\u7a0b\u79f0\u4e4b\u4e3aSNAT\uff0c\u90a3\u4e48\u5728\u4ec0\u4e48\u60c5\u51b5\u4e0b\uff0c\u6574\u4e2a\u8fc7\u7a0b\u80fd\u79f0\u4e4b\u4e3aDNAT\u5462\uff1f</p> <p>\u6ca1\u9519\uff0c\u5f53\u6574\u4e2a\u8fc7\u7a0b\u7684\u524d\u534a\u6bb5\u4f7f\u7528\u4e86DNAT\u65f6\uff0c\u6574\u4e2a\u8fc7\u7a0b\u88ab\u79f0\u4e3aDNAT\uff0c\u5177\u4f53\u573a\u666f\u5982\u4e0b\u3002</p> <p>\u516c\u53f8\u6709\u81ea\u5df1\u7684\u5c40\u57df\u7f51\uff0c\u7f51\u7edc\u4e2d\u6709\u4e24\u53f0\u4e3b\u673a\u4f5c\u4e3a\u670d\u52a1\u5668\uff0c\u4e3b\u673a1\u63d0\u4f9bweb\u670d\u52a1\uff0c\u4e3b\u673a2\u63d0\u4f9b\u6570\u636e\u5e93\u670d\u52a1\uff0c\u4f46\u662f\u8fd9\u4e24\u53f0\u670d\u52a1\u5668\u5728\u5c40\u57df\u7f51\u4e2d\u4f7f\u7528\u79c1\u6709IP\u5730\u5740\uff0c\u53ea\u80fd\u88ab\u5c40\u57df\u7f51\u5185\u7684\u4e3b\u673a\u8bbf\u95ee\uff0c\u4e92\u8054\u7f51\u65e0\u6cd5\u8bbf\u95ee\u5230\u8fd9\u4e24\u53f0\u670d\u52a1\u5668\uff0c\u6574\u4e2a\u516c\u53f8\u53ea\u6709\u4e00\u4e2a\u53ef\u7528\u7684\u516c\u7f51IP\uff0c\u600e\u6837\u901a\u8fc7\u8fd9\u4e2a\u516c\u7f51IP\u8bbf\u95ee\u5230\u5185\u7f51\u4e2d\u7684\u8fd9\u4e9b\u670d\u52a1\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u516c\u7f51IP\u914d\u7f6e\u5230\u516c\u53f8\u7684\u67d0\u53f0\u4e3b\u673a\u6216\u8def\u7531\u5668\u4e0a\uff0c\u7136\u540e\u5bf9\u5916\u5ba3\u79f0\uff0c\u8fd9\u4e2aIP\u5730\u5740\u5bf9\u5916\u63d0\u4f9bweb\u670d\u52a1\u4e0e\u6570\u636e\u5e93\u670d\u52a1\uff0c\u4e8e\u662f\u4e92\u8054\u7f51\u4e3b\u673a\u5c06\u8bf7\u6c42\u62a5\u6587\u53d1\u9001\u7ed9\u8fd9\u516c\u7f51 IP\u5730\u5740\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6b64\u65f6\u62a5\u6587\u4e2d\u7684\u76ee\u6807IP\u4e3a\u516c\u7f51IP\uff0c\u5f53\u8def\u7531\u5668\u6536\u5230\u62a5\u6587\u540e\uff0c\u5c06\u62a5\u6587\u7684\u76ee\u6807\u5730\u5740\u6539\u4e3a\u5bf9\u5e94\u7684\u79c1\u7f51\u5730\u5740\uff0c\u6bd4\u5982\uff0c\u5982\u679c\u62a5\u6587\u7684\u76ee\u6807IP\u4e0e\u7aef\u53e3\u53f7\u4e3a\uff1a\u516c\u7f51IP+3306\uff0c\u6211\u4eec\u5c31\u5c06\u62a5\u6587\u7684\u76ee\u6807\u5730\u5740\u4e0e\u7aef\u53e3\u6539\u4e3a\uff1a\u4e3b\u673a2\u7684\u79c1\u7f51IP+3306\uff0c\u540c\u7406\uff0c\u516c\u7f51IP+80\u7aef\u53e3\u6620\u5c04\u4e3a\u4e3b\u673a1\u7684\u79c1\u7f51IP+80\u7aef\u53e3\uff0c\u5f53\u79c1\u7f51\u4e2d\u7684\u4e3b\u673a\u56de\u5e94\u5bf9\u5e94\u8bf7\u6c42\u62a5\u6587\u65f6\uff0c\u518d\u5c06\u56de\u5e94\u62a5\u6587\u7684\u6e90\u5730\u5740\u4ece\u79c1\u7f51IP+\u7aef\u53e3\u53f7\u6620\u5c04\u4e3a\u516c\u7f51IP+\u7aef\u53e3\u53f7\uff0c\u518d\u7531\u8def\u7531\u5668\u6216\u516c\u7f51\u4e3b\u673a\u53d1\u9001\u7ed9\u4e92\u8054\u7f51\u4e2d\u7684\u4e3b\u673a\u3002</p> <p>\u4e0a\u8ff0\u8fc7\u7a0b\u4e5f\u7275\u626f\u5230DNAT\u4e0eSNAT\uff0c\u4f46\u662f\u7531\u4e8e\u6574\u4e2a\u8fc7\u7a0b\u7684\u524d\u534a\u6bb5\u4f7f\u7528\u4e86DNAT\uff0c\u6240\u4ee5\u4e0a\u8ff0\u8fc7\u7a0b\u88ab\u79f0\u4e3aDNAT</p> <p>\u5176\u5b9e\uff0c\u4e0d\u7ba1\u662fSNAT\u8fd8\u662fDNAT\uff0c\u90fd\u8d77\u5230\u4e86\u9690\u85cf\u5185\u90e8\u4e3b\u673aIP\u7684\u4f5c\u7528\u3002</p>"},{"location":"iptables_13/#_2","title":"\u5b9e\u9a8c\u73af\u5883\u51c6\u5907","text":"<p>\u597d\u4e86\uff0c\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\u4e86SNAT\u4e0eDNAT\u7684\u76f8\u5173\u6982\u5ff5\uff0c\u90a3\u4e48\u73b0\u5728\uff0c\u6211\u4eec\u53ef\u4ee5\u52a8\u52a8\u624b\u4e86\uff0c\u9996\u5148\uff0c\u51c6\u5907\u4e00\u4e0b\u5b9e\u9a8c\u73af\u5883</p> <p>\u5927\u81f4\u7684\u5b9e\u9a8c\u73af\u5883\u662f\u8fd9\u6837\u7684\uff0c\u516c\u53f8\u5c40\u57df\u7f51\u4f7f\u7528\u7684\u7f51\u6bb5\u4e3a10.1.0.0/16\uff0c\u76ee\u524d\u516c\u53f8\u53ea\u6709\u4e00\u4e2a\u516c\u7f51IP\uff0c\u5c40\u57df\u7f51\u5185\u7684\u4e3b\u673a\u9700\u8981\u5171\u4eab\u8fd9\u4e2aIP\u4e0e\u4e92\u8054\u7f51\u4e0a\u7684\u4e3b\u673a\u8fdb\u884c\u901a\u8baf\u3002</p> <p>\u7531\u4e8e\u6211\u4eec\u6ca1\u6709\u771f\u6b63\u7684\u516c\u7f51IP\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u4f7f\u7528\u79c1\u7f51IP\uff1a192.168.1.146\u6a21\u62df\u6240\u8c13\u7684\u516c\u7f51IP\uff0c\u793a\u610f\u56fe\u5982\u4e0b</p> <p></p> <p>\u5982\u4e0a\u8ff0\u793a\u610f\u56fe\u6240\u793a\uff0c\u5b9e\u9a8c\u4f7f\u75284\u53f0\u865a\u62df\u673a\uff0cA\u3001B\u3001C\u3001D</p> <p>\u4e3b\u673aA\uff1a\u626e\u6f14\u516c\u7f51\u4e3b\u673a\uff0c\u5c1d\u8bd5\u8bbf\u95ee\u516c\u53f8\u63d0\u4f9b\u7684\u670d\u52a1\uff0cIP\u5730\u5740\u4e3a192.168.1.147</p> <p>\u4e3b\u673aB\uff1a\u626e\u6f14\u4e86\u62e5\u6709NAT\u529f\u80fd\u7684\u9632\u706b\u5899\u6216\u8def\u7531\u5668\uff0c\u5145\u5f53\u7f51\u5173\uff0c\u5e76\u4e14\u8d1f\u8d23NAT\uff0c\u516c\u7f51\u3001\u79c1\u7f51\u901a\u8baf\u7684\u62a5\u6587\u901a\u8fc7B\u4e3b\u673a\u65f6\uff0c\u62a5\u6587\u4f1a\u88abNAT</p> <p>\u4e3b\u673aC\uff1a\u626e\u6f14\u5185\u7f51web\u670d\u52a1\u5668</p> <p>\u4e3b\u673aD\uff1a\u626e\u6f14\u5185\u7f51windows\u4e3b\u673a</p> <p>\u4e0a\u56fe\u4e2d\u5706\u5f62\u6240\u793a\u7684\u903b\u8f91\u533a\u57df\u8868\u793a\u516c\u53f8\u5185\u7f51\uff0c\u7f51\u6bb5\u4e3a10.1.0.0/16\uff0c\u4e3b\u673aB\u3001C\u3001D\u90fd\u5c5e\u4e8e\u5185\u7f51\u4e3b\u673a\uff0c\u4e3b\u673aB\u6bd4\u8f83\u7279\u6b8a\uff0c\u540c\u65f6\u626e\u6f14\u4e86\u7f51\u5173\u4e0e\u9632\u706b\u5899\uff0c\u4e3b\u673aB\u6301\u6709\u516c\u53f8\u552f\u4e00\u7684\u516c\u7f51IP\uff08\u6211\u4eec\u7528\u4e86\u4e00\u4e2a\u5047\u7684\u516c\u7f51IP\uff09\uff0c\u5c40\u57df\u7f51\u5185\u4e3b\u673a\u5982\u679c\u60f3\u4e0e\u516c\u7f51\u4e3b\u673a\u901a\u8baf\uff0c\u9700\u8981\u5171\u4eab\u6b64\u516c\u7f51IP\uff0c\u7531B\u4e3b\u673a\u8fdb\u884cNAT\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u4e3a\u4e3b\u673aB\u51c6\u5907\u4e86\u4e24\u5757\u7f51\u5361\uff0c\u516c\u7f51IP\u4e0e\u79c1\u7f51IP\u5206\u522b\u914d\u7f6e\u5230\u8fd9\u4e24\u5757\u7f51\u5361\u4e2d\uff0c\u540c\u65f6\uff0c\u5728\u865a\u62df\u673a\u4e2d\u8bbe\u7f6e\u4e86\u4e00\u4e2a\u201d\u4ec5\u4e3b\u673a\u6a21\u5f0f\u201d\u7684\u865a\u62df\u7f51\u7edc\uff0c\u4ee5\u6a21\u62df\u516c\u53f8\u5c40\u57df\u7f51\u3002</p> <p>\u806a\u660e\u5982\u4f60\uff0c\u5e94\u8be5\u5df2\u7ecf\u53d1\u73b0\u4e86\uff0c\u4e0a\u8ff0\u5b9e\u9a8c\u73af\u5883\u4e0e\u4e4b\u524d\u63cf\u8ff0\u7684\u201d\u7f51\u7edc\u9632\u706b\u5899\u201d\u7684\u5b9e\u9a8c\u73af\u5883\u76f8\u5dee\u65e0\u51e0\uff0c\u53ea\u4e0d\u8fc7\u4e4b\u524d\u7684\u73af\u5883\u5e76\u6ca1\u6709\u516c\u7f51\uff0c\u79c1\u7f51\u7684\u6982\u5ff5\uff0c\u800c\u6b64\u523b\uff0c\u5706\u5f62\u903b\u8f91\u533a\u57df\u4e4b\u5185\u4e3a\u79c1\u7f51\uff0c\u5706\u5f62\u903b\u8f91\u533a\u57df\u4e4b\u5916\u4e3a\u516c\u7f51\u3002</p> <p>\u73af\u5883\u5177\u4f53\u51c6\u5907\u8fc7\u7a0b\u5982\u4e0b</p> <p>\u9996\u5148\uff0c\u521b\u5efa\u4e00\u4e2a\u865a\u62df\u7f51\u7edc\uff0c\u6a21\u62df\u516c\u53f8\u5185\u7f51\u3002</p> <p>\u70b9\u51fbvmware\u865a\u62df\u673a\u7684\u7f16\u8f91\u83dc\u5355\uff0c\u6253\u5f00\u201d\u865a\u62df\u7f51\u7edc\u7f16\u8f91\u5668\u201d\uff0c\u70b9\u51fb\u66f4\u6539\u8bbe\u7f6e\uff0c\u6dfb\u52a0\u201d\u4ec5\u4e3b\u673a\u6a21\u5f0f\u201d\u7684\u865a\u62df\u7f51\u7edc\uff0c\u4e0b\u56fe\u4e2d\u7684VMnet6\u4e3a\u5df2\u7ecf\u6dfb\u52a0\u8fc7\u7684\u865a\u62df\u7f51\u7edc\uff0c\u6b64\u5904\u4e0d\u518d\u91cd\u590d\u64cd\u4f5c\u3002</p> <p></p> <p>\u4e3b\u673aC\u4e0e\u4e3b\u673aD\u7684\u7f51\u5173\u90fd\u6307\u5411\u4e3b\u673aB\u7684\u79c1\u7f51IP\uff0c\u5982\u4e0b\u56fe\u6240\u793a</p> <p></p> <p></p> <p>\u4e3b\u673aB\u6709\u4e24\u5757\u7f51\u5361\uff0c\u5206\u522b\u914d\u7f6e\u4e86\u79c1\u7f51IP\u4e0e\u516c\u7f51IP\uff0c\u79c1\u7f51IP\u4e3a10.1.0.3\uff0c\u79c1\u7f51IP\u6240\u5728\u7684\u7f51\u5361\u4e5f\u5b58\u5728\u4e8evmnet6\u4e2d\uff0c\u6a21\u62df\u516c\u7f51\u7684IP\u4e3a192.168.1.146\uff0cB\u4e3b\u673a\u7684\u516c\u7f51IP\u6240\u5728\u7684\u7f51\u5361\u4e0eA\u4e3b\u673a\u90fd\u4f7f\u7528\u6865\u63a5\u6a21\u5f0f\u7684\u865a\u62df\u7f51\u7edc\uff0c\u6240\u4ee5\uff0cB\u4e3b\u673a\u65e2\u80fd\u4e0e\u79c1\u7f51\u4e3b\u673a\u901a\u8baf\uff0c\u4e5f\u80fd\u4e0e\u516c\u7f51\u4e3b\u673a\u901a\u8baf\u3002</p> <p></p> <p>\u7531\u4e8eB\u4e3b\u673a\u6b64\u65f6\u9700\u8981\u8d1f\u8d23\u5bf9\u62a5\u6587\u7684\u4fee\u6539\u4e0e\u8f6c\u53d1\uff0c\u6240\u4ee5\uff0c\u9700\u8981\u5f00\u542fB\u4e3b\u673a\u4e2d\u7684\u6838\u5fc3\u8f6c\u53d1\u529f\u80fd\uff0cLinux\u4e3b\u673a\u9ed8\u8ba4\u4e0d\u4f1a\u5f00\u542f\u6838\u5fc3\u8f6c\u53d1\uff0c\u8fd9\u5728\u524d\u6587\u4e2d\u5df2\u7ecf\u8be6\u7ec6\u7684\u63cf\u8ff0\u8fc7\uff0c\u6b64\u5904\u4e0d\u518d\u8d58\u8ff0\uff0c\u5982\u679c\u4f60\u8fd8\u4e0d\u660e\u767d\u4e3a\u4ec0\u4e48\uff0c\u8bf7\u56de\u987e\u524d\u6587\uff0c\u4f7f\u7528\u4e34\u65f6\u751f\u6548\u7684\u65b9\u6cd5\u5f00\u542fB\u4e3b\u673a\u7684\u6838\u5fc3\u8f6c\u53d1\u529f\u80fd\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>A\u4e3b\u673a\u7684IP\u5730\u5740\u5982\u4e0b\uff0c\u53ef\u4ee5\u4e0eB\u4e3b\u673a\u8fdb\u884c\u901a\u8baf\uff0c\u4f46\u662f\u4e0d\u80fd\u4e0eC\u3001D\u8fdb\u884c\u901a\u8baf\uff0c\u56e0\u4e3a\u6b64\u523b\uff0cA\u662f\u516c\u7f51\u4e3b\u673a\uff0cB\u65e2\u662f\u516c\u7f51\u4e3b\u673a\u53c8\u662f\u79c1\u7f51\u4e3b\u673a\uff0cC\u3001D\u662f\u79c1\u7f51\u7684\u4e3b\u673a\uff0cA\u662f\u4e0d\u53ef\u80fd\u8bbf\u95ee\u5230C\u548cD\u7684\u3002</p> <p></p> <p>\u4e3a\u4e86\u80fd\u591f\u66f4\u597d\u7684\u533a\u5206\u516c\u7f51\u670d\u52a1\u4e0e\u79c1\u7f51\u670d\u52a1\uff0c\u6211\u4eec\u5206\u522b\u5728\u4e3b\u673aA\u4e0e\u4e3b\u673aC\u4e0a\u542f\u52a8httpd\u670d\u52a1\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u597d\u4e86\uff0c\u5b9e\u9a8c\u73af\u5883\u51c6\u5907\u5b8c\u6bd5\uff0c\u6211\u4eec\u6765\u4e00\u8d77\u52a8\u52a8\u624b\uff0c\u5b9e\u9645\u64cd\u4f5c\u4e00\u4e0b\u3002</p>"},{"location":"iptables_13/#snat","title":"\u52a8\u4f5c\uff1aSNAT","text":"<p>\u5728\u6587\u7ae0\u5f00\u5934\u7684\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u5df2\u7ecf\u63cf\u8ff0\u8fc7\uff0c\u7f51\u7edc\u5185\u90e8\u7684\u4e3b\u673a\u53ef\u4ee5\u501f\u52a9SNAT\u9690\u85cf\u81ea\u5df1\u7684IP\u5730\u5740\uff0c\u540c\u65f6\u8fd8\u80fd\u591f\u5171\u4eab\u5408\u6cd5\u7684\u516c\u7f51IP\uff0c\u8ba9\u5c40\u57df\u7f51\u5185\u7684\u591a\u53f0\u4e3b\u673a\u5171\u4eab\u516c\u7f51IP\u8bbf\u95ee\u4e92\u8054\u7f51\u3002</p> <p>\u800c\u6b64\u65f6\u7684\u4e3b\u673aB\u5c31\u626e\u6f14\u4e86\u62e5\u6709NAT\u529f\u80fd\u7684\u8bbe\u5907\uff0c\u6211\u4eec\u4f7f\u7528iptables\u7684SNAT\u52a8\u4f5c\u8fbe\u5230\u521a\u624d\u6240\u8bf4\u7684\u76ee\u7684\u3002</p> <p>\u8fde\u63a5\u5230B\u4e3b\u673a\uff0c\u6dfb\u52a0\u5982\u4e0b\u89c4\u5219\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u4e0a\u56fe\u4e2d\u7684\u89c4\u5219\u8868\u793a\u5c06\u6765\u81ea\u4e8e10.1.0.0/16\u7f51\u6bb5\u7684\u62a5\u6587\u7684\u6e90\u5730\u5740\u6539\u4e3a\u516c\u53f8\u7684\u516c\u7f51IP\u5730\u5740\u3002</p> <p>\u201c-t nat\u201d\u8868\u793a\u64cd\u4f5cnat\u8868\uff0c\u6211\u4eec\u4e4b\u524d\u4e00\u76f4\u5728\u704c\u8f93\u4e00\u4e2a\u6982\u5ff5\uff0c\u5c31\u662f\u4e0d\u540c\u7684\u8868\u6709\u4e0d\u540c\u7684\u529f\u80fd\uff0cfilter\u8868\u7684\u529f\u80fd\u662f\u8fc7\u6ee4\uff0cnat\u8868\u7684\u529f\u80fd\u5c31\u662f\u5730\u5740\u8f6c\u6362\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5728nat\u8868\u4e2d\u5b9a\u4e49nat\u89c4\u5219\u3002</p> <p>\u201c-A POSTROUTING\u201d\u8868\u793a\u5c06SNAT\u89c4\u5219\u6dfb\u52a0\u5230POSTROUTING\u94fe\u7684\u672b\u5c3e\uff0c\u5728centos7\u4e2d\uff0cSNAT\u89c4\u5219\u53ea\u80fd\u5b58\u5728\u4e8ePOSTROUTING\u94fe\u4e0eINPUT\u94fe\u4e2d\uff0c\u5728centos6\u4e2d\uff0cSNAT\u89c4\u5219\u53ea\u80fd\u5b58\u5728\u4e8ePOSTROUTING\u94fe\u4e2d\u3002</p> <p>\u4f60\u53ef\u80fd\u4f1a\u95ee\uff0c\u4e3a\u4ec0\u4e48SNAT\u89c4\u5219\u5fc5\u987b\u5b9a\u4e49\u5728POSTROUTING\u94fe\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u8ba4\u4e3a\uff0cPOSTROUTING\u94fe\u662fiptables\u4e2d\u62a5\u6587\u53d1\u51fa\u7684\u6700\u540e\u4e00\u4e2a\u201d\u5173\u5361\u201d\uff0c\u6211\u4eec\u5e94\u8be5\u5728\u62a5\u6587\u9a6c\u4e0a\u53d1\u51fa\u4e4b\u524d\uff0c\u4fee\u6539\u62a5\u6587\u7684\u6e90\u5730\u5740\uff0c\u5426\u5219\u5c31\u518d\u4e5f\u6ca1\u6709\u673a\u4f1a\u4fee\u6539\u62a5\u6587\u7684\u6e90\u5730\u5740\u4e86\uff0c\u5728centos7\u4e2d\uff0cSNAT\u89c4\u5219\u4e5f\u53ef\u4ee5\u5b9a\u4e49\u5728INPUT\u94fe\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u7406\u89e3\uff0c\u53d1\u5f80\u672c\u673a\u7684\u62a5\u6587\u7ecf\u8fc7INPUT\u94fe\u4ee5\u540e\u62a5\u6587\u5c31\u5230\u8fbe\u4e86\u672c\u673a\uff0c\u5982\u679c\u518d\u4e0d\u4fee\u6539\u62a5\u6587\u7684\u6e90\u5730\u5740\uff0c\u5c31\u6ca1\u6709\u673a\u4f1a\u4fee\u6539\u4e86\u3002</p> <p>\u201c-s 10.1.0.0/16\u2033\u8868\u793a\u62a5\u6587\u6765\u81ea\u4e8e10.1.0.0/16\u7f51\u6bb5\uff0c\u524d\u6587\u4e2d\u4e00\u76f4\u5728\u4f7f\u7528\u8fd9\u4e2a\u5339\u914d\u6761\u4ef6\uff0c\u6211\u60f3\u6b64\u5904\u5e94\u8be5\u4e0d\u7528\u8d58\u8ff0\u4e86\u3002</p> <p>\u201c-j SNAT\u201d\u8868\u793a\u4f7f\u7528SNAT\u52a8\u4f5c\uff0c\u5bf9\u5339\u914d\u5230\u7684\u62a5\u6587\u8fdb\u884c\u5904\u7406\uff0c\u5bf9\u5339\u914d\u5230\u7684\u62a5\u6587\u8fdb\u884c\u6e90\u5730\u5740\u8f6c\u6362\u3002</p> <p>\u201c\u2013to-source 192.168.1.146\u2033\u8868\u793a\u5c06\u5339\u914d\u5230\u7684\u62a5\u6587\u7684\u6e90IP\u4fee\u6539\u4e3a192.168.1.146\uff0c\u524d\u6587\u4e2d\uff0c\u6211\u4eec\u5df2\u7ecf\u603b\u7ed3\u8fc7\uff0c\u67d0\u4e9b\u52a8\u4f5c\u4f1a\u6709\u81ea\u5df1\u7684\u9009\u9879\uff0c\u201d\u2013to-source\u201d\u5c31\u662fSNAT\u52a8\u4f5c\u7684\u5e38\u7528\u9009\u9879\uff0c\u7528\u4e8e\u6307\u5b9aSNAT\u9700\u8981\u5c06\u62a5\u6587\u7684\u6e90IP\u4fee\u6539\u4e3a\u54ea\u4e2aIP\u5730\u5740\u3002</p> <p>\u597d\u4e86\uff0c\u53ea\u8981\u7ad9\u5728\u524d\u6587\u7684\u57fa\u7840\u4e0a\uff0c\u7406\u89e3\u4e0a\u8ff0\u8bed\u53e5\u5e94\u8be5\u662f\u5206\u5206\u949f\u7684\u4e8b\u60c5\uff0c\u806a\u660e\u5982\u4f60\u5e94\u8be5\u5df2\u7ecf\u5b66\u4f1a\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u6765\u6d4b\u8bd5\u4e00\u4e0b\u3002</p> <p>\u76ee\u524d\u6765\u8bf4\uff0c\u6211\u4eec\u53ea\u914d\u7f6e\u4e86\u4e00\u6761SNAT\u89c4\u5219\uff0c\u5e76\u6ca1\u6709\u8bbe\u7f6e\u4efb\u4f55DNAT\uff0c\u73b0\u5728\uff0c\u6211\u4eec\u4ece\u5185\u7f51\u4e3b\u673a\u4e0aping\u5916\u7f51\u4e3b\u673a\uff0c\u770b\u770b\u80fd\u4e0d\u80fdping\u901a\uff0c\u767b\u5f55\u5185\u7f51\u4e3b\u673aC\uff0c\u5728C\u4e3b\u673a\u4e0a\u5411A\u4e3b\u673a\u7684\u5916\u7f51IP\u53d1\u9001ping\u8bf7\u6c42(\u5047\u5916\u7f51IP)\uff0c\u793a\u4f8b\u5982\u4e0b</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u201d\u5185\u7f51\u4e3b\u673a\u201d\u5df2\u7ecf\u53ef\u4ee5\u4f9d\u9760SNAT\u8bbf\u95ee\u201d\u4e92\u8054\u7f51\u201d\u4e86\u3002</p> <p>\u4e3a\u4e86\u66f4\u52a0\u6e05\u6670\u7684\u7406\u89e3\u6574\u4e2aSNAT\u8fc7\u7a0b\uff0c\u5728C\u4e3b\u673a\u4e0a\u6293\u5305\u770b\u770b\uff0c\u67e5\u770b\u4e00\u4e0b\u8bf7\u6c42\u62a5\u6587\u4e0e\u54cd\u5e94\u62a5\u6587\u7684IP\u5730\u5740\uff0c\u5982\u4e0b\uff0c\u5728C\u4e3b\u673a\u4e0a\u540c\u65f6\u6253\u5f00\u4e24\u4e2a\u547d\u4ee4\u7a97\u53e3\uff0c\u4e00\u4e2a\u547d\u4ee4\u7a97\u53e3\u4e2d\u5411A\u4e3b\u673a\u53d1\u9001ping\u8bf7\u6c42\uff0c\u53e6\u4e00\u4e2a\u7a97\u53e3\u4e2d\uff0c\u4f7f\u7528tcpdump\u547d\u4ee4\u5bf9\u6307\u5b9a\u7684\u7f51\u5361\u8fdb\u884c\u6293\u5305\uff0c\u6293\u53d6icmp\u534f\u8bae\u7684\u5305\u3002</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c10.1.0.1\u53d1\u51faping\u5305\uff0c192.168.1.147\u8fdb\u884c\u56de\u5e94\uff0c\u6b63\u662fA\u4e3b\u673a\u7684IP\u5730\u5740\uff08\u7528\u4e8e\u6a21\u62df\u516c\u7f51IP\u7684IP\u5730\u5740\uff09</p> <p>\u770b\u6765\uff0c\u53ea\u662f\u7528\u4e8e\u914d\u7f6eSNAT\u7684\u8bdd\uff0c\u6211\u4eec\u5e76\u4e0d\u7528 \u624b\u52a8\u7684\u8fdb\u884cDNAT\u8bbe\u7f6e\uff0ciptables\u4f1a\u81ea\u52a8\u7ef4\u62a4NAT\u8868\uff0c\u5e76\u5c06\u54cd\u5e94\u62a5\u6587\u7684\u76ee\u6807\u5730\u5740\u8f6c\u6362\u56de\u6765\u3002</p> <p>\u90a3\u4e48\uff0c\u6211\u4eec\u53bbA\u4e3b\u673a\u4e0a\u518d\u6b21\u91cd\u590d\u4e00\u904d\u521a\u624d\u7684\u64cd\u4f5c\uff0c\u5728A\u4e3b\u673a\u4e0a\u6293\u5305\u770b\u770b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0cC\u4e3b\u673a\u4e0a\u7ee7\u7eed\u5411A\u4e3b\u673a\u7684\u516c\u7f51IP\u53d1\u9001ping\u8bf7\u6c42\uff0c\u5728\u4e3b\u673aA\u7684\u7f51\u5361\u4e0a\u6293\u5305\u770b\u770b\u3002</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff0cC\u4e3b\u673a\u5411A\u4e3b\u673a\u53d1\u8d77ping\u8bf7\u6c42\u65f6\u5f97\u5230\u4e86\u56de\u5e94\uff0c\u4f46\u662f\u5728A\u4e3b\u673a\u4e0a\uff0c\u5e76\u4e0d\u77e5\u9053\u662fC\u4e3b\u673a\u53d1\u6765\u7684ping\u8bf7\u6c42\uff0cA\u4e3b\u673a\u4ee5\u4e3a\u662fB\u4e3b\u673a\u53d1\u6765\u7684ping\u8bf7\u6c42\uff0c\u4ece\u6293\u5305\u7684\u4fe1\u606f\u6765\u770b\uff0cA\u4e3b\u673a\u4ee5\u4e3aB\u4e3b\u673a\u901a\u8fc7\u516c\u7f51IP\uff1a192.168.1.146\u5411\u81ea\u5df1\u53d1\u8d77\u4e86ping\u8bf7\u6c42\uff0c\u800cA\u4e3b\u673a\u4e5f\u5c06\u54cd\u5e94\u62a5\u6587\u56de\u5e94\u7ed9\u4e86B\u4e3b\u673a\uff0c\u6240\u4ee5\uff0c\u6574\u4e2a\u8fc7\u7a0b\uff0cA\u4e3b\u673a\u90fd\u4e0d\u77e5\u9053C\u4e3b\u673a\u7684\u5b58\u5728\uff0c\u90fd\u4ee5\u4e3a\u662fB\u4e3b\u673a\u5728\u5411\u81ea\u5df1\u53d1\u9001\u8bf7\u6c42\uff0c\u5373\u4f7f\u4e0d\u662f\u5728\u516c\u7f51\u79c1\u7f51\u7684\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u4e5f\u80fd\u591f\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\uff0c\u9690\u85cf\u7f51\u7edc\u5185\u7684\u4e3b\u673a\uff0c\u53ea\u4e0d\u8fc7\u6b64\u5904\uff0c\u6211\u4eec\u6240\u63cf\u8ff0\u7684\u73af\u5883\u5c31\u662f\u79c1\u7f51\u4e3b\u673a\u5171\u4eab\u516c\u7f51IP\u8bbf\u95ee\u4e92\u8054\u7f51\uff0c\u90a3\u4e48\u53ef\u4ee5\u770b\u5230\uff0c\u79c1\u7f51\u4e2d\u7684\u4e3b\u673a\u5df2\u7ecf\u5171\u4eab\u4e86192.168.1.146\u8fd9\u4e2a\u201d\u4f2a\u516c\u7f51IP\u201d\uff0c\u90a3\u4e48\u771f\u7684\u5171\u4eab\u4e86\u5417\uff1f\u6211\u4eec\u4f7f\u7528\u5185\u7f51\u4e3b\u673aD\u8bd5\u8bd5\uff0c\u4e3b\u673aD\u662f\u4e00\u53f0windows\u865a\u62df\u673a\uff0c\u6211\u4eec\u4f7f\u7528\u5b83\u5411\u4e3b\u673aA\u53d1\u9001ping\u8bf7\u6c42\uff0c\u770b\u770b\u80fd\u4e0d\u80fdping\u901a\u3002\u5982\u4e0b</p> <p></p> <p>windows\u4e3b\u673a\u4e5fping\u901a\u4e86\u5916\u7f51\u4e3b\u673a\uff0c\u5728A\u4e3b\u673a\u4e0a\u6293\u5305\uff0c\u770b\u5230\u7684\u4ecd\u7136\u662fB\u4e3b\u673a\u7684IP\u5730\u5740\u3002</p> <p></p> <p>\u90a3\u4e48\uff0cC\u4e3b\u673a\u4e0eD\u4e3b\u673a\u80fd\u591f\u8bbf\u95ee\u5916\u7f51\u670d\u52a1\u5417\uff1f\u6211\u4eec\u6765\u770b\u770b\u3002</p> <p>\u5728C\u4e3b\u673a\u4e0a\u8bbf\u95eeA\u4e3b\u673a\u7684web\u670d\u52a1\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u8bbf\u95ee\u6b63\u5e38\u3002</p> <p></p> <p>\u540c\u7406\uff0c\u5728windows\u4e3b\u673a\u4e2d\u8bbf\u95eeA\u4e3b\u673a\u7684web\u670d\u52a1\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u8bbf\u95ee\u6b63\u5e38\u3002</p> <p></p> <p>\u597d\u4e86\uff0c\u6e90\u5730\u5740\u8f6c\u6362\uff0c\u5df2\u7ecf\u5b8c\u6210\u4e86\uff0c\u6211\u4eec\u53ea\u4f9d\u9760\u4e86\u4e00\u6761iptables\u89c4\u5219\uff0c\u5c31\u80fd\u591f\u4f7f\u5185\u7f51\u4e3b\u673a\u80fd\u591f\u5171\u4eab\u516c\u7f51IP\u8bbf\u95ee\u4e92\u8054\u7f51\u4e86\u3002</p>"},{"location":"iptables_13/#dnat","title":"\u52a8\u4f5cDNAT","text":"<p>\u516c\u53f8\u53ea\u6709\u4e00\u4e2a\u516c\u7f51IP\uff0c\u4f46\u662f\u516c\u53f8\u7684\u5185\u7f51\u4e2d\u5374\u6709\u5f88\u591a\u670d\u52a1\u5668\u63d0\u4f9b\u5404\u79cd\u670d\u52a1\uff0c\u6211\u4eec\u60f3\u8981\u901a\u8fc7\u516c\u7f51\u8bbf\u95ee\u8fd9\u4e9b\u670d\u52a1\uff0c\u6539\u600e\u4e48\u529e\u5462\uff1f</p> <p>\u6ca1\u9519\uff0c\u4f7f\u7528DNAT\u5373\u53ef\uff0c\u6211\u4eec\u5bf9\u5916\u5ba3\u79f0\uff0c\u516c\u53f8\u7684\u516c\u7f51IP\u4e0a\u65e2\u63d0\u4f9b\u4e86web\u670d\u52a1\uff0c\u4e5f\u63d0\u4f9b\u4e86windows\u8fdc\u7a0b\u684c\u9762\uff0c\u4e0d\u7ba1\u662f\u8bbf\u95eeweb\u670d\u52a1\u8fd8\u662f\u8fdc\u7a0b\u684c\u9762\uff0c\u53ea\u8981\u8bbf\u95ee\u8fd9\u4e2a\u516c\u7f51IP\u5c31\u884c\u4e86\uff0c\u6211\u4eec\u5229\u7528DNAT\uff0c\u5c06\u516c\u7f51\u5ba2\u6237\u7aef\u53d1\u9001\u8fc7\u6765\u7684\u62a5\u6587\u7684\u76ee\u6807\u5730\u5740\u4e0e\u7aef\u53e3\u53f7\u505a\u4e86\u6620\u5c04\uff0c\u5c06\u8bbf\u95eeweb\u670d\u52a1\u7684\u62a5\u6587\u8f6c\u53d1\u5230\u4e86\u5185\u7f51\u4e2d\u7684C\u4e3b\u673a\u4e2d\uff0c\u5c06\u8bbf\u95ee\u8fdc\u7a0b\u684c\u9762\u7684\u62a5\u6587\u8f6c\u53d1\u5230\u4e86\u5185\u7f51\u4e2d\u7684D\u4e3b\u673a\u4e2d\u3002</p> <p>\u597d\u4e86\uff0c\u7406\u8bba\u8bf4\u5b8c\u4e86\uff0c\u6765\u52a8\u624b\u5b9e\u8df5\u4e00\u4e0b\u3002</p> <p>\u5982\u4e0b\u914d\u7f6e\u7531 [ \u8fd0\u7ef4\u5de5\u7a0b\u5e08 \u738b\u5723\u6770 ] \u00a0\u63d0\u4f9b\uff0c\u6211\u4eec\u4e00\u8d77\u6765\u8ba8\u8bba\u4e00\u4e0b\u3002</p> <p>\u5982\u679c\u6211\u4eec\u60f3\u8981\u5b9e\u73b0\u521a\u624d\u63cf\u8ff0\u7684\u573a\u666f\uff0c\u5219\u9700\u8981\u5728B\u4e3b\u673a\u4e2d\u8fdb\u884c\u5982\u4e0b\u914d\u7f6e\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u6211\u4eec\u5148\u5c06nat\u8868\u4e2d\u7684\u89c4\u5219\u6e05\u7a7a\u4e86\uff0c\u4ece\u5934\u6765\u8fc7\uff0c\u6e05\u7a7anat\u8868\u89c4\u5219\u540e\uff0c\u5b9a\u4e49\u4e86\u4e00\u6761DNAT\u89c4\u5219\u3002</p> <p>\u201c-t nat -I PREROUTING\u201d\u8868\u793a\u5728nat\u8868\u4e2d\u7684PREROUTING\u94fe\u4e2d\u914d\u7f6eDNAT\u89c4\u5219\uff0cDNAT\u89c4\u5219\u53ea\u914d\u7f6e\u5728PREROUTING\u94fe\u4e0eOUTPUT\u94fe\u4e2d\u3002</p> <p>\u201c-d 192.168.1.146 -p tcp \u2013dport 3389\u2033\u8868\u793a\u62a5\u6587\u7684\u76ee\u6807\u5730\u5740\u4e3a\u516c\u53f8\u7684\u516c\u7f51IP\u5730\u5740\uff0c\u76ee\u6807\u7aef\u53e3\u4e3atcp\u76843389\u53f7\u7aef\u53e3\uff0c\u800c\u6211\u4eec\u77e5\u9053\uff0cwindows\u8fdc\u7a0b\u684c\u9762\u4f7f\u7528\u7684\u9ed8\u8ba4\u7aef\u53e3\u53f7\u5c31\u662f3389\uff0c\u5f53\u5916\u90e8\u4e3b\u673a\u8bbf\u95ee\u516c\u53f8\u516c\u7f51IP\u76843389\u53f7\u7aef\u53e3\u65f6\uff0c\u62a5\u6587\u5219\u7b26\u5408\u5339\u914d\u6761\u4ef6\u3002</p> <p>\u201c-j DNAT \u2013to-destination 10.1.0.6:3389\u2033\u8868\u793a\u5c06\u7b26\u5408\u6761\u4ef6\u7684\u62a5\u6587\u8fdb\u884cDNAT\uff0c\u4e5f\u5c31\u662f\u76ee\u6807\u5730\u5740\u8f6c\u6362\uff0c\u5c06\u7b26\u5408\u6761\u4ef6\u7684\u62a5\u6587\u7684\u76ee\u6807\u5730\u5740\u4e0e\u76ee\u6807\u7aef\u53e3\u4fee\u6539\u4e3a10.1.0.6:3389\uff0c\u201d\u2013to-destination\u201d\u5c31\u662f\u52a8\u4f5cDNAT\u7684\u5e38\u7528\u9009\u9879\u3002</p> <p>\u90a3\u4e48\u7efc\u4e0a\u6240\u8ff0\uff0c\u4e0a\u56fe\u4e2d\u5b9a\u4e49\u7684\u89c4\u5219\u7684\u542b\u4e49\u4e3a\uff0c\u5f53\u5916\u7f51\u4e3b\u673a\u8bbf\u95ee\u516c\u53f8\u516c\u7f51IP\u76843389\u65f6\uff0c\u5176\u62a5\u6587\u7684\u76ee\u6807\u5730\u5740\u4e0e\u7aef\u53e3\u5c06\u4f1a\u88ab\u6620\u5c04\u523010.1.0.6:3389\u4e0a\u3002</p> <p>\u597d\u4e86\uff0cDNAT\u89c4\u5219\u5b9a\u4e49\u5b8c\u4e86\uff0c\u73b0\u5728\u80fd\u591f\u76f4\u63a5\u4f7f\u7528\u5916\u7f51\u4e3b\u673a\u8bbf\u95ee\u79c1\u7f51\u4e2d\u7684\u670d\u52a1\u4e86\u5417\uff1f</p> <p>\u7406\u8bba\u4e0a\u53ea\u8981\u5b8c\u6210\u4e0a\u8ff0DNAT\u914d\u7f6e\u89c4\u5219\u5373\u53ef\uff0c\u4f46\u662f\u5728\u6d4b\u8bd5\u65f6\uff0c\u53ea\u914d\u7f6eDNAT\u89c4\u5219\u540e\uff0c\u5e76\u4e0d\u80fd\u6b63\u5e38DNAT\uff0c\u7ecf\u8fc7\u6d4b\u8bd5\u53d1\u73b0\uff0c\u5c06\u76f8\u5e94\u7684SNAT\u89c4\u5219\u540c\u65f6\u914d\u7f6e\u540e\uff0c\u5373\u53ef\u6b63\u5e38DNAT\uff0c\u4e8e\u662f\u6211\u4eec\u53c8\u914d\u7f6e\u4e86SNAT</p> <p>\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u6ce8\uff1a\u7406\u8bba\u4e0a\u53ea\u914d\u7f6eDNAT\u89c4\u5219\u5373\u53ef\uff0c\u4f46\u662f\u5982\u679c\u5728\u6d4b\u8bd5\u65f6\u65e0\u6cd5\u6b63\u5e38DNAT\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u914d\u7f6e\u5bf9\u5e94\u7684SNAT\uff0c\u6b64\u5904\u6309\u7167\u914d\u7f6eSNAT\u7684\u6d41\u7a0b\u8fdb\u884c\u3002</p> <p>\u6ca1\u9519\uff0c\u4e0e\u521a\u624d\u5b9a\u4e49SNAT\u65f6\u4f7f\u7528\u7684\u89c4\u5219\u5b8c\u5168\u4e00\u6837\u3002</p> <p>\u597d\u4e86\uff0c\u5b8c\u6210\u4e0a\u8ff0\u914d\u7f6e\u540e\uff0c\u6211\u4eec\u5219\u53ef\u4ee5\u901a\u8fc7B\u4e3b\u673a\u7684\u516c\u7f51IP\uff0c\u8fde\u63a5D\u4e3b\u673a\uff08windows\u4e3b\u673a\uff09\u7684\u8fdc\u7a0b\u684c\u9762\u4e86\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p>\u627e\u5230\u516c\u7f51\u4e2d\u7684\u4e00\u53f0windows\u4e3b\u673a\uff0c\u6253\u5f00\u8fdc\u7a0b\u7a0b\u5e8f</p> <p></p> <p>\u8f93\u5165\u516c\u53f8\u7684\u516c\u7f51IP\uff0c\u70b9\u51fb\u8fde\u63a5\u6309\u94ae</p> <p>\u6ce8\u610f\uff1a\u6ca1\u6709\u6307\u5b9a\u7aef\u53e3\u7684\u60c5\u51b5\u4e0b\uff0c\u9ed8\u8ba4\u4f7f\u75283389\u7aef\u53e3\u8fdb\u884c\u8fde\u63a5\uff0c\u540c\u65f6\uff0c\u4e3a\u4e86\u786e\u4fdd\u80fd\u591f\u8fde\u63a5\u5230windows\u865a\u62df\u4e3b\u673a\uff0c\u8bf7\u5c06windows\u865a\u62df\u4e3b\u673a\u8bbe\u7f6e\u4e3a\u5141\u8bb8\u8fdc\u7a0b\u8fde\u63a5\u3002</p> <p></p> <p>\u8f93\u5165\u8fdc\u7a0b\u8fde\u63a5\u7528\u6237\u7684\u5bc6\u7801\u4ee5\u540e\uff0c\u5373\u53ef\u8fde\u63a5\u5230windows\u4e3b\u673a</p> <p></p> <p>\u8fde\u63a5\u4ee5\u540e\uff0c\u8fdc\u7a0b\u8fde\u63a5\u7a0b\u5e8f\u663e\u793a\u6211\u4eec\u8fde\u63a5\u5230\u4e86\u516c\u53f8\u7684\u516c\u7f51IP\uff0c\u4f46\u662f\u5f53\u6211\u4eec\u67e5\u770bIP\u5730\u5740\u65f6\uff0c\u53d1\u73b0\u88ab\u8fdc\u7a0b\u673a\u5668\u7684IP\u5730\u5740\u5176\u5b9e\u662f\u516c\u53f8\u79c1\u7f51\u4e2d\u7684D\u4e3b\u673a\u7684IP\u5730\u5740\u3002</p> <p>\u4e0a\u56fe\u8bc1\u660e\uff0c\u6211\u4eec\u5df2\u7ecf\u6210\u529f\u7684\u901a\u8fc7\u516c\u7f51IP\u8bbf\u95ee\u5230\u4e86\u5185\u7f51\u4e2d\u7684\u670d\u52a1\u3002</p> <p>\u540c\u7406\uff0c\u4f7f\u7528\u7c7b\u4f3c\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u4e5f\u80fd\u591f\u5728\u5916\u7f51\u4e2d\u8bbf\u95ee\u5230C\u4e3b\u673a\u63d0\u4f9b\u7684web\u670d\u52a1\u3002</p> <p>\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u6211\u4eec\u5c06\u516c\u53f8\u516c\u7f51IP\u7684801\u53f7\u7aef\u53e3\u6620\u5c04\u5230\u4e86\u516c\u53f8\u5185\u7f51\u4e2dC\u4e3b\u673a\u768480\u7aef\u53e3\uff0c\u6240\u4ee5\uff0c\u5f53\u5916\u7f51\u4e3b\u673a\u8bbf\u95ee\u516c\u53f8\u516c\u7f51IP\u7684801\u7aef\u53e3\u65f6\uff0c\u62a5\u6587\u5c06\u4f1a\u53d1\u9001\u5230C\u4e3b\u673a\u768480\u7aef\u53e3\u4e0a\u3002</p> <p>\u8fd9\u6b21\uff0c\u6211\u4eec\u4e0d\u7528\u518d\u6b21\u5b9a\u4e49SNAT\u89c4\u5219\u4e86\uff0c\u56e0\u4e3a\u4e4b\u524d\u5df2\u7ecf\u5b9a\u4e49\u8fc7SNAT\u89c4\u5219\uff0c\u4e0a\u6b21\u5b9a\u4e49\u7684SNAT\u89c4\u5219\u53ea\u8981\u5b9a\u4e49\u4e00\u6b21\u5c31\u884c\uff0c\u800cDNAT\u89c4\u5219\u5219\u9700\u8981\u6839\u636e\u5b9e\u9645\u7684\u60c5\u51b5\u53bb\u5b9a\u4e49\u3002</p> <p>\u597d\u4e86\uff0c\u5b8c\u6210\u4e0a\u8ff0DNAT\u6620\u5c04\u540e\uff0c\u6211\u4eec\u5728A\u4e3b\u673a\u4e0a\u8bbf\u95eeB\u4e3b\u673a\u7684801\u7aef\u53e3\u8bd5\u8bd5\uff0c\u5982\u4e0b</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u8bbf\u95ee\u7684\u662fB\u4e3b\u673a\u7684\u516c\u7f51IP\uff0c\u4f46\u662f\u8fd4\u56de\u7ed3\u679c\u663e\u793a\u7684\u5374\u662fC\u4e3b\u673a\u63d0\u4f9b\u7684\u670d\u52a1\u5185\u5bb9\uff0c\u8bc1\u660eDNAT\u5df2\u7ecf\u6210\u529f\u3002</p> <p>\u800c\u4e0a\u8ff0\u8fc7\u7a0b\u4e2d\uff0c\u5916\u7f51\u4e3b\u673aA\u8bbf\u95ee\u7684\u59cb\u7ec8\u90fd\u662f\u516c\u53f8\u7684\u516c\u7f51IP\uff0c\u4f46\u662f\u63d0\u4f9b\u670d\u52a1\u7684\u5374\u662f\u5185\u7f51\u4e3b\u673a\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u5bf9\u5916\u5ba3\u79f0\uff0c\u516c\u7f51IP\u4e0a\u63d0\u4f9b\u4e86\u67d0\u4e9b\u670d\u52a1\uff0c\u5feb\u6765\u8bbf\u95ee\u5427\uff01</p> <p>\u6211\u89c9\u5f97\u6211\u8bf4\u660e\u767d\u4e86\uff0c\u4f60\u542c\u660e\u767d\u4e86\u5417\uff1f</p>"},{"location":"iptables_13/#masquerade","title":"\u52a8\u4f5cMASQUERADE","text":"<p>\u4e0a\u6587\u4e2d\uff0c\u6211\u4eec\u5df2\u7ecf\u63cf\u8ff0\u4e86SNAT\uff0c\u4e5f\u5c31\u662f\u6e90\u5730\u5740\u8f6c\u6362\uff0c\u90a3\u4e48\u6211\u4eec\u73b0\u5728\u6765\u8ba4\u8bc6\u4e00\u4e2a\u4e0eSNAT\u7c7b\u4f3c\u7684\u52a8\u4f5c\uff1aMASQUERADE</p> <p>\u5f53\u6211\u4eec\u62e8\u53f7\u7f51\u4e0a\u65f6\uff0c\u6bcf\u6b21\u5206\u914d\u7684IP\u5730\u5740\u5f80\u5f80\u4e0d\u540c\uff0c\u4e0d\u4f1a\u957f\u671f\u5206\u7ed9\u6211\u4eec\u4e00\u4e2a\u56fa\u5b9a\u7684IP\u5730\u5740\uff0c\u5982\u679c\u8fd9\u65f6\uff0c\u6211\u4eec\u60f3\u8981\u8ba9\u5185\u7f51\u4e3b\u673a\u5171\u4eab\u516c\u7f51IP\u4e0a\u7f51\uff0c\u5c31\u4f1a\u5f88\u9ebb\u70e6\uff0c\u56e0\u4e3a\u6bcf\u6b21IP\u5730\u5740\u53d1\u751f\u53d8\u5316\u4ee5\u540e\uff0c\u6211\u4eec\u90fd\u8981\u91cd\u65b0\u914d\u7f6eSNAT\u89c4\u5219\uff0c\u8fd9\u6837\u663e\u793a\u4e0d\u662f\u5f88\u4eba\u6027\u5316\uff0c\u6211\u4eec\u901a\u8fc7MASQUERADE\u5373\u53ef\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cMASQUERADE\u4f1a\u52a8\u6001\u7684\u5c06\u6e90\u5730\u5740\u8f6c\u6362\u4e3a\u53ef\u7528\u7684IP\u5730\u5740\uff0c\u5176\u5b9e\u4e0eSNAT\u5b9e\u73b0\u7684\u529f\u80fd\u5b8c\u5168\u4e00\u81f4\uff0c\u90fd\u662f\u4fee\u6539\u6e90\u5730\u5740\uff0c\u53ea\u4e0d\u8fc7SNAT\u9700\u8981\u6307\u660e\u5c06\u62a5\u6587\u7684\u6e90\u5730\u5740\u6539\u4e3a\u54ea\u4e2aIP\uff0c\u800cMASQUERADE\u5219\u4e0d\u7528\u6307\u5b9a\u660e\u786e\u7684IP\uff0c\u4f1a\u52a8\u6001\u7684\u5c06\u62a5\u6587\u7684\u6e90\u5730\u5740\u4fee\u6539\u4e3a\u6307\u5b9a\u7f51\u5361\u4e0a\u53ef\u7528\u7684IP\u5730\u5740\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u6211\u4eec\u6307\u5b9a\uff0c\u901a\u8fc7\u5916\u7f51\u7f51\u5361\u51fa\u53bb\u7684\u62a5\u6587\u5728\u7ecf\u8fc7POSTROUTING\u94fe\u65f6\uff0c\u4f1a\u81ea\u52a8\u5c06\u62a5\u6587\u7684\u6e90\u5730\u5740\u4fee\u6539\u4e3a\u5916\u7f51\u7f51\u5361\u4e0a\u53ef\u7528\u7684IP\u5730\u5740\uff0c\u8fd9\u65f6\uff0c\u5373\u4f7f\u5916\u7f51\u7f51\u5361\u4e2d\u7684\u516c\u7f51IP\u5730\u5740\u53d1\u751f\u4e86\u6539\u53d8\uff0c\u4e5f\u80fd\u591f\u6b63\u5e38\u7684\u3001\u52a8\u6001\u7684\u5c06\u5185\u90e8\u4e3b\u673a\u7684\u62a5\u6587\u7684\u6e90IP\u6620\u5c04\u4e3a\u5bf9\u5e94\u7684\u516c\u7f51IP\u3002</p> <p>\u53ef\u4ee5\u628aMASQUERADE\u7406\u89e3\u4e3a\u52a8\u6001\u7684\u3001\u81ea\u52a8\u5316\u7684SNAT\uff0c\u5982\u679c\u6ca1\u6709\u52a8\u6001SNAT\u7684\u9700\u6c42\uff0c\u6ca1\u6709\u5fc5\u8981\u4f7f\u7528MASQUERADE\uff0c\u56e0\u4e3aSNAT\u66f4\u52a0\u9ad8\u6548\u3002</p>"},{"location":"iptables_13/#redirect","title":"\u52a8\u4f5cREDIRECT","text":"<p>\u4f7f\u7528REDIRECT\u52a8\u4f5c\u53ef\u4ee5\u5728\u672c\u673a\u4e0a\u8fdb\u884c\u7aef\u53e3\u6620\u5c04</p> <p>\u6bd4\u5982\uff0c\u5c06\u672c\u673a\u768480\u7aef\u53e3\u6620\u5c04\u5230\u672c\u673a\u76848080\u7aef\u53e3\u4e0a</p> <p>iptables -t nat -A PREROUTING -p tcp \u2013dport 80 -j REDIRECT \u2013to-ports 8080</p> <p>\u7ecf\u8fc7\u4e0a\u8ff0\u89c4\u5219\u6620\u5c04\u540e\uff0c\u5f53\u522b\u7684\u673a\u5668\u8bbf\u95ee\u672c\u673a\u768480\u7aef\u53e3\u65f6\uff0c\u62a5\u6587\u4f1a\u88ab\u91cd\u5b9a\u5411\u5230\u672c\u673a\u76848080\u7aef\u53e3\u4e0a\u3002</p> <p>REDIRECT\u89c4\u5219\u53ea\u80fd\u5b9a\u4e49\u5728PREROUTING\u94fe\u6216\u8005OUTPUT\u94fe\u4e2d\u3002</p>"},{"location":"iptables_13/#_3","title":"\u5c0f\u7ed3","text":"<p>\u4e3a\u4e86\u65b9\u4fbf\u4ee5\u540e\u56de\u987e\uff0c\u6211\u4eec\u5bf9\u4e0a\u8ff0\u547d\u4ee4\u8fdb\u884c\u603b\u7ed3\u3002</p> <p>\u5982\u679c\u60f3\u8981NAT\u529f\u80fd\u80fd\u591f\u6b63\u5e38\u4f7f\u7528\uff0c\u9700\u8981\u5f00\u542fLinux\u4e3b\u673a\u7684\u6838\u5fc3\u8f6c\u53d1\u529f\u80fd\u3002</p> <pre><code>echo\u00a01\u00a0&gt;\u00a0/proc/sys/net/ipv4/ip_forward\n</code></pre>"},{"location":"iptables_13/#snat_1","title":"SNAT\u76f8\u5173\u64cd\u4f5c","text":"<p>\u914d\u7f6eSNAT\uff0c\u53ef\u4ee5\u9690\u85cf\u7f51\u5185\u4e3b\u673a\u7684IP\u5730\u5740\uff0c\u4e5f\u53ef\u4ee5\u5171\u4eab\u516c\u7f51IP\uff0c\u8bbf\u95ee\u4e92\u8054\u7f51\uff0c\u5982\u679c\u53ea\u662f\u5171\u4eabIP\u7684\u8bdd\uff0c\u53ea\u914d\u7f6e\u5982\u4e0bSNAT\u89c4\u5219\u5373\u53ef\u3002</p> <pre><code>iptables\u00a0-t\u00a0nat\u00a0-A\u00a0POSTROUTING\u00a0-s\u00a010.1.0.0/16\u00a0-j\u00a0SNAT\u00a0--to-source\u00a0\u516c\u7f51IP\n</code></pre> <p>\u5982\u679c\u516c\u7f51IP\u662f\u52a8\u6001\u83b7\u53d6\u7684\uff0c\u4e0d\u662f\u56fa\u5b9a\u7684\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528MASQUERADE\u8fdb\u884c\u52a8\u6001\u7684SNAT\u64cd\u4f5c\uff0c\u5982\u4e0b\u547d\u4ee4\u8868\u793a\u5c0610.1\u7f51\u6bb5\u7684\u62a5\u6587\u7684\u6e90IP\u4fee\u6539\u4e3aeth0\u7f51\u5361\u4e2d\u53ef\u7528\u7684\u5730\u5740\u3002</p> <pre><code>iptables\u00a0-t\u00a0nat\u00a0-A\u00a0POSTROUTING\u00a0-s\u00a010.1.0.0/16\u00a0-o\u00a0eth0\u00a0-j\u00a0MASQUERADE\n</code></pre>"},{"location":"iptables_13/#dnat_1","title":"DNAT\u76f8\u5173\u64cd\u4f5c","text":"<p>\u914d\u7f6eDNAT\uff0c\u53ef\u4ee5\u901a\u8fc7\u516c\u7f51IP\u8bbf\u95ee\u5c40\u57df\u7f51\u5185\u7684\u670d\u52a1\u3002</p> <p>\u6ce8\uff1a\u7406\u8bba\u4e0a\u6765\u8bf4\uff0c\u53ea\u8981\u914d\u7f6eDNAT\u89c4\u5219\uff0c\u4e0d\u9700\u8981\u5bf9\u5e94\u7684SNAT\u89c4\u5219\u5373\u53ef\u8fbe\u5230DNAT\u6548\u679c\u3002</p> <p>\u4f46\u662f\u5728\u6d4b\u8bd5DNAT\u65f6\uff0c\u5bf9\u5e94SNAT\u89c4\u5219\u4e5f\u9700\u8981\u914d\u7f6e\uff0c\u624d\u80fd\u6b63\u5e38DNAT\uff0c\u53ef\u4ee5\u5148\u5c1d\u8bd5\u53ea\u914d\u7f6eDNAT\u89c4\u5219\uff0c\u5982\u679c\u65e0\u6cd5\u6b63\u5e38DNAT\uff0c\u518d\u5c1d\u8bd5\u6dfb\u52a0\u5bf9\u5e94\u7684SNAT\u89c4\u5219\uff0cSNAT\u89c4\u5219\u914d\u7f6e\u4e00\u6761\u5373\u53ef\uff0cDNAT\u89c4\u5219\u9700\u8981\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u914d\u7f6e\u4e0d\u540c\u7684DNAT\u89c4\u5219\u3002</p> <pre><code>iptables\u00a0-t\u00a0nat\u00a0-I\u00a0PREROUTING\u00a0-d\u00a0\u516c\u7f51IP\u00a0-p\u00a0tcp\u00a0--dport\u00a0\u516c\u7f51\u7aef\u53e3\u00a0-j\u00a0DNAT\u00a0--to-destination\u00a0\u79c1\u7f51IP:\u7aef\u53e3\u53f7\niptables\u00a0-t\u00a0nat\u00a0-I\u00a0PREROUTING\u00a0-d\u00a0\u516c\u7f51IP\u00a0-p\u00a0tcp\u00a0--dport\u00a08080\u00a0-j\u00a0DNAT\u00a0--to-destination\u00a010.1.0.1:80\niptables\u00a0-t\u00a0nat\u00a0-A\u00a0POSTROUTING\u00a0-s\u00a010.1.0.0/16\u00a0-j\u00a0SNAT\u00a0--to-source\u00a0\u516c\u7f51IP\n</code></pre> <p>\u5728\u672c\u673a\u8fdb\u884c\u76ee\u6807\u7aef\u53e3\u6620\u5c04\u65f6\u53ef\u4ee5\u4f7f\u7528REDIRECT\u52a8\u4f5c\u3002</p> <pre><code>iptables\u00a0-t\u00a0nat\u00a0-A\u00a0PREROUTING\u00a0-p\u00a0tcp\u00a0--dport\u00a080\u00a0-j\u00a0REDIRECT\u00a0--to-ports\u00a08080\n</code></pre> <p>\u914d\u7f6e\u5b8c\u6210\u4e0a\u8ff0\u89c4\u5219\u540e\uff0c\u5176\u4ed6\u673a\u5668\u8bbf\u95ee\u672c\u673a\u768480\u7aef\u53e3\u65f6\uff0c\u4f1a\u88ab\u6620\u5c04\u52308080\u7aef\u53e3\u3002</p> <p>\u597d\u4e86\uff0c\u8fd9\u7bc7\u6587\u7ae0\u5c31\u603b\u7ed3\u5230\u8fd9\u91cc\uff0c\u5e0c\u671b\u80fd\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9~~~~~</p>"},{"location":"iptables_14/","title":"iptables\u8be6\u89e3\uff0814\uff09\uff1aiptables\u5c0f\u7ed3\u4e4b\u5e38\u7528\u5957\u8def","text":"<p>\u4e0d\u77e5\u4e0d\u89c9\uff0c\u5df2\u7ecf\u603b\u7ed3\u4e8613\u7bc7IPTABLES\u6587\u7ae0\uff0c\u8fd9\u4e9b\u6587\u7ae0\u4e2d\u6709\u4e00\u4e9b\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\u3002</p> <p>\u6b64\u5904\uff0c\u6211\u4eec\u5bf9\u524d\u6587\u4e2d\u7684\u4e00\u4e9b\u6ce8\u610f\u70b9\u8fdb\u884c\u603b\u7ed3\uff0c\u6211\u4eec\u53ef\u4ee5\u7406\u89e3\u4e3a\u5bf9\u201d\u5e38\u7528\u5957\u8def\u201d\u7684\u603b\u7ed3\u3002</p> <p>\u8bb0\u4f4f\u8fd9\u4e9b\u5957\u8def\uff0c\u80fd\u8ba9\u6211\u4eec\u4e8b\u534a\u529f\u500d\u3002</p> <p>\u9605\u8bfb\u8fd9\u7bc7\u6587\u7ae0\u4e4b\u524d\uff0c\u8bf7\u786e\u5b9a\u4f60\u5df2\u7ecf\u9605\u8bfb\u4e86\u4e4b\u524d\u7684\u6587\u7ae0\uff0c\u5426\u5219\u4f60\u6709\u53ef\u80fd\u4f1a\u4e0d\u7406\u89e3\u4e3a\u4ec0\u4e48\u8981\u8fd9\u6837\u505a\u3002</p> <p></p> <p>1\u3001\u89c4\u5219\u7684\u987a\u5e8f\u975e\u5e38\u91cd\u8981\u3002</p> <p>\u5982\u679c\u62a5\u6587\u5df2\u7ecf\u88ab\u524d\u9762\u7684\u89c4\u5219\u5339\u914d\u5230\uff0cIPTABLES\u5219\u4f1a\u5bf9\u62a5\u6587\u6267\u884c\u5bf9\u5e94\u7684\u52a8\u4f5c\uff0c\u901a\u5e38\u662fACCEPT\u6216\u8005REJECT\uff0c\u62a5\u6587\u88ab\u653e\u884c\u6216\u62d2\u7edd\u4ee5\u540e\uff0c\u5373\u4f7f\u540e\u9762\u7684\u89c4\u5219\u4e5f\u80fd\u5339\u914d\u5230\u521a\u624d\u653e\u884c\u6216\u62d2\u7edd\u7684\u62a5\u6587\uff0c\u4e5f\u6ca1\u6709\u673a\u4f1a\u518d\u5bf9\u62a5\u6587\u6267\u884c\u76f8\u5e94\u7684\u52a8\u4f5c\u4e86\uff08\u524d\u9762\u89c4\u5219\u7684\u52a8\u4f5c\u4e3aLOG\u65f6\u9664\u5916\uff09\uff0c\u6240\u4ee5\uff0c\u9488\u5bf9\u76f8\u540c\u670d\u52a1\u7684\u89c4\u5219\uff0c\u66f4\u4e25\u683c\u7684\u89c4\u5219\u5e94\u8be5\u653e\u5728\u524d\u9762\u3002</p> <p>2\u3001\u5f53\u89c4\u5219\u4e2d\u6709\u591a\u4e2a\u5339\u914d\u6761\u4ef6\u65f6\uff0c\u6761\u4ef6\u4e4b\u95f4\u9ed8\u8ba4\u5b58\u5728\u201d\u4e0e\u201d\u7684\u5173\u7cfb\u3002</p> <p>\u5982\u679c\u4e00\u6761\u89c4\u5219\u4e2d\u5305\u542b\u4e86\u591a\u4e2a\u5339\u914d\u6761\u4ef6\uff0c\u90a3\u4e48\u62a5\u6587\u5fc5\u987b\u540c\u65f6\u6ee1\u8db3\u8fd9\u4e2a\u89c4\u5219\u4e2d\u7684\u6240\u6709\u5339\u914d\u6761\u4ef6\uff0c\u62a5\u6587\u624d\u80fd\u88ab\u8fd9\u6761\u89c4\u5219\u5339\u914d\u5230\u3002</p> <p>3\u3001\u5728\u4e0d\u8003\u86511\u7684\u60c5\u51b5\u4e0b\uff0c\u5e94\u8be5\u5c06\u66f4\u5bb9\u6613\u88ab\u5339\u914d\u5230\u7684\u89c4\u5219\u653e\u7f6e\u5728\u524d\u9762\u3002</p> <p>\u6bd4\u5982\uff0c\u4f60\u5199\u4e86\u4e24\u6761\u89c4\u5219\uff0c\u4e00\u6761\u9488\u5bf9sshd\u670d\u52a1\uff0c\u4e00\u6761\u9488\u5bf9web\u670d\u52a1\u3002</p> <p>\u5047\u8bbe\uff0c\u4e00\u5929\u4e4b\u5185\uff0c\u670920000\u4e2a\u8bf7\u6c42\u8bbf\u95eeweb\u670d\u52a1\uff0c\u6709200\u4e2a\u8bf7\u6c42\u8bbf\u95eesshd\u670d\u52a1\uff0c</p> <p>\u90a3\u4e48\uff0c\u5e94\u8be5\u5c06\u9488\u5bf9web\u670d\u52a1\u7684\u89c4\u5219\u653e\u5728\u524d\u9762\uff0c\u9488\u5bf9sshd\u7684\u89c4\u5219\u653e\u5728\u540e\u9762\uff0c\u56e0\u4e3a\u8bbf\u95eeweb\u670d\u52a1\u7684\u8bf7\u6c42\u9891\u7387\u66f4\u9ad8\u3002</p> <p>\u5982\u679c\u5c06sshd\u7684\u89c4\u5219\u653e\u5728\u524d\u9762\uff0c\u5f53\u62a5\u6587\u662f\u8bbf\u95eeweb\u670d\u52a1\u65f6\uff0csshd\u7684\u89c4\u5219\u4e5f\u8981\u767d\u767d\u7684\u9a8c\u8bc1\u4e00\u904d\uff0c\u7531\u4e8e\u8bbf\u95eeweb\u670d\u52a1\u7684\u9891\u7387\u66f4\u9ad8\uff0c\u767d\u767d\u8017\u8d39\u7684\u8d44\u6e90\u5c31\u66f4\u591a\u3002</p> <p>\u5982\u679cweb\u670d\u52a1\u7684\u89c4\u5219\u653e\u5728\u524d\u9762\uff0c\u7531\u4e8e\u8bbf\u95eeweb\u670d\u52a1\u7684\u9891\u7387\u66f4\u9ad8\uff0c\u6240\u4ee5\u65e0\u7528\u529f\u4f1a\u6bd4\u8f83\u5c11\u3002</p> <p>\u6362\u53e5\u8bdd\u8bf4\u5c31\u662f\uff0c\u5728\u6ca1\u6709\u987a\u5e8f\u8981\u6c42\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0d\u540c\u7c7b\u522b\u7684\u89c4\u5219\uff0c\u88ab\u5339\u914d\u6b21\u6570\u591a\u7684\u3001\u5339\u914d\u9891\u7387\u9ad8\u7684\u89c4\u5219\u5e94\u8be5\u653e\u5728\u524d\u9762\u3002</p> <p>4\u3001\u5f53IPTABLES\u6240\u5728\u4e3b\u673a\u4f5c\u4e3a\u7f51\u7edc\u9632\u706b \u5899\u65f6\uff0c\u5728\u914d\u7f6e\u89c4\u5219\u65f6\uff0c\u5e94\u7740\u91cd\u8003\u8651\u65b9\u5411\u6027\uff0c\u53cc\u5411\u90fd\u8981\u8003\u8651\uff0c\u4ece\u5916\u5230\u5185\uff0c\u4ece\u5185\u5230\u5916\u3002</p> <p>5\u3001\u5728\u914d\u7f6eIPTABLES\u767d\u540d\u5355\u65f6\uff0c\u5f80\u5f80\u4f1a\u5c06\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u8bbe\u7f6e\u4e3aACCEPT\uff0c\u901a\u8fc7\u5728\u94fe\u7684\u6700\u540e\u8bbe\u7f6eREJECT\u89c4\u5219\u5b9e\u73b0\u767d\u540d\u5355\u673a\u5236\uff0c\u800c\u4e0d\u662f\u5c06\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u8bbe\u7f6e\u4e3aDROP\uff0c\u5982\u679c\u5c06\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u8bbe\u7f6e\u4e3aDROP\uff0c\u5f53\u94fe\u4e2d\u7684\u89c4\u5219\u88ab\u6e05\u7a7a\u65f6\uff0c\u7ba1\u7406\u5458\u7684\u8bf7\u6c42\u4e5f\u5c06\u4f1a\u88abDROP\u6389\u3002</p> <p>\u597d\u4e86\uff0c\u5957\u8def\u5c31\u603b\u7ed3\u5230\u8fd9\u91cc\uff0c\u5e0c\u671b\u80fd\u591f\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\u3002</p>"},{"location":"iptables_2/","title":"iptables\u8be6\u89e3\uff082\uff09\uff1aiptables\u5b9e\u9645\u64cd\u4f5c\u4e4b\u89c4\u5219\u67e5\u8be2","text":"<p>\u5728\u9605\u8bfb\u8fd9\u7bc7\u6587\u7ae0\u4e4b\u524d\uff0c\u8bf7\u786e\u4fdd\u4f60\u5df2\u7ecf\u9605\u8bfb\u4e86\u5982\u4e0b\u6587\u7ae0\uff0c\u5982\u4e0b\u6587\u7ae0\u603b\u7ed3\u4e86iptables\u7684\u76f8\u5173\u6982\u5ff5\uff0c\u662f\u9605\u8bfb\u8fd9\u7bc7\u6587\u7ae0\u7684\u57fa\u7840\u3002</p> <p>\u56fe\u6587\u5e76\u8302\u7406\u89e3iptables</p> <p>\u5982\u679c\u4f60\u662f\u4e00\u4e2a\u65b0\u624b\uff0c\u5728\u9605\u8bfb\u5982\u4e0b\u6587\u7ae0\u65f6\uff0c\u8bf7\u575a\u6301\u8bfb\u5230\u6700\u540e\uff0c\u8bfb\u7684\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u4f1a\u6709\u969c\u788d\uff0c\u4f46\u662f\u5728\u8bfb\u5b8c\u4ee5\u540e\uff0c\u4f60\u4f1a\u53d1\u73b0\u4f60\u5df2\u7ecf\u660e\u767d\u4e86\u3002</p> <p></p> <p>\u5728\u8fdb\u884ciptables\u5b9e\u9a8c\u65f6\uff0c\u8bf7\u52a1\u5fc5\u5728\u6d4b\u8bd5\u673a\u4e0a\u8fdb\u884c\u3002</p> <p>\u4e4b\u524d\u5728iptables\u7684\u6982\u5ff5\u4e2d\u5df2\u7ecf\u63d0\u5230\u8fc7\uff0c\u5728\u5b9e\u9645\u64cd\u4f5ciptables\u7684\u8fc7\u7a0b\u4e2d\uff0c\u662f\u4ee5\u201d\u8868\u201d\u4f5c\u4e3a\u64cd\u4f5c\u5165\u53e3\u7684\uff0c\u5982\u679c\u4f60\u7ecf\u5e38\u64cd\u4f5c\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u90a3\u4e48\u5f53\u4f60\u542c\u5230\u201d\u8868\u201d\u8fd9\u4e2a\u8bcd\u7684\u65f6\u5019\uff0c\u4f60\u53ef\u80fd\u4f1a\u8054\u60f3\u5230\u53e6\u4e00\u4e2a\u8bcd\u2014-\u201c\u589e\u5220\u6539\u67e5\u201d\uff0c\u5f53\u6211\u4eec\u5b9a\u4e49iptables\u89c4\u5219\u65f6\uff0c\u6240\u505a\u7684\u64cd\u4f5c\u5176\u5b9e\u7c7b\u4f3c\u4e8e\u201d\u589e\u5220\u6539\u67e5\u201d\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u5148\u4ece\u6700\u7b80\u5355\u7684\u201d\u67e5\u201d\u64cd\u4f5c\u5165\u624b\uff0c\u5f00\u59cb\u5b9e\u9645\u64cd\u4f5ciptables\u3002</p> <p>\u5728\u4e4b\u524d\u7684\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u5df2\u7ecf\u603b\u7ed3\u8fc7\uff0ciptables\u4e3a\u6211\u4eec\u9884\u5b9a\u4e49\u4e864\u5f20\u8868\uff0c\u5b83\u4eec\u5206\u522b\u662fraw\u8868\u3001mangle\u8868\u3001nat\u8868\u3001filter\u8868\uff0c\u4e0d\u540c\u7684\u8868\u62e5\u6709\u4e0d\u540c\u7684\u529f\u80fd\u3002</p> <p>filter\u8d1f\u8d23\u8fc7\u6ee4\u529f\u80fd\uff0c\u6bd4\u5982\u5141\u8bb8\u54ea\u4e9bIP\u5730\u5740\u8bbf\u95ee\uff0c\u62d2\u7edd\u54ea\u4e9bIP\u5730\u5740\u8bbf\u95ee\uff0c\u5141\u8bb8\u8bbf\u95ee\u54ea\u4e9b\u7aef\u53e3\uff0c\u7981\u6b62\u8bbf\u95ee\u54ea\u4e9b\u7aef\u53e3\uff0cfilter\u8868\u4f1a\u6839\u636e\u6211\u4eec\u5b9a\u4e49\u7684\u89c4\u5219\u8fdb\u884c\u8fc7\u6ee4\uff0cfilter\u8868\u5e94\u8be5\u662f\u6211\u4eec\u6700\u5e38\u7528\u5230\u7684\u8868\u4e86\uff0c\u6240\u4ee5\u6b64\u5904\uff0c\u6211\u4eec\u4ee5filter\u8868\u4e3a\u4f8b\uff0c\u5f00\u59cb\u5b66\u4e60\u600e\u6837\u5b9e\u9645\u64cd\u4f5ciptables\u3002</p> <p>\u600e\u6837\u67e5\u770bfilter\u8868\u4e2d\u7684\u89c4\u5219\u5462\uff1f\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u5373\u53ef\u67e5\u770b\u3002</p> <p></p> <p>\u4e0a\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528-t\u9009\u9879\uff0c\u6307\u5b9a\u8981\u64cd\u4f5c\u7684\u8868\uff0c\u4f7f\u7528-L\u9009\u9879\uff0c\u67e5\u770b-t\u9009\u9879\u5bf9\u5e94\u7684\u8868\u7684\u89c4\u5219\uff0c-L\u9009\u9879\u7684\u610f\u601d\u662f\uff0c\u5217\u51fa\u89c4\u5219\uff0c\u6240\u4ee5\uff0c\u4e0a\u8ff0\u547d\u4ee4\u7684\u542b\u4e49\u4e3a\u5217\u51fafilter\u8868\u7684\u6240\u6709\u89c4\u5219\uff0c\u6ce8\u610f\uff0c\u4e0a\u56fe\u4e2d\u663e\u793a\u7684\u89c4\u5219\uff08\u7eff\u8272\u6807\u6ce8\u7684\u90e8\u5206\u4e3a\u89c4\u5219\uff09\u662fCentos6\u542f\u52a8iptables\u4ee5\u540e\u9ed8\u8ba4\u8bbe\u7f6e\u7684\u89c4\u5219\uff0c\u6211\u4eec\u6682\u4e14\u4e0d\u7528\u5728\u610f\u5b83\u4eec\uff0c\u4e0a\u56fe\u4e2d\uff0c\u663e\u793a\u51fa\u4e863\u6761\u94fe\uff08\u84dd\u8272\u6807\u6ce8\u90e8\u5206\u4e3a\u94fe\uff09\uff0cINPUT\u94fe\u3001FORWARD\u94fe\u3001OUTPUT\u94fe\uff0c\u6bcf\u6761\u94fe\u4e2d\u90fd\u6709\u81ea\u5df1\u7684\u89c4\u5219\uff0c\u524d\u6587\u4e2d\uff0c\u6211\u4eec\u6253\u8fc7\u4e00\u4e2a\u6bd4\u65b9\uff0c\u628a\u201d\u94fe\u201d\u6bd4\u4f5c\u201d\u5173\u5361\u201d\uff0c\u4e0d\u540c\u7684\u201d\u5173\u5361\u201d\u62e5\u6709\u4e0d\u540c\u7684\u80fd\u529b\uff0c\u6240\u4ee5\uff0c\u4ece\u4e0a\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0cINPUT\u94fe\u3001FORWARD\u94fe\u3001OUTPUT\u94fe\u90fd\u62e5\u6709\u201d\u8fc7\u6ee4\u201d\u7684\u80fd\u529b\uff0c\u6240\u4ee5\uff0c\u5f53\u6211\u4eec\u8981\u5b9a\u4e49\u67d0\u6761\u201d\u8fc7\u6ee4\u201d\u7684\u89c4\u5219\u65f6\uff0c\u6211\u4eec\u4f1a\u5728filter\u8868\u4e2d\u5b9a\u4e49\uff0c\u4f46\u662f\u5177\u4f53\u5728\u54ea\u6761\u201d\u94fe\u201d\u4e0a\u5b9a\u4e49\u89c4\u5219\u5462\uff1f\u8fd9\u53d6\u51b3\u4e8e\u6211\u4eec\u7684\u5de5\u4f5c\u573a\u666f\u3002\u6bd4\u5982\uff0c\u6211\u4eec\u9700\u8981\u7981\u6b62\u67d0\u4e2aIP\u5730\u5740\u8bbf\u95ee\u6211\u4eec\u7684\u4e3b\u673a\uff0c\u6211\u4eec\u5219\u9700\u8981\u5728INPUT\u94fe\u4e0a\u5b9a\u4e49\u89c4\u5219\u3002\u56e0\u4e3a\uff0c\u6211\u4eec\u5728\u7406\u8bba\u603b\u7ed3\u4e2d\u5df2\u7ecf\u63d0\u5230\u8fc7\uff0c\u62a5\u6587\u53d1\u5f80\u672c\u673a\u65f6\uff0c\u4f1a\u7ecf\u8fc7PREROUTING\u94fe\u4e0eINPUT\u94fe\uff08\u5982\u679c\u4f60\u6ca1\u6709\u660e\u767d\uff0c\u8bf7\u56de\u987e\u524d\u6587\uff09\uff0c\u6240\u4ee5\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8981\u7981\u6b62\u67d0\u4e9b\u62a5\u6587\u53d1\u5f80\u672c\u673a\uff0c\u6211\u4eec\u53ea\u80fd\u5728PREROUTING\u94fe\u548cINPUT\u94fe\u4e2d\u5b9a\u4e49\u89c4\u5219\uff0c\u4f46\u662fPREROUTING\u94fe\u5e76\u4e0d\u5b58\u5728\u4e8efilter\u8868\u4e2d\uff0c\u6362\u53e5\u8bdd\u8bf4\u5c31\u662f\uff0cPREROUTING\u5173\u5361\u5929\u751f\u5c31\u6ca1\u6709\u8fc7\u6ee4\u7684\u80fd\u529b\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ea\u80fd\u5728INPUT\u94fe\u4e2d\u5b9a\u4e49\uff0c\u5f53\u7136\uff0c\u5982\u679c\u662f\u5176\u4ed6\u5de5\u4f5c\u573a\u666f\uff0c\u53ef\u80fd\u9700\u8981\u5728FORWARD\u94fe\u6216\u8005OUTPUT\u94fe\u4e2d\u5b9a\u4e49\u8fc7\u6ee4\u89c4\u5219\u3002</p> <p>\u8bdd\u8bf4\u56de\u6765\uff0c\u6211\u4eec\u7ee7\u7eed\u804a\u600e\u6837\u67e5\u770b\u67d0\u5f20\u8868\u4e2d\u7684\u89c4\u5219\u3002</p> <p>\u521a\u624d\u63d0\u5230\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528iptables -t filter -L\u547d\u4ee4\u5217\u51fafilter\u8868\u4e2d\u7684\u6240\u6709\u89c4\u5219\uff0c\u90a3\u4e48\u4e3e\u4e00\u53cd\u4e09\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u67e5\u770b\u5176\u5b83\u8868\u4e2d\u7684\u89c4\u5219\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <pre><code>iptables -t raw -L\n\niptables -t mangle -L\n\niptables -t nat -L\n</code></pre> <p>\u5176\u5b9e\uff0c\u6211\u4eec\u53ef\u4ee5\u7701\u7565-t filter\uff0c\u5f53\u6ca1\u6709\u4f7f\u7528-t\u9009\u9879\u6307\u5b9a\u8868\u65f6\uff0c\u9ed8\u8ba4\u4e3a\u64cd\u4f5cfilter\u8868\uff0c\u5373iptables -L\u8868\u793a\u5217\u51fafilter\u8868\u4e2d\u7684\u6240\u6709\u89c4\u5219\u3002</p> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u53ea\u67e5\u770b\u6307\u5b9a\u8868\u4e2d\u7684\u6307\u5b9a\u94fe\u7684\u89c4\u5219\uff0c\u6bd4\u5982\uff0c\u6211\u4eec\u53ea\u67e5\u770bfilter\u8868\u4e2dINPUT\u94fe\u7684\u89c4\u5219\uff0c\u793a\u4f8b\u5982\u4e0b\uff08\u6ce8\u610f\u5927\u5c0f\u5199\uff09\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u53ea\u663e\u793a\u4e86filter\u8868\u4e2dINPUT\u94fe\u4e2d\u7684\u89c4\u5219\uff08\u7701\u7565-t\u9009\u9879\u9ed8\u8ba4\u4e3afilter\u8868\uff09\uff0c\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u6307\u5b9a\u53ea\u67e5\u770b\u5176\u4ed6\u94fe\uff0c\u5176\u5b9e\uff0c\u6211\u4eec\u67e5\u770b\u5230\u7684\u4fe1\u606f\u8fd8\u4e0d\u662f\u6700\u8be6\u7ec6\u7684\u4fe1\u606f\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528-v\u9009\u9879\uff0c\u67e5\u770b\u51fa\u66f4\u591a\u7684\u3001\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528-v\u9009\u9879\u540e\uff0ciptables\u4e3a\u6211\u4eec\u5c55\u793a\u7684\u4fe1\u606f\u66f4\u591a\u4e86\uff0c\u90a3\u4e48\uff0c\u8fd9\u4e9b\u5b57\u6bb5\u90fd\u662f\u4ec0\u4e48\u610f\u601d\u5462\uff1f\u6211\u4eec\u6765\u603b\u7ed3\u4e00\u4e0b\uff0c\u770b\u4e0d\u61c2\u6ca1\u5173\u7cfb\uff0c\u7b49\u5230\u5b9e\u9645\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u81ea\u7136\u4f1a\u660e\u767d\uff0c\u6b64\u5904\u5927\u6982\u4e86\u89e3\u4e00\u4e0b\u5373\u53ef\u3002</p> <p>\u5176\u5b9e\uff0c\u8fd9\u4e9b\u5b57\u6bb5\u5c31\u662f\u89c4\u5219\u5bf9\u5e94\u7684\u5c5e\u6027\uff0c\u8bf4\u767d\u4e86\u5c31\u662f\u89c4\u5219\u7684\u5404\u79cd\u4fe1\u606f\uff0c\u90a3\u4e48\u6211\u4eec\u6765\u603b\u7ed3\u4e00\u4e0b\u8fd9\u4e9b\u5b57\u6bb5\u7684\u542b\u4e49\u3002</p> <p>pkts:\u5bf9\u5e94\u89c4\u5219\u5339\u914d\u5230\u7684\u62a5\u6587\u7684\u4e2a\u6570\u3002</p> <p>bytes:\u5bf9\u5e94\u5339\u914d\u5230\u7684\u62a5\u6587\u5305\u7684\u5927\u5c0f\u603b\u548c\u3002</p> <p>target:\u89c4\u5219\u5bf9\u5e94\u7684target\uff0c\u5f80\u5f80\u8868\u793a\u89c4\u5219\u5bf9\u5e94\u7684\u201d\u52a8\u4f5c\u201d\uff0c\u5373\u89c4\u5219\u5339\u914d\u6210\u529f\u540e\u9700\u8981\u91c7\u53d6\u7684\u63aa\u65bd\u3002</p> <p>prot:\u8868\u793a\u89c4\u5219\u5bf9\u5e94\u7684\u534f\u8bae\uff0c\u662f\u5426\u53ea\u9488\u5bf9\u67d0\u4e9b\u534f\u8bae\u5e94\u7528\u6b64\u89c4\u5219\u3002</p> <p>opt:\u8868\u793a\u89c4\u5219\u5bf9\u5e94\u7684\u9009\u9879\u3002</p> <p>in:\u8868\u793a\u6570\u636e\u5305\u7531\u54ea\u4e2a\u63a5\u53e3(\u7f51\u5361)\u6d41\u5165\uff0c\u5373\u4ece\u54ea\u4e2a\u7f51\u5361\u6765\u3002</p> <p>out:\u8868\u793a\u6570\u636e\u5305\u5c06\u7531\u54ea\u4e2a\u63a5\u53e3(\u7f51\u5361)\u6d41\u51fa\uff0c\u5373\u5230\u54ea\u4e2a\u7f51\u5361\u53bb\u3002</p> <p>source:\u8868\u793a\u89c4\u5219\u5bf9\u5e94\u7684\u6e90\u5934\u5730\u5740\uff0c\u53ef\u4ee5\u662f\u4e00\u4e2aIP\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u7f51\u6bb5\u3002</p> <p>destination:\u8868\u793a\u89c4\u5219\u5bf9\u5e94\u7684\u76ee\u6807\u5730\u5740\u3002\u53ef\u4ee5\u662f\u4e00\u4e2aIP\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u7f51\u6bb5\u3002</p> <p>\u7ec6\u5fc3\u5982\u4f60\u4e00\u5b9a\u53d1\u73b0\u4e86\uff0c\u4e0a\u56fe\u4e2d\u7684\u6e90\u5730\u5740\u4e0e\u76ee\u6807\u5730\u5740\u90fd\u4e3aanywhere\uff0c\u770b\u6765\uff0ciptables\u9ed8\u8ba4\u4e3a\u6211\u4eec\u8fdb\u884c\u4e86\u540d\u79f0\u89e3\u6790\uff0c\u4f46\u662f\u5728\u89c4\u5219\u975e\u5e38\u591a\u7684\u60c5\u51b5\u4e0b\u5982\u679c\u8fdb\u884c\u540d\u79f0\u89e3\u6790\uff0c\u6548\u7387\u4f1a\u6bd4\u8f83\u4f4e\uff0c\u6240\u4ee5\uff0c\u5728\u6ca1\u6709\u6b64\u9700\u6c42\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528-n\u9009\u9879\uff0c\u8868\u793a\u4e0d\u5bf9IP\u5730\u5740\u8fdb\u884c\u540d\u79f0\u53cd\u89e3\uff0c\u76f4\u63a5\u663e\u793aIP\u5730\u5740\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u89c4\u5219\u4e2d\u7684\u6e90\u5730\u5740\u4e0e\u76ee\u6807\u5730\u5740\u5df2\u7ecf\u663e\u793a\u4e3aIP\uff0c\u800c\u975e\u8f6c\u6362\u540e\u7684\u540d\u79f0\u3002</p> <p>\u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u53ea\u67e5\u770b\u67d0\u4e2a\u94fe\u7684\u89c4\u5219\uff0c\u5e76\u4e14\u4e0d\u8ba9IP\u8fdb\u884c\u53cd\u89e3\uff0c\u8fd9\u6837\u66f4\u6e05\u6670\u4e00\u4e9b\uff0c\u6bd4\u5982 iptables -nvL INPUT</p> <p>\u5982\u679c\u4f60\u4e60\u60ef\u4e86\u67e5\u770b\u6709\u5e8f\u53f7\u7684\u5217\u8868\uff0c\u4f60\u5728\u67e5\u770biptables\u8868\u4e2d\u7684\u89c4\u5219\u65f6\u80af\u5b9a\u4f1a\u5f88\u4e0d\u723d\uff0c\u6ca1\u6709\u5173\u7cfb\uff0c\u6ee1\u8db3\u4f60\uff0c\u4f7f\u7528\u2013line-numbers\u5373\u53ef\u663e\u793a\u89c4\u5219\u7684\u7f16\u53f7\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u2013line-numbers\u9009\u9879\u5e76\u6ca1\u6709\u5bf9\u5e94\u7684\u77ed\u9009\u9879\uff0c\u4e0d\u8fc7\u6211\u4eec\u7f29\u5199\u6210\u2013line\u65f6\uff0ccentos\u4e2d\u7684iptables\u4e5f\u53ef\u4ee5\u8bc6\u522b\u3002</p> <p>\u6211\u77e5\u9053\u4f60\u76ee\u5149\u5982\u70ac\uff0c\u4f60\u53ef\u80fd\u65e9\u5c31\u53d1\u73b0\u4e86\uff0c\u8868\u4e2d\u7684\u6bcf\u4e2a\u94fe\u7684\u540e\u9762\u90fd\u6709\u4e00\u4e2a\u62ec\u53f7\uff0c\u62ec\u53f7\u91cc\u9762\u6709\u4e00\u4e9b\u4fe1\u606f\uff0c\u5982\u4e0b\u56fe\u7ea2\u8272\u6807\u6ce8\u4f4d\u7f6e\uff0c\u90a3\u4e48\u8fd9\u4e9b\u4fe1\u606f\u90fd\u4ee3\u8868\u4e86\u4ec0\u4e48\u5462\uff1f\u6211\u4eec\u6765\u770b\u770b\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2dINPUT\u94fe\u540e\u9762\u7684\u62ec\u53f7\u4e2d\u5305\u542bpolicy ACCEPT \uff0c0 packets\uff0c0bytes \u4e09\u90e8\u5206\u3002</p> <p>policy\u8868\u793a\u5f53\u524d\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\uff0cpolicy ACCEPT\u8868\u793a\u4e0a\u56fe\u4e2dINPUT\u7684\u94fe\u7684\u9ed8\u8ba4\u52a8\u4f5c\u4e3aACCEPT\uff0c\u6362\u53e5\u8bdd\u8bf4\u5c31\u662f\uff0c\u9ed8\u8ba4\u63a5\u53d7\u901a\u8fc7INPUT\u5173\u5361\u7684\u6240\u6709\u8bf7\u6c42\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u914d\u7f6eINPUT\u94fe\u7684\u5177\u4f53\u89c4\u5219\u65f6\uff0c\u5e94\u8be5\u5c06\u9700\u8981\u62d2\u7edd\u7684\u8bf7\u6c42\u914d\u7f6e\u5230\u89c4\u5219\u4e2d\uff0c\u8bf4\u767d\u4e86\u5c31\u662f\u201d\u9ed1\u540d\u5355\u201d\u673a\u5236\uff0c\u9ed8\u8ba4\u6240\u6709\u4eba\u90fd\u80fd\u901a\u8fc7\uff0c\u53ea\u6709\u6307\u5b9a\u7684\u4eba\u4e0d\u80fd\u901a\u8fc7\uff0c\u5f53\u6211\u4eec\u628aINPUT\u94fe\u9ed8\u8ba4\u52a8\u4f5c\u8bbe\u7f6e\u4e3a\u63a5\u53d7(ACCEPT)\uff0c\u5c31\u8868\u793a\u6240\u6709\u4eba\u90fd\u80fd\u901a\u8fc7\u8fd9\u4e2a\u5173\u5361\uff0c\u6b64\u65f6\u5c31\u5e94\u8be5\u5728\u5177\u4f53\u7684\u89c4\u5219\u4e2d\u6307\u5b9a\u9700\u8981\u62d2\u7edd\u7684\u8bf7\u6c42\uff0c\u5c31\u8868\u793a\u53ea\u6709\u6307\u5b9a\u7684\u4eba\u4e0d\u80fd\u901a\u8fc7\u8fd9\u4e2a\u5173\u5361\uff0c\u8fd9\u5c31\u662f\u9ed1\u540d\u5355\u673a\u5236\uff0c\u4f46\u662f\uff0c\u4f60\u4e00\u5b9a\u53d1\u73b0\u4e86\uff0c\u4e0a\u56fe\u4e2d\u6240\u663e\u793a\u51fa\u7684\u89c4\u5219\uff0c\u5927\u90e8\u5206\u90fd\u662f\u63a5\u53d7\u8bf7\u6c42(ACCEPT)\uff0c\u5e76\u4e0d\u662f\u60f3\u8c61\u4e2d\u7684\u62d2\u7edd\u8bf7\u6c42(DROP\u6216\u8005REJECT)\uff0c\u8fd9\u4e0e\u6211\u4eec\u6240\u63cf\u8ff0\u7684\u9ed1\u540d\u5355\u673a\u5236\u4e0d\u7b26\u554a\uff0c\u6309\u7167\u9053\u7406\u6765\u8bf4\uff0c\u9ed8\u8ba4\u52a8\u4f5c\u4e3a\u63a5\u53d7\uff0c\u5c31\u5e94\u8be5\u5728\u5177\u4f53\u7684\u89c4\u5219\u4e2d\u914d\u7f6e\u9700\u8981\u62d2\u7edd\u7684\u4eba\uff0c\u4f46\u662f\u4e0a\u56fe\u4e2d\u5e76\u4e0d\u662f\u8fd9\u6837\u7684\uff0c\u4e4b\u6240\u4ee5\u51fa\u73b0\u4e0a\u56fe\u4e2d\u7684\u60c5\u51b5\uff0c\u662f\u56e0\u4e3aIPTABLES\u7684\u5de5\u4f5c\u673a\u5236\u5bfc\u81f4\u5230\uff0c\u4e0a\u4f8b\u5176\u5b9e\u662f\u5229\u7528\u4e86\u8fd9\u4e9b\u201d\u673a\u5236\u201d\uff0c\u5b8c\u6210\u4e86\u6240\u8c13\u7684\u201d\u767d\u540d\u5355\u201d\u673a\u5236\uff0c\u5e76\u4e0d\u662f\u6211\u4eec\u6240\u63cf\u8ff0\u7684\u201d\u9ed1\u540d\u5355\u201d\u673a\u5236\uff0c\u6211\u4eec\u6b64\u5904\u6682\u65f6\u4e0d\u7528\u5173\u6ce8\u8fd9\u4e00\u70b9\uff0c\u4e4b\u540e\u4f1a\u8fdb\u884c\u8be6\u7ec6\u7684\u4e3e\u4f8b\u5e76\u89e3\u91ca\uff0c\u6b64\u5904\u6211\u4eec\u53ea\u8981\u660e\u767dpolicy\u5bf9\u5e94\u7684\u52a8\u4f5c\u4e3a\u94fe\u7684\u9ed8\u8ba4\u52a8\u4f5c\u5373\u53ef\uff0c\u6216\u8005\u6362\u53e5\u8bdd\u8bf4\uff0c\u6211\u4eec\u53ea\u8981\u7406\u89e3\uff0cpolicy\u4e3a\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u5373\u53ef\u3002</p> <p>packets\u8868\u793a\u5f53\u524d\u94fe\uff08\u4e0a\u4f8b\u4e3aINPUT\u94fe\uff09\u9ed8\u8ba4\u7b56\u7565\u5339\u914d\u5230\u7684\u5305\u7684\u6570\u91cf\uff0c0 packets\u8868\u793a\u9ed8\u8ba4\u7b56\u7565\u5339\u914d\u52300\u4e2a\u5305\u3002</p> <p>bytes\u8868\u793a\u5f53\u524d\u94fe\u9ed8\u8ba4\u7b56\u7565\u5339\u914d\u5230\u7684\u6240\u6709\u5305\u7684\u5927\u5c0f\u603b\u548c\u3002</p> <p>\u5176\u5b9e\uff0c\u6211\u4eec\u53ef\u4ee5\u628apackets\u4e0ebytes\u79f0\u4f5c\u201d\u8ba1\u6570\u5668\u201d\uff0c\u4e0a\u56fe\u4e2d\u7684\u8ba1\u6570\u5668\u8bb0\u5f55\u4e86\u9ed8\u8ba4\u7b56\u7565\u5339\u914d\u5230\u7684\u62a5\u6587\u6570\u91cf\u4e0e\u603b\u5927\u5c0f\uff0c\u201d\u8ba1\u6570\u5668\u201d\u53ea\u4f1a\u5728\u4f7f\u7528-v\u9009\u9879\u65f6\uff0c\u624d\u4f1a\u663e\u793a\u51fa\u6765\u3002</p> <p>\u5f53\u88ab\u5339\u914d\u5230\u7684\u5305\u8fbe\u5230\u4e00\u5b9a\u6570\u91cf\u65f6\uff0c\u8ba1\u6570\u5668\u4f1a\u81ea\u52a8\u5c06\u5339\u914d\u5230\u7684\u5305\u7684\u5927\u5c0f\u8f6c\u6362\u4e3a\u53ef\u8bfb\u6027\u8f83\u9ad8\u7684\u5355\u4f4d\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u5982\u679c\u4f60\u60f3\u8981\u67e5\u770b\u7cbe\u786e\u7684\u8ba1\u6570\u503c\uff0c\u800c\u4e0d\u662f\u7ecf\u8fc7\u53ef\u8bfb\u6027\u4f18\u5316\u8fc7\u7684\u8ba1\u6570\u503c\uff0c\u90a3\u4e48\u4f60\u53ef\u4ee5\u4f7f\u7528-x\u9009\u9879\uff0c\u8868\u793a\u663e\u793a\u7cbe\u786e\u7684\u8ba1\u6570\u503c\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u6bcf\u5f20\u8868\u4e2d\u7684\u6bcf\u6761\u94fe\u90fd\u6709\u81ea\u5df1\u7684\u8ba1\u6570\u5668\uff0c\u94fe\u4e2d\u7684\u6bcf\u4e2a\u89c4\u5219\u4e5f\u90fd\u6709\u81ea\u5df1\u7684\u8ba1\u6570\u5668\uff0c\u6ca1\u9519\uff0c\u5c31\u662f\u6bcf\u6761\u89c4\u5219\u5bf9\u5e94\u7684pkts\u5b57\u6bb5\u4e0ebytes\u5b57\u6bb5\u7684\u4fe1\u606f\u3002</p>"},{"location":"iptables_2/#_1","title":"\u547d\u4ee4\u5c0f\u8282","text":"<p>\u597d\u4e86\uff0c\u6211\u4eec\u5df2\u7ecf\u4f1a\u4f7f\u7528\u547d\u4ee4\u7b80\u5355\u7684\u67e5\u770biptables\u8868\u7684\u89c4\u5219\u4e86\uff0c\u4e3a\u4e86\u65b9\u4fbf\u4ee5\u540e\u56de\u987e\uff0c\u6211\u4eec\u5c06\u4e0a\u6587\u4e2d\u7684\u76f8\u5173\u547d\u4ee4\u603b\u7ed3\u4e00\u4e0b\u3002</p> <pre><code>iptables\u00a0-t\u00a0\u8868\u540d\u00a0-L\n</code></pre> <p>\u67e5\u770b\u5bf9\u5e94\u8868\u7684\u6240\u6709\u89c4\u5219\uff0c-t\u9009\u9879\u6307\u5b9a\u8981\u64cd\u4f5c\u7684\u8868\uff0c\u7701\u7565\u201d-t \u8868\u540d\u201d\u65f6\uff0c\u9ed8\u8ba4\u8868\u793a\u64cd\u4f5cfilter\u8868\uff0c-L\u8868\u793a\u5217\u51fa\u89c4\u5219\uff0c\u5373\u67e5\u770b\u89c4\u5219\u3002</p> <pre><code>iptables\u00a0-t\u00a0\u8868\u540d\u00a0-L\u00a0\u94fe\u540d\n</code></pre> <p>\u67e5\u770b\u6307\u5b9a\u8868\u7684\u6307\u5b9a\u94fe\u4e2d\u7684\u89c4\u5219\u3002</p> <pre><code>iptables\u00a0-t\u00a0\u8868\u540d\u00a0-v\u00a0-L\n</code></pre> <p>\u67e5\u770b\u6307\u5b9a\u8868\u7684\u6240\u6709\u89c4\u5219\uff0c\u5e76\u4e14\u663e\u793a\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f\uff08\u66f4\u591a\u5b57\u6bb5\uff09\uff0c-v\u8868\u793averbose\uff0c\u8868\u793a\u8be6\u7ec6\u7684\uff0c\u5197\u957f\u7684\uff0c\u5f53\u4f7f\u7528-v\u9009\u9879\u65f6\uff0c\u4f1a\u663e\u793a\u51fa\u201d\u8ba1\u6570\u5668\u201d\u7684\u4fe1\u606f\uff0c\u7531\u4e8e\u4e0a\u4f8b\u4e2d\u4f7f\u7528\u7684\u9009\u9879\u90fd\u662f\u77ed\u9009\u9879\uff0c\u6240\u4ee5\u4e00\u822c\u7b80\u5199\u4e3aiptables -t \u8868\u540d -vL</p> <pre><code>iptables\u00a0-t\u00a0\u8868\u540d\u00a0-n\u00a0-L\n</code></pre> <p>\u8868\u793a\u67e5\u770b\u8868\u7684\u6240\u6709\u89c4\u5219\uff0c\u5e76\u4e14\u5728\u663e\u793a\u89c4\u5219\u65f6\uff0c\u4e0d\u5bf9\u89c4\u5219\u4e2d\u7684IP\u6216\u8005\u7aef\u53e3\u8fdb\u884c\u540d\u79f0\u53cd\u89e3\uff0c-n\u9009\u9879\u8868\u793a\u4e0d\u89e3\u6790IP\u5730\u5740\u3002</p> <pre><code>iptables\u00a0--line-numbers\u00a0-t\u00a0\u8868\u540d\u00a0-L\n</code></pre> <p>\u8868\u793a\u67e5\u770b\u8868\u7684\u6240\u6709\u89c4\u5219\uff0c\u5e76\u4e14\u663e\u793a\u89c4\u5219\u7684\u5e8f\u53f7\uff0c\u2013line-numbers\u9009\u9879\u8868\u793a\u663e\u793a\u89c4\u5219\u7684\u5e8f\u53f7\uff0c\u6ce8\u610f\uff0c\u6b64\u9009\u9879\u4e3a\u957f\u9009\u9879\uff0c\u4e0d\u80fd\u4e0e\u5176\u4ed6\u77ed\u9009\u9879\u5408\u5e76\uff0c\u4e0d\u8fc7\u6b64\u9009\u9879\u53ef\u4ee5\u7b80\u5199\u4e3a\u2013line\uff0c\u6ce8\u610f\uff0c\u7b80\u5199\u540e\u4ecd\u7136\u662f\u4e24\u6761\u6a2a\u6760\uff0c\u4ecd\u7136\u662f\u957f\u9009\u9879\u3002</p> <pre><code>iptables\u00a0-t\u00a0\u8868\u540d\u00a0-v\u00a0-x\u00a0-L\n</code></pre> <p>\u8868\u793a\u67e5\u770b\u8868\u4e2d\u7684\u6240\u6709\u89c4\u5219\uff0c\u5e76\u4e14\u663e\u793a\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f(-v\u9009\u9879)\uff0c\u4e0d\u8fc7\uff0c\u8ba1\u6570\u5668\u4e2d\u7684\u4fe1\u606f\u663e\u793a\u4e3a\u7cbe\u786e\u7684\u8ba1\u6570\u503c\uff0c\u800c\u4e0d\u662f\u663e\u793a\u4e3a\u7ecf\u8fc7\u53ef\u8bfb\u4f18\u5316\u7684\u8ba1\u6570\u503c\uff0c-x\u9009\u9879\u8868\u793a\u663e\u793a\u8ba1\u6570\u5668\u7684\u7cbe\u786e\u503c\u3002</p> <p>\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0c\u4e3a\u4e86\u65b9\u4fbf\uff0c\u5f80\u5f80\u4f1a\u5c06\u77ed\u9009\u9879\u8fdb\u884c\u5408\u5e76\uff0c\u6240\u4ee5\uff0c\u5982\u679c\u5c06\u4e0a\u8ff0\u9009\u9879\u90fd\u7cc5\u5408\u5728\u4e00\u8d77\uff0c\u53ef\u4ee5\u5199\u6210\u5982\u4e0b\u547d\u4ee4\uff0c\u6b64\u5904\u4ee5filter\u8868\u4e3a\u4f8b\u3002</p> <pre><code>iptables\u00a0--line\u00a0-t\u00a0filter\u00a0-nvxL\n</code></pre> <p>\u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u53ea\u67e5\u770b\u67d0\u5f20\u8868\u4e2d\u7684\u67d0\u6761\u94fe\uff0c\u6b64\u5904\u4ee5filter\u8868\u7684INPUT\u94fe\u4e3a\u4f8b</p> <pre><code>iptables\u00a0--line\u00a0-t\u00a0filter\u00a0-nvxL\u00a0INPUT\n</code></pre> <p>\u597d\u4e86\uff0c\u600e\u6837\u4f7f\u7528iptables\u547d\u4ee4\u8fdb\u884c\u57fa\u672c\u7684\u67e5\u770b\u64cd\u4f5c\uff0c\u5c31\u5148\u603b\u7ed3\u5230\u8fd9\u91cc\u5427\uff0c\u4e0b\u4e00\u7bc7\u6587\u7ae0\u4f1a\u603b\u7ed3iptables\u89c4\u5219\u7684\u201d\u589e\u3001\u5220\u3001\u6539\u201d\u64cd\u4f5c\uff0c\u76f4\u8fbe\u94fe\u63a5\u5982\u4e0b\uff1a</p> <p>iptables\u89c4\u5219\u7ba1\u7406</p> <p>\u5982\u679c\u4f60\u662f\u4e00\u4e2a\u65b0\u624b\uff0c\u5e0c\u671b\u8fd9\u7bc7\u6587\u7ae0\u80fd\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\u3002</p> <p>\u5feb\u6765\u8bc4\u8bba\u3001\u5feb\u6765\u70b9\u8d5e\u554a~~\u5404\u4f4d\u4eb2~~\u5feb\u6765\u6536\u85cf~~\u5feb\u6765\u63a8\u8350\u554a~~\u4e48\u4e48\u54d2~~\u3002</p>"},{"location":"iptables_3/","title":"iptables\u8be6\u89e3\uff083\uff09\uff1aiptables\u89c4\u5219\u7ba1\u7406","text":"<p>\u5728\u672c\u535a\u5ba2\u4e2d\uff0c\u4ece\u7406\u8bba\u5230\u5b9e\u8df5\uff0c\u7cfb\u7edf\u7684\u4ecb\u7ecd\u4e86iptables\uff0c\u5982\u679c\u4f60\u60f3\u8981\u4ece\u5934\u5f00\u59cb\u4e86\u89e3iptables\uff0c\u53ef\u4ee5\u67e5\u770biptables\u6587\u7ae0\u5217\u8868\uff0c\u76f4\u8fbe\u94fe\u63a5\u5982\u4e0b</p> <p>iptables\u96f6\u57fa\u7840\u5feb\u901f\u5165\u95e8\u7cfb\u5217</p> <p>\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u5df2\u7ecf\u5b66\u4f1a\u4e86\u600e\u6837\u4f7f\u7528iptables\u547d\u4ee4\u67e5\u770b\u89c4\u5219\uff0c\u90a3\u4e48\u8fd9\u7bc7\u6587\u7ae0\u6211\u4eec\u5c31\u6765\u603b\u7ed3\u4e00\u4e0b\uff0c\u600e\u6837\u7ba1\u7406\u89c4\u5219\u3002</p> <p>\u4e4b\u524d\uff0c\u6211\u4eec\u628a\u67e5\u770biptables\u89c4\u5219\u7684\u64cd\u4f5c\u6bd4\u4f5c\u201d\u589e\u5220\u6539\u67e5\u201d\u5f53\u4e2d\u7684\u201d\u67e5\u201d\uff0c\u90a3\u4e48\u5728\u8fd9\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u5c31\u804a\u804a\u600e\u6837\u5bf9iptables\u8fdb\u884c\u201d\u589e\u3001\u5220\u3001\u6539\u201d\u64cd\u4f5c\u3002</p> <p>\u6ce8\u610f\uff1a\u5728\u53c2\u7167\u672c\u6587\u8fdb\u884ciptables\u5b9e\u9a8c\u65f6\uff0c\u8bf7\u52a1\u5fc5\u5728\u4e2a\u4eba\u7684\u6d4b\u8bd5\u673a\u4e0a\u8fdb\u884c\uff0c\u56e0\u4e3a\u5982\u679ciptables\u89c4\u5219\u8bbe\u7f6e\u4e0d\u5f53\uff0c\u6709\u53ef\u80fd\u4f7f\u4f60\u65e0\u6cd5\u8fde\u63a5\u5230\u8fdc\u7a0b\u4e3b\u673a\u4e2d\u3002</p> <p></p> <p>\u9996\u5148\uff0c\u6211\u4eec\u6765\u56de\u987e\u4e00\u4e0b\u4ec0\u4e48\u662fiptables\u7684\u89c4\u5219\u3002</p> <p>\u4e4b\u524d\u6253\u8fc7\u4e00\u4e2a\u6bd4\u65b9\uff0c\u6bcf\u6761\u201d\u94fe\u201d\u90fd\u662f\u4e00\u4e2a\u201d\u5173\u5361\u201d\uff0c\u6bcf\u4e2a\u901a\u8fc7\u8fd9\u4e2a\u201d\u5173\u5361\u201d\u7684\u62a5\u6587\u90fd\u8981\u5339\u914d\u8fd9\u4e2a\u5173\u5361\u4e0a\u7684\u89c4\u5219\uff0c\u5982\u679c\u5339\u914d\uff0c\u5219\u5bf9\u62a5\u6587\u8fdb\u884c\u5bf9\u5e94\u7684\u5904\u7406\uff0c\u6bd4\u5982\u8bf4\uff0c\u4f60\u6211\u4e8c\u4eba\u6b64\u523b\u5c31\u597d\u50cf\u4e24\u4e2a\u201d\u62a5\u6587\u201d\uff0c\u4f60\u6211\u4e8c\u4eba\u6b64\u523b\u90fd\u8981\u5165\u5173\uff0c\u53ef\u662f\u57ce\u4e3b\u6709\u547d\uff0c\u53ea\u6709\u5668\u5b87\u8f69\u6602\u4e4b\u4eba\u624d\u80fd\u5165\u5173\uff0c\u4e0d\u7b26\u5408\u6b64\u6761\u4ef6\u7684\u4eba\u4e0d\u80fd\u5165\u5173\uff0c\u4e8e\u662f\u5b88\u5173\u5c06\u58eb\u6309\u7167\u57ce\u4e3b\u5236\u5b9a\u7684\u201d\u89c4\u5219\u201d\uff0c\u5f00\u59cb\u6253\u91cf\u4f60\u6211\u4e8c\u4eba\uff0c\u6700\u7ec8\uff0c\u4f60\u987a\u5229\u5165\u5173\u4e86\uff0c\u800c\u6211\u5df2\u88ab\u62d2\u4e4b\u95e8\u5916\uff0c\u56e0\u4e3a\u4f60\u7b26\u5408\u201d\u5668\u5b87\u8f69\u6602\u201d\u7684\u6807\u51c6\uff0c\u6240\u4ee5\u628a\u4f60\u201d\u653e\u884c\u201d\u4e86\uff0c\u800c\u6211\u4e0d\u7b26\u5408\u6807\u51c6\uff0c\u6240\u4ee5\u6ca1\u6709\u88ab\u653e\u884c\uff0c\u5176\u5b9e\uff0c\u201d\u5668\u5b87\u8f69\u6602\u201d\u5c31\u662f\u4e00\u79cd\u201d\u5339\u914d\u6761\u4ef6\u201d\uff0c\u201d\u653e\u884c\u201d\u5c31\u662f\u4e00\u79cd\u201d\u52a8\u4f5c\u201d\uff0c\u201d\u5339\u914d\u6761\u4ef6\u201d\u4e0e\u201d\u52a8\u4f5c\u201d\u7ec4\u6210\u4e86\u89c4\u5219\u3002</p> <p>\u53ea\u4e0d\u8fc7\uff0c\u5728iptables\u7684\u4e16\u754c\u4e2d\uff0c\u6700\u5e38\u7528\u7684\u5339\u914d\u6761\u4ef6\u5e76\u4e0d\u662f\u201d\u5668\u5b87\u8f69\u6602\u201d\uff0c\u800c\u662f\u62a5\u6587\u7684\u201d\u6e90\u5730\u5740\u201d\u3001\u201d\u76ee\u6807\u5730\u5740\u201d\u3001\u201d\u6e90\u7aef\u53e3\u201d\u3001\u201d\u76ee\u6807\u7aef\u53e3\u201d\u7b49\uff0c\u5728iptables\u7684\u4e16\u754c\u4e2d\uff0c\u6700\u5e38\u7528\u7684\u52a8\u4f5c\u6709ACCEPT\uff08\u63a5\u53d7\uff09\u3001DROP\uff08\u4e22\u5f03\uff09\u3001REJECT\uff08\u62d2\u7edd\uff09\uff0c\u5176\u4e2dACCEPT\u5c31\u4e0e\u6211\u4eec\u4e3e\u4f8b\u4e2d\u7684\u201d\u653e\u884c\u201d\u7c7b\u4f3c\uff0c\u4f46\u662f\uff0c\u6211\u4eec\u521a\u624d\u63d0\u5230\u7684\u8fd9\u4e9b\u5e76\u4e0d\u662f\u5168\u90e8\u7684\u5339\u914d\u6761\u4ef6\u4e0e\u52a8\u4f5c\uff0c\u53ea\u662f\u6700\u5e38\u7528\u7684\u4e00\u4e9b\u7f62\u4e86\uff0c\u5177\u4f53\u7684\u5339\u914d\u6761\u4ef6\u4e0e\u52a8\u4f5c\u4e0d\u662f\u6211\u4eec\u4eca\u5929\u8ba8\u8bba\u7684\u91cd\u70b9\uff0c\u6211\u4eec\u4f1a\u5728\u4ee5\u540e\u7684\u6587\u7ae0\u4e2d\u518d\u505a\u603b\u7ed3\u3002</p> <p>\u597d\u4e86\uff0c\u6211\u4eec\u5df2\u7ecf\u56de\u987e\u4e86\u89c4\u5219\u7684\u6982\u5ff5\uff0c\u5e76\u4e14\u5df2\u7ecf\u660e\u767d\u4e86\uff0c\u89c4\u5219\u5927\u81f4\u7531\u4e24\u4e2a\u903b\u8f91\u5355\u5143\u7ec4\u6210\uff0c\u5339\u914d\u6761\u4ef6\u4e0e\u52a8\u4f5c\uff0c\u90a3\u4e48\u591a\u8bf4\u65e0\u76ca\uff0c\u6211\u4eec\u6765\u52a8\u624b\u5b9a\u4e49\u4e00\u6761\u89c4\u5219\uff0c\u6b64\u5904\u4ecd\u7136\u4ee5filter\u8868\u4e2d\u7684INPUT\u94fe\u4e3a\u4f8b\uff0c\u56e0\u4e3afilter\u8868\u8d1f\u8d23\u201d\u8fc7\u6ee4\u201d\u529f\u80fd\uff0c\u800c\u6240\u6709\u53d1\u5f80\u672c\u673a\u7684\u62a5\u6587\u5982\u679c\u9700\u8981\u88ab\u8fc7\u6ee4\uff0c\u9996\u5148\u4f1a\u7ecf\u8fc7INPUT\u94fe\uff08PREROUTING\u94fe\u6ca1\u6709\u8fc7\u6ee4\u529f\u80fd\uff09\uff0c\u8fd9\u4e0e\u6211\u4eec\u6240\u6bd4\u55bb\u7684\u201d\u5165\u5173\u201d\u573a\u666f\u975e\u5e38\u76f8\u4f3c\uff0c\u6240\u4ee5\uff0c\u4f7f\u7528filter\u8868\u7684INPUT\u94fe\u4e3a\u4f8b\uff0c\u6709\u52a9\u4e8e\u6211\u4eec\u8fdb\u884c\u7406\u89e3\u3002</p> <p>\u9996\u5148\uff0c\u67e5\u770b\u4e00\u4e0bfilter\u8868\u4e2d\u7684INPUT\u94fe\u4e2d\u7684\u89c4\u5219\uff0c\u67e5\u770b\u89c4\u5219\u7684\u76f8\u5173\u547d\u4ee4\u5728\u524d\u6587\u5df2\u7ecf\u603b\u7ed3\u4e86\uff0c\u6b64\u5904\u4e0d\u518d\u8d58\u8ff0\uff0c\u5982\u679c\u4f60\u5fd8\u4e86\uff0c\u8bf7\u56de\u987e\u524d\u6587\u3002</p> <p>\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u67e5\u770bfilter\u8868INPUT\u94fe\u7684\u89c4\u5219\uff0c\u4e0b\u56fe\u4e2d\u7684\u89c4\u5219\u4e3acentos6\u9ed8\u8ba4\u6dfb\u52a0\u7684\u89c4\u5219\u3002</p> <p></p> <p>\u6ce8\u610f\uff1a\u5728\u53c2\u7167\u672c\u6587\u8fdb\u884ciptables\u5b9e\u9a8c\u65f6\uff0c\u8bf7\u52a1\u5fc5\u5728\u4e2a\u4eba\u7684\u6d4b\u8bd5\u673a\u4e0a\u8fdb\u884c\u3002</p> <p>\u4e3a\u4e86\u51c6\u5907\u4e00\u4e2a\u4ece\u96f6\u5f00\u59cb\u7684\u73af\u5883\uff0c\u6211\u4eec\u5c06centos6\u9ed8\u8ba4\u63d0\u4f9b\u7684\u89c4\u5219\u6e05\u7a7a\uff0c\u4ee5\u4fbf\u6211\u4eec\u8fdb\u884c\u5b9e\u9a8c\uff0c\u4f7f\u7528iptables -F INPUT\u547d\u4ee4\u6e05\u7a7afilter\u8868INPUT\u94fe\u4e2d\u7684\u89c4\u5219\uff0c\u540e\u9762\u6211\u4eec\u4f1a\u5355\u72ec\u5bf9\u6e05\u9664\u89c4\u5219\u7684\u76f8\u5173\u547d\u4ee4\u8fdb\u884c\u603b\u7ed3\uff0c\u6b64\u5904\u4e0d\u7528\u7ea0\u7ed3\u6b64\u547d\u4ee4\u3002</p> <p></p> <p>\u6e05\u7a7aINPUT\u94fe\u4ee5\u540e\uff0cfilter\u8868\u4e2d\u7684INPUT\u94fe\u5df2\u7ecf\u4e0d\u5b58\u5728\u4efb\u4f55\u7684\u89c4\u5219\uff0c\u4f46\u662f\u53ef\u4ee5\u770b\u51fa\uff0cINPUT\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u662fACCEPT\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0cINPUT\u94fe\u9ed8\u8ba4\u201d\u653e\u884c\u201d\u6240\u6709\u53d1\u5f80\u672c\u673a\u7684\u62a5\u6587\uff0c\u5f53\u6ca1\u6709\u4efb\u4f55\u89c4\u5219\u65f6\uff0c\u4f1a\u63a5\u53d7\u6240\u6709\u62a5\u6587\uff0c\u5f53\u62a5\u6587\u6ca1\u6709\u88ab\u4efb\u4f55\u89c4\u5219\u5339\u914d\u5230\u65f6\uff0c\u4e5f\u4f1a\u9ed8\u8ba4\u653e\u884c\u62a5\u6587\u3002</p> <p>\u90a3\u4e48\u6b64\u523b\uff0c\u6211\u4eec\u5c31\u5728\u53e6\u5916\u4e00\u53f0\u673a\u5668\u4e0a\uff0c\u4f7f\u7528ping\u547d\u4ee4\uff0c\u5411\u5f53\u524d\u673a\u5668\u53d1\u9001\u62a5\u6587\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0cping\u547d\u4ee4\u53ef\u4ee5\u5f97\u5230\u56de\u5e94\uff0c\u8bc1\u660eping\u547d\u4ee4\u53d1\u9001\u7684\u62a5\u6587\u5df2\u7ecf\u6b63\u5e38\u7684\u53d1\u9001\u5230\u4e86\u9632\u706b\u5899\u6240\u5728\u7684\u4e3b\u673a\uff0cping\u547d\u4ee4\u6240\u5728\u673a\u5668IP\u5730\u5740\u4e3a146\uff0c\u5f53\u524d\u6d4b\u8bd5\u9632\u706b\u5899\u4e3b\u673a\u7684IP\u5730\u5740\u4e3a156\uff0c\u6211\u4eec\u5c31\u7528\u8fd9\u6837\u7684\u73af\u5883\uff0c\u5bf9iptables\u8fdb\u884c\u64cd\u4f5c\u6f14\u793a\u3002</p> <p></p>"},{"location":"iptables_3/#_1","title":"\u589e\u52a0\u89c4\u5219","text":"<p>\u90a3\u4e48\u6b64\u5904\uff0c\u6211\u4eec\u5c31\u5728156\u4e0a\u914d\u7f6e\u4e00\u6761\u89c4\u5219\uff0c\u62d2\u7edd192.168.1.146\u4e0a\u7684\u6240\u6709\u62a5\u6587\u8bbf\u95ee\u5f53\u524d\u673a\u5668\uff0c\u4e4b\u524d\u4e00\u76f4\u5728\u8bf4\uff0c\u89c4\u5219\u7531\u5339\u914d\u6761\u4ef6\u4e0e\u52a8\u4f5c\u7ec4\u6210\uff0c\u90a3\u4e48\u201d\u62d2\u7edd192.168.1.146\u4e0a\u7684\u6240\u6709\u62a5\u6587\u8bbf\u95ee\u5f53\u524d\u673a\u5668\u201d\u8fd9\u6761\u89c4\u5219\u4e2d\uff0c\u62a5\u6587\u7684\u201d\u6e90\u5730\u5740\u4e3a192.168.1.146\u2033\u5219\u5c5e\u4e8e\u5339\u914d\u6761\u4ef6\uff0c\u5982\u679c\u62a5\u6587\u6765\u81ea\u201d192.168.1.146\u2033\uff0c\u5219\u8868\u793a\u6ee1\u8db3\u5339\u914d\u6761\u4ef6\uff0c\u800c\u201d\u62d2\u7edd\u201d\u8fd9\u4e2a\u62a5\u6587\uff0c\u5c31\u5c5e\u4e8e\u5bf9\u5e94\u7684\u52a8\u4f5c\uff0c\u597d\u4e86\uff0c\u90a3\u4e48\u600e\u6837\u7528\u547d\u4ee4\u53bb\u5b9a\u4e49\u8fd9\u6761\u89c4\u5219\u5462\uff1f\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u5373\u53ef</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u4f7f\u7528 -t\u9009\u9879\u6307\u5b9a\u4e86\u8981\u64cd\u4f5c\u7684\u8868\uff0c\u6b64\u5904\u6307\u5b9a\u4e86\u64cd\u4f5cfilter\u8868\uff0c\u4e0e\u4e4b\u524d\u7684\u67e5\u770b\u547d\u4ee4\u4e00\u6837\uff0c\u4e0d\u4f7f\u7528-t\u9009\u9879\u6307\u5b9a\u8868\u65f6\uff0c\u9ed8\u8ba4\u4e3a\u64cd\u4f5cfilter\u8868\u3002</p> <p>\u4f7f\u7528-I\u9009\u9879\uff0c\u6307\u660e\u5c06\u201d\u89c4\u5219\u201d\u63d2\u5165\u81f3\u54ea\u4e2a\u94fe\u4e2d\uff0c-I\u8868\u793ainsert\uff0c\u5373\u63d2\u5165\u7684\u610f\u601d\uff0c\u6240\u4ee5-I INPUT\u8868\u793a\u5c06\u89c4\u5219\u63d2\u5165\u4e8eINPUT\u94fe\u4e2d\uff0c\u5373\u6dfb\u52a0\u89c4\u5219\u4e4b\u610f\u3002</p> <p>\u4f7f\u7528-s\u9009\u9879\uff0c\u6307\u660e\u201d\u5339\u914d\u6761\u4ef6\u201d\u4e2d\u7684\u201d\u6e90\u5730\u5740\u201d\uff0c\u5373\u5982\u679c\u62a5\u6587\u7684\u6e90\u5730\u5740\u5c5e\u4e8e-s\u5bf9\u5e94\u7684\u5730\u5740\uff0c\u90a3\u4e48\u62a5\u6587\u5219\u6ee1\u8db3\u5339\u914d\u6761\u4ef6\uff0c-s\u4e3asource\u4e4b\u610f\uff0c\u8868\u793a\u6e90\u5730\u5740\u3002</p> <p>\u4f7f\u7528-j\u9009\u9879\uff0c\u6307\u660e\u5f53\u201d\u5339\u914d\u6761\u4ef6\u201d\u88ab\u6ee1\u8db3\u65f6\uff0c\u6240\u5bf9\u5e94\u7684\u52a8\u4f5c\uff0c\u4e0a\u4f8b\u4e2d\u6307\u5b9a\u7684\u52a8\u4f5c\u4e3aDROP\uff0c\u5728\u4e0a\u4f8b\u4e2d\uff0c\u5f53\u62a5\u6587\u7684\u6e90\u5730\u5740\u4e3a192.168.1.146\u65f6\uff0c\u62a5\u6587\u5219\u88abDROP\uff08\u4e22\u5f03\uff09\u3002</p> <p>\u518d\u6b21\u67e5\u770bfilter\u8868\u4e2d\u7684INPUT\u94fe\uff0c\u53d1\u73b0\u89c4\u5219\u5df2\u7ecf\u88ab\u6dfb\u52a0\u4e86\uff0c\u5728iptables\u4e2d\uff0c\u52a8\u4f5c\u88ab\u79f0\u4e4b\u4e3a\u201dtarget\u201d\uff0c\u6240\u4ee5\uff0c\u4e0a\u56fe\u4e2dtaget\u5b57\u6bb5\u5bf9\u5e94\u7684\u52a8\u4f5c\u4e3aDROP\u3002</p> <p>\u90a3\u4e48\u6b64\u65f6\uff0c\u6211\u4eec\u518d\u901a\u8fc7192.168.1.146\u53bbping\u4e3b\u673a156\uff0c\u770b\u770b\u80fd\u5426ping\u901a\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0cping 156\u4e3b\u673a\u65f6\uff0cPING\u547d\u4ee4\u4e00\u76f4\u6ca1\u6709\u5f97\u5230\u56de\u5e94\uff0c\u770b\u6765\u6211\u4eec\u7684iptables\u89c4\u5219\u5df2\u7ecf\u751f\u6548\u4e86\uff0cping\u53d1\u9001\u7684\u62a5\u6587\u538b\u6839\u6ca1\u6709\u88ab156\u4e3b\u673a\u63a5\u53d7\uff0c\u800c\u662f\u88ab\u4e22\u5f03\u4e86\uff0c\u6240\u4ee5\u66f4\u4e0d\u8981\u8bf4\u4ec0\u4e48\u56de\u5e94\u4e86\uff0c\u597d\u4e86\uff0c\u6211\u4eec\u5df2\u7ecf\u6210\u529f\u7684\u914d\u7f6e\u4e86\u4e00\u6761iptables\u89c4\u5219\uff0c\u770b\u6765\uff0c\u6211\u4eec\u5df2\u7ecf\u5165\u95e8\u4e86\u3002</p> <p>\u8fd8\u8bb0\u5f97\u6211\u4eec\u5728\u524d\u6587\u4e2d\u8bf4\u8fc7\u7684\u201d\u8ba1\u6570\u5668\u201d\u5417\uff1f\u6b64\u65f6\uff0c\u6211\u4eec\u518d\u6b21\u67e5\u770biptables\u4e2d\u7684\u89c4\u5219\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u5df2\u7ecf\u670924\u4e2a\u5305\u88ab\u5bf9\u5e94\u7684\u89c4\u5219\u5339\u914d\u5230\uff0c\u603b\u8ba1\u5927\u5c0f2016bytes\u3002</p> <p></p> <p>\u6b64\u523b\uff0c\u6211\u4eec\u6765\u505a\u4e00\u4e2a\u5b9e\u9a8c\u3002</p> <p>\u73b0\u5728INPUT\u94fe\u4e2d\u5df2\u7ecf\u5b58\u5728\u4e86\u4e00\u6761\u89c4\u5219\uff0c\u5b83\u62d2\u7edd\u4e86\u6240\u6709\u6765\u81ea192.168.1.146\u4e3b\u673a\u4e2d\u7684\u62a5\u6587\uff0c\u5982\u679c\u6b64\u65f6\uff0c\u6211\u4eec\u5728\u8fd9\u6761\u89c4\u5219\u4e4b\u540e\u518d\u914d\u7f6e\u4e00\u6761\u89c4\u5219\uff0c\u540e\u9762\u8fd9\u6761\u89c4\u5219\u89c4\u5b9a\uff0c\u63a5\u53d7\u6240\u6709\u6765\u81ea192.168.1.146\u4e3b\u673a\u4e2d\u7684\u62a5\u6587\uff0c\u90a3\u4e48\uff0ciptables\u662f\u5426\u4f1a\u63a5\u53d7\u6765\u81ea146\u4e3b\u673a\u7684\u62a5\u6587\u5462\uff1f\u6211\u4eec\u52a8\u624b\u8bd5\u8bd5\u3002</p> <p>\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u5728filter\u8868\u7684INPUT\u94fe\u4e2d\u8ffd\u52a0\u4e00\u6761\u89c4\u5219\uff0c\u8fd9\u6761\u89c4\u5219\u8868\u793a\u63a5\u53d7\u6240\u6709\u6765\u81ea192.168.1.146\u7684\u53d1\u5f80\u672c\u673a\u7684\u62a5\u6587\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u7684\u547d\u4ee4\u5e76\u6ca1\u6709\u4f7f\u7528-t\u9009\u9879\u6307\u5b9afilter\u8868\uff0c\u6211\u4eec\u4e00\u76f4\u5728\u8bf4\uff0c\u4e0d\u4f7f\u7528-t\u9009\u9879\u6307\u5b9a\u8868\u65f6\u8868\u793a\u9ed8\u8ba4\u64cd\u4f5cfilter\u8868\u3002</p> <p>\u4e0a\u56fe\u4e2d\uff0c\u4f7f\u7528-A\u9009\u9879\uff0c\u8868\u793a\u5728\u5bf9\u5e94\u7684\u94fe\u4e2d\u201d\u8ffd\u52a0\u89c4\u5219\u201d\uff0c-A\u4e3aappend\u4e4b\u610f\uff0c\u6240\u4ee5\uff0c-A INPUT\u5219\u8868\u793a\u5728INPUT\u94fe\u4e2d\u8ffd\u52a0\u89c4\u5219\uff0c\u800c\u4e4b\u524d\u793a\u4f8b\u4e2d\u4f7f\u7528\u7684-I\u9009\u9879\u5219\u8868\u793a\u5728\u94fe\u4e2d\u201d\u63d2\u5165\u89c4\u5219\u201d\uff0c\u806a\u660e\u5982\u4f60\u4e00\u5b9a\u660e\u767d\u4e86\uff0c\u5b83\u4eec\u7684\u672c\u610f\u90fd\u662f\u6dfb\u52a0\u4e00\u6761\u89c4\u5219\uff0c\u53ea\u662f-A\u8868\u793a\u5728\u94fe\u7684\u5c3e\u90e8\u8ffd\u52a0\u89c4\u5219\uff0c-I\u8868\u793a\u5728\u94fe\u7684\u9996\u90e8\u63d2\u5165\u89c4\u5219\u800c\u5df2\u3002</p> <p>\u4f7f\u7528-j\u9009\u9879\uff0c\u6307\u5b9a\u5f53\u524d\u89c4\u5219\u5bf9\u5e94\u7684\u52a8\u4f5c\u4e3aACCEPT\u3002</p> <p>\u6267\u884c\u5b8c\u6dfb\u52a0\u89c4\u5219\u7684\u547d\u4ee4\u540e\uff0c\u518d\u6b21\u67e5\u770bINPUT\u94fe\uff0c\u53d1\u73b0\u89c4\u5219\u5df2\u7ecf\u6210\u529f\u201d\u8ffd\u52a0\u201d\u81f3INPUT\u94fe\u7684\u672b\u5c3e\uff0c\u90a3\u4e48\u73b0\u5728\uff0c\u7b2c\u4e00\u6761\u89c4\u5219\u6307\u660e\u4e86\u4e22\u5f03\u6240\u6709\u6765\u81ea192.168.1.146\u7684\u62a5\u6587\uff0c\u7b2c\u4e8c\u6761\u89c4\u5219\u6307\u660e\u4e86\u63a5\u53d7\u6240\u6709\u6765\u81ea192.168.1.146\u7684\u62a5\u6587\uff0c\u90a3\u4e48\u7ed3\u679c\u5230\u5e95\u662f\u600e\u6837\u7684\u5462\uff1f\u5b9e\u8df5\u51fa\u771f\u77e5\uff0c\u5728146\u4e3b\u673a\u4e0a\u518d\u6b21\u4f7f\u7528ping\u547d\u4ee4\u5411156\u4e3b\u673a\u53d1\u9001\u62a5\u6587\uff0c\u53d1\u73b0\u4ecd\u7136\u662fping\u4e0d\u901a\u7684\uff0c\u770b\u6765\u7b2c\u4e8c\u6761\u89c4\u5219\u5e76\u6ca1\u6709\u751f\u6548\u3002</p> <p></p> <p>\u800c\u4e14\u4ece\u4e0a\u56fe\u4e2d\u7b2c\u4e8c\u6761\u89c4\u5219\u7684\u8ba1\u6570\u5668\u53ef\u4ee5\u770b\u5230\uff0c\u6839\u672c\u6ca1\u6709\u4efb\u4f55\u62a5\u6587\u88ab\u7b2c\u4e8c\u6761\u89c4\u5219\u5339\u914d\u5230\u3002</p> <p>\u806a\u660e\u5982\u4f60\u4e00\u5b9a\u5728\u731c\u60f3\uff0c\u53d1\u751f\u4e0a\u8ff0\u60c5\u51b5\uff0c\u4f1a\u4e0d\u4f1a\u4e0e\u89c4\u5219\u7684\u5148\u540e\u987a\u5e8f\u6709\u5173\u5462\uff1f\u6d4b\u8bd5\u4e00\u4e0b\u4e0d\u5c31\u77e5\u9053\u4e86\uff0c\u6211\u4eec\u518d\u6dfb\u52a0\u4e00\u6761\u89c4\u5219\uff0c\u65b0\u89c4\u5219\u4ecd\u7136\u89c4\u5b9a\u63a5\u53d7\u6240\u6709\u6765\u81ea192.168.1.146\u4e3b\u673a\u4e2d\u7684\u62a5\u6587\uff0c\u53ea\u662f\u8fd9\u4e00\u6b21\uff0c\u6211\u4eec\u5c06\u65b0\u89c4\u5219\u6dfb\u52a0\u81f3INPUT\u94fe\u7684\u6700\u524d\u9762\u8bd5\u8bd5\u3002</p> <p>\u5728\u6dfb\u52a0\u8fd9\u6761\u89c4\u5219\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u628a146\u4e0a\u7684ping\u547d\u4ee4\u5f3a\u5236\u505c\u6b62\u4e86\uff0c\u7136\u540e\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff0c\u5728filter\u8868\u7684INPUT\u94fe\u7684\u524d\u7aef\u6dfb\u52a0\u65b0\u89c4\u5219\u3002</p> <p></p> <p>\u597d\u4e86\uff0c\u73b0\u5728\u7b2c\u4e00\u6761\u89c4\u5219\u5c31\u662f\u63a5\u53d7\u6240\u6709\u6765\u81ea192.168.1.146\u7684\u62a5\u6587\uff0c\u800c\u4e14\u6b64\u65f6\u8ba1\u6570\u662f0\uff0c\u6b64\u523b\uff0c\u6211\u4eec\u518d\u4ece146\u4e0a\u5411156\u53d1\u8d77ping\u8bf7\u6c42\u3002</p> <p></p> <p>146\u4e0a\u5df2\u7ecf\u53ef\u4ee5\u6b63\u5e38\u7684\u6536\u5230\u54cd\u5e94\u62a5\u6587\u4e86\uff0c\u90a3\u4e48\u56de\u5230156\u67e5\u770bINPUT\u94fe\u7684\u89c4\u5219\uff0c\u7b2c\u4e00\u6761\u89c4\u5219\u7684\u8ba1\u6570\u5668\u5df2\u7ecf\u663e\u793a\u51fa\u4e86\u5339\u914d\u5230\u7684\u62a5\u6587\u6570\u91cf\u3002</p> <p></p> <p>\u770b\u6765\uff0c\u89c4\u5219\u7684\u987a\u5e8f\u5f88\u91cd\u8981\u3002</p> <p>\u5982\u679c\u62a5\u6587\u5df2\u7ecf\u88ab\u524d\u9762\u7684\u89c4\u5219\u5339\u914d\u5230\uff0ciptables\u5219\u4f1a\u5bf9\u62a5\u6587\u6267\u884c\u5bf9\u5e94\u7684\u52a8\u4f5c\uff0c\u5373\u4f7f\u540e\u9762\u7684\u89c4\u5219\u4e5f\u80fd\u5339\u914d\u5230\u5f53\u524d\u62a5\u6587\uff0c\u5f88\u6709\u53ef\u80fd\u4e5f\u6ca1\u6709\u673a\u4f1a\u518d\u5bf9\u62a5\u6587\u6267\u884c\u76f8\u5e94\u7684\u52a8\u4f5c\u4e86\uff0c\u5c31\u4ee5\u4e0a\u56fe\u4e3a\u4f8b\uff0c\u62a5\u6587\u5148\u88ab\u7b2c\u4e00\u6761\u89c4\u5219\u5339\u914d\u5230\u4e86\uff0c\u4e8e\u662f\u5f53\u524d\u62a5\u6587\u88ab\u201d\u653e\u884c\u201d\u4e86\uff0c\u56e0\u4e3a\u62a5\u6587\u5df2\u7ecf\u88ab\u653e\u884c\u4e86\uff0c\u6240\u4ee5\uff0c\u5373\u4f7f\u4e0a\u56fe\u4e2d\u7684\u7b2c\u4e8c\u6761\u89c4\u5219\u5373\u4f7f\u80fd\u591f\u5339\u914d\u5230\u521a\u624d\u201d\u653e\u884c\u201d\u7684\u62a5\u6587\uff0c\u4e5f\u6ca1\u6709\u673a\u4f1a\u518d\u5bf9\u521a\u624d\u7684\u62a5\u6587\u8fdb\u884c\u4e22\u5f03\u64cd\u4f5c\u4e86\u3002\u8fd9\u5c31\u662fiptables\u7684\u5de5\u4f5c\u673a\u5236\u3002</p> <p>\u4e4b\u524d\u5728\u603b\u7ed3\u67e5\u770b\u547d\u4ee4\u65f6\u63d0\u5230\u8fc7\uff0c\u4f7f\u7528\u2013line-number\u9009\u9879\u53ef\u4ee5\u5217\u51fa\u89c4\u5219\u7684\u5e8f\u53f7\uff0c\u5982\u4e0b\u56fe\u6240\u793a</p> <p></p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u6dfb\u52a0\u89c4\u5219\u65f6\uff0c\u6307\u5b9a\u65b0\u589e\u89c4\u5219\u7684\u7f16\u53f7\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u80fd\u5728\u4efb\u610f\u4f4d\u7f6e\u63d2\u5165\u89c4\u5219\u4e86\uff0c\u6211\u4eec\u53ea\u8981\u628a\u521a\u624d\u7684\u547d\u4ee4\u7a0d\u4f5c\u4fee\u6539\u5373\u53ef\uff0c\u5982\u4e0b\u3002</p> <p></p> <p>\u4ecd\u7136\u4f7f\u7528-I\u9009\u9879\u8fdb\u884c\u63d2\u5165\u89c4\u5219\u64cd\u4f5c\uff0c-I INPUT 2\u8868\u793a\u5728INPUT\u94fe\u4e2d\u65b0\u589e\u89c4\u5219\uff0c\u65b0\u589e\u7684\u89c4\u5219\u7684\u7f16\u53f7\u4e3a2\uff0c\u597d\u4e86\uff0c\u81ea\u5df1\u52a8\u624b\u8bd5\u8bd5\u5427\u3002</p>"},{"location":"iptables_3/#_2","title":"\u5220\u9664\u89c4\u5219","text":"<p>\u6ce8\u610f\uff1a\u5728\u53c2\u7167\u672c\u6587\u8fdb\u884ciptables\u5b9e\u9a8c\u65f6\uff0c\u8bf7\u52a1\u5fc5\u5728\u4e2a\u4eba\u7684\u6d4b\u8bd5\u673a\u4e0a\u8fdb\u884c\u3002</p> <p>\u6b64\u523b\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8981\u5220\u9664filter\u8868\u4e2dINPUT\u4e2d\u7684\u4e00\u6761\u89c4\u5219\uff0c\u8be5\u600e\u4e48\u505a\u5462\uff1f</p> <p>\u6709\u4e24\u79cd\u529e\u6cd5</p> <p>\u65b9\u6cd5\u4e00\uff1a\u6839\u636e\u89c4\u5219\u7684\u7f16\u53f7\u53bb\u5220\u9664\u89c4\u5219</p> <p>\u65b9\u6cd5\u4e8c\uff1a\u6839\u636e\u5177\u4f53\u7684\u5339\u914d\u6761\u4ef6\u4e0e\u52a8\u4f5c\u5220\u9664\u89c4\u5219</p> <p>\u90a3\u4e48\u6211\u4eec\u5148\u770b\u770b\u65b9\u6cd5\u4e00\uff0c\u5148\u67e5\u770b\u4e00\u4e0bfilter\u8868\u4e2dINPUT\u94fe\u4e2d\u7684\u89c4\u5219</p> <p></p> <p>\u5047\u5982\u6211\u4eec\u60f3\u8981\u5220\u9664\u4e0a\u56fe\u4e2d\u7684\u7b2c3\u6761\u89c4\u5219\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u3002</p> <p></p> <p>\u4e0a\u4f8b\u4e2d\uff0c\u4f7f\u7528\u4e86-t\u9009\u9879\u6307\u5b9a\u4e86\u8981\u64cd\u4f5c\u7684\u8868\uff08\u6ca1\u9519\uff0c\u7701\u7565-t\u9ed8\u8ba4\u8868\u793a\u64cd\u4f5cfilter\u8868\uff09\uff0c\u4f7f\u7528-D\u9009\u9879\u8868\u793a\u5220\u9664\u6307\u5b9a\u94fe\u4e2d\u7684\u67d0\u6761\u89c4\u5219\uff0c-D INPUT 3\u8868\u793a\u5220\u9664INPUT\u94fe\u4e2d\u7684\u7b2c3\u6761\u89c4\u5219\u3002</p> <p>\u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u6839\u636e\u5177\u4f53\u7684\u5339\u914d\u6761\u4ef6\u4e0e\u52a8\u4f5c\u53bb\u5220\u9664\u89c4\u5219\uff0c\u6bd4\u5982\uff0c\u5220\u9664\u4e0b\u56fe\u4e2d\u6e90\u5730\u5740\u4e3a192.168.1.146\uff0c\u52a8\u4f5c\u4e3aACCEPT\u7684\u89c4\u5219\uff0c\u4e8e\u662f\uff0c\u5220\u9664\u89c4\u5219\u7684\u547d\u4ee4\u5982\u4e0b\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u5220\u9664\u5bf9\u5e94\u89c4\u5219\u65f6\uff0c\u4ecd\u7136\u4f7f\u7528-D\u9009\u9879\uff0c-D INPUT\u8868\u793a\u5220\u9664INPUT\u94fe\u4e2d\u7684\u89c4\u5219\uff0c\u5269\u4e0b\u7684\u9009\u9879\u4e0e\u6211\u4eec\u6dfb\u52a0\u89c4\u5219\u65f6\u4e00\u6bdb\u4e00\u6837\uff0c-s\u8868\u793a\u4ee5\u5bf9\u5e94\u7684\u6e90\u5730\u5740\u4f5c\u4e3a\u5339\u914d\u6761\u4ef6\uff0c-j ACCEPT\u8868\u793a\u5bf9\u5e94\u7684\u52a8\u4f5c\u4e3a\u63a5\u53d7\uff0c\u6240\u4ee5\uff0c\u4e0a\u8ff0\u547d\u4ee4\u8868\u793a\u5220\u9664INPUT\u94fe\u4e2d\u6e90\u5730\u5740\u4e3a192.168.1.146\uff0c\u52a8\u4f5c\u4e3aACCEPT\u7684\u89c4\u5219\u3002</p> <p>\u800c\u5220\u9664\u6307\u5b9a\u8868\u4e2d\u67d0\u6761\u94fe\u4e2d\u7684\u6240\u6709\u89c4\u5219\u7684\u547d\u4ee4\uff0c\u6211\u4eec\u5728\u4e00\u5f00\u59cb\u5c31\u4f7f\u7528\u5230\u4e86\uff0c\u5c31\u662f\u201diptables -t \u8868\u540d -F \u94fe\u540d\u201d</p> <p>-F\u9009\u9879\u4e3aflush\u4e4b\u610f\uff0c\u5373\u51b2\u5237\u6307\u5b9a\u7684\u94fe\uff0c\u5373\u5220\u9664\u6307\u5b9a\u94fe\u4e2d\u7684\u6240\u6709\u89c4\u5219\uff0c\u4f46\u662f\u6ce8\u610f\uff0c\u6b64\u64cd\u4f5c\u76f8\u5f53\u4e8e\u5220\u9664\u64cd\u4f5c\uff0c\u5728\u6ca1\u6709\u4fdd\u5b58iptables\u89c4\u5219\u7684\u60c5\u51b5\u4e0b\uff0c\u8bf7\u614e\u7528\u3002</p> <p>\u5176\u5b9e\uff0c-F\u9009\u9879\u4e0d\u4ec5\u4ec5\u80fd\u6e05\u7a7a\u6307\u5b9a\u94fe\u4e0a\u7684\u89c4\u5219\uff0c\u5176\u5b9e\u5b83\u8fd8\u80fd\u6e05\u7a7a\u6574\u4e2a\u8868\u4e2d\u6240\u6709\u94fe\u4e0a\u7684\u89c4\u5219\uff0c\u4e0d\u6307\u5b9a\u94fe\u540d\uff0c\u53ea\u6307\u5b9a\u8868\u540d\u5373\u53ef\u5220\u9664\u8868\u4e2d\u7684\u6240\u6709\u89c4\u5219\uff0c\u547d\u4ee4\u5982\u4e0b</p> <p>iptables -t \u8868\u540d -F</p> <p>\u4e0d\u8fc7\u518d\u6b21\u5f3a\u8c03\uff0c\u5728\u6ca1\u6709\u4fdd\u5b58iptables\u89c4\u5219\u65f6\uff0c\u8bf7\u52ff\u968f\u4fbf\u6e05\u7a7a\u94fe\u6216\u8005\u8868\u4e2d\u7684\u89c4\u5219\uff0c\u9664\u975e\u4f60\u660e\u767d\u4f60\u5728\u5e72\u4ec0\u4e48\u3002</p>"},{"location":"iptables_3/#_3","title":"\u4fee\u6539\u89c4\u5219","text":"<p>\u6ce8\u610f\uff1a\u5728\u53c2\u7167\u672c\u6587\u8fdb\u884ciptables\u5b9e\u9a8c\u65f6\uff0c\u8bf7\u52a1\u5fc5\u5728\u4e2a\u4eba\u7684\u6d4b\u8bd5\u673a\u4e0a\u8fdb\u884c\u3002</p> <p>\u90a3\u4e48\uff0c\u6211\u4eec\u600e\u6837\u4fee\u6539\u67d0\u6761\u89c4\u5219\u4e2d\u7684\u52a8\u4f5c\u5462\uff1f\u6bd4\u5982\uff0c\u6211\u60f3\u628a\u5982\u4e0b\u89c4\u5219\u4e2d\u7684\u52a8\u4f5c\u4eceDROP\u6539\u4e3aREJECT\uff0c\u6539\u600e\u4e48\u529e\u5462\uff1f</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528-R\u9009\u9879\u4fee\u6539\u6307\u5b9a\u7684\u94fe\u4e2d\u7684\u89c4\u5219\uff0c\u5728\u4fee\u6539\u89c4\u5219\u65f6\u6307\u5b9a\u89c4\u5219\u5bf9\u5e94\u7684\u7f16\u53f7\u5373\u53ef(\u6709\u5751\uff0c\u614e\u884c)\uff0c\u793a\u4f8b\u547d\u4ee4\u5982\u4e0b</p> <p></p> <p>\u4e0a\u4f8b\u4e2d\uff0c-R\u9009\u9879\u8868\u793a\u4fee\u6539\u6307\u5b9a\u7684\u94fe\uff0c\u4f7f\u7528-R INPUT 1\u8868\u793a\u4fee\u6539INPUT\u94fe\u7684\u7b2c1\u6761\u89c4\u5219\uff0c\u4f7f\u7528-j REJECT\u8868\u793a\u5c06INPUT\u94fe\u4e2d\u7684\u7b2c\u4e00\u6761\u89c4\u5219\u7684\u52a8\u4f5c\u4fee\u6539\u4e3aREJECT\uff0c\u6ce8\u610f\uff1a\u4e0a\u4f8b\u4e2d\uff0c -s\u9009\u9879\u4ee5\u53ca\u5bf9\u5e94\u7684\u6e90\u5730\u5740\u4e0d\u53ef\u7701\u7565\uff0c\u5373\u4f7f\u6211\u4eec\u5df2\u7ecf\u6307\u5b9a\u4e86\u89c4\u5219\u5bf9\u5e94\u7684\u7f16\u53f7\uff0c\u4f46\u662f\u5728\u4f7f\u7528-R\u9009\u9879\u4fee\u6539\u67d0\u4e2a\u89c4\u5219\u65f6\uff0c\u5fc5\u987b\u6307\u5b9a\u89c4\u5219\u5bf9\u5e94\u7684\u539f\u672c\u7684\u5339\u914d\u6761\u4ef6\uff08\u5982\u679c\u6709\u591a\u4e2a\u5339\u914d\u6761\u4ef6\uff0c\u90fd\u9700\u8981\u6307\u5b9a\uff09\u3002</p> <p>\u5982\u679c\u4e0a\u4f8b\u4e2d\u7684\u547d\u4ee4\u6ca1\u6709\u4f7f\u7528-s\u6307\u5b9a\u5bf9\u5e94\u89c4\u5219\u4e2d\u539f\u672c\u7684\u6e90\u5730\u5740\uff0c\u90a3\u4e48\u5728\u4fee\u6539\u5b8c\u6210\u540e\uff0c\u4f60\u4fee\u6539\u7684\u89c4\u5219\u4e2d\u7684\u6e90\u5730\u5740\u4f1a\u81ea\u52a8\u53d8\u4e3a0.0.0.0/0\uff08\u6b64IP\u8868\u793a\u5339\u914d\u6240\u6709\u7f51\u6bb5\u7684IP\u5730\u5740\uff09\uff0c\u800c\u6b64\u65f6\uff0c-j\u5bf9\u5e94\u7684\u52a8\u4f5c\u53c8\u4e3aREJECT\uff0c\u6240\u4ee5\u5728\u6267\u884c\u4e0a\u8ff0\u547d\u4ee4\u65f6\u5982\u679c\u6ca1\u6709\u6307\u660e\u89c4\u5219\u539f\u672c\u7684\u6e90\u5730\u5740\uff0c\u90a3\u4e48\u6240\u6709IP\u7684\u8bf7\u6c42\u90fd\u88ab\u62d2\u7edd\u4e86\uff08\u56e0\u4e3a\u6ca1\u6709\u6307\u5b9a\u539f\u672c\u7684\u6e90\u5730\u5740\uff0c\u5f53\u524d\u89c4\u5219\u7684\u6e90\u5730\u5740\u81ea\u52a8\u53d8\u4e3a0.0.0.0/0\uff09\uff0c\u5982\u679c\u4f60\u6b63\u5728\u4f7f\u7528ssh\u8fdc\u7a0b\u5230\u670d\u52a1\u5668\u4e0a\u8fdb\u884ciptables\u8bbe\u7f6e\uff0c\u90a3\u4e48\u4f60\u7684ssh\u8bf7\u6c42\u4e5f\u5c06\u4f1a\u88ab\u963b\u65ad\u3002</p> <p>\u65e2\u7136\u4f7f\u7528-R\u9009\u9879\u4fee\u6539\u89c4\u5219\u65f6\uff0c\u5fc5\u987b\u6307\u660e\u89c4\u5219\u539f\u672c\u7684\u5339\u914d\u6761\u4ef6\uff0c\u90a3\u4e48\u6211\u4eec\u5219\u53ef\u4ee5\u7406\u89e3\u4e3a\uff0c\u53ea\u80fd\u901a\u8fc7-R\u9009\u9879\u4fee\u6539\u89c4\u5219\u5bf9\u5e94\u7684\u52a8\u4f5c\u4e86\uff0c\u6240\u4ee5\u6211\u89c9\u5f97\uff0c\u5982\u679c\u4f60\u60f3\u8981\u4fee\u6539\u67d0\u6761\u89c4\u5219\uff0c\u8fd8\u4e0d\u5982\u5148\u5c06\u8fd9\u6761\u89c4\u5219\u5220\u9664\uff0c\u7136\u540e\u5728\u540c\u6837\u4f4d\u7f6e\u518d\u63d2\u5165\u4e00\u6761\u65b0\u89c4\u5219\uff0c\u8fd9\u6837\u66f4\u597d\uff0c\u5f53\u7136\uff0c\u5982\u679c\u4f60\u53ea\u662f\u4e3a\u4e86\u4fee\u6539\u67d0\u6761\u89c4\u5219\u7684\u52a8\u4f5c\uff0c\u90a3\u4e48\u4f7f\u7528-R\u9009\u9879\u65f6\uff0c\u4e0d\u8981\u5fd8\u4e86\u6307\u660e\u89c4\u5219\u539f\u672c\u5bf9\u5e94\u7684\u5339\u914d\u6761\u4ef6\u3002</p> <p>\u597d\u4e86\uff0c\u4e0a\u4f8b\u4e2d\uff0c\u6211\u4eec\u5df2\u7ecf\u5c06\u89c4\u5219\u4e2d\u7684\u52a8\u4f5c\u4eceDROP\u6539\u4e3a\u4e86REJECT\uff0c\u90a3\u4e48DROP\u4e0eREJECT\u6709\u4ec0\u4e48\u4e0d\u540c\u5462\uff1f\u4ece\u5b57\u9762\u4e0a\u7406\u89e3\uff0cDROP\u8868\u793a\u4e22\u5f03\uff0cREJECT\u8868\u793a\u62d2\u7edd\uff0cREJECT\u8868\u8fbe\u7684\u610f\u601d\u597d\u50cf\u66f4\u575a\u51b3\u4e00\u70b9\uff0c\u6211\u4eec\u518d\u6b21\u4ece146\u4e3b\u673a\u4e0a\u5411156\u4e3b\u673a\u4e0a\u53d1\u8d77ping\u8bf7\u6c42\uff0c\u770b\u770b\u4e0e\u4e4b\u524d\u52a8\u4f5c\u4e3aDROP\u65f6\u6709\u4ec0\u4e48\u4e0d\u540c\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5f53156\u4e3b\u673a\u4e2d\u7684iptables\u89c4\u5219\u5bf9\u5e94\u7684\u52a8\u4f5c\u4e3aREJECT\u65f6\uff0c\u4ece146\u4e0a\u8fdb\u884cping\u64cd\u4f5c\u65f6\uff0c\u76f4\u63a5\u5c31\u63d0\u793a\u201d\u76ee\u6807\u4e0d\u53ef\u8fbe\u201d\uff0c\u5e76\u6ca1\u6709\u50cf\u4e4b\u524d\u90a3\u6837\u5361\u5728\u90a3\u91cc\uff0c\u770b\u6765\uff0cREJECT\u6bd4DROP\u66f4\u52a0\u201d\u5e72\u8106\u201d\u3002</p> <p>\u5176\u5b9e\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4fee\u6539\u6307\u5b9a\u94fe\u7684\u201d\u9ed8\u8ba4\u7b56\u7565\u201d\uff0c\u6ca1\u9519\uff0c\u5c31\u662f\u4e0b\u56fe\u4e2d\u6807\u6ce8\u7684\u9ed8\u8ba4\u7b56\u7565\u3002</p> <p></p> <p>\u6bcf\u5f20\u8868\u7684\u6bcf\u6761\u94fe\u4e2d\uff0c\u90fd\u6709\u81ea\u5df1\u7684\u9ed8\u8ba4\u7b56\u7565\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3a\u9ed8\u8ba4\u201d\u52a8\u4f5c\u201d\u3002</p> <p>\u5f53\u62a5\u6587\u6ca1\u6709\u88ab\u94fe\u4e2d\u7684\u4efb\u4f55\u89c4\u5219\u5339\u914d\u5230\u65f6\uff0c\u6216\u8005\uff0c\u5f53\u94fe\u4e2d\u6ca1\u6709\u4efb\u4f55\u89c4\u5219\u65f6\uff0c\u9632\u706b\u5899\u4f1a\u6309\u7167\u9ed8\u8ba4\u52a8\u4f5c\u5904\u7406\u62a5\u6587\uff0c\u6211\u4eec\u53ef\u4ee5\u4fee\u6539\u6307\u5b9a\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\uff0c\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u5373\u53ef\u3002</p> <p></p> <p>\u4f7f\u7528-t\u6307\u5b9a\u8981\u64cd\u4f5c\u7684\u8868\uff0c\u4f7f\u7528-P\u9009\u9879\u6307\u5b9a\u8981\u4fee\u6539\u7684\u94fe\uff0c\u4e0a\u4f8b\u4e2d\uff0c-P FORWARD DROP\u8868\u793a\u5c06\u8868\u4e2dFORWRD\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u6539\u4e3aDROP\u3002</p>"},{"location":"iptables_3/#_4","title":"\u4fdd\u5b58\u89c4\u5219","text":"<p>\u5728\u9ed8\u8ba4\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5bf9\u201d\u9632\u706b\u5899\u201d\u6240\u505a\u51fa\u7684\u4fee\u6539\u90fd\u662f\u201d\u4e34\u65f6\u7684\u201d\uff0c\u6362\u53e5\u8bdd\u8bf4\u5c31\u662f\uff0c\u5f53\u91cd\u542fiptables\u670d\u52a1\u6216\u8005\u91cd\u542f\u670d\u52a1\u5668\u4ee5\u540e\uff0c\u6211\u4eec\u5e73\u5e38\u6dfb\u52a0\u7684\u89c4\u5219\u6216\u8005\u5bf9\u89c4\u5219\u6240\u505a\u51fa\u7684\u4fee\u6539\u90fd\u5c06\u6d88\u5931\uff0c\u4e3a\u4e86\u9632\u6b62\u8fd9\u79cd\u60c5\u51b5\u7684\u53d1\u751f\uff0c\u6211\u4eec\u9700\u8981\u5c06\u89c4\u5219\u201d\u4fdd\u5b58\u201d\u3002</p> <p>centos7\u4e0ecentos6\u4e2d\u7684\u60c5\u51b5\u7a0d\u5fae\u6709\u4e9b\u4e0d\u540c\uff0c\u6211\u4eec\u5148\u8bf4centos6\u4e2d\u600e\u6837\u4fdd\u5b58iptables\u89c4\u5219\u3002</p> <p>centos6\u4e2d\uff0c\u4f7f\u7528\u201dservice iptables save\u201d\u547d\u4ee4\u5373\u53ef\u4fdd\u5b58\u89c4\u5219\uff0c\u89c4\u5219\u9ed8\u8ba4\u4fdd\u5b58\u5728/etc/sysconfig/iptables\u6587\u4ef6\u4e2d\uff0c\u5982\u679c\u4f60\u521a\u521a\u5b89\u88c5\u5b8ccentos6\uff0c\u5728\u521a\u5f00\u59cb\u4f7f\u7528iptables\u65f6\uff0c\u4f1a\u53d1\u73b0filter\u8868\u4e2d\u4f1a\u6709\u4e00\u4e9b\u9ed8\u8ba4\u7684\u89c4\u5219\uff0c\u8fd9\u4e9b\u9ed8\u8ba4\u63d0\u4f9b\u7684\u89c4\u5219\u5176\u5b9e\u5c31\u4fdd\u5b58\u5728/etc/sysconfig/iptables\u4e2d\uff0c \u00a0\u4fdd\u5b58\u89c4\u5219\u7684\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u6587\u4ef6\u4e2d\u4fdd\u5b58\u4e86filter\u8868\u4e2d\u6bcf\u6761\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\uff0c\u4ee5\u53ca\u6bcf\u6761\u94fe\u4e2d\u7684\u89c4\u5219\uff0c\u7531\u4e8e\u5176\u4ed6\u8868\u4e2d\u5e76\u6ca1\u6709\u8bbe\u7f6e\u89c4\u5219\uff0c\u4e5f\u6ca1\u6709\u4f7f\u7528\u8fc7\u5176\u4ed6\u8868\uff0c\u6240\u4ee5\u6587\u4ef6\u4e2d\u53ea\u4fdd\u5b58\u4e86filter\u8868\u4e2d\u7684\u89c4\u5219\u3002</p> <p>\u5f53\u6211\u4eec\u5bf9\u89c4\u5219\u8fdb\u884c\u4e86\u4fee\u6539\u4ee5\u540e\uff0c\u5982\u679c\u60f3\u8981\u4fee\u6539\u6c38\u4e45\u751f\u6548\uff0c\u5fc5\u987b\u4f7f\u7528service iptables save\u4fdd\u5b58\u89c4\u5219\uff0c\u5f53\u7136\uff0c\u5982\u679c\u4f60\u8bef\u64cd\u4f5c\u4e86\u89c4\u5219\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u4fdd\u5b58\uff0c\u90a3\u4e48\u4f7f\u7528service iptables restart\u547d\u4ee4\u91cd\u542fiptables\u4ee5\u540e\uff0c\u89c4\u5219\u4f1a\u518d\u6b21\u56de\u5230\u4e0a\u6b21\u4fdd\u5b58/etc/sysconfig/iptables\u6587\u4ef6\u65f6\u7684\u6a21\u6837\u3002</p> <p>\u4ece\u73b0\u5728\u5f00\u59cb\uff0c\u6700\u597d\u517b\u6210\u53ca\u65f6\u4fdd\u5b58\u89c4\u5219\u7684\u597d\u4e60\u60ef\u3002</p> <p>centos7\u4e2d\uff0c\u5df2\u7ecf\u4e0d\u518d\u4f7f\u7528init\u98ce\u683c\u7684\u811a\u672c\u542f\u52a8\u670d\u52a1\uff0c\u800c\u662f\u4f7f\u7528unit\u6587\u4ef6\uff0c\u6240\u4ee5\uff0c\u5728centos7\u4e2d\u5df2\u7ecf\u4e0d\u80fd\u518d\u4f7f\u7528\u7c7b\u4f3cservice iptables start\u8fd9\u6837\u7684\u547d\u4ee4\u4e86\uff0c\u6240\u4ee5service iptables save\u4e5f\u65e0\u6cd5\u6267\u884c\uff0c\u540c\u65f6\uff0c\u5728centos7\u4e2d\uff0c\u4f7f\u7528firewall\u66ff\u4ee3\u4e86\u539f\u6765\u7684iptables service\uff0c\u4e0d\u8fc7\u4e0d\u7528\u62c5\u5fc3\uff0c\u6211\u4eec\u53ea\u8981\u901a\u8fc7yum\u6e90\u5b89\u88c5iptables\u4e0eiptables-services\u5373\u53ef\uff08iptables\u4e00\u822c\u4f1a\u88ab\u9ed8\u8ba4\u5b89\u88c5\uff0c\u4f46\u662fiptables-services\u5728centos7\u4e2d\u4e00\u822c\u4e0d\u4f1a\u88ab\u9ed8\u8ba4\u5b89\u88c5\uff09\uff0c\u5728centos7\u4e2d\u5b89\u88c5\u5b8ciptables-services\u540e\uff0c\u5373\u53ef\u50cfcentos6\u4e2d\u4e00\u6837\uff0c\u901a\u8fc7service iptables save\u547d\u4ee4\u4fdd\u5b58\u89c4\u5219\u4e86\uff0c\u89c4\u5219\u540c\u6837\u4fdd\u5b58\u5728/etc/sysconfig/iptables\u6587\u4ef6\u4e2d\u3002</p> <p>\u6b64\u5904\u7ed9\u51facentos7\u4e2d\u914d\u7f6eiptables-service\u7684\u6b65\u9aa4</p> <pre><code>#\u914d\u7f6e\u597dyum\u6e90\u4ee5\u540e\u5b89\u88c5iptables-service\n#\u00a0yum\u00a0install\u00a0-y\u00a0iptables-services\n#\u505c\u6b62firewalld\n#\u00a0systemctl\u00a0stop\u00a0firewalld\n#\u7981\u6b62firewalld\u81ea\u52a8\u542f\u52a8\n#\u00a0systemctl\u00a0disable\u00a0firewalld\n#\u542f\u52a8iptables\n#\u00a0systemctl\u00a0start\u00a0iptables\n#\u5c06iptables\u8bbe\u7f6e\u4e3a\u5f00\u673a\u81ea\u52a8\u542f\u52a8\uff0c\u4ee5\u540e\u5373\u53ef\u901a\u8fc7iptables-service\u63a7\u5236iptables\u670d\u52a1\n#\u00a0systemctl\u00a0enable\u00a0iptables\n</code></pre> <p>\u4e0a\u8ff0\u914d\u7f6e\u8fc7\u7a0b\u53ea\u9700\u4e00\u6b21\uff0c\u4ee5\u540e\u5373\u53ef\u5728centos7\u4e2d\u6109\u5feb\u7684\u4f7f\u7528service iptables save\u547d\u4ee4\u4fdd\u5b58iptables\u89c4\u5219\u4e86\u3002</p> <p>\u5176\u4ed6\u901a\u7528\u65b9\u6cd5</p> <p>\u8fd8\u53ef\u4ee5\u4f7f\u7528\u53e6\u4e00\u79cd\u65b9\u6cd5\u4fdd\u5b58iptables\u89c4\u5219\uff0c\u5c31\u662f\u4f7f\u7528iptables-save\u547d\u4ee4</p> <p>\u4f7f\u7528iptables-save\u5e76\u4e0d\u80fd\u4fdd\u5b58\u5f53\u524d\u7684iptables\u89c4\u5219\uff0c\u4f46\u662f\u53ef\u4ee5\u5c06\u5f53\u524d\u7684iptables\u89c4\u5219\u4ee5\u201d\u4fdd\u5b58\u540e\u7684\u683c\u5f0f\u201d\u8f93\u51fa\u5230\u5c4f\u5e55\u4e0a\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528iptables-save\u547d\u4ee4\uff0c\u518d\u914d\u5408\u91cd\u5b9a\u5411\uff0c\u5c06\u89c4\u5219\u91cd\u5b9a\u5411\u5230/etc/sysconfig/iptables\u6587\u4ef6\u4e2d\u5373\u53ef\u3002</p> <p>iptables-save &gt; /etc/sysconfig/iptables</p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c06/etc/sysconfig/iptables\u4e2d\u7684\u89c4\u5219\u91cd\u65b0\u8f7d\u5165\u4e3a\u5f53\u524d\u7684iptables\u89c4\u5219\uff0c\u4f46\u662f\u6ce8\u610f\uff0c\u672a\u4fdd\u5b58\u5165/etc/sysconfig/iptables\u6587\u4ef6\u4e2d\u7684\u4fee\u6539\u5c06\u4f1a\u4e22\u5931\u6216\u8005\u88ab\u8986\u76d6\u3002</p> <p>\u4f7f\u7528iptables-restore\u547d\u4ee4\u53ef\u4ee5\u4ece\u6307\u5b9a\u6587\u4ef6\u4e2d\u91cd\u8f7d\u89c4\u5219\uff0c\u793a\u4f8b\u5982\u4e0b</p> <p>iptables-restore &lt; /etc/sysconfig/iptables</p> <p>\u518d\u6b21\u63d0\u9192\uff1a\u91cd\u8f7d\u89c4\u5219\u65f6\uff0c\u73b0\u6709\u89c4\u5219\u5c06\u4f1a\u88ab\u8986\u76d6\u3002</p>"},{"location":"iptables_3/#_5","title":"\u547d\u4ee4\u5c0f\u7ed3","text":"<p>\u4e0a\u6587\u5df2\u7ecf\u8be6\u7ec6\u7684\u4e3e\u4f8b\u5e76\u63cf\u8ff0\u4e86\u600e\u6837\u8fdb\u884ciptables\u89c4\u5219\u7ba1\u7406\uff0c\u4e3a\u4e86\u4ee5\u540e\u80fd\u591f\u5feb\u901f\u7684\u56de\u987e\uff0c\u6211\u4eec\u628a\u4e0a\u8ff0\u547d\u4ee4\u603b\u7ed3\u4e00\u4e0b\u3002</p>"},{"location":"iptables_3/#_6","title":"\u6dfb\u52a0\u89c4\u5219","text":"<p>\u6ce8\u610f\u70b9\uff1a\u6dfb\u52a0\u89c4\u5219\u65f6\uff0c\u89c4\u5219\u7684\u987a\u5e8f\u975e\u5e38\u91cd\u8981</p> <p>\u5728\u6307\u5b9a\u8868\u7684\u6307\u5b9a\u94fe\u7684\u5c3e\u90e8\u6dfb\u52a0\u4e00\u6761\u89c4\u5219\uff0c-A\u9009\u9879\u8868\u793a\u5728\u5bf9\u5e94\u94fe\u7684\u672b\u5c3e\u6dfb\u52a0\u89c4\u5219\uff0c\u7701\u7565-t\u9009\u9879\u65f6\uff0c\u8868\u793a\u9ed8\u8ba4\u64cd\u4f5cfilter\u8868\u4e2d\u7684\u89c4\u5219</p> <pre><code>\u547d\u4ee4\u8bed\u6cd5\uff1aiptables\u00a0-t\u00a0\u8868\u540d\u00a0-A\u00a0\u94fe\u540d\u00a0\u5339\u914d\u6761\u4ef6\u00a0-j\u00a0\u52a8\u4f5c\n\u793a\u4f8b\uff1aiptables\u00a0-t\u00a0filter\u00a0-A\u00a0INPUT\u00a0-s\u00a0192.168.1.146\u00a0-j\u00a0DROP\n</code></pre> <p>\u5728\u6307\u5b9a\u8868\u7684\u6307\u5b9a\u94fe\u7684\u9996\u90e8\u6dfb\u52a0\u4e00\u6761\u89c4\u5219\uff0c-I\u9009\u578b\u8868\u793a\u5728\u5bf9\u5e94\u94fe\u7684\u5f00\u5934\u6dfb\u52a0\u89c4\u5219</p> <pre><code>\u547d\u4ee4\u8bed\u6cd5\uff1aiptables\u00a0-t\u00a0\u8868\u540d\u00a0-I\u00a0\u94fe\u540d\u00a0\u5339\u914d\u6761\u4ef6\u00a0-j\u00a0\u52a8\u4f5c\n\u793a\u4f8b\uff1aiptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-s\u00a0192.168.1.146\u00a0-j\u00a0ACCEPT\n</code></pre> <p>\u5728\u6307\u5b9a\u8868\u7684\u6307\u5b9a\u94fe\u7684\u6307\u5b9a\u4f4d\u7f6e\u6dfb\u52a0\u4e00\u6761\u89c4\u5219</p> <pre><code>\u547d\u4ee4\u8bed\u6cd5\uff1aiptables\u00a0-t\u00a0\u8868\u540d\u00a0-I\u00a0\u94fe\u540d\u00a0\u89c4\u5219\u5e8f\u53f7\u00a0\u5339\u914d\u6761\u4ef6\u00a0-j\u00a0\u52a8\u4f5c\n\u793a\u4f8b\uff1aiptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a05\u00a0-s\u00a0192.168.1.146\u00a0-j\u00a0REJECT\n</code></pre> <p>\u8bbe\u7f6e\u6307\u5b9a\u8868\u7684\u6307\u5b9a\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\uff08\u9ed8\u8ba4\u52a8\u4f5c\uff09\uff0c\u5e76\u975e\u6dfb\u52a0\u89c4\u5219\u3002</p> <pre><code>\u547d\u4ee4\u8bed\u6cd5\uff1aiptables\u00a0-t\u00a0\u8868\u540d\u00a0-P\u00a0\u94fe\u540d\u00a0\u52a8\u4f5c\n\u793a\u4f8b\uff1aiptables\u00a0-t\u00a0filter\u00a0-P\u00a0FORWARD\u00a0ACCEPT\n</code></pre> <p>\u4e0a\u4f8b\u8868\u793a\u5c06filter\u8868\u4e2dFORWARD\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u8bbe\u7f6e\u4e3aACCEPT</p>"},{"location":"iptables_3/#_7","title":"\u5220\u9664\u89c4\u5219","text":"<p>\u6ce8\u610f\u70b9\uff1a\u5982\u679c\u6ca1\u6709\u4fdd\u5b58\u89c4\u5219\uff0c\u5220\u9664\u89c4\u5219\u65f6\u8bf7\u614e\u91cd</p> <p>\u6309\u7167\u89c4\u5219\u5e8f\u53f7\u5220\u9664\u89c4\u5219\uff0c\u5220\u9664\u6307\u5b9a\u8868\u7684\u6307\u5b9a\u94fe\u7684\u6307\u5b9a\u89c4\u5219\uff0c-D\u9009\u9879\u8868\u793a\u5220\u9664\u5bf9\u5e94\u94fe\u4e2d\u7684\u89c4\u5219\u3002</p> <pre><code>\u547d\u4ee4\u8bed\u6cd5\uff1aiptables\u00a0-t\u00a0\u8868\u540d\u00a0-D\u00a0\u94fe\u540d\u00a0\u89c4\u5219\u5e8f\u53f7\n\u793a\u4f8b\uff1aiptables\u00a0-t\u00a0filter\u00a0-D\u00a0INPUT\u00a03\n</code></pre> <p>\u4e0a\u8ff0\u793a\u4f8b\u8868\u793a\u5220\u9664filter\u8868\u4e2dINPUT\u94fe\u4e2d\u5e8f\u53f7\u4e3a3\u7684\u89c4\u5219\u3002</p> <p>\u6309\u7167\u5177\u4f53\u7684\u5339\u914d\u6761\u4ef6\u4e0e\u52a8\u4f5c\u5220\u9664\u89c4\u5219\uff0c\u5220\u9664\u6307\u5b9a\u8868\u7684\u6307\u5b9a\u94fe\u7684\u6307\u5b9a\u89c4\u5219\u3002</p> <pre><code>\u547d\u4ee4\u8bed\u6cd5\uff1aiptables\u00a0-t\u00a0\u8868\u540d\u00a0-D\u00a0\u94fe\u540d\u00a0\u5339\u914d\u6761\u4ef6\u00a0-j\u00a0\u52a8\u4f5c\n\u793a\u4f8b\uff1aiptables\u00a0-t\u00a0filter\u00a0-D\u00a0INPUT\u00a0-s\u00a0192.168.1.146\u00a0-j\u00a0DROP\n</code></pre> <p>\u4e0a\u8ff0\u793a\u4f8b\u8868\u793a\u5220\u9664filter\u8868\u4e2dINPUT\u94fe\u4e2d\u6e90\u5730\u5740\u4e3a192.168.1.146\u5e76\u4e14\u52a8\u4f5c\u4e3aDROP\u7684\u89c4\u5219\u3002</p> <p>\u5220\u9664\u6307\u5b9a\u8868\u7684\u6307\u5b9a\u94fe\u4e2d\u7684\u6240\u6709\u89c4\u5219\uff0c-F\u9009\u9879\u8868\u793a\u6e05\u7a7a\u5bf9\u5e94\u94fe\u4e2d\u7684\u89c4\u5219\uff0c\u6267\u884c\u65f6\u9700\u4e09\u601d\u3002</p> <pre><code>\u547d\u4ee4\u8bed\u6cd5\uff1aiptables\u00a0-t\u00a0\u8868\u540d\u00a0-F\u00a0\u94fe\u540d\n\u793a\u4f8b\uff1aiptables\u00a0-t\u00a0filter\u00a0-F\u00a0INPUT\n</code></pre> <p>\u5220\u9664\u6307\u5b9a\u8868\u4e2d\u7684\u6240\u6709\u89c4\u5219\uff0c\u6267\u884c\u65f6\u9700\u4e09\u601d\u3002</p> <pre><code>\u547d\u4ee4\u8bed\u6cd5\uff1aiptables\u00a0-t\u00a0\u8868\u540d\u00a0-F\n\u793a\u4f8b\uff1aiptables\u00a0-t\u00a0filter\u00a0-F\n</code></pre>"},{"location":"iptables_3/#_8","title":"\u4fee\u6539\u89c4\u5219","text":"<p>\u6ce8\u610f\u70b9\uff1a\u5982\u679c\u4f7f\u7528-R\u9009\u9879\u4fee\u6539\u89c4\u5219\u4e2d\u7684\u52a8\u4f5c\uff0c\u90a3\u4e48\u5fc5\u987b\u6307\u660e\u539f\u89c4\u5219\u4e2d\u7684\u539f\u5339\u914d\u6761\u4ef6\uff0c\u4f8b\u5982\u6e90IP\uff0c\u76ee\u6807IP\u7b49\u3002</p> <p>\u4fee\u6539\u6307\u5b9a\u8868\u4e2d\u6307\u5b9a\u94fe\u7684\u6307\u5b9a\u89c4\u5219\uff0c-R\u9009\u9879\u8868\u793a\u4fee\u6539\u5bf9\u5e94\u94fe\u4e2d\u7684\u89c4\u5219\uff0c\u4f7f\u7528-R\u9009\u9879\u65f6\u8981\u540c\u65f6\u6307\u5b9a\u5bf9\u5e94\u7684\u94fe\u4ee5\u53ca\u89c4\u5219\u5bf9\u5e94\u7684\u5e8f\u53f7\uff0c\u5e76\u4e14\u89c4\u5219\u4e2d\u539f\u672c\u7684\u5339\u914d\u6761\u4ef6\u4e0d\u53ef\u7701\u7565\u3002</p> <pre><code>\u547d\u4ee4\u8bed\u6cd5\uff1aiptables\u00a0-t\u00a0\u8868\u540d\u00a0-R\u00a0\u94fe\u540d\u00a0\u89c4\u5219\u5e8f\u53f7\u00a0\u89c4\u5219\u539f\u672c\u7684\u5339\u914d\u6761\u4ef6\u00a0-j\u00a0\u52a8\u4f5c\n\u793a\u4f8b\uff1aiptables\u00a0-t\u00a0filter\u00a0-R\u00a0INPUT\u00a03\u00a0-s\u00a0192.168.1.146\u00a0-j\u00a0ACCEPT\n</code></pre> <p>\u4e0a\u8ff0\u793a\u4f8b\u8868\u793a\u4fee\u6539filter\u8868\u4e2dINPUT\u94fe\u7684\u7b2c3\u6761\u89c4\u5219\uff0c\u5c06\u8fd9\u6761\u89c4\u5219\u7684\u52a8\u4f5c\u4fee\u6539\u4e3aACCEPT\uff0c -s 192.168.1.146\u4e3a\u8fd9\u6761\u89c4\u5219\u4e2d\u539f\u672c\u7684\u5339\u914d\u6761\u4ef6\uff0c\u5982\u679c\u7701\u7565\u6b64\u5339\u914d\u6761\u4ef6\uff0c\u4fee\u6539\u540e\u7684\u89c4\u5219\u4e2d\u7684\u6e90\u5730\u5740\u53ef\u80fd\u4f1a\u53d8\u4e3a0.0.0.0/0\u3002</p> <p>\u5176\u4ed6\u4fee\u6539\u89c4\u5219\u7684\u65b9\u6cd5\uff1a\u5148\u901a\u8fc7\u7f16\u53f7\u5220\u9664\u89c4\u5219\uff0c\u518d\u5728\u539f\u7f16\u53f7\u4f4d\u7f6e\u6dfb\u52a0\u4e00\u6761\u89c4\u5219\u3002</p> <p>\u4fee\u6539\u6307\u5b9a\u8868\u7684\u6307\u5b9a\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\uff08\u9ed8\u8ba4\u52a8\u4f5c\uff09\uff0c\u5e76\u975e\u4fee\u6539\u89c4\u5219\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u3002</p> <pre><code>\u547d\u4ee4\u8bed\u6cd5\uff1aiptables\u00a0-t\u00a0\u8868\u540d\u00a0-P\u00a0\u94fe\u540d\u00a0\u52a8\u4f5c\n\u793a\u4f8b\uff1aiptables\u00a0-t\u00a0filter\u00a0-P\u00a0FORWARD\u00a0ACCEPT\n</code></pre> <p>\u4e0a\u4f8b\u8868\u793a\u5c06filter\u8868\u4e2dFORWARD\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u4fee\u6539\u4e3aACCEPT</p>"},{"location":"iptables_3/#_9","title":"\u4fdd\u5b58\u89c4\u5219","text":"<p>\u4fdd\u5b58\u89c4\u5219\u547d\u4ee4\u5982\u4e0b\uff0c\u8868\u793a\u5c06iptables\u89c4\u5219\u4fdd\u5b58\u81f3/etc/sysconfig/iptables\u6587\u4ef6\u4e2d\uff0c\u5982\u679c\u5bf9\u5e94\u7684\u64cd\u4f5c\u6ca1\u6709\u4fdd\u5b58\uff0c\u90a3\u4e48\u5f53\u91cd\u542fiptables\u670d\u52a1\u4ee5\u540e</p> <pre><code>service\u00a0iptables\u00a0save\n</code></pre> <p>\u6ce8\u610f\u70b9\uff1acentos7\u4e2d\u4f7f\u7528\u9ed8\u8ba4\u4f7f\u7528firewalld\uff0c\u5982\u679c\u60f3\u8981\u4f7f\u7528\u4e0a\u8ff0\u547d\u4ee4\u4fdd\u5b58\u89c4\u5219\uff0c\u9700\u8981\u5b89\u88c5iptables-services\uff0c\u5177\u4f53\u914d\u7f6e\u8fc7\u7a0b\u8bf7\u56de\u987e\u4e0a\u6587\u3002</p> <p>\u6216\u8005\u4f7f\u7528\u5982\u4e0b\u65b9\u6cd5\u4fdd\u5b58\u89c4\u5219</p> <pre><code>iptables-save\u00a0&gt;\u00a0/etc/sysconfig/iptables\n</code></pre> <p>\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u4ece\u6307\u5b9a\u7684\u6587\u4ef6\u8f7d\u5165\u89c4\u5219\uff0c\u6ce8\u610f\uff1a\u91cd\u8f7d\u89c4\u5219\u65f6\uff0c\u6587\u4ef6\u4e2d\u7684\u89c4\u5219\u5c06\u4f1a\u8986\u76d6\u73b0\u6709\u89c4\u5219\u3002</p> <pre><code>iptables-restore\u00a0&lt;\u00a0/etc/sysconfig/iptables\n</code></pre> <p>\u597d\u4e86\uff0c\u8fd9\u7bc7\u6587\u7ae0\u5df2\u7ecf\u603b\u7ed3\u4e86\u600e\u6837\u6dfb\u52a0\u3001\u5220\u9664\u3001\u4fee\u6539 iptables\u89c4\u5219\uff0c\u4e0e\u524d\u6587\u7ed3\u5408\u8d77\u6765\uff0c\u6211\u4eec\u5df2\u7ecf\u638c\u63e1\u4e86\u5bf9iptables\u89c4\u5219\u7684\u201d\u589e\u5220\u6539\u67e5\u201d\uff0c\u540c\u65f6\uff0c\u8fd9\u7bc7\u6587\u7ae0\u4e5f\u603b\u7ed3\u4e86\u5982\u4f55\u8bbe\u7f6e\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\uff0c\u4ee5\u53ca\u600e\u6837\u4fdd\u5b58iptables\u89c4\u5219\u3002</p> <p>\u6211\u60f3\uff0c\u4f60\u5df2\u7ecf\u5165\u95e8\u4e86\uff0c\u5bf9\u5417\uff1f\u5982\u679c\u4f60\u662f\u4e00\u4e2a\u65b0\u624b\uff0c\u5e0c\u671b\u8fd9\u7bc7\u6587\u7ae0\u80fd\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\u3002</p> <p>\u4f60\u7684\u8bc4\u8bba\u4f1a\u4fc3\u8fdb\u4e0b\u4e00\u7bc7\u6587\u7ae0\u7684\u8bde\u751f\uff0c\u591a\u6765\u6367\u573a\u554a\u5ba2\u5b98\uff0c\u4e48\u4e48\u54d2~~~\u3002</p>"},{"location":"iptables_4/","title":"iptables\u8be6\u89e3\uff084\uff09\uff1aiptables\u5339\u914d\u6761\u4ef6\u603b\u7ed3\u4e4b\u4e00","text":"<p>\u5728\u672c\u535a\u5ba2\u4e2d\uff0c\u4ece\u7406\u8bba\u5230\u5b9e\u8df5\uff0c\u7cfb\u7edf\u7684\u4ecb\u7ecd\u4e86iptables\uff0c\u5982\u679c\u4f60\u60f3\u8981\u4ece\u5934\u5f00\u59cb\u4e86\u89e3iptables\uff0c\u53ef\u4ee5\u67e5\u770biptables\u6587\u7ae0\u5217\u8868\uff0c\u76f4\u8fbe\u94fe\u63a5\u5982\u4e0b</p> <p>iptables\u96f6\u57fa\u7840\u5feb\u901f\u5165\u95e8\u7cfb\u5217</p> <p>\u7ecf\u8fc7\u524d\u6587\u7684\u603b\u7ed3\uff0c\u6211\u4eec\u5df2\u7ecf\u80fd\u591f\u719f\u7ec3\u7684\u7ba1\u7406\u89c4\u5219\u4e86\uff0c\u4f46\u662f\u6211\u4eec\u4f7f\u7528\u8fc7\u7684\u201d\u5339\u914d\u6761\u4ef6\u201d\u5c11\u5f97\u53ef\u601c\uff0c\u4e4b\u524d\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u53ea\u4f7f\u7528\u8fc7\u4e00\u79cd\u5339\u914d\u6761\u4ef6\uff0c\u5c31\u662f\u5c06\u201d\u6e90\u5730\u5740\u201d\u4f5c\u4e3a\u5339\u914d\u6761\u4ef6\u3002</p> <p>\u90a3\u4e48\u8fd9\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u5c31\u6765\u4e86\u89e3\u4e00\u4e0b\u66f4\u591a\u7684\u5339\u914d\u6761\u4ef6\uff0c\u4ee5\u53ca\u5339\u914d\u6761\u4ef6\u7684\u66f4\u591a\u7528\u6cd5\u3002</p> <p>\u6ce8\u610f\uff1a\u5728\u53c2\u7167\u672c\u6587\u8fdb\u884ciptables\u5b9e\u9a8c\u65f6\uff0c\u8bf7\u52a1\u5fc5\u5728\u4e2a\u4eba\u7684\u6d4b\u8bd5\u673a\u4e0a\u8fdb\u884c\uff0c\u56e0\u4e3a\u5982\u679ciptables\u89c4\u5219\u8bbe\u7f6e\u4e0d\u5f53\uff0c\u6709\u53ef\u80fd\u4f7f\u4f60\u65e0\u6cd5\u8fde\u63a5\u5230\u8fdc\u7a0b\u4e3b\u673a\u4e2d\u3002</p>"},{"location":"iptables_4/#_1","title":"\u5339\u914d\u6761\u4ef6\u7684\u66f4\u591a\u7528\u6cd5","text":"<p>\u8fd8\u662f\u4ece\u6211\u4eec\u6700\u5e38\u7528\u7684\u201d\u6e90\u5730\u5740\u201d\u8bf4\u8d77\u5427\uff0c\u6211\u4eec\u77e5\u9053\uff0c\u4f7f\u7528-s\u9009\u9879\u4f5c\u4e3a\u5339\u914d\u6761\u4ef6\uff0c\u53ef\u4ee5\u5339\u914d\u62a5\u6587\u7684\u6e90\u5730\u5740\uff0c\u4f46\u662f\u4e4b\u524d\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u6bcf\u6b21\u6307\u5b9a\u6e90\u5730\u5740\uff0c\u90fd\u53ea\u662f\u6307\u5b9a\u5355\u4e2aIP\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u5176\u5b9e\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u6307\u5b9a\u6e90\u5730\u5740\u65f6\uff0c\u4e00\u6b21\u6307\u5b9a\u591a\u4e2a\uff0c\u7528\u201d\u9017\u53f7\u201d\u9694\u5f00\u5373\u53ef\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u51fa\uff0c\u4e0a\u4f8b\u4e2d\uff0c\u4e00\u6b21\u6dfb\u52a0\u4e86\u4e24\u6761\u89c4\u5219\uff0c\u4e24\u6761\u89c4\u5219\u53ea\u662f\u6e90\u5730\u5740\u5bf9\u5e94\u7684IP\u4e0d\u540c\uff0c\u6ce8\u610f\uff0c\u4e0a\u4f8b\u4e2d\u7684\u201d\u9017\u53f7\u201d\u4e24\u4fa7\u5747\u4e0d\u80fd\u5305\u542b\u7a7a\u683c\uff0c\u591a\u4e2aIP\u4e4b\u95f4\u5fc5\u987b\u4e0e\u9017\u53f7\u76f8\u8fde\u3002</p> <p>\u9664\u4e86\u80fd\u6307\u5b9a\u5177\u4f53\u7684IP\u5730\u5740\uff0c\u8fd8\u80fd\u6307\u5b9a\u67d0\u4e2a\u7f51\u6bb5\uff0c\u793a\u4f8b\u5982\u4e0b</p> <p></p> <p>\u4e0a\u4f8b\u8868\u793a\uff0c\u5982\u679c\u62a5\u6587\u7684\u6e90\u5730\u5740IP\u572810.6.0.0/16\u7f51\u6bb5\u5185\uff0c\u5f53\u62a5\u6587\u7ecf\u8fc7INPUT\u94fe\u65f6\u5c31\u4f1a\u88abDROP\u6389\u3002</p> <p>\u5176\u5b9e\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u5bf9\u5339\u914d\u6761\u4ef6\u53d6\u53cd\uff0c\u5148\u770b\u793a\u4f8b\uff0c\u5982\u4e0b\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u4f7f\u7528\u201d! -s 192.168.1.146\u2033\u8868\u793a\u5bf9 -s 192.168.1.146\u8fd9\u4e2a\u5339\u914d\u6761\u4ef6\u53d6\u53cd\uff0c -s 192.168.1.146\u8868\u793a\u62a5\u6587\u6e90IP\u5730\u5740\u4e3a192.168.1.146\u5373\u53ef\u6ee1\u8db3\u5339\u914d\u6761\u4ef6\uff0c\u4f7f\u7528 \u201c!\u201d \u53d6\u53cd\u540e\u5219\u8868\u793a\uff0c\u62a5\u6587\u6e90\u5730\u5740IP\u53ea\u8981\u4e0d\u4e3a192.168.1.146\u5373\u6ee1\u8db3\u6761\u4ef6\uff0c\u90a3\u4e48\uff0c\u4e0a\u4f8b\u4e2d\u89c4\u5219\u8868\u8fbe\u7684\u610f\u601d\u5c31\u662f\uff0c\u53ea\u8981\u53d1\u5f80\u672c\u673a\u7684\u62a5\u6587\u7684\u6e90\u5730\u5740\u4e0d\u662f192.168.1.146\uff0c\u5c31\u63a5\u53d7\u62a5\u6587\u3002</p> <p>\u6b64\u523b\uff0c\u4f60\u731c\u731c\uff0c\u6309\u7167\u4e0a\u4f8b\u4e2d\u7684\u914d\u7f6e\uff0c\u5982\u679c\u6b64\u65f6\u4ece146\u4e3b\u673a\u4e0a\u5411\u9632\u706b\u5899\u6240\u5728\u7684\u4e3b\u673a\u53d1\u9001ping\u8bf7\u6c42\uff0c146\u4e3b\u673a\u80fd\u5f97\u5230\u56de\u5e94\u5417\uff1f\uff08\u6b64\u5904\u4e0d\u8003\u8651\u5176\u4ed6\u94fe\uff0c\u53ea\u8003\u8651filter\u8868\u7684INPUT\u94fe\uff09</p> <p>\u4e3a\u4e86\u7ed9\u4f60\u601d\u8003\u7684\u7a7a\u95f4\uff0c\u6211\u628a\u7b54\u6848\u5199\u7684\u8fdc\u4e00\u70b9\u3002</p> <p>\u7b54\u6848\u662f\uff1a\u80fd\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6309\u7167\u4e0a\u4f8b\u7684\u914d\u7f6e\uff0c146\u4e3b\u673a\u4ecd\u7136\u80fd\u591fping\u901a\u5f53\u524d\u4e3b\u673a\uff0c\u4e3a\u4ec0\u4e48\u5462\uff1f\u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\u3002</p> <p>\u4e0a\u4f8b\u4e2d\uff0cfilter\u8868\u7684INPUT\u94fe\u4e2d\u53ea\u6709\u4e00\u6761\u89c4\u5219\uff0c\u8fd9\u6761\u89c4\u5219\u8981\u8868\u8fbe\u7684\u610f\u601d\u5c31\u662f\uff1a</p> <p>\u53ea\u8981\u62a5\u6587\u7684\u6e90IP\u4e0d\u662f192.168.1.146\uff0c\u90a3\u4e48\u5c31\u63a5\u53d7\u6b64\u62a5\u6587\uff0c\u4f46\u662f\uff0c\u67d0\u4e9b\u5c0f\u4f19\u4f34\u53ef\u80fd\u4f1a\u8bef\u4f1a\uff0c\u628a\u4e0a\u4f8b\u4e2d\u7684\u89c4\u5219\u7406\u89e3\u6210\u5982\u4e0b\u542b\u4e49\uff0c</p> <p>\u53ea\u8981\u62a5\u6587\u7684\u6e90IP\u662f192.168.1.146\uff0c\u90a3\u4e48\u5c31\u4e0d\u63a5\u53d7\u6b64\u62a5\u6587\uff0c\u8fd9\u79cd\u7406\u89e3\u4e0e\u4e0a\u8ff0\u7406\u89e3\u770b\u4f3c\u5dee\u522b\u4e0d\u5927\uff0c\u5176\u5b9e\u5b8c\u5168\u4e0d\u4e00\u6837\uff0c\u8fd9\u6837\u7406\u89e3\u662f\u9519\u8bef\u7684\uff0c\u4e0a\u8ff0\u7406\u89e3\u624d\u662f\u6b63\u786e\u7684\u3002</p> <p>\u6362\u53e5\u8bdd\u8bf4\u5c31\u662f\uff0c\u62a5\u6587\u7684\u6e90IP\u4e0d\u662f192.168.1.146\u65f6\uff0c\u4f1a\u88ab\u63a5\u6536\uff0c\u5e76\u4e0d\u80fd\u4ee3\u8868\uff0c\u62a5\u6587\u7684\u6e90IP\u662f192.168.1.146\u65f6\uff0c\u4f1a\u88ab\u62d2\u7edd\u3002</p> <p>\u4e0a\u4f8b\u4e2d\uff0c\u56e0\u4e3a\u5e76\u6ca1\u6709\u4efb\u4f55\u4e00\u6761\u89c4\u5219\u6307\u660e\u6e90IP\u662f192.168.1.146\u65f6\uff0c\u8be5\u6267\u884c\u600e\u6837\u7684\u52a8\u4f5c\uff0c\u6240\u4ee5\uff0c\u5f53\u6765\u81ea192.168.1.146\u7684\u62a5\u6587\u7ecf\u8fc7INPUT\u94fe\u65f6\uff0c\u5e76\u4e0d\u80fd\u5339\u914d\u4e0a\u4f8b\u4e2d\u7684\u89c4\u5219\uff0c\u4e8e\u662f\uff0c\u6b64\u62a5\u6587\u5c31\u7ee7\u7eed\u5339\u914d\u540e\u9762\u7684\u89c4\u5219\uff0c\u53ef\u662f\uff0c\u4e0a\u4f8b\u4e2d\u53ea\u6709\u4e00\u6761\u89c4\u5219\uff0c\u8fd9\u6761\u89c4\u5219\u540e\u9762\u6ca1\u6709\u5176\u4ed6\u53ef\u4ee5\u5339\u914d\u7684\u89c4\u5219\uff0c\u4e8e\u662f\uff0c\u6b64\u62a5\u6587\u5c31\u4f1a\u53bb\u5339\u914d\u5f53\u524d\u94fe\u7684\u9ed8\u8ba4\u52a8\u4f5c(\u9ed8\u8ba4\u7b56\u7565)\uff0c\u800c\u4e0a\u4f8b\u4e2d\uff0cINPUT\u94fe\u7684\u9ed8\u8ba4\u52a8\u4f5c\u4e3aACCEPT\uff0c\u6240\u4ee5\uff0c\u6765\u81ea146\u7684ping\u62a5\u6587\u5c31\u88ab\u63a5\u6536\u4e86\uff0c\u5982\u679c\uff0c\u628a\u4e0a\u4f8b\u4e2dINPUT\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u6539\u4e3aDROP\uff0c\u90a3\u4e48\uff0c146\u7684\u62a5\u6587\u5c06\u4f1a\u88ab\u4e22\u5f03\uff0c146\u4e0a\u7684ping\u547d\u4ee4\u5c06\u5f97\u4e0d\u5230\u4efb\u4f55\u56de\u5e94\uff0c\u4f46\u662f\u5982\u679c\u5c06INPUT\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u8bbe\u7f6e\u4e3aDROP\uff0c\u5f53INPUT\u94fe\u4e2d\u6ca1\u6709\u4efb\u4f55\u89c4\u5219\u65f6\uff0c\u6240\u6709\u5916\u6765\u62a5\u6587\u5c06\u4f1a\u88ab\u4e22\u5f03\uff0c\u5305\u62ec\u6211\u4eecssh\u8fdc\u7a0b\u8fde\u63a5\u3002</p> <p>\u597d\u4e86\uff0c\u6211\u4eec\u901a\u8fc7\u4e0a\u4f8b\uff0c\u4e0d\u4ec5\u4e86\u89e3\u5230\u4e86\u600e\u6837\u5bf9\u5339\u914d\u6761\u4ef6\u53d6\u53cd\uff0c\u8fd8\u52a0\u6df1\u4e86\u6211\u4eec\u5bf9\u9ed8\u8ba4\u7b56\u7565\u7684\u4e86\u89e3\uff0c\u4e00\u4e3e\u4e24\u5f97\uff0c\u6211\u4eec\u7ee7\u7eed\u804a\u3002</p>"},{"location":"iptables_4/#ip","title":"\u5339\u914d\u6761\u4ef6\uff1a\u76ee\u6807IP\u5730\u5740","text":"<p>\u9664\u4e86\u53ef\u4ee5\u901a\u8fc7-s\u9009\u9879\u6307\u5b9a\u6e90\u5730\u5740\u4f5c\u4e3a\u5339\u914d\u6761\u4ef6\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4f7f\u7528-d\u9009\u9879\u6307\u5b9a\u201d\u76ee\u6807\u5730\u5740\u201d\u4f5c\u4e3a\u5339\u914d\u6761\u4ef6\u3002</p> <p>\u6e90\u5730\u5740\u8868\u793a\u62a5\u6587\u4ece\u54ea\u91cc\u6765\uff0c\u76ee\u6807\u5730\u5740\u8868\u793a\u62a5\u6587\u8981\u5230\u54ea\u91cc\u53bb\u3002</p> <p>\u9664\u4e86127.0.0.1\u56de\u73af\u5730\u5740\u4ee5\u5916\uff0c\u5f53\u524d\u673a\u5668\u6709\u4e24\u4e2aIP\u5730\u5740\uff0cIP\u5982\u4e0b\u3002</p> <p></p> <p>\u5047\u8bbe\uff0c\u6211\u4eec\u60f3\u8981\u62d2\u7edd146\u4e3b\u673a\u53d1\u6765\u7684\u62a5\u6587\uff0c\u4f46\u662f\u6211\u4eec\u53ea\u60f3\u62d2\u7edd146\u5411156\u8fd9\u4e2aIP\u53d1\u9001\u62a5\u6587\uff0c\u5e76\u4e0d\u60f3\u8981\u9632\u6b62146\u5411101\u8fd9\u4e2aIP\u53d1\u9001\u62a5\u6587\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6307\u5b9a\u76ee\u6807\u5730\u5740\u4f5c\u4e3a\u5339\u914d\u6761\u4ef6\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u4e0a\u4f8b\u8868\u793a\u53ea\u4e22\u5f03\u4ece146\u53d1\u5f80156\u8fd9\u4e2aIP\u7684\u62a5\u6587\uff0c\u4f46\u662f146\u53d1\u5f80101\u8fd9\u4e2aIP\u7684\u62a5\u6587\u5e76\u4e0d\u4f1a\u88ab\u4e22\u5f03\uff0c\u5982\u679c\u6211\u4eec\u4e0d\u6307\u5b9a\u4efb\u4f55\u76ee\u6807\u5730\u5740\uff0c\u5219\u76ee\u6807\u5730\u5740\u9ed8\u8ba4\u4e3a0.0.0.0/0\uff0c\u540c\u7406\uff0c\u5982\u679c\u6211\u4eec\u4e0d\u6307\u5b9a\u6e90\u5730\u5740\uff0c\u6e90\u5730\u5740\u9ed8\u8ba4\u4e3a0.0.0.0/0\uff0c0.0.0.0/0\u8868\u793a\u6240\u6709IP\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u4e0a\u4f8b\u8868\u793a\uff0c\u6240\u6709IP\u53d1\u9001\u5f80101\u7684\u62a5\u6587\u90fd\u5c06\u88ab\u4e22\u5f03\u3002</p> <p>\u4e0e-s\u9009\u9879\u4e00\u6837\uff0c-d\u9009\u9879\u4e5f\u53ef\u4ee5\u4f7f\u7528\u201d\u53f9\u53f7\u201d\u8fdb\u884c\u53d6\u53cd\uff0c\u4e5f\u80fd\u591f\u540c\u65f6\u6307\u5b9a\u591a\u4e2aIP\u5730\u5740\uff0c\u4f7f\u7528\u201d\u9017\u53f7\u201d\u9694\u5f00\u5373\u53ef\u3002</p> <p>\u4f46\u662f\u8bf7\u6ce8\u610f\uff0c\u4e0d\u7ba1\u662f-s\u9009\u9879\u8fd8\u662f-d\u9009\u9879\uff0c\u53d6\u53cd\u64cd\u4f5c\u4e0e\u540c\u65f6\u6307\u5b9a\u591a\u4e2aIP\u7684\u64cd\u4f5c\u4e0d\u80fd\u540c\u65f6\u4f7f\u7528\u3002</p> <p>\u9700\u8981\u660e\u786e\u7684\u4e00\u70b9\u5c31\u662f\uff1a\u5f53\u4e00\u6761\u89c4\u5219\u4e2d\u6709\u591a\u4e2a\u5339\u914d\u6761\u4ef6\u65f6\uff0c\u8fd9\u591a\u4e2a\u5339\u914d\u6761\u4ef6\u4e4b\u95f4\uff0c\u9ed8\u8ba4\u5b58\u5728\u201d\u4e0e\u201d\u7684\u5173\u7cfb\u3002</p> <p>\u8bf4\u767d\u4e86\u5c31\u662f\uff0c\u5f53\u4e00\u6761\u89c4\u5219\u4e2d\u5b58\u5728\u591a\u4e2a\u5339\u914d\u6761\u4ef6\u65f6\uff0c\u62a5\u6587\u5fc5\u987b\u540c\u65f6\u6ee1\u8db3\u8fd9\u4e9b\u6761\u4ef6\uff0c\u624d\u7b97\u505a\u88ab\u89c4\u5219\u5339\u914d\u3002</p> <p>\u5c31\u5982\u4e0b\u4f8b\u6240\u793a\uff0c\u4e0b\u56fe\u4e2d\u7684\u89c4\u5219\u5305\u542b\u6709\u4e24\u4e2a\u5339\u914d\u6761\u4ef6\uff0c\u6e90\u5730\u5740\u4e0e\u76ee\u6807\u5730\u5740\uff0c\u62a5\u6587\u5fc5\u987b\u540c\u65f6\u80fd\u88ab\u8fd9\u4e24\u4e2a\u6761\u4ef6\u5339\u914d\uff0c\u624d\u7b97\u4f5c\u88ab\u5f53\u524d\u89c4\u5219\u5339\u914d\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e0b\u4f8b\u4e2d\uff0c\u62a5\u6587\u5fc5\u987b\u6765\u81ea146\uff0c\u540c\u65f6\u62a5\u6587\u7684\u76ee\u6807\u5730\u5740\u5fc5\u987b\u4e3a101\uff0c\u624d\u4f1a\u88ab\u5982\u4e0b\u89c4\u5219\u5339\u914d\uff0c\u4e24\u4e2a\u6761\u4ef6\u5fc5\u987b\u540c\u65f6\u6ee1\u8db3\u3002</p> <p></p> <p>\u6211\u4eec\u9664\u4e86\u80fd\u591f\u4f7f\u7528-s\u9009\u9879\u548c-d\u9009\u9879\u5339\u914d\u6e90IP\u4e0e\u76ee\u6807IP\u4ee5\u5916\uff0c\u8fd8\u80fd\u591f\u5339\u914d\u201d\u6e90\u7aef\u53e3\u201d\u4e0e\u201d\u76ee\u6807\u7aef\u53e3\u201d\uff0c\u4f46\u662f\u6211\u4eec\u4e00\u4f1a\u513f\u518d\u804a\u600e\u6837\u5339\u914d\u7aef\u53e3\uff0c\u6211\u4eec\u5148\u804a\u804a\u5176\u4ed6\u9009\u9879\u3002</p>"},{"location":"iptables_4/#_2","title":"\u5339\u914d\u6761\u4ef6\uff1a\u534f\u8bae\u7c7b\u578b","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528-p\u9009\u9879\uff0c\u6307\u5b9a\u9700\u8981\u5339\u914d\u7684\u62a5\u6587\u7684\u534f\u8bae\u7c7b\u578b\u3002</p> <p>\u5047\u8bbe\uff0c\u6211\u4eec\u53ea\u60f3\u8981\u62d2\u7edd\u6765\u81ea146\u7684tcp\u7c7b\u578b\u7684\u8bf7\u6c42\uff0c\u90a3\u4e48\u53ef\u4ee5\u8fdb\u884c\u5982\u4e0b\u8bbe\u7f6e</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u9632\u706b\u5899\u62d2\u7edd\u4e86\u6765\u81ea146\u7684tcp\u62a5\u6587\u53d1\u5f80156\u8fd9\u4e2aIP\uff0c\u90a3\u4e48\u6211\u4eec\u6765\u6d4b\u8bd5\u4e00\u4e0b\uff0c\u6211\u4eec\u5728146\u4e0a\u4f7f\u7528ssh\u8fde\u63a5101\u8fd9\u4e2aIP\u8bd5\u8bd5\uff08ssh\u534f\u8bae\u7684\u4f20\u8f93\u5c42\u534f\u8bae\u5c5e\u4e8etcp\u534f\u8bae\u7c7b\u578b\uff09</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0cssh\u8fde\u63a5\u88ab\u62d2\u7edd\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u4f7f\u7528ping\u547d\u4ee4\u8bd5\u8bd5 (ping\u547d\u4ee4\u4f7f\u7528icmp\u534f\u8bae)\uff0c\u770b\u770b\u80fd\u4e0d\u80fdping\u901a156\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0cPING\u547d\u4ee4\u53ef\u4ee5ping\u901a156\uff0c\u8bc1\u660eicmp\u534f\u8bae\u5e76\u6ca1\u6709\u88ab\u89c4\u5219\u5339\u914d\u5230\uff0c\u53ea\u6709tcp\u7c7b\u578b\u7684\u62a5\u6587\u88ab\u5339\u914d\u5230\u4e86\u3002</p> <p>\u90a3\u4e48\uff0c-p\u9009\u9879\u90fd\u652f\u6301\u5339\u914d\u54ea\u4e9b\u534f\u8bae\u5462\uff1f\u6211\u4eec\u603b\u7ed3\u4e00\u4e0b</p> <p>centos6\u4e2d\uff0c-p\u9009\u9879\u652f\u6301\u5982\u4e0b\u534f\u8bae\u7c7b\u578b</p> <p>tcp, udp, udplite, icmp, esp, ah, sctp</p> <p>centos7\u4e2d\uff0c-p\u9009\u9879\u652f\u6301\u5982\u4e0b\u534f\u8bae\u7c7b\u578b</p> <p>tcp, udp, udplite, icmp, icmpv6,esp, ah, sctp, mh</p> <p>\u5f53\u4e0d\u4f7f\u7528-p\u6307\u5b9a\u534f\u8bae\u7c7b\u578b\u65f6\uff0c\u9ed8\u8ba4\u8868\u793a\u6240\u6709\u7c7b\u578b\u7684\u534f\u8bae\u90fd\u4f1a\u88ab\u5339\u914d\u5230\uff0c\u4e0e\u4f7f\u7528-p all\u7684\u6548\u679c\u76f8\u540c\u3002</p>"},{"location":"iptables_4/#_3","title":"\u5339\u914d\u6761\u4ef6\uff1a\u7f51\u5361\u63a5\u53e3","text":"<p>\u6211\u4eec\u518d\u6765\u8ba4\u8bc6\u4e00\u4e2a\u65b0\u7684\u5339\u914d\u6761\u4ef6\uff0c\u5f53\u672c\u673a\u6709\u591a\u4e2a\u7f51\u5361\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 -i \u9009\u9879\u53bb\u5339\u914d\u62a5\u6587\u662f\u901a\u8fc7\u54ea\u5757\u7f51\u5361\u6d41\u5165\u672c\u673a\u7684\u3002</p> <p>\u6211\u4eec\u5148\u52a8\u624b\u505a\u4e2a\u5c0f\u4f8b\u5b50\uff0c\u5bf9-i\u9009\u9879\u6709\u4e00\u4e2a\u521d\u6b65\u7684\u4e86\u89e3\u4ee5\u540e\uff0c\u518d\u7ed3\u5408\u7406\u8bba\u53bb\u770b\u3002</p> <p>\u5f53\u524d\u4e3b\u673a\u7684\u7f51\u5361\u540d\u79f0\u4e3aeth4\uff0c\u5982\u4e0b\u56fe</p> <p></p> <p>\u5047\u8bbe\u60f3\u8981\u62d2\u7edd\u7531\u7f51\u5361eth4\u6d41\u5165\u7684ping\u8bf7\u6c42\u62a5\u6587\uff0c\u5219\u53ef\u4ee5\u8fdb\u884c\u5982\u4e0b\u8bbe\u7f6e\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u4f7f\u7528-i\u9009\u9879\uff0c\u6307\u5b9a\u7f51\u5361\u540d\u79f0\uff0c\u4f7f\u7528-p\u9009\u9879\uff0c\u6307\u5b9a\u4e86\u9700\u8981\u5339\u914d\u7684\u62a5\u6587\u534f\u8bae\u7c7b\u578b\uff0c\u4e0a\u4f8b\u8868\u793a\u4e22\u5f03\u7531eth4\u7f51\u5361\u6d41\u5165\u7684icmp\u7c7b\u578b\u7684\u62a5\u6587\u3002</p> <p>\u662f\u4e0d\u662f\u5f88\u5bb9\u6613\u7406\u89e3\uff0c\u4f46\u662f\uff0c\u6211\u4eec\u9700\u8981\u8003\u8651\u4e00\u4e2a\u95ee\u9898\uff0c-i\u9009\u9879\u662f\u7528\u4e8e\u5339\u914d\u62a5\u6587\u6d41\u5165\u7684\u7f51\u5361\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4ece\u672c\u673a\u53d1\u51fa\u7684\u62a5\u6587\u662f\u4e0d\u53ef\u80fd\u4f1a\u4f7f\u7528\u5230-i\u9009\u9879\u7684\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u7531\u672c\u673a\u53d1\u51fa\u7684\u62a5\u6587\u538b\u6839\u4e0d\u662f\u4ece\u7f51\u5361\u6d41\u5165\u7684\uff0c\u800c\u662f\u8981\u901a\u8fc7\u7f51\u5361\u53d1\u51fa\u7684\uff0c\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u8003\u8651\uff0c-i\u9009\u9879\u7684\u4f7f\u7528\u662f\u6709\u9650\u5236\u7684\u3002</p> <p>\u4e3a\u4e86\u66f4\u597d\u7684\u89e3\u91ca-i\u9009\u9879\uff0c\u6211\u4eec\u56de\u987e\u4e00\u4e0b\u5728\u7406\u8bba\u603b\u7ed3\u4e2d\u7684\u4e00\u5f20iptables\u5168\u5c40\u62a5\u6587\u6d41\u5411\u56fe\uff0c\u5982\u4e0b\u3002</p> <p></p> <p>\u65e2\u7136-i\u9009\u9879\u662f\u7528\u4e8e\u5224\u65ad\u62a5\u6587\u662f\u4ece\u54ea\u4e2a\u7f51\u5361\u6d41\u5165\u7684\uff0c\u90a3\u4e48\uff0c-i\u9009\u9879\u53ea\u80fd\u7528\u4e8e\u4e0a\u56fe\u4e2d\u7684PREROUTING\u94fe\u3001INPUT\u94fe\u3001FORWARD\u94fe\uff0c\u8fd9\u662f-i\u9009\u9879\u7684\u7279\u6b8a\u6027\uff0c\u56e0\u4e3a\u5b83\u53ea\u662f\u7528\u4e8e\u5224\u65ad\u62a5\u6587\u662f\u4ece\u54ea\u4e2a\u7f51\u5361\u6d41\u5165\u7684\uff0c\u6240\u4ee5\u53ea\u80fd\u5728\u4e0a\u56fe\u4e2d\u201d\u6570\u636e\u6d41\u5165\u6d41\u5411\u201d\u7684\u94fe\u4e2d\u4e0eFORWARD\u94fe\u4e2d\u5b58\u5728\uff0c\u800c\u4e0a\u56fe\u4e2d\u7684\u201d\u6570\u636e\u53d1\u51fa\u6d41\u5411\u201d\u7ecf\u8fc7\u7684\u94fe\u4e2d\uff0c\u662f\u4e0d\u53ef\u80fd\u4f7f\u7528-i\u9009\u9879\u7684\uff0c\u6bd4\u5982\u4e0a\u56fe\u4e2d\u7684OUTPUT\u94fe\u4e0ePOSTROUTING\u94fe\uff0c\u4ed6\u4eec\u90fd\u4e0d\u80fd\u4f7f\u7528-i\u9009\u9879\u3002</p> <p>\u7406\u89e3\u5b8c-i\u9009\u9879\uff0c\u518d\u6765\u7406\u89e3-o\u9009\u9879\u5c31\u597d\u529e\u4e86\u3002</p> <p>\u5f53\u4e3b\u673a\u6709\u591a\u5757\u7f51\u5361\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528-o\u9009\u9879\uff0c\u5339\u914d\u62a5\u6587\u5c06\u7531\u54ea\u5757\u7f51\u5361\u6d41\u51fa\uff0c\u6ca1\u9519\uff0c-o\u9009\u9879\u4e0e-i\u9009\u9879\u662f\u76f8\u5bf9\u7684\uff0c-i\u9009\u9879\u7528\u4e8e\u5339\u914d\u62a5\u6587\u4ece\u54ea\u4e2a\u7f51\u5361\u6d41\u5165\uff0c-o\u9009\u9879\u7528\u4e8e\u5339\u914d\u62a5\u6587\u5c06\u4ece\u54ea\u4e2a\u7f51\u5361\u6d41\u51fa\u3002</p> <p>\u806a\u660e\u5982\u4f60\uff0c\u4e00\u5b9a\u60f3\u5230\u4e86\uff0c-i\u9009\u9879\u53ea\u80fd\u7528\u4e8ePREROUTING\u94fe\u3001INPUT\u94fe\u3001FORWARD\u94fe\uff0c\u90a3\u4e48-o\u9009\u9879\u53ea\u80fd\u7528\u4e8eFORWARD\u94fe\u3001OUTPUT\u94fe\u3001POSTROUTING\u94fe\u3002</p> <p>\u56e0\u4e3a-o\u9009\u9879\u662f\u7528\u4e8e\u5339\u914d\u62a5\u6587\u5c06\u7531\u54ea\u4e2a\u7f51\u5361\u201d\u6d41\u51fa\u201d\u7684\uff0c\u6240\u4ee5\u4e0e\u4e0a\u56fe\u4e2d\u7684\u201d\u6570\u636e\u8fdb\u5165\u6d41\u5411\u201d\u4e2d\u7684\u94fe\u6ca1\u6709\u4efb\u4f55\u7f18\u5206\uff0c\u6240\u4ee5\uff0c-o\u9009\u9879\u53ea\u80fd\u7528\u4e8eFORWARD\u94fe\u3001OUTPUT\u94fe\u3001POSTROUTING\u94fe\u4e2d\u3002</p> <p>\u770b\u6765\uff0cFORWARD\u94fe\u5c5e\u4e8e\u201d\u4e2d\u7acb\u56fd\u201d\uff0c\u5b83\u80fd\u540c\u65f6\u4f7f\u7528-i\u9009\u9879\u4e0e-o\u9009\u9879\u3002</p>"},{"location":"iptables_4/#_4","title":"\u6269\u5c55\u5339\u914d\u6761\u4ef6","text":"<p>\u597d\u4e86\uff0c\u73b0\u5728\uff0c\u6211\u4eec\u5c31\u8981\u804a\u804a\uff0c\u600e\u6837\u5339\u914d\u62a5\u6587\u7684\u201d\u6e90\u7aef\u53e3\u201d\u4e0e\u201d\u76ee\u6807\u7aef\u53e3\u201d\u3002</p> <p>\u5728\u4e0a\u6587\u4e2d\uff0c\u6211\u4eec\u603b\u7ed3\u4e86\u201d\u6e90\u5730\u5740\u201d\u4e0e\u201d\u76ee\u6807\u5730\u5740\u201d\u4ee5\u540e\uff0c\u5c31\u987a\u4fbf\u63d0\u5230\u4e86\u201d\u6e90\u7aef\u53e3\u201d\u4e0e\u201d\u76ee\u6807\u7aef\u53e3\u201d\uff0c\u4f46\u662f\uff0c\u4e3a\u4ec0\u4e48\u521a\u624d\u4e0d\u4ecb\u7ecd\u201d\u6e90\u7aef\u53e3\u201d\u4e0e\u201d\u76ee\u6807\u7aef\u53e3\u201d\uff0c\u975e\u8981\u73b0\u5728\u4ecb\u7ecd\u5462\uff1f\u8fd9\u662f\u56e0\u4e3a\u201d\u6e90\u7aef\u53e3\u201d\u4e0e\u201d\u76ee\u6807\u7aef\u53e3\u201d\u5c5e\u4e8e\u6269\u5c55\u5339\u914d\u6761\u4ef6\uff0c\u201d\u6e90\u5730\u5740\u201d\u4e0e\u201d\u76ee\u6807\u5730\u5740\u201d\u5c5e\u4e8e\u57fa\u672c\u5339\u914d\u6761\u4ef6\uff0c\u4e0a\u6587\u4e2d\u4ecb\u7ecd\u5230\u7684\u5339\u914d\u6761\u4ef6\uff0c\u90fd\u5c5e\u4e8e\u57fa\u672c\u5339\u914d\u6761\u4ef6\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5355\u72ec\u628a\u201d\u6e90\u7aef\u53e3\u201d\u4e0e\u201d\u76ee\u6807\u7aef\u53e3\u201d\uff0c\u653e\u5728\u540e\u9762\u603b\u7ed3\uff0c\u662f\u4e3a\u4e86\u5f15\u51fa\u6269\u5c55\u5339\u914d\u6761\u4ef6\u7684\u6982\u5ff5\u3002</p> <p>\u90a3\u4e48\uff0c\u5148\u6765\u4e86\u89e3\u4e00\u4e0b\uff0c\u4ec0\u4e48\u662f\u6269\u5c55\u5339\u914d\u6761\u4ef6\u3002</p> <p>\u4e0d\u662f\u57fa\u672c\u5339\u914d\u6761\u4ef6\u7684\u5c31\u662f\u6269\u5c55\u5339\u914d\u6761\u4ef6\uff0c\u8fd9\u6837\u8bf4\u597d\u50cf\u662f\u53e5\u5e9f\u8bdd\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u7406\u89e3\uff0c\u57fa\u672c\u5339\u914d\u6761\u4ef6\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff0c\u800c\u5982\u679c\u60f3\u8981\u4f7f\u7528\u6269\u5c55\u5339\u914d\u6761\u4ef6\uff0c\u5219\u9700\u8981\u4f9d\u8d56\u4e00\u4e9b\u6269\u5c55\u6a21\u5757\uff0c\u6216\u8005\u8bf4\uff0c\u5728\u4f7f\u7528\u6269\u5c55\u5339\u914d\u6761\u4ef6\u4e4b\u524d\uff0c\u9700\u8981\u6307\u5b9a\u76f8\u5e94\u7684\u6269\u5c55\u6a21\u5757\u624d\u884c\uff0c\u8fd9\u6837\u8bf4\u4e0d\u5bb9\u6613\u660e\u767d\uff0c\u6211\u4eec\u505a\u4e2a\u4f8b\u5b50\uff0c\u5c31\u80fd\u591f\u660e\u767d\u3002</p> <p>\u6211\u4eec\u77e5\u9053\uff0csshd\u670d\u52a1\u7684\u9ed8\u8ba4\u7aef\u53e3\u4e3a22\uff0c\u5f53\u6211\u4eec\u4f7f\u7528ssh\u5de5\u5177\u8fdc\u7a0b\u8fde\u63a5\u4e3b\u673a\u65f6\uff0c\u9ed8\u8ba4\u4f1a\u8fde\u63a5\u670d\u52a1\u7aef\u768422\u53f7\u7aef\u53e3\uff0c\u5047\u8bbe\uff0c\u6211\u4eec\u73b0\u5728\u60f3\u8981\u4f7f\u7528iptables\u8bbe\u7f6e\u4e00\u6761\u89c4\u5219\uff0c\u62d2\u7edd\u6765\u81ea192.168.1.146\u7684ssh\u8bf7\u6c42\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u62d2\u7edd146\u4e0a\u7684\u62a5\u6587\u80fd\u591f\u53d1\u5f80\u672c\u673a\u768422\u53f7\u7aef\u53e3\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u5c31\u9700\u8981\u7528\u5230\u201d\u76ee\u6807\u7aef\u53e3\u201d\u9009\u9879\u3002</p> <p>\u4f7f\u7528\u9009\u9879\u2013dport\u53ef\u4ee5\u5339\u914d\u62a5\u6587\u7684\u76ee\u6807\u7aef\u53e3\uff0c\u2013dport\u610f\u4e3adestination-port\uff0c\u5373\u8868\u793a\u76ee\u6807\u7aef\u53e3\u3002</p> <p>\u6ce8\u610f\uff0c\u4e0e\u4e4b\u524d\u7684\u9009\u9879\u4e0d\u540c\uff0c\u2013dport\u524d\u6709\u4e24\u6761\u201d\u6a2a\u6760\u201d\uff0c\u800c\u4e14\uff0c\u4f7f\u7528\u2013dport\u9009\u9879\u65f6\uff0c\u5fc5\u987b\u4e8b\u5148\u6307\u5b9a\u4e86\u4f7f\u7528\u54ea\u79cd\u534f\u8bae\uff0c\u5373\u5fc5\u987b\u5148\u4f7f\u7528-p\u9009\u9879\uff0c\u793a\u4f8b\u5982\u4e0b</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u6211\u4eec\u5c31\u4f7f\u7528\u4e86\u6269\u5c55\u5339\u914d\u6761\u4ef6\u2013dport\uff0c\u6307\u5b9a\u4e86\u5339\u914d\u62a5\u6587\u7684\u76ee\u6807\u7aef\u53e3\uff0c\u5982\u679c\u5916\u6765\u62a5\u6587\u7684\u76ee\u6807\u7aef\u53e3\u4e3a\u672c\u673a\u768422\u53f7\u7aef\u53e3\uff08ssh\u9ed8\u8ba4\u7aef\u53e3\uff09\uff0c\u5219\u62d2\u7edd\u4e4b\uff0c\u800c\u5728\u4f7f\u7528\u2013dport\u4e4b\u524d\uff0c\u6211\u4eec\u4f7f\u7528-m\u9009\u9879\uff0c\u6307\u5b9a\u4e86\u5bf9\u5e94\u7684\u6269\u5c55\u6a21\u5757\u4e3atcp\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u60f3\u8981\u4f7f\u7528\u2013dport\u8fd9\u4e2a\u6269\u5c55\u5339\u914d\u6761\u4ef6\uff0c\u5219\u5fc5\u987b\u4f9d\u9760\u67d0\u4e2a\u6269\u5c55\u6a21\u5757\u5b8c\u6210\uff0c\u4e0a\u4f8b\u4e2d\uff0c\u8fd9\u4e2a\u6269\u5c55\u6a21\u5757\u5c31\u662ftcp\u6269\u5c55\u6a21\u5757\uff0c\u6700\u7ec8\uff0c\u6211\u4eec\u4f7f\u7528\u7684\u662ftcp\u6269\u5c55\u6a21\u5757\u4e2d\u7684dport\u6269\u5c55\u5339\u914d\u6761\u4ef6\u3002</p> <p>\u73b0\u5728\uff0c\u6211\u4eec\u518d\u56de\u8fc7\u5934\u6765\u770b\u770b\u6269\u5c55\u5339\u914d\u6761\u4ef6\u7684\u6982\u5ff5\uff0c\u5c31\u66f4\u52a0\u660e\u767d\u4e86\u3002</p> <p>\u6269\u5c55\u5339\u914d\u6761\u4ef6\u88ab\u4f7f\u7528\u65f6\uff0c\u5219\u9700\u8981\u4f9d\u8d56\u4e00\u4e9b\u6269\u5c55\u6a21\u5757\uff0c\u6216\u8005\u8bf4\uff0c\u5728\u4f7f\u7528\u6269\u5c55\u5339\u914d\u6761\u4ef6\u4e4b\u524d\uff0c\u9700\u8981\u6307\u5b9a\u76f8\u5e94\u7684\u6269\u5c55\u6a21\u5757\u624d\u884c\u3002</p> <p>\u73b0\u5728\u4f60\u660e\u767d\u4e86\u5417\uff1f -m tcp\u8868\u793a\u4f7f\u7528tcp\u6269\u5c55\u6a21\u5757\uff0c\u2013dport\u8868\u793atcp\u6269\u5c55\u6a21\u5757\u4e2d\u7684\u4e00\u4e2a\u6269\u5c55\u5339\u914d\u6761\u4ef6\uff0c\u53ef\u7528\u4e8e\u5339\u914d\u62a5\u6587\u7684\u76ee\u6807\u7aef\u53e3\u3002</p> <p>\u6ce8\u610f\uff0c-p tcp\u4e0e -m tcp\u5e76\u4e0d\u51b2\u7a81\uff0c-p\u7528\u4e8e\u5339\u914d\u62a5\u6587\u7684\u534f\u8bae\uff0c-m \u7528\u4e8e\u6307\u5b9a\u6269\u5c55\u6a21\u5757\u7684\u540d\u79f0\uff0c\u6b63\u597d\uff0c\u8fd9\u4e2a\u6269\u5c55\u6a21\u5757\u4e5f\u53ebtcp\u3002</p> <p>\u5176\u5b9e\uff0c\u4e0a\u4f8b\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u7701\u7565-m\u9009\u9879\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u5f53\u4f7f\u7528-p\u9009\u9879\u6307\u5b9a\u4e86\u62a5\u6587\u7684\u534f\u8bae\u65f6\uff0c\u5982\u679c\u5728\u6ca1\u6709\u4f7f\u7528-m\u6307\u5b9a\u5bf9\u5e94\u7684\u6269\u5c55\u6a21\u5757\u540d\u79f0\u7684\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u4e86\u6269\u5c55\u5339\u914d\u6761\u4ef6\uff0c \u00a0iptables\u9ed8\u8ba4\u4f1a\u8c03\u7528\u4e0e-p\u9009\u9879\u5bf9\u5e94\u7684\u534f\u8bae\u540d\u79f0\u76f8\u540c\u7684\u6a21\u5757\u3002</p> <p>\u4e0a\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528-p\u9009\u9879\u6307\u5b9a\u4e86\u534f\u8bae\u540d\u79f0\uff0c\u4f7f\u7528\u6269\u5c55\u5339\u914d\u6761\u4ef6\u2013dport\u6307\u5b9a\u4e86\u76ee\u6807\u7aef\u53e3\uff0c\u5728\u4f7f\u7528\u6269\u5c55\u5339\u914d\u6761\u4ef6\u7684\u65f6\u5019\uff0c\u5982\u679c\u6ca1\u6709\u4f7f\u7528-m\u6307\u5b9a\u4f7f\u7528\u54ea\u4e2a\u6269\u5c55\u6a21\u5757\uff0ciptables\u4f1a\u9ed8\u8ba4\u4f7f\u7528\u201d-m \u534f\u8bae\u540d\u201d\uff0c\u800c\u534f\u8bae\u540d\u5c31\u662f-p\u9009\u9879\u5bf9\u5e94\u7684\u534f\u8bae\u540d\uff0c\u4e0a\u4f8b\u4e2d\uff0c-p \u5bf9\u5e94\u7684\u503c\u4e3atcp\uff0c\u6240\u4ee5\u9ed8\u8ba4\u8c03\u7528\u7684\u6269\u5c55\u6a21\u5757\u5c31\u4e3a-m tcp\uff0c\u5982\u679c-p\u5bf9\u5e94\u7684\u503c\u4e3audp\uff0c\u90a3\u4e48\u9ed8\u8ba4\u8c03\u7528\u7684\u6269\u5c55\u6a21\u5757\u5c31\u4e3a-m udp\u3002</p> <p>\u6240\u4ee5\uff0c\u4e0a\u4f8b\u4e2d\uff0c\u5176\u5b9e\u201d\u9690\u5f0f\u201d\u7684\u6307\u5b9a\u4e86\u6269\u5c55\u6a21\u5757\uff0c\u53ea\u662f\u6ca1\u6709\u8868\u73b0\u51fa\u6765\u7f62\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u5728\u4f7f\u7528\u6269\u5c55\u5339\u914d\u6761\u4ef6\u65f6\uff0c\u4e00\u5b9a\u8981\u6ce8\u610f\uff0c\u5982\u679c\u8fd9\u4e2a\u6269\u5c55\u5339\u914d\u6761\u4ef6\u6240\u4f9d\u8d56\u7684\u6269\u5c55\u6a21\u5757\u540d\u6b63\u597d\u4e0e-p\u5bf9\u5e94\u7684\u534f\u8bae\u540d\u79f0\u76f8\u540c\uff0c\u90a3\u4e48\u5219\u53ef\u7701\u7565-m\u9009\u9879\uff0c\u5426\u5219\u5219\u4e0d\u80fd\u7701\u7565-m\u9009\u9879\uff0c\u5fc5\u987b\u4f7f\u7528-m\u9009\u9879\u6307\u5b9a\u5bf9\u5e94\u7684\u6269\u5c55\u6a21\u5757\u540d\u79f0\uff0c\u8fd9\u6837\u8bf4\u53ef\u80fd\u8fd8\u662f\u4e0d\u662f\u7279\u522b\u660e\u4e86\uff0c\u5728\u540e\u7eed\u7684\u4e3e\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f1a\u66f4\u52a0\u660e\u4e86\u7684\u7406\u89e3\u8fd9\u4e9b\u6982\u5ff5\u3002</p> <p>\u6709\u201d\u76ee\u6807\u7aef\u53e3\u201d\uff0c\u5c31\u6709\u201d\u6e90\u7aef\u53e3\u201d\uff0c\u4ee3\u8868\u201d\u6e90\u7aef\u53e3\u201d\u7684\u6269\u5c55\u5339\u914d\u6761\u4ef6\u4e3a\u2013sport</p> <p>\u4f7f\u7528\u2013sport\u53ef\u4ee5\u5224\u65ad\u62a5\u6587\u662f\u5426\u4ece\u6307\u5b9a\u7684\u7aef\u53e3\u53d1\u51fa\uff0c\u5373\u5339\u914d\u62a5\u6587\u7684\u6e90\u7aef\u53e3\u662f\u5426\u4e0e\u6307\u5b9a\u7684\u7aef\u53e3\u4e00\u81f4\uff0c\u2013sport\u8868\u793asource-port\uff0c\u5373\u8868\u793a\u6e90\u7aef\u53e3\u4e4b\u610f\u3002</p> <p>\u56e0\u4e3a\u6211\u4eec\u5df2\u7ecf\u641e\u660e\u767d\u4e86dport\uff0c\u90a3\u4e48sport\u6211\u5c31\u4e0d\u518d\u8d58\u8ff0\u4e86\uff0c\u793a\u4f8b\u5982\u4e0b</p> <p></p> <p>\u4e0a\u4f8b\u4e2d\uff0c\u9690\u542b\u4e86\u201d-m tcp\u201d\u4e4b\u610f\uff0c\u8868\u793a\u4f7f\u7528\u4e86tcp\u6269\u5c55\u6a21\u5757\u7684\u2013sport\u6269\u5c55\u5339\u914d\u6761\u4ef6\u3002</p> <p>\u6269\u5c55\u5339\u914d\u6761\u4ef6\u662f\u53ef\u4ee5\u53d6\u53cd\u7684\uff0c\u540c\u6837\u662f\u4f7f\u7528\u201d!\u201d\u8fdb\u884c\u53d6\u53cd\uff0c\u6bd4\u5982 \u201c! \u2013dport 22\u2033\uff0c\u8868\u793a\u76ee\u6807\u7aef\u53e3\u4e0d\u662f22\u7684\u62a5\u6587\u5c06\u4f1a\u88ab\u5339\u914d\u5230\u3002</p> <p>\u4e0d\u7ba1\u662f\u2013sport\u8fd8\u662f\u2013dsport\uff0c\u90fd\u80fd\u591f\u6307\u5b9a\u4e00\u4e2a\u7aef\u53e3\u8303\u56f4\uff0c\u6bd4\u5982\uff0c\u2013dport 22:25\u8868\u793a\u76ee\u6807\u7aef\u53e3\u4e3a22\u523025\u4e4b\u95f4\u7684\u6240\u6709\u7aef\u53e3\uff0c\u537322\u7aef\u53e3\u300123\u7aef\u53e3\u300124\u7aef\u53e3\u300125\u7aef\u53e3\uff0c\u793a\u4f8b\u5982\u4e0b</p> <p></p> <p>\u4e5f\u53ef\u4ee5\u5199\u6210\u5982\u4e0b\u56fe\u4e2d\u7684\u6a21\u6837\uff0c\u4e0b\u56fe\u4e2d\u7b2c\u4e00\u6761\u89c4\u5219\u8868\u793a\u5339\u914d0\u53f7\u523022\u53f7\u4e4b\u95f4\u7684\u6240\u6709\u7aef\u53e3\uff0c\u4e0b\u56fe\u4e2d\u7684\u7b2c\u4e8c\u6761\u89c4\u5219\u8868\u793a\u5339\u914d80\u53f7\u7aef\u53e3\u4ee5\u53ca\u5176\u4ee5\u540e\u7684\u6240\u6709\u7aef\u53e3\uff08\u76f4\u523065535\uff09\u3002</p> <p></p> <p>\u521a\u624d\u804a\u5230\u7684\u4e24\u4e2a\u6269\u5c55\u5339\u914d\u6761\u4ef6\u90fd\u662ftcp\u6269\u5c55\u6a21\u5757\u7684\uff0c\u5176\u5b9e\uff0ctcp\u6269\u5c55\u6a21\u5757\u8fd8\u6709\u4e00\u4e2a\u6bd4\u8f83\u6709\u7528\u7684\u6269\u5c55\u5339\u914d\u6761\u4ef6\u53eb\u505a\u201d\u2013tcp-flags\u201d\uff0c\u4f46\u662f\u7531\u4e8e\u7bc7\u5e45\u539f\u56e0\uff0c\u4ee5\u540e\u518d\u5bf9\u8fd9\u4e2a\u6269\u5c55\u5339\u914d\u6761\u4ef6\u8fdb\u884c\u603b\u7ed3\u3002</p> <p>\u501f\u52a9tcp\u6269\u5c55\u6a21\u5757\u7684\u2013sport\u6216\u8005\u2013dport\u90fd\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u8fde\u7eed\u7684\u7aef\u53e3\u8303\u56f4\uff0c\u4f46\u662f\u65e0\u6cd5\u540c\u65f6\u6307\u5b9a\u591a\u4e2a\u79bb\u6563\u7684\u3001\u4e0d\u8fde\u7eed\u7684\u7aef\u53e3\uff0c\u5982\u679c\u60f3\u8981\u540c\u65f6\u6307\u5b9a\u591a\u4e2a\u79bb\u6563\u7684\u7aef\u53e3\uff0c\u9700\u8981\u501f\u52a9\u53e6\u4e00\u4e2a\u6269\u5c55\u6a21\u5757\uff0c\u201dmultiport\u201d\u6a21\u5757\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528multiport\u6a21\u5757\u7684\u2013sports\u6269\u5c55\u6761\u4ef6\u540c\u65f6\u6307\u5b9a\u591a\u4e2a\u79bb\u6563\u7684\u6e90\u7aef\u53e3\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528multiport\u6a21\u5757\u7684\u2013dports\u6269\u5c55\u6761\u4ef6\u540c\u65f6\u6307\u5b9a\u591a\u4e2a\u79bb\u6563\u7684\u76ee\u6807\u7aef\u53e3\u3002</p> <p>\u793a\u4f8b\u5982\u4e0b</p> <p></p> <p>\u4e0a\u56fe\u793a\u4f8b\u8868\u793a\uff0c\u7981\u6b62\u6765\u81ea146\u7684\u4e3b\u673a\u4e0a\u7684tcp\u62a5\u6587\u8bbf\u95ee\u672c\u673a\u768422\u53f7\u7aef\u53e3\u300136\u53f7\u7aef\u53e3\u4ee5\u53ca80\u53f7\u7aef\u53e3\u3002</p> <p>\u4e0a\u56fe\u4e2d\uff0c\u201d-m multiport \u2013dports 22,36,80\u2033\u8868\u793a\u4f7f\u7528\u4e86multiport\u6269\u5c55\u6a21\u5757\u7684\u2013dports\u6269\u5c55\u6761\u4ef6\uff0c\u4ee5\u540c\u65f6\u6307\u5b9a\u4e86\u591a\u4e2a\u79bb\u6563\u7684\u7aef\u53e3\uff0c\u6bcf\u4e2a\u7aef\u53e3\u4e4b\u95f4\u7528\u9017\u53f7\u9694\u5f00\u3002</p> <p>\u4e0a\u56fe\u4e2d\u7684-m multiport\u662f\u4e0d\u80fd\u7701\u7565\u7684\uff0c\u5982\u679c\u4f60\u7701\u7565\u4e86-m multiport\uff0c\u5c31\u76f8\u5f53\u4e8e\u5728\u6ca1\u6709\u6307\u5b9a\u6269\u5c55\u6a21\u5757\u7684\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u4e86\u6269\u5c55\u6761\u4ef6\uff08\u201d\u2013dports\u201d\uff09\uff0c\u90a3\u4e48\u4e0a\u4f8b\u4e2d\uff0ciptables\u4f1a\u9ed8\u8ba4\u8c03\u7528\u201d-m tcp\u201d\uff0c\u4f46\u662f\uff0c\u201d\u2013dports\u6269\u5c55\u6761\u4ef6\u201d\u5e76\u4e0d\u5c5e\u4e8e\u201dtcp\u6269\u5c55\u6a21\u5757\u201d,\u800c\u662f\u5c5e\u4e8e\u201dmultiport\u6269\u5c55\u6a21\u5757\u201d\uff0c\u6240\u4ee5\uff0c\u8fd9\u65f6\u5c31\u4f1a\u62a5\u9519\u3002</p> <p>\u7efc\u4e0a\u6240\u8ff0\uff0c\u5f53\u4f7f\u7528\u2013dports\u6216\u8005\u2013sports\u8fd9\u79cd\u6269\u5c55\u5339\u914d\u6761\u4ef6\u65f6\uff0c\u5fc5\u987b\u4f7f\u7528-m\u6307\u5b9a\u6a21\u5757\u7684\u540d\u79f0\u3002</p> <p>\u5176\u5b9e\uff0c\u4f7f\u7528multiport\u6a21\u5757\u7684\u2013sports\u4e0e\u2013dpors\u65f6\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u8fde\u7eed\u7684\u7aef\u53e3\u8303\u56f4\uff0c\u5e76\u4e14\u80fd\u591f\u5728\u6307\u5b9a\u8fde\u7eed\u7684\u7aef\u53e3\u8303\u56f4\u7684\u540c\u65f6\uff0c\u6307\u5b9a\u79bb\u6563\u7684\u7aef\u53e3\u53f7\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u4e0a\u4f8b\u4e2d\u7684\u547d\u4ee4\u8868\u793a\u62d2\u7edd\u6765\u81ea192.168.1.146\u7684tcp\u62a5\u6587\u8bbf\u95ee\u5f53\u524d\u4e3b\u673a\u768422\u53f7\u7aef\u53e3\u4ee5\u53ca80\u523088\u4e4b\u95f4\u7684\u6240\u6709\u7aef\u53e3\u53f7\uff0c\u662f\u4e0d\u662f\u5f88\u65b9\u4fbf\uff1f\u6709\u6ca1\u6709\u5f88\u7075\u6d3b\uff1f</p> <p>\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\uff0cmultiport\u6269\u5c55\u53ea\u80fd\u7528\u4e8etcp\u534f\u8bae\u4e0eudp\u534f\u8bae\uff0c\u5373\u914d\u5408-p tcp\u6216\u8005-p udp\u4f7f\u7528\u3002</p> <p>\u518d\u56de\u8fc7\u5934\u770b\u4e4b\u524d\u7684\u6982\u5ff5\uff0c\u6211\u60f3\uff0c\u4f60\u5e94\u8be5\u5c31\u66f4\u52a0\u660e\u767d\u4e86\u3002</p> <p>\u4eca\u5929\uff0c\u6211\u4eec\u53ea\u662f\u521d\u6b65\u7684\u8ba4\u8bc6\u4e86\u6269\u5c55\u6a21\u5757\uff0c\u4ee5\u53ca\u6269\u5c55\u5339\u914d\u6761\u4ef6\uff0c\u8fd8\u6709\u4e00\u4e9b\u6a21\u5757\u6211\u4eec\u5e76\u6ca1\u6709\u603b\u7ed3\uff0c\u597d\u996d\u4e0d\u6015\u665a\uff0c\u540e\u7eed\u4f1a\u6709\u5bf9\u5b83\u4eec\u7684\u603b\u7ed3\u3002</p>"},{"location":"iptables_4/#_5","title":"\u5c0f\u7ed3","text":"<p>\u8fd9\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u4e3b\u8981\u603b\u7ed3\u4e86\u4e00\u4e9b\u5e38\u7528\u7684\u201d\u57fa\u7840\u5339\u914d\u6761\u4ef6\u201d\uff0c\u5e76\u4e14\u521d\u6b65\u7684\u8ba4\u8bc6\u4e86\u4e24\u4e2a\u201d\u6269\u5c55\u6a21\u5757\u201d\u4ee5\u53ca\u8fd9\u4e24\u4e2a\u6269\u5c55\u6a21\u5757\u4e2d\u4e00\u4e9b\u5e38\u7528\u7684\u6269\u5c55\u6761\u4ef6\uff0c\u4e3a\u4e86\u65b9\u4fbf\u4ee5\u540e\u56de\u987e\uff0c\u6211\u4eec\u5c06\u5b83\u4eec\u603b\u7ed3\u5982\u4e0b\u3002</p> <p>\u9996\u5148\u6211\u4eec\u8981\u660e\u786e\u4e00\u70b9\uff0c\u5f53\u89c4\u5219\u4e2d\u540c\u65f6\u5b58\u5728\u591a\u4e2a\u5339\u914d\u6761\u4ef6\u65f6\uff0c\u591a\u4e2a\u6761\u4ef6\u4e4b\u95f4\u9ed8\u8ba4\u5b58\u5728\u201d\u4e0e\u201d\u7684\u5173\u7cfb\uff0c\u5373\u62a5\u6587\u5fc5\u987b\u540c\u65f6\u6ee1\u8db3\u6240\u6709\u6761\u4ef6\uff0c\u624d\u80fd\u88ab\u89c4\u5219\u5339\u914d\u3002</p>"},{"location":"iptables_4/#_6","title":"\u57fa\u672c\u5339\u914d\u6761\u4ef6\u603b\u7ed3","text":"<p>-s\u7528\u4e8e\u5339\u914d\u62a5\u6587\u7684\u6e90\u5730\u5740,\u53ef\u4ee5\u540c\u65f6\u6307\u5b9a\u591a\u4e2a\u6e90\u5730\u5740\uff0c\u6bcf\u4e2aIP\u4e4b\u95f4\u7528\u9017\u53f7\u9694\u5f00\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u4e3a\u4e00\u4e2a\u7f51\u6bb5\u3002</p> <pre><code>#\u793a\u4f8b\u5982\u4e0b\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-s\u00a0192.168.1.111,192.168.1.118\u00a0-j\u00a0DROP\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-s\u00a0192.168.1.0/24\u00a0-j\u00a0ACCEPT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0!\u00a0-s\u00a0192.168.1.0/24\u00a0-j\u00a0ACCEPT\n</code></pre> <p>-d\u7528\u4e8e\u5339\u914d\u62a5\u6587\u7684\u76ee\u6807\u5730\u5740,\u53ef\u4ee5\u540c\u65f6\u6307\u5b9a\u591a\u4e2a\u76ee\u6807\u5730\u5740\uff0c\u6bcf\u4e2aIP\u4e4b\u95f4\u7528\u9017\u53f7\u9694\u5f00\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u4e3a\u4e00\u4e2a\u7f51\u6bb5\u3002</p> <pre><code>#\u793a\u4f8b\u5982\u4e0b\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-d\u00a0192.168.1.111,192.168.1.118\u00a0-j\u00a0DROP\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-d\u00a0192.168.1.0/24\u00a0-j\u00a0ACCEPT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0!\u00a0-d\u00a0192.168.1.0/24\u00a0-j\u00a0ACCEPT\n</code></pre> <p>-p\u7528\u4e8e\u5339\u914d\u62a5\u6587\u7684\u534f\u8bae\u7c7b\u578b,\u53ef\u4ee5\u5339\u914d\u7684\u534f\u8bae\u7c7b\u578btcp\u3001udp\u3001udplite\u3001icmp\u3001esp\u3001ah\u3001sctp\u7b49\uff08centos7\u4e2d\u8fd8\u652f\u6301icmpv6\u3001mh\uff09\u3002</p> <pre><code>#\u793a\u4f8b\u5982\u4e0b\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-p\u00a0tcp\u00a0-s\u00a0192.168.1.146\u00a0-j\u00a0ACCEPT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0!\u00a0-p\u00a0udp\u00a0-s\u00a0192.168.1.146\u00a0-j\u00a0ACCEPT\n</code></pre> <p>-i\u7528\u4e8e\u5339\u914d\u62a5\u6587\u662f\u4ece\u54ea\u4e2a\u7f51\u5361\u63a5\u53e3\u6d41\u5165\u672c\u673a\u7684\uff0c\u7531\u4e8e\u5339\u914d\u6761\u4ef6\u53ea\u662f\u7528\u4e8e\u5339\u914d\u62a5\u6587\u6d41\u5165\u7684\u7f51\u5361\uff0c\u6240\u4ee5\u5728OUTPUT\u94fe\u4e0ePOSTROUTING\u94fe\u4e2d\u4e0d\u80fd\u4f7f\u7528\u6b64\u9009\u9879\u3002</p> <pre><code>#\u793a\u4f8b\u5982\u4e0b\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-p\u00a0icmp\u00a0-i\u00a0eth4\u00a0-j\u00a0DROP\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-p\u00a0icmp\u00a0!\u00a0-i\u00a0eth4\u00a0-j\u00a0DROP\n</code></pre> <p>-o\u7528\u4e8e\u5339\u914d\u62a5\u6587\u5c06\u8981\u4ece\u54ea\u4e2a\u7f51\u5361\u63a5\u53e3\u6d41\u51fa\u672c\u673a\uff0c\u4e8e\u5339\u914d\u6761\u4ef6\u53ea\u662f\u7528\u4e8e\u5339\u914d\u62a5\u6587\u6d41\u51fa\u7684\u7f51\u5361\uff0c\u6240\u4ee5\u5728INPUT\u94fe\u4e0ePREROUTING\u94fe\u4e2d\u4e0d\u80fd\u4f7f\u7528\u6b64\u9009\u9879\u3002</p> <pre><code>#\u793a\u4f8b\u5982\u4e0b\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-p\u00a0icmp\u00a0-o\u00a0eth4\u00a0-j\u00a0DROP\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-p\u00a0icmp\u00a0!\u00a0-o\u00a0eth4\u00a0-j\u00a0DROP\n</code></pre>"},{"location":"iptables_4/#_7","title":"\u6269\u5c55\u5339\u914d\u6761\u4ef6\u603b\u7ed3","text":"<p>\u6211\u4eec\u6765\u603b\u7ed3\u4e00\u4e0b\u4eca\u5929\u8ba4\u8bc6\u7684\u4e24\u4e2a\u6269\u5c55\u6a21\u5757\uff0c\u4ee5\u53ca\u5176\u4e2d\u7684\u6269\u5c55\u6761\u4ef6\uff08\u5e76\u975e\u5168\u90e8\uff0c\u53ea\u662f\u8fd9\u7bc7\u6587\u7ae0\u4e2d\u4ecb\u7ecd\u8fc7\u7684\uff09</p> <p>tcp\u6269\u5c55\u6a21\u5757</p> <p>\u5e38\u7528\u7684\u6269\u5c55\u5339\u914d\u6761\u4ef6\u5982\u4e0b\uff1a</p> <p>-p tcp -m tcp \u2013sport \u7528\u4e8e\u5339\u914dtcp\u534f\u8bae\u62a5\u6587\u7684\u6e90\u7aef\u53e3\uff0c\u53ef\u4ee5\u4f7f\u7528\u5192\u53f7\u6307\u5b9a\u4e00\u4e2a\u8fde\u7eed\u7684\u7aef\u53e3\u8303\u56f4</p> <p>-p tcp -m tcp \u2013dport \u7528\u4e8e\u5339\u914dtcp\u534f\u8bae\u62a5\u6587\u7684\u76ee\u6807\u7aef\u53e3\uff0c\u53ef\u4ee5\u4f7f\u7528\u5192\u53f7\u6307\u5b9a\u4e00\u4e2a\u8fde\u7eed\u7684\u7aef\u53e3\u8303\u56f4</p> <pre><code>#\u793a\u4f8b\u5982\u4e0b\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-d\u00a0192.168.1.146\u00a0-p\u00a0tcp\u00a0-m\u00a0tcp\u00a0--sport\u00a022\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-s\u00a0192.168.1.146\u00a0-p\u00a0tcp\u00a0-m\u00a0tcp\u00a0--dport\u00a022:25\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-s\u00a0192.168.1.146\u00a0-p\u00a0tcp\u00a0-m\u00a0tcp\u00a0--dport\u00a0:22\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-s\u00a0192.168.1.146\u00a0-p\u00a0tcp\u00a0-m\u00a0tcp\u00a0--dport\u00a080:\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-d\u00a0192.168.1.146\u00a0-p\u00a0tcp\u00a0-m\u00a0tcp\u00a0!\u00a0--sport\u00a022\u00a0-j\u00a0ACCEPT\n</code></pre> <p>multiport\u6269\u5c55\u6a21\u5757</p> <p>\u5e38\u7528\u7684\u6269\u5c55\u5339\u914d\u6761\u4ef6\u5982\u4e0b\uff1a</p> <p>-p tcp -m multiport \u2013sports \u7528\u4e8e\u5339\u914d\u62a5\u6587\u7684\u6e90\u7aef\u53e3\uff0c\u53ef\u4ee5\u6307\u5b9a\u79bb\u6563\u7684\u591a\u4e2a\u7aef\u53e3\u53f7,\u7aef\u53e3\u4e4b\u95f4\u7528\u201d\u9017\u53f7\u201d\u9694\u5f00</p> <p>-p udp -m multiport \u2013dports \u7528\u4e8e\u5339\u914d\u62a5\u6587\u7684\u76ee\u6807\u7aef\u53e3\uff0c\u53ef\u4ee5\u6307\u5b9a\u79bb\u6563\u7684\u591a\u4e2a\u7aef\u53e3\u53f7\uff0c\u7aef\u53e3\u4e4b\u95f4\u7528\u201d\u9017\u53f7\u201d\u9694\u5f00</p> <pre><code>#\u793a\u4f8b\u5982\u4e0b\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-d\u00a0192.168.1.146\u00a0-p\u00a0udp\u00a0-m\u00a0multiport\u00a0--sports\u00a0137,138\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-s\u00a0192.168.1.146\u00a0-p\u00a0tcp\u00a0-m\u00a0multiport\u00a0--dports\u00a022,80\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-s\u00a0192.168.1.146\u00a0-p\u00a0tcp\u00a0-m\u00a0multiport\u00a0!\u00a0--dports\u00a022,80\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-s\u00a0192.168.1.146\u00a0-p\u00a0tcp\u00a0-m\u00a0multiport\u00a0--dports\u00a080:88\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-s\u00a0192.168.1.146\u00a0-p\u00a0tcp\u00a0-m\u00a0multiport\u00a0--dports\u00a022,80:88\u00a0-j\u00a0REJECT\n</code></pre> <p>\u597d\u5427\uff0c\u611f\u8c22\u5927\u5bb6\u7a00\u7a00\u62c9\u62c9\u7684\u8d5e\u8d4f\u548c\u8bc4\u8bba\uff0c\u5e0c\u671b\u8fd9\u7bc7\u6587\u7ae0\u4e2d\u7684\u5185\u5bb9\u80fd\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\u3002</p>"},{"location":"iptables_5/","title":"iptables\u8be6\u89e3\uff085\uff09\uff1aiptables\u5339\u914d\u6761\u4ef6\u603b\u7ed3\u4e4b\u4e8c\uff08\u5e38\u7528\u6269\u5c55\u6a21\u5757\uff09","text":"<p>\u5728\u672c\u535a\u5ba2\u4e2d\uff0c\u4ece\u7406\u8bba\u5230\u5b9e\u8df5\uff0c\u7cfb\u7edf\u7684\u4ecb\u7ecd\u4e86iptables\uff0c\u5982\u679c\u4f60\u60f3\u8981\u4ece\u5934\u5f00\u59cb\u4e86\u89e3iptables\uff0c\u53ef\u4ee5\u67e5\u770biptables\u6587\u7ae0\u5217\u8868\uff0c\u76f4\u8fbe\u94fe\u63a5\u5982\u4e0b</p> <p>iptables\u96f6\u57fa\u7840\u5feb\u901f\u5165\u95e8\u7cfb\u5217</p> <p>\u524d\u6587\u5df2\u7ecf\u603b\u7ed3\u4e86iptables\u4e2d\u7684\u57fa\u672c\u5339\u914d\u6761\u4ef6\uff0c\u4ee5\u53ca\u7b80\u5355\u7684\u6269\u5c55\u5339\u914d\u6761\u4ef6\uff0c\u6b64\u5904\uff0c\u6211\u4eec\u6765\u8ba4\u8bc6\u4e00\u4e9b\u65b0\u7684\u6269\u5c55\u6a21\u5757\u3002</p>"},{"location":"iptables_5/#iprange","title":"iprange\u6269\u5c55\u6a21\u5757","text":"<p>\u4e4b\u524d\u6211\u4eec\u5df2\u7ecf\u603b\u7ed3\u8fc7\uff0c\u5728\u4e0d\u4f7f\u7528\u4efb\u4f55\u6269\u5c55\u6a21\u5757\u7684\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528-s\u9009\u9879\u6216\u8005-d\u9009\u9879\u5373\u53ef\u5339\u914d\u62a5\u6587\u7684\u6e90\u5730\u5740\u4e0e\u76ee\u6807\u5730\u5740\uff0c\u800c\u4e14\u5728\u6307\u5b9aIP\u5730\u5740\u65f6\uff0c\u53ef\u4ee5\u540c\u65f6\u6307\u5b9a\u591a\u4e2aIP\u5730\u5740\uff0c\u6bcf\u4e2aIP\u7528\u201d\u9017\u53f7\u201d\u9694\u5f00\uff0c\u4f46\u662f\uff0c-s\u9009\u9879\u4e0e-d\u9009\u9879\u5e76\u4e0d\u80fd\u4e00\u6b21\u6027\u7684\u6307\u5b9a\u4e00\u6bb5\u8fde\u7eed\u7684IP\u5730\u5740\u8303\u56f4\uff0c\u5982\u679c\u6211\u4eec\u9700\u8981\u6307\u5b9a\u4e00\u6bb5\u8fde\u7eed\u7684IP\u5730\u5740\u8303\u56f4\uff0c\u53ef\u4ee5\u4f7f\u7528iprange\u6269\u5c55\u6a21\u5757\u3002</p> <p>\u4f7f\u7528iprange\u6269\u5c55\u6a21\u5757\u53ef\u4ee5\u6307\u5b9a\u201d\u4e00\u6bb5\u8fde\u7eed\u7684IP\u5730\u5740\u8303\u56f4\u201d\uff0c\u7528\u4e8e\u5339\u914d\u62a5\u6587\u7684\u6e90\u5730\u5740\u6216\u8005\u76ee\u6807\u5730\u5740\u3002</p> <p>iprange\u6269\u5c55\u6a21\u5757\u4e2d\u6709\u4e24\u4e2a\u6269\u5c55\u5339\u914d\u6761\u4ef6\u53ef\u4ee5\u4f7f\u7528</p> <p>\u2013src-range</p> <p>\u2013dst-range</p> <p>\u6ca1\u9519\uff0c\u89c1\u540d\u77e5\u610f\uff0c\u4e0a\u8ff0\u4e24\u4e2a\u9009\u9879\u5206\u522b\u7528\u4e8e\u5339\u914d\u62a5\u6587\u7684\u6e90\u5730\u5740\u6240\u5728\u8303\u56f4\u4e0e\u76ee\u6807\u5730\u5740\u6240\u5728\u8303\u56f4\u3002</p> <p>\u793a\u4f8b\u5982\u4e0b\uff1a</p> <p></p> <p>\u4e0a\u4f8b\u8868\u793a\u5982\u679c\u62a5\u6587\u7684\u6e90IP\u5730\u5740\u5982\u679c\u5728192.168.1.127\u5230192.168.1.146\u4e4b\u95f4\uff0c\u5219\u4e22\u5f03\u62a5\u6587\uff0cIP\u6bb5\u7684\u59cb\u672bIP\u4f7f\u7528\u201d\u6a2a\u6760\u201d\u8fde\u63a5\uff0c\u2013src-range\u4e0e\u2013dst-range\u548c\u5176\u4ed6\u5339\u914d\u6761\u4ef6\u4e00\u6837\uff0c\u80fd\u591f\u4f7f\u7528\u201d!\u201d\u53d6\u53cd\uff0c\u6709\u4e86\u524d\u6587\u4e2d\u7684\u77e5\u8bc6\u4f5c\u4e3a\u57fa\u7840\uff0c\u6b64\u5904\u5c31\u4e0d\u518d\u8d58\u8ff0\u4e86\u3002</p>"},{"location":"iptables_5/#string","title":"string\u6269\u5c55\u6a21\u5757","text":"<p>\u4f7f\u7528string\u6269\u5c55\u6a21\u5757\uff0c\u53ef\u4ee5\u6307\u5b9a\u8981\u5339\u914d\u7684\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u62a5\u6587\u4e2d\u5305\u542b\u5bf9\u5e94\u7684\u5b57\u7b26\u4e32\uff0c\u5219\u7b26\u5408\u5339\u914d\u6761\u4ef6\u3002</p> <p>\u6bd4\u5982\uff0c\u5982\u679c\u62a5\u6587\u4e2d\u5305\u542b\u5b57\u7b26\u201dOOXX\u201d\uff0c\u6211\u4eec\u5c31\u4e22\u5f03\u5f53\u524d\u62a5\u6587\u3002</p> <p>\u9996\u5148\uff0c\u6211\u4eec\u5728IP\u4e3a146\u7684\u4e3b\u673a\u4e0a\u542f\u52a8http\u670d\u52a1\uff0c\u7136\u540e\u5728\u9ed8\u8ba4\u7684\u9875\u9762\u76ee\u5f55\u4e2d\u6dfb\u52a0\u4e24\u4e2a\u9875\u9762\uff0c\u9875\u9762\u4e2d\u7684\u5185\u5bb9\u5206\u522b\u4e3a\u201dOOXX\u201d\u548c\u201dHello World\u201d\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5728\u6ca1\u6709\u914d\u7f6e\u4efb\u4f55\u89c4\u5219\u65f6\uff0c126\u4e3b\u673a\u53ef\u4ee5\u6b63\u5e38\u8bbf\u95ee146\u4e3b\u673a\u4e0a\u7684\u8fd9\u4e24\u4e2a\u9875\u9762\u3002</p> <p></p> <p>\u90a3\u4e48\uff0c\u6211\u4eec\u60f3\u8981\u8fbe\u5230\u7684\u76ee\u7684\u662f\uff0c\u5982\u679c\u62a5\u6587\u4e2d\u5305\u542b\u201dOOXX\u201d\u5b57\u7b26\uff0c\u6211\u4eec\u5c31\u62d2\u7edd\u62a5\u6587\u8fdb\u5165\u672c\u673a\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u5728126\u4e0a\u8fdb\u884c\u5982\u4e0b\u914d\u7f6e\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u2019-m string\u2019\u8868\u793a\u4f7f\u7528string\u6a21\u5757\uff0c\u2019\u2013algo bm\u2019\u8868\u793a\u4f7f\u7528bm\u7b97\u6cd5\u53bb\u5339\u914d\u6307\u5b9a\u7684\u5b57\u7b26\u4e32\uff0c\u2019 \u2013string \u201cOOXX\u201d \u2018\u5219\u8868\u793a\u6211\u4eec\u60f3\u8981\u5339\u914d\u7684\u5b57\u7b26\u4e32\u4e3a\u201dOOXX\u201d</p> <p>\u8bbe\u7f6e\u5b8c\u4e0a\u56fe\u4e2d\u7684\u89c4\u5219\u540e\uff0c\u7531\u4e8eindex.html\u4e2d\u5305\u542b\u201dOOXX\u201d\u5b57\u7b26\u4e32\uff0c\u6240\u4ee5\uff0c146\u7684\u56de\u5e94\u62a5\u6587\u65e0\u6cd5\u901a\u8fc7126\u7684INPUT\u94fe\uff0c\u6240\u4ee5\u65e0\u6cd5\u83b7\u53d6\u5230\u9875\u9762\u5bf9\u5e94\u7684\u5185\u5bb9\u3002</p> <p>\u90a3\u4e48\uff0c\u6211\u4eec\u6765\u603b\u7ed3\u4e00\u4e0bstring\u6a21\u5757\u7684\u5e38\u7528\u9009\u9879</p> <p>\u2013algo\uff1a\u7528\u4e8e\u6307\u5b9a\u5339\u914d\u7b97\u6cd5\uff0c\u53ef\u9009\u7684\u7b97\u6cd5\u6709bm\u4e0ekmp\uff0c\u6b64\u9009\u9879\u4e3a\u5fc5\u987b\u9009\u9879\uff0c\u6211\u4eec\u4e0d\u7528\u7ea0\u7ed3\u4e8e\u9009\u62e9\u54ea\u4e2a\u7b97\u6cd5\uff0c\u4f46\u662f\u6211\u4eec\u5fc5\u987b\u6307\u5b9a\u4e00\u4e2a\u3002</p> <p>\u2013string\uff1a\u7528\u4e8e\u6307\u5b9a\u9700\u8981\u5339\u914d\u7684\u5b57\u7b26\u4e32\u3002</p>"},{"location":"iptables_5/#time","title":"time\u6269\u5c55\u6a21\u5757","text":"<p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7time\u6269\u5c55\u6a21\u5757\uff0c\u6839\u636e\u65f6\u95f4\u6bb5\u533a\u5339\u914d\u62a5\u6587\uff0c\u5982\u679c\u62a5\u6587\u5230\u8fbe\u7684\u65f6\u95f4\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u8303\u56f4\u4ee5\u5185\uff0c\u5219\u7b26\u5408\u5339\u914d\u6761\u4ef6\u3002</p> <p>\u6bd4\u5982\uff0c\u201d\u6211\u60f3\u8981\u81ea\u6211\u7ea6\u675f\uff0c\u6bcf\u5929\u65e9\u4e0a9\u70b9\u5230\u4e0b\u53486\u70b9\u4e0d\u80fd\u770b\u7f51\u9875\u201d\uff0c\u64e6\uff0c\u591a\u4e48\u6b8b\u5fcd\u7684\u89c4\u5b9a\uff0c\u5982\u679c\u4f60\u60f3\u8981\u8fd9\u6837\u5b9a\u4e49\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528\u5982\u4e0b\u89c4\u5219\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u201d-m time\u201d\u8868\u793a\u4f7f\u7528time\u6269\u5c55\u6a21\u5757\uff0c\u2013timestart\u9009\u9879\u7528\u4e8e\u6307\u5b9a\u8d77\u59cb\u65f6\u95f4\uff0c\u2013timestop\u9009\u9879\u7528\u4e8e\u6307\u5b9a\u7ed3\u675f\u65f6\u95f4\u3002</p> <p>\u5982\u679c\u4f60\u60f3\u8981\u6362\u4e00\u79cd\u7ea6\u675f\u65b9\u6cd5\uff0c\u53ea\u6709\u5468\u516d\u65e5\u4e0d\u80fd\u770b\u7f51\u9875\uff0c\u90a3\u4e48\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u89c4\u5219\u3002</p> <p></p> <p>\u6ca1\u9519\uff0c\u5982\u4f60\u6240\u89c1\uff0c\u4f7f\u7528\u2013weekdays\u9009\u9879\u53ef\u4ee5\u6307\u5b9a\u6bcf\u4e2a\u661f\u671f\u7684\u5177\u4f53\u54ea\u4e00\u5929\uff0c\u53ef\u4ee5\u540c\u65f6\u6307\u5b9a\u591a\u4e2a\uff0c\u7528\u9017\u53f7\u9694\u5f00\uff0c\u9664\u4e86\u80fd\u591f\u6570\u5b57\u8868\u793a\u201d\u661f\u671f\u51e0\u201d,\u8fd8\u80fd\u7528\u7f29\u5199\u8868\u793a\uff0c\u4f8b\u5982\uff1aMon, Tue, Wed, Thu, Fri, Sat, Sun</p> <p>\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u5c06\u4e0a\u8ff0\u51e0\u4e2a\u9009\u9879\u7ed3\u5408\u8d77\u6765\u4f7f\u7528\uff0c\u6bd4\u5982\u6307\u5b9a\u53ea\u6709\u5468\u516d\u65e5\u7684\u65e9\u4e0a9\u70b9\u5230\u4e0b\u53486\u70b9\u4e0d\u80fd\u6d4f\u89c8\u7f51\u9875\u3002</p> <p></p> <p>\u806a\u660e\u5982\u4f60\u4e00\u5b9a\u60f3\u5230\u4e86\uff0c\u65e2\u7136\u6709\u2013weekdays\u9009\u9879\u4e86\uff0c\u90a3\u4e48\u6709\u6ca1\u6709\u2013monthdays\u9009\u9879\u5462\uff1f\u5fc5\u987b\u6709\u554a\uff01</p> <p>\u4f7f\u7528\u2013monthdays\u9009\u9879\u53ef\u4ee5\u5177\u4f53\u6307\u5b9a\u7684\u6bcf\u4e2a\u6708\u7684\u54ea\u4e00\u5929\uff0c\u6bd4\u5982\uff0c\u5982\u4e0b\u56fe\u8bbe\u7f6e\u8868\u793a\u6307\u660e\u6bcf\u6708\u768422\u53f7\uff0c23\u53f7\u3002</p> <p></p> <p>\u524d\u6587\u5df2\u7ecf\u603b\u7ed3\u8fc7\uff0c\u5f53\u4e00\u6761\u89c4\u5219\u4e2d\u540c\u65f6\u5b58\u5728\u591a\u4e2a\u6761\u4ef6\u65f6\uff0c\u591a\u4e2a\u6761\u4ef6\u4e4b\u95f4\u9ed8\u8ba4\u5b58\u5728\u201d\u4e0e\u201d\u7684\u5173\u7cfb\uff0c\u6240\u4ee5\uff0c\u4e0b\u56fe\u4e2d\u7684\u8bbe\u7f6e\u8868\u793a\u5339\u914d\u7684\u65f6\u95f4\u5fc5\u987b\u4e3a\u661f\u671f5\uff0c\u5e76\u4e14\u8fd9\u4e2a\u201d\u661f\u671f5\u2033\u540c\u65f6\u8fd8\u9700\u8981\u662f\u6bcf\u4e2a\u6708\u768422\u53f7\u523028\u53f7\u4e4b\u95f4\u7684\u4e00\u5929\uff0c\u6240\u4ee5\uff0c\u4e0b\u56fe\u4e2d\u7684\u8bbe\u7f6e\u8868\u793a\u6bcf\u4e2a\u6708\u7684\u7b2c4\u4e2a\u661f\u671f5</p> <p></p> <p>\u9664\u4e86\u4f7f\u7528\u2013weekdays\u9009\u9879\u4e0e\u2013monthdays\u9009\u9879\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u2013datestart \u9009\u9879\u4e0e-datestop\u9009\u9879\uff0c\u6307\u5b9a\u5177\u4f53\u7684\u65e5\u671f\u8303\u56f4\uff0c\u5982\u4e0b\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u6307\u5b9a\u7684\u65e5\u671f\u8303\u56f4\u4e3a2017\u5e7412\u670824\u65e5\u52302017\u5e7412\u670827\u65e5</p> <p>\u4e0a\u8ff0\u9009\u9879\u4e2d\uff0c\u2013monthdays\u4e0e\u2013weekdays\u53ef\u4ee5\u4f7f\u7528\u201d!\u201d\u53d6\u53cd\uff0c\u5176\u4ed6\u9009\u9879\u4e0d\u80fd\u53d6\u53cd\u3002</p>"},{"location":"iptables_5/#connlimit","title":"connlimit\u6269\u5c55\u6a21\u5757","text":"<p>\u4f7f\u7528connlimit\u6269\u5c55\u6a21\u5757\uff0c\u53ef\u4ee5\u9650\u5236\u6bcf\u4e2aIP\u5730\u5740\u540c\u65f6\u94fe\u63a5\u5230server\u7aef\u7684\u94fe\u63a5\u6570\u91cf\uff0c\u6ce8\u610f\uff1a\u6211\u4eec\u4e0d\u7528\u6307\u5b9aIP\uff0c\u5176\u9ed8\u8ba4\u5c31\u662f\u9488\u5bf9\u201d\u6bcf\u4e2a\u5ba2\u6237\u7aefIP\u201d\uff0c\u5373\u5bf9\u5355IP\u7684\u5e76\u53d1\u8fde\u63a5\u6570\u9650\u5236\u3002</p> <p>\u6bd4\u5982\uff0c\u6211\u4eec\u60f3\u8981\u9650\u5236\uff0c\u6bcf\u4e2aIP\u5730\u5740\u6700\u591a\u53ea\u80fd\u5360\u7528\u4e24\u4e2assh\u94fe\u63a5\u8fdc\u7a0b\u5230server\u7aef\uff0c\u6211\u4eec\u5219\u53ef\u4ee5\u8fdb\u884c\u5982\u4e0b\u9650\u5236\u3002</p> <p></p> <p>\u4e0a\u4f8b\u4e2d\uff0c\u4f7f\u7528\u201d-m connlimit\u201d\u6307\u5b9a\u4f7f\u7528connlimit\u6269\u5c55\uff0c\u4f7f\u7528\u201d\u2013connlimit-above 2\u2033\u8868\u793a\u9650\u5236\u6bcf\u4e2aIP\u7684\u94fe\u63a5\u6570\u91cf\u4e0a\u9650\u4e3a2\uff0c\u518d\u914d\u5408-p tcp \u2013dport 22\uff0c\u5373\u8868\u793a\u9650\u5236\u6bcf\u4e2a\u5ba2\u6237\u7aefIP\u7684ssh\u5e76\u53d1\u94fe\u63a5\u6570\u91cf\u4e0d\u80fd\u9ad8\u4e8e2\u3002</p> <p>centos6\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u2013connlimit-above\u9009\u9879\u8fdb\u884c\u53d6\u53cd\uff0c\u6ca1\u9519\uff0c\u8001\u89c4\u77e9\uff0c\u4f7f\u7528\u201d!\u201d\u5bf9\u6b64\u6761\u4ef6\u8fdb\u884c\u53d6\u53cd\uff0c\u793a\u4f8b\u5982\u4e0b</p> <p></p> <p>\u4e0a\u4f8b\u8868\u793a\uff0c\u6bcf\u4e2a\u5ba2\u6237\u7aefIP\u7684ssh\u94fe\u63a5\u6570\u91cf\u53ea\u8981\u4e0d\u8d85\u8fc7\u4e24\u4e2a\uff0c\u5219\u5141\u8bb8\u94fe\u63a5\u3002</p> <p>\u4f46\u662f\u806a\u660e\u5982\u4f60\u4e00\u5b9a\u60f3\u5230\u4e86\uff0c\u4e0a\u4f8b\u7684\u89c4\u5219\u5e76\u4e0d\u80fd\u8868\u793a\uff1a\u6bcf\u4e2a\u5ba2\u6237\u7aefIP\u7684ssh\u94fe\u63a5\u6570\u91cf\u8d85\u8fc7\u4e24\u4e2a\u5219\u62d2\u7edd\u94fe\u63a5\uff08\u4e0e\u524d\u6587\u4e2d\u7684\u4e3e\u4f8b\u539f\u7406\u76f8\u540c\uff0c\u6b64\u5904\u4e0d\u518d\u8d58\u8ff0\uff0c\u5982\u679c\u4f60\u4e0d\u660e\u767d\uff0c\u8bf7\u53c2\u8003\u4e4b\u524d\u7684\u6587\u7ae0\uff09\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5373\u4f7f\u6211\u4eec\u914d\u7f6e\u4e86\u4e0a\u4f8b\u4e2d\u7684\u89c4\u5219\uff0c\u4e5f\u4e0d\u80fd\u8fbe\u5230\u201d\u9650\u5236\u201d\u7684\u76ee\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u901a\u5e38\u5e76\u4e0d\u4f1a\u5bf9\u6b64\u9009\u9879\u53d6\u53cd\uff0c\u56e0\u4e3a\u65e2\u7136\u4f7f\u7528\u4e86\u6b64\u9009\u9879\uff0c\u6211\u4eec\u7684\u76ee\u7684\u901a\u5e38\u5c31\u662f\u201d\u9650\u5236\u201d\u8fde\u63a5\u6570\u91cf\u3002</p> <p>centos7\u4e2diptables\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u65b0\u7684\u9009\u9879\uff0c\u2013connlimit-upto\uff0c\u8fd9\u4e2a\u9009\u9879\u7684\u542b\u4e49\u4e0e\u201d! \u2013commlimit-above\u201d\u7684\u542b\u4e49\u76f8\u540c\uff0c\u5373\u94fe\u63a5\u6570\u91cf\u672a\u8fbe\u5230\u6307\u5b9a\u7684\u8fde\u63a5\u6570\u91cf\u4e4b\u610f\uff0c\u6240\u4ee5\u7efc\u4e0a\u6240\u8ff0\uff0c\u2013connlimit-upto\u9009\u9879\u4e5f\u4e0d\u5e38\u7528\u3002</p> <p>\u521a\u624d\u8bf4\u8fc7\uff0c\u2013connlimit-above\u9ed8\u8ba4\u8868\u793a\u9650\u5236\u201d\u6bcf\u4e2aIP\u201d\u7684\u94fe\u63a5\u6570\u91cf\uff0c\u5176\u5b9e\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u914d\u5408\u2013connlimit-mask\u9009\u9879\uff0c\u53bb\u9650\u5236\u201d\u67d0\u7c7b\u7f51\u6bb5\u201d\u7684\u94fe\u63a5\u6570\u91cf\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a</p> <p>\uff08\u6ce8\uff1a\u4e0b\u4f8b\u9700\u8981\u4e00\u5b9a\u7684\u7f51\u7edc\u77e5\u8bc6\u57fa\u7840\uff0c\u5982\u679c\u4f60\u8fd8\u4e0d\u4e86\u89e3\u5b83\u4eec\uff0c\u53ef\u4ee5\u9009\u62e9\u5148\u8df3\u8fc7\u6b64\u9009\u9879\u6216\u8005\u5148\u53bb\u5b66\u4e60\u90e8\u5206\u7684\u7f51\u7edc\u77e5\u8bc6\uff09</p> <p></p> <p>\u4e0a\u4f8b\u4e2d\uff0c\u201d\u2013connlimit-mask 24\u2033\u8868\u793a\u67d0\u4e2aC\u7c7b\u7f51\u6bb5\uff0c\u6ca1\u9519\uff0cmask\u4e3a\u63a9\u7801\u4e4b\u610f\uff0c\u6240\u4ee5\u5c0624\u8f6c\u6362\u6210\u70b9\u5206\u5341\u8fdb\u5236\u5c31\u8868\u793a255.255.255.0\uff0c\u6240\u4ee5\uff0c\u4e0a\u56fe\u793a\u4f8b\u7684\u89c4\u5219\u8868\u793a\uff0c\u4e00\u4e2a\u6700\u591a\u5305\u542b254\u4e2aIP\u7684C\u7c7b\u7f51\u7edc\u4e2d\uff0c\u540c\u65f6\u6700\u591a\u53ea\u80fd\u67092\u4e2assh\u5ba2\u6237\u7aef\u8fde\u63a5\u5230\u5f53\u524d\u670d\u52a1\u5668\uff0c\u770b\u6765\u8d44\u6e90\u5f88\u7d27\u4fcf\u554a\uff01254\u4e2aIP\u624d\u67092\u4e2a\u540d\u989d\uff0c\u5982\u679c\u4e00\u4e2aIP\u540c\u65f6\u628a\u4e24\u4e2a\u8fde\u63a5\u540d\u989d\u90fd\u5360\u7528\u4e86\uff0c\u90a3\u4e48\u5269\u4e0b\u7684253\u4e2aIP\u8fde\u4e00\u4e2a\u8fde\u63a5\u540d\u989d\u90fd\u6ca1\u6709\u4e86\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u518d\u770b\u770b\u4e0b\u4f8b\uff0c\u662f\u4e0d\u662f\u5c31\u597d\u591a\u4e86\u3002</p> <p></p> <p>\u4e0a\u4f8b\u4e2d\uff0c\u201d\u2013connlimit-mask 27\u2033\u8868\u793a\u67d0\u4e2aC\u7c7b\u7f51\u6bb5\uff0c\u901a\u8fc7\u8ba1\u7b97\u540e\u53ef\u4ee5\u5f97\u77e5\uff0c\u8fd9\u4e2a\u7f51\u6bb5\u4e2d\u6700\u591a\u53ea\u80fd\u670930\u53f0\u673a\u5668\uff0830\u4e2aIP\uff09\uff0c\u8fd930\u4e2aIP\u5730\u5740\u6700\u591a\u53ea\u80fd\u670910\u4e2assh\u8fde\u63a5\u540c\u65f6\u8fde\u63a5\u5230\u670d\u52a1\u5668\u7aef\uff0c\u662f\u4e0d\u662f\u6bd4\u521a\u624d\u7684\u8bbe\u7f6e\u5927\u65b9\u591a\u4e86\uff0c\u5f53\u7136\uff0c\u8fd9\u6837\u5e76\u4e0d\u80fd\u907f\u514d\u67d0\u4e2aIP\u5360\u7528\u6240\u6709\u8fde\u63a5\u7684\u60c5\u51b5\u53d1\u751f\uff0c\u5047\u8bbe\uff0c\u62a5\u6587\u6765\u81ea192.168.1.40\u8fd9\u4e2aIP\uff0c\u6309\u7167\u63a9\u7801\u4e3a27\u8fdb\u884c\u8ba1\u7b97\uff0c\u8fd9\u4e2aIP\u5c5e\u4e8e192.168.1.32/27\u7f51\u6bb5\uff0c\u5982\u679c192.168.1.40\u540c\u65f6\u5360\u7528\u4e8610\u4e2assh\u8fde\u63a5\uff0c\u90a3\u4e48\u5f53192.168.1.51\u8fd9\u4e2aIP\u5411\u670d\u52a1\u7aef\u53d1\u8d77ssh\u8fde\u63a5\u8bf7\u6c42\u65f6\uff0c\u540c\u6837\u4f1a\u88ab\u62d2\u7edd\uff0c\u56e0\u4e3a192.168.1.51\u8fd9\u4e2aIP\u6309\u7167\u63a9\u7801\u4e3a27\u8fdb\u884c\u8ba1\u7b97\uff0c\u4e5f\u662f\u5c5e\u4e8e192.168.1.32/27\u7f51\u6bb5\uff0c\u6240\u4ee5\u4ed6\u4eec\u5171\u4eab\u8fd910\u4e2a\u8fde\u63a5\u540d\u989d\u3002</p> <p>\u806a\u660e\u5982\u4f60\u4e00\u5b9a\u660e\u767d\u4e86\uff0c\u5728\u4e0d\u4f7f\u7528\u2013connlimit-mask\u7684\u60c5\u51b5\u4e0b\uff0c\u8fde\u63a5\u6570\u91cf\u7684\u9650\u5236\u662f\u9488\u5bf9\u201d\u6bcf\u4e2aIP\u201d\u800c\u8a00\u7684\uff0c\u5f53\u4f7f\u7528\u4e86\u2013connlimit-mask\u9009\u9879\u4ee5\u540e\uff0c\u5219\u53ef\u4ee5\u9488\u5bf9\u201d\u67d0\u7c7bIP\u6bb5\u5185\u7684\u4e00\u5b9a\u6570\u91cf\u7684IP\u201d\u8fdb\u884c\u8fde\u63a5\u6570\u91cf\u7684\u9650\u5236\uff0c\u8fd9\u6837\u5c31\u80fd\u591f\u7075\u6d3b\u8bb8\u591a\uff0c\u4e0d\u662f\u5417\uff1f</p>"},{"location":"iptables_5/#limit","title":"limit\u6269\u5c55\u6a21\u5757","text":"<p>\u521a\u624d\u8ba4\u8bc6\u4e86connlimit\u6a21\u5757\uff0c\u73b0\u5728\u6765\u8ba4\u8bc6\u4e00\u4e0blimit\u6a21\u5757\u3002</p> <p>connlimit\u6a21\u5757\u662f\u5bf9\u8fde\u63a5\u6570\u91cf\u8fdb\u884c\u9650\u5236\u7684\uff0climit\u6a21\u5757\u662f\u5bf9\u201d\u62a5\u6587\u5230\u8fbe\u901f\u7387\u201d\u8fdb\u884c\u9650\u5236\u7684\u3002</p> <p>\u7528\u5927\u767d\u8bdd\u8bf4\u5c31\u662f\uff0c\u5982\u679c\u6211\u60f3\u8981\u9650\u5236\u5355\u4f4d\u65f6\u95f4\u5185\u6d41\u5165\u7684\u5305\u7684\u6570\u91cf\uff0c\u5c31\u80fd\u7528limit\u6a21\u5757\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u4ee5\u79d2\u4e3a\u5355\u4f4d\u8fdb\u884c\u9650\u5236\uff0c\u4e5f\u53ef\u4ee5\u4ee5\u5206\u949f\u3001\u5c0f\u65f6\u3001\u5929\u4f5c\u4e3a\u5355\u4f4d\u8fdb\u884c\u9650\u5236\u3002</p> <p>\u6bd4\u5982\uff0c\u9650\u5236\u6bcf\u79d2\u4e2d\u6700\u591a\u6d41\u51653\u4e2a\u5305\uff0c\u6216\u8005\u9650\u5236\u6bcf\u5206\u949f\u6700\u591a\u6d41\u516530\u4e2a\u5305\uff0c\u90fd\u53ef\u4ee5\u3002</p> <p>\u90a3\u4e48\uff0c\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u793a\u4f8b\uff0c\u5047\u8bbe\uff0c\u6211\u4eec\u60f3\u8981\u9650\u5236\uff0c\u5916\u90e8\u4e3b\u673a\u5bf9\u672c\u673a\u8fdb\u884cping\u64cd\u4f5c\u65f6\uff0c\u672c\u673a\u6700\u591a\u6bcf6\u79d2\u4e2d\u653e\u884c\u4e00\u4e2aping\u5305\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u884c\u5982\u4e0b\u8bbe\u7f6e\uff08\u6ce8\u610f\uff0c\u53ea\u8fdb\u884c\u5982\u4e0b\u8bbe\u7f6e\u6709\u53ef\u80fd\u65e0\u6cd5\u5b9e\u73b0\u9650\u5236\u529f\u80fd\uff0c\u8bf7\u770b\u5b8c\u540e\u9762\u7684\u5185\u5bb9\uff09</p> <p></p> <p>\u4e0a\u4f8b\u4e2d\uff0c\u201d-p icmp\u201d\u8868\u793a\u6211\u4eec\u9488\u5bf9ping\u8bf7\u6c42\u6dfb\u52a0\u4e86\u4e00\u6761\u89c4\u5219\uff08ping\u4f7f\u7528icmp\u534f\u8bae\uff09\uff0c\u201d-m limit\u201d\u8868\u793a\u4f7f\u7528limit\u6a21\u5757\uff0c \u201c\u2013limit 10/minute -j ACCEPT\u201d\u8868\u793a\u6bcf\u5206\u949f\u6700\u591a\u653e\u884c10\u4e2a\u5305\uff0c\u5c31\u76f8\u5f53\u4e8e\u6bcf6\u79d2\u949f\u6700\u591a\u653e\u884c\u4e00\u4e2a\u5305\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u5c31\u662f\u6bcf\u8fc76\u79d2\u949f\u653e\u884c\u4e00\u4e2a\u5305\uff0c\u90a3\u4e48\u914d\u7f6e\u5b8c\u4e0a\u8ff0\u89c4\u5219\u540e\uff0c\u6211\u4eec\u5728\u53e6\u5916\u4e00\u53f0\u673a\u5668\u4e0a\u5bf9\u5f53\u524d\u673a\u5668\u8fdb\u884cping\u64cd\u4f5c\uff0c\u770b\u770b\u662f\u5426\u80fd\u591f\u8fbe\u5230\u9650\u5236\u7684\u76ee\u7684\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u6211\u4eec\u53d1\u73b0\uff0c\u521a\u624d\u914d\u7f6e\u7684\u89c4\u5219\u5e76\u6ca1\u6709\u5982\u6211\u4eec\u60f3\u8c61\u4e2d\u7684\u4e00\u6837\uff0cping\u8bf7\u6c42\u7684\u54cd\u5e94\u901f\u7387\u5b8c\u5168\u6ca1\u6709\u53d1\u751f\u4efb\u4f55\u53d8\u5316\uff0c\u4e3a\u4ec0\u4e48\u5462\uff1f\u6211\u4eec\u4e00\u8d77\u6765\u5206\u6790\u4e00\u4e0b\u3002</p> <p>\u6211\u4eec\u518d\u6765\u56de\u987e\u4e00\u4e0b\u521a\u624d\u914d\u7f6e\u7684\u89c4\u5219\u3002</p> <p></p> <p>\u5176\u5b9e\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4e0a\u56fe\u4e2d\u7684\u89c4\u5219\u7406\u89e3\u4e3a\u5982\u4e0b\u542b\u4e49\u3002</p> <p>\u6bcf6\u79d2\u653e\u884c\u4e00\u4e2a\u5305\uff0c\u90a3\u4e48iptables\u5c31\u4f1a\u8ba1\u65f6\uff0c\u6bcf6\u79d2\u4e00\u4e2a\u8f6e\u6b21\uff0c\u5230\u7b2c6\u79d2\u65f6\uff0c\u8fbe\u5230\u7684\u62a5\u6587\u5c31\u4f1a\u5339\u914d\u5230\u5bf9\u5e94\u7684\u89c4\u5219\uff0c\u6267\u884c\u5bf9\u5e94\u7684\u52a8\u4f5c\uff0c\u800c\u4e0a\u56fe\u4e2d\u7684\u52a8\u4f5c\u662fACCEPT\u3002</p> <p>\u90a3\u4e48\u5728\u7b2c6\u79d2\u4e4b\u524d\u5230\u8fbe\u7684\u5305\uff0c\u5219\u65e0\u6cd5\u88ab\u4e0a\u8ff0\u89c4\u5219\u5339\u914d\u5230\u3002</p> <p>\u4e4b\u524d\u603b\u7ed3\u8fc7\uff0c\u62a5\u6587\u4f1a\u5339\u914d\u94fe\u4e2d\u7684\u6bcf\u4e00\u6761\u89c4\u5219\uff0c\u5982\u679c\u6ca1\u6709\u4efb\u4f55\u4e00\u6761\u89c4\u5219\u80fd\u591f\u5339\u914d\u5230\uff0c\u5219\u5339\u914d\u9ed8\u8ba4\u52a8\u4f5c\uff08\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\uff09\u3002</p> <p>\u65e2\u7136\u7b2c6\u79d2\u4e4b\u524d\u7684\u5305\u6ca1\u6709\u88ab\u4e0a\u8ff0\u89c4\u5219\u5339\u914d\u5230\uff0c\u800c\u6211\u4eec\u53c8\u6ca1\u6709\u5728INPUT\u94fe\u4e2d\u914d\u7f6e\u5176\u4ed6\u89c4\u5219\uff0c\u6240\u4ee5\uff0c\u7b2c6\u79d2\u4e4b\u524d\u7684\u5305\u80af\u5b9a\u4f1a\u88ab\u9ed8\u8ba4\u7b56\u7565\u5339\u914d\u5230\uff0c\u90a3\u4e48\u6211\u4eec\u770b\u770b\u9ed8\u8ba4\u7b56\u7565\u662f\u4ec0\u4e48\u3002</p> <p></p> <p>\u73b0\u5728\u518d\u60f3\u60f3\uff0c\u6211\u60f3\u4f60\u5e94\u8be5\u660e\u767d\u4e3a\u4ec0\u4e48\u521a\u624d\u7684ping\u7684\u54cd\u5e94\u901f\u7387\u6ca1\u6709\u53d8\u5316\u4e86\u3002</p> <p>\u56e0\u4e3a\uff0c\u4e0a\u4f8b\u4e2d\uff0c\u7b2c\u516d\u79d2\u7684\u62a5\u6587\u7684\u786e\u88ab\u5bf9\u5e94\u7684\u89c4\u5219\u5339\u914d\u5230\u4e86\uff0c\u4e8e\u662f\u6267\u884c\u4e86\u201d\u653e\u884c\u201d\u64cd\u4f5c\uff0c\u7b2c6\u79d2\u4e4b\u524d\u7684\u62a5\u6587\u6ca1\u6709\u88ab\u4e0a\u56fe\u4e2d\u914d\u7f6e\u7684\u89c4\u5219\u5339\u914d\u5230\uff0c\u4f46\u662f\u88ab\u9ed8\u8ba4\u7b56\u7565\u5339\u914d\u5230\u4e86\uff0c\u800c\u6070\u5de7\uff0c\u9ed8\u8ba4\u52a8\u4f5c\u4e5f\u662fACCEPT\uff0c\u6240\u4ee5\uff0c\u76f8\u5f53\u4e8e\u6240\u6709\u7684ping\u62a5\u6587\u90fd\u88ab\u653e\u884c\u4e86\uff0c\u602a\u4e0d\u5f97\u4e0e\u6ca1\u6709\u914d\u7f6e\u89c4\u5219\u65f6\u7684\u901f\u7387\u4e00\u6bdb\u4e00\u6837\u4e86\u3002</p> <p>\u90a3\u4e48\uff0c\u77e5\u9519\u5c31\u6539\uff0c\u806a\u660e\u5982\u4f60\u4e00\u5b9a\u60f3\u5230\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u4fee\u6539INPUT\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\uff0c\u6216\u8005\u5728\u4e0a\u4f8b\u9650\u5236\u89c4\u5219\u7684\u540e\u9762\u518d\u52a0\u5165\u4e00\u6761\u89c4\u5219\uff0c\u5c06\u201d\u6f0f\u7f51\u4e4b\u9c7c\u201d\u5339\u914d\u5230\u5373\u53ef\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u7b2c\u4e00\u6761\u89c4\u5219\u8868\u793a\u6bcf\u5206\u949f\u6700\u591a\u653e\u884c10\u4e2aicmp\u5305\uff0c\u4e5f\u5c31\u662f6\u79d2\u653e\u884c\u4e00\u4e2a\uff0c\u7b2c6\u79d2\u7684icmp\u5305\u4f1a\u88ab\u4e0a\u4f8b\u4e2d\u7684\u7b2c\u4e00\u6761\u89c4\u5219\u5339\u914d\u5230\uff0c\u7b2c6\u79d2\u4e4b\u524d\u7684\u5305\u5219\u4e0d\u4f1a\u88ab\u7b2c\u4e00\u6761\u89c4\u5219\u5339\u914d\u5230\uff0c\u4e8e\u662f\u88ab\u540e\u9762\u7684\u62d2\u7edd\u89c4\u5219\u5339\u914d\u5230\u4e86\uff0c\u90a3\u4e48\uff0c\u6b64\u523b\uff0c\u6211\u4eec\u518d\u6765\u8bd5\u8bd5\uff0c\u770b\u770bping\u7684\u62a5\u6587\u653e\u884c\u901f\u7387\u6709\u6ca1\u6709\u53d1\u751f\u6539\u53d8\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a</p> <p></p> <p>\u521a\u5f00\u59cb\u8fd8\u771f\u5413\u6211\u4e00\u8df3\uff0c\u96be\u9053\u914d\u7f6e\u7684\u89c4\u5219\u8fd8\u662f\u6709\u95ee\u9898\uff1f</p> <p>\u7ed3\u679c\u53d1\u73b0\uff0c\u53ea\u6709\u524d5\u4e2aping\u5305\u6ca1\u6709\u53d7\u5230\u9650\u5236\uff0c\u4e4b\u540e\u7684ping\u5305\u5df2\u7ecf\u5f00\u59cb\u53d7\u5230\u4e86\u89c4\u5219\u7684\u9650\u5236\u4e86\u3002</p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u9664\u4e86\u524d5\u4e2aping\u5305\u4ee5\u5916\uff0c\u4e4b\u540e\u7684ping\u5305\u5dee\u4e0d\u591a\u6bcf6\u79d2\u624d\u80fdping\u901a\u4e00\u6b21\uff0c\u770b\u6765\uff0c\u4e4b\u540e\u7684ping\u5305\u5df2\u7ecf\u53d7\u5230\u4e86\u89c4\u5219\u7684\u63a7\u5236\uff0c\u88ab\u9650\u5236\u4e86\u6d41\u5165\u9632\u706b\u5899\u7684\u901f\u7387\u4e86\uff0c\u90a3\u4e48\uff0c\u524d5\u4e2aping\u5305\u662f\u4ec0\u4e48\u9b3c\uff1f\u4e3a\u4ec0\u4e48\u5b83\u4eec\u4e0d\u53d7\u89c4\u5219\u9650\u5236\u5462\uff1f\u5176\u5b9e\uff0c\u8fd9\u4e2a\u73b0\u8c61\u6b63\u597d\u5f15\u51fa\u53e6\u4e00\u4e2a\u8bdd\u9898\uff0c\u51fa\u73b0\u4e0a\u56fe\u4e2d\u7684\u60c5\u51b5\uff0c\u662f\u56e0\u4e3a\u53e6\u4e00\u4e2a\u9009\u9879\uff1a\u201d\u2013limit-burst\u201d</p> <p>limit-burst\u9009\u9879\u662f\u5e72\u4ec0\u4e48\u7528\u7684\u5462\uff1f\u6211\u4eec\u5148\u7528\u4e0d\u51c6\u786e\u7684\u5927\u767d\u8bdd\u63cf\u8ff0\u4e00\u904d\uff0c\u201d\u2013limit-burst\u201d\u53ef\u4ee5\u6307\u5b9a\u201d\u7a7a\u95f2\u65f6\u53ef\u653e\u884c\u7684\u5305\u7684\u6570\u91cf\u201d\uff0c\u5176\u5b9e\uff0c\u8fd9\u6837\u8bf4\u5e76\u4e0d\u51c6\u786e\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u5148\u8fd9\u6837\u5927\u6982\u7684\u7406\u89e3\uff0c\u5728\u4e0d\u4f7f\u7528\u201d\u2013limit-burst\u201d\u9009\u9879\u660e\u786e\u6307\u5b9a\u653e\u884c\u5305\u7684\u6570\u91cf\u65f6\uff0c\u9ed8\u8ba4\u503c\u4e3a5\uff0c\u6240\u4ee5\uff0c\u624d\u4f1a\u51fa\u73b0\u4e0a\u56fe\u4e2d\u7684\u60c5\u51b5\uff0c\u524d5\u4e2aping\u5305\u5e76\u6ca1\u6709\u53d7\u5230\u4efb\u4f55\u901f\u7387\u9650\u5236\uff0c\u4e4b\u540e\u7684\u5305\u624d\u53d7\u5230\u4e86\u89c4\u5219\u7684\u9650\u5236\u3002</p> <p>\u5982\u679c\u60f3\u8981\u5f7b\u5e95\u4e86\u89e3limit\u6a21\u5757\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u6211\u4eec\u9700\u8981\u5148\u4e86\u89e3\u4e00\u4e0b\u201d\u4ee4\u724c\u6876\u201d\u7b97\u6cd5\uff0c\u56e0\u4e3alimit\u6a21\u5757\u4f7f\u7528\u4e86\u4ee4\u724c\u6876\u7b97\u6cd5\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u60f3\u8c61\uff0c\u6709\u4e00\u4e2a\u6728\u6876\uff0c\u6728\u6876\u91cc\u9762\u653e\u4e865\u5757\u4ee4\u724c\uff0c\u800c\u4e14\u8fd9\u4e2a\u6728\u6876\u6700\u591a\u4e5f\u53ea\u80fd\u653e\u4e0b5\u5757\u4ee4\u724c\uff0c\u6240\u6709\u62a5\u6587\u5982\u679c\u60f3\u8981\u51fa\u5173\u5165\u5173\uff0c\u90fd\u5fc5\u987b\u8981\u6301\u6709\u6728\u6876\u4e2d\u7684\u4ee4\u724c\u624d\u884c\uff0c\u8fd9\u4e2a\u6728\u6876\u6709\u4e00\u4e2a\u795e\u5947\u7684\u529f\u80fd\uff0c\u5c31\u662f\u6bcf\u96946\u79d2\u949f\u4f1a\u751f\u6210\u4e00\u5757\u65b0\u7684\u4ee4\u724c\uff0c\u5982\u679c\u6b64\u65f6\uff0c\u6728\u6876\u4e2d\u7684\u4ee4\u724c\u4e0d\u8db35\u5757\uff0c\u90a3\u4e48\u65b0\u751f\u6210\u7684\u4ee4\u724c\u5c31\u5b58\u653e\u5728\u6728\u6876\u4e2d\uff0c\u5982\u679c\u6728\u6876\u4e2d\u5df2\u7ecf\u5b58\u57285\u5757\u4ee4\u724c\uff0c\u65b0\u751f\u6210\u7684\u4ee4\u724c\u5c31\u65e0\u5904\u5b89\u653e\u4e86\uff0c\u53ea\u80fd\u6ea2\u51fa\u6728\u6876\uff08\u4ee4\u724c\u88ab\u4e22\u5f03\uff09\uff0c\u5982\u679c\u6b64\u65f6\u67095\u4e2a\u62a5\u6587\u60f3\u8981\u5165\u5173\uff0c\u90a3\u4e48\u8fd95\u4e2a\u62a5\u6587\u5c31\u53bb\u6728\u6876\u91cc\u627e\u4ee4\u724c\uff0c\u6b63\u597d\u4e00\u4eba\u4e00\u4e2a\uff0c\u4e8e\u662f\u4ed6\u4eec5\u4e2a\u624b\u6301\u4ee4\u724c\uff0c\u5feb\u4e50\u7684\u5165\u5173\u4e86\uff0c\u6b64\u65f6\u6728\u6876\u7a7a\u4e86\uff0c\u518d\u6709\u62a5\u6587\u60f3\u8981\u5165\u5173\uff0c\u5df2\u7ecf\u6ca1\u6709\u5bf9\u5e94\u7684\u4ee4\u724c\u53ef\u4ee5\u4f7f\u7528\u4e86\uff0c\u4f46\u662f\uff0c\u8fc7\u4e866\u79d2\u949f\uff0c\u65b0\u7684\u4ee4\u724c\u751f\u6210\u4e86\uff0c\u6b64\u523b\uff0c\u6b63\u597d\u6765\u4e86\u4e00\u4e2a\u62a5\u6587\u60f3\u8981\u5165\u5173\uff0c\u4e8e\u662f\uff0c\u8fd9\u4e2a\u62a5\u6587\u62ff\u8d77\u8fd9\u4e2a\u4ee4\u724c\uff0c\u5c31\u5165\u5173\u4e86\uff0c\u5728\u8fd9\u4e2a\u62a5\u6587\u4e4b\u540e\uff0c\u5982\u679c\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\u5185\u6ca1\u6709\u65b0\u7684\u62a5\u6587\u60f3\u8981\u5165\u5173\uff0c\u6728\u6876\u4e2d\u7684\u4ee4\u724c\u53c8\u4f1a\u6162\u6162\u7684\u79ef\u6512\u4e86\u8d77\u6765\uff0c\u76f4\u5230\u8fbe\u52305\u4e2a\u4ee4\u724c\uff0c\u5e76\u4e14\u4e00\u76f4\u4fdd\u6301\u77405\u4e2a\u4ee4\u724c\uff0c\u76f4\u5230\u6709\u4eba\u9700\u8981\u4f7f\u7528\u8fd9\u4e9b\u4ee4\u724c\uff0c\u8fd9\u5c31\u662f\u4ee4\u724c\u6876\u7b97\u6cd5\u7684\u5927\u81f4\u903b\u8f91\u3002</p> <p>\u90a3\u4e48\uff0c\u5c31\u62ff\u521a\u624d\u7684\u201d\u4ee4\u724c\u6876\u201d\u7406\u8bba\u7c7b\u6bd4\u6211\u4eec\u7684\u547d\u4ee4\uff0c\u201d\u2013limit\u201d\u9009\u9879\u5c31\u662f\u7528\u4e8e\u6307\u5b9a\u201d\u591a\u957f\u65f6\u95f4\u751f\u6210\u4e00\u4e2a\u65b0\u4ee4\u724c\u7684\u201d\uff0c\u201d\u2013limit-burst\u201d\u9009\u9879\u5c31\u662f\u7528\u4e8e\u6307\u5b9a\u201d\u6728\u6876\u4e2d\u6700\u591a\u5b58\u653e\u51e0\u4e2a\u4ee4\u724c\u7684\u201d\uff0c\u73b0\u5728\uff0c\u4f60\u660e\u767d\u4e86\u5417\uff1f\uff1f\u793a\u4f8b\u5982\u4e0b</p> <p></p> <p>\u4e0a\u4f8b\u8868\u793a\uff0c\u4ee4\u724c\u6876\u4e2d\u6700\u591a\u80fd\u5b58\u653e3\u4e2a\u4ee4\u724c\uff0c\u6bcf\u5206\u949f\u751f\u621010\u4e2a\u4ee4\u724c\uff08\u53736\u79d2\u949f\u751f\u6210\u4e00\u4e2a\u4ee4\u724c\uff09\u3002</p> <p>\u4e4b\u524d\u8bf4\u8fc7\uff0c\u4f7f\u7528\u201d\u2013limit\u201d\u9009\u9879\u65f6\uff0c\u53ef\u4ee5\u9009\u62e9\u7684\u65f6\u95f4\u5355\u4f4d\u6709\u591a\u79cd\uff0c\u5982\u4e0b</p> <p>/second</p> <p>/minute</p> <p>/hour</p> <p>/day</p> <p>\u6bd4\u5982\uff0c3/second\u8868\u793a\u6bcf\u79d2\u751f\u62103\u4e2a\u201d\u4ee4\u724c\u201d\uff0c30/minute\u8868\u793a\u6ca1\u5206\u949f\u751f\u621030\u4e2a\u201d\u4ee4\u724c\u201d\u3002</p> <p>\u6211\u4e0d\u77e5\u9053\u6211\u5230\u5e95\u89e3\u91ca\u6e05\u695a\u6ca1\u6709\uff0c\u6211\u611f\u89c9\u6211\u89e3\u91ca\u6e05\u695a\u4e86\uff0c\u54e5\u4eec\u513f\u4f60\u8d76\u7d27\u52a8\u624b\u8bd5\u8bd5\u5427\u3002</p>"},{"location":"iptables_5/#_1","title":"\u5c0f\u7ed3","text":"<p>\u8001\u89c4\u77e9\uff0c\u4e3a\u4e86\u65b9\u4fbf\u4ee5\u540e\u56de\u987e\uff0c\u6211\u4eec\u5c06\u4e0a\u6587\u4e2d\u63d0\u5230\u7684\u547d\u4ee4\u603b\u7ed3\u5982\u4e0b\u3002</p>"},{"location":"iptables_5/#iprange_1","title":"iprange\u6a21\u5757","text":"<p>\u5305\u542b\u7684\u6269\u5c55\u5339\u914d\u6761\u4ef6\u5982\u4e0b</p> <p>\u2013src-range\uff1a\u6307\u5b9a\u8fde\u7eed\u7684\u6e90\u5730\u5740\u8303\u56f4</p> <p>\u2013dst-range\uff1a\u6307\u5b9a\u8fde\u7eed\u7684\u76ee\u6807\u5730\u5740\u8303\u56f4</p> <pre><code>#\u793a\u4f8b\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-m\u00a0iprange\u00a0--src-range\u00a0192.168.1.127-192.168.1.146\u00a0-j\u00a0DROP\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-m\u00a0iprange\u00a0--dst-range\u00a0192.168.1.127-192.168.1.146\u00a0-j\u00a0DROP\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-m\u00a0iprange\u00a0!\u00a0--src-range\u00a0192.168.1.127-192.168.1.146\u00a0-j\u00a0DROP\n</code></pre>"},{"location":"iptables_5/#string_1","title":"string\u6a21\u5757","text":"<p>\u5e38\u7528\u6269\u5c55\u5339\u914d\u6761\u4ef6\u5982\u4e0b</p> <p>\u2013algo\uff1a\u6307\u5b9a\u5bf9\u5e94\u7684\u5339\u914d\u7b97\u6cd5\uff0c\u53ef\u7528\u7b97\u6cd5\u4e3abm\u3001kmp\uff0c\u6b64\u9009\u9879\u4e3a\u5fc5\u9700\u9009\u9879\u3002</p> <p>\u2013string\uff1a\u6307\u5b9a\u9700\u8981\u5339\u914d\u7684\u5b57\u7b26\u4e32</p> <pre><code>#\u793a\u4f8b\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-p\u00a0tcp\u00a0--sport\u00a080\u00a0-m\u00a0string\u00a0--algo\u00a0bm\u00a0--string\u00a0\"OOXX\"\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-p\u00a0tcp\u00a0--sport\u00a080\u00a0-m\u00a0string\u00a0--algo\u00a0bm\u00a0--string\u00a0\"OOXX\"\u00a0-j\u00a0REJECT\n</code></pre>"},{"location":"iptables_5/#time_1","title":"time\u6a21\u5757","text":"<p>\u5e38\u7528\u6269\u5c55\u5339\u914d\u6761\u4ef6\u5982\u4e0b</p> <p>\u2013timestart\uff1a\u7528\u4e8e\u6307\u5b9a\u65f6\u95f4\u8303\u56f4\u7684\u5f00\u59cb\u65f6\u95f4\uff0c\u4e0d\u53ef\u53d6\u53cd</p> <p>\u2013timestop\uff1a\u7528\u4e8e\u6307\u5b9a\u65f6\u95f4\u8303\u56f4\u7684\u7ed3\u675f\u65f6\u95f4\uff0c\u4e0d\u53ef\u53d6\u53cd</p> <p>\u2013weekdays\uff1a\u7528\u4e8e\u6307\u5b9a\u201d\u661f\u671f\u51e0\u201d\uff0c\u53ef\u53d6\u53cd</p> <p>\u2013monthdays\uff1a\u7528\u4e8e\u6307\u5b9a\u201d\u51e0\u53f7\u201d\uff0c\u53ef\u53d6\u53cd</p> <p>\u2013datestart\uff1a\u7528\u4e8e\u6307\u5b9a\u65e5\u671f\u8303\u56f4\u7684\u5f00\u59cb\u65e5\u671f\uff0c\u4e0d\u53ef\u53d6\u53cd</p> <p>\u2013datestop\uff1a\u7528\u4e8e\u6307\u5b9a\u65e5\u671f\u8303\u56f4\u7684\u7ed3\u675f\u65f6\u95f4\uff0c\u4e0d\u53ef\u53d6\u53cd</p> <pre><code>#\u793a\u4f8b\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-p\u00a0tcp\u00a0--dport\u00a080\u00a0-m\u00a0time\u00a0--timestart\u00a009:00:00\u00a0--timestop\u00a019:00:00\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-p\u00a0tcp\u00a0--dport\u00a0443\u00a0-m\u00a0time\u00a0--timestart\u00a009:00:00\u00a0--timestop\u00a019:00:00\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-p\u00a0tcp\u00a0--dport\u00a080\u00a0\u00a0-m\u00a0time\u00a0--weekdays\u00a06,7\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-p\u00a0tcp\u00a0--dport\u00a080\u00a0\u00a0-m\u00a0time\u00a0--monthdays\u00a022,23\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-p\u00a0tcp\u00a0--dport\u00a080\u00a0\u00a0-m\u00a0time\u00a0!\u00a0--monthdays\u00a022,23\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-p\u00a0tcp\u00a0--dport\u00a080\u00a0\u00a0-m\u00a0time\u00a0--timestart\u00a009:00:00\u00a0--timestop\u00a018:00:00\u00a0--weekdays\u00a06,7\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-p\u00a0tcp\u00a0--dport\u00a080\u00a0\u00a0-m\u00a0time\u00a0--weekdays\u00a05\u00a0--monthdays\u00a022,23,24,25,26,27,28\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-p\u00a0tcp\u00a0--dport\u00a080\u00a0\u00a0-m\u00a0time\u00a0--datestart\u00a02017-12-24\u00a0--datestop\u00a02017-12-27\u00a0-j\u00a0REJECT\n</code></pre>"},{"location":"iptables_5/#connlimit_1","title":"connlimit \u6a21\u5757","text":"<p>\u5e38\u7528\u7684\u6269\u5c55\u5339\u914d\u6761\u4ef6\u5982\u4e0b</p> <p>\u2013connlimit-above\uff1a\u5355\u72ec\u4f7f\u7528\u6b64\u9009\u9879\u65f6\uff0c\u8868\u793a\u9650\u5236\u6bcf\u4e2aIP\u7684\u94fe\u63a5\u6570\u91cf\u3002</p> <p>\u2013connlimit-mask\uff1a\u6b64\u9009\u9879\u4e0d\u80fd\u5355\u72ec\u4f7f\u7528\uff0c\u5728\u4f7f\u7528\u2013connlimit-above\u9009\u9879\u65f6\uff0c\u914d\u5408\u6b64\u9009\u9879\uff0c\u5219\u53ef\u4ee5\u9488\u5bf9\u201d\u67d0\u7c7bIP\u6bb5\u5185\u7684\u4e00\u5b9a\u6570\u91cf\u7684IP\u201d\u8fdb\u884c\u8fde\u63a5\u6570\u91cf\u7684\u9650\u5236\uff0c\u5982\u679c\u4e0d\u660e\u767d\u53ef\u4ee5\u53c2\u8003\u4e0a\u6587\u7684\u8be6\u7ec6\u89e3\u91ca\u3002</p> <pre><code>#\u793a\u4f8b\niptables\u00a0-I\u00a0INPUT\u00a0-p\u00a0tcp\u00a0--dport\u00a022\u00a0-m\u00a0connlimit\u00a0--connlimit-above\u00a02\u00a0-j\u00a0REJECT\niptables\u00a0-I\u00a0INPUT\u00a0-p\u00a0tcp\u00a0--dport\u00a022\u00a0-m\u00a0connlimit\u00a0--connlimit-above\u00a020\u00a0--connlimit-mask\u00a024\u00a0-j\u00a0REJECT\niptables\u00a0-I\u00a0INPUT\u00a0-p\u00a0tcp\u00a0--dport\u00a022\u00a0-m\u00a0connlimit\u00a0--connlimit-above\u00a010\u00a0--connlimit-mask\u00a027\u00a0-j\u00a0REJECT\n</code></pre>"},{"location":"iptables_5/#limit_1","title":"limit\u6a21\u5757","text":"<p>\u5e38\u7528\u7684\u6269\u5c55\u5339\u914d\u6761\u4ef6\u5982\u4e0b</p> <p>\u2013limit-burst\uff1a\u7c7b\u6bd4\u201d\u4ee4\u724c\u6876\u201d\u7b97\u6cd5\uff0c\u6b64\u9009\u9879\u7528\u4e8e\u6307\u5b9a\u4ee4\u724c\u6876\u4e2d\u4ee4\u724c\u7684\u6700\u5927\u6570\u91cf\uff0c\u4e0a\u6587\u4e2d\u5df2\u7ecf\u8be6\u7ec6\u7684\u63cf\u8ff0\u4e86\u201d\u4ee4\u724c\u6876\u201d\u7684\u6982\u5ff5\uff0c\u65b9\u4fbf\u56de\u987e\u3002</p> <p>\u2013limit\uff1a\u7c7b\u6bd4\u201d\u4ee4\u724c\u6876\u201d\u7b97\u6cd5\uff0c\u6b64\u9009\u9879\u7528\u4e8e\u6307\u5b9a\u4ee4\u724c\u6876\u4e2d\u751f\u6210\u65b0\u4ee4\u724c\u7684\u9891\u7387\uff0c\u53ef\u7528\u65f6\u95f4\u5355\u4f4d\u6709second\u3001minute \u3001hour\u3001day\u3002</p> <pre><code>#\u793a\u4f8b\u00a0#\u6ce8\u610f\uff0c\u5982\u4e0b\u4e24\u6761\u89c4\u5219\u9700\u914d\u5408\u4f7f\u7528\uff0c\u5177\u4f53\u539f\u56e0\u4e0a\u6587\u5df2\u7ecf\u89e3\u91ca\u8fc7\uff0c\u5fd8\u8bb0\u4e86\u53ef\u4ee5\u56de\u987e\u3002\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-p\u00a0icmp\u00a0-m\u00a0limit\u00a0--limit-burst\u00a03\u00a0--limit\u00a010/minute\u00a0-j\u00a0ACCEPT\niptables\u00a0-t\u00a0filter\u00a0-A\u00a0INPUT\u00a0-p\u00a0icmp\u00a0-j\u00a0REJECT\n</code></pre> <p>\u5e0c\u671b\u8fd9\u7bc7\u6587\u7ae0\u80fd\u591f\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9~~~</p>"},{"location":"iptables_6/","title":"iptables\u8be6\u89e3\uff086\uff09\uff1aiptables\u6269\u5c55\u5339\u914d\u6761\u4ef6\u4e4b\u2019\u2013tcp-flags\u2019","text":"<p>\u5728\u672c\u535a\u5ba2\u4e2d\uff0c\u4ece\u7406\u8bba\u5230\u5b9e\u8df5\uff0c\u7cfb\u7edf\u7684\u4ecb\u7ecd\u4e86iptables\uff0c\u5982\u679c\u4f60\u60f3\u8981\u4ece\u5934\u5f00\u59cb\u4e86\u89e3iptables\uff0c\u53ef\u4ee5\u67e5\u770biptables\u6587\u7ae0\u5217\u8868\uff0c\u76f4\u8fbe\u94fe\u63a5\u5982\u4e0b</p> <p>iptables\u96f6\u57fa\u7840\u5feb\u901f\u5165\u95e8\u7cfb\u5217</p> <p>\u5982\u679c\u4f60\u770b\u8fc7\u524d\u6587\uff0c\u90a3\u4e48\u4f60\u4e00\u5b9a\u77e5\u9053\uff0c\u524d\u6587\u5df2\u7ecf\u5bf9\u201dtcp\u6269\u5c55\u6a21\u5757\u201d\u505a\u8fc7\u603b\u7ed3\uff0c\u4f46\u662f\u53ea\u603b\u7ed3\u4e86tcp\u6269\u5c55\u6a21\u5757\u4e2d\u7684\u201d\u2013sport\u201d\u4e0e\u201d\u2013dport\u201d\u9009\u9879\uff0c\u5e76\u6ca1\u6709\u603b\u7ed3\u201d\u2013tcp-flags\u201d\u9009\u9879\uff0c\u90a3\u4e48\u6b64\u5904\uff0c\u6211\u4eec\u5c31\u6765\u8ba4\u8bc6\u4e00\u4e0btcp\u6269\u5c55\u6a21\u5757\u4e2d\u7684\u201d\u2013tcp-flags\u201d\u3002</p> <p>\u6ce8\uff1a\u9605\u8bfb\u8fd9\u7bc7\u6587\u7ae0\u4e4b\u524d\uff0c\u9700\u8981\u5bf9tcp\u534f\u8bae\u7684\u57fa\u7840\u77e5\u8bc6\u6709\u4e00\u5b9a\u7684\u4e86\u89e3\uff0c\u6bd4\u5982\uff1atcp\u5934\u7684\u7ed3\u6784\u3001tcp\u4e09\u6b21\u63e1\u624b\u7684\u8fc7\u7a0b\u3002</p> <p>\u89c1\u540d\u77e5\u4e49\uff0c\u201d\u2013tcp-flags\u201d\u6307\u7684\u5c31\u662ftcp\u5934\u4e2d\u7684\u6807\u5fd7\u4f4d\uff0c\u770b\u6765\uff0c\u5728\u4f7f\u7528iptables\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6b64\u6269\u5c55\u5339\u914d\u6761\u4ef6\uff0c\u53bb\u5339\u914dtcp\u62a5\u6587\u7684\u5934\u90e8\u7684\u6807\u8bc6\u4f4d\uff0c\u7136\u540e\u6839\u636e\u6807\u8bc6\u4f4d\u7684\u5b9e\u9645\u60c5\u51b5\u5b9e\u73b0\u8bbf\u95ee\u63a7\u5236\u7684\u529f\u80fd\u3002</p> <p>\u65e2\u7136\u8bf4\u5230\u4e86tcp\u5934\u4e2d\u7684\u6807\u5fd7\u4f4d\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u6765\u56de\u987e\u4e00\u4e0btcp\u5934\u7684\u7ed3\u6784\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u5728\u4f7f\u7528iptables\u65f6\uff0c\u4f7f\u7528tcp\u6269\u5c55\u6a21\u5757\u7684\u201d\u2013tcp-flags\u201d\u9009\u9879\uff0c\u5373\u53ef\u5bf9\u4e0a\u56fe\u4e2d\u7684\u6807\u5fd7\u4f4d\u8fdb\u884c\u5339\u914d\uff0c\u5224\u65ad\u6307\u5b9a\u7684\u6807\u5fd7\u4f4d\u7684\u503c\u662f\u5426\u4e3a\u201d1\u2033\uff0c\u800ctcp header\u7684\u7ed3\u6784\u4e0d\u662f\u6211\u4eec\u4eca\u5929\u8ba8\u8bba\u7684\u91cd\u70b9\uff0c\u6211\u4eec\u7ee7\u7eed\u804atcp\u7684\u6807\u8bc6\u4f4d\uff0c\u5728tcp\u534f\u8bae\u5efa\u7acb\u8fde\u63a5\u7684\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u5148\u8fdb\u884c\u4e09\u6b21\u63e1\u624b\uff0c\u800c\u4e09\u6b21\u63e1\u624b\u5c31\u8981\u4f9d\u9760tcp\u5934\u4e2d\u7684\u6807\u5fd7\u4f4d\u8fdb\u884c\u3002</p> <p>\u4e3a\u4e86\u66f4\u52a0\u5177\u8c61\u5316\u7684\u63cf\u8ff0\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u6211\u4eec\u53ef\u4ee5\u6293\u5305\u67e5\u770bssh\u5efa\u7acb\u8fde\u63a5\u7684\u8fc7\u7a0b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff08\u4f7f\u7528wireshark\u5728ssh\u5ba2\u6237\u7aef\u6293\u5305\uff0c\u8ddf\u8e2a\u5bf9\u5e94\u7684tcp\u6d41\uff09\uff1a</p> <p></p> <p>\u4e0a\u56fe\u4e3atcp\u4e09\u6b21\u63e1\u624b\u4e2d\u7684\u7b2c\u4e00\u6b21\u63e1\u624b\uff0c\u5ba2\u6237\u7aef\uff08IP\u4e3a98\uff09\u4f7f\u7528\u672c\u5730\u7684\u968f\u673a\u7aef\u53e354808\u5411\u670d\u52a1\u7aef\uff08IP\u4e3a137\uff09\u53d1\u8d77\u8fde\u63a5\u8bf7\u6c42\uff0ctcp\u5934\u7684\u6807\u5fd7\u4f4d\u4e2d\uff0c\u53ea\u6709SYN\u4f4d\u88ab\u6807\u8bc6\u4e3a1\uff0c\u5176\u4ed6\u6807\u5fd7\u4f4d\u5747\u4e3a0\u3002</p> <p>\u5728\u4e0a\u56fe\u7684\u4e0b\u65b9\u53ef\u4ee5\u770b\u5230\u201d[TCP Flags: \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7S\u00b7]\u201d\uff0c\u5176\u4e2d\u7684\u201dS\u201d\u5c31\u8868\u793aSYN\u4f4d\uff0c\u6574\u4f53\u8868\u793a\u53ea\u6709SYN\u4f4d\u4e3a1\u3002</p> <p>\u4e0a\u56fe\u4e3atcp\u4e09\u6b21\u63e1\u624b\u4e2d\u7b2c\u4e00\u6b21\u63e1\u624b\u7684tcp\u5934\u4e2d\u7684\u6807\u5fd7\u4f4d\uff0c\u4e0b\u56fe\u662f\u7b2c\u4e8c\u6b21\u63e1\u624b\u7684\uff0c\u670d\u52a1\u7aef\u56de\u5e94\u521a\u624d\u7684\u8bf7\u6c42\uff0c\u5c06\u81ea\u5df1\u7684tcp\u5934\u7684SYN\u6807\u5fd7\u4f4d\u4e5f\u8bbe\u7f6e\u4e3a1\uff0c\u540c\u65f6\u5c06ACK\u6807\u5fd7\u4f4d\u4e5f\u8bbe\u7f6e\u4e3a1\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u7684\u4e0b\u65b9\u663e\u793a\u7684\u6807\u5fd7\u4f4d\u5217\u8868\u4e5f\u53d8\u6210\u4e86\uff0c[TCP Flags: \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7A\u00b7\u00b7S\u00b7]\uff0c\u8868\u793a\u53ea\u6709ACK\u6807\u5fd7\u4f4d\u4e0eSYN\u6807\u5fd7\u4f4d\u4e3a1\uff0c\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u7b2c\u4e09\u6b21\u63e1\u624b\u6211\u5c31\u4e0d\u518d\u622a\u56fe\u4e86\uff0c\u8bf4\u5230\u8fd9\u91cc\uff0c\u5c31\u5df2\u7ecf\u80fd\u591f\u5f15\u51fa\u6211\u4eec\u4eca\u5929\u8981\u8bf4\u7684\u8bdd\u9898\u4e86\uff0c\u5c31\u662f\u201d\u2013tcp-flags\u201d\u9009\u9879\uff0c\u5047\u8bbe\uff0c\u6211\u73b0\u5728\u60f3\u8981\u5339\u914d\u5230\u4e0a\u6587\u4e2d\u63d0\u5230\u7684\u201d\u7b2c\u4e00\u6b21\u63e1\u624b\u201d\u7684\u62a5\u6587\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u201d-m tcp \u2013dport 22\u2033\u7684\u542b\u4e49\u5728\u524d\u6587\u4e2d\u5df2\u7ecf\u603b\u7ed3\u8fc7\uff0c\u8868\u793a\u4f7f\u7528tcp\u6269\u5c55\u6a21\u5757\uff0c\u6307\u5b9a\u76ee\u6807\u7aef\u53e3\u4e3a22\u53f7\u7aef\u53e3(ssh\u9ed8\u8ba4\u7aef\u53e3)\uff0c\u201d\u2013tcp-flags\u201d\u5c31\u662f\u6211\u4eec\u4eca\u5929\u8981\u8ba8\u8bba\u7684\u6269\u5c55\u5339\u914d\u6761\u4ef6\uff0c\u7528\u4e8e\u5339\u914d\u62a5\u6587tcp\u5934\u90e8\u7684\u6807\u5fd7\u4f4d\uff0c\u201dSYN,ACK,FIN,RST,URG,PSH SYN\u201d\u662f\u4ec0\u4e48\u610f\u601d\u5462\uff1f\u8fd9\u4e32\u5b57\u7b26\u5c31\u662f\u7528\u4e8e\u914d\u7f6e\u6211\u4eec\u8981\u5339\u914d\u7684\u6807\u5fd7\u4f4d\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e32\u5b57\u7b26\u62c6\u6210\u4e24\u90e8\u5206\u53bb\u7406\u89e3\uff0c\u7b2c\u4e00\u90e8\u5206\u4e3a\u201dSYN,ACK,FIN,RST,URG,PSH\u201d\uff0c\u7b2c\u4e8c\u90e8\u5206\u4e3a\u201dSYN\u201d\u3002</p> <p>\u7b2c\u4e00\u90e8\u5206\u8868\u793a\uff1a\u6211\u4eec\u9700\u8981\u5339\u914d\u62a5\u6587tcp\u5934\u4e2d\u7684\u54ea\u4e9b\u6807\u5fd7\u4f4d\uff0c\u90a3\u4e48\u4e0a\u4f8b\u7684\u914d\u7f6e\u8868\u793a\uff0c\u6211\u4eec\u9700\u8981\u5339\u914d\u62a5\u6587tcp\u5934\u4e2d\u76846\u4e2a\u6807\u5fd7\u4f4d\uff0c\u8fd96\u4e2a\u6807\u5fd7\u4f4d\u5206\u522b\u4e3a\u4e3a\u201dSYN\u3001ACK\u3001FIN\u3001RST\u3001URG\u3001PSH\u201d\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e00\u90e8\u5206\u7406\u89e3\u6210\u9700\u8981\u5339\u914d\u7684\u6807\u5fd7\u4f4d\u5217\u8868\u3002</p> <p>\u7b2c\u4e8c\u90e8\u5206\u8868\u793a\uff1a\u7b2c\u4e00\u90e8\u5206\u7684\u6807\u5fd7\u4f4d\u5217\u8868\u4e2d\uff0c\u54ea\u4e9b\u6807\u5fd7\u4f4d\u5fc5\u987b\u4e3a1\uff0c\u4e0a\u4f8b\u4e2d\uff0c\u7b2c\u4e8c\u90e8\u5206\u4e3aSYN\uff0c\u5219\u8868\u793a\uff0c\u7b2c\u4e00\u90e8\u5206\u9700\u8981\u5339\u914d\u7684\u6807\u5fd7\u4f4d\u5217\u8868\u4e2d\uff0cSYN\u6807\u5fd7\u4f4d\u7684\u503c\u5fc5\u987b\u4e3a1\uff0c\u5176\u4ed6\u6807\u5fd7\u4f4d\u5fc5\u987b\u4e3a0\u3002</p> <p>\u6240\u4ee5\uff0c\u4e0a\u4f8b\u4e2d\u7684\u201dSYN,ACK,FIN,RST,URG,PSH SYN\u201d\u8868\u793a\uff0c\u9700\u8981\u5339\u914d\u62a5\u6587tcp\u5934\u4e2d\u7684\u201dSYN\u3001ACK\u3001FIN\u3001RST\u3001URG\u3001PSH\u201d\u8fd9\u4e9b\u6807\u5fd7\u4f4d\uff0c\u5176\u4e2dSYN\u6807\u5fd7\u4f4d\u5fc5\u987b\u4e3a1\uff0c\u5176\u4ed6\u76845\u4e2a\u6807\u5fd7\u4f4d\u5fc5\u987b\u4e3a0\uff0c\u8fd9\u4e0e\u4e0a\u6587\u4e2dwireshark\u6293\u5305\u65f6\u7684\u60c5\u51b5\u76f8\u540c\uff0c\u6b63\u662ftcp\u4e09\u6b21\u63e1\u624b\u65f6\u7b2c\u4e00\u6b21\u63e1\u624b\u65f6\u7684\u60c5\u51b5\uff0c\u4e0a\u6587\u4e2d\u7b2c\u4e00\u6b21\u63e1\u624b\u7684\u62a5\u6587\u7684tcp\u5934\u4e2d\u7684\u6807\u5fd7\u4f4d\u5982\u4e0b\uff1a</p> <p></p> <p>\u5176\u5b9e\uff0c\u2013tcp-flags\u7684\u8868\u793a\u65b9\u6cd5\u4e0ewireshark\u7684\u8868\u793a\u65b9\u6cd5\u6709\u5f02\u66f2\u540c\u5de5\u4e4b\u5999\uff0c\u53ea\u4e0d\u8fc7\uff0cwireshark\u4e2d\uff0c\u6807\u5fd7\u4f4d\u4e3a0\u7684\u7528\u201d\u70b9\u201d\u8868\u793a\uff0c\u6807\u5fd7\u4f4d\u4e3a1\u7684\u7528\u5bf9\u5e94\u5b57\u6bcd\u8868\u793a\uff0c\u5728\u2013tcp-flags\u4e2d\uff0c\u9700\u8981\u5148\u6307\u660e\u9700\u8981\u5339\u914d\u54ea\u4e9b\u6807\u5fd7\u4f4d\uff0c\u7136\u540e\u518d\u6307\u660e\u8fd9\u4e9b\u6807\u5fd7\u4f4d\u4e2d\uff0c\u54ea\u4e9b\u5fc5\u987b\u4e3a1\uff0c\u5269\u4f59\u7684\u90fd\u5fc5\u987b\u4e3a0\u3002</p> <p>\u90a3\u4e48\uff0c\u806a\u660e\u5982\u4f60\u4e00\u5b9a\u60f3\u5230\u4e86\uff0c\u5982\u679c\u6211\u60f3\u8981\u5339\u914dtcp\u5934\u4e2d\u7684\u7b2c\u4e8c\u6b21\u63e1\u624b\u65f6\u7684\u6807\u5fd7\u4f4d\u7684\u60c5\u51b5\uff0c\u8be5\u600e\u4e48\u8868\u793a\u5462\uff1f</p> <p>\u793a\u4f8b\u5982\u4e0b\uff08\u6b64\u5904\u7701\u7565\u5bf9\u6e90\u5730\u5740\u4e0e\u76ee\u6807\u5730\u5740\u7684\u5339\u914d\uff0c\u91cd\u70b9\u5728\u4e8e\u5bf9tcp-flags\u7684\u793a\u4f8b\uff09</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u7b2c\u4e00\u6761\u547d\u4ee4\u5339\u914d\u5230\u7684\u62a5\u6587\u662f\u7b2c\u4e00\u6b21\u63e1\u624b\u7684\u62a5\u6587\uff0c\u7b2c\u4e8c\u6761\u547d\u4ee4\u5339\u914d\u5230\u7684\u62a5\u6587\u662f\u7b2c\u4e8c\u6b21\u63e1\u624b\u7684\u62a5\u6587\u3002</p> <p>\u7efc\u4e0a\u6240\u8ff0\uff0c\u53ea\u8981\u6211\u4eec\u80fd\u591f\u7075\u6d3b\u7684\u914d\u7f6e\u4e0a\u4f8b\u4e2d\u7684\u6807\u5fd7\u4f4d\uff0c\u5373\u53ef\u5339\u914d\u5230\u66f4\u591a\u7684\u5e94\u7528\u573a\u666f\u4e2d\u3002</p> <p>\u5176\u5b9e\uff0c\u4e0a\u4f8b\u4e2d\u7684\u4e24\u6761\u547d\u4ee4\u8fd8\u53ef\u4ee5\u7b80\u5199\u4e3a\u5982\u4e0b\u6a21\u6837</p> <p></p> <p>\u6ca1\u9519\uff0c\u6211\u4eec\u53ef\u4ee5\u7528ALL\u8868\u793a\u201dSYN,ACK,FIN,RST,URG,PSH\u201d\u3002</p> <p>\u5176\u5b9e\uff0ctcp\u6269\u5c55\u6a21\u5757\u8fd8\u4e3a\u6211\u4eec\u4e13\u95e8\u63d0\u4f9b\u4e86\u4e00\u4e2a\u9009\u9879\uff0c\u53ef\u4ee5\u5339\u914d\u4e0a\u6587\u4e2d\u63d0\u5230\u7684\u201d\u7b2c\u4e00\u6b21\u63e1\u624b\u201d\uff0c\u90a3\u5c31\u662f\u2013syn\u9009\u9879</p> <p>\u4f7f\u7528\u201d\u2013syn\u201d\u9009\u9879\u76f8\u5f53\u4e8e\u4f7f\u7528\u201d\u2013tcp-flags SYN,RST,ACK,FIN \u00a0SYN\u201d\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ef\u4ee5\u4f7f\u7528\u201d\u2013syn\u201d\u9009\u9879\u53bb\u5339\u914dtcp\u65b0\u5efa\u8fde\u63a5\u7684\u8bf7\u6c42\u62a5\u6587\u3002</p> <p>\u793a\u4f8b\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"iptables_6/#_1","title":"\u5c0f\u7ed3","text":"<p>\u7ed3\u5408\u4e4b\u524d\u7684\u6587\u7ae0\uff0c\u6211\u4eec\u628atcp\u6a21\u5757\u7684\u5e38\u7528\u6269\u5c55\u5339\u914d\u6761\u4ef6\u518d\u603b\u7ed3\u4e00\u904d\uff0c\u65b9\u4fbf\u4ee5\u540e\u56de\u987e\u3002</p> <p>tcp\u6269\u5c55\u6a21\u5757\u5e38\u7528\u7684\u6269\u5c55\u5339\u914d\u6761\u4ef6\u5982\u4e0b\uff1a</p>"},{"location":"iptables_6/#sport","title":"\u2013sport","text":"<p>\u7528\u4e8e\u5339\u914dtcp\u534f\u8bae\u62a5\u6587\u7684\u6e90\u7aef\u53e3\uff0c\u53ef\u4ee5\u4f7f\u7528\u5192\u53f7\u6307\u5b9a\u4e00\u4e2a\u8fde\u7eed\u7684\u7aef\u53e3\u8303\u56f4</p> <pre><code>#\u793a\u4f8b\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-d\u00a0192.168.1.146\u00a0-p\u00a0tcp\u00a0-m\u00a0tcp\u00a0--sport\u00a022\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-d\u00a0192.168.1.146\u00a0-p\u00a0tcp\u00a0-m\u00a0tcp\u00a0--sport\u00a022:25\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-d\u00a0192.168.1.146\u00a0-p\u00a0tcp\u00a0-m\u00a0tcp\u00a0!\u00a0--sport\u00a022\u00a0-j\u00a0ACCEPT\n</code></pre>"},{"location":"iptables_6/#dport","title":"\u2013dport","text":"<p>\u7528\u4e8e\u5339\u914dtcp\u534f\u8bae\u62a5\u6587\u7684\u76ee\u6807\u7aef\u53e3\uff0c\u53ef\u4ee5\u4f7f\u7528\u5192\u53f7\u6307\u5b9a\u4e00\u4e2a\u8fde\u7eed\u7684\u7aef\u53e3\u8303\u56f4</p> <pre><code>#\u793a\u4f8b\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-s\u00a0192.168.1.146\u00a0-p\u00a0tcp\u00a0-m\u00a0tcp\u00a0--dport\u00a022:25\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-s\u00a0192.168.1.146\u00a0-p\u00a0tcp\u00a0-m\u00a0tcp\u00a0--dport\u00a0:22\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-s\u00a0192.168.1.146\u00a0-p\u00a0tcp\u00a0-m\u00a0tcp\u00a0--dport\u00a080:\u00a0-j\u00a0REJECT\n</code></pre>"},{"location":"iptables_6/#tcp-flags","title":"\u2013tcp-flags","text":"<p>\u7528\u4e8e\u5339\u914d\u62a5\u6587\u7684tcp\u5934\u7684\u6807\u5fd7\u4f4d</p> <pre><code>#\u793a\u4f8b\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-p\u00a0tcp\u00a0-m\u00a0tcp\u00a0--dport\u00a022\u00a0--tcp-flags\u00a0SYN,ACK,FIN,RST,URG,PSH\u00a0SYN\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-p\u00a0tcp\u00a0-m\u00a0tcp\u00a0--sport\u00a022\u00a0--tcp-flags\u00a0SYN,ACK,FIN,RST,URG,PSH\u00a0SYN,ACK\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-p\u00a0tcp\u00a0-m\u00a0tcp\u00a0--dport\u00a022\u00a0--tcp-flags\u00a0ALL\u00a0SYN\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-p\u00a0tcp\u00a0-m\u00a0tcp\u00a0--sport\u00a022\u00a0--tcp-flags\u00a0ALL\u00a0SYN,ACK\u00a0-j\u00a0REJECT\n</code></pre>"},{"location":"iptables_6/#syn","title":"\u2013syn","text":"<p>\u7528\u4e8e\u5339\u914dtcp\u65b0\u5efa\u8fde\u63a5\u7684\u8bf7\u6c42\u62a5\u6587\uff0c\u76f8\u5f53\u4e8e\u4f7f\u7528\u201d\u2013tcp-flags SYN,RST,ACK,FIN \u00a0SYN\u201d</p> <pre><code>#\u793a\u4f8b\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-p\u00a0tcp\u00a0-m\u00a0tcp\u00a0--dport\u00a022\u00a0--syn\u00a0-j\u00a0REJECT\n</code></pre> <p>\u5e0c\u671b\u8fd9\u7bc7\u6587\u7ae0\u80fd\u591f\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9~~~\u5e38\u6765\u6367\u573a\u54e6\uff0c\u4eb2~~~</p>"},{"location":"iptables_7/","title":"iptables\u8be6\u89e3\uff087\uff09\uff1aiptables\u6269\u5c55\u4e4budp\u6269\u5c55\u4e0eicmp\u6269\u5c55","text":"<p>\u5728\u672c\u535a\u5ba2\u4e2d\uff0c\u4ece\u7406\u8bba\u5230\u5b9e\u8df5\uff0c\u7cfb\u7edf\u7684\u4ecb\u7ecd\u4e86iptables\uff0c\u5982\u679c\u4f60\u60f3\u8981\u4ece\u5934\u5f00\u59cb\u4e86\u89e3iptables\uff0c\u53ef\u4ee5\u67e5\u770biptables\u6587\u7ae0\u5217\u8868\uff0c\u76f4\u8fbe\u94fe\u63a5\u5982\u4e0b</p> <p>iptables\u96f6\u57fa\u7840\u5feb\u901f\u5165\u95e8\u7cfb\u5217</p> <p>\u524d\u6587\u4e2d\u603b\u7ed3\u4e86iptables\u7684tcp\u6269\u5c55\u6a21\u5757\uff0c\u6b64\u5904\uff0c\u6211\u4eec\u6765\u603b\u7ed3\u4e00\u4e0b\u53e6\u5916\u4e24\u4e2a\u8ddf\u534f\u8bae\u6709\u5173\u7684\u5e38\u7528\u7684\u6269\u5c55\u6a21\u5757\uff0cudp\u6269\u5c55\u4e0eicmp\u6269\u5c55\u3002</p>"},{"location":"iptables_7/#udp","title":"udp\u6269\u5c55","text":"<p>\u6211\u4eec\u5148\u6765\u8bf4\u8bf4udp\u6269\u5c55\u6a21\u5757\uff0c\u8fd9\u4e2a\u6269\u5c55\u6a21\u5757\u4e2d\u80fd\u7528\u7684\u5339\u914d\u6761\u4ef6\u6bd4\u8f83\u5c11\uff0c\u53ea\u6709\u4e24\u4e2a\uff0c\u5c31\u662f\u2013sport\u4e0e\u2013dport\uff0c\u5373\u5339\u914d\u62a5\u6587\u7684\u6e90\u7aef\u53e3\u4e0e\u76ee\u6807\u7aef\u53e3\u3002</p> <p>\u6ca1\u9519\uff0ctcp\u6a21\u5757\u4e2d\u4e5f\u6709\u8fd9\u4e24\u4e2a\u9009\u9879\uff0c\u540d\u79f0\u90fd\u4e00\u6a21\u4e00\u6837\u3002</p> <p>\u53ea\u4e0d\u8fc7udp\u6269\u5c55\u6a21\u5757\u7684\u2013sport\u4e0e\u2013dport\u662f\u7528\u4e8e\u5339\u914dUDP\u534f\u8bae\u62a5\u6587\u7684\u6e90\u7aef\u53e3\u4e0e\u76ee\u6807\u7aef\u53e3\uff0c\u6bd4\u5982\uff0c\u653e\u884csamba\u670d\u52a1\u7684137\u4e0e138\u8fd9\u4e24\u4e2aUDP\u7aef\u53e3\uff0c\u793a\u4f8b\u5982\u4e0b</p> <p></p> <p>\u524d\u6587\u8bf4\u660e\u8fc7\uff0c\u5f53\u4f7f\u7528\u6269\u5c55\u5339\u914d\u6761\u4ef6\u65f6\uff0c\u5982\u679c\u672a\u6307\u5b9a\u6269\u5c55\u6a21\u5757\uff0ciptables\u4f1a\u9ed8\u8ba4\u8c03\u7528\u4e0e\u201d-p\u201d\u5bf9\u5e94\u7684\u534f\u8bae\u540d\u79f0\u76f8\u540c\u7684\u6a21\u5757\uff0c\u6240\u4ee5\uff0c\u5f53\u4f7f\u7528\u201d-p udp\u201d\u65f6\uff0c\u53ef\u4ee5\u7701\u7565\u201d-m udp\u201d\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>udp\u6269\u5c55\u4e2d\u7684\u2013sport\u4e0e\u2013dport\u540c\u6837\u652f\u6301\u6307\u5b9a\u4e00\u4e2a\u8fde\u7eed\u7684\u7aef\u53e3\u8303\u56f4\uff0c\u793a\u4f8b\u5982\u4e0b</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u7684\u914d\u7f6e\u8868\u793a137\u5230157\u4e4b\u95f4\u7684\u6240\u6709udp\u7aef\u53e3\u5168\u90e8\u5bf9\u5916\u5f00\u653e\uff0c\u5176\u5b9e\u4e0etcp\u6269\u5c55\u4e2d\u7684\u4f7f\u7528\u65b9\u6cd5\u76f8\u540c\u3002</p> <p>\u4f46\u662fudp\u4e2d\u7684\u2013sport\u4e0e\u2013dport\u4e5f\u53ea\u80fd\u6307\u5b9a\u8fde\u7eed\u7684\u7aef\u53e3\u8303\u56f4\uff0c\u5e76\u4e0d\u80fd\u4e00\u6b21\u6027\u6307\u5b9a\u591a\u4e2a\u79bb\u6563\u7684\u7aef\u53e3\uff0c\u6ca1\u9519\uff0c\u806a\u660e\u5982\u4f60\u4e00\u5b9a\u60f3\u5230\uff0c\u4f7f\u7528\u4e4b\u524d\u603b\u7ed3\u8fc7\u7684multiport\u6269\u5c55\u6a21\u5757\uff0c\u5373\u53ef\u6307\u5b9a\u591a\u4e2a\u79bb\u6563\u7684UDP\u7aef\u53e3\uff0c\u5982\u679c\u4f60\u5fd8\u4e86multiport\u6a21\u5757\u600e\u6837\u4f7f\u7528\uff0c\u8bf7\u56de\u987e\u524d\u6587\u3002</p> <p>\u603b\u4e4b\u6709\u4e86\u524d\u6587\u7684\u57fa\u7840\uff0c\u518d\u7406\u89e3\u4e0a\u8ff0\u793a\u4f8b\u5c31\u5bb9\u6613\u591a\u4e86\uff0c\u6b64\u5904\u4e0d\u518d\u5bf9udp\u6a21\u5757\u7684\u2013sport\u4e0e\u2013dport\u8fdb\u884c\u8d58\u8ff0\u3002</p>"},{"location":"iptables_7/#icmp","title":"icmp\u6269\u5c55","text":"<p>\u6700\u5e38\u7528\u7684tcp\u6269\u5c55\u3001udp\u6269\u5c55\u5df2\u7ecf\u603b\u7ed3\u5b8c\u6bd5\uff0c\u73b0\u5728\u804a\u804aicmp\u6269\u5c55\uff0c\u6ca1\u9519\uff0c\u770b\u5230icmp\uff0c\u4f60\u80af\u5b9a\u5c31\u60f3\u5230\u4e86ping\u547d\u4ee4\uff0c\u56e0\u4e3aping\u547d\u4ee4\u4f7f\u7528\u7684\u5c31\u662ficmp\u534f\u8bae\u3002</p> <p>ICMP\u534f\u8bae\u7684\u5168\u79f0\u4e3aInternet Control Message Protocol\uff0c\u7ffb\u8bd1\u4e3a\u4e92\u8054\u7f51\u63a7\u5236\u62a5\u6587\u534f\u8bae\uff0c\u5b83\u4e3b\u8981\u7528\u4e8e\u63a2\u6d4b\u7f51\u7edc\u4e0a\u7684\u4e3b\u673a\u662f\u5426\u53ef\u7528\uff0c\u76ee\u6807\u662f\u5426\u53ef\u8fbe\uff0c\u7f51\u7edc\u662f\u5426\u901a\u7545\uff0c\u8def\u7531\u662f\u5426\u53ef\u7528\u7b49\u3002</p> <p>\u6211\u4eec\u5e73\u5e38\u4f7f\u7528ping\u547d\u4ee4ping\u67d0\u4e3b\u673a\u65f6\uff0c\u5982\u679c\u4e3b\u673a\u53ef\u8fbe\uff0c\u5bf9\u5e94\u4e3b\u673a\u4f1a\u5bf9\u6211\u4eec\u7684ping\u8bf7\u6c42\u505a\u51fa\u56de\u5e94\uff08\u6b64\u5904\u4e0d\u8003\u8651\u7981ping\u7b49\u60c5\u51b5\uff09\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u53d1\u51faping\u8bf7\u6c42\uff0c\u5bf9\u65b9\u56de\u5e94ping\u8bf7\u6c42\uff0c\u867d\u7136ping\u8bf7\u6c42\u62a5\u6587\u4e0eping\u56de\u5e94\u62a5\u6587\u90fd\u5c5e\u4e8eICMP\u7c7b\u578b\u7684\u62a5\u6587\uff0c\u4f46\u662f\u5982\u679c\u5728\u6982\u5ff5\u4e0a\u7ec6\u5206\u7684\u8bdd\uff0c\u5b83\u4eec\u6240\u5c5e\u7684\u7c7b\u578b\u8fd8\u662f\u4e0d\u540c\u7684\uff0c\u6211\u4eec\u53d1\u51fa\u7684ping\u8bf7\u6c42\u5c5e\u4e8e\u7c7b\u578b8\u7684icmp\u62a5\u6587\uff0c\u800c\u5bf9\u65b9\u4e3b\u673a\u7684ping\u56de\u5e94\u62a5\u6587\u5219\u5c5e\u4e8e\u7c7b\u578b0\u7684icmp\u62a5\u6587\uff0c\u6839\u636e\u5e94\u7528\u573a\u666f\u7684\u4e0d\u540c\uff0cicmp\u62a5\u6587\u88ab\u7ec6\u5206\u4e3a\u5982\u4e0b\u5404\u79cd\u7c7b\u578b\u3002</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u6240\u6709\u8868\u793a\u201d\u76ee\u6807\u4e0d\u53ef\u8fbe\u201d\u7684icmp\u62a5\u6587\u7684type\u7801\u4e3a3\uff0c\u800c\u201d\u76ee\u6807\u4e0d\u53ef\u8fbe\u201d\u53c8\u53ef\u4ee5\u7ec6\u5206\u4e3a\u591a\u79cd\u60c5\u51b5\uff0c\u662f\u7f51\u7edc\u4e0d\u53ef\u8fbe\u5462\uff1f\u8fd8\u662f\u4e3b\u673a\u4e0d\u53ef\u8fbe\u5462\uff1f\u518d\u6216\u8005\u662f\u7aef\u53e3\u4e0d\u53ef\u8fbe\u5462\uff1f\u6240\u4ee5\uff0c\u4e3a\u4e86\u66f4\u52a0\u7ec6\u5316\u7684\u533a\u5206\u5b83\u4eec\uff0cicmp\u5bf9\u6bcf\u79cdtype\u53c8\u7ec6\u5206\u4e86\u5bf9\u5e94\u7684code\uff0c\u7528\u4e0d\u540c\u7684code\u5bf9\u5e94\u5177\u4f53\u7684\u573a\u666f\uff0c \u00a0\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528type/code\u53bb\u5339\u914d\u5177\u4f53\u7c7b\u578b\u7684ICMP\u62a5\u6587\uff0c\u6bd4\u5982\u53ef\u4ee5\u4f7f\u7528\u201d3/1\u2033\u8868\u793a\u4e3b\u673a\u4e0d\u53ef\u8fbe\u7684icmp\u62a5\u6587\u3002</p> <p>\u4e0a\u56fe\u4e2d\u7684\u7b2c\u4e00\u884c\u5c31\u8868\u793aping\u56de\u5e94\u62a5\u6587\uff0c\u5b83\u7684type\u4e3a0\uff0ccode\u4e5f\u4e3a0\uff0c\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff0cping\u56de\u5e94\u62a5\u6587\u5c5e\u4e8e\u67e5\u8be2\u7c7b\uff08query\uff09\u7684ICMP\u62a5\u6587\uff0c\u4ece\u5927\u7c7b\u4e0a\u5206\uff0cICMP\u62a5\u6587\u8fd8\u80fd\u5206\u4e3a\u67e5\u8be2\u7c7b\u4e0e\u9519\u8bef\u7c7b\u4e24\u5927\u7c7b\uff0c\u76ee\u6807\u4e0d\u53ef\u8fbe\u7c7b\u7684icmp\u62a5\u6587\u5219\u5c5e\u4e8e\u9519\u8bef\u7c7b\u62a5\u6587\u3002</p> <p>\u800c\u6211\u4eec\u53d1\u51fa\u7684ping\u8bf7\u6c42\u62a5\u6587\u5bf9\u5e94\u7684type\u4e3a8\uff0ccode\u4e3a0\u3002</p> <p>\u4e86\u89e3\u5b8c\u4e0a\u8ff0\u6982\u5ff5\uff0c\u5c31\u597d\u529e\u4e86\uff0c\u6211\u4eec\u6765\u770b\u4e00\u4e9b\u5e94\u7528\u573a\u666f\u3002</p> <p>\u5047\u8bbe\uff0c\u6211\u4eec\u73b0\u5728\u60f3\u8981\u7981\u6b62\u6240\u6709icmp\u7c7b\u578b\u7684\u62a5\u6587\u8fdb\u5165\u672c\u673a\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u8fdb\u884c\u5982\u4e0b\u8bbe\u7f6e\u3002</p> <p></p> <p>\u4e0a\u4f8b\u4e2d\uff0c\u6211\u4eec\u5e76\u6ca1\u6709\u4f7f\u7528\u4efb\u4f55\u6269\u5c55\u5339\u914d\u6761\u4ef6\uff0c\u6211\u4eec\u53ea\u662f\u4f7f\u7528\u201d-p icmp\u201d\u5339\u914d\u4e86\u6240\u6709icmp\u534f\u8bae\u7c7b\u578b\u7684\u62a5\u6587\u3002</p> <p>\u5982\u679c\u8fdb\u884c\u4e86\u4e0a\u8ff0\u8bbe\u7f6e\uff0c\u522b\u7684\u4e3b\u673a\u5411\u6211\u4eec\u53d1\u9001\u7684ping\u8bf7\u6c42\u62a5\u6587\u65e0\u6cd5\u8fdb\u5165\u9632\u706b\u5899\uff0c\u6211\u4eec\u5411\u522b\u4eba\u53d1\u9001\u7684ping\u8bf7\u6c42\u5bf9\u5e94\u7684\u56de\u5e94\u62a5\u6587\u4e5f\u65e0\u6cd5\u8fdb\u5165\u9632\u706b\u5899\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u65e2\u65e0\u6cd5ping\u901a\u522b\u4eba\uff0c\u522b\u4eba\u4e5f\u65e0\u6cd5ping\u901a\u6211\u4eec\u3002</p> <p>\u5047\u8bbe\uff0c\u6b64\u523b\u9700\u6c42\u6709\u53d8\uff0c\u6211\u4eec\u53ea\u60f3\u8981ping\u901a\u522b\u4eba\uff0c\u4f46\u662f\u4e0d\u60f3\u8ba9\u522b\u4ebaping\u901a\u6211\u4eec\uff0c\u521a\u624d\u7684\u914d\u7f6e\u5c31\u4e0d\u80fd\u6ee1\u8db3\u6211\u4eec\u4e86\uff0c\u6211\u4eec\u5219\u53ef\u4ee5\u8fdb\u884c\u5982\u4e0b\u8bbe\u7f6e\uff08\u6b64\u5904\u4e0d\u8003\u8651\u7981ping\u7684\u60c5\u51b5\uff09</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u4f7f\u7528\u201d-m icmp\u201d\u8868\u793a\u4f7f\u7528icmp\u6269\u5c55\uff0c\u56e0\u4e3a\u4e0a\u4f8b\u4e2d\u4f7f\u7528\u4e86\u201d-p icmp\u201d\uff0c\u6240\u4ee5\u201d-m icmp\u201d\u53ef\u4ee5\u7701\u7565\uff0c\u4f7f\u7528\u201d\u2013icmp-type\u201d\u9009\u9879\u8868\u793a\u6839\u636e\u5177\u4f53\u7684type\u4e0ecode\u53bb\u5339\u914d\u5bf9\u5e94\u7684icmp\u62a5\u6587\uff0c\u800c\u4e0a\u56fe\u4e2d\u7684\u201d\u2013icmp-type 8/0\u2033\u8868\u793aicmp\u62a5\u6587\u7684type\u4e3a8\uff0ccode\u4e3a0\u624d\u4f1a\u88ab\u5339\u914d\u5230\uff0c\u4e5f\u5c31\u662f\u53ea\u6709ping\u8bf7\u6c42\u7c7b\u578b\u7684\u62a5\u6587\u624d\u80fd\u88ab\u5339\u914d\u5230\uff0c\u6240\u4ee5\uff0c\u522b\u4eba\u5bf9\u6211\u4eec\u53d1\u8d77\u7684ping\u8bf7\u6c42\u5c06\u4f1a\u88ab\u62d2\u7edd\u901a\u8fc7\u9632\u706b\u5899\uff0c\u800c\u6211\u4eec\u4e4b\u6240\u4ee5\u80fd\u591fping\u901a\u522b\u4eba\uff0c\u662f\u56e0\u4e3a\u522b\u4eba\u56de\u5e94\u6211\u4eec\u7684\u62a5\u6587\u7684icmp type\u4e3a0\uff0ccode\u4e5f\u4e3a0\uff0c\u6240\u4ee5\u65e0\u6cd5\u88ab\u4e0a\u8ff0\u89c4\u5219\u5339\u914d\u5230\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u522b\u4eba\u56de\u5e94\u6211\u4eec\u7684\u4fe1\u606f\u3002</p> <p>\u56e0\u4e3atype\u4e3a8\u7684\u7c7b\u578b\u4e0b\u53ea\u6709\u4e00\u4e2acode\u4e3a0\u7684\u7c7b\u578b\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7701\u7565\u5bf9\u5e94\u7684code\uff0c\u793a\u4f8b\u5982\u4e0b</p> <p></p> <p>\u9664\u4e86\u80fd\u591f\u4f7f\u7528\u5bf9\u5e94type/code\u5339\u914d\u5230\u5177\u4f53\u7c7b\u578b\u7684icmp\u62a5\u6587\u4ee5\u5916\uff0c\u6211\u4eec\u8fd8\u80fd\u7528icmp\u62a5\u6587\u7684\u63cf\u8ff0\u540d\u79f0\u53bb\u5339\u914d\u5bf9\u5e94\u7c7b\u578b\u7684\u62a5\u6587\uff0c\u793a\u4f8b\u5982\u4e0b</p> <p></p> <p>\u6ca1\u9519\uff0c\u4e0a\u4f8b\u4e2d\u4f7f\u7528\u7684 \u2013icmp-type \u201cecho-request\u201d\u4e0e \u2013icmp-type 8/0\u7684\u6548\u679c\u5b8c\u5168\u76f8\u540c\uff0c\u53c2\u8003\u672c\u6587\u6700\u4e0a\u65b9\u7684\u8868\u683c\u5373\u53ef\u83b7\u53d6\u5bf9\u5e94\u7684icmp\u7c7b\u578b\u7684\u63cf\u8ff0\u540d\u79f0\u3002</p> <p></p> <p>\u6ce8\u610f\uff1a\u540d\u79f0\u4e2d\u7684\u201d\u7a7a\u683c\u201d\u9700\u8981\u66ff\u6362\u4e3a\u201d-\u201c\u3002</p>"},{"location":"iptables_7/#_1","title":"\u5c0f\u7ed3","text":""},{"location":"iptables_7/#udp_1","title":"udp\u6269\u5c55","text":"<p>\u5e38\u7528\u7684\u6269\u5c55\u5339\u914d\u6761\u4ef6</p> <p>\u2013sport\uff1a\u5339\u914dudp\u62a5\u6587\u7684\u6e90\u5730\u5740</p> <p>\u2013dport\uff1a\u5339\u914dudp\u62a5\u6587\u7684\u76ee\u6807\u5730\u5740</p> <pre><code>#\u793a\u4f8b\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-p\u00a0udp\u00a0-m\u00a0udp\u00a0--dport\u00a0137\u00a0-j\u00a0ACCEPT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-p\u00a0udp\u00a0-m\u00a0udp\u00a0--dport\u00a0137:157\u00a0-j\u00a0ACCEPT\n#\u53ef\u4ee5\u7ed3\u5408multiport\u6a21\u5757\u6307\u5b9a\u591a\u4e2a\u79bb\u6563\u7684\u7aef\u53e3\n</code></pre>"},{"location":"iptables_7/#icmp_1","title":"icmp\u6269\u5c55","text":"<p>\u5e38\u7528\u7684\u6269\u5c55\u5339\u914d\u6761\u4ef6</p> <p>\u2013icmp-type\uff1a\u5339\u914dicmp\u62a5\u6587\u7684\u5177\u4f53\u7c7b\u578b</p> <pre><code>#\u793a\u4f8b\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-p\u00a0icmp\u00a0-m\u00a0icmp\u00a0--icmp-type\u00a08/0\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-p\u00a0icmp\u00a0--icmp-type\u00a08\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-p\u00a0icmp\u00a0-m\u00a0icmp\u00a0--icmp-type\u00a00/0\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0OUTPUT\u00a0-p\u00a0icmp\u00a0--icmp-type\u00a00\u00a0-j\u00a0REJECT\niptables\u00a0-t\u00a0filter\u00a0-I\u00a0INPUT\u00a0-p\u00a0icmp\u00a0--icmp-type\u00a0\"echo-request\"\u00a0-j\u00a0REJECT\n</code></pre>"},{"location":"iptables_8/","title":"iptables\u8be6\u89e3\uff088\uff09\uff1aiptables\u6269\u5c55\u6a21\u5757\u4e4bstate\u6269\u5c55","text":"<p>\u5728\u672c\u535a\u5ba2\u4e2d\uff0c\u4ece\u7406\u8bba\u5230\u5b9e\u8df5\uff0c\u7cfb\u7edf\u7684\u4ecb\u7ecd\u4e86iptables\uff0c\u5982\u679c\u4f60\u60f3\u8981\u4ece\u5934\u5f00\u59cb\u4e86\u89e3iptables\uff0c\u53ef\u4ee5\u67e5\u770biptables\u6587\u7ae0\u5217\u8868\uff0c\u76f4\u8fbe\u94fe\u63a5\u5982\u4e0b</p> <p>iptables\u96f6\u57fa\u7840\u5feb\u901f\u5165\u95e8\u7cfb\u5217</p> <p>\u5f53\u6211\u4eec\u901a\u8fc7http\u7684url\u8bbf\u95ee\u67d0\u4e2a\u7f51\u7ad9\u7684\u7f51\u9875\u65f6\uff0c\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u768480\u7aef\u53e3\u53d1\u8d77\u8bf7\u6c42\uff0c\u670d\u52a1\u7aef\u518d\u901a\u8fc780\u7aef\u53e3\u54cd\u5e94\u6211\u4eec\u7684\u8bf7\u6c42\uff0c\u4e8e\u662f\uff0c\u4f5c\u4e3a\u5ba2\u6237\u7aef\uff0c\u6211\u4eec\u4f3c\u4e4e\u5e94\u8be5\u7406\u6240\u5e94\u5f53\u7684\u653e\u884c80\u7aef\u53e3\uff0c\u4ee5\u4fbf\u670d\u52a1\u7aef\u56de\u5e94\u6211\u4eec\u7684\u62a5\u6587\u53ef\u4ee5\u8fdb\u5165\u5ba2\u6237\u7aef\u4e3b\u673a\uff0c\u4e8e\u662f\uff0c\u6211\u4eec\u5728\u5ba2\u6237\u7aef\u653e\u884c\u4e8680\u7aef\u53e3\uff0c\u540c\u7406\uff0c\u5f53\u6211\u4eec\u901a\u8fc7ssh\u5de5\u5177\u8fdc\u7a0b\u8fde\u63a5\u5230\u67d0\u53f0\u670d\u52a1\u5668\u65f6\uff0c\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u768422\u53f7\u7aef\u53e3\u53d1\u8d77\u8bf7\u6c42\uff0c\u670d\u52a1\u7aef\u518d\u901a\u8fc722\u53f7\u7aef\u53e3\u54cd\u5e94\u6211\u4eec\u7684\u8bf7\u6c42\uff0c\u4e8e\u662f\u6211\u4eec\u7406\u6240\u5e94\u5f53\u7684\u653e\u884c\u4e86\u6240\u670922\u53f7\u7aef\u53e3\uff0c\u4ee5\u4fbf\u8fdc\u7a0b\u4e3b\u673a\u7684\u54cd\u5e94\u8bf7\u6c42\u80fd\u591f\u901a\u8fc7\u9632\u706b\u5899\uff0c\u4f46\u662f\uff0c\u4f5c\u4e3a\u5ba2\u6237\u7aef\uff0c\u5982\u679c\u6211\u4eec\u5e76\u6ca1\u6709\u4e3b\u52a8\u541180\u7aef\u53e3\u53d1\u8d77\u8bf7\u6c42\uff0c\u4e5f\u6ca1\u6709\u4e3b\u52a8\u541122\u53f7\u7aef\u53e3\u53d1\u8d77\u8bf7\u6c42\uff0c\u90a3\u4e48\u5176\u4ed6\u4e3b\u673a\u901a\u8fc780\u7aef\u53e3\u6216\u800522\u53f7\u7aef\u53e3\u5411\u6211\u4eec\u53d1\u9001\u6570\u636e\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u63a5\u6536\u5230\u5417\uff1f\u5e94\u8be5\u662f\u53ef\u4ee5\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u4e3a\u4e86\u6536\u5230http\u4e0essh\u7684\u54cd\u5e94\u62a5\u6587\uff0c\u5df2\u7ecf\u653e\u884c\u4e8680\u7aef\u53e3\u4e0e22\u53f7\u7aef\u53e3\uff0c\u6240\u4ee5\uff0c\u4e0d\u7ba1\u662f\u201d\u54cd\u5e94\u201d\u6211\u4eec\u7684\u62a5\u6587\uff0c\u8fd8\u662f\u201d\u4e3b\u52a8\u53d1\u9001\u201d\u7ed9\u6211\u4eec\u7684\u62a5\u6587\uff0c\u5e94\u8be5\u90fd\u662f\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e24\u4e2a\u7aef\u53e3\u7684\uff0c\u90a3\u4e48\u4ed4\u7ec6\u60f3\u60f3\uff0c\u8fd9\u6837\u662f\u4e0d\u662f\u4e0d\u592a\u5b89\u5168\u5462\uff1f\u5982\u679c\u67d0\u4e9b\u4e0e\u4f60\u654c\u5bf9\u7684\u4eba\uff0c\u5229\u7528\u8fd9\u4e9b\u7aef\u53e3\u201d\u4e3b\u52a8\u201d\u8fde\u63a5\u5230\u4f60\u7684\u4e3b\u673a\uff0c\u4f60\u80af\u5b9a\u4f1a\u4e0d\u723d\u7684\u5427\uff0c\u4e00\u822c\u90fd\u662f\u6211\u4eec\u4e3b\u52a8\u8bf7\u6c4280\u7aef\u53e3\uff0c80\u7aef\u53e3\u56de\u5e94\u6211\u4eec\uff0c\u4f46\u662f\u4e00\u822c\u4e0d\u4f1a\u51fa\u73b080\u7aef\u53e3\u4e3b\u52a8\u8bf7\u6c42\u6211\u4eec\u7684\u60c5\u51b5\u5427\u3002</p> <p>\u4f60\u5fc3\u91cc\u53ef\u80fd\u4f1a\u8fd9\u6837\u60f3\uff1a\u6211\u77e5\u9053\u54ea\u4e9b\u4e3b\u673a\u662f\u5b89\u5168\u7684\uff0c\u6211\u53ea\u8981\u9488\u5bf9\u8fd9\u4e9b\u5b89\u5168\u7684\u4e3b\u673a\u653e\u884c\u5bf9\u5e94\u7684\u7aef\u53e3\u5c31\u884c\u4e86\uff0c\u5176\u4ed6IP\u4e00\u5f8b\u62d2\u7edd\uff0c\u6bd4\u5982\uff0c\u6211\u77e5\u9053IP\u4e3a123\u7684\u4e3b\u673a\u662f\u5b89\u5168\u7684\uff0c\u6240\u4ee5\uff0c\u6211\u5bf9123\u4e3b\u673a\u5f00\u653e\u4e8622\u53f7\u7aef\u53e3\uff0c\u4ee5\u4fbf123\u4e3b\u673a\u80fd\u591f\u901a\u8fc722\u53f7\u7aef\u53e3\u54cd\u5e94\u6211\u4eec\u7684ssh\u8bf7\u6c42\uff0c\u90a3\u4e48\uff0c\u5982\u679c\u4f60\u9700\u8981\u7ba1\u7406\u7684\u4e3b\u673a\u8d8a\u6765\u8d8a\u591a\u5462\uff1f\u4f60\u662f\u4e0d\u662f\u6bcf\u6b21\u90fd\u8981\u4e3a\u65b0\u7684\u4e3b\u673a\u914d\u7f6e\u8fd9\u4e9b\u89c4\u5219\u5462\uff1f\u5982\u679c\u670930\u53f0\u4e3b\u673a\u5462\uff1f\u5982\u679c\u6709300\u53f0\u4e3b\u673a\u5462\uff1f80\u7aef\u53e3\u5c31\u66f4\u522b\u63d0\u4e86\uff0c\u96be\u9053\u4f60\u6bcf\u6b21\u8bbf\u95ee\u4e00\u4e2a\u65b0\u7684\u7f51\u5740\uff0c\u90fd\u8981\u5bf9\u8fd9\u4e2a\u7f51\u5740\u6dfb\u52a0\u4fe1\u4efb\u5417\uff1f\u8fd9\u663e\u7136\u4e0d\u592a\u5408\u7406\u3002</p> <p>\u4f60\u5fc3\u91cc\u53ef\u80fd\u53c8\u4f1a\u60f3\uff1a\u9488\u5bf9\u5bf9\u5e94\u7684\u7aef\u53e3\uff0c\u6211\u7528\u2013tcp-flags\u53bb\u5339\u914dtcp\u62a5\u6587\u7684\u6807\u5fd7\u4f4d\uff0c\u628a\u5916\u6765\u7684\u201d\u7b2c\u4e00\u6b21\u63e1\u624b\u201d\u7684\u8bf7\u6c42\u62d2\u7edd\uff0c\u662f\u4e0d\u662f\u4e5f\u53ef\u4ee5\u5462\uff1f\u90a3\u4e48\u5982\u679c\u5bf9\u65b9\u4f7f\u7528\u7684\u662fUDP\u534f\u8bae\u6216\u8005ICMP\u534f\u8bae\u5462\uff1f\u4f3c\u4e4e\u603b\u662f\u6709\u4e00\u4e9b\u4e0d\u5b8c\u7f8e\u7684\u5730\u65b9\u3002</p> <p>\u90a3\u4e48\u6211\u4eec\u4ed4\u7ec6\u7684\u601d\u8003\u4e00\u4e0b\uff0c\u9020\u6210\u4e0a\u8ff0\u95ee\u9898\u7684\u201d\u6839\u6e90\u201d\u5728\u54ea\u91cc\uff0c\u6211\u4eec\u4e3a\u4e86\u8ba9\u201d\u63d0\u4f9b\u670d\u52a1\u65b9\u201d\u80fd\u591f\u6b63\u5e38\u7684\u201d\u54cd\u5e94\u201d\u6211\u4eec\u7684\u8bf7\u6c42\uff0c\u4e8e\u662f\u5728\u4e3b\u673a\u4e0a\u5f00\u653e\u4e86\u5bf9\u5e94\u7684\u7aef\u53e3\uff0c\u5f00\u653e\u8fd9\u4e9b\u7aef\u53e3\u7684\u540c\u65f6\uff0c\u4e5f\u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u522b\u4eba\u5229\u7528\u8fd9\u4e9b\u5f00\u653e\u7684\u7aef\u53e3\uff0c\u201d\u4e3b\u52a8\u201d\u7684\u653b\u51fb\u6211\u4eec\uff0c\u4ed6\u4eec\u53d1\u9001\u8fc7\u6765\u7684\u62a5\u6587\u5e76\u4e0d\u662f\u4e3a\u4e86\u54cd\u5e94\u6211\u4eec\uff0c\u800c\u662f\u4e3a\u4e86\u4e3b\u52a8\u653b\u51fb\u6211\u4eec\uff0c\u597d\u4e86\uff0c\u6211\u4eec\u4f3c\u4e4e\u627e\u5230\u4e86\u95ee\u9898\u6240\u5728\uff1f</p> <p>\u95ee\u9898\u5c31\u662f\uff1a\u600e\u6837\u5224\u65ad\u8fd9\u4e9b\u62a5\u6587\u662f\u4e3a\u4e86\u56de\u5e94\u6211\u4eec\u4e4b\u524d\u53d1\u51fa\u7684\u62a5\u6587\uff0c\u8fd8\u662f\u4e3b\u52a8\u5411\u6211\u4eec\u53d1\u9001\u7684\u62a5\u6587\u5462\uff1f</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7iptables\u7684state\u6269\u5c55\u6a21\u5757\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\uff0c\u4f46\u662f\u6211\u4eec\u9700\u8981\u5148\u4e86\u89e3\u4e00\u4e9bstate\u6a21\u5757\u7684\u76f8\u5173\u6982\u5ff5\uff0c\u7136\u540e\u518d\u56de\u8fc7\u5934\u6765\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\u3002</p> <p>\u4ece\u5b57\u9762\u4e0a\u7406\u89e3\uff0cstate\u53ef\u4ee5\u8bd1\u4e3a\u72b6\u6001\uff0c\u4f46\u662f\u6211\u4eec\u4e5f\u53ef\u4ee5\u7528\u4e00\u4e2a\u9ad8\u5927\u4e0a\u7684\u8bcd\u53bb\u89e3\u91ca\u5b83\uff0cstate\u6a21\u5757\u53ef\u4ee5\u8ba9iptables\u5b9e\u73b0\u201d\u8fde\u63a5\u8ffd\u8e2a\u201d\u673a\u5236\u3002</p> <p>\u90a3\u4e48\uff0c\u65e2\u7136\u662f\u201d\u8fde\u63a5\u8ffd\u8e2a\u201d\uff0c\u5219\u5fc5\u7136\u8981\u6709\u201d\u8fde\u63a5\u201d\u3002</p> <p>\u54b1\u4eec\u5c31\u6765\u804a\u804a\u4ec0\u4e48\u662f\u8fde\u63a5\u5427\uff0c\u4e00\u8bf4\u5230\u8fde\u63a5\uff0c\u4f60\u53ef\u80fd\u4f1a\u4e0b\u610f\u8bc6\u7684\u60f3\u5230tcp\u8fde\u63a5\uff0c\u4f46\u662f\uff0c\u5bf9\u4e8estate\u6a21\u5757\u800c\u8a00\u7684\u201d\u8fde\u63a5\u201d\u5e76\u4e0d\u80fd\u4e0etcp\u7684\u201d\u8fde\u63a5\u201d\u753b\u7b49\u53f7\uff0c\u5728TCP/IP\u534f\u8bae\u7c07\u4e2d\uff0cUDP\u548cICMP\u662f\u6ca1\u6709\u6240\u8c13\u7684\u8fde\u63a5\u7684\uff0c\u4f46\u662f\u5bf9\u4e8estate\u6a21\u5757\u6765\u8bf4\uff0ctcp\u62a5\u6587\u3001udp\u62a5\u6587\u3001icmp\u62a5\u6587\u90fd\u662f\u6709\u8fde\u63a5\u72b6\u6001\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u8ba4\u4e3a\uff0c\u5bf9\u4e8estate\u6a21\u5757\u800c\u8a00\uff0c\u53ea\u8981\u4e24\u53f0\u673a\u5668\u5728\u201d\u4f60\u6765\u6211\u5f80\u201d\u7684\u901a\u4fe1\uff0c\u5c31\u7b97\u5efa\u7acb\u8d77\u4e86\u8fde\u63a5\uff0c\u5982\u4e0b\u56fe\u6240\u793a</p> <p></p> <p>\u800c\u62a5\u6587\u5728\u8fd9\u4e2a\u6240\u8c13\u7684\u94fe\u63a5\u4e2d\u662f\u4ec0\u4e48\u72b6\u6001\u7684\u5462\uff1f\u8fd9\u662f\u6211\u4eec\u540e\u9762\u8ba8\u8bba\u7684\u8bdd\u9898\u3002</p> <p>\u5bf9\u4e8estate\u6a21\u5757\u7684\u8fde\u63a5\u800c\u8a00\uff0c\u201d\u8fde\u63a5\u201d\u5176\u4e2d\u7684\u62a5\u6587\u53ef\u4ee5\u5206\u4e3a5\u79cd\u72b6\u6001\uff0c\u62a5\u6587\u72b6\u6001\u53ef\u4ee5\u4e3aNEW\u3001ESTABLISHED\u3001RELATED\u3001INVALID\u3001UNTRACKED</p> <p>\u90a3\u4e48\u4e0a\u8ff0\u62a5\u6587\u7684\u72b6\u6001\u90fd\u4ee3\u8868\u4ec0\u4e48\u542b\u4e49\u5462\uff1f\u6211\u4eec\u5148\u6765\u5927\u6982\u7684\u4e86\u89e3\u4e00\u4e0b\u6982\u5ff5\uff0c\u7136\u540e\u518d\u7ed3\u5408\u793a\u4f8b\u8bf4\u660e\u3002</p> <p>\u6ce8\u610f\uff1a\u5982\u4e0b\u62a5\u6587\u72b6\u6001\u90fd\u662f\u5bf9\u4e8estate\u6a21\u5757\u6765\u8bf4\u7684\u3002</p> <p>NEW\uff1a\u8fde\u63a5\u4e2d\u7684\u7b2c\u4e00\u4e2a\u5305\uff0c\u72b6\u6001\u5c31\u662fNEW\uff0c\u6211\u4eec\u53ef\u4ee5\u7406\u89e3\u4e3a\u65b0\u8fde\u63a5\u7684\u7b2c\u4e00\u4e2a\u5305\u7684\u72b6\u6001\u4e3aNEW\u3002</p> <p>ESTABLISHED\uff1a\u6211\u4eec\u53ef\u4ee5\u628aNEW\u72b6\u6001\u5305\u540e\u9762\u7684\u5305\u7684\u72b6\u6001\u7406\u89e3\u4e3aESTABLISHED\uff0c\u8868\u793a\u8fde\u63a5\u5df2\u5efa\u7acb\u3002</p> <p>\u6216\u8bb8\u7528\u56fe\u8bf4\u8bdd\u66f4\u5bb9\u6613\u88ab\u4eba\u7406\u89e3</p> <p></p> <p>RELATED\uff1a\u4ece\u5b57\u9762\u4e0a\u7406\u89e3RELATED\u8bd1\u4e3a\u5173\u7cfb\uff0c\u4f46\u662f\u8fd9\u6837\u4ecd\u7136\u4e0d\u5bb9\u6613\u7406\u89e3\uff0c\u6211\u4eec\u4e3e\u4e2a\u4f8b\u5b50\u3002</p> <p>\u6bd4\u5982FTP\u670d\u52a1\uff0cFTP\u670d\u52a1\u7aef\u4f1a\u5efa\u7acb\u4e24\u4e2a\u8fdb\u7a0b\uff0c\u4e00\u4e2a\u547d\u4ee4\u8fdb\u7a0b\uff0c\u4e00\u4e2a\u6570\u636e\u8fdb\u7a0b\u3002</p> <p>\u547d\u4ee4\u8fdb\u7a0b\u8d1f\u8d23\u670d\u52a1\u7aef\u4e0e\u5ba2\u6237\u7aef\u4e4b\u95f4\u7684\u547d\u4ee4\u4f20\u8f93\uff08\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e2a\u4f20\u8f93\u8fc7\u7a0b\u7406\u89e3\u6210state\u4e2d\u6240\u8c13\u7684\u4e00\u4e2a\u201d\u8fde\u63a5\u201d\uff0c\u6682\u79f0\u4e3a\u201d\u547d\u4ee4\u8fde\u63a5\u201d\uff09\u3002</p> <p>\u6570\u636e\u8fdb\u7a0b\u8d1f\u8d23\u670d\u52a1\u7aef\u4e0e\u5ba2\u6237\u7aef\u4e4b\u95f4\u7684\u6570\u636e\u4f20\u8f93 ( \u6211\u4eec\u628a\u8fd9\u4e2a\u8fc7\u7a0b\u6682\u79f0\u4e3a\u201d\u6570\u636e\u8fde\u63a5\u201d )\u3002</p> <p>\u4f46\u662f\u5177\u4f53\u4f20\u8f93\u54ea\u4e9b\u6570\u636e\uff0c\u662f\u7531\u547d\u4ee4\u53bb\u63a7\u5236\u7684\uff0c\u6240\u4ee5\uff0c\u201d\u6570\u636e\u8fde\u63a5\u201d\u4e2d\u7684\u62a5\u6587\u4e0e\u201d\u547d\u4ee4\u8fde\u63a5\u201d\u662f\u6709\u201d\u5173\u7cfb\u201d\u7684\u3002</p> <p>\u90a3\u4e48\uff0c\u201d\u6570\u636e\u8fde\u63a5\u201d\u4e2d\u7684\u62a5\u6587\u53ef\u80fd\u5c31\u662fRELATED\u72b6\u6001\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u62a5\u6587\u4e0e\u201d\u547d\u4ee4\u8fde\u63a5\u201d\u4e2d\u7684\u62a5\u6587\u6709\u5173\u7cfb\u3002</p> <p>(\u6ce8\uff1a\u5982\u679c\u60f3\u8981\u5bf9ftp\u8fdb\u884c\u8fde\u63a5\u8ffd\u8e2a\uff0c\u9700\u8981\u5355\u72ec\u52a0\u8f7d\u5bf9\u5e94\u7684\u5185\u6838\u6a21\u5757nf_conntrack_ftp\uff0c\u5982\u679c\u60f3\u8981\u81ea\u52a8\u52a0\u8f7d\uff0c\u53ef\u4ee5\u914d\u7f6e/etc/sysconfig/iptables-config\u6587\u4ef6)</p> <p>INVALID\uff1a\u5982\u679c\u4e00\u4e2a\u5305\u6ca1\u6709\u529e\u6cd5\u88ab\u8bc6\u522b\uff0c\u6216\u8005\u8fd9\u4e2a\u5305\u6ca1\u6709\u4efb\u4f55\u72b6\u6001\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5305\u7684\u72b6\u6001\u5c31\u662fINVALID\uff0c\u6211\u4eec\u53ef\u4ee5\u4e3b\u52a8\u5c4f\u853d\u72b6\u6001\u4e3aINVALID\u7684\u62a5\u6587\u3002</p> <p>UNTRACKED\uff1a\u62a5\u6587\u7684\u72b6\u6001\u4e3auntracked\u65f6\uff0c\u8868\u793a\u62a5\u6587\u672a\u88ab\u8ffd\u8e2a\uff0c\u5f53\u62a5\u6587\u7684\u72b6\u6001\u4e3aUntracked\u65f6\u901a\u5e38\u8868\u793a\u65e0\u6cd5\u627e\u5230\u76f8\u5173\u7684\u8fde\u63a5\u3002</p> <p>\u4e0a\u8ff05\u79cd\u72b6\u6001\u7684\u8be6\u7ec6\u89e3\u91ca\u53ef\u4ee5\u53c2\u8003\u5982\u4e0b\u6587\u7ae0\u7684\u201dUser-land states\u201d\u7ae0\u8282</p> <p>http://www.iptables.info/en/connection-state.html</p> <p>\u597d\u4e86\uff0c\u6211\u4eec\u5df2\u7ecf\u5927\u81f4\u4e86\u89e3\u4e86state\u6a21\u5757\u4e2d\u6240\u5b9a\u4e49\u76845\u79cd\u72b6\u6001\uff0c\u90a3\u4e48\u73b0\u5728\uff0c\u6211\u4eec\u56de\u8fc7\u5934\u60f3\u60f3\u521a\u624d\u7684\u95ee\u9898\u3002</p> <p>\u521a\u624d\u95ee\u9898\u7684\u6839\u6e90\u5c31\u662f\uff1a\u600e\u6837\u5224\u65ad\u62a5\u6587\u662f\u5426\u662f\u4e3a\u4e86\u56de\u5e94\u4e4b\u524d\u53d1\u51fa\u7684\u62a5\u6587\u3002</p> <p>\u521a\u624d\u4e3e\u4f8b\u4e2d\u7684\u95ee\u9898\u5373\u53ef\u4f7f\u7528state\u6269\u5c55\u6a21\u5757\u89e3\u51b3\uff0c\u6211\u4eec\u53ea\u8981\u653e\u884c\u72b6\u6001\u4e3aESTABLISHED\u7684\u62a5\u6587\u5373\u53ef\uff0c\u56e0\u4e3a\u5982\u679c\u62a5\u6587\u7684\u72b6\u6001\u4e3aESTABLISHED\uff0c\u90a3\u4e48\u62a5\u6587\u80af\u5b9a\u662f\u4e4b\u524d\u53d1\u51fa\u7684\u62a5\u6587\u7684\u56de\u5e94\uff0c\u5982\u679c\u4f60\u8fd8\u4e0d\u653e\u5fc3\uff0c\u53ef\u4ee5\u5c06\u72b6\u6001\u4e3aRELATED\u6216ESTABLISHED\u7684\u62a5\u6587\u90fd\u653e\u884c\uff0c\u8fd9\u6837\uff0c\u5c31\u8868\u793a\u53ea\u6709\u56de\u5e94\u6211\u4eec\u7684\u62a5\u6587\u80fd\u591f\u901a\u8fc7\u9632\u706b\u5899\uff0c\u5982\u679c\u662f\u522b\u4eba\u4e3b\u52a8\u53d1\u9001\u8fc7\u6765\u7684\u65b0\u7684\u62a5\u6587\uff0c\u5219\u65e0\u6cd5\u901a\u8fc7\u9632\u706b\u5899\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u5f53\u524d\u4e3b\u673aIP\u4e3a104\uff0c\u5f53\u653e\u884cESTABLISHED\u4e0eRELATED\u72b6\u6001\u7684\u5305\u4ee5\u540e\uff0c\u5e76\u6ca1\u6709\u5f71\u54cd\u901a\u8fc7\u672c\u673a\u8fdc\u7a0bssh\u5230IP\u4e3a77\u7684\u4e3b\u673a\u4e0a\uff0c\u4f46\u662f\u65e0\u6cd5\u4ece77\u4e0a\u4f7f\u752822\u7aef\u53e3\u4e3b\u52a8\u8fde\u63a5\u5230104\u4e0a\u3002</p> <p>\u5bf9\u4e8e\u5176\u4ed6\u7aef\u53e3\u4e0eIP\u6765\u8bf4\uff0c\u4e5f\u662f\u76f8\u540c\u7684\uff0c\u53ef\u4ee5\u4ece104\u4e3b\u52a8\u53d1\u9001\u62a5\u6587\uff0c\u5e76\u4e14\u80fd\u591f\u6536\u5230\u54cd\u5e94\u62a5\u6587\uff0c\u4f46\u662f\u5176\u4ed6\u4e3b\u673a\u5e76\u4e0d\u80fd\u4e3b\u52a8\u5411104\u53d1\u8d77\u8bf7\u6c42\u3002</p> <p>\u597d\u4e86\uff0cstate\u6a21\u5757\u5c31\u603b\u7ed3\u5230\u8fd9\u91cc\uff0c\u5e0c\u671b\u8fd9\u7bc7\u6587\u7ae0\u80fd\u591f\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\u3002</p>"},{"location":"iptables_9/","title":"iptables\u8be6\u89e3\uff089\uff09\uff1aiptables\u7684\u9ed1\u767d\u540d\u5355\u673a\u5236","text":"<p>\u5728\u672c\u535a\u5ba2\u4e2d\uff0c\u4ece\u7406\u8bba\u5230\u5b9e\u8df5\uff0c\u7cfb\u7edf\u7684\u4ecb\u7ecd\u4e86iptables\uff0c\u5982\u679c\u4f60\u60f3\u8981\u4ece\u5934\u5f00\u59cb\u4e86\u89e3iptables\uff0c\u53ef\u4ee5\u67e5\u770biptables\u6587\u7ae0\u5217\u8868\uff0c\u76f4\u8fbe\u94fe\u63a5\u5982\u4e0b</p> <p>iptables\u96f6\u57fa\u7840\u5feb\u901f\u5165\u95e8\u7cfb\u5217</p> <p>\u6ce8\u610f\uff1a\u5728\u53c2\u7167\u672c\u6587\u8fdb\u884ciptables\u5b9e\u9a8c\u65f6\uff0c\u8bf7\u52a1\u5fc5\u5728\u4e2a\u4eba\u7684\u6d4b\u8bd5\u673a\u4e0a\u8fdb\u884c\uff0c\u56e0\u4e3a\u5982\u679ciptables\u89c4\u5219\u8bbe\u7f6e\u4e0d\u5f53\uff0c\u6709\u53ef\u80fd\u4f7f\u4f60\u65e0\u6cd5\u8fde\u63a5\u5230\u8fdc\u7a0b\u4e3b\u673a\u4e2d\u3002</p> <p>\u524d\u6587\u4e2d\u4e00\u76f4\u5728\u5f3a\u8c03\u4e00\u4e2a\u6982\u5ff5\uff1a\u62a5\u6587\u5728\u7ecf\u8fc7iptables\u7684\u94fe\u65f6\uff0c\u4f1a\u5339\u914d\u94fe\u4e2d\u7684\u89c4\u5219\uff0c\u9047\u5230\u5339\u914d\u7684\u89c4\u5219\u65f6\uff0c\u5c31\u6267\u884c\u5bf9\u5e94\u7684\u52a8\u4f5c\uff0c\u5982\u679c\u94fe\u4e2d\u7684\u89c4\u5219\u90fd\u65e0\u6cd5\u5339\u914d\u5230\u5f53\u524d\u62a5\u6587\uff0c\u5219\u4f7f\u7528\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\uff08\u9ed8\u8ba4\u52a8\u4f5c\uff09\uff0c\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u901a\u5e38\u8bbe\u7f6e\u4e3aACCEPT\u6216\u8005DROP\u3002</p> <p>\u90a3\u4e48\uff0c\u5f53\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u8bbe\u7f6e\u4e3aACCEPT\u65f6\uff0c\u5982\u679c\u5bf9\u5e94\u7684\u94fe\u4e2d\u6ca1\u6709\u914d\u7f6e\u4efb\u4f55\u89c4\u5219\uff0c\u5c31\u8868\u793a\u63a5\u53d7\u6240\u6709\u7684\u62a5\u6587\uff0c\u5982\u679c\u5bf9\u5e94\u7684\u94fe\u4e2d\u5b58\u5728\u89c4\u5219\uff0c\u4f46\u662f\u8fd9\u4e9b\u89c4\u5219\u6ca1\u6709\u5339\u914d\u5230\u62a5\u6587\uff0c\u62a5\u6587\u8fd8\u662f\u4f1a\u88ab\u63a5\u53d7\u3002</p> <p>\u540c\u7406\uff0c\u5f53\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u8bbe\u7f6e\u4e3aDROP\u65f6\uff0c\u5982\u679c\u5bf9\u5e94\u7684\u94fe\u4e2d\u6ca1\u6709\u914d\u7f6e\u4efb\u4f55\u89c4\u5219\uff0c\u5c31\u8868\u793a\u62d2\u7edd\u6240\u6709\u62a5\u6587\uff0c\u5982\u679c\u5bf9\u5e94\u7684\u94fe\u4e2d\u5b58\u5728\u89c4\u5219\uff0c\u4f46\u662f\u8fd9\u4e9b\u89c4\u5219\u6ca1\u6709\u5339\u914d\u5230\u62a5\u6587\uff0c\u62a5\u6587\u8fd8\u662f\u4f1a\u88ab\u62d2\u7edd\u3002</p> <p>\u6240\u4ee5\uff0c\u5f53\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u8bbe\u7f6e\u4e3aACCEPT\u65f6\uff0c\u6309\u7167\u9053\u7406\u6765\u8bf4\uff0c\u6211\u4eec\u5728\u94fe\u4e2d\u914d\u7f6e\u89c4\u5219\u65f6\uff0c\u5bf9\u5e94\u7684\u52a8\u4f5c\u5e94\u8be5\u8bbe\u7f6e\u4e3aDROP\u6216\u8005REJECT\uff0c\u4e3a\u4ec0\u4e48\u5462\uff1f</p> <p>\u56e0\u4e3a\u9ed8\u8ba4\u7b56\u7565\u5df2\u7ecf\u4e3aACCEPT\u4e86\uff0c\u5982\u679c\u6211\u4eec\u5728\u8bbe\u7f6e\u89c4\u5219\u65f6\uff0c\u5bf9\u5e94\u52a8\u4f5c\u4ecd\u7136\u4e3aACCEPT\uff0c\u90a3\u4e48\u6240\u6709\u62a5\u6587\u90fd\u4f1a\u88ab\u653e\u884c\u4e86\uff0c\u56e0\u4e3a\u4e0d\u7ba1\u62a5\u6587\u662f\u5426\u88ab\u89c4\u5219\u5339\u914d\u5230\u90fd\u4f1a\u88abACCEPT\uff0c\u6240\u4ee5\u5c31\u5931\u53bb\u4e86\u8bbf\u95ee\u63a7\u5236\u7684\u610f\u4e49\u3002</p> <p>\u6240\u4ee5\uff0c\u5f53\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u4e3aACCEPT\u65f6\uff0c\u94fe\u4e2d\u7684\u89c4\u5219\u5bf9\u5e94\u7684\u52a8\u4f5c\u5e94\u8be5\u4e3aDROP\u6216\u8005REJECT\uff0c\u8868\u793a\u53ea\u6709\u5339\u914d\u5230\u89c4\u5219\u7684\u62a5\u6587\u624d\u4f1a\u88ab\u62d2\u7edd\uff0c\u6ca1\u6709\u88ab\u89c4\u5219\u5339\u914d\u5230\u7684\u62a5\u6587\u90fd\u4f1a\u88ab\u9ed8\u8ba4\u63a5\u53d7\uff0c\u8fd9\u5c31\u662f\u201d\u9ed1\u540d\u5355\u201d\u673a\u5236\u3002</p> <p>\u540c\u7406\uff0c\u5f53\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u4e3aDROP\u65f6\uff0c\u94fe\u4e2d\u7684\u89c4\u5219\u5bf9\u5e94\u7684\u52a8\u4f5c\u5e94\u8be5\u4e3aACCEPT\uff0c\u8868\u793a\u53ea\u6709\u5339\u914d\u5230\u89c4\u5219\u7684\u62a5\u6587\u624d\u4f1a\u88ab\u653e\u884c\uff0c\u6ca1\u6709\u88ab\u89c4\u5219\u5339\u914d\u5230\u7684\u62a5\u6587\u90fd\u4f1a\u88ab\u9ed8\u8ba4\u62d2\u7edd\uff0c\u8fd9\u5c31\u662f\u201d\u767d\u540d\u5355\u201d\u673a\u5236\u3002</p> <p>\u5982\u679c\u4f7f\u7528\u767d\u540d\u5355\u673a\u5236\uff0c\u6211\u4eec\u5c31\u8981\u628a\u6240\u6709\u4eba\u90fd\u5f53\u505a\u574f\u4eba\uff0c\u53ea\u653e\u884c\u597d\u4eba\u3002</p> <p>\u5982\u679c\u4f7f\u7528\u9ed1\u540d\u5355\u673a\u5236\uff0c\u6211\u4eec\u5c31\u8981\u628a\u6240\u6709\u4eba\u90fd\u5f53\u6210\u597d\u4eba\uff0c\u53ea\u62d2\u7edd\u574f\u4eba\u3002</p> <p>\u767d\u540d\u5355\u673a\u5236\u4f3c\u4e4e\u66f4\u52a0\u5b89\u5168\u4e00\u4e9b\uff0c\u9ed1\u540d\u5355\u673a\u5236\u4f3c\u4e4e\u66f4\u52a0\u7075\u6d3b\u4e00\u4e9b\u3002</p> <p>\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u6765\u505a\u4e00\u4e2a\u7b80\u5355\u7684\u767d\u540d\u5355\u5427\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u653e\u884c\u88ab\u89c4\u5219\u5339\u914d\u5230\u7684\u62a5\u6587\uff0c\u5176\u4ed6\u62a5\u6587\u4e00\u5f8b\u62d2\u7edd\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u5148\u6765\u914d\u7f6e\u89c4\u5219\u3002</p> <p>\u5047\u8bbe\uff0c\u6211\u60f3\u8981\u653e\u884cssh\u8fdc\u7a0b\u8fde\u63a5\u76f8\u5173\u7684\u62a5\u6587\uff0c\u4e5f\u60f3\u8981\u653e\u884cweb\u670d\u52a1\u76f8\u5173\u7684\u62a5\u6587\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u5728INPUT\u94fe\u4e2d\u6dfb\u52a0\u5982\u4e0b\u89c4\u5219\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u6211\u4eec\u5df2\u7ecf\u653e\u884c\u4e86\u7279\u5b9a\u7684\u62a5\u6587\uff0c\u53ea\u6709\u4e0a\u8ff0\u4e24\u6761\u89c4\u5219\u5339\u914d\u5230\u7684\u62a5\u6587\u624d\u4f1a\u88ab\u653e\u884c\uff0c\u73b0\u5728\uff0c\u6211\u4eec\u53ea\u8981\u5c06INPUT\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u6539\u4e3aDROP\uff0c\u5373\u53ef\u5b9e\u73b0\u767d\u540d\u5355\u673a\u5236\u3002</p> <p>\u793a\u4f8b\u5982\u4e0b\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u6211\u4eec\u5df2\u7ecf\u5c06INPUT\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u6539\u4e3aDROP\uff0c\u5e76\u4e14\u5df2\u7ecf\u5b9e\u73b0\u4e86\u6240\u8c13\u7684\u767d\u540d\u5355\u673a\u5236\uff0c\u5373\u9ed8\u8ba4\u62d2\u7edd\u6240\u6709\u62a5\u6587\uff0c\u53ea\u653e\u884c\u7279\u5b9a\u7684\u62a5\u6587\u3002</p> <p>\u5982\u679c\u6b64\u65f6\uff0c\u6211\u4e0d\u5c0f\u5fc3\u6267\u884c\u4e86\u201diptables -F\u201d\u64cd\u4f5c\uff0c\u6839\u636e\u6211\u4eec\u4e4b\u524d\u5b66\u5230\u7684\u77e5\u8bc6\u53bb\u5224\u65ad\uff0c\u6211\u4eec\u8fd8\u80fd\u591f\u901a\u8fc7ssh\u5de5\u5177\u8fdc\u7a0b\u5230\u670d\u52a1\u5668\u4e0a\u5417\uff1f</p> <p>\u6211\u60f3\u4f60\u5df2\u7ecf\u5224\u65ad\u51fa\u4e86\u6b63\u786e\u7b54\u6848\uff0c\u6ca1\u9519\uff0c\u6309\u7167\u4e0a\u56fe\u4e2d\u7684\u60c5\u51b5\uff0c\u5982\u679c\u6b64\u65f6\u6267\u884c\u201diptables -F\u201d\u64cd\u4f5c\uff0cfilter\u8868\u4e2d\u7684\u6240\u6709\u94fe\u4e2d\u7684\u6240\u6709\u89c4\u5219\u90fd\u4f1a\u88ab\u6e05\u7a7a\uff0c\u800cINPUT\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u4e3aDROP\uff0c\u6240\u4ee5\u6240\u6709\u62a5\u6587\u90fd\u4f1a\u88ab\u62d2\u7edd\uff0c\u4e0d\u6b62ssh\u8fdc\u7a0b\u8bf7\u6c42\u4f1a\u88ab\u62d2\u7edd\uff0c\u5176\u4ed6\u62a5\u6587\u4e5f\u4f1a\u88ab\u62d2\u7edd\uff0c\u6211\u4eec\u6765\u5b9e\u9a8c\u4e00\u4e0b\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5728\u5f53\u524dssh\u8fdc\u7a0b\u5de5\u5177\u4e2d\u6267\u884c\u201diptables -F\u201d\u547d\u4ee4\u540e\uff0c\u7531\u4e8eINPUT\u94fe\u4e2d\u5df2\u7ecf\u4e0d\u5b58\u5728\u4efb\u4f55\u89c4\u5219\uff0c\u6240\u4ee5\uff0c\u6240\u6709\u62a5\u6587\u90fd\u88ab\u62d2\u7edd\u4e86\uff0c\u5305\u62ec\u5f53\u524d\u7684ssh\u8fdc\u7a0b\u8fde\u63a5\u3002</p> <p>\u8fd9\u5c31\u662f\u9ed8\u8ba4\u7b56\u7565\u8bbe\u7f6e\u4e3aDROP\u7684\u7f3a\u70b9\uff0c\u5728\u5bf9\u5e94\u7684\u94fe\u4e2d\u6ca1\u6709\u8bbe\u7f6e\u4efb\u4f55\u89c4\u5219\u65f6\uff0c\u8fd9\u6837\u4f7f\u7528\u9ed8\u8ba4\u7b56\u7565\u4e3aDROP\u662f\u975e\u5e38\u4e0d\u660e\u667a\u7684\uff0c\u56e0\u4e3a\u7ba1\u7406\u5458\u4e5f\u4f1a\u628a\u81ea\u5df1\u62d2\u4e4b\u95e8\u5916\uff0c\u5373\u4f7f\u5bf9\u5e94\u7684\u94fe\u4e2d\u5b58\u5728\u653e\u884c\u89c4\u5219\uff0c\u5f53\u6211\u4eec\u4e0d\u5c0f\u5fc3\u4f7f\u7528\u201diptables -F\u201d\u6e05\u7a7a\u89c4\u5219\u65f6\uff0c\u653e\u884c\u89c4\u5219\u88ab\u5220\u9664\uff0c\u5219\u6240\u6709\u6570\u636e\u5305\u90fd\u65e0\u6cd5\u8fdb\u5165\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u76f8\u5f53\u4e8e\u7ed9\u7ba1\u7406\u5458\u6316\u4e86\u4e2a\u5751\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5982\u679c\u60f3\u8981\u4f7f\u7528\u201d\u767d\u540d\u5355\u201d\u7684\u673a\u5236\uff0c\u6700\u597d\u5c06\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u4fdd\u6301\u4e3a\u201dACCEPT\u201d\uff0c\u7136\u540e\u5c06\u201d\u62d2\u7edd\u6240\u6709\u8bf7\u6c42\u201d\u8fd9\u6761\u89c4\u5219\u653e\u5728\u94fe\u7684\u5c3e\u90e8\uff0c\u5c06\u201d\u653e\u884c\u89c4\u5219\u201d\u653e\u5728\u524d\u9762\uff0c\u8fd9\u6837\u505a\uff0c\u65e2\u80fd\u5b9e\u73b0\u201d\u767d\u540d\u5355\u201d\u673a\u5236\uff0c\u53c8\u80fd\u4fdd\u8bc1\u5728\u89c4\u5219\u88ab\u6e05\u7a7a\u65f6\uff0c\u7ba1\u7406\u5458\u8fd8\u6709\u673a\u4f1a\u8fde\u63a5\u5230\u4e3b\u673a\uff0c\u793a\u4f8b\u5982\u4e0b\u3002</p> <p>\u56e0\u4e3a\u521a\u624d\u7684ssh\u8fde\u63a5\u5df2\u7ecf\u88ab\u62d2\u7edd\uff0c\u6240\u4ee5\uff0c\u6b64\u65f6\u76f4\u63a5\u5728\u63a7\u5236\u53f0\u4e2d\u8bbe\u7f6eiptables\u89c4\u5219</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5148\u5c06INPUT\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u8bbe\u7f6e\u4e3aACCEPT</p> <p>\u7136\u540e\u7ee7\u7eed\u914d\u7f6e\u9700\u8981\u653e\u884c\u7684\u62a5\u6587\u7684\u89c4\u5219\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5f53\u6240\u6709\u653e\u884c\u89c4\u5219\u8bbe\u7f6e\u5b8c\u6210\u540e\uff0c\u5728INPUT\u94fe\u7684\u5c3e\u90e8\uff0c\u8bbe\u7f6e\u4e00\u6761\u62d2\u7edd\u6240\u6709\u8bf7\u6c42\u7684\u89c4\u5219\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u7684\u8bbe\u7f6e\uff0c\u65e2\u5c06INPUT\u94fe\u7684\u9ed8\u8ba4\u7b56\u7565\u8bbe\u7f6e\u4e3a\u4e86ACCEPT\uff0c\u540c\u65f6\u53c8\u4f7f\u7528\u4e86\u767d\u540d\u5355\u673a\u5236\uff0c\u56e0\u4e3a\u5982\u679c\u62a5\u6587\u7b26\u5408\u653e\u884c\u6761\u4ef6\uff0c\u5219\u4f1a\u88ab\u524d\u9762\u7684\u653e\u884c\u89c4\u5219\u5339\u914d\u5230\uff0c\u5982\u679c\u62a5\u6587\u4e0d\u7b26\u5408\u653e\u884c\u6761\u4ef6\uff0c\u5219\u4f1a\u88ab\u6700\u540e\u4e00\u6761\u62d2\u7edd\u89c4\u5219\u5339\u914d\u5230\uff0c\u6b64\u523b\uff0c\u5373\u4f7f\u6211\u4eec\u8bef\u64cd\u4f5c\uff0c\u6267\u884c\u4e86\u201diptables -F\u201d\u64cd\u4f5c\uff0c\u4e5f\u80fd\u4fdd\u8bc1\u7ba1\u7406\u5458\u80fd\u591f\u8fdc\u7a0b\u5230\u4e3b\u673a\u4e0a\u8fdb\u884c\u7ef4\u62a4\uff0c\u56e0\u4e3a\u9ed8\u8ba4\u7b56\u7565\u4ecd\u7136\u662fACCEPT\u3002</p> <p>\u5176\u5b9e\uff0c\u5728\u4e4b\u524d\u77e5\u8bc6\u7684\u57fa\u7840\u4e0a\uff0c\u7406\u89e3\u6240\u8c13\u7684\u9ed1\u767d\u540d\u5355\u673a\u5236\u662f\u5f88\u5bb9\u6613\u7684\uff0c\u6b64\u5904\u53ea\u662f\u5c06\u6700\u4f73\u5b9e\u8df5\u603b\u7ed3\u4e86\u4e00\u4e0b\uff0c\u5e0c\u671b\u8fd9\u7bc7\u6587\u7ae0\u80fd\u591f\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\u3002</p>"},{"location":"linux-img/","title":"rocky img \u4f5c\u6210","text":""},{"location":"linux-img/#_1","title":"\u4f5c\u6210\u624b\u9806\u66f8","text":"<ol> <li> <p>\u6700\u65b0\u306eRocky8/Rocky9\u306eISO\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b</p> <ul> <li>Rocky-8.7-x86_64-dvd1.iso</li> <li>Rocky-9.2-x86_64-minimal.iso</li> </ul> </li> <li> <p>HV\u4e0avol\u3092\u4f5c\u6210</p> \u4f5c\u6210 <pre><code>virsh vol-create-as tank rocky-tmp 22G\n</code></pre> </li> <li> <p>ISO\u30d5\u30a1\u30a4\u30eb\u304b\u3089VM\u8d77\u52d5\u3059\u308b</p> \u8868\u793a <pre><code>virt-install \\\n--connect qemu:///system \\\n--name rocky8-tmp \\\n--vcpus=8 \\             &lt;- CPU\u6570\n--ram 16384 \\           &lt;- MEM\u5bb9\u91cf\n--location /mnt/Rocky-8.6-x86_64-dvd1.iso \\     &lt;- ISO\u30d5\u30a1\u30a4\u30eb\u5834\u6240\n--os-type=linux \\\n--os-variant=rhel8.2 \\                              &lt;- \u6700\u65b0\u306erhel\u3092\u9078\u629e\uff08osinfo-query os\u3067\u78ba\u8a8d\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u3088\u3063\u3066\u306a\u3044\u5834\u5408\u3082\u3042\u308b\uff09\n--disk vol=tank/rocky8-tmp,bus=virtio,cache=none \\\n--network bridge=br100,model=virtio \\               &lt;- VLAN 100\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u74b0\u5883\u3067\u3059\u3002DHCP\u304c\u4f7f\u3048\u308b\n--graphics vnc,listen=0.0.0.0,keymap=en-us \\\n--console pty,target_type=serial \\\n--autostart \\\n--noautoconsole\n\n# Rocky91\u306e\u4f8b\nvirt-install \\\n--connect qemu:///system \\\n--name rocky91-tmp \\\n--vcpus=8 \\\n--ram 16384 \\\n--location /mnt/Rocky-9.1-x86_64-dvd.iso \\\n--os-type=linux \\\n--os-variant=rocky9 \\\n--disk vol=tank/rocky91-tmp,bus=virtio,cache=none \\\n--network bridge=br100,model=virtio \\\n--graphics vnc,listen=0.0.0.0,keymap=en-us \\\n--console pty,target_type=serial \\\n--autostart \\\n--noautoconsole\n\n# Rocky92-mini\u306e\u4f8b\nvirsh vol-create-as tank rocky92-mini 22G\nvirt-install \\\n--connect qemu:///system \\\n--name rocky92-mini \\\n--vcpus=8 \\\n--ram 16384 \\\n--location /mnt/Rocky-9.2-x86_64-minimal.iso \\\n--os-type=linux \\\n--os-variant=rocky9 \\\n--disk vol=tank/rocky92-mini,bus=virtio,cache=none \\\n--network bridge=br100,model=virtio \\\n--graphics vnc,listen=0.0.0.0,keymap=en-us \\\n--console pty,target_type=serial \\\n--autostart \\\n--noautoconsole\n</code></pre> </li> <li> <p>VNC\u306a\u3069\u3067\u5bfe\u8c61VM\u3092GUI\u3067\u78ba\u8a8d\u3057\u3001OS\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb</p> \u8868\u793a <pre><code># DISK\n## /home\u5206\u3051\u308b\u306e\u5834\u5408\nvda1 /     12Gib  ext4\nvda2 swap  8Gib   swap\nvda3 /home free   ext4\n\n## /home\u5206\u3051\u306a\u3044\u306e\u5834\u5408\nvda1 /boot    1Gib   ext4\nvda2 swap     8Gib   swap\nvda3 /        free   ext4\n\n####################\n# # /home\u5206\u3051\u308b\u306e\u5834\u5408\n# # Generated by Anaconda 34.25.2.10\n# # Generated by pykickstart v3.32\n# #version=RHEL9\n# # Use graphical install\n# graphical\n# repo --name=\"minimal\" --baseurl=file:///run/install/sources/mount-0000-cdrom/minimal\n#\n# %addon com_redhat_kdump --disable\n#\n# %end\n#\n# # Keyboard layouts\n# keyboard --xlayouts='us'\n# # System language\n# lang en_US.UTF-8\n#\n# # Use CDROM installation media\n# cdrom\n#\n# %packages\n# @^minimal-environment\n#\n# %end\n#\n# # Run the Setup Agent on first boot\n# firstboot --enable\n#\n# # Generated using Blivet version 3.6.0\n# ignoredisk --only-use=vda\n# # Partition clearing information\n# clearpart --none --initlabel\n# # Disk partitioning information\n# part / --fstype=\"ext4\" --ondisk=vda --size=12288\n# part /home --fstype=\"ext4\" --ondisk=vda --size=2047\n# part swap --fstype=\"swap\" --ondisk=vda --size=8192\n##########################\n# # /home\u5206\u3051\u306a\u3044\u306e\u5834\u5408\n# # Generated using Blivet version 3.6.0\n# ignoredisk --only-use=vda\n# # Partition clearing information\n# clearpart --none --initlabel\n# # Disk partitioning information\n# part swap --fstype=\"swap\" --ondisk=vda --size=8192\n# part / --fstype=\"ext4\" --ondisk=vda --size=11263\n# part /boot --fstype=\"ext4\" --ondisk=vda --size=1024\n######## WAF #############\n# # System timezone\n# timezone Asia/Tokyo --utc\n#\n# # Root password\n# rootpw --iscrypted --allow-ssh password\n# Software Selection\nMinimal Install\n\n# Kdump is disabled\n# Time&amp;Date\nAsia/Tokyo timezone\n\n# Root Password\npassword\n</code></pre> </li> <li> <p>OS\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u3001LVM\u3092dd\u3057\u3066img\u3068\u3057\u3066\u4fdd\u5b58\u3059\u308b</p> VM xml <pre><code># MEM: 16777216 = 16GB\n# CPU: 8VCPU\n# cat /root/work/mysql8-rocky92-test.xml\n&lt;domain type='kvm'&gt;\n  &lt;name&gt;mysql8-rocky92-test&lt;/name&gt;\n  &lt;memory unit='KiB'&gt;16777216&lt;/memory&gt;\n  &lt;currentMemory unit='KiB'&gt;16777216&lt;/currentMemory&gt;\n  &lt;vcpu placement='static'&gt;8&lt;/vcpu&gt;\n  &lt;os&gt;\n    &lt;type arch='x86_64'&gt;hvm&lt;/type&gt;\n    &lt;smbios mode='sysinfo'/&gt;\n    &lt;boot dev='hd'/&gt;\n  &lt;/os&gt;\n  &lt;sysinfo type='smbios'&gt;\n    &lt;bios&gt;\n       &lt;entry name='vendor'&gt;My company inc.&lt;/entry&gt;\n    &lt;/bios&gt;\n    &lt;system&gt;\n       &lt;entry name='product'&gt;Linux KVM&lt;/entry&gt;\n    &lt;/system&gt;\n  &lt;/sysinfo&gt;\n  &lt;features&gt;\n    &lt;acpi/&gt;\n    &lt;apic/&gt;\n  &lt;/features&gt;\n  &lt;cpu mode='host-model' check='partial'&gt;\n    &lt;topology sockets='1' cores='8' threads='1'/&gt;\n  &lt;/cpu&gt;\n  &lt;clock offset='utc'&gt;\n  &lt;/clock&gt;\n  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;\n  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;\n  &lt;on_crash&gt;destroy&lt;/on_crash&gt;\n  &lt;devices&gt;\n    &lt;emulator&gt;/usr/bin/qemu-system-x86_64&lt;/emulator&gt;\n    &lt;disk type='block' device='disk'&gt;\n      &lt;driver name='qemu' type='raw' cache='none' io='native'/&gt;\n      &lt;source dev='/dev/tank/mysql8-rocky92-test' index='1'/&gt;\n      &lt;target dev='vda' bus='virtio'/&gt;\n    &lt;/disk&gt;\n\n&lt;interface type='bridge'&gt;\n      &lt;source bridge='br100'/&gt;\n      &lt;target dev='mysql-rocky9'/&gt;\n      &lt;model type='virtio'/&gt;\n    &lt;/interface&gt;\n\n&lt;serial type='pty'&gt;\n      &lt;target type='isa-serial' port='0'&gt;\n        &lt;model name='isa-serial'/&gt;\n      &lt;/target&gt;\n    &lt;/serial&gt;\n    &lt;console type='pty'&gt;\n      &lt;target type='serial' port='0'/&gt;\n    &lt;/console&gt;\n\n&lt;input type='mouse' bus='ps2'/&gt;\n    &lt;input type='keyboard' bus='ps2'/&gt;\n    &lt;graphics type='vnc'  autoport='yes' listen='0.0.0.0' keymap='en-us'&gt;\n      &lt;listen type='address' address='0.0.0.0'/&gt;\n    &lt;/graphics&gt;\n    &lt;video&gt;\n      &lt;model type='vga' vram='4096' heads='1'/&gt;\n    &lt;/video&gt;\n  &lt;/devices&gt;\n&lt;/domain&gt;\n</code></pre> \u8868\u793a <pre><code>0. hostname set\n[root@localhost ~]# hostnamectl set-hostname waf92-tmp\n1. ssh-keygen\n    [root@localhost ~]# ssh-keygen -q -t dsa -N '' -f /root/.ssh/id_dsa\n[root@localhost ~]# vi .ssh/authorized_keys\n[root@localhost ~]# chmod 600 .ssh/authorized_keys\n2. 99-net.rules\n    ---------------------------- rocky8 -----------------------------------------------------\n    [root@mysql8-temp ~]# cat /etc/udev/rules.d/99-net.rules\nSUBSYSTEM==\"net\", ACTION==\"add\", KERNEL==\"e*\", SUBSYSTEMS==\"pci\", KERNELS==\"0000:01:00.0\", NAME=\"eth0\"\n[root@mysql8-temp ~]#\n---------------------------- rocky8 -----------------------------------------------------\n\n---------------------------- rocky9 -----------------------------------------------------\n    [root@mysql8-rocky92-tmp ~]# cat /etc/udev/rules.d/99-net.rules\nSUBSYSTEM==\"net\", ACTION==\"add\", KERNEL==\"e*\", SUBSYSTEMS==\"pci\", KERNELS==\"0000:00:03.0\", NAME=\"eth0\"\n[root@mysql8-rocky92-tmp ~]#\n---------------------------- rocky9 -----------------------------------------------------\n\n3. ifcfg-eth0\n    ---------------------------- rocky8 -----------------------------------------------------\n    [root@mysql8-temp ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0\nTYPE=Ethernet\n    DEVICE=eth0\n    BOOTPROTO=dhcp\n    ONBOOT=yes\n    IPV4_FAILURE_FATAL=no\n    IPV6INIT=no\n\n[root@localhost ~]# cat /etc/resolv.conf\nsearch db.sakura.ne.jp\n    nameserver 8.8.8.8\n    nameserver 1.1.1.1\n    options single-request-reopen\n    ---------------------------- rocky8 -----------------------------------------------------\n\n4. /etc/default/grub\n    [root@mysql8-temp ~]# cat /etc/default/grub\nGRUB_TIMEOUT=5\nGRUB_DISTRIBUTOR=\"$(sed 's, release .*$,,g' /etc/system-release)\"\nGRUB_DEFAULT=saved\n    GRUB_DISABLE_SUBMENU=true\nGRUB_TERMINAL_OUTPUT=\"console\"\nGRUB_CMDLINE_LINUX=\"mitigations=off biosdevname=0 net.ifnames=0 consoleblank=0 nomodeset console=tty0 console=ttyS0,115200n8\"\nGRUB_DISABLE_RECOVERY=\"true\"\nGRUB_ENABLE_BLSCFG=true\ngrub2-mkconfig -o /boot/grub2/grub.cfg\n\n5. cloud-utils-growpart\n    [root@mysql8-temp ~]# yum install -y cloud-utils-growpart\n6. \u4e0d\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u524a\u9664\n    - https://pikesaku.hatenablog.com/entry/2021/10/30/011750\n    - https://qiita.com/bezeklik/items/715d3e21deceb2b8ad9a\n    - https://sekaruru.hatenablog.com/entry/2018/07/03/225457\n    - https://qiita.com/cyberblack28/items/c1051cfd8045f9d0fbc8\n    yum remove samba-common -y\n    ---------------------------- rocky8 -----------------------------------------------------\n    # systemctl disable import-state.service kdump.service NetworkManager-wait-online.service nis-domainname.service  selinux-autorelabel-mark.service sssd.service unbound-anchor.timer\n---------------------------- rocky9 -----------------------------------------------------\n    # systemctl disable  kdump.service nis-domainname.service  selinux-autorelabel-mark.service\n# Rocky9\u306f\u524a\u9664\u3057\u306a\u3044\n# yum install -y sssd-common sssd-kcm sssd-nfs-idmap sssd-client\nsystemctl enable sssd.service\n    yum remove unbound-libs firewalld -y\n    yum install iptables-services iptables -y\n    systemctl enable iptables\n    # selinux \u3092\u7121\u52b9\u5316\nvi /etc/selinux/config\n    SELINUX=disabled\n\n# \u7121\u7dda\u306eFirmware\u3092\u524a\u9664\nfor i in `rpm -aq | grep iw`; do echo $i; yum remove -y $i; done\nservice auditd stop\n    systemctl disable auditd.service\n    yum remove -y audit\n    ---------------------------- rocky8 -----------------------------------------------------\n    # auth\u65b9\u5f0f\u3092nis\u306b\u5909\u66f4\n[root@mysql8-temp ~]# authselect list\n- minimal        Local users only for minimal installations\n    - nis            Enable NIS for system authentication\n    - sssd           Enable SSSD for system authentication (also for local users only)\n- winbind        Enable winbind for system authentication\n\n[root@mysql8-temp ~]# authselect current\nProfile ID: sssd\n    Enabled features:\n    - with-fingerprint\n    - with-silent-lastlog\n\n[root@mysql8-temp ~]# authselect select nis with-silent-lastlog --force\nBackup stored at /var/lib/authselect/backups/2022-10-26-01-27-08.SdonHi\n    Profile \"nis\" was selected.\n    The following nsswitch maps are overwritten by the profile:\n    - aliases\n    - automount\n    - ethers\n    - group\n    - hosts\n    - initgroups\n    - netgroup\n    - networks\n    - passwd\n    - protocols\n    - publickey\n    - rpc\n    - services\n    - shadow\n\nMake sure that NIS service is configured and enabled. See NIS documentation for more information.\n\n---------------------------- rocky9 -----------------------------------------------------\n    [root@rocky91-temp ~]#  authselect select sssd with-silent-lastlog --force\nBackup stored at /var/lib/authselect/backups/2022-11-29-06-52-31.9ynbix\n    Profile \"sssd\" was selected.\n    The following nsswitch maps are overwritten by the profile:\n    - passwd\n    - group\n    - netgroup\n    - automount\n    - services\n\nMake sure that SSSD service is configured and enabled. See SSSD documentation for more information.\n\n[root@rocky91-temp ~]# authselect list\n- minimal        Local users only for minimal installations\n    - sssd           Enable SSSD for system authentication (also for local users only)\n- winbind        Enable winbind for system authentication\n    [root@rocky91-temp ~]# authselect current\nProfile ID: sssd\n    Enabled features:\n    - with-silent-lastlog\n    ---------------------------- rocky9 -----------------------------------------------------\n\n[root@92-tmp ~]# yum install -y epel-release\n[root@92-tmp ~]# yum install -y htop iftop sysstat postfix\n[root@92-tmp ~]# yum update -y\n[root@92-tmp ~]# dnf update -y\n[root@92-tmp ~]# yum clean all\n[root@92-tmp ~]# dnf clean all\n# rocky9\u306e\u5834\u5408\u3001\u518d\u8d77\u52d5\u524d\u306bnmcli\u3092\u8a2d\u5b9a\u3059\u308b\n---------------------------- rocky9 -----------------------------------------------------\n    # rocky9.1\u306fNetworkManager\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306b\u306a\u3063\u305f\u3001network-scripts\u304c\u975e\u63a8\u5968\u306b\u306a\u3063\u305f\u3002\u5c06\u6765\u306f\u524a\u9664\u3055\u308c\u308b\u304b\u3082\nnmcli connection delete enp1s0\n    nmcli connection add con-name eth0 ifname eth0 type ethernet\n    # \u9759\u7684\u306eIP\u8a2d\u5b9a\u3059\u308b\u5834\u5408\n# nmcli connection modify eth0 ipv4.method manual\n# nmcli connection modify eth0 ipv4.addresses 10.0.0.30/24\n# nmcli connection modify eth0 ipv4.gateway 10.0.0.1\nnmcli connection modify eth0 ipv4.method auto\n    nmcli connection modify eth0 ipv4.dns \"8.8.8.8 1.1.1.1\"\nnmcli connection modify eth0 ipv4.dns-search test.com\n    nmcli connection down eth0 &amp;&amp; nmcli connection up eth0\n    nmcli device show eth0\n    # IPv6\u3092\u7121\u52b9\u5316\n# nmcli connection modify eth0 ipv6.method \"disabled\" ipv6.addresses \"\" ipv6.gateway \"\"\n---------------------------- rocky9 -----------------------------------------------------\n\n7. reboot\u5f8c\u3001\u65e7\u30ab\u30fc\u30cd\u30eb\u3092\u524a\u9664\n    # \u5fc5\u8981\u306b\u5fdc\u3058\u3066\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n[root@92-tmp ~]# yum remove -y kernel-modules-core-5.14.0-284.11.1.el9_2.x86_64 kernel-core-5.14.0-284.11.1.el9_2.x86_64 kernel-modules-5.14.0-284.11.1.el9_2.x86_64 kernel-5.14.0-284.11.1.el9_2.x86_64\n8. iptables\u306e\u8a2d\u5b9a\n    [root@92-tmp ~]# cat /root/bin/iptables.sh\n#!/bin/sh\nset -e\n\niptables -F\n    iptables -X\n    iptables -P INPUT ACCEPT\n    iptables -P OUTPUT ACCEPT\n    iptables -A INPUT -i lo -j ACCEPT\n    iptables -I INPUT -p icmp --icmp-type 0 -j ACCEPT\n    iptables -I INPUT -p icmp --icmp-type 8 -j ACCEPT\n    iptables -A INPUT -m state --state ESTABLISH,RELATED -j ACCEPT\n\niptables -A INPUT -s 172.16.0.0/12 -j ACCEPT\n    iptables -A INPUT -s 192.168.0.0/16 -j ACCEPT\n\niptables -A INPUT -j DROP\n\n/sbin/iptables-save &gt; /etc/sysconfig/iptables\n\n[root@92-tmp ~]# /root/bin/iptables.sh\n9. fill unused blocks with zero\n   \u7a7a\u304d\u9818\u57df\u306b\u30bc\u30ed\u57cb\u3081\u3057\u3066\u304b\u3089\u3001\u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u6e1b\u3059\u308b\n    # /home\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u304c\u3042\u308b\u5834\u5408\n[root@mysql8-temp ~]# dd if=/dev/zero of=/home/tmpzero.txt\n[root@mysql8-temp ~]# rm -f /home/tmpzero.txt\n# \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u69cb\u6210\u95a2\u4fc2\u306a\u304f\u3001\u5fc5\u8981\u3067\u3059\n[root@mysql8-temp ~]# dd if=/dev/zero of=/tmpzero.txt\n[root@mysql8-temp ~]# rm -f /tmpzero.txt\n[root@localhost ~]# for i in `ls /var/log/anaconda/*.log`\n&gt; do\n&gt; echo &gt; $i\n&gt; done\n[root@localhost ~]# echo &gt; /var/log/anaconda/syslog\n[root@localhost ~]# echo &gt; /var/log/audit/audit.log\n[root@localhost ~]# echo &gt; /var/log/hawkey.log\n[root@localhost ~]# echo &gt; /var/log/messages\n[root@localhost ~]# echo &gt; /var/log/lastlog\n[root@localhost ~]# echo &gt; /var/log/dnf.log\n[root@localhost ~]# echo &gt; /var/log/dnf.rpm.log\n[root@localhost ~]# echo &gt; /var/log/dnf.librepo.log\n[root@localhost ~]# echo &gt; /var/log/boot.log\n[root@localhost ~]# echo &gt; /var/log/cron\n[root@localhost ~]# echo &gt; /var/log/secure\n[root@localhost ~]# echo &gt; /var/log/kdump.log\n[root@localhost ~]# echo &gt; /var/log/wtmp\n[root@localhost ~]# echo &gt; /root/.bash_history\n[root@localhost ~]# history -c\n---------------------------- rocky9 -----------------------------------------------------\n    # \u6700\u5f8c\u306brocky9\u306e\u5834\u5408\u4e0b\u8a18\u306e\u901a\u308a\u306b\u5909\u66f4\n[root@rocky91-temp ~]# cat /etc/udev/rules.d/99-net.rules\nSUBSYSTEM==\"net\", ACTION==\"add\", KERNEL==\"e*\", SUBSYSTEMS==\"pci\", KERNELS==\"0000:00:03.0\", NAME=\"eth0\"\n[root@rocky91-temp ~]#\n---------------------------- rocky9 -----------------------------------------------------\n\n[root@localhost ~]# shutdown -h now\nroot@HV-host# virt-sysprep -d waf92-mini2 --operations defaults,-ssh-userdir,-tmp-files,-ssh-hostkeys,-backup-files,-bash-history,-crash-data,-logfiles,-dhcp-client-state,-dhcp-server-state,-dovecot-data,-firewall-rules,-package-manager-cache,-rpm-db,-samba-db-log\n\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@ # img\u3092\u4f5c\u6210\n@   # time dd if=/dev/tank/92-mini iflag=nocache oflag=nocache,dsync conv=sparse status=progress | zstd --ultra -22 -T48 &gt; /mnt/92-tmp.img.zst\n@ # VM\u306eDISK\u3092\u4f5c\u6210\n@   # virsh vol-create-as tank waf92-test 200G\n@ # VM\u306eimg\u3092\u66f8\u304d\u8fbc\u307f\n@   # time unzstd &lt; /mnt/92-tmp.img.zst  | dd of=/dev/tank/92-test  bs=1M oflag=direct iflag=fullblock status=progress\n@ # VM\u3092define\u3059\u308b\n@   # virsh define /root/work/92-test.xml\n@ # VM\u3092start\n@   # virsh start 92-test\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n\n10. HV\u4e0a\u5bfe\u8c61VM\u306eDISK\u30a4\u30e1\u30fc\u30b8\u3092dd\u3067\u8aad\u307f\u51fa\u3057\u3002\n\u305d\u306e\u307e\u307edd\u306e\u5834\u5408\u306f\u30a4\u30e1\u30fc\u30b8\u30b5\u30a4\u30ba\u304c\u5927\u304d\u304f\u3001\u5f8c\u306e\u4f5c\u696d\u304c\u6642\u9593\u304b\u304b\u308b\u305f\u3081\u3001\u5727\u7e2e\u3057\u3066\u304b\u3089\u5229\u7528\u3059\u308b\u3002\n@ \u5727\u7e2e\u65b9\u6cd5\u306f\u4e0b\u8a18\u306e\u8907\u6570\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3001\u4eca\u56de\u306fzst\u5f0f\u306b\u3059\u308b\n\n########################\n# gzip\n# root@dev:/mnt/# dd if=/dev/tank/rocky8-tmp conv=sparse status=progress | gzip -9 -c &gt; /mnt/rocky8-tmp-nobs.img.gz\n# # gzip \u3067\u4f5c\u6210\u3057\u305fimg\u30b5\u30a4\u30ba\n# -rw-r--r--  1 root         root   5.6G Oct 24 15:04 rocky8-tmp.img.gz\n########################\n########################\n# zstd \u4f5c\u6210\u306b20\u5206\u304b\u304b\u308b\n## iflag=nocache oflag=nocache,dsync\nroot@dev:/mnt/# time dd if=/dev/tank/rocky8-tmp iflag=nocache oflag=nocache,dsync conv=sparse status=progress | zstd --ultra -22 -T8 &gt; /mnt/rocky86-tmp.img.zst\n23302750720 bytes (23 GB, 22 GiB) copied, 577 s, 40.4 MB/s\n46137344+0 records in\n46137344+0 records out\n23622320128 bytes (24 GB, 22 GiB) copied, 577.788 s, 40.9 MB/s\n\nreal    9m49.489s\nuser    19m13.197s\nsys     1m53.357s\nroot@dev:/mnt/#\n-rw-r--r--  1 root         root   1.1G Oct 26 10:43 rocky86-tmp.img.zst\n\n# NO iflag=nocache oflag=nocache,dsync\n## dd if=/dev/tank/rocky8-tmp conv=sparse status=progress | zstd --ultra -22 -T8 &gt; /mnt/rocky8-tmp-new.img.zst\n-rw-r--r--  1 root         root   1.2G Oct 25 14:28 rocky8-tmp-new.img.zst\n########################\n# \u89e3\u51cd 14\u79d2\nroot@dev:/mnt/# date; unzstd rocky8-tmp-new.img.zst ; date\nTue 25 Oct 2022 02:30:39 PM JST\nrocky8-tmp-new.img.zst: 23622320128 bytes\nTue 25 Oct 2022 02:30:54 PM JST\nroot@dev:/mnt/#\n\nroot@dev:/mnt/# time unzstd rocky8-tmp-new.img.zst\nrocky8-tmp-new.img.zst: 23622320128 bytes\n\nreal    0m14.277s\nuser    0m11.656s\nsys     0m2.620s\nroot@dev:/mnt/#\n\n# pigz\nroot@dev:/mnt/# dd if=/dev/tank/rocky8-tmp bs=16MB iflag=nocache oflag=nocache,dsync conv=sparse status=progress | pigz &gt; /mnt/rocky8-tmp-new.img.gz\n# pigz with bs=16MB\n-rw-r--r--  1 root         root   1.5G Oct 25 14:09 rocky8-tmp-new.img.gz\n# pigz with nobs\n-rw-r--r--  1 root         root   1.5G Oct 25 14:12 rocky8-tmp-new.img.gz\n\n# Rocky8.7\n---------------------------- rocky8.7 -----------------------------------------------------\nroot@dev:/mnt/# time dd if=/dev/tank/rocky87-tmp iflag=nocache oflag=nocache,dsync conv=sparse status=progress | zstd --ultra -22 -T8 &gt; /mnt/rocky87-tmp.img.zst\n23403492864 bytes (23 GB, 22 GiB) copied, 337 s, 69.4 MB/s\n46137344+0 records in\n46137344+0 records out\n23622320128 bytes (24 GB, 22 GiB) copied, 337.595 s, 70.0 MB/s\n\nreal    5m45.610s\nuser    10m2.703s\nsys     1m40.576s\nroot@dev:/mnt/#\n-rw-r--r-- 1 root root 544M Nov 25 15:52 rocky87-tmp.img.zst\n---------------------------- rocky8.7 -----------------------------------------------------\n</code></pre> </li> <li> <p>VM\u524a\u9664</p> \u524a\u9664 <pre><code># virsh undefine vm-test\n# virsh destroy vm-test\n# virsh vol-delete /dev/tank/temp-test\n</code></pre> </li> <li> <p>VM\u4f5c\u6210</p> \u4f5c\u6210 <pre><code># virsh vol-create-as tank mysql8-test 500G\n# virsh vol-create-as tank rocky87-test 200G\n# virsh vol-create-as tank rocky91-test 200G\n# gzip\u3067\u89e3\u51cd\ngunzip &lt; /mnt/rocky8-tmp-nobs.img.gz  | dd of=/dev/tank/mysql8-test bs=1M oflag=direct iflag=fullblock status=progress\n\n# zstd\u3067\u89e3\u51cd\u5f8cdd 30\u79d2\n---------------------------- rocky8.7 -----------------------------------------------------\n## rocky8.7\nroot@dev:/mnt/# time unzstd &lt; /mnt/rocky87-tmp.img.zst | dd of=/dev/tank/rocky87-test bs=1M oflag=direct iflag=fullblock status=progress\n23418896384 bytes (23 GB, 22 GiB) copied, 29 s, 808 MB/s\n22528+0 records in\n22528+0 records out\n23622320128 bytes (24 GB, 22 GiB) copied, 29.2385 s, 808 MB/s\n\nreal    0m29.247s\nuser    0m9.207s\nsys     0m13.190s\nroot@dev:/mnt/#\n---------------------------- rocky8.7 -----------------------------------------------------\n\n---------------------------- rocky9.1 -----------------------------------------------------\nroot@dev:/mnt/# time unzstd &lt; /mnt/rocky91-tmp.img.zst  | dd of=/dev/tank/rocky91-test  bs=1M oflag=direct iflag=fullblock status=progress\n23159898112 bytes (23 GB, 22 GiB) copied, 28 s, 827 MB/s\n22528+0 records in\n22528+0 records out\n23622320128 bytes (24 GB, 22 GiB) copied, 28.5436 s, 828 MB/s\n\nreal    0m28.550s\nuser    0m8.246s\nsys     0m13.155s\nroot@dev:/mnt/#\n---------------------------- rocky9.1 -----------------------------------------------------\n\n# zstd\u3067img\u3092\u89e3\u51cd\u306e\u307f 14\u79d2\nroot@dev:/mnt/# time unzstd rocky8-tmp-new.img.zst\nrocky8-tmp-new.img.zst: 23622320128 bytes\n\nreal    0m14.372s\nuser    0m11.808s\nsys     0m2.564s\nroot@dev:/mnt/#\n\n# define\u3059\u308b\n---------------------------- rocky8.7 -----------------------------------------------------\nroot@dev:/mnt/# virsh define /root/work/rocky87-test.xml\nDomain rocky87-test defined from /root/work/rocky87-test.xml\n---------------------------- rocky8.7 -----------------------------------------------------\n\n---------------------------- rocky9.1 -----------------------------------------------------\nroot@dev:/mnt/# virsh define /root/work/rocky91-test.xml\nDomain rocky91-test defined from /root/work/rocky91-test.xml\n---------------------------- rocky9.1 -----------------------------------------------------\n\n# VM\u8d77\u52d5\u3059\u308b\n---------------------------- rocky8.7 -----------------------------------------------------\nroot@dev:/mnt/# virsh start rocky87-test\nDomain rocky87-test started\n---------------------------- rocky8.7 -----------------------------------------------------\n\n---------------------------- rocky9.1 -----------------------------------------------------\nroot@dev:~/work# virsh start rocky91-test\nDomain mysql8-test started\n---------------------------- rocky9.1 -----------------------------------------------------\n</code></pre> </li> <li> <p>\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u62e1\u5f35</p> \u62e1\u5f35 <pre><code># XFS\u306e\u5834\u5408\n[root@localhost ~]# df -h\nFilesystem      Size  Used Avail Use% Mounted on\ndevtmpfs        7.9G     0  7.9G   0% /dev\ntmpfs           7.9G     0  7.9G   0% /dev/shm\ntmpfs           7.9G  8.4M  7.9G   1% /run\ntmpfs           7.9G     0  7.9G   0% /sys/fs/cgroup\n/dev/vda1        12G  1.8G   11G  15% /\n/dev/vda3       2.0G   47M  2.0G   3% /home\ntmpfs           1.6G     0  1.6G   0% /run/user/0\n[root@localhost ~]#\n# XFS\u306e\u5834\u5408\n[root@localhost ~]# yum install -y cloud-utils-growpart\n[root@localhost ~]# fdisk -l\nDisk /dev/vda: 100 GiB, 107374182400 bytes, 209715200 sectors\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: dos\nDisk identifier: 0xbd8df08f\n\nDevice     Boot    Start      End  Sectors Size Id Type\n/dev/vda1  *        2048 25167871 25165824  12G 83 Linux\n/dev/vda2       25167872 41945087 16777216   8G 82 Linux swap / Solaris\n/dev/vda3       41945088 46137343  4192256   2G 83 Linux\n[root@mysql8-temp ~]#\n[root@localhost ~]# growpart /dev/vda 3\nCHANGED: partition=3 start=41945088 old: size=4192256 end=46137344 new: size=167770079 end=209715167\n[root@localhost ~]#\n[root@localhost ~]# xfs_growfs /dev/vda3\nmeta-data=/dev/vda3              isize=512    agcount=4, agsize=131008 blks\n=                       sectsz=512   attr=2, projid32bit=1\n=                       crc=1        finobt=1, sparse=1, rmapbt=0\n=                       reflink=1    bigtime=0 inobtcount=0\ndata     =                       bsize=4096   blocks=524032, imaxpct=25\n=                       sunit=0      swidth=0 blks\nnaming   =version 2              bsize=4096   ascii-ci=0, ftype=1\nlog      =internal log           bsize=4096   blocks=2560, version=2\n=                       sectsz=512   sunit=0 blks, lazy-count=1\nrealtime =none                   extsz=4096   blocks=0, rtextents=0\ndata blocks changed from 524032 to 20971259\n[root@localhost ]#\n# EXT4\u306e\u5834\u5408\n[root@localhost ~]# yum install -y cloud-utils-growpart\n[root@localhost ~]# fdisk  -l\nDisk /dev/vda: 200 GiB, 214748364800 bytes, 419430400 sectors\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: dos\nDisk identifier: 0x89a15b15\n\nDevice     Boot    Start      End  Sectors Size Id Type\n/dev/vda1  *        2048  2099199  2097152   1G 83 Linux\n/dev/vda2        2099200 18876415 16777216   8G 82 Linux swap / Solaris\n/dev/vda3       18876416 41943039 23066624  11G 83 Linux\n\n[root@localhost ~]# growpart /dev/vda 3\nCHANGED: partition=3 start=18876416 old: size=23066624 end=41943039 new: size=400553951 end=419430366\n[root@localhost ~]# resize2fs /dev/vda3\nresize2fs 1.46.5 (30-Dec-2021)\nFilesystem at /dev/vda3 is mounted on /; on-line resizing required\nold_desc_blocks = 2, new_desc_blocks = 24\nThe filesystem on /dev/vda3 is now 50069243 (4k) blocks long.\n\n[root@localhost ~]# df -h\nFilesystem      Size  Used Avail Use% Mounted on\ndevtmpfs        4.0M     0  4.0M   0% /dev\ntmpfs           7.9G     0  7.9G   0% /dev/shm\ntmpfs           3.2G  8.5M  3.2G   1% /run\n/dev/vda3       188G  998M  180G   1% /\n/dev/vda1       974M  142M  766M  16% /boot\ntmpfs           1.6G     0  1.6G   0% /run/user/0\n[root@localhost ~]#\n</code></pre> </li> <li> <p>NetworkManager</p> NetworkManager <pre><code>---------------------------- rocky9.1 -----------------------------------------------------\n\u8a2d\u5b9a\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306f\uff1a\n[root@localhost ~]# cat /etc/NetworkManager/system-connections/eth0.nmconnection\n# rocky9.1\u306fNetworkManager\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306b\u306a\u3063\u305f\u3001network-scripts\u304c\u975e\u63a8\u5968\u306b\u306a\u3063\u305f\u3002\u5c06\u6765\u306f\u524a\u9664\u3055\u308c\u308b\u304b\u3082\nnmcli connection delete enp1s0\nnmcli connection add con-name eth0 ifname eth0 type ethernet\n# \u9759\u7684\u306eIP\u8a2d\u5b9a\u3059\u308b\u5834\u5408\n# nmcli connection modify eth0 ipv4.method manual ipv4.addresses 192.168.1.2/24 ipv4.gateway 192.168.1.1\n# IPv6\u3092\u7121\u52b9\u5316\n# nmcli connection modify eth0 ipv6.method \"disabled\"\n# DHCP\u306e\u5834\u5408\nnmcli connection modify eth0 ipv4.method auto\nnmcli connection modify eth0 ipv6.method \"disabled\"\nnmcli connection modify eth0 ipv4.dns \"8.8.8.8 1.1.1.1\"\nnmcli connection modify eth0 ipv4.dns-search test.com\n# eth0 \u3092\u518d\u8d77\u52d5\nnmcli connection down eth0 &amp;&amp; nmcli connection up eth0\nnmcli device show eth0\n---------------------------- rocky9.1 -----------------------------------------------------\n</code></pre> <ul> <li> <p>\u9759\u7684IP\u8a2d\u5b9a\u5f8c\u306e\u6bd4\u8f03</p> \u6bd4\u8f03 <pre><code>[root@localhost ~]# diff -u eth0.nmconnection /etc/NetworkManager/system-connections/eth0.nmconnection\n--- eth0.nmconnection   2022-11-29 18:19:20.684732142 +0900\n+++ /etc/NetworkManager/system-connections/eth0.nmconnection    2022-11-29 18:20:20.728558114 +0900\n@@ -3,14 +3,15 @@\n uuid=bad7327a-e903-4745-8b96-4772ca1cd706\n type=ethernet\n interface-name=eth0\n-timestamp=1669709213\n+timestamp=1669713472\n[ethernet]\n[ipv4]\n+address1=192.168.1.2/24,192.168.1.1\n dns=8.8.8.8;1.1.1.1;\ndns-search=test.com;\n-method=auto\n+method=manual\n\n[ipv6]\naddr-gen-mode=default\n method=disabled\n[root@localhost ~]#\n</code></pre> </li> </ul> </li> <li> <p>VM\u306e\u4f5c\u6210\u30fb\u524a\u9664</p> \u5c65\u6b74 <pre><code># delete VM\nvirsh undefine rocky92-mini-tmp\nvirsh destroy rocky92-mini-tmp\nvirsh vol-delete /dev/tank/rocky92-mini-tmp\n\n# create VM\nvirsh vol-create-as tank rocky92-mini-tmp 200G\ntime unzstd &lt; /mnt/rocky92-mini-tmp.img.zst | dd of=/dev/tank/rocky92-mini-tmp  bs=1M oflag=direct iflag=fullblock status=progress\nvirsh define /root/work/rocky92-mini-tmp.xml\nvirsh start rocky92-mini-tmp\n\n# setting IP address\n[root@rocky92-mini ~]# cat /etc/NetworkManager/system-connections/eth0.nmconnection\n[connection]\nid=eth0\nuuid=d83faba3-9f08-46f5-8084-341c3bad7138\ntype=ethernet\ninterface-name=eth0\n\n[ethernet]\n[ipv4]\ndns=8.8.8.8;1.1.1.1;\ndns-search=test.com;\nmethod=auto\n\n[ipv6]\naddr-gen-mode=default\nmethod=auto\n\n[proxy]\n[root@rocky92-mini ~]# nmcli connection add con-name eth0 ifname eth0 type ethernet\nWarning: There is another connection with the name 'eth0'. Reference the connection by its uuid '2ea6cb27-a044-4752-a234-d7b745b1113f'\nConnection 'eth0' (2ea6cb27-a044-4752-a234-d7b745b1113f) successfully added.\n\n[root@rocky92-mini ~]# nmcli connection modify eth0 ipv4.method manual ipv4.addresses 192.168.1.2/24 ipv4.gateway 192.168.1.1\nWarning: There is another connection with the name 'eth0'. Reference the connection by its uuid 'd83faba3-9f08-46f5-8084-341c3bad7138'\n[root@rocky92-mini ~]# nmcli connection modify eth0 ipv6.method \"disabled\"\nWarning: There is another connection with the name 'eth0'. Reference the connection by its uuid 'd83faba3-9f08-46f5-8084-341c3bad7138'\n[root@rocky92-mini ~]# cat /etc/NetworkManager/system-connections/eth0.nmconnection\n[connection]\nid=eth0\nuuid=d83faba3-9f08-46f5-8084-341c3bad7138\ntype=ethernet\ninterface-name=eth0\ntimestamp=1684897628\n[ethernet]\n[ipv4]\naddress1=192.168.1.2/24,192.168.1.1\ndns-search=sakura.ne.jp;1.1.1.1;\nmethod=manual\n\n[ipv6]\naddr-gen-mode=default\nmethod=disabled\n\n[proxy]\n[root@rocky92-mini ~]# nmcli connection down eth0 &amp;&amp; nmcli connection up eth0\n</code></pre> </li> <li> <p>HV\u306eVLAN\u3092\u524a\u9664\u3057\u305f\u3044\u5834\u5408</p> \u3053\u306e\u4f5c\u696d\u306f\u614e\u91cd\u306b\u5b9f\u65bd\u304f\u3060\u3055\u3044 <pre><code>1. \u30d6\u30ea\u30c3\u30b8\u78ba\u8a8d\n   - `brctl show`\n2. \u30d6\u30ea\u30c3\u30b8\u914d\u4e0b\u306eIF vlan15 \u3092\u524a\u9664\n   - `brctl delif br0 vlan15`\n3. \u8a72\u5f53\u30d6\u30ea\u30c3\u30b8\u3092down\n   - `ip link set br0 down`\n4. \u8a72\u5f53\u30d6\u30ea\u30c3\u30b8\u3092\u524a\u9664\n   - `brctl delbr br0`\n5. \u30d6\u30ea\u30c3\u30b8\u78ba\u8a8d\n   - `brctl show`\n**\u4eee\u88c5\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u524a\u9664**\n\n1. vlan\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u78ba\u8a8d\n   - `ip a | grep vlan`\n- `ip -s -d addr show dev vlan15`\n2. \u8a72\u5f53\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\n   - `ip link set dev  vlan15 down`\n3. \u8a72\u5f53\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u524a\u9664\n   - `ip link delete vlan15@bond0`  &lt;-- @bond0\u306f\u5fc5\u8981\u306a\u3044\u3002\n   - `ip link delete vlan15`\n4. vlan\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u78ba\u8a8d\n   - `ip a | grep vlan`\n</code></pre> </li> </ol>"},{"location":"linux-lvm/","title":"Linux\u73af\u5883\u4e0b LVM \u903b\u8f91\u5377\u7684\u5efa\u7acb\u3001\u6269\u5bb9\u548c\u51cf\u5bb9\u64cd\u4f5c","text":""},{"location":"linux-lvm/#_1","title":"\u524d\u8a00","text":""},{"location":"linux-lvm/#lvmlogical-volume-managerlinux","title":"LVM\u662f\u903b\u8f91\u76d8\u5377\u7ba1\u7406\uff08Logical Volume Manager\uff09\u7684\u7b80\u79f0\uff0c\u5b83\u662fLinux\u73af\u5883\u4e0b\u5bf9\u78c1\u76d8\u5206\u533a\u8fdb\u884c\u7ba1\u7406\u7684\u4e00\u79cd\u673a\u5236\uff0c","text":"<p>LVM\u662f\u5efa\u7acb\u5728\u786c\u76d8\u548c\u5206\u533a\u4e4b\u4e0a\u7684\u4e00\u4e2a\u903b\u8f91\u5c42\uff0c\u6765\u63d0\u9ad8\u78c1\u76d8\u5206LVM\u533a\u7ba1\u7406\u7684\u7075\u6d3b\u6027\u3002 \u524d\u9762\u8c08\u5230\uff0cLVM\u662f\u5728\u78c1\u76d8\u5206\u533a\u548c\u6587\u4ef6\u7cfb\u7edf\u4e4b\u95f4\u6dfb\u52a0\u7684\u4e00\u4e2a\u903b\u8f91\u5c42\uff0c \u6765\u4e3a\u6587\u4ef6\u7cfb\u7edf\u5c4f\u853d\u4e0b\u5c42\u78c1\u76d8\u5206\u533a\u5e03\u5c40\uff0c\u63d0\u4f9b\u4e00\u4e2a\u62bd\u8c61\u7684\u76d8\u5377\uff0c\u5728\u76d8\u5377\u4e0a\u5efa\u7acb\u6587\u4ef6\u7cfb\u7edf\u3002 \u7269\u7406\u5377\uff08physical volume\uff09\u7269\u7406\u5377\u5c31\u662f\u6307\u786c\u76d8\u5206\u533a\u6216\u4ece\u903b\u8f91\u4e0a\u4e0e\u78c1\u76d8\u5206\u533a\u5177\u6709\u540c\u6837 \u529f\u80fd\u7684\u8bbe\u5907\uff08\u5982RAID\uff09\uff0c\u662fLVM\u7684\u57fa\u672c\u5b58\u50a8\u903b\u8f91\u5757\uff0c\u4f46\u548c\u57fa\u672c\u7684\u7269\u7406\u5b58\u50a8\u4ecb\u8d28 \uff08\u5982\u5206\u533a\u3001\u78c1\u76d8\u7b49\uff09\u6bd4\u8f83\uff0c\u5374\u5305\u542b\u6709\u4e0eLVM\u76f8\u5173\u7684\u7ba1\u7406\u53c2\u6570\u3002 </p>"},{"location":"linux-lvm/#lvm","title":"LVM\u662f\u5728\u78c1\u76d8\u5206\u533a\u548c\u6587\u4ef6\u7cfb\u7edf\u4e4b\u95f4\u6dfb\u52a0\u7684\u4e00\u4e2a\u903b\u8f91\u5c42\uff0c","text":"<p>\u6765\u4e3a\u6587\u4ef6\u7cfb\u7edf\u5c4f\u853d\u4e0b\u5c42\u78c1\u76d8\u5206\u533a\u5e03\u5c40\uff0c\u63d0\u4f9b\u4e00\u4e2a\u62bd\u8c61\u7684\u76d8\u5377\uff0c\u5728\u76d8\u5377\u4e0a\u5efa\u7acb\u6587\u4ef6\u7cfb\u7edf\u3002\u9996\u5148\u6211\u4eec\u8ba8\u8bba\u4ee5\u4e0b\u51e0\u4e2aLVM\u672f\u8bed\uff1a</p> <ul> <li>\u7269\u7406\u5b58\u50a8\u4ecb\u8d28\uff08Thephysicalmedia\uff09</li> <li> <p>\u8fd9\u91cc\u6307\u7cfb\u7edf\u7684\u5b58\u50a8\u8bbe\u5907\uff1a\u786c\u76d8\uff0c\u662f\u5b58\u50a8\u7cfb\u7edf\u6700\u4f4e\u5c42\u7684\u5b58\u50a8\u5355\u5143\u3002</p> </li> <li> <p>\u7269\u7406\u5377\uff08physicalvolume\uff09</p> </li> <li> <p>\u7269\u7406\u5377\u5c31\u662f\u6307\u786c\u76d8\u5206\u533a\u6216\u4ece\u903b\u8f91\u4e0a\u4e0e\u78c1\u76d8\u5206\u533a\u5177\u6709\u540c\u6837\u529f\u80fd\u7684\u8bbe\u5907\uff08\u5982RAID\uff09\uff0c\u662fLVM\u7684\u57fa\u672c\u5b58\u50a8\u903b\u8f91\u5757\uff0c\u4f46\u548c\u57fa\u672c\u7684\u7269\u7406\u5b58\u50a8\u4ecb\u8d28\uff08\u5982\u5206\u533a\u3001\u78c1\u76d8\u7b49\uff09\u6bd4\u8f83\uff0c\u5374\u5305\u542b\u6709\u4e0eLVM\u76f8\u5173\u7684\u7ba1\u7406\u53c2\u6570\u3002</p> </li> <li> <p>\u5377\u7ec4\uff08VolumeGroup\uff09</p> </li> <li> <p>LVM\u5377\u7ec4\u7c7b\u4f3c\u4e8e\u975eLVM\u7cfb\u7edf\u4e2d\u7684\u7269\u7406\u786c\u76d8\uff0c\u5176\u7531\u7269\u7406\u5377\u7ec4\u6210\u3002\u53ef\u4ee5\u5728\u5377\u7ec4\u4e0a\u521b\u5efa\u4e00\u4e2a\u6216\u591a\u4e2a\u201cLVM\u5206\u533a\u201d\uff08\u903b\u8f91\u5377\uff09\uff0cLVM\u5377\u7ec4\u7531\u4e00\u4e2a\u6216\u591a\u4e2a\u7269\u7406\u5377\u7ec4\u6210\u3002</p> </li> <li> <p>\u903b\u8f91\u5377\uff08logicalvolume\uff09</p> </li> <li> <p>LVM\u7684\u903b\u8f91\u5377\u7c7b\u4f3c\u4e8e\u975eLVM\u7cfb\u7edf\u4e2d\u7684\u786c\u76d8\u5206\u533a\uff0c\u5728\u903b\u8f91\u5377\u4e4b\u4e0a\u53ef\u4ee5\u5efa\u7acb\u6587\u4ef6\u7cfb\u7edf\uff08\u6bd4\u5982/home\u6216\u8005/usr\u7b49\uff09\u3002</p> </li> <li> <p>PE\uff08physicalextent\uff09</p> </li> <li> <p>\u6bcf\u4e00\u4e2a\u7269\u7406\u5377\u88ab\u5212\u5206\u4e3a\u79f0\u4e3aPE(PhysicalExtents\uff09\u7684\u57fa\u672c\u5355\u5143\uff0c\u5177\u6709\u552f\u4e00\u7f16\u53f7\u7684PE\u662f\u53ef\u4ee5\u88abLVM\u5bfb\u5740\u7684\u6700\u5c0f\u5355\u5143\u3002PE\u7684\u5927\u5c0f\u662f\u53ef\u914d\u7f6e\u7684\uff0c\u9ed8\u8ba4\u4e3a4MB\u3002</p> </li> <li> <p>LE\uff08logicalextent\uff09</p> </li> <li>\u903b\u8f91\u5377\u4e5f\u88ab\u5212\u5206\u4e3a\u88ab\u79f0\u4e3aLE(LogicalExtents\uff09\u7684\u53ef\u88ab\u5bfb\u5740\u7684\u57fa\u672c\u5355\u4f4d\u3002\u5728\u540c\u4e00\u4e2a\u5377\u7ec4\u4e2d\uff0cLE\u7684\u5927\u5c0f\u548cPE\u662f\u76f8\u540c\u7684\uff0c\u5e76\u4e14\u4e00\u4e00\u5bf9\u5e94\u3002</li> </ul>"},{"location":"linux-lvm/#_2","title":"\u5b9e\u9a8c\u90e8\u5206","text":""},{"location":"linux-lvm/#_3","title":"\u5efa\u7acb\u903b\u8f91\u5377","text":"<ol> <li>\u65b0\u5efa2\u4e2a\u5206\u533a,sda5  5G,sd6 10G,\u5b8c\u6210\u4e4b\u540e\u5982\u4e0b</li> </ol> <pre><code>[root@yangcan /]# fdisk -l\nDisk /dev/sda: 42.9 GB, 42949672960 bytes\n255 heads, 63 sectors/track, 5221 cylinders\nUnits = cylinders of 16065 * 512 = 8225280 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk identifier: 0x000ed173\n   Device Boot      Start         End      Blocks   Id  System\n/dev/sda1   *           1          39      307200   83  Linux\nPartition 1 does not end on cylinder boundary.\n/dev/sda2              39        2167    17091584   83  Linux\n/dev/sda3            2167        2611     3571712   82  Linux swap / Solaris\n/dev/sda4            2611        5221    20966162+   5  Extended\n/dev/sda5            2611        3264     5246528+  83  Linux\n/dev/sda6            3265        4570    10490413+  83  Linux\n</code></pre> <ol> <li>\u628asda6\u521d\u59cb\u5316\u7269\u7406\u5377</li> </ol> <pre><code>[root@yangcan /]# pvcreate /dev/sda6\n  Device vg6 not found (or ignored by filtering).\n  Writing physical volume data to disk \"/dev/sda6\"\n  Physical volume \"/dev/sda6\" successfully created\n</code></pre> <ol> <li>\u521b\u5efa\u5377\u7ec4vg6,PE\u4e3a16M</li> </ol> <pre><code>[root@yangcan /]# vgcreate -s 16M vg6 /dev/sda6\n  Volume group \"vg6\" successfully created\n\n[root@yangcan /]# vgdisplay\n  --- Volume group ---\n  VG Name               vg6\n  System ID\n  Format                lvm2\n  Metadata Areas        1\n  Metadata Sequence No  1\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                0\n  Cur LV                0\n  Open LV               0\n  Max PV                0\n  Cur PV                1\n  Act PV                1\n  VG Size               10.00 GiB\n  PE Size               16.00 MiB\n  Total PE              640\n  Alloc PE / Size       0 / 0\n  Free  PE / Size       640 / 10.00 GiB\n  VG UUID               35tmMm-Hyec-i4f1-xkd7-pMRS-RgRl-sqFa7l\n</code></pre> <ol> <li>\u521b\u5efa\u903b\u8f91\u5377ftpdata,\u5927\u5c0f\u4e3a6G</li> </ol> <pre><code>[root@yangcan /]# lvcreate -L 6G -n ftpdata vg6\n  Logical volume \"ftpdata\" created\n\n[root@yangcan /]# lvdisplay\n  --- Logical volume ---\n  LV Name                /dev/vg6/ftpdata\n  VG Name                vg6\n  LV UUID                LSOtbB-k3mz-DVbb-ATcE-IhBk-V9B7-uaSStM\n  LV Write Access        read/write\n  LV Status              available\n  # open                 0\n  LV Size                6.00 GiB\n  Current LE             384\n  Segments               1\n  Allocation             inherit\n  Read ahead sectors     auto\n  - currently set to     256\n  Block device           253:0\n</code></pre> <ol> <li>\u683c\u5f0f\u5316ext4,\u5e76\u6302\u8f7d,\u5e76cp\u4e00\u4e9b\u6570\u636e\u8fdb\u53bb</li> </ol> <pre><code>[root@yangcan /]# mke2fs -T ext4 /dev/vg6/ftpdata\n[root@yangcan /]# mount /dev/vg6/ftpdata /ftpdata/\n[root@yangcan /]# cd /ftpdata/\n[root@yangcan ftpdata]# cp /etc/*.conf ./\n[root@yangcan ftpdata]# cp /usr/share/dict/linux.words ./\n</code></pre>"},{"location":"linux-lvm/#_4","title":"\u6269\u5bb9","text":"<ol> <li>\u65b0\u589e\u4e00\u4e2a\u78c1\u76d8\u5230\u5377\u7ec4vg6,\u5c31\u7528\u5230\u4e4b\u524d\u5269\u4e0b\u7684sda5\u4e86</li> </ol> <pre><code>[root@yangcan ftpdata]# vgextend vg6 /dev/sda5\n  Volume group \"vg6\" successfully extended\n\n[root@yangcan ftpdata]# vgdisplay\n  --- Volume group ---\n  VG Name               vg6\n  System ID\n  Format                lvm2\n  Metadata Areas        2\n  Metadata Sequence No  3\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                0\n  Cur LV                1\n  Open LV               1\n  Max PV                0\n  Cur PV                2\n  Act PV                2\n  VG Size               15.00 GiB\n  PE Size               16.00 MiB\n  Total PE              960\n  Alloc PE / Size       384 / 6.00 GiB\n  Free  PE / Size       576 / 9.00 GiB\n  VG UUID               35tmMm-Hyec-i4f1-xkd7-pMRS-RgRl-sqFa7l\n</code></pre> <ol> <li>\u6269\u5bb9ftpdata,\u5f53\u6211\u4eec\u6587\u4ef6\u4e0d\u6bb5\u589e\u52a0\u7684\u65f6\u5019,\u6269\u5bb9\u5c31\u5f88\u6709\u5fc5\u8981\u4e86</li> </ol> <pre><code>[root@yangcan ftpdata]# lvextend -L +4G /dev/vg6/ftpdata\n\n\u6216\u8005\u4f7f\u7528,\u5c31\u662f\u60f3\u8ba9\u4f60\u660e\u767d-L \u548c -L +\u7684\u533a\u522b,-L \u540e\u9762\u76f4\u63a5\u52a0\u5bb9\u91cf,\u662f\u6307\u76f4\u63a5\u52a0\u5230\u5bb9\u91cf,\u800c-L +\u5bb9\u91cf,\u662f\u6307\u5728\u539f\u6709\u5bb9\u91cf\u4e0a\u52a0\u591a\u5c11\u5bb9\u91cf!\n\n[root@yangcan ftpdata]# lvextend -L 10G /dev/vg6/ftpdata\n  Extending logical volume ftpdata to 10.00 GiB\n  Logical volume ftpdata successfully resized\n\n[root@yangcan ftpdata]# lvdisplay\n  --- Logical volume ---\n  LV Name                /dev/vg6/ftpdata\n  VG Name                vg6\n  LV UUID                LSOtbB-k3mz-DVbb-ATcE-IhBk-V9B7-uaSStM\n  LV Write Access        read/write\n  LV Status              available\n  # open                 1\n  LV Size                10.00 GiB\n  Current LE             640\n  Segments               1\n  Allocation             inherit\n  Read ahead sectors     auto\n  - currently set to     256\n  Block device           253:0\n\n[root@yangcan ftpdata]# df -h|grep ftpdata\n/dev/mapper/vg6-ftpdata\n                      6.0G  145M  5.5G   3% /ftpdata\n\n\u6b64\u65f6\u67e5\u770bftpdata\u6587\u4ef6\u7cfb\u7edf\u5bb9\u91cf\u7684\u65f6\u5019,\u8fd8\u662f\u4e4b\u524d\u7684\u5927\u5c0f,\u6240\u4ee5\u9700\u8981resize2fs\n\n[root@yangcan ftpdata]# resize2fs /dev/vg6/ftpdata\nresize2fs 1.41.12 (17-May-2010)\nFilesystem at /dev/vg6/ftpdata is mounted on /ftpdata; on-line resizing required\nold desc_blocks = 1, new_desc_blocks = 1\nPerforming an on-line resize of /dev/vg6/ftpdata to 2621440 (4k) blocks.\nThe filesystem on /dev/vg6/ftpdata is now 2621440 blocks long.\n\n[root@yangcan ftpdata]# df -h|grep ftpdata\n/dev/mapper/vg6-ftpdata\n                      9.9G  147M  9.3G   2% /ftpdata\n\n[root@yangcan ftpdata]# lvdisplay\n  --- Logical volume ---\n  LV Name                /dev/vg6/ftpdata\n  VG Name                vg6\n  LV UUID                LSOtbB-k3mz-DVbb-ATcE-IhBk-V9B7-uaSStM\n  LV Write Access        read/write\n  LV Status              available\n  # open                 1\n  LV Size                10.00 GiB\n  Current LE             640\n  Segments               1\n  Allocation             inherit\n  Read ahead sectors     auto\n  - currently set to     256\n  Block device           253:0\n\n\u73b0\u5728\u5c31\u6587\u4ef6\u7cfb\u7edf\u548c\u903b\u8f91\u5377\u7a7a\u95f4\u4e00\u81f4\u4e86\n</code></pre>"},{"location":"linux-lvm/#_5","title":"\u7f29\u5bb9","text":"<p>\u6269\u5bb9\u5b9e\u9a8c\u505a\u5b8c\u4e86,\u63a5\u4e0b\u6765\u505a\u7f29\u5bb9,\u7f29\u5bb9\u6bd4\u6269\u5bb9\u590d\u6742,\u5e73\u65f6\u5de5\u4f5c\u4e5f\u4e0d\u80fd\u8f7b\u6613\u7684\u6307\u5b9a\u7f29\u5bb9\u7684\u5927\u5c0f.</p> <pre><code>[root@yangcan ftpdata]# cd ..\n[root@yangcan /]# umount /ftpdata/\n[root@yangcan /]# e2fsck -f /dev/vg6/ftpdata\ne2fsck 1.41.12 (17-May-2010)\nPass 1: Checking inodes, blocks, and sizes\nPass 2: Checking directory structure\nPass 3: Checking directory connectivity\nPass 4: Checking reference counts\nPass 5: Checking group summary information\n/dev/vg6/ftpdata: 41/655360 files (0.0% non-contiguous), 78604/2621440 blocks\n</code></pre> <p>\u6ce8\u610f:\u6211\u4eec\u5927\u6982\u8981\u7f29\u52306G\u5de6\u53f3,\u90a3\u6211\u4eec\u5c31\u4e0d\u80fd\u76f4\u63a5resize2fs \u52306G,\u8fd9\u6837\u80af\u5b9a\u662f\u9519\u8bef\u7684,\u56e0\u4e3aPE\u662f\u53ef\u4ee5\u88abLVM\u5bfb\u5740\u7684\u6700\u5c0f\u5355\u5143,\u672c\u6b21\u5b9e\u9a8cPE\u5927\u5c0f\u4e3a16M.\u6211\u4eec\u53bb\u505a\u7f29\u5bb9\u7684\u65f6\u5019,\u4e0d\u53ef\u80fd\u662f0.6\u4e2aPE.\u6240\u6709\u5c24\u5176\u6ce8\u610f,\u7f51\u4e0a\u5f88\u591a\u8d44\u6599\u5c31\u662f\u76f4\u63a5\u6307\u5b9a\u5927\u5c0f,\u800c\u6ca1\u6709\u505a\u6d4b\u8bd5\u73af\u8282!!!\u4f1a\u9020\u6210\u6570\u636e\u7684\u4e22\u5931,\u6240\u4ee5\u6307\u5b9a\u5927\u5c0f\u65f6,\u5148\u7528lvreduce -t \u6d4b\u8bd5\u4e00\u4e0b.\u7528bc\u7b97\u51fa6G\u7684\u4f4d\u7f6e,\u5230\u5e95\u90a3\u4e2a\u503c\u5408\u9002</p> <pre><code>[root@yangcan /]# bc\nbc 1.06.95\nCopyright 1991-1994, 1997, 1998, 2000, 2004, 2006 Free Software Foundation, Inc.\nThis is free software with ABSOLUTELY NO WARRANTY.\nFor details type `warranty'.\n--6000\u521a\u597d\u6574\u966416\n6000%16\n0\n--6001\u966416\u4e3a1\n6001%16\n1\n5999%16\n15\n--\u521a\u597d6000M,\u53d6\u4f59\u4e3a0,\u6211\u4eec\u6bd4\u8f83\u4e00\u4e0b6001\u548c6000\u7684\u533a\u522b\n\n[root@yangcan /]# lvreduce -L 6001M /dev/vg6/ftpdata -t\n  Test mode: Metadata will NOT be updated and volumes will not be (de)activated.\n  Rounding up size to full physical extent 5.88 GiB\n  WARNING: Reducing active logical volume to 5.88 GiB\n  THIS MAY DESTROY YOUR DATA (filesystem etc.)\nDo you really want to reduce ftpdata? [y/n]: n\n  Logical volume ftpdata NOT reduced\n\u663e\u793a\u4e86\u8b66\u544a\u4fe1\u606f!\n\n[root@yangcan /]# lvreduce -L 6000M /dev/vg6/ftpdata -t\n  Test mode: Metadata will NOT be updated and volumes will not be (de)activated.\n  WARNING: Reducing active logical volume to 5.86 GiB\n  THIS MAY DESTROY YOUR DATA (filesystem etc.)\nDo you really want to reduce ftpdata? [y/n]:\n\n\u63d0\u793a\u4e3a6000M\u662f,\u6ca1\u95ee\u9898\n\u5f53-t \u6d4b\u8bd5\u65f6,\u6ca1\u95ee\u9898\u4e86,\u90a3\u6211\u4eec\u5c31resize2fs\u4e86\n\n[root@yangcan /]# resize2fs /dev/vg6/ftpdata 6000M\nresize2fs 1.41.12 (17-May-2010)\nResizing the filesystem on /dev/vg6/ftpdata to 1536000 (4k) blocks.\nThe filesystem on /dev/vg6/ftpdata is now 1536000 blocks long.\n\u6302\u8f7d,\u67e5\u770b\u6587\u4ef6\u7cfb\u7edf\u7684\u5927\u5c0f,\u4e3a\u6700\u65b0\u76846000M,\u6570\u636e\u4e5f\u6ca1\u6709\u4e22\u5931!!\n\n[root@yangcan /]# mount -a\n[root@yangcan /]# df -h\nFilesystem            Size  Used Avail Use% Mounted on\n/dev/sda2              17G  2.1G   14G  14% /\ntmpfs                 504M  264K  504M   1% /dev/shm\n/dev/sda1             291M   31M  246M  11% /boot\n/dev/sr0              2.9G  2.9G     0 100% /media/cdrom\n/dev/mapper/vg6-ftpdata  5.8G  145M  5.4G   3% /ftpdata\n\n\u6211\u4eec\u7528lvdisplay\u67e5\u770b\u4e00\u4e0b\u903b\u8f91\u5377\u7684\u5927\u5c0f\u8fd8\u662f\u4e3a10G\n\n[root@yangcan /]# lvdisplay\n  --- Logical volume ---\n  LV Name                /dev/vg6/ftpdata\n  VG Name                vg6\n  LV UUID                LSOtbB-k3mz-DVbb-ATcE-IhBk-V9B7-uaSStM\n  LV Write Access        read/write\n  LV Status              available\n  # open                 1\n  LV Size                10.00 GiB\n  Current LE             640\n  Segments               1\n  Allocation             inherit\n  Read ahead sectors     auto\n  - currently set to     256\n  Block device           253:0\n\n\u6240\u4ee5\u6211\u4eec\u7528lvreduce\u8fdb\u884c\u8c03\u6574!\n\n[root@yangcan /]# lvreduce -L 6000M /dev/vg6/ftpdata\n  WARNING: Reducing active and open logical volume to 5.86 GiB\n  THIS MAY DESTROY YOUR DATA (filesystem etc.)\nDo you really want to reduce ftpdata? [y/n]: n\n  Logical volume ftpdata NOT reduced\n\n--\u63d0\u793a\u903b\u8f91\u5377\u6b63\u5728\u6253\u5f00,\u6240\u6709\u6211\u4eec\u9700\u8981\u505c\u6b62\u903b\u8f91\u5377,\u518d\u53bb\u8c03\u6574\u5927\u5c0f\n\n[root@yangcan /]# lvchange -an /dev/vg6/ftpdata\n[root@yangcan /]# lvscan\n  inactive          '/dev/vg6/ftpdata' [10.00 GiB] inherit\n\n[root@yangcan /]# lvreduce -L 6000M /dev/vg6/ftpdata\n  Reducing logical volume ftpdata to 5.86 GiB\n  Logical volume ftpdata successfully resized\n\n[root@yangcan /]# mount -a\nmount: special device /dev/vg6/ftpdata does not exist\n\n--\u5f53\u6211\u4eec\u53bb\u6302\u8f7d\u7684\u65f6\u5019,\u63d0\u793a\u6ca1\u6709\u8fd9\u4e2a\u8bbe\u5907.\u6240\u4ee5\u9700\u8981\u542f\u7528\n\n[root@yangcan /]# lvchange -ay /dev/vg6/ftpdata\n[root@yangcan /]# lvscan\n  ACTIVE            '/dev/vg6/ftpdata' [5.86 GiB] inherit\n\n\u91cd\u65b0\u6302\u8f7d,\u91cc\u9762\u7684\u6587\u4ef6\u8fd8\u5728!\n\n[root@yangcan /]# mount -a\n[root@yangcan /]# cd /ftpdata/\n[root@yangcan ftpdata]# ll\ntotal 4996\n-rw-r--r--. 1 root root     148 Jul 30 19:37 asound.conf\n-rw-r--r--. 1 root root   21214 Jul 30 19:37 dnsmasq.conf\n-rw-r--r--. 1 root root     559 Jul 30 19:37 dracut.conf\n-rw-r--r--. 1 root root      20 Jul 30 19:37 fprintd.conf\n-rw-r--r--. 1 root root       0 Jul 30 19:37 gai.conf\n-rw-------. 1 root root     781 Jul 30 19:37 grub.conf\n-rw-r--r--. 1 root root       9 Jul 30 19:37 host.conf\n-rw-r--r--. 1 root root    5309 Jul 30 19:37 kdump.conf\n</code></pre> <p>ps: \u4f60\u4e5f\u53ef\u4ee5\u4e0d\u505a-t\u6d4b\u8bd5,\u76f4\u63a5\u6307\u5b9a\u5927\u5c0f\u53bb\u7f29\u5bb9,\u770b\u6570\u636e\u662f\u5426\u8fd8\u5728?</p>"},{"location":"linux-lvm/#_6","title":"\u79fb\u9664\u7269\u7406\u5377","text":"<ul> <li>\u79fb\u9664\u4e4b\u524d,\u7269\u7406\u5377\u91cc\u9762\u5fc5\u987b\u6ca1\u6709\u6570\u636e,\u7528\u4e0b\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\u5404\u7269\u7406\u5377\u7684\u7a7a\u95f4\u5927\u5c0f.\u8ba1\u5212\u662f\u5426\u6709\u8db3\u591f\u7684\u7a7a\u95f4\u53ef\u4ee5\u88ab\u7528\u6765\u79fb\u52a8\u6570\u636e!</li> <li> <p><code>[root@yangcan Desktop]# pvscan</code></p> </li> <li> <p>\u642c\u79fb\u8981\u79fb\u9664\u7269\u7406\u5377\u7684\u6570\u636e\u5230\u5176\u4ed6\u7a7a\u95f2\u4e14\u6ee1\u8db3\u5927\u5c0f\u7684\u7269\u7406\u5377</p> </li> <li> <p><code>[root@yangcan Desktop]# pvmove /dev/sda6 /dev/sda7</code> \u5b8c\u6210\u4e4b\u540e</p> </li> <li> <p>\u4ece\u5377\u7ec4\u79fb\u9664\u7269\u7406\u5377</p> </li> <li><code>[root@yangcan Desktop]#vgchange -an vg5</code></li> <li><code>[root@yangcan Desktop]# vgreduce vg5 /dev/sda6</code></li> </ul>"},{"location":"lvm-snapshot/","title":"lvm-snapshot","text":"<ul> <li>https://documentation.suse.com/ja-jp/sles/12-SP4/html/SLES-all/cha-lvm-snapshots.html</li> </ul>"},{"location":"lvm-snapshot/#snapshot","title":"snapshot\u3092\u4f5c\u6210","text":"<pre><code>root@:/mnt/test# lvcreate --name=sn1_mysql --snapshot --size=150G /dev/tank/mysql8-test\n  Logical volume \"sn1_mysql\" created.\nroot@:/mnt/test# lvcreate --name=sn1_rocky87 --snapshot --size=150G /dev/tank/rocky87-test\n  Logical volume \"sn1_rocky87\" created.\nroot@:/mnt/test# lvcreate --name=sn1_rocky91 --snapshot --size=150G /dev/tank/rocky91-test\n  Logical volume \"sn1_rocky91\" created.\n\nroot@:/mnt/test# lvs\n  LV            VG   Attr       LSize   Pool Origin       Data%  Meta%  Move Log Cpy%Sync Convert\n  mysql8-test   tank owi-aos--- 500.00g\n  rocky8-tmp    tank -wi-a-----  22.00g\n  rocky87-test  tank owi-aos--- 200.00g\n  rocky87-tmp   tank -wi-a-----  22.00g\n  rocky91-test  tank owi-aos--- 200.00g\n  rocky91-tmp   tank -wi-a-----  22.00g\n  ryu           tank -wi-ao---- 500.00g\n  sn1_mysql     tank swi-a-s--- 150.00g      mysql8-test  0.01\n  sn1_rocky87   tank swi-a-s--- 150.00g      rocky87-test 0.01\n  sn1_rocky91   tank swi-a-s--- 150.00g      rocky91-test 0.00\n  ubuntu-mysql8 tank -wi-a----- 400.00g\n  ubuntu22-tmp  tank -wi-a-----  22.00g\nroot@:/mnt/test#\n</code></pre>"},{"location":"lvm-snapshot/#snapshot_1","title":"snapshot\u3092\u524a\u9664","text":"<pre><code>root@:/mnt/test# lvremove /dev/tank/mysql_snap\nDo you really want to remove and DISCARD active logical volume tank/mysql_snap? [y/n]: y\n  Logical volume \"mysql_snap\" successfully removed\nroot@:/mnt/test#\n</code></pre>"},{"location":"lvm-snapshot/#snapshot-rename","title":"snapshot rename","text":"<pre><code>lvrename /dev/tank/sn1_rocky91 /dev/tank/sn1207_rocky91\n</code></pre>"},{"location":"lvm-snapshot/#snapshot_2","title":"snapshot\u3092\u623b\u3059","text":"<ul> <li>lvconvert \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3001\u30d5\u30a7\u30a4\u30eb\u30d0\u30c3\u30af\u3057\u307e\u3059\u3002\u306a\u304a\u3001\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067 tank/sn1207_mysql \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u30dc\u30ea\u30e5\u30fc\u30e0\u306f\u524a\u9664\u3055\u308c\u307e\u3059\u3002</li> <li>lvconvert --merge vg00/lvol1_snap</li> <li>https://access.redhat.com/documentation/ja-jp/red_hat_enterprise_linux/7/html/logical_volume_manager_administration/snapshot_merge</li> </ul> <pre><code>root@:/mnt/test# lvs\n  LV             VG   Attr       LSize   Pool Origin       Data%  Meta%  Move Log Cpy%Sync Convert\n  mysql8-test    tank owi-aos--- 500.00g\n  rocky8-tmp     tank -wi-a-----  22.00g\n  rocky87-test   tank owi-aos--- 200.00g\n  rocky87-tmp    tank -wi-a-----  22.00g\n  rocky91-test   tank owi-aos--- 200.00g\n  rocky91-tmp    tank -wi-a-----  22.00g\n  ryu            tank -wi-ao---- 500.00g\n  sn1207_mysql   tank swi-a-s--- 150.00g      mysql8-test  0.97\n  sn1207_rocky87 tank swi-a-s--- 150.00g      rocky87-test 0.67\n  sn1207_rocky91 tank swi-a-s--- 150.00g      rocky91-test 0.08\n  ubuntu-mysql8  tank -wi-a----- 400.00g\n  ubuntu22-tmp   tank -wi-a-----  22.00g\n\nroot@:/mnt/test# vgs\n  VG   #PV #LV #SN Attr   VSize  VFree\ntank   1  12   3 wz--n- &lt;3.39t 1.10t\n\nroot@:/mnt/test# lvconvert --merge tank/sn1207_mysql\n  Merging of volume tank/sn1207_mysql started.\n  tank/mysql8-test: Merged: 99.03%\n  tank/mysql8-test: Merged: 100.00%\nroot@:/mnt/test#\n\nroot@:/mnt/test# lvs\n  LV             VG   Attr       LSize   Pool Origin       Data%  Meta%  Move Log Cpy%Sync Convert\n  mysql8-test    tank -wi-a----- 500.00g\n  rocky8-tmp     tank -wi-a-----  22.00g\n  rocky87-test   tank owi-aos--- 200.00g\n  rocky87-tmp    tank -wi-a-----  22.00g\n  rocky91-test   tank owi-aos--- 200.00g\n  rocky91-tmp    tank -wi-a-----  22.00g\n  ryu            tank -wi-ao---- 500.00g\n  sn1207_rocky87 tank swi-a-s--- 150.00g      rocky87-test 0.67\n  sn1207_rocky91 tank swi-a-s--- 150.00g      rocky91-test 0.08\n  ubuntu-mysql8  tank -wi-a----- 400.00g\n  ubuntu22-tmp   tank -wi-a-----  22.00g\nroot@:/mnt/test#\n</code></pre>"},{"location":"lvm-snapshot/#_1","title":"\u826f\u3044\u8a18\u4e8b\u306e\u305f\u3081\u3001\u8ee2\u8f09\u3057\u307e\u3059\u3002","text":"<ul> <li>https://qiita.com/TsutomuNakamura/items/a68377952d07397db448</li> </ul>"},{"location":"lvm-snapshot/#_2","title":"\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306b\u3064\u3044\u3066","text":"<p>\u3053\u3053\u3067\u306f\u3001\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304c\u3069\u306e\u3088\u3046\u306b\u4fbf\u5229\u306a\u306e\u304b\u3001\u305d\u3057\u3066\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u3069\u306e\u3088\u3046\u306b\u4f5c\u6210\u3001\u4f7f\u7528\u3059\u308b\u304b\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3066\u3044\u304d\u307e\u3059\u3002 \u3053\u3053\u3067\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u3092\u60f3\u5b9a\u3057\u305f\u4f7f\u7528\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3066\u3044\u304d\u307e\u3059\u3002</p>"},{"location":"lvm-snapshot/#_3","title":"\u4e00\u8cab\u6027\u306e\u3042\u308b\u72b6\u614b\u306e\u4fdd\u6301","text":"<p>\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u53d6\u5f97\u6642\u70b9\u306e\u30c7\u30fc\u30bf\u306e\u72b6\u614b\u3092\u305d\u306e\u307e\u307e\u4fdd\u7ba1\u3059\u308b\u3088\u3046\u306a\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u306b\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u6bce\u65e5AM02:00 \u6642\u70b9\u3067DB \u30c7\u30fc\u30bf\u3092\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3068\u3057\u3066\u53d6\u5f97\u3057\u3066\u304a\u304f\u3053\u3068\u3067\u3001\u305d\u306e\u65e5\u306eAM02:00 \u6642\u70b9\u306e\u30c7\u30fc\u30bf\u3092\u305d\u306e\u307e\u307e\u306e\u72b6\u614b\u3067\u30c7\u30fc\u30bf\u3092\u4fdd\u6301\u3057\u3066\u304a\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306f\u30aa\u30ea\u30b8\u30ca\u30eb\u30dc\u30ea\u30e5\u30fc\u30e0\u53c8\u306f\u3001\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u3044\u305a\u308c\u304b\u304c\u7834\u640d\u3059\u308b\u3068\u72b6\u614b\u306e\u5fa9\u65e7\u304c\u3067\u304d\u306a\u304f\u306a\u308b\u306e\u3067\u3001\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3068\u306f\u547c\u3073\u3065\u3089\u3044(\u500b\u4eba\u7684\u4e3b\u89b3)</p>"},{"location":"lvm-snapshot/#_4","title":"\u30d5\u30a7\u30a4\u30eb\u30d0\u30c3\u30af","text":"<p>\u4f55\u304b\u51e6\u7406\u3092\u884c\u3063\u3066\u5931\u6557\u3057\u305f\u6642\u306b\u30d5\u30a7\u30a4\u30eb\u30d0\u30c3\u30af\u3092\u3059\u308b\u76ee\u7684\u3067\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u53d6\u5f97\u3057\u3066\u304a\u304f\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001\u4eca\u307e\u3067\u554f\u984c\u306a\u304f\u52d5\u3044\u3066\u3044\u305f\u306e\u306b\u3001\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u3057\u305f\u9014\u7aef\u306b\u554f\u984c\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u3001\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u53d6\u5f97\u3057\u3066\u3044\u305f\u6642\u70b9\u306b\u623b\u308b\u3053\u3068\u3067\u3001\u72b6\u614b\u306e\u5207\u308a\u623b\u3057\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <p>\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306f\u3053\u308c\u3089\u4ee5\u5916\u306b\u3082\u7528\u9014\u306f\u3042\u308a\u307e\u3059\u304c\u3001\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u7528\u306e\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u3068\u30aa\u30ea\u30b8\u30ca\u30eb\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u5206\u3051\u3066\u3001\u30c0\u30a6\u30f3\u30bf\u30a4\u30e0\u306a\u3057\u306b\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u306e\u53d6\u5f97\u3092\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u4f5c\u696d\u3092\u6b62\u3081\u308b\u5fc5\u8981\u304c\u306a\u304f\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"macOS%E8%BD%AF%E4%BB%B6%E7%BC%96%E8%AF%91%E6%97%B6%E6%89%BE%E4%B8%8D%E5%88%B0%E5%A4%B4%E6%96%87%E4%BB%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95-%E6%9B%B4%E6%96%B010-15/","title":"macOS\u8f6f\u4ef6\u7f16\u8bd1\u65f6\u627e\u4e0d\u5230\u5934\u6587\u4ef6\u89e3\u51b3\u65b9\u6cd5[\u66f4\u65b010.15]","text":"<ul> <li>\u5143URL</li> </ul>"},{"location":"megacli/","title":"Megacli\u306e\u57fa\u672c\u64cd\u4f5c","text":"<p>StorCLI_RefMan_revf PDF</p>"},{"location":"megacli/#smart","title":"Smart\u8868","text":"\u9805\u76eeID \u9805\u76ee\u540d \u8a73\u7d30\u306a\u8aac\u660e 01 Raw Read Error Rate \u3053\u306e\u9805\u76ee\u306f\u30cf\u30fc\u30c9\u30c7\u30a3\u30b9\u30af\u304b\u3089\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u3080\u6642\u306b\u767a\u751f\u3057\u305f\u30a8\u30e9\u30fc\u306e\u5272\u5408\u3092\u8868\u3059\u3002\u6570\u5024\u304c\u95be\u5024\u3088\u308a\u4f4e\u3044\u5834\u5408\u3001\u30cf\u30fc\u30c9\u30c7\u30a3\u30b9\u30af\u5185\u306e\u78c1\u6c17\u30c7\u30a3\u30b9\u30af\u307e\u305f\u306f\u78c1\u6c17\u30d8\u30c3\u30c9\u306b\u7570\u5e38\u304c\u3042\u308b\u3002 05 Reallocated Sectors Count \u4ee3\u66ff\u51e6\u7f6e\uff08\u30c7\u30fc\u30bf\u3092\u7279\u5225\u306b\u4e88\u7d04\u3057\u305f\u4e88\u5099\u30a8\u30ea\u30a2\u306b\u79fb\u52d5\u3059\u308b\uff09\u3092\u65bd\u3055\u308c\u305f\u4e0d\u826f\u30bb\u30af\u30bf\u306e\u6570\u3002 C5(197) Current Pending Sector Count \u73fe\u5728\u7570\u5e38\u304c\u3042\u308a\u3001\u4ee3\u66ff\u51e6\u7406\u3092\u5f85\u3064\u30bb\u30af\u30bf\u306e\u7dcf\u6570\u3002\u3082\u3057\u5f8c\u3067\u8aad\u307f\u8fbc\u307f\u306b\u6210\u529f\u3057\u305f\u30bb\u30af\u30bf\u304c\u3042\u308c\u3070\u3001\u3053\u306e\u5024\u306f\u6e1b\u5c11\u3059\u308b\u3002 C6(198) Off-Line Scan Uncorrectable Sector Count \u30aa\u30d5\u30e9\u30a4\u30f3\u30b9\u30ad\u30e3\u30f3\u6642\u306b\u767a\u898b\u3055\u308c\u305f\u3001\u56de\u5fa9\u4e0d\u53ef\u80fd\u306a\u30bb\u30af\u30bf\u306e\u7dcf\u6570\u3002\u3053\u306e\u5024\u304c\u5897\u52a0\u3059\u308b\u5834\u5408\u306f\u3001\u78c1\u6c17\u30c7\u30a3\u30b9\u30af\u306e\u8868\u9762\u306b\u660e\u78ba\u306a\u554f\u984c\u304c\u3042\u308b\u3002 <pre><code>Media Error\u4ee3\u8868\u6247\u533a\u6709\u95ee\u9898\uff0c\u574f\u9053\u7b49\uff1b\nOther Error\u4ee3\u8868\u78c1\u76d8\u53ef\u80fd\u6709\u677e\u52a8\u3002\n\nMedia Error Count: 0\nOther Error Count: 0\n</code></pre>"},{"location":"megacli/#megaraidhdd","title":"MegaRAID\u304c\u8a8d\u8b58\u3057\u3066\u3044\u308bHDD\u3092\u5168\u8868\u793a\u3059\u308b\u65b9\u6cd5","text":"<pre><code>$ sudo MegaCli64 -PDList -aALL\n$ sudo MegaCli64 -CfgDsply -aALL   \u2190 RAID\u30ab\u30fc\u30c9\u3082\u8868\u793a\u3059\u308b\u3002\n</code></pre>"},{"location":"megacli/#smartctl","title":"smartctl","text":"<pre><code>smartctl -a -d sat+megaraid,&lt;Device Id&gt; /dev/sda | egrep ' ^(Ser|  [15]|19[78]|#)'\nfor i in $(/usr/local/sbin/MegaCli -PDList -aALL -NoLog | grep 'Device Id' | awk '{ print $NF }') ; do echo \"===== Device Id $i =====\" ; /usr/sbin/smartctl -a -d sat+megaraid,$i /dev/sda | egrep ' ^(Ser|  [15]|19[78]|#)' ; echo ; done\n</code></pre>"},{"location":"megacli/#megacli","title":"Megacli","text":"<pre><code># MegaCli -xxx -yyy[&lt;Enclosure Device ID&gt;:&lt;Slot Number&gt;] -a0\n</code></pre>"},{"location":"megacli/#hdd","title":"HDD\u3092\u30ea\u30d3\u30eb\u30c9\u3059\u308b\u624b\u9806","text":"<pre><code>1.\n#\u5bfe\u8c61\u30c7\u30a3\u30b9\u30af\u306e\u30aa\u30d5\u30e9\u30a4\u30f3\n/opt/MegaRAID/MegaCli/MegaCli64 -PDOffline -PhysDrv[252:0] -a0\nAdapter: 0: EnclId-252 SlotId-0 state changed to OffLine.\nExit Code: 0x00\n\n2.\n#status\u78ba\u8a8d\n/opt/MegaRAID/MegaCli/MegaCli64 -PDList -a0 | less\nFirmware state: Offline  \u2190 offline\u306b\u306a\u3063\u3066\u308b\u3002\n\n3.\n#\u5bfe\u8c61\u306e\u30c7\u30a3\u30b9\u30af\u306bmissing mark\u3064\u3051\u308b\n# Enclosure Device ID: 252\n# Slot Number: 0\n\n# /opt/MegaRAID/MegaCli/MegaCli64 -PDMarkMissing -PhysDrv[&lt;Enclosure Device ID&gt;:&lt;Slot Number&gt;] -a0\n\n/opt/MegaRAID/MegaCli/MegaCli64 -PDMarkMissing -PhysDrv[252:0] -a0\nEnclId-252 SlotId-0 is marked Missing.\nExit Code: 0x00\n\n4.\n#missing mark\u306e\u3064\u3044\u305fdisk\u306e\u78ba\u8a8d\n/opt/MegaRAID/MegaCli/MegaCli64 -PDGetMissing -aALL\n    Adapter 0 - Missing Physical drives\n    No.   Array   Row   Size Expected\n    0     0       0     1907200 MB\n\n5.\n#\u524a\u9664\u524d\u306e\u6e96\u5099\n/opt/MegaRAID/MegaCli/MegaCli64 -PDPrpRmv -PhysDrv[252:0] -a0\nPrepare for removal Success\nExit Code: 0x00\n\n6.\n#Missing mark\u306e\u72b6\u614b\u5909\u66f4\n/opt/MegaRAID/MegaCli/MegaCli64 -PDReplaceMissing -PhysDrv[252:0] -Array1 -row0 -a0\n\n7.\n#Rebuild\u30b9\u30bf\u30fc\u30c8\n/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -Start -PhysDrv[252:0] -a0\n\n8.\n#\u72b6\u614b\u78ba\u8a8d\n/opt/MegaRAID/MegaCli/MegaCli64 -PDList -a0 | less\nFirmware state: Rebuild   \u2190 rebuild\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u306a\u3063\u305f\n\n9.\n#Rebuild\u306e\u72b6\u6cc1\u78ba\u8a8d\n/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -showprog -physdrv[252:0] -a0\nRebuild Progress on Device at Enclosure 252, Slot 0 Completed 4% in 11 Minutes.\nExit Code: 0x00\n</code></pre>"},{"location":"megacli/#hdd_1","title":"HDD\u3092\u5f37\u5236\u30ea\u30d3\u30eb\u30c9\u3059\u308b\u624b\u9806","text":"<ol> <li>\u73fe\u72b6\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002<ul> <li> \u30b9\u30c6\u30fc\u30bf\u30b9\u78ba\u8a8d <pre><code>$ MegaCli64 -PDInfo -PhysDrv [xxx:xx] -a0 | grep Firmware\n</code></pre> </li> </ul> </li> <li>\u30b9\u30c6\u30fc\u30bf\u30b9\u3092Unconfigured(good)\u3078\u5909\u66f4\u3057\u307e\u3059\u3002<ul> <li> Unconfigured(good)\u3078\u5909\u66f4 <pre><code>$ MegaCli64 -PDMakeGood -PhysDrv [xxx:xx] -a0\n</code></pre> </li> </ul> </li> <li>\u5909\u66f4\u5f8c\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002<ul> <li> \u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u78ba\u8a8d <pre><code>$ MegaCli64 -PDInfo -PhysDrv [xxx:xx] -a0 | grep Firmware\nFirmware state: Unconfigured(good), Spun Up  \u2190 \u3053\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3002\n</code></pre> </li> </ul> </li> <li>Missing\u72b6\u614b\u306e\u30c7\u30a3\u30b9\u30af\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002<ul> <li> \u30c7\u30a3\u30b9\u30af\u3092\u78ba\u8a8d <pre><code>$ MegaCli64 -PDGetMissing -a0\n   Adapter 0 - Missing Physical drives\n\nNo.   Array   Row   Size Expected\n   0     Y       Z     953344 MB\n         \u2191Y\u53ca\u3073Z\u306f\u6570\u5b57\u3067\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n</code></pre> </li> </ul> </li> <li>Missing\u306e\u72b6\u614b\u3092\u6539\u5584\u3059\u308b\u305f\u3081\u3001\u5b9f\u30b9\u30ed\u30c3\u30c8\u60c5\u5831\u3092\u7d10\u4ed8\u3051\u307e\u3059\u3002<ul> <li>\u6ce8\u610f!! slot\u60c5\u5831\u3001array\u3001row\u306e\u5024\u3092\u9593\u9055\u3048\u308b\u3068\u30c7\u30fc\u30bf\u5168\u640d\u3057\u307e\u3059!!</li> <li> \u5b9f\u30b9\u30ed\u30c3\u30c8\u60c5\u5831\u3092\u7d10\u4ed8\u3051 <pre><code>$ MegaCli64 -PdReplaceMissing -PhysDrv [xxx:xx] -arrayY -rowZ -a0\n\n# \u4f8b\n$ MegaCli -PdReplaceMissing -PhysDrv [252:2] -array1 -row0 -a0\n\nAdapter: 0: Missing PD at Array 1, Row 0 is replaced.\n\nExit Code: 0x00\n</code></pre> </li> </ul> </li> <li>\u30b9\u30c6\u30fc\u30bf\u30b9\u304coffline\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002<ul> <li> offline\u3092\u78ba\u8a8d <pre><code>$ MegaCli64 -PDInfo -PhysDrv [xxx:xx] -a0 | grep Firmware\nFirmware state: Offline\n\n# \u4f8b\n$ storcli /c0/e252/s2 show\n----------------------------------------------------------------------------------------\nEID:Slt DID State DG       Size Intf Med SED PI SeSz Model                      Sp Type\n----------------------------------------------------------------------------------------\n252:2     2 Offln  0 893.750 GB SATA SSD N   N  512B SAMSUNG MZ7GE960HMHP-00003 U  -\n----------------------------------------------------------------------------------------\n</code></pre> </li> </ul> </li> <li>\u30ea\u30d3\u30eb\u30c9\u3092\u958b\u59cb\u3057\u307e\u3059\u3002<ul> <li> \u30ea\u30d3\u30eb\u30c9\u3092\u958b\u59cb <pre><code>$ MegaCli64 -PDRbld -Start -PhysDrv [xxx:xx] -a0\n\n# \u4f8b\n$ MegaCli -PDRbld -Start -PhysDrv [252:2] -a0\nStarted rebuild progress on device(Encl-252 Slot-2)\n$root@mysql-os1a-sv136:~# storcli /c0/e252/s2 show\n----------------------------------------------------------------------------------------\nEID:Slt DID State DG       Size Intf Med SED PI SeSz Model                      Sp Type\n----------------------------------------------------------------------------------------\n252:2     2 Rbld   0 893.750 GB SATA SSD N   N  512B SAMSUNG MZ7GE960HMHP-00003 U  -\n----------------------------------------------------------------------------------------\n</code></pre> </li> </ul> </li> <li>\u30ea\u30d3\u30eb\u30c9\u9032\u6357\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002<ul> <li> \u30ea\u30d3\u30eb\u30c9\u9032\u6357\u3092\u78ba\u8a8d <pre><code>$ MegaCli -PDRbld -showprog -physdrv[252:2] -a0\n\nRebuild Progress on Device at Enclosure 252, Slot 2 Completed 5% in 0 Minutes.\n\nExit Code: 0x00\n\n# \u4f8b\n$ storcli /c0/e252/s2 show rebuild\n------------------------------------------------------\nDrive-ID    Progress% Status      Estimated Time Left\n------------------------------------------------------\n/c0/e252/s2         8 In progress 58 Minutes\n------------------------------------------------------\n</code></pre> </li> </ul> </li> </ol>"},{"location":"megacli/#raid","title":"RAID\u304c\u5197\u9577\u306b\u306a\u3063\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3059\u308b\u65b9\u6cd5","text":"<pre><code>$ sudo MegaCli64 -LDInfo -Lall -aALL\n$ sudo MegaCli64 -LDInfo -Lall -aALL | grep -i state\n</code></pre> <p>\u2460\u25c6 State: Optimal \u3092\u78ba\u8a8d </p> <pre><code>for i in $(sudo /usr/local/sbin/MegaCli -PDList -aALL -NoLog | grep 'Device Id' | awk '{ print $NF }') ; do echo \"===== Device Id $i =====\" ; sudo /usr/sbin/smartctl -a -d sat+megaraid,$i /dev/sda | egrep ' ^(Ser|  [15]|19[78]|#)' ; echo ; done\n</code></pre>"},{"location":"megacli/#display-virtual-drive-information","title":"Display Virtual Drive Information","text":"<pre><code>root@www101v:~# MegaCli64 -LDInfo -Lall -aALL \n\nAdapter 0 -- Virtual Drive Information:\nVirtual Disk: 0 (Target Id: 0)\nName:\nRAID Level: Primary-1, Secondary-0, RAID Level Qualifier-0\nSize:931.0 GB\nState: Degraded    &lt;-- \u3053\u3053\nStripe Size: 64 KB\nNumber Of Drives:2\nSpan Depth:1\nDefault Cache Policy: WriteBack, ReadAheadNone, Cached, Write Cache OK if Bad BBU\nCurrent Cache Policy: WriteBack, ReadAheadNone, Cached, Write Cache OK if Bad BBU\nAccess Policy: Read/Write\nDisk Cache Policy: Enabled\nEncryption Type: None\nBad Blocks Exist: No\n\nExit Code: 0x00\n</code></pre>"},{"location":"megacli/#display-drive-information","title":"Display Drive Information","text":"<pre><code>root@www101v:~# MegaCli64 -PDList -aALL\n\nAdapter #0\n\nEnclosure Device ID: 252\nSlot Number: 0\nDevice Id: 2\nSequence Number: 2\nMedia Error Count: 0\nOther Error Count: 0\nPredictive Failure Count: 0\nLast Predictive Failure Event Seq Number: 0\nPD Type: SATA\nRaw Size: 931.512 GB [0x74706db0 Sectors]\nNon Coerced Size: 931.012 GB [0x74606db0 Sectors]\nCoerced Size: 931.0 GB [0x74600000 Sectors]\nFirmware state: Online, Spun Up\nSAS Address(0): 0x4433221103000000\nConnected Port Number: 0(path0) \nInquiry Data:      WD-WMATV5217983WDC WD1002FBYS-50A6B0                   03.00C09\nFDE Capable: Not Capable\nFDE Enable: Disable\nSecured: Unsecured\nLocked: Unlocked\nForeign State: None \nDevice Speed: 3.0Gb/s \nLink Speed: 3.0Gb/s \nMedia Type: Hard Disk Device\nDrive:  Not Certified\n</code></pre>"},{"location":"megacli/#rebuild","title":"Rebuild \u9032\u6357\u78ba\u8a8d","text":"<ul> <li>\u9759\u7684</li> </ul> <pre><code>root@www101v:~# MegaCli64 -PDRbld -ShowProg -PhysDrv[252:1] -aALL\n\nRebuild Progress on Device at Enclosure 252, Slot 1 Completed 16% in 24 Minutes.\n\nExit Code: 0x00\n</code></pre> <ul> <li>Real Time</li> </ul> <pre><code>root@www101v:~# MegaCli64 -PDRbld -ProgDsply -PhysDrv[252:1] -aALL\n      Rebuild progress of physical drives...\n\n  Enclosure:Slot               Percent Complete                       Time Elps\n       252 :01     ########***************17 %*********************** 00:26:56 \n\n    Press &lt;ESC&gt; key to quit...\n</code></pre>"},{"location":"megacli/#_1","title":"\u30ad\u30e3\u30c3\u30b7\u30e5\u8a2d\u5b9a\u65b9\u6cd5","text":"<p>RAID\u30ab\u30fc\u30c9\u306e\u66f8\u304d\u8fbc\u307f\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u8a2d\u5b9a </p> <pre><code>\uff1cWrite \u30b9\u30eb\u30fc\uff1e\nMegaCli -LDSetProp WT -Lall -Aall\n\uff1cWrite \u30d0\u30c3\u30af\uff1e\nMegaCli -LDSetProp WB -Lall -Aall\n</code></pre> <p>RAID\u30ab\u30fc\u30c9\u306e\u8aad\u307f\u8fbc\u307f\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u8a2d\u5b9a  <pre><code>\uff1cNo read ahead\uff1e\nMegaCli -LDSetProp NORA -Lall -Aall\n\uff1cRead ahead\uff1e\nMegaCli -LDSetProp RA -Lall -Aall\n\uff1cAdaptive read ahead\uff1e\nMegaCli -LDSetProp ADRA -Lall -Aall\n</code></pre></p> <p>RAID\u30ab\u30fc\u30c9\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30dd\u30ea\u30b7\u30fc\u306e\u8a2d\u5b9a  <pre><code>\uff1cChached\uff1e\nMegaCli -LDSetProp -Cached -Lall -aALL\n\uff1cDirect\uff1e\nMegaCli -LDSetProp -Direct -Lall -aALL\n</code></pre></p> <p>BBU\u30e6\u30cb\u30c3\u30c8\u304c\u4e0d\u826f\u306e\u5834\u5408\u306b\u66f8\u304d\u8fbc\u307f\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4f7f\u3046\u304b\u3069\u3046\u304b </p> <pre><code>\uff1cCachedBadBBU\uff1a\u66f8\u304d\u8fbc\u307f\u30ad\u30e3\u30c3\u30b7\u30e5\u6709\u52b9\uff1e\nMegaCli  -LDSetProp -CachedBadBBU -Lall -Aall\n\uff1cNoCachedBadBBU\uff1a\u66f8\u304d\u8fbc\u307f\u30ad\u30e3\u30c3\u30b7\u30e5\u7121\u52b9\uff1e\nMegaCli  -LDSetProp -NoCachedBadBBU -Lall -Aall\n</code></pre> <p>\u30c9\u30e9\u30a4\u30d6\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u6709\u52b9\u306b\u3059\u308b\u304b\u3069\u3046\u304b </p> <pre><code>\uff1cEnables drive cache\uff1a\u6709\u52b9\uff1e\nMegaCli -LDSetProp -EnDskCache -Lall -Aall\n\uff1cDisables drive cache\uff1a\u7121\u52b9\uff1e\nMegaCli -LDSetProp -DisDskCache -Lall -Aall\n</code></pre> <p>\u30ad\u30e3\u30c3\u30b7\u30e5\u8a2d\u5b9a\u78ba\u8a8d\u65b9\u6cd5</p> <ul> <li>RAID\u30ab\u30fc\u30c9\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u8a2d\u5b9a\u78ba\u8a8d </li> </ul> <pre><code># MegaCli -LDGetProp -Cache -Lall -aALL\n\nAdapter 0-VD 0(target id: 0): Cache Policy:WriteThrough, ReadAheadNone, Direct, No Write Cache if bad BBU\n\nExit Code: 0x00\n</code></pre> <ul> <li>\u30c9\u30e9\u30a4\u30d6\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u8a2d\u5b9a\u78ba\u8a8d </li> </ul> <pre><code># MegaCli -LDGetProp -DskCache -Lall -aALL\n\nAdapter 0-VD 0(target id: 0): Disk Write Cache : Disabled\n\nExit Code: 0x00\n</code></pre>"},{"location":"megacli/#fwtermlog-grep-rebuild","title":"Fwtermlog\u3092\u8868\u793a\u3059\u308b\u65b9\u6cd5 | grep Rebuild","text":"<pre><code>[iadmin@xxxx ~]$ sudo MegaCli64 -Fwtermlog -Dsply -aall | grep Rebuild\nT5:     disableAutoRebuild=0, disableBatteryWarning=0, eccBucketSize=ff\n02/01/15  6:05:01: EVT#02934-02/01/15  6:05:01: 106=Rebuild automatically started on PD 01(e0x20/s1)\n02/01/15  6:05:03: prDiskCheckOkToRun: PR cannot run on this pd=0 since this array=1 has a PD in REBUILD state Rebuilding\n02/01/15  7:43:01: EVT#02936-02/01/15  7:43:01: 103=Rebuild progress on PD 01(e0x20/s1) is 0.99%(5880s)\n02/01/15  9:21:28: EVT#02937-02/01/15  9:21:28: 103=Rebuild progress on PD 01(e0x20/s1) is 1.99%(11787s)\n02/01/15 10:59:38: EVT#02938-02/01/15 10:59:38: 103=Rebuild progress on PD 01(e0x20/s1) is 2.99%(17677s)\n02/01/15 12:37:13: EVT#02939-02/01/15 12:37:13: 103=Rebuild progress on PD 01(e0x20/s1) is 3.99%(23532s)\n02/01/15 14:15:49: EVT#02940-02/01/15 14:15:49: 103=Rebuild progress on PD 01(e0x20/s1) is 4.99%(29448s)\n02/01/15 15:54:18: EVT#02941-02/01/15 15:54:18: 103=Rebuild progress on PD 01(e0x20/s1) is 5.99%(35357s)\n02/01/15 17:31:16: EVT#02942-02/01/15 17:31:16: 103=Rebuild progress on PD 01(e0x20/s1) is 6.99%(41175s)\n02/01/15 19:07:32: EVT#02943-02/01/15 19:07:32: 103=Rebuild progress on PD 01(e0x20/s1) is 7.99%(46951s)\n02/01/15 20:44:02: EVT#02944-02/01/15 20:44:02: 103=Rebuild progress on PD 01(e0x20/s1) is 8.99%(52741s)\n02/01/15 22:20:47: EVT#02945-02/01/15 22:20:47: 103=Rebuild progress on PD 01(e0x20/s1) is 9.99%(58546s)\n02/01/15 23:57:46: EVT#02946-02/01/15 23:57:46: 103=Rebuild progress on PD 01(e0x20/s1) is 10.99%(64365s)\n02/02/15  1:35:11: EVT#02947-02/02/15  1:35:11: 103=Rebuild progress on PD 01(e0x20/s1) is 11.99%(4674s)\n02/02/15  3:12:39: EVT#02948-02/02/15  3:12:39: 103=Rebuild progress on PD 01(e0x20/s1) is 12.99%(10522s)\n02/02/15  4:49:15: EVT#02949-02/02/15  4:49:15: 103=Rebuild progress on PD 01(e0x20/s1) is 13.99%(16318s)\n02/02/15  6:26:01: EVT#02950-02/02/15  6:26:01: 103=Rebuild progress on PD 01(e0x20/s1) is 14.99%(22124s)\n02/02/15  8:02:22: EVT#02951-02/02/15  8:02:22: 103=Rebuild progress on PD 01(e0x20/s1) is 15.99%(27905s)\n02/02/15  9:39:34: EVT#02952-02/02/15  9:39:34: 103=Rebuild progress on PD 01(e0x20/s1) is 16.99%(33737s)\n02/02/15 11:16:58: EVT#02953-02/02/15 11:16:58: 103=Rebuild progress on PD 01(e0x20/s1) is 17.99%(39581s)\n02/02/15 12:54:33: EVT#02954-02/02/15 12:54:33: 103=Rebuild progress on PD 01(e0x20/s1) is 18.98%(45436s)\n02/02/15 14:24:59: EVT#02955-02/02/15 14:24:59: 103=Rebuild progress on PD 01(e0x20/s1) is 19.98%(50862s)\n02/02/15 16:02:28: EVT#02956-02/02/15 16:02:28: 103=Rebuild progress on PD 01(e0x20/s1) is 20.98%(56711s)\n02/02/15 17:39:07: EVT#02957-02/02/15 17:39:07: 103=Rebuild progress on PD 01(e0x20/s1) is 21.98%(62510s)\n</code></pre>"},{"location":"megacli/#slot-numberfirmware-stateinquiry-dataraw-sizedevice-id","title":"\"^Slot Number|^Firmware state|^Inquiry Data|^Raw Size|^Device Id\" \u3092\u8868\u793a\u3059\u308b","text":"<pre><code>root@ubuntu14:/home/lyvivian# megacli -PDList -aALL | egrep \"^Slot Number|^Firmware state|^Inquiry Data|^Raw Size|^Device Id\"\nSlot Number: 0                                                                                                                                                                                                                               \nDevice Id: 6                                                                                                                                                                                                                                 \nRaw Size: 465.761 GB [0x3a386030 Sectors]                                                                                                                                                                                                    \nFirmware state: Online, Spun Up                                                                                                                                                                                                              \nInquiry Data: S313J9FF103173      ST500LM012 HN-M500MBB                   2BA30010                                                                                                                                                           \nSlot Number: 1                                                                                                                                                                                                                               \nDevice Id: 5                                                                                                                                                                                                                                 \nRaw Size: 29.843 GB [0x3bb0000 Sectors]                                                                                                                                                                                                      \nFirmware state: Online, Spun Up                                                                                                                                                                                                              \nInquiry Data: 00257465041E        TS32GSSD25S-M                           V090216                                                                                                                                                            \nSlot Number: 2                                                                                                                                                                                                                               \nDevice Id: 4                                                                                                                                                                                                                                 \nRaw Size: 298.090 GB [0x2542eab0 Sectors]                                                                                                                                                                                                    \nFirmware state: Online, Spun Up                                                                                                                                                                                                              \nInquiry Data:      WD-WXE508HD9898WDC WD3200BEVT-75ZCT1                   11.01A11                                                                                                                                                           \nSlot Number: 3                                                                                                                                                                                                                               \nDevice Id: 11                                                                                                                                                                                                                                \nRaw Size: 59.625 GB [0x7740ab0 Sectors]                                                                                                                                                                                                      \nFirmware state: Online, Spun Up                                                                                                                                                                                                              \nInquiry Data: 0000000011210310A638M4-CT064M4SSD2                          000F                                                                                                                                                               \nSlot Number: 4                                                                                                                                                                                                                               \nDevice Id: 7                                                                                                                                                                                                                                 \nRaw Size: 1.819 TB [0xe8e088b0 Sectors]                                                                                                                                                                                                      \nFirmware state: Online, Spun Up                                                                                                                                                                                                              \nInquiry Data:      WD-WCC1T0228569WDC WD20EZRX-00DC0B0                    80.00A80                                                                                                                                                           \nSlot Number: 5                                                                                                                                                                                                                               \nDevice Id: 9                                                                                                                                                                                                                                 \nRaw Size: 1.819 TB [0xe8e088b0 Sectors]                                                                                                                                                                                                      \nFirmware state: Online, Spun Up                                                                                                                                                                                                              \nInquiry Data:      WD-WMC301755889WDC WD20EZRX-00DC0B0                    80.00A80                                                                                                                                                           \nSlot Number: 6                                                                                                                                                                                                                               \nDevice Id: 8                                                                                                                                                                                                                                 \nRaw Size: 1.819 TB [0xe8e088b0 Sectors]                                                                                                                                                                                                      \nFirmware state: Online, Spun Up                                                                                                                                                                                                              \nInquiry Data:      WD-WMC301755597WDC WD20EZRX-00DC0B0                    80.00A80                                                                                                                                                           \nSlot Number: 7                                                                                                                                                                                                                               \nDevice Id: 10                                                                                                                                                                                                                                \nRaw Size: 1.819 TB [0xe8e088b0 Sectors]                                                                                                                                                                                                      \nFirmware state: Online, Spun Up                                                                                                                                                                                                              \nInquiry Data:      WD-WMC301744569WDC WD20EZRX-00DC0B0                    80.00A80                                                                                                                                                           \nroot@ubuntu14:/home/lyvivian# \n</code></pre>"},{"location":"megacli/#usage","title":"Usage","text":"<pre><code># cd /opt/MegaRAID/storcli\n# ./storcli64 \n</code></pre> <ul> <li>information about every controller</li> <li> <p><code>./storcli64 show</code></p> </li> <li> <p>informations to selected controller and its configuration</p> </li> <li> <p><code>./storcli64 /c0 show</code></p> </li> <li> <p>informations to the available hard drives and their current state (Serial Number, temperature )</p> </li> <li> <p><code>./storcli64 /c0 /eall /sall show [all]</code></p> </li> <li> <p>informations to the available virtual drives and their current state.</p> </li> <li> <p><code>./storcli64 /c0 /vall show [all]</code></p> </li> <li> <p>show the progress of ongoing rebuilds</p> </li> <li> <p><code>./storcli64 /c0 /eall /sall show rebuild</code></p> </li> <li> <p>create a RAID 1</p> </li> <li> <p><code>./storcli64 /c0 add vd type=raid1 size=10gb names=tmp1 drives=0:2-3</code></p> </li> <li> <p>create a RAID 5</p> </li> <li> <p><code>./storcli64 /c0 add vd type=raid5 size=10gb names=tmp1 drives=0:2-6</code></p> </li> <li> <p>create a RAID 6</p> </li> <li> <p><code>./storecli64 /c0 add vd type=raid6 size=10gb names=tmp1 drives=0:2-7</code></p> </li> <li> <p>create a RAID 10</p> </li> <li><code>./storecli64 /c0 add vd type=raid10 size=2gb,3gb,4gb names=tmp1,tmp2,tmp3 drives=0:2-3,5,7 pdperarray=2</code></li> </ul>"},{"location":"megacli/#manual","title":"Manual","text":"<p>There is a manual with all the usable parameters provided by avagotech (the succsessor of the producer LSI) to be found here.</p>"},{"location":"megacli/#controller-overview-in-detail","title":"controller overview in detail","text":"<p>information regarding every controller</p> <ul> <li><code>./storecli64 show</code></li> </ul> <pre><code># ./storcli64 show\n\n... SNIPP ...\n\nSystem Overview :\n===============\n---------------------------------------------------------------------------------------------------\nCtl Model                                  Ports PDs DGs DNOpt VDs VNOpt BBU sPR DS  EHS ASOs Hlth \n---------------------------------------------------------------------------------------------------\n  0 Intel(R)IntegratedRAIDModuleRMS25CB080     8   2   1     0   1     0 Opt On  1&amp;2 Y      3 Opt  \n---------------------------------------------------------------------------------------------------\n</code></pre>"},{"location":"megacli/#configuration-overview","title":"configuration overview","text":"<p>information regarding the selected controller and its configuration</p> <ul> <li><code>./storecli64 /c0 show</code></li> </ul> <pre><code># ./storcli64 /c0 show\nGenerating detailed summary of the adapter, it may take a while to complete.\n\n... SNIPP ...\n\nProduct Name = Intel(R) Integrated RAID Module RMS25CB080\nSerial Number = QSIP23600494\nSAS Address =  5001e6756eda0000\nPCI Address = 00:05:00:00\nSystem Time = 01/25/2016 14:34:15\nMfg. Date = 09/07/12\nController Time = 01/25/2016 13:34:14\nFW Package Build = 23.12.0-0013\nBIOS Version = 5.42.00_4.12.05.00_0x05270000\nFW Version = 3.240.25-2382\nDriver Name = megaraid_sas\nDriver Version = 06.805.06.01-rc1\nVendor Id = 0x1000\nDevice Id = 0x5B\nSubVendor Id = 0x8086\nSubDevice Id = 0x3513\nHost Interface = PCI-E\nDevice Interface = SAS-6G\nBus Number = 5\nDevice Number = 0\nFunction Number = 0\nDrive Groups = 1\n\nTOPOLOGY :\n========\n--------------------------------------------------------------------------\nDG Arr Row EID:Slot DID Type  State BT       Size PDC  PI SED DS3  FSpace \n--------------------------------------------------------------------------\n 0 -   -   -        -   RAID1 Optl  N  930.390 GB dflt N  N   none N      \n 0 0   -   -        -   RAID1 Optl  N  930.390 GB dflt N  N   none N      \n 0 0   0   252:0    8   DRIVE Onln  N  930.390 GB dflt N  N   none -      \n 0 0   1   252:1    9   DRIVE Onln  N  930.390 GB dflt N  N   none -      \n--------------------------------------------------------------------------\n\n... SNIPP ...\n\nVirtual Drives = 1\n\nVD LIST :\n=======\n---------------------------------------------------------------\nDG/VD TYPE  State Access Consist Cache Cac sCC       Size Name \n---------------------------------------------------------------\n0/0   RAID1 Optl  RW     No      RWBC  -   ON  930.390 GB      \n---------------------------------------------------------------\n\n... SNIPP ...\n\nPhysical Drives = 2\n\nPD LIST :\n=======\n-------------------------------------------------------------------------------\nEID:Slt DID State DG       Size Intf Med SED PI SeSz Model                  Sp \n-------------------------------------------------------------------------------\n252:0     8 Onln   0 930.390 GB SATA HDD N   N  512B WDC WD1000CHTZ-04JCPV1 U  \n252:1     9 Onln   0 930.390 GB SATA HDD N   N  512B WDC WD1000CHTZ-04JCPV1 U  \n-------------------------------------------------------------------------------\n\n... SNIPP ...\n\nCachevault_Info :\n===============\n---------------------------------------------------------\nModel  State   Temp Mode MfgDate    Next Learn           \n---------------------------------------------------------\nCVPM02 Optimal 23C  -    2012/12/19 2016/02/22  13:07:20 \n---------------------------------------------------------\n</code></pre>"},{"location":"megacli/#information-regarding-the-disks","title":"Information regarding the disks","text":"<p>Information regarding the available disks and their current state (serial number,temperature etc.)</p> <pre><code># ./storecli64 /c0 /eall /sall show all\nController = 0\nStatus = Success\nDescription = Show Drive Information Succeeded.\n\nDrive /c0/e252/s0 :\n=================\n-------------------------------------------------------------------------------\nEID:Slt DID State DG       Size Intf Med SED PI SeSz Model                  Sp \n-------------------------------------------------------------------------------\n252:0     8 Onln   0 930.390 GB SATA HDD N   N  512B WDC WD1000CHTZ-04JCPV1 U  \n-------------------------------------------------------------------------------\n\n... SNIPP ...\n\nDrive /c0/e252/s0 - Detailed Information :\n========================================\n\nDrive /c0/e252/s0 State :\n=======================\nShield Counter = 0\nMedia Error Count = 0\nOther Error Count = 0\nBBM Error Count = 0\nDrive Temperature =  29C (84.20 F)\nPredictive Failure Count = 0\nS.M.A.R.T alert flagged by drive = No\n\nDrive /c0/e252/s0 Device attributes :\n===================================\nSN =      WD-WXS1E64JNL0D\nManufacturer Id = ATA     \nModel Number = WDC WD1000CHTZ-04JCPV1\nNAND Vendor = NA\nWWN = 50014ee65a68f4c4\nFirmware Revision = 04.06A01\nRaw size = 931.512 GB [0x74706db0 Sectors]\nCoerced size = 930.390 GB [0x744c8000 Sectors]\nNon Coerced size = 931.012 GB [0x74606db0 Sectors]\nDevice Speed = 6.0Gb/s\nLink Speed = 6.0Gb/s\nNCQ setting = N/A\nWrite cache = N/A\nLogical Sector Size = 512B\nPhysical Sector Size = 4 KB\nConnector Name = Port 0 - 3 x1\n\nDrive /c0/e252/s0 Policies/Settings :\n===================================\nDrive position = DriveGroup:0, Span:0, Row:0\nEnclosure position = 0\nConnected Port Number = 0(path0) \nSequence Number = 2\nCommissioned Spare = No\nEmergency Spare = No\nLast Predictive Failure Event Sequence Number = 0\nSuccessful diagnostics completion on = N/A\nSED Capable = No\nSED Enabled = No\nSecured = No\nLocked = No\nNeeds EKM Attention = No\nPI Eligible = No\nCertified = No\nWide Port Capable = No\n\nPort Information :\n================\n\n-----------------------------------------\nPort Status Linkspeed SAS address        \n-----------------------------------------\n   0 Active 6.0Gb/s   0x4433221100000000 \n-----------------------------------------\n\nInquiry Data = \n7a 42 ff 3f 37 c8 10 00 00 00 00 00 3f 00 00 00 \n00 00 00 00 20 20 20 20 57 20 2d 44 58 57 31 53 \n36 45 4a 34 4c 4e 44 30 00 00 00 00 00 00 34 30 \n30 2e 41 36 31 30 44 57 20 43 44 57 30 31 30 30 \n48 43 5a 54 30 2d 4a 34 50 43 31 56 20 20 20 20 \n20 20 20 20 20 20 20 20 20 20 20 20 20 20 10 80 \n00 40 00 2f 01 40 00 00 00 00 07 00 ff 3f 10 00 \n3f 00 10 fc fb 00 00 01 ff ff ff 0f 00 00 07 00 \n\nDrive /c0/e252/s1 :\n=================\n\n-------------------------------------------------------------------------------\nEID:Slt DID State DG       Size Intf Med SED PI SeSz Model                  Sp \n-------------------------------------------------------------------------------\n252:1     9 Onln   0 930.390 GB SATA HDD N   N  512B WDC WD1000CHTZ-04JCPV1 U  \n-------------------------------------------------------------------------------\n\n... SNIPP ...\n\nDrive /c0/e252/s1 - Detailed Information :\n========================================\n\nDrive /c0/e252/s1 State :\n=======================\nShield Counter = 0\nMedia Error Count = 0\nOther Error Count = 0\nBBM Error Count = 0\nDrive Temperature =  28C (82.40 F)\nPredictive Failure Count = 0\nS.M.A.R.T alert flagged by drive = No\n\nDrive /c0/e252/s1 Device attributes :\n===================================\nSN =      WD-WXT1E64TZEFP\nManufacturer Id = ATA     \nModel Number = WDC WD1000CHTZ-04JCPV1\nNAND Vendor = NA\nWWN = 50014ee6afbe6dc0\nFirmware Revision = 04.06A01\nRaw size = 931.512 GB [0x74706db0 Sectors]\nCoerced size = 930.390 GB [0x744c8000 Sectors]\nNon Coerced size = 931.012 GB [0x74606db0 Sectors]\nDevice Speed = 6.0Gb/s\nLink Speed = 6.0Gb/s\nNCQ setting = N/A\nWrite cache = N/A\nLogical Sector Size = 512B\nPhysical Sector Size = 4 KB\nConnector Name = Port 0 - 3 x1\n\nDrive /c0/e252/s1 Policies/Settings :\n===================================\nDrive position = DriveGroup:0, Span:0, Row:1\nEnclosure position = 0\nConnected Port Number = 1(path0) \nSequence Number = 2\nCommissioned Spare = No\nEmergency Spare = No\nLast Predictive Failure Event Sequence Number = 0\nSuccessful diagnostics completion on = N/A\nSED Capable = No\nSED Enabled = No\nSecured = No\nLocked = No\nNeeds EKM Attention = No\nPI Eligible = No\nCertified = No\nWide Port Capable = No\n\nPort Information :\n================\n\n-----------------------------------------\nPort Status Linkspeed SAS address        \n-----------------------------------------\n   0 Active 6.0Gb/s   0x4433221101000000 \n-----------------------------------------\n</code></pre> <p> DescriptionMegaCLI CommandStorCLI CommandReal StorCLI Example System Commands Show the software version. \u00a0MegaCLI -vstorcli -v storcli -v \u00a0Show help information.\u00a0MegaCLI -help|-h|?\u00a0storcli -help|-h|?storcli -h \u00a0Show the number of controllers connected\u00a0MegaCLI -adpCount\u00a0storcli show ctrlcountstorcli show ctrlcount Controller Commands Show the status of properties related\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 to the controllers.MegaCli -AdpGetProp\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 &lt;PropertyName&gt;-aN|-a0,1,2|-aALL\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 The following properties can be used with this\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 command:\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 abortcconerror\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 alarmdsply\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 autodetectbackplanedsbl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 autoenhancedimportdsply\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 autosnapshotspace\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 batwarndsbl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 bgirate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 bootwithpinnedcache\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 cachebypass\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ccrate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 clusterenable\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 coercionmode\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 copybackdsbl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 defaultldpspolicy\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 defaultsnapshotspace\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 defaultviewspace\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 disableldpsinterval\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 disableldpstime\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 disableocr\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 dsbl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 eccbucketcount\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 eccbucketleakrate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 eccbucketsize\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enableeghsp\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enableesmarter\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enableeug|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enablejbod\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enblspindownunconfigdrvs\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 loadbalancemode\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 maintainpdfailhistoryenbl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ncqdsply\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 patrolreadrate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 perfmode\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 predfailpollinterval\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 rebuildrate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 reconrate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 rstrhotspareoninsert\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 smartcpybkenbl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 spindowntime\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 spinupdelay\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 spinupdrivecount\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 spinupencdelay /cx show &lt;propertyName&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 The following properties can be used with this\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 command:\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 activityforlocate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 alarm\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 backplane\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 batterywarning\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 bgirate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 bootwithpinnedcache\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 cachebypass\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 cacheflushint\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 cc\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ccrate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 clusterenable\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 coercion\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 copyback\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 directpdmapping\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ds\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 eccbucketleakrate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 eccbucketsize\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enableeghsp\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enableesmarter\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enableeug\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 exposeencldevice\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 jbod\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 loadbalancemode\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 maintainpdfailhistory\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 migraterate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ncq\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 perfmode\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 pr\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 prcorrectunconfiguredareas\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 prrate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 rebuildrate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 rehostinfo\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 restorehotspare\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 safeid\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 smartpollinterval\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 spinupdelay\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 spinupdrivecount\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 stoponerror\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 time\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 usefdeonlyencrypt  storcli /c0 show activityforlocate \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /c0 show alarm storcli /c0 show backplane storcli /c0 show batterywarning storcli /c0 show bgirate storcli /c0 show bootwithpinnedcache storcli /c0 show cachebypass storcli /c0 show cacheflushint storcli /c0 show cc storcli /c0 show ccrate storcli /c0 show clusterenable storcli /c0 show coercion storcli /c0 show copyback \u00a0Show the status of properties related to the controllers (continued). spinupencdrvcnt\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ssdsmartcpybkenbl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 usediskactivityforlocate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 usefdeonlyencryptNone  Set properties on the selected\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 controllers. Megacli -AdpSetProp\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 &lt;propertyname&gt;-an|-a0,1,2|-aall\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 The following properties can be set using this\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 command:\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 abortcconerror\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 alarmdsply\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 autodetectbackplanedsbl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 autoenhancedimportdsply\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 autosnapshotspace\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 batwarndsbl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 bgirate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 bootwithpinnedcache\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 cachebypass\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ccrate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 clusterenable\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 coercionmode\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 copybackdsbl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 defaultldpspolicy\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 defaultsnapshotspace\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 defaultviewspace\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 disableldpsinterval\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 disableldpstime\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 disableocr\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 dsbl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 eccbucketcount\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 eccbucketleakrate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 eccbucketsize\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enableeghsp\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enableesmarter\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enableeug|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enablejbod\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enblspindownunconfigdrvs\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 loadbalancemode\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 maintainpdfailhistoryenbl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ncqdsply\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 patrolreadrate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 perfmode\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 predfailpollinterval\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 rebuildrate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 reconrate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 rstrhotspareoninsert\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 smartcpybkenbl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 spindowntime\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 spinupdelay\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 spinupdrivecount\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 spinupencdelay /cx set &lt;property1&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 The following properties can be set using this command:\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 abortcconerror=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 activityforlocate=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 alarm=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 autorebuild=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 backplane=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 batterywarning=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 bgirate=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 bootwithpinnedcache=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 cachebypass=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 flush|flushcache\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 cacheflushinterval=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ccrate=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 coercion=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 clusterenable=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 copyback=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 type=&lt;smartssd|smarthdd|all&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 dimmerswitch=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 directpdmapping=&lt;enable|disable&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 eccbucketleakrate=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 eccbucketsize=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enableeghsp=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enableesmarter=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enableeug=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 exposeencldevice=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 foreignautoimport=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 jbod=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 loadbalancemode=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 maintainpdfailhistory=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 migraterate=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ncq=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 perfmode=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 prcorrectunconfiguredareas=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 prrate=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 rebuildrate=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 restorehotspare=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 smartpollinterval=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 spinupdelay=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 spinupdrivecount=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 stoponerror=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 usefdeonlyencrypt=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 time=yyyymmdd hh:mm:ss|systemtime\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 usefdeonlyencrypt=&lt;on|off&gt;  /c0 set abortcconerror=on \u00a0Set properties on the selected\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 controllers. autocarve=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 autodetect=&lt;on|off &gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 disk=&lt;p:-p&gt;|all\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 autorebuild=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 carvesize=&lt;1024..32768&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 dpmstat=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ondegrade=&lt;cacheoff|follow&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 rebuild=&lt;enable|disable|&gt;&lt;1..5&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 rebuildmode=&lt;adaptive|lowlatency&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 rebuildrate=&lt;1..5&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 selftest=&lt;enable|disable&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 spinup=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 stagger=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 verify=advanced|basic|&lt;1..5&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 verify=basic [pref=ddd:hh]where\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 hh={00..23} and\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ddd={mon|tue|wed|thu|fri|sat|sun}\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 verify=enable|disable|&lt;1..5&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 verifymode=&lt;adaptive|lowlatency&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 verifyrate=&lt;1..5&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 spinupencdrvcnt\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 sdsmartcpybkenbl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 usediskactivityforlocate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 usefdeonlyencrypt abortcconerror=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 activityforlocate=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 alarm=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 autorebuild=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 backplane=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 batterywarning=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 bgirate=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 bootwithpinnedcache=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 cachebypass=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 flush|flushcache\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 cacheflushinterval=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ccrate=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 coercion=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 clusterenable=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 copyback=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 type=&lt;smartssd|smarthdd|all&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 directpdmapping=&lt;enable|disable&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 eccbucketleakrate=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 eccbucketsize=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enableeghsp=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enableesmarter=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enableeug=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 exposeencldevice=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 foreignautoimport=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 jbod=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 loadbalancemode=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 maintainpdfailhistory=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 migraterate=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ncq=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 perfmode=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 prcorrectunconfiguredareas=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 prrate=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 rebuildrate=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 restorehotspare=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 smartpollinterval=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 spinupdelay=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 spinupdrivecount=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 stoponerror=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 usefdeonlyencrypt=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 time=yyyymmdd hh:mm:ss|systemtime\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 usefdeonlyencrypt=&lt;on|off&gt; Show the number of controllers\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 connected. MegaCLI -adpCount storcli show ctrlcountstorcli show ctrlcount Show all information about the\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 adapter, such as cluster state, BIOS,\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 alarm, firmware, version, and so on.MegaCli -AdpAllInfo\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx show allstorcli /c0 show all  Show the freespace available in the\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 controller.MegaCLI -CfgFreeSpaceinfo\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx show freespacestorcli /c0 show freespace\u00a0\u00a0Download the controller firmwareMegaCli -AdpFwFlash -f filename\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [-NoSigChk] [-NoVerChk]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx download file=&lt;filepath&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [fwtype=&lt;val&gt;] [nosigchk] [noverchk]storcli /c0 download file=mr2208.rom  \u00a0Show the preserved cache status.MegaCLI-GetPreservedCacheList\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx show preservedcachestorcli /c0 show preservedcache\u00a0\u00a0Set the controller timeMegaCLI \u2013AdpSetTime yyyymmdd\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 hh:mm:ss -aN|-a0,1,2|-aALLstorcli /c(x|all) set time=&lt;yyyymmdd\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 hh:mm:ss | systemtime&gt;storcli /c0 set time=systemtime  \u00a0Show the controller time.\u00a0MegaCLI \u2013AdpGetTime -aN\u00a0storcli /cx show timestorcli /c0 show time  \u00a0RAID Configuration commands Create a RAID configuration of RAID\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 type 0, 1, 5, and 6.MegaCli \u2013CfgLDAdd\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -R0|-R1|-R5|-R6[E0:S0,E1:S1,...]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [WT | WB] [NORA | RA | ADRA]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [Direct | Cached]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [CachedBadBBU|NoCachedBadBBU]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [-szXXXXXXXX [-szYYYYYYYY [... ]]]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [-strpszM] [\u2013Hsp[E5:S5,...]]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [\u2013afterLdX] -aNstorcli /cx add vd\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 type=raid[0|1|5|6]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [Size=&lt;VD1_Sz&gt;,&lt;VD2_Sz&gt;,..|*all]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [name=&lt;VDNAME1&gt;,..]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 drives=e:s|e:s-x|e:s-x,y;e:s-x,y,z\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [PDperArray=x]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [SED] [pdcache=on|off|*default][pi]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [DimmerSwitch(ds)=default|automatic\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 (auto)|*none|maximum(max)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 |MaximumWithoutCaching(maxnocache)]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [wt|*wb] [nora|*ra] [*direct|cached]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [CachedBadBBU|*NoCachedBadBBU]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [Stripe=&lt;8|16|32|64|128|256|512|102\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 4] [AfterVd=X]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [Spares=[e:]s|[e:]s-x|[e:]s-x,y]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [force]\u00a0storcli /c0 add vd type=road1 drives=252:0,252:1\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 (hint:\u00a0 use storcli /c0 show to view available enclosure/slot e:s drives) \u00a0Create a CacheCade virtual driveMegaCLI -CfgCacheCadeAdd [-rX]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Physdrv[E0:S0,...] {-Name\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 LdNamestring} [WT|WB|ForcedWB]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [-assign -LX|L0,2,5..|LALL]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-Aallstorcli /cx add VD cachecade|cc\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Type=[0,1,10]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 drives=[e:]s|[e:]s-x|[e:]s-x,y\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [ &lt; WT| WB&gt; ] [assignvds=0,1,2]\u00a0storcli /c0 add vd type=road1 drives=252:2,252:3Create a RAID configuration of RAID\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 type 10, 50, and 60.MegaCli \u2013CfgSpanAdd\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -R10|-R50|R60\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u2013Array0[E0:S0,E1:S1,...]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u2013Array1[E0:S0,E1:S1,...] [...]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [WT | WB] [NORA | RA | ADRA]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [Direct | Cached]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [CachedBadBBU|NoCachedBadBBU]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [-szXXXXXXXX [-szYYYYYYYY [... ]]]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [-strpszM] [\u2013afterLdX] -aNstorcli /cx add vd\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 type=raid[10|50|60]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [Size=&lt;VD1_Sz&gt;,&lt;VD2_Sz&gt;,..|*all]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [name=&lt;VDNAME1&gt;,..]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 drives=e:s|e:s-x|e:s-x,y;e:s-x,y,z\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [PDperArray=x]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [SED] [pdcache=on|off|*default][pi]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [DimmerSwitch(ds)=default|automatic\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 (auto)|*none|maximum(max)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 |MaximumWithoutCaching(maxnocache)]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [wt|*wb] [nora|*ra] [*direct|cached]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [CachedBadBBU|*NoCachedBadBBU]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [Stripe=&lt;8|16|32|64|128|256|512|102\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 4] [AfterVd=X]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [Spares=[e:]s|[e:]s-x|[e:]s-x,y]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [force] \u00a0Delete a virtual driveMegaCli -CfgClr [-Force]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx/vx delete or storcli /cx/vall (to delete all virtual drives) storcli /c0/v0 delete (warning:\u00a0 there is no warning given; using /c0/vall will delete all logical drives and data with no warning)  Show the topology information of\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 the drive groupMegaCLI -CfgDsply\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-Aall\u00a0storcli /cx/dall show [all]storcli /cx0/d0 show Show information for a CacheCade\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 virtual driveMegaCLI -CfgCacheCadeDsply\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-Aall\u00a0storcli /cx/dall show CacheCade(cc)\u00a0storcli /cx0/d0 show cc Delete a virtual drive hosting the\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 operating systemMegaCLI -CfgLdDel\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -LX|-L0,2,5...|-LALL [-Force]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx/vx[all] delete -forcestorcli /c0/v0 del -force  \u00a0Delete a CacheCade virtual driveMegaCLI -CfgCacheCadeDel\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -LX|-L0,2,5...|-LALL\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-Aallstorcli /cx/vx[all] delete\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 CacheCade(cc)storcli /c0/vx del cc  Show, delete, and import the foreign\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 configuration commands.MegaCli \u2013CfgForeign \u2013Scan |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 {-Preview | \u2013Dsply| -Import |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Clear[FID]} -aN|-a0,1,2|-aALL\"storcli /cx/f(x|all) show [all]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [securityKey=xxx]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/f(x|all) del|delete\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [securityKey=xxx]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/f(x|all) import\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [preview] [securityKey=xxx]\"storcli /c0/fall show  \u00a0Patrol Read Commands \u00a0Show the patrol read status and\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 patrol read parameters, if any in\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 progress. MegaCli -AdpPR -info\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0/cx show patrolRead/c0 show patrolread  \u00a0Set the patrol read options on a\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 single adapter, multiple adapters, or\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 all adapters (x = single controller). MegaCli -AdpPR\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u2013Dsbl|EnblAuto|EnblMan|Start|Stop|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Info|Suspend|Resume|Stop|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 SSDPatrolReadEnbl |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 SSDPatrolReadDsbl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 |{SetDelay Val}|{-SetStartTime\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 yyyymmdd hh}|{maxConcurrentPD Val}\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0/cx set patrolread {=on\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 mode=&lt;auto|manual&gt;}|{off}\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 /cx set patrolread [starttime=&lt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 yyyy/mm/dd hh&gt;]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [maxconcurrentpd=&lt;value&gt;]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [includessds=&lt;on|off&gt;]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [uncfgareas=on|off]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 /cx set patrolread delay=&lt;value&gt; /c0 set patrolread mode=manual  \u00a0Disable patrol read. MegaCli -AdpPR -Dsbl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx set patrolread=off storcli /c0 set patrolread=off\u00a0\u00a0Enable automatic patrol read.MegaCli -AdpPR -EnblAuto\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx set patrolread=on\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 mode=auto\u00a0storcli /cx set patrolread=off\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 mode=auto\u00a0Enable manual patrol read.MegaCli -AdpPR -EnblMan\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx set patrolread=on\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 mode=manual\u00a0storcli /c0 set patrolread=on\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 mode=manual\u00a0\u00a0Start patrol read.MegaCli -AdpPR -Start\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx start patrolRead\u00a0storcli /c0 start patrolRead\u00a0\u00a0Suspend a running patrol readMegaCli -AdpPR -Suspend\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx suspend patrolread\u00a0storcli /c0 suspend patrolread\u00a0\u00a0Resume a suspended patrol readMegaCli -AdpPR -Resume\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx resume patrolread\u00a0storcli /c0 resume patrolread\u00a0\u00a0Stop a running patrol readMegaCli -AdpPR -Stop\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx stop patrolRead\u00a0storcli /c0 stop patrolRead\u00a0\u00a0Include SSD drives in patrol readMegaCli -AdpPR -SSDPatrolReadEnbl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx set patrolRead\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 includessds=on | onlymixed\u00a0storcli /c0 set patrolRead\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 includessds=on  \u00a0Exclude SSD drives in patrol read\u00a0MegaCli -AdpPR -SSDPatrolReadDsbl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL storcli /cx set patrolRead\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 includessds=off\u00a0storcli /c0 set patrolRead\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 includessds=off\u00a0Delay a patrol readMegaCli -AdpPR -SetDelay Val\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx set patrolread\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 delay=&lt;value&gt; \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 note: &lt;value&gt; unit of time is in hours storcli /c0 set patrolread\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 delay=1  \u00a0Schedule a patrol readMegaCli -AdpPR -SetStartTime\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 yyyymmdd hh -aN|-a0,1,2|-aALLstorcli /cx set patrolread=on\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 starttime=YYYY/MM/DD HH Set the value for maximum\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 concurrent physical drives for the\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 patrol read.MegaCli -AdpPR -maxConcurrentPD Val\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx set patrolread\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 maxconcurrentpd=xxstorcli /c0 set patrolread\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 maxconcurrentpd=255  Consistency Check Commands \u00a0Schedule a consistency checkMegaCLI -AdpCcSched -Dsbl|-Info|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 {-ModeConc | -ModeSeq [-ExcludeLD\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -LN|-L0,1,2] [-SetStartTime yyyymmdd\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 hh ] [-SetDelay val ] }\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 consistencycheck|cc=[off|seq|conc]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [delay=value] starttime=yyyy/mm/dd\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 hh [excludevd=x-y,z]storcli /c0 set cc=off  Show consistency check status and consistency parameters, in progress,\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 if any.\u00a0MegaCLI -AdpCcSched -Info\u00a0storcli /cx show cc/ConsistencyCheck\u00a0storcli /c0 show cc OPROM BIOS Commands \u00a0Schedule a consistency checkMegaCli -AdpBIOS -Dsply\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx show bios\u00a0storcli /c0 show bios Show consistency check status and\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 consistency parameters, if any in\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 progress.MegaCli -AdpBootDrive -{-Set {-Lx |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -physdrv[E0:S0]}} -aN|-a0,1,2|-aALL\u00a0storcli /cx/ex/sx set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 bootdrive=on|off\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/vx set bootdrive=on|off storcli /c0/v0 set bootdrive=on  Sets the BIOS properties for the\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 controller.MegaCli -AdpBIOS -Enbl | -Dsbl |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Dsply | SOE | BE\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 EnblAutoSelectBootLd |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 DsblAutoSelectBootLd\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx set bios=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 stoponerror|soe=&lt;on|off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 autobootselect(abs)=&lt;on|off&gt;\u00a0storcli /c0 set bios=on  Battery (BBU) Commands \u00a0Show battery-related information\u00a0MegaCli -AdpBbuCmd -aN|-a0,1,2|-aALLstorcli /cx/bbu show\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/bbu show allstorcli /c0/bbu show  \u00a0Show the battery learn propertiesMegaCli -AdpBbuCmd -GetBbuProperties\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx/bbu show properties\u00a0storcli /c0/bbu show propertiesShow the battery information,\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 firmware status, and the gas gauge\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 status.MegaCli -AdpBbuCmd -GetBbuStatus\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx/bbu show statusstorcli /c0/bbu show status  \u00a0Show battery capacity informationMegaCli -AdpBbuCmd\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -GetBbuCapacityInfo\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx/bbu show allstorcli /c0/bbu show all\u00a0\u00a0Show battery design informationMegaCli -AdpBbuCmd -GetBbuDesignInfo\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx/bbu show all\u00a0storcli /c0/bbu show all \u00a0Set battery propertiesMegaCli -AdpBbuCmd -SetBbuProperties\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -f &lt;fileName&gt; -aN|-a0,1,2|-aALLstorcli /cx/bbu set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 learnDelayInterval=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/bbu set bbuMode=&lt;value&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx bbu set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 autolearnmode=&lt;value&gt;,\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 where x= 0 \u2013 Enabled, 1 \u2013 Disabled, 2 \u2013 Warn though\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 event.storcli /c0/bbu set bbumode=5 \u00a0Start battery learn cycleMegaCli -AdpBbuCmd -BbuLearn\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx/bbu start learn\u00a0storcli /co/bbu start learnSet the battery to low power storage\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 mode.MegaCli -AdpBbuCmd -BbuMfgSleep\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx/bbu set powermode=sleep\u00a0 Seal the gas gauge EEPROM write\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 accessMegaCli -AdpBbuCmd -BbuMfgSeal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx/bbu set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 writeaccess=sealed\u00a0 \u00a0Security Commands \u00a0Set the key ID for the controller.MegaCli -CreateSecurityKey\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -SecurityKey sssssssssss |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [-Passphrase sssssssssss] |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [-KeyID kkkkkkkkkkk] -aNstorcli /cx set SecurityKey=XXXXXX\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [passphrase=yyyyy] [keyId=zzzz]\u00a0 Change the security key for the\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 controller.MegaCli -ChangeSecurityKey\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -OldSecurityKey sssssssssss |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -SecurityKey sssssssssss|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [-Passphrase sssssssssss] |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [-KeyID kkkkkkkkkkk] -aNstorcli /cx set SecurityKey=XXXXXX\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 OldSecurityKey=yyyyy\u00a0 Compare and verify the security key\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 for the controllerCompare and verify the security key\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 for the controllerCompare and verify the security key\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 for the controller\u00a0 \u00a0Delete the security keyMegaCLI -DestroySecurityKey |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [-Force] -aN\u00a0storcli /cx delete SecurityKey \u00a0Set the security key for the controllerMegaCli -SetKeyID -KeyID kkkkkkkkkkk\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aNstorcli /cx set SecurityKey\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 KeyId=xxxx\u00a0 Virtual Drive Commands Show the virtual drive information\u00a0MegaCli \u2013LDInfo \u2013Lx|-L0,1,2|-Lall\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx/v(x|all) show\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/v(x|all) show all Set virtual drive properties\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 MegaCli \u2013LDSetProp WT | WB|NORA |RA\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 | ADRA|-Cached|Direct|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 CachedBadBBU|NoCachedBadBBU} |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -RW|RO|Blocked |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 {-Name nameString} |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -EnDskCache|DisDskCache \u2013Lx|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -L0,1,2|-Lall -aN|-a0,1,2|-aALLstorcli /cx/v(x|all) set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 wrcache=WT|WB|AWB\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/v(x|all) set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 rdcache=RA|NoRA\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/v(x|all) set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 iopolicy=Cached|Direct\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/v(x|all) set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 accesspolicy=RW|RO|Blocked|RmvBlkd\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/v(x|all) set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 pdcache=On|Off|Default\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/v(x|all) set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 name=&lt;NameString&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \" Set power-saving (dimmer switch)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 properties.MegaCli -LDSetPowerPolicy -Default|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Automatic| -None| -Maximum|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -MaximumWithoutCaching\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Lx|-L0,1,2|-Lall -aN|-a0,1,2|-aALLstorcli /cx/v(x|all) set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ds=Default|Auto|None|Max|MaxNoCache Show virtual drive expansion\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 informationMegaCli -getLdExpansionInfo\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Lx|-L0,1,2|-Lall -aN|-a0,1,2|-aALL\u00a0storcli /cx/v(x|all) show expansion Expand the virtual drive within the\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 existing array; also use if you replace\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 the drives with larger drives, beyond\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 the size of the existing array.MegaCli -LdExpansion -pN\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -dontExpandArray -Lx|-L0,1,2|-Lall\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx/v(x|all) expand\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Size=&lt;value&gt; [expandarray] \u00a0Secure the virtual drive.MegaCLI --LDMakeSecure\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Lx|-L0,1,2,...|-Lall \u2013An\u00a0storcli /cx/vx set security=on Show specific properties of virtual\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 drives.MegaCli \u2013LDGetProp -Cache | -Access\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 | -Name | -DskCache\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Lx|-L0,1,2|-Lall -aN|-a0,1,2|-aALLstorcli /cx/vx show Start virtual drive initializationMegaCli \u2013LDInit \u2013Start [Fast|Full]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Lx|-L0,1,2|-Lall -aN|-a0,1,2|-aALLstorcli /cx/v(x|all) start\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 init[Full] Stop a running virtual drive\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 initialization.MegaCli \u2013LDInit -Abort\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Lx|-L0,1,2|-Lall -aN|-a0,1,2|-aALL\u00a0storcli /cx/v(x|all) stop init \u00a0Show the initialization progressMegaCli \u2013LDInit \u2013ShowProg\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Lx|-L0,1,2|-Lall -aN|-a0,1,2|-aALL\u00a0storcli /cx/v(x|all) show init Start a consistency check on an\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 uninitialized virtual driveMegaCli \u2013LDCC \u2013Start\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u2013Lx|-L0,1,2|-Lall -aN|-a0,1,2|-aALL\u00a0storcli /cx/v(x|all) start cc[Force] Start, stop, suspend, resume, and\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 show the progress of a consistency\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 check operationMegaCli -LDCC -Start|-Abort|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Suspend|-Resume|-ShowProg|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -ProgDsply -Lx|-L0,1,2|-LALL\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx/v(x|all) start cc\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/v(x|all) stop cc\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/v(x|all) pause cc\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/v(x|all) resume cc\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/v(x|all) show cc Enable/disable automatic\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 background initialization. Show, stop,\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 pause, resume, and show the\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 progress of the background\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 initialization.MegaCLI -LDBI -Enbl|-Dsbl|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -getSetting|-Abort|-Suspend|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Resume|-ShowProg|-ProgDsply\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Lx|-L0,1,2|-LALL -aN|-a0,1,2|-Aallstorcli /cx/v(x|all) set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 autobgi=On|Off\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/v(x|all) show autobgi\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/v(x|all) stop bgi\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/v(x|all) pause bgi\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/v(x|all) resume bgi\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/v(x|all) show bgi Start and show progress for a migrate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 operation.MegaCli \u2013LDRecon {\u2013Start \u2013Rx [Add\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 | Rmv PhysDrv[E0:S0,E1:S1,...] ] }\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 | \u2013ShowProg|-ProgDsply \u2013Lx \u2013aNstorcli /cx/vx start migrate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 type=raidx [option=add|remove\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 drives=[e:]s|[e:]s-x|[e:]s-x,y]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [Force]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/v(x|all) show migrate \u00a0Delete preserved cacheMegaCLI -DiscardPreservedCache\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Lx|-L0,1,2|-Lall -force\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx/v(x|all) delete\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 preservedcache[force] \u00a0Assign the CacheCade virtual driveMegaCLI -Cachecade -assign|-remove\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Lx|-L0,1,2|-LALL -aN|-a0,1,2|-aALLstorcli /cx/vx|all set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ssdCaching=on|off\u00a0Physical Drive Commands \u00a0Show drive informationMegaCli -pdInfo -\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 PhysDrv[E0:S0,E1:S1,...]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx/ex/sx show\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx show all Start, stop, suspend, or resume an\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ongoing rebuild operation.MegaCLI PDRbld -Start|-Stop\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 |-Suspend|-Resume|-ShowProg\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 |-ProgDsply -PhysDrv\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [E0:S0,E1:S1,...]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx/ex/sx start rebuild\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx stop rebuild\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx pause rebuild\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx resume rebuild\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx show rebuild Start, stop, pause, resume, or show\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 the progress of a copyback operation MegaCLI PDCpyBk -Start|-Stop\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 |-Suspend|-Resume|-ShowProg\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 |-ProgDsply -PhysDrv\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [E0:S0,E1:S1,...]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx/ex/sx start copyback\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 target=exx:sxx\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx stop copyback\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx pause copyback\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx resume copyback\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx show copyback Mark a drive as missingMegaCli -PdMarkMissing\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -physdrv[E0:S0,E1:S1,...]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx/ex/sx set missing \u00a0Show missing drive informationMegaCli -PdGetMissing\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL storcli /cx/ex/sx show all\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 NOTE This information is shown as part of the show all\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 command. Replace the configured drive that is\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 identified as missing, and then start\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 an automatic rebuild.MegaCli -PdReplaceMissing\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -physdrv[E0:S0] -arrayA, -rowB\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN\u00a0storcli /cx/ex/sx insert array=x row=y Set the drive state to onlineMegaCli \u2013PDOnline -\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 PhysDrv[E0:S0,E1:S1....]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2\u00a0storcli /cx/ex/sx set online Set the drive state to offlineMegaCli \u2013PDOffline\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -PhysDrv[E0:S0,E1:S1....]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx/ex/sx set offline Set the drive state to JBODMegaCli \u2013PDMakeGood\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -PhysDrv[E0:S0,E1:S1....]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx/ex/sx set good [force]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 or\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx set jbod  \u00a0Add and delete hotspare drivesMegaCli \u2013PDHSP {\u2013Set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [{-Dedicated -ArrayN |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Array0,1...}] [-EnclAffinity]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [-nonRevertible] } |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Rmv -PhysDrv[E0:S0,E1:S1,...]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx/ex/sx add hotsparedrive\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [dgs=&lt;N|0,1,2..&gt;] enclaffinity\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 nonrevertible\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx delete hotsparedriveStart, stop, pause, resume or show\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 the progress of an initialization\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 process.MegaCli \u2013PDClear -Start |-Stop|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -ShowProg |-ProgDsply\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 - PhysDrv[E0:S0,E1:S1....]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx/ex/sx start initialization\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx stop initialization\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx pause initialization\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx resume initialization\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx show initialization Start a drive locate and activate (blink) the\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 drive\u2019s LED or stop a drive locate (LED blinking) and\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 deactivate the drive\u2019s LEDMegaCli \u2013PDLocate {[-start] |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -stop} -physdrv[E0:S0,E1:S1,...]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx/ex/sx start locate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx stop locate Spin down an unconfigured drive\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 and prepare it for removal or spin up\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 spun-down drive and mark the drive\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 state as unconfigured good.MegaCli \u2013PDPrpRmv [-Undo]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u2013 PhysDrv[E0:S0,E1:S1....]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx/ex/sx spindown\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx spinup Show physical drive information of all\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 connected drives.MegaCli \u2013PDList\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1..|-aAllstorcli /cx/eall/sall show [all]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 NOTE This command does not show drives whose enclosure device ID is not available. \u00a0Flash the physical drive firmwareMegaCLI PdFwDownload[offline]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [ForceActivate] {[-SataBridge]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -PhysDrv[0:1]}|{-EncdevId[devId1\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ]} -f &lt;filename&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-Aallstorcli /cx[/ex]/sx download\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 src=&lt;filepath&gt; [satabridge]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex download src=&lt;filepath&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [forceActivate] Erase the drive's security\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 configuration and securely erase data on a drive.MegaCli -PDInstantSecureErase\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -PhysDrv[E0:S0,E1:S1,...] |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [-Force] -aN|-a0,1,2|-aALL\u00a0storcli /cx/ex/sx secureerase [force] Show the security key for secured physical drivesMegaCli -GetKeyID\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [-PhysDrv[E0:S0]] -aNstorcli /cx/ex/sx show securitykey\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 keyid Start, stop, and show the progress of\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 a secure erase operationMegaCli -SecureErase Start[\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Simple|\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [Normal [ |ErasePattern\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ErasePatternA|ErasePattern\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ErasePatternA ErasePattern\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ErasePatternB]]|[Thorough [\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 |ErasePattern\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ErasePatternA|ErasePattern\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ErasePatternA ErasePattern\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ErasePatternB]]]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 | Stop| ShowProg| ProgDsply\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [-PhysDrv [E0:S0,E1:S1,...] |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Lx|-L0,1,2|-LALL]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx[/ex]/sx start erase\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [simple| normal| thorough]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [erasepatternA=&lt;val&gt;]\\n[erasepatternB=&lt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 val&gt;]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Examples:\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx start erase simple\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx start erase normal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 erasepatterna=10101010\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx start erase thorough\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 erasepatterna=10101010\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 erasepatternb=10101111\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex/sx stop erase Enable/disable the direct physical\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 drive mapping mode.\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Show the current state of the direct physical drive mapping.MegaCLI DirectPdMapping\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -Enbl|-Dsbl|-Dsply\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-Aallstorcli /cx set directpdmapping=&lt;on |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 off&gt;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx show directpdmapping Enclosure Commands Show enclosure information\u00a0MegaCli \u2013EncInfo\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx/ex show\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/ex show all Show enclosure statusMegaCli \u2013EncStatus\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0/cx/ex show status Download enclosure firmware. /cx/ex download src=filepath\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [offline] [forceActivate \u00a0PHY Commands \u00a0Show PHY informationMegaCli \u2013PHYInfo -phyM\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx/px(x|all) show\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/px(x|all) show all \u00a0Set PHY link speedMegaCLI PhySetLinkSpeed -phyM\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -speed -aN|-a0,1,2|-aALLstorcli /cx/px(x|all) set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 linkspeed=1.5|3|6|12|auto \u00a0Show the PHY error counters.\u00a0Megacli PhyErrorCounters -Anstorcli /cx/px(x|all) show\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 storcli /cx/px(x|all) show all \u00a0Alarm Commands \u00a0Show alarm propertiesMegaCli -AdpGetProp AlarmDsply\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx(x|all) show alarm \u00a0Set alarm propertiesMegaCli -AdpSetProp AlarmEnbl |\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 AlarmDsbl | AlarmSilence\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx(x|all) set\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 alarm=&lt;on|off|silence&gt; \u00a0Event Log Properties Commands Show event logs.MegaCli -AdpEventLog\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -GetEventLogInfo\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0/cx show eventloginfo Show the specified type of event\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 logs.MegaCli -AdpEventLog -GetEvents\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 {-info -warning -critical\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -fatal} {-f &lt;fileName&gt;}\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx show events\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [type=[latest=x|ccincon\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 vd=|[sincereboot|sinceshutdown|included\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 eleted|latest|ccincon]]]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [filter=[info|warning|critical|fatal]]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 file=xyz.txt Show the specified event logsMegaCli -AdpEventLog\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -GetSinceShutdown {-info\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -warning -critical -fatal}\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 {-f &lt;fileName&gt;}\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALLstorcli /cx show events\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [type=[latest=x|ccincon\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 vd=|[sincereboot|sinceshutdown|included\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 eleted|latest|ccincon]]]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 [filter=[info|warning|critical|fatal]]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 file=xyz.txt \u00a0Delete the event logs.MegaCli -AdpEventLog -Clear\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -aN|-a0,1,2|-aALL\u00a0storcli /cx delete events Premium Feature Key Commands \u00a0Show the Safe ID of the controller\u00a0MegaCli -ELF -GetSafeId -a0\u00a0storcli /cx(x|all) show safeid Show the Advanced Software\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Options that are enabled on the\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 controller, including the ones in trial mode.MegaCli -ELF \u2013ControllerFeatures\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -a0MegaCli -ELF \u2013ControllerFeatures\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -a0 Apply the Activation Key in preview mode.MegaCli -ELF -Applykey key \u2013val\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -preview -a0storcli /cx(x|all) set aso key=&lt;key\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 value&gt; preview \u00a0Apply the Activation KeyMegaCli -ELF -Applykey key \u2013val\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -a0storcli /cx(x|all) set aso key=&lt;key\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 value&gt; \u00a0Deactivate the trial keyMegaCli -ELF\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u2013DeactivateTrialKey -a0storcli /cx(x|all) set aso\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 deactivatetrialkey Show the re-host information and, if re-hosting is necessary, show the controller and key vault serial\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 numbers.\u00a0MegaCli -ELF -ReHostInfo -a0\u00a0storcli /cx(x|all) show rehostinfo Indicate to the controller that the\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 re-host is complete\u00a0MegaCli -ELF -ReHostComplete -a0storcli /cx(x|all) set aso\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 rehostcomplete <p></p>"},{"location":"megaraid/","title":"MegaRAID Policy","text":"<p>lsi_cackecade_pro_2.0_test PDF</p>"},{"location":"megaraid/#raidwrite-policyread-policycache-policy","title":"\u505aRAID\u65f6Write Policy,Read Policy,Cache Policy\u5982\u4f55\u914d\u7f6e","text":""},{"location":"megaraid/#read-aheadscsi","title":"Read-ahead\uff08\u9884\u8bfb\uff09\u542f\u7528\u903b\u8f91\u9a71\u52a8\u5668\u7684SCSI\u9884\u8bfb\u529f\u80fd\u3002 \u53ef\u5c06\u6b64\u53c2\u6570\u8bbe\u4e3a","text":"<ol> <li>No-Read-Ahead\uff08\u975e\u9884\u8bfb\uff09</li> <li>Read-ahead\uff08\u9884\u8bfb\uff09</li> <li>Adaptive\uff08\u81ea\u9002\u5e94\uff09\u3002 \u9ed8\u8ba4\u8bbe\u7f6e\u4e3aAdaptive\uff08\u81ea\u9002\u5e94\uff09\u3002</li> </ol>"},{"location":"megaraid/#no-read-ahead","title":"No-Read-Ahead\uff08\u975e\u9884\u8bfb\uff09","text":"<ul> <li>\u6307\u5b9a\u63a7\u5236\u5668\u5728\u5f53\u524d\u903b\u8f91\u9a71\u52a8\u5668\u4e2d\u4e0d\u4f7f\u7528\u9884\u8bfb\u65b9\u5f0f\u3002</li> </ul>"},{"location":"megaraid/#read-ahead","title":"Read-ahead\uff08\u9884\u8bfb\uff09","text":"<ul> <li>\u6307\u5b9a\u63a7\u5236\u5668\u5728\u5f53\u524d\u903b\u8f91\u9a71\u52a8\u5668\u4e2d\u4f7f\u7528\u9884\u8bfb\u65b9\u5f0f\u3002</li> </ul>"},{"location":"megaraid/#adaptive","title":"Adaptive\uff08\u81ea\u9002\u5e94\uff09","text":"<ul> <li>\u6307\u5b9a\u5982\u679c\u6700\u8fd1\u4e24\u6b21\u7684\u78c1\u76d8\u8bbf\u95ee\u51fa\u73b0\u5728\u8fde\u7eed\u7684\u6247\u533a\u5185\uff0c\u5219\u63a7\u5236\u5668\u5f00\u59cb\u91c7\u7528Read-ahead\uff08\u9884\u8bfb\uff09\u3002 </li> <li>\u5982\u679c\u6240\u6709\u7684\u8bfb\u53d6\u8bf7\u6c42\u90fd\u662f\u968f\u673a\u7684\uff0c\u5219\u8be5\u7b97\u6cd5\u56de\u590d\u5230No-Read-Ahead\uff08\u975e\u9884\u8bfb\uff09\uff0c\u4f46\u4ecd\u8981\u5224\u65ad\u6240\u6709\u7684\u8bfb\u53d6\u8bf7\u6c42\u662f\u5426\u6709\u6309\u987a\u5e8f\u64cd\u4f5c\u7684\u53ef\u80fd\u3002</li> </ul>"},{"location":"megaraid/#cache-policy-read-ahead","title":"Cache Policy\uff08\u9ad8\u901f\u7f13\u5b58\u7b56\u7565\uff09 \u9002\u5408\u5728\u7279\u5b9a\u903b\u8f91\u9a71\u52a8\u5668\u4e0a\u8bfb\u53d6\u3002 \u5b83\u5e76\u4e0d\u5f71\u54cdRead ahead\uff08\u9884\u8bfb\uff09\u9ad8\u901f\u7f13\u5b58\u3002","text":"<ul> <li>Cached I/O\uff08\u9ad8\u901f\u7f13\u5b58I/O\uff09\u6307\u5b9a\u6240\u6709\u8bfb\u53d6\u6570\u636e\u5728\u9ad8\u901f\u7f13\u5b58\u5b58\u50a8\u5668\u4e2d\u7f13\u5b58\u3002</li> <li>Direct I/O\uff08\u76f4\u63a5I/O\uff09\u6307\u5b9a\u8bfb\u53d6\u6570\u636e\u4e0d\u5728\u9ad8\u901f\u7f13\u5b58\u5b58\u50a8\u5668\u4e2d\u7f13\u5b58\u3002 \u6b64\u4e3a\u9ed8\u8ba4\u8bbe\u7f6e\u3002 <ul> <li>\u5b83\u4e0d\u4f1a\u4ee3\u66ff\u9ad8\u901f\u7f13\u5b58\u7b56\u7565\u8bbe\u7f6e\u3002\u6570\u636e\u88ab\u540c\u65f6\u4f20\u9001\u5230\u9ad8\u901f\u7f13\u5b58\u548c\u4e3b\u673a\u3002 </li> <li>\u5982\u679c\u518d\u6b21\u8bfb\u53d6\u540c\u4e00\u6570\u636e\u5757\uff0c\u5219\u4ece\u9ad8\u901f\u7f13\u5b58\u5b58\u50a8\u5668\u8bfb\u53d6</li> </ul> </li> </ul>"},{"location":"megaraid/#write-policy","title":"Write Policy\uff08\u5199\u5165\u7b56\u7565\uff09 \u5c06\u9ad8\u901f\u7f13\u5b58\u65b9\u6cd5\u8bbe\u7f6e\u4e3a\u56de\u5199\u6216\u901a\u8fc7\u5199\u3002","text":"<ul> <li>\u5728Write-back\uff08\u56de\u5199\uff09\u9ad8\u901f\u7f13\u5b58\u4e2d\uff0c\u5f53\u63a7\u5236\u5668\u9ad8\u901f\u7f13\u5b58\u5df2\u63a5\u6536\u5230\u67d0\u4e2a\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u6570\u636e\u65f6\uff0c\u8be5\u63a7\u5236\u5668\u5c06\u6570\u636e\u4f20\u8f93\u5b8c\u6210\u4fe1\u53f7\u53d1\u9001\u7ed9\u4e3b\u673a\u3002</li> <li>\u5728Write-through\uff08\u901a\u8fc7\u5199\uff09\u9ad8\u901f\u7f13\u5b58\u4e2d\uff0c\u5f53\u78c1\u76d8\u5b50\u7cfb\u7edf\u5df2\u63a5\u6536\u5230\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u6570\u636e\u65f6\uff0c\u8be5\u63a7\u5236\u5668\u5c06\u6570\u636e\u4f20\u8f93\u5b8c\u6210\u4fe1\u53f7\u53d1\u9001\u7ed9\u4e3b\u673a\u3002</li> <li>Write-through\uff08\u901a\u8fc7\u5199\uff09\u9ad8\u901f\u7f13\u5b58\u4e0eWrite-back\uff08\u56de\u5199\uff09\u9ad8\u901f\u7f13\u5b58\u76f8\u6bd4\u5177\u6709\u6570\u636e\u5b89\u5168\u7684\u4f18\u52bf\uff0c\u4f46Write-back\uff08\u56de\u5199\uff09\u9ad8\u901f\u7f13\u5b58\u6bd4\u8d77Write-through\uff08\u901a\u8fc7\u5199\uff09\u53c8\u6709\u6027\u80fd\u4e0a\u7684\u4f18\u52bf\u3002</li> </ul>"},{"location":"megaraid/#raid","title":"\u67e5\u770bRAID\u5361\u7535\u6c60\u60c5\u51b5","text":"<p><pre><code>MegaCli64 -AdpBbuCmd -GetBbuStatus -aAll\n</code></pre> \u5982\u679c\u8fd4\u56de\u5982\u4e0b\u9519\u8bef\u90a3\u4e48\u53ef\u80fd\u662fRAID\u5361BUU\u7535\u6c60\u6709\u95ee\u9898\u6216\u8005\u6ca1\u6709\u7535\u6c60\u4fdd\u62a4\u529f\u80fd\uff1a <pre><code>Adapter 0: Get BBU Status Failed.\n\nFW error description:\n\n  The required hardware component is not present. \n\nExit Code: 0x22\n</code></pre></p>"},{"location":"megaraid/#raid_1","title":"\u67e5\u770b\u5f53\u524dRAID\u5361\u7f13\u5b58\u7b56\u7565","text":"<pre><code># MegaCli64 -LDinfo -Lall -aAll\nDefault Cache Policy: WriteThrough, ReadAheadNone, Direct, No Write Cache if Bad BBU\n\nCurrent Cache Policy: WriteThrough, ReadAheadNone, Direct, No Write Cache if Bad BBU\n</code></pre> <p>\u7b2c\u4e00\u90e8\u5206\uff1a</p> <p>WriteBack:\u5199\u7f13\u5b58\u7b56\u7565</p> <p>WriteThrough:\u76f4\u63a5\u5199\u5165\u78c1\u76d8\uff0c\u4e0d\u9002\u7528RAID\u5361\u7f13\u5b58\u3002</p> <p>\u7b2c\u4e8c\u90e8\u5206\uff1a</p> <p>ReadAheadNone:\u4e0d\u5f00\u542f\u9884\u8bfb</p> <p>ReadAhead:\u5f00\u542f\u9884\u8bfb\uff0c\u5728\u8bfb\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u9884\u5148\u628a\u540e\u9762\u987a\u5e8f\u7684\u6570\u636e\u8f7d\u5165raid\u5361\u7f13\u5b58\uff0c\u5728\u987a\u5e8f\u8bfb\u7684\u73af\u5883\u4e2d\u80fd\u63d0\u4f9b\u5f88\u597d\u7684\u6027\u80fd\uff0c\u4f46\u662f\u5728\u968f\u673a\u8bfb\u7684\u73af\u5883\u4e2d\u53cd\u800c\u964d\u4f4e\u8bfb\u7684\u6027\u80fd\uff08\u9002\u5408\u6587\u4ef6\u7cfb\u7edf\uff0c\u4e0d\u9002\u5408\u6570\u636e\u5e93\u7cfb\u7edf\uff09</p> <p>ReadAdaptive:\u81ea\u9002\u5e94\u9884\u8bfb\uff0c\u5728\u7f13\u5b58\u548cI/O\u7a7a\u95f2\u65f6\u9009\u62e9\u9884\u8bfb\uff0c\u9ed8\u8ba4\u7b56\u7565\u3002</p> <p>\u7b2c\u4e09\u90e8\u5206\uff1a</p> <p>Direct:\u8bfb\u64cd\u4f5c\u4e0d\u7f13\u5b58\u5230RAID\u5361\u7f13\u5b58\u3002</p> <p>Cached:\u8bfb\u64cd\u4f5c\u7f13\u5b58\u5230RAID\u5361\u7f13\u5b58\u3002</p> <p>\u7b2c\u56db\u90e8\u5206\uff1a\u5982\u679cBBU(\u7535\u6c60)\u51fa\u73b0\u95ee\u9898\u662f\u5426\u542f\u7528Write Cache</p> <p>No Write Cache if Bad BBU:\u5982\u679cBBU\u51fa\u73b0\u95ee\u9898\u4e0d\u4f7f\u7528Write Cache\uff0c\u4eceWriteBack\u81ea\u52a8\u5207\u6362\u5230WriteThrough\uff0c\u9ed8\u8ba4\u914d\u7f6e\u3002</p> <p>Write Cache OK if Bad BBU: \u5982\u679cBBU\u51fa\u73b0\u95ee\u9898\u4ecd\u542f\u7528Write Cache,\u8fd9\u79cd\u914d\u7f6e\u662f\u975e\u5e38\u4e0d\u5b89\u5168\u7684\uff0c\u9664\u975e\u662f\u6709UPS\u6216\u8005\u53cc\u7535\u6e90\u7684\u60c5\u51b5\u4e0b\u3002</p>"},{"location":"megaraid/#raid_2","title":"RAID\u5361\u7b56\u7565\u66f4\u6539","text":"<p>\u4fee\u6539WriteBack\uff1a</p> <p><code>MegaCli64 -LDSetProp -WB -Lall -aAll</code></p> <p>\u4fee\u6539WriteThrough:</p> <p><code>MegaCli64 -LDSetProp -WT -Lall -aAll</code></p> <p>\u4fee\u6539No Write Cache if Bad BBU:</p> <p><code>MegaCli64 -LDSetProp -NoCachedBadBBU -Lall -aAll</code></p> <p>\u4fee\u6539Write Cache OK if Bad BBU:</p> <p><code>MegaCli64 -LDSetProp -CachedBadBBU -Lall -aAll</code></p>"},{"location":"megaraid/#_1","title":"\u5176\u5b83\u76f8\u5173\u547d\u4ee4","text":"\u5176\u5b83\u76f8\u5173\u547d\u4ee4  <pre>\n\n\u67e5\u770b\u673a\u5668\u578b\u53f7    # dmidecode | grep \"Product\" \n\n\u67e5\u770b\u5382\u5546    # dmidecode| grep \"Manufacturer\" \n\n\u67e5\u770b\u5e8f\u5217\u53f7    # dmidecode | grep \"Serial Number\" \n\n\u67e5\u770bCPU\u4fe1\u606f    # dmidecode | grep \"CPU\" \n\n\u67e5\u770bCPU\u4e2a\u6570    # dmidecode | grep \"Socket Designation: CPU\" |wc \u2013l \n\n\u67e5\u770b\u51fa\u5382\u65e5\u671f    # dmidecode | grep \"Date\" \n\n\u67e5\u770b\u5145\u7535\u72b6\u6001    # MegaCli64 -AdpBbuCmd-GetBbuStatus -aALL |grep \"Charger Status\" \n\n\u663e\u793aBBU\u72b6\u6001\u4fe1\u606f    # MegaCli64 -AdpBbuCmd-GetBbuStatus \u2013aALL \n\n\u663e\u793aBBU\u5bb9\u91cf\u4fe1\u606f    # MegaCli64 -AdpBbuCmd-GetBbuCapacityInfo \u2013aALL \n\n\u663e\u793aBBU\u8bbe\u8ba1\u53c2\u6570    # MegaCli64 -AdpBbuCmd-GetBbuDesignInfo \u2013aALL \n\n\u663e\u793a\u5f53\u524dBBU\u5c5e\u6027    # MegaCli64 -AdpBbuCmd-GetBbuProperties \u2013aALL \n\n\u67e5\u770b\u5145\u7535\u8fdb\u5ea6\u767e\u5206\u6bd4    # MegaCli64 -AdpBbuCmd-GetBbuStatus -aALL |grep \"Relative State of Charge\" \n\n\u67e5\u8be2Raid\u9635\u5217\u6570    # MegaCli64 -cfgdsply -aALL|grep \"Number of DISK GROUPS:\" \n\n\u663e\u793aRaid\u5361\u578b\u53f7\uff0cRaid\u8bbe\u7f6e\uff0cDisk\u76f8\u5173\u4fe1\u606f      # MegaCli64-cfgdsply \u2013aALL \n\n\u663e\u793a\u6240\u6709\u7269\u7406\u4fe1\u606f    # MegaCli64 -PDList-aALL \n\n\u663e\u793a\u6240\u6709\u903b\u8f91\u78c1\u76d8\u7ec4\u4fe1\u606f    # MegaCli64 -LDInfo -LALL\u2013aAll \n\n\u67e5\u770b\u7269\u7406\u78c1\u76d8\u91cd\u5efa\u8fdb\u5ea6(\u91cd\u8981)    # MegaCli64 -PDRbld-ShowProg -PhysDrv [1:5] -a0 \n\n\u67e5\u770b\u9002\u914d\u5668\u4e2a\u6570    #MegaCli64 \u2013adpCount \n\n\u67e5\u770b\u9002\u914d\u5668\u65f6\u95f4    #MegaCli64 -AdpGetTime\u2013aALL \n\n\u663e\u793a\u6240\u6709\u9002\u914d\u5668\u4fe1\u606f    #MegaCli64 -AdpAllInfo\u2013aAll \n\n\u67e5\u770bCache \u7b56\u7565\u8bbe\u7f6e    # MegaCli64 -cfgdsply -aALL|grep Polic\n\nradi\u5361\u7535\u6c60\u5145\u653e\u7535:http://www.tuicool.com/articles/a2AzAb\n</pre>"},{"location":"my-cnf/","title":"mysql5.7\u6027\u80fd\u63d0\u5347\u4e00\u767e\u500d\u8c03\u4f18\u5b9d\u5178","text":"<ul> <li>https://blog.csdn.net/lifetragedy/article/details/105944790?utm_source=app&amp;app_version=5.0.0</li> </ul> <p>\u5168\u6587\u4e2d\u4e00\u5171\u6709\u5e38\u7528\u7684\uff08\u4e8b\u5b9e\u4e0a\u4f60\u5982\u679c\u82b11-2\u5468\u9605\u8bfb\u3001\u7406\u89e3\u3001\u81ea\u5df1\u52a8\u624b\u8bbe\u4e00\u4e0b\u540e\u662f\u9700\u8981\u8fd9\u4e48\u591a\u53c2\u6570\u7684\uff0976\u4e2a\u53c2\u6570\uff0c\u7b14\u8005\u628a\u8fd110\u5e74\u91cc3\u4e2a\u4ebf\u4e07\u7ea7\u9879\u76ee\u7684\u6570\u636e\u5e93\u8c03\u4f18\u7528\u6b64\u7bc7\u6d53\u7f29\u5230\u4e86\u53ef\u80fd\u8bfb\u8005\u53ea\u9700\u89812\u5468\u65f6\u95f4\u5c31\u53ef\u4ee5\u638c\u63e1\uff0c\u540c\u65f6\u6211\u662f\u6309\u7167\uff1a</p> <ul> <li>\u6bcf\u4e00\u4e2a\u53c2\u6570\u5e72\u5417\uff1f</li> <li>\u5728\u67d0\u4e9b\u5178\u578b\u786c\u4ef6\u914d\u7f6e\u4e0b\u7684db\u4e0a\u53c2\u6570\u8be5\u8bbe\u591a\u5c11\uff1f</li> <li>\u8bbe\u4f1a\u600e\u4e48\u6837\uff1f</li> <li>\u4e0d\u8bbe\u4f1a\u600e\u4e48\u6837\uff1f</li> <li>\u6709\u4ec0\u4e48\u5751\u5982\u4f55\u586b\u5751\uff1f</li> <li>\u6709\u4e9b\u53c2\u6570\u600e\u4e48\u7b97\u3001\u7b97\u6cd5\u53c8\u5982\u4f55</li> <li>\u8fd9\u79cdstyle\u6765\u5199\u7684\uff0c\u76f8\u4fe1\u6b64\u7bc7\u4f1a\u5bf9\u4e00\u4e9b\u4f7f\u7528mysql\u7684\u5c24\u5176\u662f\u6b63\u5728\u6216\u8005\u5c06\u8981\u9762\u4e34\u4e07\u7ea7\u5e76\u53d1\u7684\u9879\u76ee\u3001\u7f51\u7ad9\u6709\u6240\u5e2e\u52a9\u3002\u5177\u4f53\u8bf7\u770b\u6587\u6863\uff01</li> </ul> <p>\u4e00\u5343\u4e2aDBA\u5c31\u6709\u4e00\u5343\u79cd\u914d\u7f6e\u65b9\u5f0f!</p> <p>\u5927\u5bb6\u4e00\u5b9a\u8bb0\u5f97\u4e0d\u8981\u8f7b\u6613\u53bb\u770b\u7f51\u4e0a\uff0c\u8981\u770b\u53ea\u770b\u5b98\u7f51\uff01\u7f51\u4e0a\u5f88\u591a\u535a\u5ba2\u90fd\u662f\u9519\u7684\uff0c\u8fde\u53c2\u6570\u90fd\u5217\u9519\u4e86\uff0c5.7\u5f88\u591a\u53c2\u6570\u548c5.6\u662f\u5b8c\u5168\u4e0d\u4e00\u6837\u7684\u3002</p> <p>\u53ef\u80fd\u4f60\u4ece\u672a\u770b\u5230\u8fc7\u8fd9\u6837\u7684\u4e00\u7bc7\u96c6\u4e2d\u706b\u529b\u5f0f\u7684\u628amysql\u53c2\u6570\u5217\u4e86\u8fd9\u4e48\u5168\u7684\u6587\u7ae0\uff0c\u5f88\u6709\u5174\u66fe\u53c2\u4e0e\u8fc7\u8d853\u4e07\u5e76\u53d1\u768418\uff5e19\u5e74\u7684\u6570\u8f6e520\u3001618\u3001\u53cc11\u3001\u53cc12\u4fdd\u536b\u6218\u3002\u56e0\u6b64\u8fd9\u4e00\u7bc7\u662f\u6c47\u96c6\u4e86\u6700\u7cbe\u534e\u548c\u5b9e\u6218\u7684\u5185\u5bb9\u628amysql\u6240\u6709\u7684\u53c2\u6570\u5217\u5728\u8fd9\u8fb9\u4f9b\u5927\u5bb6\u53c2\u8003\u3002\u5e76\u4e14\u4ee5\uff0864c cpu\uff0c128gb\u5185\u5b58\uff09\u7684mysql cpu\u548c\u5185\u5b58\u6765\u8fdb\u884c\u4e86\u4e00\u8f6e\u914d\u7f6e\u3002\u800c\u6b64\u6587\u7684\u5185\u5b58\u76f8\u5173\u53c2\u6570\u90e8\u5206\u53ef\u4ee5\u5ef6\u5c55\u81f3256gb\uff5e512gb\u3002</p> <p>\u53e6\u5916\u6709\u4e00\u70b9\uff0c\u5efa\u8bae\u5728mysql\u7684\u670d\u52a1\u5668\u4e0a\u4f7f\u7528ssd\u3002\u9664\u975e\u5e76\u53d1\u6570\u6c38\u8fdc\u63a7\u5236\u5728500-1000\u5185\u90a3\u5c31\u6ca1\u5fc5\u8981\u4f7f\u7528ssd\uff0c\u666e\u901a\u9ad8\u901f\u78c1\u76d8\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u4f60\u4f1a\u53d1\u89c9\u8fd9\u7bc7\u6587\u7ae0\u662f\u4e00\u7bc7\u5b9d\u85cf\uff0c\u8fd9\u4e9b\u53c2\u6570\u90fd\u80fd\u591f\u81ea\u5df1\u52a8\u624b\u8bd5\u9a8c\u4e00\u7bc7\u57fa\u672c\u5728\u5916\u9762\u662f\u53ef\u4ee5\u540a\u6253mysql\u9762\u8bd5\u5b98\u4e86\u3002</p>"},{"location":"my-cnf/#client","title":"client\u57df\uff1a","text":""},{"location":"my-cnf/#1character_set_client","title":"1\uff09character_set_client","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a utf8mb4</p> <p>\u4f5c\u7528\uff1a \u5b57\u7b26\u96c6\u8bbe\u5b9a\uff0c\u5982\u679c\u524d\u53f0\u6709\u8fdesocial mobile application\u4e00\u7c7b\u5305\u62ecwechat\uff0c\u5e76\u4e14\u5141\u8bb8\u6709\u4f7f\u7528emoji\u8868\u60c5\u7684\uff0c\u8bf7\u5f00\u542f\u6210utf8mb4</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a mysql\u4e0d\u652f\u6301\u524d\u7aefapp\u5b58\u8868\u60c5\u7b49\u5b57\u7b26</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a character_set_client=utf8mb4</p>"},{"location":"my-cnf/#mysqld","title":"mysqld\u57df\uff1a","text":""},{"location":"my-cnf/#1server-id","title":"1)server-id","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>\u5982\u679c\u6ca1\u6709\u505a\u4efb\u4f55\u4e3b\u4ece\u590d\u5236\uff0c\u6b64\u503c\u53ef\u4ee5\u4e0d\u8bbe\u3002</p> <p>\u4f5c\u7528\uff1a</p> <p>\u9047\u6709\u4e3b\u4ece\u590d\u5236\uff0c\u5fc5\u8bbe\u8be5\u503c\uff0c\u6bcf\u4e2a\u53c2\u4e0e\u4e3b\u4ece\u590d\u5236\u7684mysql\u5b9e\u4f8b\u7684server-id\u4e0d\u80fd\u91cd\u590d\uff0c\u5fc5\u987b\u4e3a\u963f\u62c9\u4f2f\u6570\u5b57\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u5982\u679c\u4f60\u7528\u7684\u662f\u4e3b\u4ece\u590d\u5236\uff0c\u8fd9\u4e2aid\u4e0d\u8bbe\u90a3\u4e48\u6574\u4e2amysql\u7684\u4e3b\u4ece\u590d\u5236\u4f1a\u5931\u51e0\u3002</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>server-id=1</p>"},{"location":"my-cnf/#2port","title":"2)port","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>3306</p> <p>\u4f5c\u7528\uff1a</p> <p>mysql\u5b9e\u4f8b\u7aef\u53e3</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e3a3306</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>port=3306</p>"},{"location":"my-cnf/#3bind_address","title":"3)bind_address","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>0.0.0.0</p> <p>\u4f5c\u7528\uff1a</p> <p>\u9664\u975e\u6709\u7279\u6b8a\u9700\u8981\uff0c\u6211\u4eec\u4f1a\u9650\u5236\u53ea\u5141\u8bb8mysql\u5b9e\u4f8b\u88ab\u67d0\u4e00\u4e2aip\u65b9\u95ee\uff0c\u4e0d\u652f\u6301\u591a\u4e2a\uff0c\u751f\u4ea7\u4e0a\u90fd\u4e3a\uff1a0.0.0.0\u7136\u540e\u4f7f\u7528\u9632\u706b\u5899\u7b56\u7565\u6765\u63a7\u5236\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e0d\u5141\u8bb8\u8fdc\u7a0b\u767b\u5f55</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>bind_address=0.0.0.0</p>"},{"location":"my-cnf/#4autocommit","title":"4)autocommit","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>1</p> <p>\u4f5c\u7528\uff1a</p> <p>\u751f\u4ea7\u4e0a\u5f00\u542f\u62101\uff0c\u5982\u679c\u4f60\u5f00\u542f\u7684\u662f0\u4f1a\u6709\u4e00\u4e2a\u8fd9\u6837\u7684\u60c5\u51b5\uff1a</p> <p>a\u8fd0\u884c\u4e00\u6761insert\u8bed\u53e5\uff0c\u5e76\u672a\u4f5ccommit;b\u53bb\u505a\u67e5\u8be2\u6b64\u65f6b\u662f\u67e5\u8be2\u4e0d\u5230\u7684\u3002\u8fd9\u79cd\u64cd\u4f5c\u4e00\u822c\u7528\u4e8e\u5728\u5199store procedure\u65f6\u7528\u5230\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u5982\u679c\u5728\u7cfb\u7edf\u7684my.cnf\u5c42\u9762\u628a\u5b83\u8bbe\u6210\u4e860\uff0c\u5982\u679c\u5728\u4f7f\u7528\u65f6\uff0899%\u60c5\u51b5\u662f\u7528\u76841\uff09\u65f6\uff0c\u4f60\u60f3\u8981\u7528root\u5728\u751f\u4ea7\u8fd0\u884c\u65f6\u628a\u5b83\u8bbe\u6210set autocommit = 1\u90fd\u5f00\u542f\u4e0d\u4e86\u3002\u800c\u5982\u679c\u4f60\u5728\u4e00\u5f00\u59cb\u5c31\u6ca1\u5b83\u8bbe\u7f6e\u62101\uff0c\u90a3\u4e48\u5f53\u78b0\u5230\u67d0\u4e9b\u7279\u6b8a\u573a\u666f\u7279\u522b\u662f\u5199store procedure\u65f6\u9700\u8981\u628a\u5b83\u8bbe\u62100\u65f6\uff0c\u4f60\u662f\u53ef\u4ee5\u624b\u52a8\u4e34\u65f6\u628a\u67d0\u4e00\u4e2asession\u7ed9\u5f00\u57280\u7684\u3002</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>autocommit = 1</p>"},{"location":"my-cnf/#5character_set_server","title":"5)character_set_server","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>utf8mb4</p> <p>\u4f5c\u7528\uff1a</p> <p>\u5b57\u7b26\u96c6\u8bbe\u5b9a\uff0c\u5982\u679c\u524d\u53f0\u6709\u8fdesocial mobile application\u4e00\u7c7b\u5305\u62ecwechat\uff0c\u5e76\u4e14\u5141\u8bb8\u6709\u4f7f\u7528emoji\u8868\u60c5\u7684\uff0c\u8bf7\u5f00\u542f\u6210utf8mb4</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>mysql\u4e0d\u652f\u6301\u524d\u7aefapp\u5b58\u8868\u60c5\u7b49\u5b57\u7b26</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>character_set_server=utf8mb4</p>"},{"location":"my-cnf/#6skip_name_resolve","title":"6)skip_name_resolve","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>1</p> <p>\u4f5c\u7528\uff1a</p> <p>\u751f\u4ea7\u4e0a\u5efa\u8bae\u5f00\u542f\u62101\uff0c\u8fd9\u6837mysql server\u4e0d\u4f1a\u5bf9\u5ba2\u6237\u7aef\u8fde\u63a5\u4f7f\u7528\u53cd\u5411dns\u89e3\u6790\uff0c\u5426\u5219\u5ba2\u6237\u7aef\u8fde\u4e0a\u540e\u6709\u65f6\u5728\u9047\u6709\u751f\u4ea7\u9ad8\u901f\u8fd0\u884c\u65f6\u76f4\u63a5timeout\uff0c\u5982\u679c\u8bbe\u6210\u4e861\u5e26\u6765\u7684\u95ee\u9898\u5c31\u662f\u4f60\u4e0d\u80fd\u5728mysql\u4e2d\u4f7f\u7528\u4e3b\u673a\u540d\u6765\u5bf9\u5ba2\u6237\u7aef\u6743\u9650\u8fdb\u884c\u5212\u5206\uff0c\u800c\u662f\u9700\u8981\u4f7f\u7528ip\u3002</p> <p>\u5982\u679c\u8981\u505a\u6210\u5373\u5141\u8bb8mysql\u91cc\u5141\u8bb8\u4f7f\u7528\u4e3b\u673a\u540d\u6765\u5206\u914d\u5ba2\u6237\u7aef\u8fde\u63a5\u6743\u9650\uff0c\u53c8\u8981\u505a\u5230\u4e0d\u8981\u8ba9mysql\u53bb\u505adns\u89e3\u6790\uff0c\u53ef\u4ee5\u5728mysql\u6240\u5728\u4e3b\u673a\u7aef\u7684/etc/hosts\u6587\u4ef6\u4e2d\u5199\u4e0a\u5ba2\u6237\u7aef\u7684\u4e3b\u673a\u540d\uff0c\u56e0\u4e3a\u5f53\u5ba2\u6237\u7aef\u8fde\u63a5\u8fde\u4e0a\u6765\u65f6\uff0cmysql\u53cd\u5411\u67e5\u627e\u5ba2\u6237\u7aef\u8fde\u63a5\u65f6\u7684\u57df\u540d\u89e3\u6790\u7684\u6b65\u9aa4\u662f\uff1a\u9996\u5148\u67e5\u627e /etc/hosts \u6587\u4ef6\uff0c\u641c\u7d22\u57df\u540d\u548cIP\u7684\u5bf9\u5e94\u5173\u7cfb\u3002\u4f46\u662f\u8fd9\u6837\u505a\u4e5f\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u90a3\u5c31\u662f\u5982\u679c\u4f60\u6709\u591a\u4e2a\u5ba2\u6237\u7aef\u591a\u4e2amysql\u4e3b\u4ece\u5173\u7cfb\uff0c\u54ea\u5230\u4f60\u8981\u628amysql\u505a\u6210\u4e00\u4e2adns\u89e3\u6790\u5668\u5417\uff1f\u56e0\u6b64\u63a8\u8350\u8bbe\u62101</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>mysql server\u6bcf\u4e00\u6b21\u4f1a\u5bf9\u5ba2\u6237\u7aef\u8fde\u63a5\u4f7f\u7528\u53cd\u5411dns\u89e3\u6790\uff0c\u7ecf\u5e38\u4f1a\u51fa\u73b0\u5ba2\u6237\u7aef\u8fde\u4e0a\u540e\u6709timeout\u73b0\u8c61\u3002</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>skip_name_resolve=1</p>"},{"location":"my-cnf/#7max_connections","title":"7)max_connections","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>20,000</p> <p>\u4f5c\u7528\uff1a</p> <p>\u6700\u5927\u8fde\u63a5\u6570\uff0c\u4ee5\u5fae\u54c1\u4f1a\uff1a\u524d\u7aef3\u4e07\u7684tps\u5e76\u53d1\uff0c\u5047\u8bberedis\u547d\u4e2d\u5931\u654850%\uff08\u8fd9\u662f\u707e\u96be\uff09\uff0c\u90a3\u4e48\u540e\u7aefmysql\u5355\u4e2a\u4e3b\u6216\u4ece\u5f00\u542f\u8fde\u63a5\u6570\u4e3a\uff1a20,000\uff0c\u6211\u4eec\u516c\u53f8\u5728\u524d\u7aef\u5e76\u53d1\u66fe\u8fbe\u5230\u8fc76\u4e07\uff0c80%\u88abwaf\u3001vanish\u3001\u7f13\u5b58\u6321\u6389\uff0c\u843d\u5728db\u4e0a\u7684qps\u6700\u9ad8\u4e00\u6b21\u4e3a20,000\u8fde\u63a5\uff0c\u518d\u6309\u7167mysql\u5b98\u65b9\uff0cmax_connections\u503c\u53d7\u7cfb\u7edfos\u6700\u5927\u6253\u5f00\u8fde\u63a5\u6570\u9650\u5236\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u505a\u4ee5\u4e0b2\u6b65\u64cd\u4f5c\uff1a</p> <p>1\uff09\u5728 /etc/security/limits.conf \u5e95\u90e8\u589e\u52a02\u884c</p> <p>mysql hard nofile 65535</p> <p>mysql soft nofile 65535</p> <p>2\uff09\u5728/usr/lib/systemd/system/mysqld.service\uff08\u89c6\u5982\u4f55\u5b89\u88c5mysql\u6240\u51b3\u5b9a\uff0c\u7528\u7f16\u8bd1\u5b89\u88c5\u548cyum\u5b89\u88c5\u4f1a\u4ea7\u751fpath\u8def\u5f84\u4e0d\u540c\u3002\uff09\u6587\u4ef6\u6700\u540e\u6dfb\u52a0\uff1a</p> <p>LimitNOFILE=65535</p> <p>LimitNPROC=65535</p> <p>$ systemctl daemon-reload</p> <p>$ systemctl restart mysqld.service</p> <p>\u5982\u4e0d\u751f\u6548\u91cd\u670d\u52a1\u5668\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u53ea\u6709150</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>max_connections = 20,000</p>"},{"location":"my-cnf/#8max_connect_errors","title":"8)max_connect_errors","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>\u751f\u4ea7\u4e0a\u8bbe10 \u5f00\u53d1\u6d4b\u8bd5\u4e0a\u4f7f\u7528\u9ed8\u8ba4-100 \u4f5c\u7528\uff1a</p> <p>\u751f\u4ea7\u4e0a\u5f00\u542f\u621010\u6b21\uff0c\u5f00\u53d1\u6d4b\u8bd5\u4e0a\u4f7f\u7528\u9ed8\u8ba4\u5373\u4e0d\u8bbe\u3002</p> <p>max_connect_errors\u662f\u4e00\u4e2aMySQL\u4e2d\u4e0e\u5b89\u5168\u6709\u5173\u7684\u8ba1\u6570\u5668\u503c\uff0c\u5b83\u8d1f\u8d23\u963b\u6b62\u8fc7\u591a\u5c1d\u8bd5\u5931\u8d25\u7684\u5ba2\u6237\u7aef\u4ee5\u9632\u6b62\u66b4\u529b\u7834\u89e3\u5bc6\u7801\u7684\u60c5\u51b5\u3002\u5982\u679c\u9700\u8981\u8bbe\u7f6e\u6b64\u6570\u503c\uff0c\u624b\u52a8\u6dfb\u52a0\u3002\u5f53\u6b64\u503c\u8bbe\u7f6e\u4e3a10\u65f6\uff0c\u610f\u5473\u7740\u5982\u679c\u67d0\u4e00\u5ba2\u6237\u7aef\u5c1d\u8bd5\u8fde\u63a5\u6b64MySQL\u670d\u52a1\u5668\uff0c\u4f46\u662f\u5931\u8d25\uff08\u5982\u5bc6\u7801\u9519\u8bef\u7b49\u7b49\uff0910\u6b21\uff0c\u5219MySQL\u4f1a\u65e0\u6761\u4ef6\u5f3a\u5236\u963b\u6b62\u6b64\u5ba2\u6237\u7aef\u8fde\u63a5\u3002\u76f8\u5173\u7684\u767b\u5f55\u9519\u8bef\u4fe1\u606f\u4f1a\u8bb0\u5f55\u5230performance_schema.host_cache\u8868\u4e2d\u3002\u5982\u679c\u5e0c\u671b\u91cd\u7f6e\u6b64\u8ba1\u6570\u5668\u7684\u503c\uff0c\u5219\u5fc5\u987b\u91cd\u542fMySQL\u670d\u52a1\u5668\u6216\u8005\u6267\u884c</p> <p>Mysql&gt; FLUSH HOSTS;</p> <p>1 Mysql&gt; FLUSH HOSTS;</p> <p>\u5f53\u8fd9\u4e00\u5ba2\u6237\u7aef\u6210\u529f\u8fde\u63a5\u4e00\u6b21MySQL\u670d\u52a1\u5668\u540e\uff0c\u9488\u5bf9\u6b64\u5ba2\u6237\u7aef\u7684max_connect_errors\u4f1a\u6e05\u96f6\u3002\u53ef\u4ee5\u5728\u9632\u706b\u5899\u4e0a\u505a\u7b56\u7565\u9650\u5236\u67d0\u4e9bip\u7684\u8fdc\u7a0b\u8fde\u63a5\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e3a100</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>max_connect_errors =10</p>"},{"location":"my-cnf/#9innodb_flush_log_at_trx_commit","title":"9)innodb_flush_log_at_trx_commit","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>2</p> <p>\u4f5c\u7528\uff1a</p> <p>(\u6838\u5fc3\u4ea4\u6613\u7cfb\u7edf\u8bbe\u7f6e\u4e3a1\uff0c\u9ed8\u8ba4\u4e3a1\uff0c\u5176\u4ed62\u6216\u80050)\uff0c</p> <p>0\u4ee3\u8868\uff1alog buffer\u5c06\u6bcf\u79d2\u4e00\u6b21\u5730\u5199\u5165log file\u4e2d\uff0c\u5e76\u4e14log file\u7684flush(\u5237\u5230\u78c1\u76d8)\u64cd\u4f5c\u540c\u65f6\u8fdb\u884c\u3002\u8be5\u6a21\u5f0f\u4e0b\u5728\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u4e3b\u52a8\u89e6\u53d1\u5199\u5165\u78c1\u76d8\u7684\u64cd\u4f5c\u3002</p> <p>1\u4ee3\u8868\uff1a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6MySQL\u90fd\u4f1a\u628alog buffer\u7684\u6570\u636e\u5199\u5165log file\uff0c\u5e76\u4e14flush(\u5237\u5230\u78c1\u76d8)\u4e2d\u53bb\uff0c\u8be5\u6a21\u5f0f\u4e3a\u7cfb\u7edf\u9ed8\u8ba4\uff08\u56e0\u6b64\u4f1a\u4fdd\u7559\u6bcf\u4e00\u4efdredo\u65e5\u5fd7\uff09</p> <p>2\u4ee3\u8868\uff1a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6MySQL\u90fd\u4f1a\u628alog buffer\u7684\u6570\u636e\u5199\u5165log file\uff0c\u4f46\u662fflush(\u5237\u5230\u78c1\u76d8)\u64cd\u4f5c\u5e76\u4e0d\u4f1a\u540c\u65f6\u8fdb\u884c\u3002\u8be5\u6a21\u5f0f\u4e0b\uff0cMySQL\u4f1a\u6bcf\u79d2\u6267\u884c\u4e00\u6b21 flush(\u5237\u5230\u78c1\u76d8)\u64cd\u4f5c\u3002\u8be5\u6a21\u5f0f\u901f\u5ea6\u8f83\u5feb\uff0c\u4e5f\u6bd40\u5b89\u5168\uff0c\u53ea\u6709\u5728\u64cd\u4f5c\u7cfb\u7edf\u5d29\u6e83\u6216\u8005\u7cfb\u7edf\u65ad\u7535\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0a\u4e00\u79d2\u949f\u6240\u6709\u4e8b\u52a1\u6570\u636e\u624d\u53ef\u80fd\u4e22\u5931\u3002 \u9664\u975e\u4f60\u7528\u7684\u662f\u5c0f\u578b\u673a\u6216\u8005\u662f\u8d85\u5927\u89c4\u6a21mysql\u96c6\u7fa4\u4e00\u7c7b\u5982\uff1a\u6e38\u620f\u884c\u4e1a\uff0c\u90a3\u4e48\u9700\u8981\u4fdd\u7559\u6bcf\u4e00\u79d2\u7684\u4e8b\u52a1\uff0c\u5426\u5219\u8bf7\u8bbe\u62102\uff0c\u8981\u4e0d\u7136\u4f1a\u4e25\u91cd\u5f71\u54cd\u7cfb\u7edf\u6027\u80fd\u3002\u8fd9\u4e2a\u53c2\u6570\u662f5.6\u6240\u6ca1\u6709\u7684\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e3a1\uff0c\u5f71\u54cd\u7cfb\u7edf\u5199\u6027\u80fd\u3002</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_flush_log_at_trx_commit=2</p>"},{"location":"my-cnf/#10transaction_isolation","title":"10)transaction_isolation","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>READ-COMMITTED \u4f5c\u7528\uff1a</p> <p>\u6b64\u53c2\u6570\u76f4\u63a5\u51b3\u5b9a\u4e86mysql\u7684\u6027\u80fd\uff0coracle\u4e2d\u7684\u4e8b\u52a1\u9ed8\u8ba4\u7ea7\u522b\u5c31\u662fread-commited\uff0c\u800cmysql\u7684\u9ed8\u8ba4\u7ea7\u522b\u662f:repeatable-read\uff0c\u5b83\u5229\u7528\u81ea\u8eab\u72ec\u6709\u7684Gap Lock\u89e3\u51b3\u4e86\"\u5e7b\u8bfb\"\u3002\u4f46\u4e5f\u56e0\u4e3aGap Lock\u7684\u7f18\u6545\uff0c\u76f8\u6bd4\u4e8eREAD-COMMITTED\u7ea7\u522b\u7684Record Lock\uff0cREPEATABLE-READ\u7684\u4e8b\u52a1\u5e76\u53d1\u63d2\u5165\u6027\u80fd\u53d7\u5230\u5f88\u5927\u7684\u9650\u5236\u3002\u79bb\u7ea7\u522b\u7684\u9009\u62e9\u53d6\u51b3\u4e8e\u5b9e\u9645\u7684\u4e1a\u52a1\u9700\u6c42\uff08\u5b89\u5168\u4e0e\u6027\u80fd\u7684\u6743\u8861\uff09\uff0c\u5982\u679c\u4e0d\u662f\u91d1\u878d\u3001\u7535\u4fe1\u7b49\u4e8b\u52a1\u7ea7\u522b\u8981\u6c42\u5f88\u9ad8\u7684\u4e1a\u52a1\uff0c\u5b8c\u5168\u53ef\u4ee5\u8bbe\u7f6e\u6210transaction_isolation=READ-COMMITTED\u3002</p> <p>Repeatable-read: \u8fd9\u662fMySQL\u7684InnoDB\u5f15\u64ce\u9ed8\u8ba4\u7684\u9694\u79bb\u7ea7\u522b\uff0c\u5b83\u963b\u6b62\u67e5\u8be2\u7684\u4efb\u4f55\u884c\u88ab\u5176\u4ed6\u4e8b\u52a1\u66f4\u6539\u3002\u56e0\u6b64\uff0c\u963b\u585e\u4e0d\u53ef\u91cd\u590d\u8bfb\uff0c\u800c\u4e0d\u662f\u5e7b\u8bfb\u3002\u4e5f\u5c31\u662f\u8bf4\u5728\u53ef\u91cd\u590d\u8bfb\u4e2d\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u5e7b\u8bfb\u3002\u91cd\u590d\u8bfb\u4f7f\u7528\u4e00\u79cd\u4e2d\u7b49\u4e25\u683c\u7684\u9501\u5b9a\u7b56\u7565\uff0c\u4ee5\u4fbf\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u67e5\u8be2\u90fd\u80fd\u770b\u5230\u6765\u81ea\u76f8\u540c\u5feb\u7167(\u5373\u4e8b\u52a1\u542f\u52a8\u65f6\u7684\u6570\u636e)\u7684\u6570\u636e\u3002\u5f53\u62e5\u6709\u8be5\u7ea7\u522b\u7684\u4e8b\u52a1\u6267\u884c UPDATE ... WHERE, DELETE ... WHERE, SELECT ... FOR UPDATE\u548cLOCK IN SHARE MODE\u64cd\u4f5c\u65f6\uff0c\u5176\u4ed6\u4e8b\u52a1\u53ef\u80fd\u9700\u8981\u7b49\u5f85\u3002 Read-Committed-\u63a8\u8350: \u4e8b\u52a1\u65e0\u6cd5\u770b\u5230\u6765\u81ea\u5176\u4ed6\u4e8b\u52a1\u7684\u672a\u63d0\u4ea4\u6570\u636e\uff0c\u4f46\u53ef\u4ee5\u770b\u5230\u5f53\u524d\u4e8b\u52a1\u542f\u52a8\u540e\u53e6\u4e00\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u7684\u6570\u636e\u3002\u5f53\u62e5\u6709\u8fd9\u79cd\u7ea7\u522b\u7684\u4e8b\u52a1\u6267\u884c UPDATE ... WHERE or DELETE ... WHERE\u64cd\u4f5c\u65f6\uff0c\u5176\u4ed6\u4e8b\u52a1\u53ef\u80fd\u9700\u8981\u7b49\u5f85\u3002\u4f46\u662f\u8be5\u4e8b\u52a1\u53ef\u4ee5\u6267\u884c SELECT ... FOR UPDATE, and LOCK IN SHARE MODE\u64cd\u4f5c\uff0c\u5176\u4ed6\u4e8b\u52a1\u4e0d\u9700\u8981\u7b49\u5f85\u3002 \u4e32\u884c\u5316\uff08SERIALIZABLE\uff09-\u6781\u529b\u4e0d\u63a8\u8350\uff0c\u4e32\u884c\u5316\u9694\u79bb\u7ea7\u522b\u662f\u6700\u9ad8\u7684\u9694\u79bb\u7ea7\u522b\uff0c\u5b83\u4f7f\u7528\u4e86\u6700\u4fdd\u5b88\u7684\u9501\u7b56\u7565\u3002\u5b83\u963b\u6b62\u4efb\u4f55\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u6216\u66f4\u6539\u6b64\u4e8b\u52a1\u8bfb\u53d6\u7684\u6570\u636e\uff0c\u76f4\u5230\u8be5\u4e8b\u52a1\u5b8c\u6210\u3002\u7b80\u5355\u7684\u6765\u8bf4\uff0c\u5c31\u662f\u4e00\u4e2a\u4e8b\u52a1\u4e00\u4e2a\u4e8b\u52a1\u7684\u6765\u6267\u884c\uff0c\u663e\u7136\u6027\u80fd\u4f1a\u5f88\u4f4e\u3002\u5728\u8fd9\u79cd\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u7684\u76f8\u540c\u67e5\u8be2\u53ef\u4ee5\u53cd\u590d\u6267\u884c\uff0c\u6bcf\u6b21\u67e5\u8be2\u7ed3\u679c\u662f\u4e00\u6837\u7684\u3002\u4ece\u5f53\u524d\u4e8b\u52a1\u5f00\u59cb\u6267\u884c\uff0c\u4efb\u4f55\u66f4\u6539\u53e6\u4e00\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u7684\u6570\u636e\u7684\u5c1d\u8bd5\u90fd\u4f1a\u5bfc\u81f4\u5f53\u524d\u4e8b\u52a1\u7b49\u5f85\uff08\u963b\u585e\uff09\u3002\u8fd9\u662fSQL\u6807\u51c6\u6307\u5b9a\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\uff08\u6ce8\u610f\u4e0d\u662fMySQL\uff09\u3002\u5728\u5b9e\u8df5\u4e2d\uff0c\u8fd9\u79cd\u4e25\u683c\u7a0b\u5ea6\u662f\u5f88\u5c11\u9700\u8981\u7684\u3002 \u8bfb\u672a\u63d0\u4ea4\uff08READ-UNCOMMITTED\uff09-\u5b83\u662f\u6700\u4f4e\u7684\u9694\u79bb\u7ea7\u522b\uff0c\u867d\u7136\u6027\u80fd\u6700\u9ad8\uff0c\u4f46\u4e5f\u4e0d\u63a8\u8350 \u5b83\u4f1a\u8bfb\u53d6\u5230\u5176\u4ed6\u4e8b\u52a1\u4fee\u6539\u5c1a\u672a\u63d0\u4ea4\u7684\u6570\u636e\uff0c\u4f7f\u7528\u6b64\u9694\u79bb\u7ea7\u522b\u5c31\u9700\u8981\u975e\u5e38\u5c0f\u5fc3\uff0c\u8ba4\u8bc6\u5230\u8fd9\u79cd\u7ea7\u522b\u4e0b\u7684\u67e5\u8be2\u7ed3\u679c\u53ef\u80fd\u4e0d\u4e00\u81f4\u6216\u4e0d\u53ef\u590d\u5236\uff0c\u8fd9\u53d6\u51b3\u4e8e\u5176\u4ed6\u4e8b\u52a1\u540c\u65f6\u5728\u505a\u4ec0\u4e48\u3002\u901a\u5e38\uff0c\u5177\u6709\u6b64\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u53ea\u6267\u884c\u67e5\u8be2\uff0c\u800c\u4e0d\u6267\u884c\u63d2\u5165\u3001\u66f4\u65b0\u6216\u5220\u9664\u64cd\u4f5c\u3002</p> <p>\u5728\u5b9e\u9645\u73af\u5883\u4e2d\uff0c\u5e94\u5f53\u6839\u636e\u662f\u5426\u5141\u8bb8\u51fa\u73b0\u810f\u8bfb\uff08dirty reads\uff09\uff0c\u4e0d\u53ef\u91cd\u590d\u8bfb\uff08non-repeatable reads\uff09\u548c\u5e7b\u8bfb\uff08phantom reads \uff09\u73b0\u8c61\u800c\u9009\u62e9\u76f8\u5e94\u7684\u9694\u79bb\u7ea7\u522b\u3002\u4f8b\u5982\u5728\u5927\u6570\u636e\u4e2d\uff0c\u5c11\u91cf\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u4e0d\u4f1a\u5f71\u54cd\u5230\u6700\u540e\u7684\u51b3\u7b56\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u53ef\u4ee5\u4f7f\u7528\u8f83\u4f4e\u7684\u9694\u79bb\u7ea7\u522b\u4ee5\u63d0\u4ea4\u6027\u80fd\u548c\u5e76\u53d1\u6027\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u5c31\u662frepeatable-read</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>transaction_isolation = READ-COMMITTED</p>"},{"location":"my-cnf/#11explicit_defaults_for_timestamp","title":"11)explicit_defaults_for_timestamp","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>1 \u4f5c\u7528\uff1a</p> <p>mysql5.7\u9ed8\u8ba4\u5bf9\u4e8etimestamp\u5b57\u6bb5\u4f1a\u663e\u793a\u201c\u7cfb\u7edf\u5f53\u524d\u65e5\u671f\u201d\uff0c\u5c31\u7b97\u4f60\u5728\u63d2\u8868\u65f6\u8fd9\u4e2atimestamp\u5b57\u6bb5\u7559\u7a7a\uff0c\u5b83\u5728select\u51fa\u6765\u65f6\u4e5f\u4f1a\u663e\u793a\u7cfb\u7edf\u65e5\u671f\u3002\u56e0\u6b64\uff0c\u8fd9\u4e2a\u503c\u7684\u5f71\u54cd\u8303\u56f4\u662f\u4f60\u5728\u5efa\u8868\u65f6\u5bfc\u81f4\u7684\u3002</p> <p>\u7cfb\u7edf\u9ed8\u8ba4\u8fd9\u4e2a\u503c\u662f0\uff0c\u57280\u7684\u60c5\u51b5\u4e0b\uff0c\u4f60\u8981\u8ba9\u8be5\u8868\u7684timestamp\u5b57\u6bb5\u5728\u4e3anull\u65f6\u4e0d\u663e\u793a\u7cfb\u7edf\u9ed8\u8ba4\u65f6\u95f4\uff0c\u4f60\u7684\u5efa\u8868\u5fc5\u987b\u4e3a\uff1acreate table order(o_id int ,updateed_time timestamp null default null) ;</p> <p>explicit_defaults_for_timestamp \u53d8\u91cf\u4f1a\u76f4\u63a5\u5f71\u54cd\u8868\u7ed3\u6784\uff0c\u4e5f\u5c31\u662f\u8bf4explicit_defaults_for_timestamp\u7684\u4f5c\u7528\u65f6\u95f4\u662f\u5728\u8868\u5b9a\u4e49\u7684\u65f6\u5019\uff1b\u4f60\u7684update | insert \u60f3\u901a\u8fc7\u5b83\u53bb\u6539\u53d8\u884c\u4e3a\u5df2\u7ecf\u592a\u665a\u4e86\uff01</p> <p>\u56e0\u6b64\uff0c\u6211\u63a8\u8350\u628a\u8fd9\u4e2a\u503c\u8bbe\u4e3a1.</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e3a0</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>explicit_defaults_for_timestamp = 1</p>"},{"location":"my-cnf/#12join_buffer_size","title":"12)join_buffer_size","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>16M</p> <p>\u4f5c\u7528\uff1a</p> <p>\u7cfb\u7edf\u9ed8\u8ba4\u5927\u5c0f\u4e3a\uff1a512k\uff0cmac\u4e0b\u9ed8\u8ba4\u5927\u5c0f\u4e3a\uff1a256k\uff0c\u9488\u5bf9128GB\uff0c1\u4e07\u5e76\u53d1\u7684mysql\u6211\u63a8\u8350\u7ed9\u5230\u7684\u503c\u4e3a\uff1a8~16M</p> <p>\u5bf9\u4e8eJOIN KEY \u6709\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\uff0cJOIN KEY \u65e0\u7d22\u5f15mysql\u4f1a\u4f7f\u7528\u5230join_buffer_size\uff0c\u4e00\u822c\u5efa\u8bae\u8bbe\u7f6e\u4e00\u4e2a\u5f88\u5c0f\u7684 GLOBAL \u503c\uff0c\u5b8c\u4e86\u5728 SESSION \u6216\u8005 QUERY \u7684\u57fa\u7840\u4e0a\u6765\u505a\u4e00\u4e2a\u5408\u9002\u7684\u8c03\u6574\u3002\u5982\u679c\u4f60\u62cd\u8111\u888b\u7ed9\u4e5f\u4e2a4g\uff0c\u6211\u4eec\u67091000\u4e2a\u5e76\u53d1\uff0c\u5c31\u662f\u7528\u6389\u4e864T\u7684\u5185\u5b58\u3002\u3002\u30024T\u554a\u3002\u3002\u3002\u4f60\u4ee5\u4e3a\u4f60\u662f\u5c0f\u578b\u673a\u3002\u9002\u5f53\u7684\u53bb\u6539\u53d8\u5b83\u786e\u5b9e\u53ef\u4ee5\u5e26\u6765\u4e00\u5b9a\u7684\u63d0\u901f\uff0c\u4f46\u5e76\u4e0d\u662f\u8bf4\u5f88\u591a\u503c\u8d8a\u5927\u8d8a\u597d\uff0c\u4e3a\u4ec0\u4e48\u6211\u4eec\u8bbe\u7f6e\u62104m\u5462\uff1f\u6211\u4eec\u5047\u8bbe\u6211\u4eec\u7684mysql\u6240\u5728\u7684vm\u662f128gb\uff0c\u4e00\u6839\u8fd9\u6837\u7684join\uff08\u5982\u679c\u88ab\u7528\u5230\uff09\u662f4M\uff0c1\u4e07\u4e2a\u4e5f\u4e0d\u8fc7\u7528\u638940G,\u800c\u6839\u636e\u5b98\u65b9\u8bf4\u6cd5\uff0ctotal\u52a0\u5728\u4e00\u8d77\u4ea7\u751f\u7684join_buffer_size\u4e0d\u8981\u8d85\u8fc7\u4f60\u6240\u5728\u7cfb\u7edf\u768450%.\u9ed8\u8ba4512k\u80af\u5b9a\u662f\u5c0f\u4e86\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u9002\u5f53\u653e\u5bbd\uff0c\u6bd4\u5982\u8bf4\uff1a2M\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u573a\u666f\u65f6\u6211\u4eec\u53d1\u89c9\u6709\u8fd9\u6837\u7684\u9ad8\u9891\u64cd\u4f5c\uff08\u8981\u770b\u9ad8\u9891\u51fa\u73b0\u7684\u6709\u610f\u4e49\u7684sql\u7684\u6267\u884c\u8ba1\u5212\uff0c\u5e76\u786e\u8ba4\u8be5\u8ba1\u5212\u7684\uff1a\u6267\u884ccost\u5982\uff1a \"query_cost\": \"1003179606.87\"\uff0c\u5b83\u4ea7\u751f\u7684cost\u4e3a\uff1a0.93\u4e2aG,\u5982\u679c\u5b83\u771f\u7684\u5f88\u9ad8\u9891\u51fa\u73b0\u5728\u8c03\u4f18sql\u5230\u65e0\u6cd5\u8c03\u4f18\u7684\u7a0b\u5ea6\uff0c\u6211\u4eec\u4f1a\u53bb\u505aset session join_buffer_size = 1024 * 1024 * 1024;\u8fd9\u6837\u7684\u64cd\u4f5c\u3002\u800c\u4e0d\u662f\u5728\u4e00\u5f00\u59cb\u7684my.cnf\u4e2d\u53bb\u5206\u914d\u4e00\u4e2a\u66b4\u5927\u7684\u503c\uff0c\u6211\u4eec\u8fd9\u8fb9\u57fa\u4e8e128gb\uff0c1\u4e07connection\u7684\u5e76\u53d1\u6765\u8bf4\uff0c\u4f60\u7ed9\u4e2a16M\u4e0d\u7b97\u5c0f\u4e5f\u4e0d\u7b97\u591a\uff0c\u6211\u63a8\u8350\u7ed9\u52308~16M\u95f4\uff08\u8fd9\u662f\u6307\u5728\u4e00\u5f00\u59cb\uff09\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u7684\u4e3a256k</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>join_buffer_size = 16M</p>"},{"location":"my-cnf/#13tmp_table_size","title":"13)tmp_table_size","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>67108864</p> <p>\u4f5c\u7528\uff1a</p> <p>\u5982\u679c\u662f128gb\u5185\u5b58\u7684\u670d\u52a1\u5668\uff0c\u6211\u5efa\u8bae\u662f\u5728my.cnf\u4e2d\u8bbe\u621064M</p> <p>\u901a\u8fc7\u8bbe\u7f6etmp_table_size\u9009\u9879\u6765\u589e\u52a0\u4e00\u5f20\u4e34\u65f6\u8868\u7684\u5927\u5c0f\uff0c\u4f8b\u5982\u505a\u9ad8\u7ea7GROUP BY\u64cd\u4f5c\u751f\u6210\u7684\u4e34\u65f6\u8868\u3002\u9ed8\u8ba4\u7cfb\u7edf\u4e3a32M\uff0c\u5982\u679c\u5f53\u4f60\u7684\u4e34\u65f6\u8868\u8d8a\u6765\u8d8a\u591a\u52a0\u5728\u4e00\u8d77\u8d85\u8fc7\u4e86\u8fd9\u4e2a\u503c\uff0c\u90a3\u4e48mysql\u4f1a\u5728\u7cfb\u7edf\u78c1\u76d8\u4e0a\u521b\u5efa\uff0c\u8fd9\u4e2a\u503c\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\uff0c\u4e5f\u6ca1\u6709\u4e00\u4e2a\u5408\u9002\u7684\u503c\u3002\u4e00\u5f00\u59cb\u7684\u5efa\u8bae\u4e3a&gt;64M\uff0c\u7136\u540e\u5728\u8fd0\u884c\u65f6\u6211\u4eec\u901a\u8fc7\u4ee5\u4e0b\u516c\u5f0f\u6765\u505a\u4e34\u65f6\u8c03\u4f18\uff0c</p> <p>show global status like 'created_tmp%';</p> <p>\u628a\u5f97\u5230\u7684\u7ed3\u679c\u4e2d\u7684\uff1a(Created_tmp_disk_tables / Created_tmp_tables) * 100% \u5982\u679c&lt;=25%\u4e3a\u6700\u4f73\u503c\u3002\u6ce8\u610f\u4e86\uff0c\u5728\u751f\u4ea7\u65f6\u70ed\u8bbe\u5b9a\u65f6\u4e00\u5b9a\u8981\u7528\u7c7b\u4f3c\u4ee5\u4e0b\u7b97\u6cd5\uff1a</p> <p>set global tmp_table_size=6410241024\u800c\u4e0d\u662fset global tmp_table_size=64M\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e3a32M</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>tmp_table_size = 67108864</p>"},{"location":"my-cnf/#14tmpdir","title":"14)tmpdir","text":"<p>\u8fd9\u5757\u53c2\u6570\u53ef\u4ee5\u8ba9\u8fd0\u7ef4\u7ed9\u5230\uff0c\u653e\u5230\u5927\u7a7a\u95f4\u91cc\u5c31\u884c\u4e86\uff0c\u6ca1\u4ec0\u4e48\u592a\u654f\u611f\u7684\u3002</p>"},{"location":"my-cnf/#15max_allowed_packet","title":"15)max_allowed_packet","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>134217728</p> <p>\u4f5c\u7528\uff1a</p> <p>\u5982\u679c\u4f60\u7ecf\u5e38\u5728\u5e94\u7528\u5c42\u78b0\u5230\u4e86\uff1aGot a packet bigger than'max_allowed_packet' bytes\uff0c\u8fd9\u65f6\u4f60\u53ef\u4ee5\u4f7f\u7528</p> <p>show variables like '%max_allowed_packet%';\u6765\u67e5\u770b\u8fd9\u4e2a\u503c\uff0c\u8fd9\u4e2a\u503c\u6ca1\u6709\u5408\u9002\uff0c\u4e00\u822c\u5982\uff1a\u7528\u5ba2\u6237\u7aef\u5bfc\u5165\u6570\u636e\u7684\u65f6\u5019\uff0c\u9047\u5230 \u9519\u8bef\u4ee3\u7801: 1153 - Got a packet bigger than 'max_allowed_packet' bytes \u7ec8\u6b62\u4e86\u6570\u636e\u5bfc\u5165\u3002\u8fd9\u6837\u7684\u573a\u666f\u4e0b\uff0c\u5f53MySQL\u5ba2\u6237\u7aef\u6216mysqld\u670d\u52a1\u5668\u6536\u5230\u5927\u4e8emax_allowed_packet\u5b57\u8282\u7684\u4fe1\u606f\u5305\u65f6\uff0c\u5c06\u53d1\u51fa\u201c\u4fe1\u606f\u5305\u8fc7\u5927\u201d\u9519\u8bef\uff0c\u5e76\u5173\u95ed\u8fde\u63a5\u3002\u5bf9\u4e8e\u67d0\u4e9b\u5ba2\u6237\u7aef\uff0c\u5982\u679c\u901a\u4fe1\u4fe1\u606f\u5305\u8fc7\u5927\uff0c\u5728\u6267\u884c\u67e5\u8be2\u671f\u95f4\uff0c\u53ef\u80fd\u4f1a\u9047\u5230\u201c\u4e22\u5931\u4e0eMySQL\u670d\u52a1\u5668\u7684\u8fde\u63a5\u201d\u9519\u8bef\u3002</p> <p>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u5747\u6709\u81ea\u5df1\u7684max_allowed_packet\u53d8\u91cf\uff0c\u56e0\u6b64\uff0c\u5982\u4f60\u6253\u7b97\u5904\u7406\u5927\u7684\u4fe1\u606f\u5305\uff0c\u5fc5\u987b\u589e\u52a0\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e0a\u7684\u8be5\u53d8\u91cf\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u670d\u52a1\u5668\u9ed8\u8ba4max-allowed-packet\u4e3a1MB,\u53ef\u4ee5\u901a\u8fc7\u5728\u4ea4\u6362\u673a\u4e0a\u6293\u5305\u6216\u8005\u662f\u56fe\u5f62\u5316\u5206\u6790\u6765\u6293\u8fd4\u56de\u7ed3\u679c\u5224\u65ad\u3002\u4e00\u822c\u63a8\u8350\u5728128gb\u5185\u5b58\u4e0b\u8bbe\u7f6e\u7684\u7f6e\u4e3a128M.\u4e5f\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u8c03\u6574\uff1aset global max_allowed_packet = 12810241024</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>1M</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>max_allowed_packet = 134217728</p>"},{"location":"my-cnf/#16sql_mode","title":"16)sql_mode","text":"<p>\u4e0d\u9700\u8981\u53bb\u8bbe\u7f6e\uff0c\u4f7f\u7528\u9ed8\u8ba4\u7684\uff0c\u8fd9\u5757\u548c\u6027\u80fd\u65e0\u5173\u3002\u6211\u4eec\u7684\u4e2d\u53f0\u4e2d\u7684sql\u5982\u679c\u78b0\u5230\u6709sql\u62a5\u9519\uff0c\u56e0\u8be5\u662f\u5728\u6d4b\u8bd5\u73af\u5883\u4e0a\u5c31\u5df2\u7ecf\u62a5\u4e86\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u7528\u6765\u7ea6\u675f\u4f60sql\u7684\u5199\u6cd5\u7684\uff0c\u5982\u679c\u662f\u4e00\u4e2a\u4ece\u5934\u5f00\u59cb\u5f00\u53d1\u7684\u5e94\u7528\uff0c\u6211\u4eec\u6bd4\u5982\u8bf4\u7ea6\u675f\u597d\u90fd\u662fansi sql\u5199\u6cd5\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u4ea7\u54c1\uff0c\u4e0d\u8981\u53bb\u505a\u8fd9\u79cd\u753b\u86c7\u6dfb\u8db3\u7684\u505a\u6cd5\u3002</p>"},{"location":"my-cnf/#17interactive_timeout","title":"17)interactive_timeout","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>600</p> <p>\u4f5c\u7528\uff1a</p> <p>\u5355\u4f4d\u4e3as\uff0c\u7cfb\u7edf\u9ed8\u8ba4\u4e3a\uff1a28800s\u53738\u5c0f\u65f6\u3002\u5982\u679c\u8fd92\u4e2a\u503c\u592a\u5927\uff0c\u4f60\u4f1a\u53d1\u89c9\u5728mysql\u4e2d\u6709\u5927\u91cfsleep\u7684\u8fde\u63a5\uff0c\u8fd9\u4e9b\u8fde\u63a5\u53c8\u88ab\u79f0\u4e3a\uff1a\u50f5\u5c38\u8fde\u63a5\uff0c\u50f5\u5c38\u8fde\u63a5\u4e00\u591a\u4f60\u771f\u6b63\u8981\u7528\u7684\u65f6\u5019\u5c31\u4f1a\u629b\uff1atoo many connection\u8fd9\u6837\u7684\u9519\uff0c\u56e0\u6b64\u5bf9\u4e8e\u957f\u4e45\u4e0d\u7528\u7684\u8fde\u63a5\uff0c\u6211\u4eec\u4e00\u822c\u8981\u4f7f\u7528\u201c\u8e22\u51fa\u673a\u5236\u201d\uff0c\u591a\u4e45\u5bf9\u4e8e\u4e00\u4e2a\u6d3b\u52a8\u7d2f\u7684sql\u8fdb\u884c\u8e22\u5462\uff1f\u6211\u4eec\u8bf4\u5982\u679c\u6709\u4e00\u4e2a\u957f\u4e8b\u52a1\uff0c\u5b83\u8981\u6267\u884c1\u5c0f\u65f6\uff0c\u6211\u4e0d\u77e5\u9053\u8fd9\u662f\u4e0d\u662f\u5c5e\u4e8e\u6b63\u5e38\uff1f\u5f53\u7136\u5982\u679c\u4f60\u8bbe\u4e86\u592a\u77ed\uff0c\u8bf41\u5206\u949f\u5c31\u628a\u5b83\u8e22\u4e86\uff0c\u8fd8\u771f\u4e0d\u4e00\u5b9a\u8e22\u7684\u5bf9\uff0c\u6309\u7167\u6211\u4eec\u5728oracle\u4e2d\u8bbe\u7f6e\u7684best practice\u6211\u4eec\u90fd\u4f1a\u628a\u5b83\u653e\u523010\u5206\u949f\u3002\u4f60\u6709\u4e00\u6761sql\u8fde\u7740\uff0c10\u5206\u949f\u4e0d\u7528\uff0c\u6211\u5c31\u628a\u5b83\u8e22\u4e86\uff0c\u8fd9\u4e5f\u7b97\u6b63\u5e38\u3002\u4f46\u662f\u5728\u9ad8\u5e76\u53d1\u7684\u573a\u666f\u4e0b\u8fd9\u4e2atimeout\u4f1a\u7f29\u77ed\u81f33-5\u5206\u949f\uff0c\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u6211\u63d0\u5021\u6211\u4eec\u7684\u975e\u62a5\u8868\u5373\u65f6\u7c7b\u67e5\u8be2\u9700\u8981\u4f18\u5316\u5230sql\u7684\u8fd0\u884c\u65f6\u95f4\u4e0d\u8d85\u8fc7300ms\u7684\u539f\u56e0\uff0c\u56e0\u4e3a\u5728\u9ad8\u5e76\u53d1\u573a\u666f\u4e0b\uff0c\u8d85\u8fc7500ms\u7684sql\u90fd\u5df2\u7ecf\u5f88\u5938\u5f20\u4e86\u3002\u4fdd\u5b88\u70b9\u6211\u89c9\u5f97\u53ef\u4ee5\u8bbe\u621010\u5206\u948f\uff0c\u5728\u5e94\u7528\u7aef\u7531\u5176\u901a\u8fc7jdbc\u8fde\u63a5\u6570\u636e\u5e93\u7684\uff0c\u505a\u7684\u597d\u7684\u5e94\u7528\u90fd\u4f1a\u5728jdbc\u91cc\u6709\u4e00\u4e2aautoconnect\u53c2\u6570\uff0c\u8fd9\u4e2aautoconnect\u53c2\u6570\u5c31\u8981\u548cmysql\u4e2d\u7684wait_timeout\u6765\u505a\u5339\u914d\u4e86\u3002\u540c\u65f6\u5728\u5e94\u7528\u7aef\u8981\u6709\u76f8\u5e94\u7684validate sql\u4e00\u7c7b\u7684\u64cd\u4f5c\u6765keep alived\u3002\u4e0d\u8fc7\u6211\u66f4\u63a8\u8350\u4f7f\u7528\u201d\u8fde\u63a5\u6c60\u5185\u8fde\u63a5\u7684\u751f\u5b58\u5468\u671f\uff08idleConnectionTestPeriod\uff09\u201d\u6765\u505a\u8bbe\u7f6e\uff0c\u628a\u8fd9\u4e2a\u7f6e\u8bbe\u6210&lt; mysql\u5185\u7684\u8fd9\u4e24\u4e2a\u503c\u5c06\u4f1a\u662f\u6700\u597d\uff0c\u540c\u65f6\uff0cidleConnectionTestPeriod\u4f1a\u4f7f\u7528\u5230\u5f02\u6b65\u7684\u65b9\u5f0f\u53bb\u505a\u8d85\u65f6check\u3002\u5982c3p0\u4e2d\u7684\uff1aidleConnectionTestPeriod\u548ctestConnectionOnCheckin\u76f8\u5f53\u53ef\u9760</p> <ul> <li>interactive_timeout\uff1a\u4ea4\u4e92\u5f0f\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4(mysql\u5de5\u5177\u3001mysqldump\u7b49)</li> <li>wait_timeout\uff1a\u975e\u4ea4\u4e92\u5f0f\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u7684\u8fde\u63a5mysql api\u7a0b\u5e8f,jdbc\u8fde\u63a5\u6570\u636e\u5e93\u7b49</li> <li>interactive_timeout\u9488\u5bf9\u4ea4\u4e92\u5f0f\u8fde\u63a5\uff0cwait_timeout\u9488\u5bf9\u975e\u4ea4\u4e92\u5f0f\u8fde\u63a5\u3002\u6240\u8c13\u7684\u4ea4\u4e92\u5f0f\u8fde\u63a5\uff0c\u5373\u5728mysql_real_connect()\u51fd\u6570\u4e2d\u4f7f\u7528\u4e86CLIENT_INTERACTIVE\u9009\u9879\u3002</li> </ul> <pre><code>show global variables like 'wait_timeout';\n</code></pre> <ol> <li>timeout \u53ea\u662f\u9488\u5bf9\u7a7a\u95f2\u4f1a\u8bdd\u6709\u5f71\u54cd\u3002</li> <li>session\u7ea7\u522b\u7684wait_timeout\u7ee7\u627fglobal\u7ea7\u522b\u7684interactive_timeout\u7684\u503c\u3002\u800cglobal\u7ea7\u522b\u7684session\u5219\u4e0d\u53d7interactive_timeout\u7684\u5f71\u54cd\u3002</li> <li>\u4ea4\u4e92\u5f0f\u4f1a\u8bdd\u7684timeout\u65f6\u95f4\u53d7global\u7ea7\u522b\u7684interactive_timeout\u5f71\u54cd\u3002\u56e0\u6b64\u8981\u4fee\u6539\u975e\u4ea4\u4e92\u6a21\u5f0f\u4e0b\u7684timeout\uff0c\u5fc5\u987b\u540c\u65f6\u4fee\u6539interactive_timeout\u7684\u503c\u3002</li> <li>\u975e\u4ea4\u4e92\u6a21\u5f0f\u4e0b\uff0cwait_timeout\u53c2\u6570\u7ee7\u627fglobal\u7ea7\u522b\u7684wait_timeout\u3002</li> </ol> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u7cfb\u7edf\u9ed8\u8ba4\u4e3a28800</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>interactive_timeout = 600</p>"},{"location":"my-cnf/#18wait_timeout","title":"18)wait_timeout","text":"<p>\u540cinteractive_timeout\uff0c\u4e24\u4e2a\u503c\u90fd\u8bbe\u6210\u4e00\u6837\u3002</p>"},{"location":"my-cnf/#19read_buffer_size","title":"19)read_buffer_size","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>4194304</p> <p>\u4f5c\u7528\uff1a</p> <p>\u8fd9\u4e2a\u503c\u5176\u5b9e\u8f7b\u6613\u662f\u7528\u4e0d\u5230\u7684\uff0c\u56e0\u4e3a\uff0c\u5b83\u53ea\u5bf92\u79cd\u573a\u666f\u7684full table scan\u4ea7\u751f\u5f71\u54cd\u800c\u4e0d\u662f\u6240\u6709\u7684full table scan\uff0c\u540c\u65f6\u4ecemysql5.6\u4ee5\u540e\u5f00\u59cb\u6ca1\u6709\u6570\u636e\u5757\u591a\u5757\u8bfb\u7684\u529f\u80fd,\u4e0e\u662f\u5426\u8bbe\u7f6e read_buffer_size\u53c2\u6570\u65e0\u5173\u3002\u5e94\u7528\u573a\u666f\uff1a</p> <p>1\uff09SELECT INTO \u2026 OUTFILE \u2018fileName\u2018</p> <p>2\uff09When filesort is used, during merge buffers and when merged results are written to a temporary file, then writes are buffered</p> <p>\u4e00\u822c\u4fdd\u7559\u9ed8\u8ba4:64k\uff0c\u4fdd\u5b88\u4f5c\u6cd5\u662f\u8bbe\u7f6e\u57281\uff5e4M\uff0c\u4e0d\u8fc7\u5b83\u7684\u5e94\u7528\u573a\u666f\u5f88\u6709\u9650\uff0c\u5bf9\u4e8e\u4e92\u8054\u7f51\u573a\u666f\u771f\u7684\u4e0d\u592a\u7528\uff0c\u6211\u63a8\u8350\u8bbe\u62104M</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e3a64k</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>read_buffer_size = 4194304</p>"},{"location":"my-cnf/#20read_rnd_buffer_size","title":"20)read_rnd_buffer_size","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>8388608</p> <p>\u4f5c\u7528\uff1a</p> <p>\u5c31\u662f\u5f53\u6570\u636e\u5757\u7684\u8bfb\u53d6\u9700\u8981\u6ee1\u8db3\u4e00\u5b9a\u7684\u987a\u5e8f\u7684\u60c5\u51b5\u4e0b\uff0cMySQL \u5c31\u9700\u8981\u4ea7\u751f\u968f\u673a\u8bfb\u53d6\uff0c\u8fdb\u800c\u4f7f\u7528\u5230 read_rnd_buffer_size \u53c2\u6570\u6240\u8bbe\u7f6e\u7684\u5185\u5b58\u7f13\u51b2\u533a\u3002\u5b83\u7684\u9ed8\u8ba4\u4e3a256k\uff0c\u6700\u5927\u53ef\u4ee5\u8bbe\u52302G\uff0c\u5b83\u4f1a\u5bf9order by\u5173\u952e\u5b57\u8d77\u4f5c\u7528\uff0c\u5f53order by\u7684\u8ba1\u5212\u6210\u672c\u8d85\u51fa\u4e86sort_buffer_size\u540e\uff0cmysql\u4f1a\u4ea7\u7528\u968f\u673a\u8bfb\u53d6\u5e76\u6d88\u8017\u989d\u5916\u7684\u5185\u5bb9\uff0c\u5f88\u591a\u5916\u9762\u7684\u535a\u5ba2\u8bf4\u5b83\u662f\u53ea\u5bf9myisam\u5f15\u64ce\u8d77\u4f5c\u7528\uff0c\u4f46\u5176\u5b9e\u4e0d\u662f\uff0c\u8be5\u53c2\u6570\u8fd8\u771f\u7684\u8986\u76d6\u5230\u6240\u6709\u5f15\u64ce\uff0c\u4e00\u822c\u5b83\u7684\u63a8\u8350\u8bbe\u7f6e\u57288-16M\uff0c\u6211\u63a8\u83508M\uff0c\u6839\u636esql\u5206\u6790\u8ba1\u5212\u5982\u679c\u78b0\u5230\u9ad8\u9891\u7684\u67e5\u8be2\u4e14order by\u7684\u8fd4\u56de\u5305\u4f53\u90fd\u5f88\u5927\uff0c\u90a3\u4e48\u518d\u5728session\u7ea7\u522b\u53bb\u653e\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e3a256k</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>read_rnd_buffer_size = 8388608</p>"},{"location":"my-cnf/#21sort_buffer_size","title":"21)sort_buffer_size","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>4194304</p> <p>\u4f5c\u7528\uff1a</p> <p>\u6bcf\u4e2a\u4f1a\u8bdd\u6267\u884c\u6392\u5e8f\u64cd\u4f5c\u6240\u5206\u914d\u7684\u5185\u5b58\u5927\u5c0f\u3002\u60f3\u8981\u589e\u5927max_sort_length\u53c2\u6570\uff0c\u9700\u8981\u589e\u5927sort_buffer_size\u53c2\u6570\u3002\u5982\u679c\u5728SHOW GLOBAL STATUS\u8f93\u51fa\u7ed3\u679c\u4e2d\u770b\u5230\u6bcf\u79d2\u8f93\u51fa\u7684Sort_merge_passes\u72b6\u6001\u53c2\u6570\u5f88\u5927\uff0c\u53ef\u4ee5\u8003\u8651\u589e\u5927sort_buffer_size\u8fd9\u4e2a\u503c\u6765\u63d0\u9ad8ORDER BY \u548c GROUP BY\u7684\u5904\u7406\u901f\u5ea6\u3002\u5efa\u8bae\u8bbe\u7f6e\u4e3a1~4MB\u3002\u5f53\u4e2a\u522b\u4f1a\u8bdd\u9700\u8981\u6267\u884c\u5927\u7684\u6392\u5e8f\u64cd\u4f5c\u65f6\uff0c\u5728\u4f1a\u8bdd\u7ea7\u522b\u589e\u5927\u8fd9\u4e2a\u53c2\u6570\u3002\u6240\u8c13\u4f1a\u8bdd\u7ea7\u522b\uff0c\u6211\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4f60\u62cd\u8111\u888b\u4e00\u4e0b\uff0c\u8bf4\u6211\u8bbe\u4e2a32M,\u4f60\u6240\u5b83\u4e5810,000\u8bf7\u6c42\uff0c\u8fd9\u5f97\u591a\u5927\u5185\u5b58\u3002\u53e6\u5916\uff0c\u5343\u4e07\u8981\u6ce8\u610f\uff0c\u5728mysql\u5185\u5b58\uff0c\u5f53\u4f60\u7684sort_buffer_size\u5728\u8d85\u8fc72K\u65f6\u5728\u5e95\u5c42\u4f7f\u7528\u7684\u662fmmap()\u7684c\u51fd\u6570\u53bb\u505a\u5185\u5b58\u5206\u914d\u7684\uff0c\u800c\u4e0d\u662fmalloc()\uff0c\u505a\u8fc7c\u7684\u90fd\u77e5\u9053mmap()\u662f\u4e00\u4e2a\u77e2\u91cf\u5355\u4f4d\uff0c\u56e0\u6b64\u5b83\u4f1a\u4ed8\u51fa\u6027\u80fd\u7684\u5f71\u54cd\uff0c\u80fd\u5f71\u54cd\u591a\u5c11\u5462\uff1f\u5355\u6761sql\u5f71\u54cd\u503c\u572830%\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u503c\u4e3a1M</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>sort_buffer_size =4194304</p>"},{"location":"my-cnf/#22innodb_page_size","title":"22)innodb_page_size","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>8192</p> <p>\u4f5c\u7528\uff1a</p> <p>\u8fd9\u4e2a\u503c\u53ef\u8981\u5c0f\u5fc3\uff0c\u4e00\u822c\u5b83\u5728\u8bbe\u7f6e\u540e\u5c31\u4e0d\u80fd\u8f7b\u6613\u6539\u4e86\uff0c\u4e00\u822c\u6765\u8bf4\u6211\u4eec\u90fd\u8ba4\u4e3a\uff0c\u503c\u8d8a\u5927\u8d8a\u597d\uff0c\u4e0d\u662f\u7684\uff0c \u8fd9\u4e2a\u503c\u5b83\u7684\u539f\u7406\u662f\u8fd9\u6837\u7684\uff1asize\u8d8a\u5c0f\uff0c\u5185\u5b58\u5212\u5206\u7c92\u5ea6\u8d8a\u5927\uff0c\u4f7f\u7528\u7387\u8d8a\u9ad8\uff0c\u4f46\u662f\u4f1a\u6709\u5176\u4ed6\u95ee\u9898\uff0c\u5c31\u662f\u9650\u5236\u4e86\u7d22\u5f15\u5b57\u6bb5\u8fd8\u6709\u6574\u884c\u7684\u5927\u5c0f\u3002innodb\u5f15\u64ce\u8bfb\u53d6\u5185\u5b58\u8fd8\u6709\u66f4\u65b0\u90fd\u662f\u4e00\u9875\u4e00\u9875\u66f4\u65b0\u7684\uff0c\u8fd9\u4e2ainnodb_page_size\u51b3\u5b9a\u4e86\uff0c\u4e00\u4e2a\u57fa\u672c\u9875\u7684\u5927\u5c0f\u3002\u5e38\u7528B+Tree\u7d22\u5f15\uff0cB+\u6811\u662f\u4e3a\u78c1\u76d8\u53ca\u5176\u4ed6\u5b58\u50a8\u8f85\u52a9\u8bbe\u5907\u800c\u8bbe\u8ba1\u4e00\u79cd\u5e73\u8861\u67e5\u627e\u6811\uff08\u4e0d\u662f\u4e8c\u53c9\u6811\uff09\u3002B+\u6811\u4e2d\uff0c\u6240\u6709\u8bb0\u5f55\u7684\u8282\u70b9\u6309\u5927\u5c0f\u987a\u5e8f\u5b58\u653e\u5728\u540c\u4e00\u5c42\u7684\u53f6\u5b50\u8282\u70b9\u4e2d\uff0c\u5404\u53f6\u5b50\u8282\u70b9\u7528\u6307\u9488\u8fdb\u884c\u8fde\u63a5\u3002MySQL\u5c06\u6bcf\u4e2a\u53f6\u5b50\u8282\u70b9\u7684\u5927\u5c0f\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u9875\u7684\u6574\u6570\u500d\uff0c\u5229\u7528\u78c1\u76d8\u7684\u9884\u8bfb\u673a\u5236\uff0c\u80fd\u6709\u6548\u51cf\u5c11\u78c1\u76d8I/O\u6b21\u6570\uff0c\u63d0\u9ad8\u67e5\u8be2\u6548\u7387\u3002 \u5982\u679c\u4e00\u4e2a\u884c\u6570\u636e\uff0c\u8d85\u8fc7\u4e86\u4e00\u9875\u7684\u4e00\u534a\uff0c\u90a3\u4e48\u4e00\u4e2a\u9875\u53ea\u80fd\u5bb9\u7eb3\u4e00\u6761\u8bb0\u5f55\uff0c\u8fd9\u6837B+Tree\u5728\u4e0d\u7406\u60f3\u7684\u60c5\u51b5\u4e0b\u5c31\u53d8\u6210\u4e86\u53cc\u5411\u94fe\u8868\u3002\u6211\u4eec\u62ff\u767d\u8bdd\u6765\u8bf4\u5c31\u662f\uff1a\u4f60\u8d8a\u5927\uff0c\u7a7a\u95f4\u5229\u7528\u7387\u66f4\u9ad8\uff0c\u4f46\u662f\u8d8a\u5c0f\u5462\u8d8a\u6709\u52a9\u4e8e\u6027\u80fd\u4f46\u662f\u8fd9\u8fb9\u4e00\u5b9a\u4e00\u5b9a\u6709\u4e00\u4e2a\u201c\u4f46\u662f\u201d\uff0c\u4f46\u662f\u5c0f\u5230\u4e00\u5b9a\u7684\u91cf\u53cd\u800c\u6027\u80fd\u4e0d\u597d\uff0c\u4e3a\u4ec0\u4e48\u5462\uff1f\u592a\u5927\u4e0a\u9762\u6211\u5df2\u7ecf\u4e3e\u4f8b\u4e86\uff0c\u592a\u5c0f\u3002\u3002\u3002mysql\u7684\u9875\u95f4\u7684check point\u592a\u9891\u7e41\u3002\u600e\u4e48\u6837\u505a\u624d\u80fd\u8fbe\u5230\u4e00\u4e2a\u5408\u7406\u503c\u5462\uff1f</p> <p>\u8fd9\u4e2a\u6211\u4eec\u662f\u5728\u5168\u771f\u751f\u4ea7\u73af\u5883\u3001\u5168\u6570\u636e\u91cf\u4e0b\u7528\u6d4b\u8bd5\u5de5\u5177\u53bb\u5bf94k,8k,16k\u4e09\u79cd\u573a\u666f\u538b\u6d4b\u5f97\u5230\u7684\u541e\u5410\u91cf\u5373tps\u6765\u505a\u89c2\u5bdf\u7684\uff0c\u6211\u8fd9\u8fb9\u53ef\u4ee5\u7ed9\u51fa\u4e00\u4e2a\u63a8\u8350\u503c\uff0c\u4ee5\u5355\u8868\u8d851000w\u6761\u6570\u636e\u57fa\u4e8e\u4e2d\u53f01.1\u7684\u6570\u636e\u5e93\u7ed3\u679c\uff08\u6bcf\u4e2a\u8868\u90fd\u8d851000w\uff09\uff0c\u6211\u4eec\u5728\u8bbe\u7f6e\u8be5\u503c\u4e3a\uff1a8K\u65f6\uff0c\u5b83\u7684\u541e\u5410\u8fbe\u5230\u6700\u4f18\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>32\u4f4d\u4e0b\u9ed8\u8ba4\u4e3a8192</p> <p>64\u4f4d\u4e0b\u9ed8\u8ba4\u4e3a16384</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_page_size = 8192</p>"},{"location":"my-cnf/#23innodb_buffer_pool_size","title":"23)innodb_buffer_pool_size","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>72G</p> <p>\u4f5c\u7528\uff1a</p> <p>\u8fd9\u4e2a\u503c\u548cinnodb_buffer_pool_instances\u76f8\u8f85\u76f8\u6210\u3002\u572832\u4f4d\u673a\u5668\u4e0b\uff0cinnodb_buffer_pool_instances\u4e00\u822c\u4e3a1\uff0c\u572864\u4f4d\u673a\u5668\u4e0a\uff0c\u8fd9\u4e2a\u503c\u4e3a8-64.</p> <p>pool_instances\u5176\u5b9e\u4e3acpu\u6838\u6570\uff0c\u5b83\u7684\u4f5c\u7528\u662f\uff1a</p> <p>1\uff09\u5bf9\u4e8e\u7f13\u51b2\u6c60\u5728\u6570\u5343\u5146\u5b57\u8282\u8303\u56f4\u5185\u7684\u7cfb\u7edf\uff0c\u901a\u8fc7\u51cf\u5c11\u4e89\u7528\u4e0d\u540c\u7ebf\u7a0b\u5bf9\u7f13\u5b58\u9875\u9762\u8fdb\u884c\u8bfb\u5199\u7684\u4e89\u7528\uff0c\u5c06\u7f13\u51b2\u6c60\u5212\u5206\u4e3a\u591a\u4e2a\u5355\u72ec\u7684\u5b9e\u4f8b\u53ef\u4ee5\u63d0\u9ad8\u5e76\u53d1\u6027\u3002</p> <p>2\uff09\u4f7f\u7528\u6563\u5217\u51fd\u6570\u5c06\u5b58\u50a8\u5728\u7f13\u51b2\u6c60\u4e2d\u6216\u4ece\u7f13\u51b2\u6c60\u8bfb\u53d6\u7684\u6bcf\u4e2a\u9875\u9762\u968f\u673a\u5206\u914d\u7ed9\u5176\u4e2d\u4e00\u4e2a\u7f13\u51b2\u6c60\u5b9e\u4f8b\u3002\u6bcf\u4e2a\u7f13\u51b2\u6c60\u7ba1\u7406\u81ea\u5df1\u7684\u7a7a\u95f2\u5217\u8868\uff0c \u5237\u65b0\u5217\u8868\uff0c LRU\u548c\u8fde\u63a5\u5230\u7f13\u51b2\u6c60\u7684\u6240\u6709\u5176\u4ed6\u6570\u636e\u7ed3\u6784\uff0c\u5e76\u53d7\u5176\u81ea\u5df1\u7684\u7f13\u51b2\u6c60\u4e92\u65a5\u91cf\u4fdd\u62a4\u3002</p> <p>innodb_buffer_pool_size\u7684\u8bbe\u7f6e\u9700\u8981\u4e3apool_instance\u7684\u6574\u6570\u500d\u3002</p> <p>\u7f51\u4e0a\u5f88\u591a\u8bf4innodb_buffer_pool_size\u4e3a\u7cfb\u7edf\u768470%\uff0c\u8fd9\u662f\u9519\u7684\uff01\u56e0\u4e3a\u4f60\u771f\u7684\u8bbe\u4e8670%\u4f60\u7684swap\u7a7a\u95f4\u4f1a\u88ab\u6324\u538b\uff0c\u4f60\u4e0d\u8981\u5fd8\u4e86\u4f60\u8fd8\u6709os\uff0c\u4e0a\u9762\u8fd8\u53ef\u80fd\u6709\u76d1\u63a7agent\u7aef\u3002\u4e00\u65e6swap\u7a7a\u95f4\u88ab\u6324\u538b\u540e\u4f60\u7684mysql\u53cd\u9762\u4e25\u91cd\u62d6\u6162\u8bfb\u5199\u3002</p> <p>\u6b64\u5904\u5f3a\u70c8\u5efa\u8bae\u8bbe\u6210\u5185\u5b58\u768420%-65%\u95f4\uff08\u72ec\u7acb\u7684mysql\u670d\u52a1\u5668\uff09\uff0c\u4e3a\u4ec0\u4e48\u6709\u4e00\u4e2a20%\u5462\uff1f\u5bf9\u4e8e&lt;4gb\u7684mysql\u7528\u670d\u52a1\u5668\u6765\u8bf4\u6309\u716720%\u7cfb\u7edf\u5185\u5b58\u6765\u8bbe\u7f6e\u3002\u7531\u4e8e\u6211\u4eec\u662f128gb\u7684\u5185\u5b58\uff0c\u6b64\u5904\u6211\u5efa\u8bae\u4f7f\u752872G,\u5982\u679c\u5185\u5b58\u8d85\u8fc7128gb\uff0c\u4e00\u822c\u6211\u4eec\u4f1a\u628apool instance\u8bbe\u621016\u4e2a\uff0c\u6bcf\u4e2a\u5f00\u542f10g\u5de6\u53f3\u7684buffer_pool_size\uff0c\u5bf9\u4e8e256gb\u5185\u5b58\u7684\u670d\u52a1\u5668\u6765\u8bf4\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u8bbe\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e3a64</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_buffer_pool_size = 72G</p>"},{"location":"my-cnf/#24innodb_buffer_pool_instances-8","title":"24)innodb_buffer_pool_instances = 8","text":"<p>\u8fd9\u4e2a\u53c2\u6570\u540cinnodb_buffer_pool_size\u4e00\u8d77\u8bb2\u89e3\u4e86\u3002</p>"},{"location":"my-cnf/#25innodb_buffer_pool_load_at_startup","title":"25)innodb_buffer_pool_load_at_startup","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>0</p> <p>\u4f5c\u7528\uff1a</p> <p>\u8fd9\u4e24\u4e2a\u53c2\u6570\u51e0\u4e4e\u6ca1\u4eba\u7528\u4e00\u822cdba\u4e5f\u4e0d\u66fe\u542c\u8bf4\u8fc7\uff0c\u5b83\u662f\u4ec0\u4e48\u610f\u601d\u5462\uff1fMysql\u5728\u7b2c\u4e00\u6b21\uff08\u91cd\u542f\uff09\u65f6\uff0c\u5b83\u7684buffer_pool_size\u4e2d\u662f\u7a7a\u7684\uff0c\u968f\u7740mysql\u8fd0\u884c\u65f6\u95f41-2\u5c0f\u65f6\u540e\uff0c\u5b83\u7684buffer_pool_size\u91cc\u5f00\u59cb\u88ab\u585e\u5165\u4e1c\u897f\uff0c\u5b83\u5206\u4e3aold block\u4e0enew block\uff0c\u800c\u6b64\u65f6mysql\u6027\u80fd\u5f00\u59cb\u4e00\u70b9\u70b9\u8bfb\u5199\u6548\u7387\u4e0a\u53bb\u4e86\uff0c\u90a3\u662f\u56e0\u4e3a\u5728buffer_pool_size\u6ca1\u6709\u653e\u5165\u4e1c\u897f\u65f6\uff0cmysql\u5f88\u591a\u8bfb\u5199\u53d1\u751f\u5728\u786c\u76d8\u4e0a\uff0c\u4ece\u786c\u76d8\u5230\u5185\u5b58\u7684\u52a0\u8f7d\u8fc7\u7a0b\u662f\u4e00\u4e2a\u6bd4\u8f83\u6f2b\u957f\u548c\u8017\u65f6\u7684\u8fc7\u7a0b\uff0c\u56e0\u6b64\u6211\u4eec\u5f80\u5f80\u4f1a\u8bbe\u4e00\u4e2astartup=1\u4ee5\u52a0\u5feb\u8fd9\u4e2a\u201c\u9884\u70ed\u201d\u8fc7\u7a0b\uff0c\u5b83\u4e0e\u53c2\u6570shutdown\u914d\u5408\u4f7f\u7528\uff0c\u5373\u76f8\u5f53\u4e8e\u628a\u4e0a\u6b21\u4f7f\u7528\u7684innot_db_buffer_pool\u91cc\u7684\u4e1c\u897f\u5728\u542f\u52a8\u65f6\u5148\u505a\u4e00\u6b21\u52a0\u8f7d\uff0c\u4ee5\u52a0\u5febmysql\u7684\u6027\u80fd\u3002\u5b83\u4f1a\u5728innodb\u7684\u6570\u636e\u76ee\u5f55\u4e2d\u751f\u6210\u4e00\u4e2a\u6587\u4ef6\uff1aib_buffer_pool\u3002\u9ad8\u5ea6\u6ce8\u610f\uff1a\u52a0\u5165\u4e86startup\u548cshutdown=1\u65f6\uff0cmysql\u7684\u542f\u52a8\u8fc7\u7a0b\u4f1a\u6bd4\u8f83\u6162\uff0c\u5982\u679c\u4f60\u4e0a\u6b21\u7684dump\u51fa\u7684buffer_pool\u91cc\u7684\u4e1c\u897f\u670950\u591ag\u90a3\u4e48mysql\u542f\u52a8\u65f6\u7684\u52a0\u8f7d\u8fc7\u7a0b\u4f1a\u53d8\u5f97\u6bd4\u8f83\u6162\u3002\u8fd9\u4e2a\u503c\u5f88\u591a\u4eba\u4f7f\u7528\u9ed8\u8ba4\u76840\uff08\u4e0d\u5f00\u542f\uff09\uff0c\u5b83\u7684\u5f71\u54cd\u5c31\u662f\u4f60\u5728mysql\u91cd\u542f\u540e\uff0c\u4e00\u5f00\u59cb\u4f60\u7684\u7cfb\u7edf\u8bfb\u5199\u6027\u80fd\u4e0d\u5982\u5728\u4f60\u7cfb\u7edf\u8fd0\u884c\u4e862-4\u5c0f\u65f6\uff08\u89c6db\u8bfb\u5199\u800c\u5b9a\uff09\u53cd\u800c\u5b83\u7684\u8bfb\u5199\u6027\u80fd\u53d8\u597d\u4e86\u3002\u4e0d\u8bbe\u4f7f\u7528\u9ed8\u8ba4\u503c\uff080\uff09\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u4e0d\u914d\u7684\u8bdd\u7cfb\u7edf\u9ed8\u8ba4\u4e3a0</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_buffer_pool_load_at_startup = 0</p>"},{"location":"my-cnf/#26innodb_buffer_pool_dump_at_shutdown","title":"26)innodb_buffer_pool_dump_at_shutdown","text":"<p>\u540c\u4e0a\u9762\u7684startup\u53c2\u6570\u4ee5\u53ca\u89e3\u8bf4</p>"},{"location":"my-cnf/#27innodb_lru_scan_depth","title":"27)innodb_lru_scan_depth","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>2000</p> <p>\u4f5c\u7528\uff1a</p> <p>innodb_io_capactiy \u5728sas 15000\u8f6c\u7684\u4e0b\u914d\u7f6e800\u5c31\u53ef\u4ee5\u4e86\uff0c\u5728ssd\u4e0b\u9762\u914d\u7f6e2000\u4ee5\u4e0a\u3002</p> <p>\u53ef\u4f7f\u7528\u9ed8\u8ba4\u914d\u7f6e\u3002\u5373\u4e0d\u8bbe\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e3a200\uff0cdb\u541e\u5410\u91cf\u4e0a\u4e0d\u53bb\u3002</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_lru_scan_depth = 2000</p>"},{"location":"my-cnf/#28innodb_lock_wait_timeout","title":"28)innodb_lock_wait_timeout","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>60</p> <p>\u4f5c\u7528\uff1a</p> <p>\u6211\u4eec\u4e00\u822c\u4f1a\u78b0\u5230\uff0cmysql innodb_lock_wait_timeout\u8fd9\u4e2a\u9519\uff0c\u8fd9\u4e2a\u9519\u662f\u6162sql\u5bfc\u81f4\uff0c\u5b83\u4ee3\u8868\u7684\u662f\u6162sql\u7684\u4e8b\u52a1\u9501\u8d85\u8fc7\u4e86mysql\u9501\u8d85\u65f6\u7684\u8bbe\u7f6e\u4e86\u3002\u9ed8\u8ba4\u8fd9\u4e2a\u503c\u4e3a\uff1a50s\uff0c\u8fd9\u4e2a\u503c\u662f\u53ef\u4ee5\u52a8\u6001\u6539\u53d8\u7684\uff0c\u6211\u4e0d\u5efa\u8bae\u53bb\u6539\u8fd9\u4e2a\u503c\uff0c\u56e0\u4e3a\u4e00\u4e2asql\u80fd\u8fbe50s\u8fd9\u5f97\u591a\u5938\u5f20\uff1f</p> <p>\u52a8\u6001\u6539\u53d8\u547d\u4ee4\u5982\u4e0b\uff1a</p> <p>SHOW GLOBAL VARIABLES LIKE 'innodb_lock_wait_timeout';</p> <p>SET GLOBAL innodb_lock_wait_timeout=500;</p> <p>SHOW GLOBAL VARIABLES LIKE 'innodb_lock_wait_timeout';</p> <p>\u628a\u5b83\u8bbe\u621060s\u8db3\u591f\u4e86\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e3a50s</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_lock_wait_timeout = 60</p>"},{"location":"my-cnf/#29innodb_io_capacity_max","title":"29)innodb_io_capacity_max","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>8000</p> <p>\u4f5c\u7528\uff1a</p> <p>\u8fd9\u4e2a\u503c\u5f88\u91cd\u8981\uff0c\u5b83\u5bf9\u8bfb\u65e0\u6548\uff0c\u5bf9\u5199\u5f88\u6709\u51b3\u5b9a\u610f\u4e49\u3002</p> <p>\u5b83\u4f1a\u76f4\u63a5\u51b3\u5b9amysql\u7684tps\uff08\u541e\u5410\u6027\u80fd\uff09\uff0c\u8fd9\u8fb9\u7ed9\u51fa\u53c2\u8003\uff1asata/sas\u786c\u76d8\u8fd9\u4e2a\u503c\u5728200. sas raid10: 2000\uff0cssd\u786c\u76d8\uff1a8000\uff0c fusion-io\uff08\u95ea\u5b58\u5361\uff09\uff1a25,000-50,000</p> <p>\u672c\u8c03\u4f18\u57fa\u4e8e\u7684\u662fssd\uff0c\u6b64\u503c\u8bbe\u7f6e\u4e3a8000\uff0c\u7b14\u8005\u4e0a\u4e00\u5bb6\u516c\u53f8\u4e92\u8054\u7f51\u91d1\u878d\u662f\u628a\u4e00\u6574\u4e2amysql\u6254\u5230\u4e86\u95ea\u5b58\u5361\u91cc\u7684\uff0c\u56e0\u6b64\u8bbe\u7f6e\u7684\u503c\u4e3a\uff1a50,000.</p> <p>\u9700\u8981\u6839\u636epaas\u6216\u8005\u662fias\u7684vm\u7684\u786c\u76d8\u6027\u53f7\u6765\u5b9a</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e3a200\uff0c\u7cfb\u7edf\u541e\u5410\u4e0a\u4e0d\u53bb\u3002</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_io_capacity_max = 8000</p>"},{"location":"my-cnf/#30innodb_io_capacity","title":"30)innodb_io_capacity","text":"<p>\u5b83\u662fio_capacity_max\u7684\u4e00\u534a\uff0c\u540c\u6837\uff0c\u5b83\u5bf9\u8bfb\u65e0\u6548\u5bf9\u5199\u6709\u51b3\u5b9a\u610f\u4e49\u3002</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_io_capacity_max = 4000</p>"},{"location":"my-cnf/#31innodb_flush_method","title":"31)innodb_flush_method","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>O_DIRECT</p> <p>\u4f5c\u7528\uff1a</p> <p>\u63a8\u8350\u4f7f\u7528O_DIRECT\u3002\u8ba9\u6211\u4eec\u4e00\u8d77\u6765\u7406\u89e3\u4e00\u4e0b\uff0c\u5b83\u67093\u79cd\u6a21\u5f0f\uff1a</p> <p>1\uff09fdatasync\uff0c\u4e0a\u9762\u6700\u5e38\u63d0\u5230\u7684fsync(int fd)\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u4f5c\u7528\u662fflush\u65f6\u5c06\u4e0efd\u6587\u4ef6\u63cf\u8ff0\u7b26\u6240\u6307\u6587\u4ef6\u6709\u5173\u7684buffer\u5237\u5199\u5230\u78c1\u76d8\uff0c\u5e76\u4e14flush\u5b8c\u5143\u6570\u636e\u4fe1\u606f(\u6bd4\u5982\u4fee\u6539\u65e5\u671f\u3001\u521b\u5efa\u65e5\u671f\u7b49)\u624d\u7b97flush\u6210\u529f\u3002\u5b83\u5bf9\u78c1\u76d8\u7684io\u8bfb\u5199\u4f1a\u5f88\u9891\u7e41</p> <p>2\uff09O_DIRECT\u5219\u8868\u793a\u6211\u4eec\u7684write\u64cd\u4f5c\u662f\u4ecemysql innodb buffer\u91cc\u76f4\u63a5\u5411\u78c1\u76d8\u4e0a\u5199\uff0c\u5b83\u4f1a\u5145\u5206\u5229\u7528\u7f13\u5b58</p> <p>3\uff09O_DIRECT\u6a21\u5f0f\u7684free\u5185\u5b58\u4e0b\u964d\u6bd4\u8f83\u6162\uff0c\u56e0\u4e3a\u5b83\u662f\u636e\u6587\u4ef6\u7684\u5199\u5165\u64cd\u4f5c\u662f\u76f4\u63a5\u4ecemysql innodb buffer\u5230\u78c1\u76d8\u7684\uff0c\u5e76\u4e0d\u7528\u901a\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u7684\u7f13\u51b2\uff0c\u800c\u771f\u6b63\u7684\u5b8c\u6210\u4e5f\u662f\u5728flush\u8fd9\u6b65,\u65e5\u5fd7\u8fd8\u662f\u8981\u7ecf\u8fc7OS\u7f13\u51b2\uff0cO_DIRECT\u5728SQL\u541e\u5410\u80fd\u529b\u4e0a\u8f83\u597d\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u5b83\u7684\u9ed8\u8ba4\u503c\u4e3afdatasync\u3002</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_flush_method = O_DIRECT</p>"},{"location":"my-cnf/#32innodb_file_format","title":"32)innodb_file_format","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>Barracuda</p> <p>\u4f5c\u7528\uff1a</p> <p>\u63a8\u8350\u4f7f\u7528Barracuda\u6a21\u5f0f</p> <p>\u5b83\u662f\u542f\u7528\u8868\u538b\u7f29\u7528\u7684\uff0c\u5982\uff1a</p> <p>CREATE TABLE <code>test_1</code> (</p> <p><code>x</code> int(11) DEFAULT NULL</p> <p>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=COMPRESSED KEY_BLOCK_SIZE=8;</p> <p>\u5efa\u5b8c\u540e\u53ef\u4ee5\u901a\u8fc7\uff1ashow table status like 'test_1';\u6765\u67e5\u770b\u662f\u5426\u5df2\u7ecf\u542f\u7528\u4e86\u8868\u538b\u7f29\u4e86\u3002</p> <p>innodb_file_format\u6709\u8fd9\u4e48\u51e0\u79cd\u6a21\u5f0f\uff1a</p> <p>Antelope-\u7f9a\u7f8a\u6a21\u5f0f\uff0c\u652f\u6301Redundant\uff08\u5197\u4f59\uff09\u3001Compact\uff08\u7d27\u51d1\uff09\u6a21\u5f0f Barracuda-\u68ad\u5b50\u9c7c,\u662fInnoDB Plugin\u652f\u6301\u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u5728\u539f\u6765\u7684\u57fa\u7840\u4e0a\u65b0\u589e\u4e86\u4e24\u79cd\u6570\u636e\u8868\u683c\u5f0f\u7684\u652f\u6301\uff1aDynamic \u548c Compressed \u56e0\u6b64\u6211\u63a8\u8350\u4f7f\u7528\uff1aBarracude\u6a21\u5f0f\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u517c\u5bb9\u5176\u5b83\u6570\u636e\u6a21\u5f0f\u3002</p> <p>\u5b83\u4e5f\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u6539\u53d8\uff1aSET GLOBAL innodb_file_format_max = barracuda;</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u5b83\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f\u53eb\u201c\u8054\u5408\u6a21\u5f0f\u201d\uff0c\u5373\u4e0d\u662f\u68f1\u5b50\u9c7c\u4e5f\u4e0d\u662f\u7f9a\u7f8a\u3002</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_file_format = Barracuda</p>"},{"location":"my-cnf/#33innodb_file_format_max","title":"33)innodb_file_format_max","text":"<p>\u8fd9\u4e2a\u53c2\u6570\u5fc5\u987b\u548cinnodb_file_format\u53c2\u6570\u4e00\u81f4\uff0c\u4e00\u5b9a\u8bb0\u4f4f\uff0c\u8981\u4e0d\u7136\u4e0d\u751f\u6548\u3002</p>"},{"location":"my-cnf/#34innodb_log_group_home_dir-redolog","title":"34)innodb_log_group_home_dir = /redolog/","text":"<p>\u8fd9\u4e2a\u5c31\u4e0d\u7528\u89e3\u91ca\u4e86\uff0c\u592a\u50bb\u74dc\u4e86\u3002\u8fd9\u79cd\u8def\u5f84\u7684\u90fd\u53ef\u7531\u8fd0\u7ef4\u51b3\u5b9a\uff0c\u8bb0\u5f97\u6302\u5728\u5927\u78c1\u76d8\u4e0b\u3002</p>"},{"location":"my-cnf/#35innodb_undo_directory-undolog","title":"35)innodb_undo_directory = /undolog/","text":"<p>\u8fd9\u4e2a\u5c31\u4e0d\u7528\u89e3\u91ca\u4e86\uff0c\u592a\u50bb\u74dc\u4e86\u3002\u8fd9\u79cd\u8def\u5f84\u7684\u90fd\u53ef\u7531\u8fd0\u7ef4\u51b3\u5b9a\uff0c\u8bb0\u5f97\u6302\u5728\u5927\u78c1\u76d8\u4e0b\u3002</p>"},{"location":"my-cnf/#36innodb_undo_logs-128","title":"36)innodb_undo_logs = 128","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>128</p> <p>\u4f5c\u7528\uff1a</p> <p>\u6307\u5b9a\u56de\u6eda\u6bb5\u7684\u4e2a\u6570\uff08\u65e9\u671f\u7248\u672c\u8be5\u53c2\u6570\u540d\u5b57\u662finnodb_rollback_segments\uff09\uff0c\u9ed8\u8ba4128\u4e2a\u3002\u6bcf\u4e2a\u56de\u6eda\u6bb5\u53ef\u540c\u65f6\u652f\u63011024\u4e2a\u5728\u7ebf\u4e8b\u52a1\u3002\u8fd9\u4e9b\u56de\u6eda\u6bb5\u4f1a\u5e73\u5747\u5206\u5e03\u5230\u5404\u4e2aundo\u8868\u7a7a\u95f4\u4e2d\u3002\u8be5\u53d8\u91cf\u53ef\u4ee5\u52a8\u6001\u8c03\u6574\uff0c\u4f46\u662f\u7269\u7406\u4e0a\u7684\u56de\u6eda\u6bb5\u4e0d\u4f1a\u51cf\u5c11\uff0c\u53ea\u662f\u4f1a\u63a7\u5236\u7528\u5230\u7684\u56de\u6eda\u6bb5\u7684\u4e2a\u6570\u3002\u73b0\u5728SSD\u975e\u5e38\u666e\u53ca\u3002innodb_undo_logs\u53ef\u4ee5\u9ed8\u8ba4\u4e3a128\u4e0d\u53d8\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u5c31\u662f128</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_undo_logs = 128</p>"},{"location":"my-cnf/#37innodb_undo_tablespaces","title":"37)innodb_undo_tablespaces","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>3</p> <p>\u4f5c\u7528\uff1a</p> <p>\u63a8\u8350\uff1a3\uff0c\u9ed8\u8ba4\u4e3a3</p> <p>\u5b9a\u5355\u72ec\u5b58\u653e\u7684undo\u8868\u7a7a\u95f4\u4e2a\u6570\uff0c\u4f8b\u5982\u5982\u679c\u8bbe\u7f6e\u4e3a3\uff0c\u5219undo\u8868\u7a7a\u95f4\u4e3aundo001\u3001undo002\u3001undo003\uff0c\u6bcf\u4e2a\u6587\u4ef6\u521d\u59cb\u5927\u5c0f\u9ed8\u8ba4\u4e3a10M\u3002\u8be5\u53c2\u6570\u6211\u4eec\u63a8\u8350\u8bbe\u7f6e\u4e3a\u5927\u4e8e\u7b49\u4e8e3\uff0c\u66f4\u591a\u7684\u788e\u7247\u6587\u4ef6\u4f1a\u5f71\u54cd\u78c1\u76d8\u7684io\u6027\u80fd\uff0c\u800c\u4e0d\u591f\u788e\u7247\u540c\u6837\u5f71\u54cdmysql\u7684\u541e\u5410\u7387\uff0c\u5728ssd\u4e0a\u4e00\u822c\u6700\u4f73\u7684\u914d\u7f6e\u57283.\u5982\u679c\u53ea\u67091\u4e2aundo\u8868\u7a7a\u95f4\uff0c\u90a3\u4e48\u6574\u4e2a\u7cfb\u7edf\u5728\u6b64\u8fc7\u7a0b\u4e2d\u5c06\u5904\u4e8e\u4e0d\u53ef\u7528\u72b6\u6001\u3002\u4e3a\u4e86\u5c3d\u53ef\u80fd\u964d\u4f4etruncate\u5bf9\u7cfb\u7edf\u7684\u5f71\u54cd\uff0c\u5efa\u8bae\u5c06\u8be5\u53c2\u6570\u6700\u5c11\u8bbe\u7f6e\u4e3a3\uff1b</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e3a\uff1a3</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_undo_tablespaces = 3</p>"},{"location":"my-cnf/#38innodb_flush_neighbors","title":"38)innodb_flush_neighbors","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>\u63a8\u8350\u4e3a\uff1a0</p> <p>\u4f5c\u7528\uff1a</p> <p>\u8fd9\u4e2a\u53c2\u6570\u5f88\u8981\u7d27\uff0c\u76ee\u524d\u5728ssd\u76db\u884c\u7684\u60c5\u51b5\u4e0b\u6211\u4eec\u90fd\u628a\u5b83\u8bbe\u4e3a0\uff08\u4e0d\u5f00\u542f\uff09\uff0c\u5982\u679c\u4f60\u8bbe\u7f6e\u6210\u4e861\u5373\u5f00\u542f\uff08\u9ed8\u8ba4\u72b6\u6001\uff09InnoDB\u5c31\u4f1a\u5237\u65b0\u4e00\u4e2aextent\u4e2d\u7684\u6240\u6709\u9875\u9762\uff0c\u56e0\u4e3aSSD\u5728\u968f\u673aIO\u4e0a\u6ca1\u6709\u989d\u5916\u8d1f\u8f7d\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u542f\u7528\u8be5\u7279\u6027\uff0c\u5f00\u542f\u4e86\u53cd\u800c\u591a\u6b64\u4e00\u53e5\u3002\u4e0b\u9762\u7ed9\u51fa\u4e00\u6bb5mysql5.7\u6e90\u7801\u7f16\u8bd1\u524d\u7a0b\u5e8f\u5458\u770b\u7684readme\u91cc\u7684\u4e00\u53e5\u8bdd\uff1a</p> <p>This new default changes MySQL to cater for SSDs and fast storage devices by default. We expect that for the majority of users, this will result in a small performance gain. Users who are using slower hard drives may see a performance loss, and are encouraged to revert to the previous defaults by setting innodb_flush_neighbors=1.</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u5b83\u7684\u9ed8\u8ba4\u662f1\uff0c\u4e0d\u662f0.\u8fd9\u4e2a\u53c2\u6570\u5bf9\u673a\u6027\u786c\u76d8\u6765\u8bf4\u5f88\u6709\u6548\uff0c\u53ef\u4ee5\u51cf\u5c11\u968f\u673aio\uff0c\u589e\u52a0\u6027\u80fd\u3002\u5982\u679c\u662fssd\u7c7b\u78c1\u76d8\uff0c\u5efa\u8bae\u8bbe\u7f6e\u4e3a0\uff0c\u53ef\u4ee5\u66f4\u5feb\u7684\u5237\u65b0\u810f\u9875\u3002\u5982\u679c\u4f60\u628a\u5b83\u8bbe\u4e3a1\u540c\u65f6\u53c8\u662fssd\u90a3\u5c31\u663e\u5f97\u6ca1\u5fc5\u8981\u4e86\u3002\u8fd9\u8fb9\u666e\u53ca\u4e00\u4e0b\u5c0f\u77e5\u8bc6\uff0c\u5982\u679c\u4f60\u88c5\u8fc78.0\uff0c\u4f60\u53ef\u4ee5\u53bb\u770b\u4e00\u4e0b\uff0c8.0\u5df2\u7ecf\u628a\u8fd9\u4e2a\u9ed8\u8ba4\u503c\u8bbe\u4e3a0\u4e86\u3002</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_flush_neighbors = 0</p>"},{"location":"my-cnf/#39innodb_log_file_size","title":"39)innodb_log_file_size","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>\u7b2c1\u6b65\uff1ashow engine innodb status;</p> <p>\u5f97\u5230\uff1a</p> <p>Log sequence number 2944118284 Log flushed up to 2944118283 Last checkpoint at 2724318261 \u7b2c2\u6b65\uff1a\u8bbeinnodb_log_file_size$=log Log sequence number-last checkpoint at=select (2944118284-2724318261)/1024/1024;=209M</p> <p>\u7b2c3\u6b65\uff1a\u8bbe\u771f\u6b63\u7684innodb_log_file_size&lt;=(innodb_log_files_in_group * innodb_log_file_size) * 0.75,innodb_log_files_in_group\u4e3a2\uff08\u9ed8\u8ba4\uff09\uff0c\u5f97\uff1a</p> <p>\u7b2c4\u6b65\uff1aselect 209/(2 * 0.75);=139.33\u5373\uff1a139m\uff0c\u6b64\u65f6\u53ef\u628a\u8fd9\u4e2a\u503c\u8bbe\u4e3a140M</p> <p>\u4f5c\u7528\uff1a</p> <p>\u8fd9\u4e2a\u503c\u7684\u9ed8\u8ba4\u4e3a5M\uff0c\u662f\u8fdc\u8fdc\u4e0d\u591f\u7684\uff0c\u5728\u5b89\u88c5\u5b8cmysql\u65f6\u9700\u8981\u5c3d\u5feb\u7684\u4fee\u6539\u8fd9\u4e2a\u503c\u3002</p> <p>\u5982\u679c\u5bf9 Innodb \u6570\u636e\u8868\u6709\u5927\u91cf\u7684\u5199\u5165\u64cd\u4f5c\uff0c\u90a3\u4e48\u9009\u62e9\u5408\u9002\u7684 innodb_log_file_size \u503c\u5bf9\u63d0\u5347MySQL\u6027\u80fd\u5f88\u91cd\u8981\u3002\u7136\u800c\u8bbe\u7f6e\u592a\u5927\u4e86\uff0c\u5c31\u4f1a\u589e\u52a0\u6062\u590d\u7684\u65f6\u95f4\uff0c\u56e0\u6b64\u5728MySQL\u5d29\u6e83\u6216\u8005\u7a81\u7136\u65ad\u7535\u7b49\u60c5\u51b5\u4f1a\u4ee4MySQL\u670d\u52a1\u5668\u82b1\u5f88\u957f\u65f6\u95f4\u6765\u6062\u590d\u3002</p> <p>\u800c\u8fd9\u4e2a\u503c\u662f\u6ca1\u6709\u4e00\u4e2a\u7edd\u5bf9\u7684\u6982\u5ff5\u7684\uff0cMySQL\u7684InnoDB \u5b58\u50a8\u5f15\u64ce\u4f7f\u7528\u4e00\u4e2a\u6307\u5b9a\u5927\u5c0f\u7684Redo log\u7a7a\u95f4\uff08\u4e00\u4e2a\u73af\u5f62\u7684\u6570\u636e\u7ed3\u6784\uff09\u3002Redo log\u7684\u7a7a\u95f4\u901a\u8fc7innodb_log_file_size\u548cinnodb_log_files_in_group\uff08\u9ed8\u8ba42\uff09\u53c2\u6570\u6765\u8c03\u8282\u3002\u5c06\u8fd9\u4fe9\u53c2\u6570\u76f8\u4e58\u5373\u53ef\u5f97\u5230\u603b\u7684\u53ef\u7528Redo log \u7a7a\u95f4\u3002\u5c3d\u7ba1\u6280\u672f\u4e0a\u5e76\u4e0d\u5173\u5fc3\u4f60\u662f\u901a\u8fc7innodb_log_file_size\u8fd8\u662finnodb_log_files_in_group\u6765\u8c03\u6574Redo log\u7a7a\u95f4\uff0c\u4e0d\u8fc7\u591a\u6570\u60c5\u51b5\u4e0b\u8fd8\u662f\u901a\u8fc7innodb_log_file_size \u6765\u8c03\u8282\u3002\u4e3aInnoDB\u5f15\u64ce\u8bbe\u7f6e\u5408\u9002\u7684Redo log\u7a7a\u95f4\u5bf9\u4e8e\u5199\u654f\u611f\u7684\u5de5\u4f5c\u8d1f\u8f7d\u6765\u8bf4\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002\u7136\u800c\uff0c\u8fd9\u9879\u5de5\u4f5c\u662f\u8981\u505a\u51fa\u6743\u8861\u7684\u3002\u4f60\u914d\u7f6e\u7684Redo\u7a7a\u95f4\u8d8a\u5927\uff0cInnoDB\u5c31\u80fd\u66f4\u597d\u7684\u4f18\u5316\u5199\u64cd\u4f5c\uff1b\u7136\u800c\uff0c\u589e\u5927Redo\u7a7a\u95f4\u4e5f\u610f\u5473\u7740\u66f4\u957f\u7684\u6062\u590d\u65f6\u95f4\u5f53\u51fa\u73b0\u5d29\u6e83\u6216\u6389\u7535\u7b49\u610f\u5916\u65f6\u3002\u6211\u4eec\u662f\u901a\u8fc7\u201c\u6d4b\u8bd5\u201d\u5f97\u5230\uff0c\u600e\u4e48\u6d4b\u8bd5\u4e0b\u9762\u7ed9\u51fa\u65b9\u6cd5\u8bba\uff1a\u4e00\u822c\u60c5\u51b5\u4e0b\u6211\u4eec\u53ef\u4ee5\u6309\u7167\u6bcf1GB\u7684Redo log\u7684\u6062\u590d\u65f6\u95f4\u5927\u7ea6\u57285\u5206\u949f\u5de6\u53f3\u6765\u4f30\u7b97\u3002\u5982\u679c\u6062\u590d\u65f6\u95f4\u5bf9\u4e8e\u4f60\u7684\u4f7f\u7528\u73af\u5883\u6765\u8bf4\u5f88\u91cd\u8981\uff0c\u6211\u5efa\u8bae\u4f60\u505a\u4e00\u4e9b\u6a21\u62df\u6d4b\u8bd5\uff0c\u5728\u6b63\u5e38\u5de5\u4f5c\u8d1f\u8f7d\u4e0b\uff08\u9884\u70ed\u5b8c\u6bd5\u540e\uff09\u6a21\u62df\u7cfb\u7edf\u5d29\u6e83\uff0c\u6765\u8bc4\u4f30\u66f4\u51c6\u786e\u7684\u6062\u590d\u65f6\u95f4\u3002\u4f60\u53ef\u4ee5\u5b89\u88c5 Percona Monitoring and Management\uff0c\u5728\u8be5pmm\u7684percona monitoring and management\u56fe\u8868\u4e2d\uff0c\u4e3b\u8981\u770b\uff1a</p> <p>1\uff09Uncheckpointed Bytes \uff0c\u5982\u679c\u5b83\u5df2\u7ecf\u975e\u5e38\u63a5\u8fd1 Max Checkpoint Age\uff0c\u90a3\u4e48\u4f60\u51e0\u4e4e\u53ef\u4ee5\u786e\u5b9a\u5f53\u524d\u7684 innodb_log_file_size \u503c\u56e0\u4e3a\u592a\u5c0f\u5df2\u7ecf\u67d0\u79cd\u7a0b\u5ea6\u4e0a\u9650\u5236\u4e86\u7cfb\u7edf\u6027\u80fd\u3002\u589e\u52a0\u8be5\u503c\u53ef\u4ee5\u8f83\u4e3a\u663e\u8457\u7684\u63d0\u5347\u7cfb\u7edf\u6027\u80fd\u3002</p> <p>2\uff09Uncheckpointed Bytes \u8fdc\u5c0f\u4e8e Max Checkpoint Age\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u518d\u589e\u52a0 innodb_log_file_size \u5c31\u4e0d\u4f1a\u6709\u660e\u663e\u6027\u80fd\u63d0\u5347\u3002</p> <p>\u5728\u8c03\u6574\u5b8clog_file_size\u540e\u6211\u4eec\u518d\u5230pmm\u4e2d\u53bb\u770b\uff1aRedo Log\u7a7a\u95f4\u6307\u6807\uff0c\u6bd4\u5982\u8bf4\u6211\u4eec\u770b\u5230\u4e861\u5c0f\u65f6\u5185\u670960g\u6570\u636e\u88ab\u5199\u5165\u65e5\u5fd7\u6587\u4ef6\uff0c\u5dee\u4e0d\u591a\u5c31\u662f\u6bcf10\u5206\u949f\u4f1a\u670910g\u6570\u636e\u5728\u8fdb\u884c\u201c\u5199\u65e5\u5fd7\u201c\uff0c\u6211\u4eec\u9700\u8981\u7262\u7262\u8bb0\u5f97\uff0c\u8fd9\u4e2a\u201d\u5199\u65e5\u65e5\u571f\u5df2\u201c\u7684\u65f6\u95f4\u62d6\u5f97\u8d8a\u4e45\u3001\u51fa\u73b0\u7684\u9891\u6b21\u8d8a\u5c11\u5c31\u8d8a\u6709\u52a9\u4e8emysql\u7684innodb\u7684\u6027\u80fd\u3002\u56e0\u6b64\u8fd9\u4e2a\u503c\u6ca1\u6709\u7edd\u5bf9\u63a8\u8350\u3002\u5982\u679c\u4f60\u6ca1\u6709pmm\uff0c\u90a3\u4e48\u6211\u4eec\u6765\u4eba\u8089\u7b97\uff0c\u5728\u4e0a\u9762\u6211\u5df2\u7ecf\u7ed9\u51fa\u4e86\u4eba\u8089\u7b97\u7684\u8be6\u7ec6\u4f8b\u5b50\uff01</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u662f5M\uff0c\u8fd9\u662f\u80af\u5b9a\u4e0d\u591f\u7684\u3002</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_log_file_size = 140M</p>"},{"location":"my-cnf/#40innodb_log_buffer_size","title":"40)innodb_log_buffer_size","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>16777216</p> <p>\u4f5c\u7528\uff1a</p> <p>\u5bf9\u4e8e\u8f83\u5c0f\u7684innodb_buffer_pool_size\uff0c\u6211\u4eec\u4f1a\u628a\u5b83\u8bbe\u6210\u548cinnodb_buffer_pool_size\u4e00\u6837\u3002</p> <p>\u800c\u5f53\u8d85\u8fc74gb\u7684innodb_buffer_pool_size\u65f6\uff0c\u6211\u4eec\u7684\u5efa\u8bae\u662f\u628a\u5b83\u5207\u7684\u591f\u788e\uff0c\u8fd9\u662fmysql5.7\u91cc\u65b0\u5e26\u7684\u7279\u6027\uff0c\u5b83\u7684\u9ed8\u8ba4\u57288m\uff0c\u4f46\u662f\u5bf9\u4e8e\u5927\u91cf\u6709\u4e8b\u52a1\u64cd\u4f5c\u7684mysql\u6211\u4eec\u63a8\u8350\u5728\u5199\u64cd\u4f5c\u5e93\u4e0a\u8bbe\u7f6e\uff1a16m</p> <p>\u6b64\u53c2\u6570\u786e\u5b9a\u4e9b\u65e5\u5fd7\u6587\u4ef6\u6240\u7528\u7684\u5185\u5b58\u5927\u5c0f\uff0c\u4ee5M\u4e3a\u5355\u4f4d\u3002\u7f13\u51b2\u533a\u66f4\u5927\u80fd\u63d0\u9ad8\u6027\u80fd\uff0c\u4f46\u610f\u5916\u7684\u6545\u969c\u5c06\u4f1a\u4e22\u5931\u6570\u636e.\u5b98\u65b9\u7684\u65b9\u6863\u5efa\u8bae\u8bbe\u7f6e\u4e3a1\uff0d8M\u4e4b\u95f4\uff01</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u662f8M</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_log_buffer_size = 16777216</p>"},{"location":"my-cnf/#41innodb_purge_threads","title":"41)innodb_purge_threads","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>0</p> <p>\u4f5c\u7528\uff1a</p> <p>\u8fd9\u4e2a\u53c2\u6570\u8f7b\u6613\u4e0d\u7528\u7684\uff0c\u6211\u63a8\u8350\u5b83\u8bbe\u4e3a\uff1a0\uff0c\u4e3a\u4ec0\u4e48\u5462\uff1f\u8fd9\u4e2a\u53c2\u6570\u662f\u548cinnodb_force_recovery\u5173\u8054\u8d77\u6765\u7684\uff0c\u53ea\u6709\u5f53\u6570\u636e\u5e93\u5d29\u6e83\u540e\u91cd\u542f\u65f6\u624d\u4f1a\u4e34\u65f6\u53bb\u8bbe\u7684\u3002\u5b83\u7684\u4f7f\u7528\u573a\u666f\u5982\u4e0b\uff1a</p> <p>mysql\u65ad\u7535\uff0c\u91cd\u542f\u540e\u65e0\u6548\uff0c\u8d77\u4e0d\u6765\u3002\u6240\u4ee5\u6211\u4eec\u6839\u636einnodb_force_recovery\u7684\u53c2\u6570\uff1a</p> <ol> <li> <p>(SRV_FORCE_IGNORE_CORRUPT):\u5ffd\u7565\u68c0\u67e5\u5230\u7684corrupt\u9875\u3002</p> </li> <li> <p>(SRV_FORCE_NO_BACKGROUND):\u963b\u6b62\u4e3b\u7ebf\u7a0b\u7684\u8fd0\u884c\uff0c\u5982\u4e3b\u7ebf\u7a0b\u9700\u8981\u6267\u884cfull purge\u64cd\u4f5c\uff0c\u4f1a\u5bfc\u81f4crash\u3002</p> </li> <li> <p>(SRV_FORCE_NO_TRX_UNDO):\u4e0d\u6267\u884c\u4e8b\u52a1\u56de\u6eda\u64cd\u4f5c\u3002</p> </li> <li> <p>(SRV_FORCE_NO_IBUF_MERGE):\u4e0d\u6267\u884c\u63d2\u5165\u7f13\u51b2\u7684\u5408\u5e76\u64cd\u4f5c\u3002</p> </li> <li> <p>(SRV_FORCE_NO_UNDO_LOG_SCAN):\u4e0d\u67e5\u770b\u91cd\u505a\u65e5\u5fd7\uff0cInnoDB\u5b58\u50a8\u5f15\u64ce\u4f1a\u5c06\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1\u89c6\u4e3a\u5df2\u63d0\u4ea4\u3002</p> </li> <li> <p>(SRV_FORCE_NO_LOG_REDO):\u4e0d\u6267\u884c\u524d\u6eda\u7684\u64cd\u4f5c\u3002</p> </li> </ol> <p>\u6211\u4eec\u5728my.cnf\u4e2d\u5982\u4e0b\u8bbe\u7f6e\uff1a</p> <p>innodb_force_recovery = 6</p> <p>innodb_purge_threads = 0</p> <p>\u8bb0\u4f4f\uff0c\u4e00\u65e6\u5f53innodb_force_recovery&gt;2\u65f6\uff0c\u8981\u628ainnodb_purge_threads\u8bbe\u62100.</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e0d\u8981\u53bb\u8bbe\uff0c\u53ef\u4ee5\u4e0d\u914d\uff0c\u51fa\u73b0\u4e86\u95ee\u9898\u5728recover\u9700\u8981\u65f6\u518d\u53bb\u6539\u3002</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_purge_threads = 0</p>"},{"location":"my-cnf/#42innodb_large_prefix","title":"42)innodb_large_prefix","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>1</p> <p>\u4f5c\u7528\uff1a</p> <p>\u5982\u679c\u4f60\u7684\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u5b57\u7b26\u96c6\u8bbe\u6210\u4e86utf8mb4\uff0c\u90a3\u4e48\u6211\u4eec\u9700\u8981\u628a\u8fd9\u4e2a\u5f00\u5173\u5f00\u542f\uff0c\u4e3a\u4ec0\u4e48\u5462\uff1fmysql\u57285.6\u4e4b\u524d\u4e00\u76f4\u90fd\u662f\u5355\u5217\u7d22\u5f15\u9650\u5236767\uff0c\u8d77\u56e0\u662f256\u00d73-1\u3002\u8fd9\u4e2a3\u662f\u5b57\u7b26\u6700\u5927\u5360\u7528\u7a7a\u95f4\uff08utf8\uff09\u3002\u4f46\u662f\u57285.6\u4ee5\u540e\uff0c\u5f00\u59cb\u652f\u63014\u4e2a\u5b57\u8282\u7684uutf8\u3002255\u00d74&gt;767, \u4e8e\u662f\u589e\u52a0\u4e86\u8fd9\u4e2a\u53c2\u6570\u3002\u8fd9\u4e2a\u53c2\u6570\u9ed8\u8ba4\u503c\u662fOFF\u3002\u5f53\u6539\u4e3aON\u65f6\uff0c\u5141\u8bb8\u5217\u7d22\u5f15\u6700\u5927\u8fbe\u52303072.</p> <p>\u5728mysql5.6\u4e2d\u8fd9\u4e2a\u5f00\u5173\u53ebon, off\u3002\u800c\u57285.7\u4e2d\u53eb0\u548c1\uff0c\u7531\u4e8e\u6211\u4eec\u524d\u9762\u8bbe\u7f6e\u4e86utf8mb4\uff0c\u56e0\u6b64\u8fd9\u8fb9\u6211\u4eec\u5fc5\u987b\u628a\u8fd9\u4e2a\u53c2\u6570\u5f00\u542f\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u4e0d\u914d\u4f1a\u6709\u95ee\u9898\uff0c\u7279\u522b\u662f\u7d22\u5f15\u4f1a\u65e0\u6548\u3001\u6216\u8005\u4e0d\u662f\u8d70\u6700\u4f18\u8ba1\u5212\uff0c\u5982\u679c\u4f60\u7684\u5b57\u7b26\u96c6\u662futf8mb4\uff0c\u90a3\u4e48\u8fd9\u4e2a\u503c\u5fc5\u5f00\u542f\u3002</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_large_prefix = 1</p>"},{"location":"my-cnf/#43innodb_thread_concurrency","title":"43)innodb_thread_concurrency","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>\u88c5mysql\u7684\u670d\u52a1\u5668\u7684cpu\u7684\u6838\u6570</p> <p>\u4f5c\u7528\uff1a</p> <p>\u5982\uff1a64\u6838cpu\uff0c\u90a3\u4e48\u63a8\u8350\uff1a64\uff08&lt;=cpu\u6838\u6570\uff09</p> <p>\u5982\u679c\u4e00\u4e2a\u5de5\u4f5c\u8d1f\u8f7d\u4e2d\uff0c\u5e76\u53d1\u7528\u6237\u7ebf\u7a0b\u7684\u6570\u91cf\u5c0f\u4e8e\u7b49\u4e8e64\uff0c\u5efa\u8bae\u8bbe\u7f6einnodb_thread_concurrency=0;\u800c\u4e8b\u5b9e\u4e0a\u6211\u4eec\u7684\u7cfb\u7edf\u662f\u5904\u4e8e\u5927\u5e76\u53d1\u5927\u4e8b\u52a1\u7684\u60c5\u51b5\u4e0b\u7684\uff0c\u600e\u4e48\u6765\u7b97\u8fd9\u4e2a\u503c\uff1f\u5efa\u8bae\u662f\u5148\u8bbe\u7f6e\u4e3a128\uff0c\u7136\u540e\u6211\u4eec\u4e0d\u65ad\u7684\u964d\u8fd9\u4e2a\u503c\uff0c\u76f4\u5230\u53d1\u73b0\u80fd\u591f\u63d0\u4f9b\u6700\u4f73\u6027\u80fd\u7684\u7ebf\u7a0b\u6570\u3002\u4e3a\u4e86\u5b89\u5168\u8d77\u95f4\u6211\u4eec\u4f1a\u628a\u5b83\u8bbe\u6210\u548ccpu\u4e00\u6837\u5927\u5c0f\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u572864\u4f4d\u4e0b\u4f1a\u662f8</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_thread_concurrency = 64</p>"},{"location":"my-cnf/#44innodb_print_all_deadlocks","title":"44)innodb_print_all_deadlocks","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>1</p> <p>\u4f5c\u7528\uff1a</p> <p>\u63a8\u8350\uff1a1</p> <p>\u5f53mysql \u6570\u636e\u5e93\u53d1\u751f\u6b7b\u9501\u65f6\uff0c innodb status \u91cc\u9762\u4f1a\u8bb0\u5f55\u6700\u540e\u4e00\u6b21\u6b7b\u9501\u7684\u76f8\u5173\u4fe1\u606f\uff0c\u4f46mysql \u9519\u8bef\u65e5\u5fd7\u91cc\u9762\u4e0d\u4f1a\u8bb0\u5f55\u6b7b\u9501\u76f8\u5173\u4fe1\u606f\uff0c\u8981\u60f3\u8bb0\u5f55\uff0c\u542f\u52a8 innodb_print_all_deadlocks \u53c2\u6570 \u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u4e0d\u4f1a\u8bb0\u5f55\u8be5\u4fe1\u606f\u3002</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_print_all_deadlocks = 1</p>"},{"location":"my-cnf/#45innodb_strict_mode","title":"45)innodb_strict_mode","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>1 \u4f5c\u7528\uff1a</p> <p>\u5fc5\u987b\u5f00\u542f\uff0c\u6ca1\u5f97\u9009\u62e9\uff0c1\uff0c\u4e3a\u4ec0\u4e48\uff1f</p> <p>\u4eceMySQL5.5.X\u7248\u672c\u5f00\u59cb\uff0c\u4f60\u53ef\u4ee5\u5f00\u542fInnoDB\u4e25\u683c\u68c0\u67e5\u6a21\u5f0f\uff0c\u5c24\u5176\u91c7\u7528\u4e86\u9875\u6570\u636e\u538b\u7f29\u529f\u80fd\u540e\uff0c\u6700\u597d\u662f\u5f00\u542f\u8be5\u529f\u80fd\u3002\u5f00\u542f\u6b64\u529f\u80fd\u540e\uff0c\u5f53\u521b\u5efa\u8868\uff08CREATE TABLE\uff09\u3001\u66f4\u6539\u8868\uff08ALTER TABLE\uff09\u548c\u521b\u5efa\u7d22\u5f15\uff08CREATE INDEX\uff09\u8bed\u53e5\u65f6\uff0c\u5982\u679c\u5199\u6cd5\u6709\u9519\u8bef\uff0c\u4e0d\u4f1a\u6709\u8b66\u544a\u4fe1\u606f\uff0c\u800c\u662f\u76f4\u63a5\u629b\u51fa\u9519\u8bef\uff0c\u8fd9\u6837\u5c31\u53ef\u76f4\u63a5\u5c06\u95ee\u9898\u627c\u6740\u5728\u6447\u7bee\u91cc\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u5982\u679c\u4e0d\u914d\u78b0\u5230\u5f00\u53d1\u6216\u8005\u975e\u4e13\u4e1a\u7684dba\u4f1a\u628a\u65e7ddl\u8bed\u53e5\u751f\u6548\u57285.7\u5185\uff0c\u53e6\u5916\u4e00\u4e2a\u95ee\u9898\u5c31\u662fddl\u8bed\u53e5\u51fa\u9519\u65f6\u62a5\u9519\u4e0d\u660e\u663e\uff0c\u8fd9\u4f1a\u5f71\u54cd\u5230\u201c\u4e3b\u4ece\u590d\u5236\u201d\uff0c\u81f3\u4e8edll\u4e3a\u4ec0\u4e48\u4f1a\u5f71\u54cd\u5230\u4e3b\u4ece\u590d\u5236\uff0c\u6211\u4eec\u540e\u9762\u4f1a\u5728\u201cslave_skip_errors = ddl_exist_errors\u201d\u4e2d\u8be6\u7ec6\u89e3\u8bf4\u3002 \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_strict_mode = 1</p>"},{"location":"my-cnf/#46log_error","title":"46)log_error","text":"<p>error log\u6240\u5728\u4f4d\u7f6e\uff0c\u8fd9\u4e2a\u4e0d\u7528\u591a\u8bb2\uff0c\u53ef\u4ee5\u548cmysql log\u653e\u5728\u540c\u4e00\u8def\u5f84\u4e0b\uff0c\u6587\u4ef6\u540d\u80fd\u591f\u548c\u5176\u5b83log\u533a\u5206\u5f00\u6765\u3002</p>"},{"location":"my-cnf/#47slow_query_log","title":"47)slow_query_log","text":"<p>\u5efa\u8bae\u5f00\u542f</p>"},{"location":"my-cnf/#48slow_query_log_file","title":"48)slow_query_log_file","text":"<p>\u6162sql\u6240\u5728\u4f4d\u7f6e\uff0c\u8fd9\u4e2a\u4e0d\u7528\u591a\u8bb2\uff0c\u53ef\u4ee5\u548cmysql log\u653e\u5728\u540c\u4e00\u8def\u5f84\u4e0b\uff0c\u6587\u4ef6\u540d\u80fd\u591f\u548c\u5176\u5b83log\u533a\u5206\u5f00\u6765\u3002</p>"},{"location":"my-cnf/#49log_queries_not_using_indexes1","title":"49)log_queries_not_using_indexes=1","text":"<p>\u5f3a\u70c8\u5efa\u8bae\u5f00\u542f\u62101.</p>"},{"location":"my-cnf/#50log_slow_admin_statements-1","title":"50)log_slow_admin_statements = 1","text":"<p>\u5f3a\u70c8\u5efa\u8bae\u5f00\u542f\u62101.</p>"},{"location":"my-cnf/#51log_slow_slave_statements-1","title":"51)log_slow_slave_statements = 1","text":"<p>\u5f3a\u70c8\u5efa\u8bae\u5f00\u542f\u62101.</p>"},{"location":"my-cnf/#52log_throttle_queries_not_using_indexes","title":"52)log_throttle_queries_not_using_indexes","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>\u5728\u4e00\u5f00\u59cb\u4e0a\u7ebf\u540e\u7684\u521d\u671f\u6211\u4eec\u4f1a\u5f00\u621030\uff5e50\u6761\u3002\u968f\u7740\u6027\u80fd\u9010\u6e10\u4f18\u5316\u6211\u4eec\u4f1a\u628a\u8fd9\u4e2a\u6570\u91cf\u5f00\u621010. \u4f5c\u7528\uff1a</p> <p>\u4e0a\u7ebf\u524d\u4e00\u6bb5\u65f6\u95f4\u4f1a\u4e0d\u592a\u7a33\u5b9a\uff0c\u6211\u4eec\u53d1\u751f\u8fc7\u8fd1\u51e0\u5341\u6761sql\u6ca1\u6709\u8d70index \u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u4e0d\u914d\u4e0d\u5f00\u542f\uff0c\u5efa\u8bae\u5f00\u542f\u3002</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>log_throttle_queries_not_using_indexes = 50</p>"},{"location":"my-cnf/#53expire_logs_days","title":"53)expire_logs_days","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>30 \u4f5c\u7528\uff1a</p> <p>\u8fd9\u4e2a\u503c\u4e0d\u80fd\u592a\u5927\uff0c\u56e0\u4e3a\u4f60\u4e0d\u662f\u571f\u8c6a\uff0c\u4e0d\u80fd\u8ba9binlog\u65e0\u9650\u5360\u7528\u4f60\u7684\u78c1\u76d8\u7a7a\u95f4\uff0c\u8bb0\u5f97\u8fd9\u4e2a\u503c\u4e00\u65e6\u8bbe\u5c0f\uff0c\u4f60\u9700\u8981\u505a\u597dbinlog\u5907\u4efd\u7b56\u7565\uff0c30\u8fd9\u4e2a\u503c\u5c31\u662f30\u5929\uff0c\u524d\u63d0\u662f\u4f60\u7684binlog\u7684\u5907\u4efd\u505a\u7684\u6709\u6548\u4e14\u4e0d\u5360\u7528mysql\u7684\u78c1\u76d8\u7a7a\u95f4\u3002 \u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u662f0\uff0c\u5373\u6c38\u4e0d\u8fc7\u671f\u3002 \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>expire_logs_days = 30</p>"},{"location":"my-cnf/#54long_query_time","title":"54)long_query_time","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>10 \u4f5c\u7528\uff1a</p> <p>\u9ed8\u8ba4\u4e3a10\u79d2\u79cd\uff0c\u5373\u4e00\u5207&gt;=10s\u7684sql\u90fd\u4f1a\u88ab\u8bb0\u5f55\u3002\u6211\u5efa\u8bae\u5728\u5f00\u59cb\u521a\u4e0a\u7ebf\u671f\u8bbe\u621010\uff08\u7528\u9ed8\u8ba4\u503c\uff09\uff0c\u8d8a\u7740\u6162sql\u8c03\u4f18\u8d8a\u6765\u8d8a\u597d\uff0c\u53ef\u4ee5\u628a\u8fd9\u4e2a\u503c\u8bbe\u62101.\u56e0\u4e3a\u79d2\u6570\u8d8a\u4f4e\uff0c\u8bb0\u5f55\u7684sql\u8d8a\u591a\uff0c\u8bb0\u5f55\u8d8a\u591a\uff0c\u4e5f\u4f1a\u9020\u6210mysql\u8fc7\u6162\u3002\u53e6\u5916\u4e0d\u80fd\u5b8c\u5168\u4f9d\u8d56\u4e8emysql\u7684\u6162sql log\uff0c\u800c\u662f\u5e94\u8be5\u5e03\u7f72druid sql\u5b9e\u65f6\u67e5\u770b\u5668\u6216\u8005\u662fapm\u6216\u8005\u662f\u4e13\u4e1a\u7684\u6162sql\u5b9e\u65f6\u67e5\u8be2\u5668\u3002 \u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e3a10 \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>long_query_time = 10</p>"},{"location":"my-cnf/#55min_examined_row_limit","title":"55)min_examined_row_limit","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>100 \u4f5c\u7528\uff1a</p> <p>\u8fd9\u4e2a\u503c\u914d\u5408\u7740\u6162\u67e5\u8be2sql\u8bb0\u5f55\u7528\uff0c\u6307\u5b9a\u4e3a\u5c11\u4e8e\u8be5\u503c\u7684\u884c\u7684\u67e5\u8be2\u5c31\u7b97\u6162sql\u4e0d\u88ab\u8bb0\u5f55\u6210\u201d\u6162sql\u65e5\u5fd7\u201c\u3002 \u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u4e0d\u5f00\u542f\u7684\u8bdd\u4ee5\u6162sql\u7684long_query_time\u4e3a\u4f18\u5148\u89c4\u5219\u3002 \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>min_examined_row_limit = 100</p>"},{"location":"my-cnf/#56master_info_repository","title":"56)master_info_repository","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>TABLE \u4f5c\u7528\uff1a</p> <p>\u4e3b\u4ece\u590d\u5236\u65f6\u7528\uff0c\u63a8\u8350TABLE. \u4ece\u673a\u4fdd\u5b58\u4e3b\u8282\u70b9\u4fe1\u606f\u65b9\u5f0f\uff0c\u8bbe\u6210file\u65f6 \u4f1a\u751f\u6210master.info \u548c relay-log.info2\u4e2a\u6587\u4ef6\uff0c\u8bbe\u6210table\uff0c\u4fe1\u606f\u5c31\u4f1a\u5b58\u5728mysql.master_slave_info\u8868\u4e2d\u3002\u4e0d\u7ba1\u662f\u8bbe\u7f6e\u7684\u54ea\u79cd\u503c\uff0c\u90fd\u4e0d\u8981\u79fb\u52a8\u6216\u8005\u7f16\u8f91\u76f8\u5173\u7684\u6587\u4ef6\u548c\u8868\u3002 \u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u4e0d\u914d\u7684\u8bdd\u9ed8\u8ba4\u5b58\u6210file\u683c\u5f0f\u3002 \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>master_info_repository = TABLE</p>"},{"location":"my-cnf/#57relay_log_info_repository","title":"57)relay_log_info_repository","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>TABLE \u4f5c\u7528\uff1a</p> <p>\u4e3b\u4ece\u590d\u5236\u65f6\u7528\uff0c\u63a8\u8350TABLE.</p> <p>\u8fd9\u4e2a\u53c2\u6570\u548c\u4e0a\u9762\u7684master_info_repository\u5fc5\u987b\u4fdd\u6301\u4e00\u81f4\uff0c\u8981\u4e0d\u7136mysql\u5b9e\u4f8b\u542f\u4e0d\u8d77\u6765\u3002</p> <p>\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u51e0\u4e2atable\u9ed8\u8ba4\u7528\u7684\u662fmyIsAM\u5f15\u64ce\uff0c\u8981\u5f00\u542f\u6210TABLE\u6a21\u5f0f\u7684\u8bdd\u4e00\u5b9a\u8bb0\u5f97\u628a\u8fd9\u4e24\u4e2a\u8868\u7684\u5f15\u64ce\u6539\u6210innodb</p> <p>alter table slave_master_info engine=innodb;</p> <p>alter table slave_relay_log_info engine=innodb;</p> <p>alter table slave_worker_info engine=innodb;</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u8fd9\u4e2a\u53c2\u6570\u548c\u4e0a\u9762\u7684master_info_repository\u5fc5\u987b\u4fdd\u6301\u4e00\u81f4\uff0c\u8981\u4e0d\u7136mysql\u5b9e\u4f8b\u542f\u4e0d\u8d77\u6765</p> <p>\u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>relay_log_info_repository = TABLE</p>"},{"location":"my-cnf/#58log_bin-binlog","title":"58)log_bin = bin.log","text":"<p>\u4e3b\u4ece\u590d\u5236\u65f6\u7528\uff0c\u4e3b\u4ece\u590d\u5236\u4e0b\u7684bin.log\u65e5\u5fd7\u6240\u5728\u6587\u4ef6\u5939\u3002</p>"},{"location":"my-cnf/#59sync_binlog","title":"59)sync_binlog","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>1 \u4f5c\u7528\uff1a</p> <p>\u4e3b\u4ece\u590d\u5236\u65f6\u7528\uff0c\u8fd9\u4e2a\u503c\u662f\u8981\u770b\u4e1a\u52a1\u7684\uff0c\u5b83\u53ef\u4ee5\u67090\uff0c1\uff0c\u975e\u96f6\u51713\u79cd\u8bbe\u7f6e\u65b9\u5f0f\u3002</p> <p>1\uff090-\u4ee3\u8868mysql\u4e0d\u63a7\u5236\u5199binlog\u7684\u65f6\u95f4\uff0c\u7531file system\u81ea\u7531\u53bb\u63a7\u5236\uff0c\u6b64\u65f6\u7684mysql\u7684\u5e76\u53d1\u6027\u8fbe\u5230\u6700\u597d\uff0c\u4f46\u662f\u4e00\u65e6\u7cfb\u7edf\u5d29\u6e83\u4f60\u4f1a\u4e22\u5931\u5f88\u591a\u8fd8\u4f1a\u5199\u5165binlog\u7684\u6570\u636e\uff08\u6bd4\u5982\u8bf4\u4f60\u6b63\u5728\u5220\u6570\u636e\u548c\u66f4\u65b0\u6570\u636e\uff09</p> <p>2\uff091-\u6700\u5b89\u5168\uff0c\u4f60\u6700\u591a\u4e22\u6389\u4e00\u4e2a\u4e8b\u52a1\u6216\u8005\u662f\u4e00\u6761\u8bed\u53e5\uff0c\u4f46\u662f\u6b64\u65f6\u5b83\u7684\u6027\u80fd\u5f88\u5dee\uff0c\u6b64\u53c2\u6570\u8bbe\u4e3a0\u6216\u8005\u662f1\u4e4b\u95f4\u7684\u6027\u80fd\u80fd\u5dee4\uff5e5\u500d\u3002</p> <p>3\uff09\u5982\u679c\u4f60\u7528\u7684\u662f\u4e07\u5146\u5149\u7ea4\u9ad8\u901f\u78c1\u76d8\u50cf\u6216\u8005\u662fssd\u540c\u65f6data\u548cbinlog\u90fd\u653e\u5728\u4e00\u4e2a\u76ee\u5f55\u4e0b\u7684\u540c\u65f6\u4f60\u8981\u4e3a\u4e86\u5b89\u5168\u53ef\u4ee5\u5f00\u542f\u62101.</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e3a0 \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>sync_binlog = 1</p>"},{"location":"my-cnf/#60gtid_mode","title":"60)gtid_mode","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>on \u4f5c\u7528\uff1a</p> <p>\u4e3b\u4ece\u590d\u5236\u65f6\u7528\uff0c\u63a8\u8350\u5f00\u542f\u6210on\uff0c\u5b83\u7684\u7528\u5904\u5c31\u662f\u5141\u8bb8\u4f60\u5728\u4ece\u5e93\u4e0a\u8fdb\u884c\u201d\u5907\u4efd\u201c\uff0c\u4ece\u5e93\u4e0a\u5728\u8fdb\u884c\u5907\u4efd\u65f6\u5b83\u80fd\u591f\u83b7\u53d6\u4e3b\u5e93\u7684binlog\u4f4d\u70b9\u3002</p> <p>\u8be5\u53c2\u6570\u4e5f\u53ef\u4ee5\u52a8\u6001\u5728\u7ebf\u8bbe\u5b9a\u3002\u5982\u679c\u4f60\u8981\u5728\u7ebf\u8fd0\u884c\u65f6\u8bbe\u5b9a\uff0c\u5728my.cnf\u6587\u4ef6\u4e2d\u5fc5\u987b\u628a\u5b83\u8bbe\u6210on\u3002\u5728\u5f00\u542f\u8be5\u53c2\u6570\u65f6\uff0clog-bin\u548clog-slave-updates\u4e5f\u5fc5\u987b\u5f00\u542f\uff0c\u5426\u5219MySQL Server\u62d2\u7edd\u542f\u52a8\uff0c\u5f53\u5f00\u542fGTID\u6a21\u5f0f\u65f6\uff0c\u96c6\u7fa4\u4e2d\u7684\u5168\u90e8MySQL Server\u5fc5\u987b\u540c\u65f6\u914d\u7f6egtid_mod = ON\uff0c\u5426\u5219\u65e0\u6cd5\u540c\u6b65\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e3aoff \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>gtid_mode = on</p>"},{"location":"my-cnf/#61enforce_gtid_consistency","title":"61)enforce_gtid_consistency","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>1 \u4f5c\u7528\uff1a</p> <p>\u4e3b\u4ece\u590d\u5236\u65f6\u7528\uff0c\u89c1gtid_mode\uff0c\u8fd9\u662f\u7275\u8fde\u53c2\u6570\uff0c\u968f\u7740gtid_mode\u7684\u5f00\u542f\u4e00\u8d77\u5f00\u542f\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u5fc5\u987b\u8ddf\u7740gtid_mode\u4e00\u8d77\u5f00\u542f\uff0c\u8981\u4e0d\u7136mysql\u5b9e\u4f8b\u8d77\u4e0d\u6765\u3002 \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>enforce_gtid_consistency = 1</p>"},{"location":"my-cnf/#62log_slave_updates","title":"62)log_slave_updates","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>\u5b83\u53ea\u8981\u6807\u6ce8\u5728my.cnf\u91cc\u5c31\u4ee3\u8868\u8d77\u4f5c\u7528\u4e86\u3002 \u4f5c\u7528\uff1a</p> <p>\u4e3b\u4ece\u590d\u5236\u65f6\u7528\uff0c\u89c1gtid_mode\uff0c\u8fd9\u662f\u7275\u8fde\u53c2\u6570\uff0c\u968f\u7740gtid_mode\u7684\u5f00\u542f\u4e00\u8d77\u5f00\u542f\u3002\u5b83\u53ea\u8981\u6807\u6ce8\u5728\u8fd9\u5c31\u53ef\u4ee5\u4e86\uff0c\u4ee3\u8868\u5f00\u542f\uff0c\u5426\u5219\u4e5f\u5c31\u4e0d\u8981\u6709\u8fd9\u4e00\u884c\u4e86\u3002 \u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u5b83\u662f\u7275\u8fde\u53c2\u6570\uff0c\u968f\u7740gtid_mode\u7684\u5f00\u542f\u4e00\u8d77\u5f00\u542f\u3002 \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>log_slave_updates</p>"},{"location":"my-cnf/#63binlog_format","title":"63)binlog_format","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>row \u4f5c\u7528\uff1a</p> <p>\u4e3b\u4ece\u590d\u5236\u65f6\u7528\uff0cmysql5.7\u67093\u79cdbin log\u6a21\u5f0f\uff1a</p> <ol> <li> <p>STATEMENT\uff1a\u5386\u53f2\u60a0\u4e45\uff0c\u6280\u672f\u6210\u719f,binlog\u6587\u4ef6\u8f83\u5c0f,binlog\u4e2d\u5305\u542b\u4e86\u6240\u6709\u6570\u636e\u5e93\u66f4\u6539\u4fe1\u606f\uff0c\u53ef\u4ee5\u636e\u6b64\u6765\u5ba1\u6838\u6570\u636e\u5e93\u7684\u5b89\u5168\u7b49\u60c5\u51b5\u3002binlog\u53ef\u4ee5\u7528\u4e8e\u5b9e\u65f6\u7684\u8fd8\u539f\uff0c\u800c\u4e0d\u4ec5\u4ec5\u7528\u4e8e\u590d\u5236\u4e3b\u4ece\u7248\u672c\u53ef\u4ee5\u4e0d\u4e00\u6837\uff0c\u4ece\u670d\u52a1\u5668\u7248\u672c\u53ef\u4ee5\u6bd4\u4e3b\u670d\u52a1\u5668\u7248\u672c\u9ad8\u3002\u7f3a\u70b9\u662f\uff1a\u4e0d\u662f\u6240\u6709\u7684UPDATE\u8bed\u53e5\u90fd\u80fd\u88ab\u590d\u5236\uff0c\u5c24\u5176\u662f\u5305\u542b\u4e0d\u786e\u5b9a\u64cd\u4f5c\u7684\u65f6\u5019\u3002\u8c03\u7528\u5177\u6709\u4e0d\u786e\u5b9a\u56e0\u7d20\u7684 UDF \u65f6\u590d\u5236\u4e5f\u53ef\u80fd\u51fa\u95ee\u9898\uff0c\u4f7f\u7528\u4ee5\u4e0b\u51fd\u6570\u7684\u8bed\u53e5\u4e5f\u65e0\u6cd5\u88ab\u590d\u5236\uff1a</p> </li> <li> <p>LOAD_FILE()</p> </li> <li> <p>UUID()</p> </li> <li> <p>USER()</p> </li> <li> <p>FOUND_ROWS()</p> </li> <li> <p>SYSDATE() (\u9664\u975e\u542f\u52a8\u65f6\u542f\u7528\u4e86 --sysdate-is-now \u9009\u9879)</p> </li> </ol> <p>\u540c\u65f6\uff0cINSERT ... SELECT \u4f1a\u4ea7\u751f\u6bd4 ROW \u66f4\u591a\u7684\u884c\u7ea7\u9501\uff0c\u590d\u5236\u9700\u8981\u8fdb\u884c\u5168\u8868\u626b\u63cf(WHERE \u8bed\u53e5\u4e2d\u6ca1\u6709\u4f7f\u7528\u5230\u7d22\u5f15)\u7684 UPDATE \u65f6\uff0c\u9700\u8981\u6bd4 RBR \u8bf7\u6c42\u66f4\u591a\u7684\u884c\u7ea7\u9501</p> <p>\u5bf9\u4e8e\u6709 AUTO_INCREMENT \u5b57\u6bb5\u7684 InnoDB\u8868\u800c\u8a00\uff0cINSERT \u8bed\u53e5\u4f1a\u963b\u585e\u5176\u4ed6 INSERT \u8bed\u53e5\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u590d\u6742\u7684\u8bed\u53e5\uff0c\u5728\u4ece\u670d\u52a1\u5668\u4e0a\u7684\u8017\u8d44\u6e90\u60c5\u51b5\u4f1a\u66f4\u4e25\u91cd\uff0c\u800c RBR \u6a21\u5f0f\u4e0b\uff0c\u53ea\u4f1a\u5bf9\u90a3\u4e2a\u53d1\u751f\u53d8\u5316\u7684\u8bb0\u5f55\u4ea7\u751f\u5f71\u54cd\uff0c\u5b58\u50a8\u51fd\u6570(\u4e0d\u662f\u5b58\u50a8\u8fc7\u7a0b)\u5728\u88ab\u8c03\u7528\u7684\u540c\u65f6\u4e5f\u4f1a\u6267\u884c\u4e00\u6b21 NOW() \u51fd\u6570\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u8bf4\u662f\u574f\u4e8b\u4e5f\u53ef\u80fd\u662f\u597d\u4e8b\uff0c\u786e\u5b9a\u4e86\u7684 UDF \u4e5f\u9700\u8981\u5728\u4ece\u670d\u52a1\u5668\u4e0a\u6267\u884c\uff0c\u6570\u636e\u8868\u5fc5\u987b\u51e0\u4e4e\u548c\u4e3b\u670d\u52a1\u5668\u4fdd\u6301\u4e00\u81f4\u624d\u884c\uff0c\u5426\u5219\u53ef\u80fd\u4f1a\u5bfc\u81f4\u590d\u5236\u51fa\u9519\uff0c\u6267\u884c\u590d\u6742\u8bed\u53e5\u5982\u679c\u51fa\u9519\u7684\u8bdd\uff0c\u4f1a\u6d88\u8017\u66f4\u591a\u8d44\u6e90\u3002</p> <ol> <li> <p>ROW\uff1a\u4efb\u4f55\u60c5\u51b5\u90fd\u53ef\u4ee5\u88ab\u590d\u5236\uff0c\u8fd9\u5bf9\u590d\u5236\u6765\u8bf4\u662f\u6700\u5b89\u5168\u53ef\u9760\u7684\uff0c\u548c\u5176\u4ed6\u5927\u591a\u6570\u6570\u636e\u5e93\u7cfb\u7edf\u7684\u590d\u5236\u6280\u672f\u4e00\u6837\u3002\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u4ece\u670d\u52a1\u5668\u4e0a\u7684\u8868\u5982\u679c\u6709\u4e3b\u952e\u7684\u8bdd\uff0c\u590d\u5236\u5c31\u4f1a\u5feb\u4e86\u5f88\u591a\u3002\u590d\u5236\u4ee5\u4e0b\u51e0\u79cd\u8bed\u53e5\u65f6\u7684\u884c\u9501\u66f4\u5c11\uff1a</p> </li> <li> <p>INSERT ... SELECT</p> </li> <li> <p>\u5305\u542b AUTO_INCREMENT \u5b57\u6bb5\u7684 INSERT</p> </li> <li> <p>\u6ca1\u6709\u9644\u5e26\u6761\u4ef6\u6216\u8005\u5e76\u6ca1\u6709\u4fee\u6539\u5f88\u591a\u8bb0\u5f55\u7684 UPDATE \u6216 DELETE \u8bed\u53e5</p> </li> </ol> <p>\u6267\u884c INSERT\uff0cUPDATE\uff0cDELETE \u8bed\u53e5\u65f6\u9501\u66f4\u5c11\uff0c\u4ece\u670d\u52a1\u5668\u4e0a\u91c7\u7528\u591a\u7ebf\u7a0b\u6765\u6267\u884c\u590d\u5236\u6210\u4e3a\u53ef\u80fd\uff0c\u5b83\u7684\u7f3a\u70b9\u662f\uff1ainlog \u5927\u4e86\u5f88\u591a\uff0c\u590d\u6742\u7684\u56de\u6eda\u65f6 binlog \u4e2d\u4f1a\u5305\u542b\u5927\u91cf\u7684\u6570\u636e\uff0c\u4e3b\u670d\u52a1\u5668\u4e0a\u6267\u884c UPDATE \u8bed\u53e5\u65f6\uff0c\u6240\u6709\u53d1\u751f\u53d8\u5316\u7684\u8bb0\u5f55\u90fd\u4f1a\u5199\u5230 binlog \u4e2d\uff0c\u800c SBR \u53ea\u4f1a\u5199\u4e00\u6b21\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u9891\u7e41\u53d1\u751f binlog \u7684\u5e76\u53d1\u5199\u95ee\u9898\uff0cUDF \u4ea7\u751f\u7684\u5927 BLOB \u503c\u4f1a\u5bfc\u81f4\u590d\u5236\u53d8\u6162\uff0c\u65e0\u6cd5\u4ece binlog \u4e2d\u770b\u5230\u90fd\u590d\u5236\u4e86\u5199\u4ec0\u4e48\u8bed\u53e5\u3002</p> <p>\u4ece\u5b89\u5168\u548c\u7a33\u5b9a\u6027\u7684\u7f29\u5408\u8003\u8651\u4e0a\u6765\u8bf4\u6211\u4eec\u9009\u62e9ROW\u6a21\u5f0f\u3002</p> <ol> <li>\u6df7\u5408\u5f0f-\u4e0d\u63a8\u8350 \u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</li> </ol> <p>5.7.6\u4e4b\u524d\u9ed8\u8ba4\u4e3aSTATEMENT\u6a21\u5f0f\u3002MySQL 5.7.7\u4e4b\u540e\u9ed8\u8ba4\u4e3aROW\u6a21\u5f0f \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>binlog_format = row</p>"},{"location":"my-cnf/#64relay_log","title":"64)relay_log","text":"<p>\u4e3b\u4ece\u590d\u5236\u7528\uff0c\u5b9a\u4e49relay_log\u7684\u4f4d\u7f6e\u548c\u540d\u79f0\uff0c\u5982\u679c\u503c\u4e3a\u7a7a\uff0c\u5219\u9ed8\u8ba4\u4f4d\u7f6e\u5728\u6570\u636e\u6587\u4ef6\u7684\u76ee\u5f55\uff08datadir\uff09\uff0c\u6587\u4ef6\u540d\u4e3ahost_name-relay-bin.nnnnnn\uff08By default, relay log file names have the form host_name-relay-bin.nnnnnn in the data directory\uff09</p>"},{"location":"my-cnf/#65relay_log_recovery","title":"65)relay_log_recovery","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>1 \u4f5c\u7528\uff1a</p> <p>\u4e3b\u4ece\u590d\u5236\u7528\uff0c\u63a8\u8350\u503c\u4e3a1\uff0c\u5efa\u8bae\u6253\u5f00\u3002</p> <p>\u5f53slave\u4ece\u5e93\u5b95\u673a\u540e\uff0c\u5047\u5982relay-log\u635f\u574f\u4e86\uff0c\u5bfc\u81f4\u4e00\u90e8\u5206\u4e2d\u7ee7\u65e5\u5fd7\u6ca1\u6709\u5904\u7406\uff0c\u5219\u81ea\u52a8\u653e\u5f03\u6240\u6709\u672a\u6267\u884c\u7684relay-log\uff0c\u5e76\u4e14\u91cd\u65b0\u4ecemaster\u4e0a\u83b7\u53d6\u65e5\u5fd7\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86relay-log\u7684\u5b8c\u6574\u6027\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8be5\u529f\u80fd\u662f\u5173\u95ed\u7684\uff0c\u5c06relay_log_recovery\u7684\u503c\u8bbe\u7f6e\u4e3a 1\u65f6\uff0c\u53ef\u5728slave\u4ece\u5e93\u4e0a\u5f00\u542f\u8be5\u529f\u80fd\uff0c\u5efa\u8bae\u5f00\u542f\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u5173\u95ed\u7684\u3002 \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>relay_log_recovery = 1</p>"},{"location":"my-cnf/#66slave_skip_errors","title":"66)slave_skip_errors","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>ddl_exist_errors \u4f5c\u7528\uff1a</p> <p>\u4e3b\u4ece\u590d\u5236\u7528\uff0c\u63a8\u8350\u503c\uff1addl_exist_errors\u3002\u7406\u8bba\u4e0a\u6211\u4eec\u4e0d\u5e94\u8be5\u8bbe\u7f6e\u8fd9\u4e2a\u503c\u7684\u3002\u5373\u5b83\u5728my.cnf\u6587\u4ef6\u4e2d\u5e94\u8be5\u662f\u6d88\u5931\u7684\u6216\u8005\u662f\u8fd9\u6837\u7684\u8868\u793a\u7684\uff1a</p> <p><code>#slave_skip_errors = ddl_exist_errors</code></p> <p>\u4f46\u662f\u6709\u65f6\u6211\u4eec\u7684\u4e00\u4e9b\u8868\uff08\u7279\u522b\u662f\u4e0d\u719f\u6089mysql\u7684\u4e00\u4e9b\u5f00\u53d1\uff09\u771f\u7684\u662f\u7528\u7684\u662fmysql5.6\u65e7\u7248\u7684\u5efa\u8868\u8bed\u53e5\uff0c\u8fd9\u4e2a\u95ee\u9898\u5728\u5e73\u65f6\u5355\u673a\u6a21\u5f0f\u4e0b\u5f88\u96be\u53d1\u73b0\uff0c\u4e00\u65e6\u4e3b\u4ece\u7ed3\u6784\u4e00\u4e0a\u540e\uff0c\u57285.7\u4e0a\u771f\u7684\u662f\u6709\u4e00\u5b9a\u673a\u7387\uff08\u670910%-20%\u7684\u673a\u7387\uff09\u78b0\u5230ddl\u8bed\u53e5\u662f\u65e7\u7248mysql\u800c\u8fd0\u884c\u5728mysql5.7\u4e0a\uff0c\u8fd9\u65f6\u5728\u4e3b\u4ece\u590d\u5236\u65f6\u4f1a\u629b\u4e00\u4e2a\u65e0\u6cd5\u4e3b\u4ece\u590d\u5236\u7684\u9519\uff0c\u90a3\u4e48\u8fd9\u65f6\u6211\u4eec\u9700\u8981\u6293\u6570\u636e\uff0c\u8868\u5df2\u7ecf\u5efa\u597d\u4e86\uff0c\u8fd9\u4e2a\u5f71\u54cd\u4e0d\u5927\u3001\u5fae\u4e4e\u5176\u5fae\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u8bbe\u6210\u201d\u5ffd\u7565\u201c\u3002\u8fd9\u4e2a\u662f\u672c\u4eba\u7684\u5410\u8840\u7ecf\u9a8c\uff0c\u4e3a\u4ec0\u4e48\u8981\u63d0\u8fd9\u4e2a\u6897\u3002\u3002\u3002\u4f60\u4eec\u61c2\u7684\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u5982\u679c\u56e0\u4e3a\u5efa\u8868\u8bed\u53e5\u548cmysql5.7\u6709\u51b2\u7a81\u65f6\u5728\u5355\u5b9e\u4f8b\u6a21\u5f0f\u4e0bmysql\u8fd0\u884c\u65f6\u4e0d\u4f1a\u53d1\u73b0\uff0c\u5728\u4e3b\u4ece\u590d\u5236\u65f6\u5982\u679c\u6ca1\u6709\u8bbe\u8df3\u8fc7\u503c\uff0c\u4e00\u65e6\u53d1\u751f\uff0c\u4f1a\u5f71\u54cd\u4e3b\u4ece\u590d\u5236\uff0c\u8868\u73b0\u5c31\u662f\uff1a\u4e3b\u4ece\u590d\u5236\u5931\u8d25\u3002 \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>slave_skip_errors = ddl_exist_errors</p>"},{"location":"my-cnf/#67innodb_buffer_pool_dump_pct","title":"67)innodb_buffer_pool_dump_pct","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>25~40 \u4f5c\u7528\uff1a</p> <p>\u9526\u4e0a\u6dfb\u82b1\u7684\u503c\uff0c\u975e\u5fc5\u8981\uff0c\u8fd9\u8fb9\u7ed9\u51fa\u4e00\u4e9bbest practice:</p> <p>\u901a\u5e38\u6765\u8bf4\u6211\u4eec\u4f1a\u8bbe\u621025%\u3002\u5bf9\u4e8e\u5927\u5e76\u53d1\u524d\u63d0\u4e0b\u6211\u4eec\u4f1a\u4f7f\u752840\u8fd9\u4e2a\u503c\uff0c\u8fd9\u4e2a\u503c\u8d8a\u5927\uff0cmysql\u542f\u52a8\u65f6\u95f4\u8d8a\u957f\u3002\u5b83\u662f\u4f60\u7684innodb_buffer_pool_size\u7684\u767e\u5206\u6bd4\uff01</p> <p>MySQL\u9ed8\u8ba4\u5728InnoDB\u7f13\u51b2\u6c60\uff08\u800c\u4e0d\u662f\u6574\u4e2a\u7f13\u51b2\u6c60\uff09\u4e2d\u4ec5\u4fdd\u7559\u6700\u9891\u7e41\u8bbf\u95ee\u9875\u768425%\u3002\u8bf7\u6ce8\u610f\uff0c\u8fd9\u4e2a\u53d8\u91cf\u662f\u57fa\u4e8e\u5185\u5b58\u4e2d\u7684\u5b9e\u9645\u6570\u636e\u91cf\uff0c\u800c\u4e0d\u662f\u7f13\u51b2\u6c60\u7684\u5927\u5c0f\u3002\u4f8b\u5982\uff0c\u5982\u679c\u6709100GB\u7684\u7f13\u51b2\u6c60\uff0c\u4f46\u53ea\u670910GB\u7684\u6570\u636e\uff0c\u9ed8\u8ba4\u53ea\u670910GB\u768425%\uff08\u53732.5GB\uff09\u6570\u636e\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u3002</p> <p>\u5728\u591a\u6570\u4f7f\u7528\u573a\u666f\u4e0b\uff0c\u5408\u7406\u7684\u9009\u62e9\u662f\uff1a\u4fdd\u7559\u6700\u6709\u7528\u7684\u6570\u636e\u9875\uff0c\u6bd4\u52a0\u8f7d\u6240\u6709\u7684\u9875(\u5f88\u591a\u9875\u53ef\u80fd\u5728\u540e\u7eed\u7684\u5de5\u4f5c\u4e2d\u5e76\u6ca1\u6709\u8bbf\u95ee\u5230)\u5728\u7f13\u51b2\u6c60\u4e2d\u8981\u66f4\u5feb\u3002\u4f60\u53ef\u4ee5\u66f4\u6539innodb_buffer_pool_dump_pct\u53d8\u91cf\u7684\u503c\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u4e0d\u914d\u7684\u8bdd\u4e0d\u751f\u6548\u3002 \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_buffer_pool_dump_pct=25</p>"},{"location":"my-cnf/#68innodb_page_cleaners8","title":"68)innodb_page_cleaners=8","text":"<p>\u8fd9\u503c\u4e00\u822c\u4f1a\u5728\u4e3b\u4ece\u5ef6\u8fdf\u7684\u60c5\u51b5\u4e0b\u4f1a\u53bb\u8bbe\uff0c\u5b83\u7684\u503c\u6700\u597d\u662f=innodb_buffer_pool_instance\u7684\u503c\uff0c\u5b83\u5c31\u662fcpu\u7684\u6838\u6570\u3002</p>"},{"location":"my-cnf/#69innodb_undo_log_truncate","title":"69)innodb_undo_log_truncate","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>1 \u4f5c\u7528\uff1a</p> <p>\u5efa\u8bae\u5f00\u542f\uff0c\u8bbe\u4e3a1</p> <p>innodb_undo_log_truncate\u53c2\u6570\u8bbe\u7f6e\u4e3a1\uff0c\u5373\u5f00\u542f\u5728\u7ebf\u56de\u6536\uff08\u6536\u7f29\uff09undo log\u65e5\u5fd7\u6587\u4ef6\uff0c\u652f\u6301\u52a8\u6001\u8bbe\u7f6e\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u4e0d\u914d\u7684\u8bdd\u662f\u4e0d\u751f\u6548\u7684\u3002 \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_undo_log_truncate=1</p>"},{"location":"my-cnf/#70innodb_max_undo_log_size","title":"70)innodb_max_undo_log_size","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>\u63a8\u8350\u5728\u9ed8\u8ba4\u503c\u76842\u500d\uff08\u9ed8\u8ba4\u4e3a1GB\uff09 \u4f5c\u7528\uff1a</p> <p>\u63a8\u8350\u5728\u9ed8\u8ba4\u503c\u76842\u500d\uff08\u9ed8\u8ba4\u4e3a1GB\uff09\uff0c\u4e00\u822c\u6211\u4eec\u4e0d\u4f1a\u8f7b\u6613\u53bb\u8bbe\u5b83\u3002</p> <p>\u8fd9\u4e2a\u503c\u548cinnodb_undo_tablespaces\u3001innodb_undo_logs\u4ee5\u53cainnodb_purge_rseg_truncate_frequency\u6709\u5173\uff0c\u8fd94\u4e2a\u503c\u662f\u4e92\u76f8\u6709\u7275\u8fde\u7684\u3002</p> <p>1\uff09innodb_undo_tablespaces\u5fc5\u987b\u4e3a&gt;=3</p> <p>2\uff09innodb_undo_logs\u5fc5\u987b\u5f00\u542f</p> <p>3\uff09innodb_purge_rseg_truncate_frequence\u5fc5\u987b\u5f00\u542f</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u7cfb\u7edf\u6309\u71671GB\u6765\u8ba1\u7b97\u3002 \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_max_undo_log_size=2G</p>"},{"location":"my-cnf/#71innodb_purge_rseg_truncate_frequency","title":"71)innodb_purge_rseg_truncate_frequency","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>128 \u4f5c\u7528\uff1a</p> <p>\u9ed8\u8ba4\u503c\u5728128\uff0c\u8fd9\u4e2a\u503c\u4e0d\u592a\u4f1a\u53bb\u78b0\u3002\u63a7\u5236\u56de\u6536undo log\u7684\u9891\u7387\u3002 \u6307\u5b9apurge\u64cd\u4f5c\u88ab\u5524\u8d77\u591a\u5c11\u6b21\u4e4b\u540e\u624d\u91ca\u653erollback segments\u3002\u5f53undo\u8868\u7a7a\u95f4\u91cc\u9762\u7684rollback segments\u88ab\u91ca\u653e\u65f6\uff0cundo\u8868\u7a7a\u95f4\u624d\u4f1a\u88abtruncate\u3002\u7531\u6b64\u53ef\u89c1\uff0c\u8be5\u53c2\u6570\u8d8a\u5c0f\uff0cundo\u8868\u7a7a\u95f4\u88ab\u5c1d\u8bd5truncate\u7684\u9891\u7387\u8d8a\u9ad8\u3002 \u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u7cfb\u7edf\u9ed8\u8ba4\u6309\u7167\uff1a128\u53bb\u8bbe\u5b9a\u3002 \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>innodb_purge_rseg_truncate_frequency=128</p>"},{"location":"my-cnf/#72binlog_gtid_simple_recovery","title":"72)binlog_gtid_simple_recovery","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>\u5efa\u8bae\u5f00\u542f \u4f5c\u7528\uff1a</p> <p>\u524d\u63d0\u662f\u4f60\u7684mysql\u5fc5\u987b&gt;5.7.6\uff0c\u5426\u5219\u8981\u8bbe\u4e3a\u5173\u95ed\u3002</p> <p>\u8fd9\u4e2a\u53c2\u6570\u63a7\u5236\u4e86\u5f53mysql\u542f\u52a8\u6216\u91cd\u542f\u65f6\uff0cmysql\u5728\u641c\u5bfbGTIDs\u65f6\u662f\u5982\u4f55\u8fed\u4ee3\u4f7f\u7528binlog\u6587\u4ef6\u7684\u3002</p> <p>\u8fd9\u4e2a\u9009\u9879\u8bbe\u7f6e\u4e3a\u771f\uff0c\u4f1a\u63d0\u5347mysql\u6267\u884c\u6062\u590d\u7684\u6027\u80fd\u3002\u56e0\u4e3a\u8fd9\u6837mysql-server\u542f\u52a8\u548cbinlog\u65e5\u5fd7\u6e05\u7406\u66f4\u5feb\u3002\u8be5\u53c2\u6570\u4e3a\u771f\u65f6\uff0cmysql-server\u53ea\u9700\u6253\u5f00\u6700\u8001\u7684\u548c\u6700\u65b0\u7684\u8fd92\u4e2abinlog\u6587\u4ef6\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e3a0 \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>binlog_gtid_simple_recovery=1</p>"},{"location":"my-cnf/#73log_timestamps","title":"73)log_timestamps","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>system \u4f5c\u7528\uff1a</p> <p>\u63a8\u8350\u4f7f\u7528:system</p> <p>\u8fd9\u4e2a\u53c2\u6570\u4e3b\u8981\u662f\u63a7\u5236\u9519\u8bef\u65e5\u5fd7\u3001\u6162\u67e5\u8be2\u65e5\u5fd7\u7b49\u65e5\u5fd7\u4e2d\u7684\u663e\u793a\u65f6\u95f4\u3002\u4f46\u5b83\u4e0d\u4f1a\u5f71\u54cd\u67e5\u8be2\u65e5\u5fd7\u548c\u6162\u65e5\u5fd7\u5199\u5230\u8868 (mysql.general_log, mysql.slow_log) \u4e2d\u7684\u663e\u793a\u65f6\u95f4\uff0c\u6b64\u53c2\u6570\u662f\u5168\u5c40\u7684\uff0c\u53ef\u4ee5\u52a8\u6001\u4fee\u6539\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u503c\u4e3a:UTC \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>log_timestamps=system</p>"},{"location":"my-cnf/#74transaction_write_set_extraction","title":"74)transaction_write_set_extraction","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>\u8fd9\u4e2a\u503c\u4e0d\u9700\u8981\u53bb\u8bbe\uff0c\u56e0\u4e3a\u4f60\u7528\u7684\u4e0d\u662fmysql8.0\uff0c\u57285.7.6\u7248\u4ee5\u540e\u8fd9\u4e2a\u5236\u4e0d\u662f\u5f88\u6210\u719f\uff0c\u5982\u679c\u8981\u5f00\u542f\u4e00\u822c\u4f1a\u4f7f\u7528\uff1aXXHASH64. \u4f5c\u7528\uff1a</p> <p>\u8fd9\u4e2a\u503c\u662f\u57fa\u4e8egroup(\u5e76\u884c\uff09\u590d\u5236\u7528\u7684\uff0c\u63a8\u8350\u503c\u4e3a\uff1aXXHASH64\uff0c\u5982\u679c\u6ca1\u6709\u5f00\u542f\u57fa\u4e8egroup\uff08\u5e76\u884c\uff09\u7684\u590d\u5236\u5343\u4e07\u4e0d\u8981\u53bb\u8bbe\u8fd9\u4e2a\u53c2\u6570\uff0c\u8bbe\u90fd\u4e0d\u7528\u53bb\u8bbe\uff0c\u4fdd\u6301\u9ed8\u8ba4\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u4e3aoff\u72b6\u6001\uff0c\u5373\u4e0d\u751f\u6548\u3002 \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>transaction_write_set_extraction = OFF</p> <p>transaction_write_set_extraction = XXHASH64</p> <p>transaction_write_set_extraction = MURMUR32</p>"},{"location":"my-cnf/#75show_compatibility_56","title":"75)show_compatibility_56","text":"<p>\u63a8\u8350\u8bbe\u7f6e\uff1a</p> <p>on \u4f5c\u7528\uff1a</p> <p>\u63a8\u8350\u6253\u5f00\u3002\u8fd9\u4e2a\u53c2\u6570\u662f\u517c\u5bb9mysql5.6\u7248\u7684INFORMATION_SCHEMA.GLOBAL_STATUS\u76f8\u5173\u529f\u80fd\u7684\uff0c\u5b83\u6709\u5229\u4e8e\u4ece5.6\u52305.7\u7684\u8fc7\u6e21\u65f6\u975emysql\u4e13\u804cdba\u4f46\u662f\u61c2mysql\u7684\u8fd0\u7ef4\u7528\u7684\u3002 \u5982\u679c\u4e0d\u914d\u7684\u540e\u679c\uff1a</p> <p>\u9ed8\u8ba4\u662foff\u3002\u76f8\u5f53\u4e8e\u4e25\u683c\u6a21\u5f0f\u3002 \u914d\u7f6e\u5b9e\u4f8b\uff1a</p> <p>show_compatibility_56=on</p>"},{"location":"mydumper/","title":"mydumper","text":"<ul> <li>https://docs.microsoft.com/ja-jp/azure/mysql/concepts-migrate-mydumper-myloader</li> <li>https://gihyo.jp/dev/serial/01/mysql-road-construction-news/0168</li> <li>https://www.cxybb.com/article/qq_33656602/90671188#myloader__253</li> <li>https://github.com/mydumper/mydumper/tree/master/docs</li> </ul>"},{"location":"mydumper/#mytop","title":"mytop","text":"<ul> <li>https://github.com/charles-001/dolphie</li> <li>https://github.com/lefred/innotopgo</li> <li>https://github.com/jzawodn/mytop </li> </ul>"},{"location":"mydumper/#mydumper-myloader","title":"mydumper &amp; myloader \u306e\u4f7f\u3044\u65b9","text":"<ul> <li>mydumper\u4e3b\u306b2\u3064\u306e\u30b3\u30de\u30f3\u30c9\uff1a<ul> <li>mydumper\u306f\u30d0\u30c3\u30af\u30a2\u30c3\u30d7(dump)\u7528\u3002</li> <li>myloader\u306f\u5fa9\u65e7(import)\u7528\u3002</li> </ul> </li> <li>mydumper Options<ul> <li>https://github.com/mydumper/mydumper#how-does-consistent-snapshot-work</li> <li>https://github.com/mydumper/mydumper/blob/master/docs/mydumper_usage.rst</li> </ul> </li> </ul>"},{"location":"mydumper/#dbdump","title":"\u5358\u4e00\u306eDB\u3092DUMP\u3059\u308b\u5834\u5408","text":"<pre><code># \u5358\u4e00\u306eDB\u3092DUMP\u3059\u308b\u5834\u5408\n$ mydumper -u root -p root -h mysql_server  -B &lt;\u5bfe\u8c61DB\u540d&gt; -o &lt;outputdir&gt;\n</code></pre>"},{"location":"mydumper/#dbdump_1","title":"\u8907\u6570\u306eDB\u3092DUMP\u3059\u308b\u5834\u5408","text":"<ul> <li> <p>\u6ce8\u610f\uff1a</p> <ul> <li>mysqldump\u307f\u305f\u3044\u306a\u30ab\u30f3\u30de\uff08,\uff09\u3067\u533a\u5207\u308a\u3057\u3066\u6307\u5b9a\u3067\u304d\u306a\u3044\u3067\u3059\u3002\u6b63\u898f\u8868\u73fe\u3067\u8907\u6570\u306eDB\u3092\u6307\u5b9a\u3059\u308b\u3002</li> </ul> </li> <li> <p>\u5168DB\u3092dump\u3059\u308b\u5834\u5408     <pre><code># zst\u5727\u7e2e\u7387\u6307\u5b9a\n/usr/bin/mydumper --events --routines --triggers --success-on-1146 --statement-size=8000000 --chunk-filesize=1024 --kill-long-queries --complete-insert --use-savepo ints --threads=8 --less-locking --trx-consistency-only --logfile /home/backup/mydumper.log  -v 3 --outputdir=/home/backup/20230925/ --defaults-file=/home/backup/mydumper.cnf --exec-per- thread '/usr/bin/zstd --ultra -22' --exec-per-thread-extension=\".zst\"\n# zst\u5727\u7e2e\u7387\u6307\u5b9a\u3057\u306a\u3044\uff08\u30c7\u30d5\u30a9\u30eb\u30c8:3\uff09\n/usr/bin/mydumper --events --routines --triggers --success-on-1146 --statement-size=8000000 --chunk-filesize=1024 --kill-long-queries --complete-insert --use-savepoints --threads=8 --less-locking --trx-consistency-only --logfile /home/backup/mydumper.log  --compress=ZSTD -v 3 --outputdir=/home/backup/20230925/ --defaults-file=/home/backup/mydumper.cnf\n\n# \u5727\u7e2e\u306a\u3057\n# mydumper -o /root/work/20220728_test\n# \u5727\u7e2e\u3042\u308a\n# mydumper -o /root/work/20220728_test\u3000-c\n</code></pre></p> </li> <li> <p>python\u7528\u30bd\u30fc\u30b9\u629c\u7c8b</p> <pre><code>def my_dumper(regex, cores, log_file, desc_path):\n    \"\"\"\n    \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306f\u81ea\u52d5\u7684\u306b\u4e0a\u66f8\u304d\u3055\u308c\u308b\n    exclude_dbs \u3092\u9664\u5916\u3057\u3066\u6b8b\u308a\u3092\u5168\u90e8dump\u3059\u308b\n    regex: exclude dbs\n    cores: threads\n    DUMP_LOG_PATH + logfile: logfile\n    desc_path: dump file dir\n    return p.returncode, stdout_data, stderr_data\n    (0, '', '')\n    \"\"\"\ncommand = (\"nice -n \"\n+ str(NICE_LV) +\n               \" /usr/bin/mydumper\"\n+ regex +\n               \" --events --routines --triggers --success-on-1146\"\n\" --statement-size=8000000 --chunk-filesize=1024\"\n\" --kill-long-queries --complete-insert --use-savepoints\"\n\" --socket=/tmp/mysql.sock --defaults-file=/root/.my.cnf \"\n\" --threads=\"\n+ cores\n               + \" --less-locking --trx-consistency-only --logfile \"\n+ DUMP_LOG_PATH + logfile\n               + \" --compress=ZSTD -v \"\n+ str(LOG_LV)\n+ \" --outputdir=\"\n+ desc_path)\nreturn shell.runCmd(command)\n</code></pre> </li> <li> <p>Once can use --regex functionality, for example not to dump mysql and test databases:     <pre><code>mydumper --regex '^(?!(mysql\\.|test\\.))'\n</code></pre></p> </li> <li> <p>To dump only mysql and test databases     <pre><code>mydumper --regex '^(mysql\\.|test\\.)'\n</code></pre></p> </li> <li>To not dump all databases starting with test:     <pre><code>mydumper --regex '^(?!(test))'\n</code></pre></li> <li>To dump specify tables in different databases (Note: The name of tables should end with $. related issue):     <pre><code>mydumper --regex '^(db1\\.table1$|db2\\.table2$)'\n</code></pre></li> <li>If you want to dump a couple of databases but discard some tables, you can do:     <pre><code># Which will dump all the tables in db1 and db2 but it will exclude db1.table1 and db2.table2\nmydumper --regex '^(?=(?:(db1\\.|db2\\.)))(?!(?:(db1\\.table1$|db2\\.table2$)))'\n</code></pre></li> </ul>"},{"location":"mydumper/#mydumper_1","title":"mydumper\u30aa\u30d7\u30b7\u30e7\u30f3","text":"<ul> <li>https://www.codetd.com/ja/article/12340925</li> <li> <p>\u5728\u5907\u4efd\u6570\u636e\u65f6\uff0c\u9ed8\u8ba4\u53ea\u5907\u4efd\u5e93\u3001\u8868\u7684\u5b9a\u4e49\u548c\u6570\u636e\u6587\u4ef6\uff0c\u89e6\u53d1\u5668\uff0c\u4e8b\u4ef6\uff0c\u51fd\u6570\u548c\u5b58\u50a8\u8fc7\u7a0b\u9700\u8981\u52a0\u4e0a\u76f8\u5e94\u7684\u9009\u9879\u624d\u4f1a\u5907\u4efd</p> </li> <li> mydumper <pre><code>Usage:\n  mydumper [OPTION?] multi-threaded MySQL dumping\n\nHelp Options:\n  -?, --help                  Show help options\n\nApplication Options:\n  -B, --database              \u8981\u5907\u4efd\u7684\u6570\u636e\u5e93\uff0c\u4e0d\u6307\u5b9a\u5219\u5907\u4efd\u6240\u6709\u5e93\n  -T, --tables-list           \u9700\u8981\u5907\u4efd\u7684\u8868\uff0c\u591a\u8868\u7528\u9017\u53f7\u9694\u5f00\n  -O, --omit-from-file        \u5305\u542b\u8981\u8df3\u8fc7\u7684 database.table \u6761\u76ee\u5217\u8868\u7684\u6587\u4ef6\uff0c\u6bcf\u884c\u4e00\u4e2a\uff08\u5728\u5e94\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u9009\u9879\u4e4b\u524d\u8df3\u8fc7\uff09\n  -o, --outputdir             \u5907\u4efd\u6587\u4ef6\u8f93\u51fa\u7684\u76ee\u5f55\n  -s, --statement-size        \u751f\u6210\u7684 insert \u8bed\u53e5\u7684\u5b57\u8282\u6570\uff0c\u9ed8\u8ba4 1000000(\u8fd9\u4e2a\u53c2\u6570\u4e0d\u80fd\u592a\u5c0f\uff0c\u4e0d\u7136\u4f1a\u62a5 Row bigger than statement_size for tools.t_serverinfo)\n-r, --rows                  \u5c06\u8868\u6309\u884c\u5206\u5757\u65f6\uff0c\u6307\u5b9a\u7684\u5757\u884c\u6570\uff0c\u6307\u5b9a\u8fd9\u4e2a\u9009\u9879\u4f1a\u5173\u95ed --chunk-filesize\n  -F, --chunk-filesize        \u5c06\u8868\u6309\u5927\u5c0f\u5206\u5757\u65f6\uff0c\u6307\u5b9a\u7684\u5757\u5927\u5c0f\uff0c\u5355\u4f4d\u662f MB\n  -c, --compress              \u538b\u7f29\u8f93\u51fa\u6587\u4ef6\n  -e, --build-empty-files     \u5982\u679c\u8868\u6570\u636e\u662f\u7a7a\uff0c\u8fd8\u662f\u4ea7\u751f\u4e00\u4e2a\u7a7a\u6587\u4ef6\uff08\u9ed8\u8ba4\u65e0\u6570\u636e\u5219\u53ea\u6709\u8868\u7ed3\u6784\u6587\u4ef6\uff09\n  -x, --regex                 \u652f\u6301\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d'db.table',\u5982mydumper \u2013regex '^(?!(mysql|test))'\n-i, --ignore-engines        \u5ffd\u7565\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u7528\u9017\u53f7\u5206\u5272\n  -N, --insert-ignore         \u4f7f\u7528 INSERT IGNORE \u8f6c\u50a8\u884c\u6570\u636e\n  -m, --no-schemas            \u4e0d\u5907\u4efd\u8868\u7ed3\u6784\n  -d, --no-data               \u4e0d\u5907\u4efd\u8868\u6570\u636e\n  -G, --triggers              \u5907\u4efd\u89e6\u53d1\u5668\n  -E, --events                \u5907\u4efd\u4e8b\u4ef6\n  -R, --routines              \u5907\u4efd\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570\n  -W, --no-views              \u4e0d\u5907\u4efd\u89c6\u56fe\n  -k, --no-locks              \u4e0d\u4f7f\u7528\u4e34\u65f6\u5171\u4eab\u53ea\u8bfb\u9501\uff0c\u4f7f\u7528\u8fd9\u4e2a\u9009\u9879\u4f1a\u9020\u6210\u6570\u636e\u4e0d\u4e00\u81f4\n  --no-backup-locks           \u4e0d\u4f7f\u7528 Percona \u5907\u4efd\u9501\n  --less-locking              \u51cf\u5c11\u5bf9 InnoDB \u8868\u7684\u9501\u5b9a\u65f6\u95f4\n  -l, --long-query-guard      \u8bbe\u5b9a\u963b\u585e\u5907\u4efd\u7684\u957f\u67e5\u8be2\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u662f\u79d2\uff0c\u9ed8\u8ba4\u662f60\u79d2\uff08\u8d85\u65f6\u540e\u9ed8\u8ba4mydumper\u5c06\u4f1a\u9000\u51fa\uff09\n  -K, --kill-long-queries     \u6740\u6389\u957f\u67e5\u8be2 (\u800c\u4e0d\u662f\u9000\u51fa mydumper)\n-D, --daemon                \u542f\u7528\u5b88\u62a4\u8fdb\u7a0b\u6a21\u5f0f\uff0c\u5b88\u62a4\u8fdb\u7a0b\u6a21\u5f0f\u4ee5\u67d0\u4e2a\u95f4\u9694\u4e0d\u95f4\u65ad\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u5907\u4efd\n  -I, --snapshot-interval     \u6bcf\u4e2a\u5907\u4efd\u5feb\u7167\u4e4b\u95f4\u7684\u95f4\u9694\uff08\u4ee5\u5206\u949f\u4e3a\u5355\u4f4d\uff09\uff0c\u9700\u8981 --daemon \u9009\u9879\uff0c\u9ed8\u8ba4\u4e3a 60\n-L, --logfile               \u4f7f\u7528\u7684\u65e5\u5fd7\u6587\u4ef6\u540d(mydumper\u6240\u4ea7\u751f\u7684\u65e5\u5fd7), \u9ed8\u8ba4\u4f7f\u7528\u6807\u51c6\u8f93\u51fa\n  --tz-utc                    \u8bbe\u7f6e\u65f6\u533a\uff0c\u53ea\u6709\u5907\u4efd\u5e94\u7528\u5230\u4e0d\u540c\u65f6\u533a\u65f6\u4f7f\u7528\u3002\u9ed8\u8ba4\u4f7f\u7528 --skip-tz-utc \u6765\u5173\u95ed\u8be5\u9009\u9879\n  --skip-tz-utc               \u89c1\u4e0a\n  --use-savepoints            \u4f7f\u7528 savepoints \u6765\u51cf\u5c11\u91c7\u96c6 metadata \u6240\u9020\u6210\u7684\u9501\u65f6\u95f4\uff0c\u9700\u8981 SUPER \u6743\u9650\n  --success-on-1146           Not increment error count and Warning instead of Critical in case of table doesn't exist\n  --lock-all-tables           \u9501\u4f4f\u5b9e\u4f8b\u4e0a\u6240\u6709\u8868\uff0c\u800c\u4e0d\u662f\u7ed9\u5b9e\u4f8b\u65bd\u52a0 FTWRL\n  -U, --updated-since         \u4f7f\u7528 update_time \u6765\u5907\u4efd\u6700\u8fd1 U \u5929\u5185\u6709\u8fc7\u66f4\u65b0\u8bb0\u5f55\u7684\u8868\n  --trx-consistency-only      Transactional consistency only\n  --complete-insert           \u5305\u542b\u5217\u540d\u7684\u5b8c\u6574 INSERT \u8bed\u53e5\n  -z, --tidb-snapshot         Snapshot to use for TiDB\n  -h, --host                  \u8fde\u63a5\u7684\u4e3b\u673a\u540d\n  -u, --user                  \u5907\u4efd\u6240\u4f7f\u7528\u7684\u7528\u6237\n  -p, --password              \u5bc6\u7801\uff08\u4e0d\u652f\u6301\u4ea4\u4e92\u5f0f\u8f93\u5165\u5bc6\u7801\uff09\n  -a, --ask-password          \u63d0\u793a\u7528\u6237\u5bc6\u7801\n  -P, --port                  \u7aef\u53e3\n  -S, --socket                \u4f7f\u7528 socket \u65b9\u5f0f\u5907\u4efd\u5b9e\u4f8b\uff08\u4f7f\u7528\u4e0d\u6210\u529f\uff0c\u6682\u65f6\u53ea\u6210\u529f\u7684\u4f7f\u7528\u4e86\u57fa\u4e8e host \u7684\u65b9\u5f0f\u5907\u4efd\uff09\n  -t, --threads               \u5f00\u542f\u7684\u5907\u4efd\u7ebf\u7a0b\u6570\uff0c\u9ed8\u8ba4\u662f 4\n-C, --compress-protocol     \u538b\u7f29\u4e0e mysql \u901a\u4fe1\u7684\u6570\u636e\n  -V, --version               \u663e\u793a\u7248\u672c\u53f7\n  -v, --verbose               \u8f93\u51fa\u4fe1\u606f\u6a21\u5f0f, 0 = silent, 1 = errors, 2 = warnings, 3 = info, \u9ed8\u8ba4\u4e3a 2\n--defaults-file             \u4f7f\u7528\u4e00\u4e2a\u6307\u5b9a\u7684\u6587\u4ef6\n  --ssl                       \u4f7f\u7528 SSL \u8fde\u63a5\n  --key                       The path name to the key file\n  --cert                      The path name to the certificate file\n  --ca                        The path name to the certificate authority file\n  --capath                    The path name to a directory that contains trusted SSL CA certificates in PEM format\n  --cipher                    A list of permissible ciphers to use for SSL encryption\n</code></pre> </li> <li> myloader \u53c2\u6570\u540d \u7f29\u5199 \u542b\u4e49 --user -u \u4f7f\u7528\u7684\u7528\u6237\u540d --pasword -p \u8fde\u63a5\u6240\u7528\u7684\u7528\u6237\u5bc6\u7801 --host -h MySQL \u670d\u52a1\u7aef\u5730\u5740 --port -P MySQL \u7aef\u53e3\u53f7 --threads -t \u5f00\u542f\u7684\u7ebf\u7a0b\u6570\uff0c\u9ed8\u8ba4\u662f4 --directory -d \u6307\u5b9a\u5f85\u6062\u590d\u7684\u5907\u4efd\u76ee\u5f55 --queries-per-transaction -q \u6bcf\u6b21\u4e8b\u52a1\u6267\u884c\u7684\u67e5\u8be2\u6570\u91cf\uff0c\u9ed8\u8ba4\u662f1000 --overwrite-tables -o \u5982\u679c\u8981\u6062\u590d\u7684\u8868\u5b58\u5728\uff0c\u5219\u5148drop\u6389\u8be5\u8868 --database -B \u9700\u8981\u8fd8\u539f\u5230\u54ea\u4e2a\u6570\u636e\u5e93\uff08\u76ee\u6807\u6570\u636e\u5e93\uff09 --source-db -s \u9009\u62e9\u88ab\u8fd8\u539f\u7684\u6570\u636e\u5e93\uff08\u6e90\u6570\u636e\u5e93\uff09 --enable-binlog -e \u5728\u6062\u590d\u65f6\u5f00\u542fbinlog <pre><code>Usage:\n  myloader [OPTION?] multi-threaded MySQL loader\n\nHelp Options:\n  -?, --help                        Show help options\n\nApplication Options:\n  -d, --directory                   \u8981\u5bfc\u5165\u7684\u5907\u4efd\u6587\u4ef6\u8981\u5b58\u653e\u7684\u6587\u4ef6\u5939\n  -q, --queries-per-transaction     \u6bcf\u4e2a\u4e8b\u52a1\u7684query\u6570\u91cf, \u9ed8\u8ba41000\n  -o, --overwrite-tables            \u5982\u679c\u8868\u5b58\u5728\u5219\u5148\u5220\u9664\uff0c\u4f7f\u7528\u8be5\u53c2\u6570\u65f6\uff0c\u9700\u8981\u786e\u4fdd\u5907\u4efd\u65f6\u5019\u5907\u4efd\u4e86\u8868\u7ed3\u6784\uff0c\u4e0d\u7136\u8fd8\u539f\u4f1a\u627e\u4e0d\u5230\u8868\n  -B, --database                    \u6307\u5b9a\u9700\u8981\u8fd8\u539f\u7684\u6570\u636e\u5e93\n  -s, --source-db                   \u8fd8\u539f\u7684\u6570\u636e\u5e93\uff08\u5907\u4efd\u6587\u4ef6\u4e2d\uff09\n  -e, --enable-binlog               \u542f\u7528\u8fd8\u539f\u6570\u636e\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\n  -h, --host                        \u4e3b\u673a\n  -u, --user                        \u8fd8\u539f\u7684\u7528\u6237\n  -p, --password                    \u5bc6\u7801\n  -a, --ask-password                Prompt For User password\n  -P, --port                        TCP/IP \u8fde\u63a5\u6240\u7528\u7684\u7aef\u53e3\u53f7\n  -S, --socket                      UNIX socket \u65b9\u5f0f\u8fde\u63a5\u7684\u6587\u4ef6\n  -t, --threads                     \u8fd8\u539f\u6240\u4f7f\u7528\u7684\u7ebf\u7a0b\u6570\u91cf\n  -C, --compress-protocol           \u5728 MySQL \u8fde\u63a5\u4e0a\u4f7f\u7528\u538b\u7f29\n  -V, --version                     \u663e\u793a\u7248\u672c\n  -v, --verbose                     \u8f93\u51fa\u6a21\u5f0f, 0 = silent, 1 = errors, 2 = warnings, 3 = info, \u9ed8\u8ba4\u4e3a2\n\n# \u6062\u590d\u5907\u4efd\u6587\u4ef6\u4e2d\u7684\u5168\u90e8 \u82e5\u8868\u5df2\u5b58\u5728\u5219\u5148\u5220\u9664\nmyloader -u root -p 123456 -o -d /backups/all3\n\n# \u4ece\u5168\u5907\u4e2d\u6062\u590d\u6307\u5b9a\u5e93\nmyloader -u root -p 123456 -s db1 -o -d /backups/all3\n\n# \u5c06\u67d0\u4e2a\u6570\u636e\u5e93\u5907\u4efd\u8fd8\u539f\u5230\u53e6\u4e00\u4e2a\u6570\u636e\u5e93\u4e2d\uff08\u76ee\u6807\u5e93\u4e0d\u5b58\u5728\u5219\u4f1a\u65b0\u5efa\uff09\nmyloader -u root -p 123456 -B recover_db1 -s db1 -o -d /backups/all3\nmyloader -u root -p 123456 -B recover_db1 -o -d /backups/db1\n\n# \u6062\u590d\u65f6\u5f00\u542fbinlog\uff08\u6709\u5907\u5e93\u7684\u65f6\u5019\u9700\u8981\u5f00\u542f\uff09\nmyloader -u root -p 123456 -e -o -d /backups/db1\n\n# \u65e0\u6cd5\u76f4\u63a5\u8fd8\u539f\u5355\u8868 \u53ea\u80fd\u627e\u5230\u5355\u8868\u7684sql\u6587\u4ef6 \u8fdb\u5165\u547d\u4ee4\u884csource \u6267\u884c\nsource db1.tb1-schema.sql \u8fd8\u539f\u8868\u7ed3\u6784\nsource db1.tb1.sql \u8fd8\u539f\u8868\u6570\u636e\n</code></pre> </li> <li> mydumper\u5907\u4efd\u8fc7\u7a0b <pre><code>mydumper\u5907\u4efd\u8fc7\u7a0b\n1\u3001\u8fde\u63a5\u76ee\u6807\u6570\u636e\u5e93 / \u5bfe\u8c61DB\u306b\u63a5\u7d9a\n2\u3001\u901a\u8fc7show processlist\u6765\u5224\u65ad\u662f\u5426\u6709\u957f\u67e5\u8be2\uff0c\u6839\u636e\u53c2\u6570long-query-guard\u548ckill-long-queries\u51b3\u5b9a\u9000\u51fa\u6216\u6740\u6389\u957f\u67e5\u8be2 / show processlist\u306b\u3066\u9577\u3044\u30af\u30a8\u30ea\u3092\u78ba\u8a8d\u3057\u3001\u5f15\u6570long-query-guard\u3068kill-long-queries\u306b\u3066kill\u3059\u308b\u3002\n3\u3001\u4e3b\u7ebf\u7a0b / \u30e1\u30a4\u30f3\u30d7\u30ed\u30bb\u30b9 flush tables with read lock\uff1bstart transaction with consistent snapshot\n4\u3001\u4e3b\u7ebf\u7a0b\u8bfb\u53d6\u5f53\u524d\u65f6\u95f4\u70b9\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u540d\u548c\u65e5\u5fd7\u5199\u5165\u7684\u4f4d\u7f6e\u5e76\u8bb0\u5f55\u5728metadata\u6587\u4ef6\u4e2d\uff0c\u4ee5\u4f9b\u5373\u65f6\u70b9\u6062\u590d\u4f7f\u7528 / \u30e1\u30a4\u30f3\u30d7\u30ed\u30bb\u30b9\u306b\u3066\u73fe\u5728\u306e\u6642\u9593\u306ebinlog\u30d5\u30a1\u30a4\u30eb\u540d\u3068binlog\u306e\u4f4d\u7f6e\u3092metadata\u30d5\u30a1\u30a4\u30eb\u306b\u8a18\u9332\u3059\u308b\u3002\n5\u3001\u521b\u5efadump\u7ebf\u7a0b\uff0c\u7f3a\u7701\u4e3a4\u4e2a\u3000/\u3000dump\u30b9\u30ec\u30c3\u30c8\u3092\u4f5c\u6210\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306f4\n6\u3001\u786e\u5b9a\u5019\u9009\u8868\uff0c\u6839\u636e\u7c7b\u522b\u5206\u522b\u63d2\u5165non_innodb_table\u3001innodb_tables\u4ee5\u53catable_schemas\u94fe\u8868\u3000/\u3000\u5bfe\u8c61\u30c6\u30fc\u30d6\u30eb\u3092\u78ba\u5b9a\u3057\u3001\u7a2e\u985e\u5225\u306b\u5bfe\u8c61\u30ea\u30b9\u30c8\u306b\u767b\u9332\n7\u3001\u5c06\u5019\u9009\u8868\u901a\u8fc7g_async_queue_push\u52a0\u5165\u4efb\u52a1\u961f\u5217(\u961f\u5217\u6700\u540e\u5143\u7d20\u662fthread shutdown)\uff0c\u7531dump\u7ebf\u7a0b\u4ece\u961f\u5217\u4e2d\u8bfb\u53d6\u8868\u4fe1\u606f\u5e76\u6267\u884c\u6570\u636e\u5bfc\u51fa\u3000/\u3000\u5bfe\u8c61\u3092g_async_queue_push\u306b\u3066\u8ee2\u9001\u30ea\u30b9\u30c8\u306b\u8ffd\u52a0\u3001dump\u30b9\u30ec\u30c3\u30c9\u304c\u5bfe\u8c61\u30ea\u30b9\u30c8\u3092\u8aad\u307f\u51fa\u3057\u3001dump\u3059\u308b\u3002\n8\u3001\u5907\u4efd\u5b8cnon_innodb_table\u540e\u7acb\u5373unlock tables\u89e3\u9501\uff0c\u4ee5\u51cf\u5c11\u9501\u5b9a\u65f6\u95f4\u3000/\u3000non_innodb_table\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u5f8c\u3001\u3059\u3050\u306bunlock tables\u3059\u308b\u3002\n9\u3001\u7b49\u5f85dump InnoDB tables\u5b8c\u6210\u3000/\u3000InnoDB\u306edump\u5b8c\u4e86\u5f85\u3061\u3002\n\n--events \u5907\u4efd\u4e8b\u4ef6\n--routines \u5907\u4efd\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570\n--triggers  \u5907\u4efd\u89e6\u53d1\u5668\n--less-locking \u51cf\u5c11\u5bf9InnoDB\u8868\u7684\u9501\u65bd\u52a0\u65f6\u95f4\n--ignore-sysdb  \u5ffd\u7565sysdb\u5e93\u548cmysql\u5e93\n--chunk-filesize \u5c06\u8868\u6309\u5927\u5c0f\u5206\u5757\u65f6\uff0c\u6307\u5b9a\u7684\u5757\u5927\u5c0f\uff0c\u5355\u4f4d\u662f MB\n--complete-insert \u4f7f\u7528\u5b8c\u6574\u7684insert\u8bed\u53e5(\u5305\u542b\u5217\u540d\u79f0)\u3002\n--outputdir \u5bfc\u51fa\u7684\u76ee\u5f55\n--statement-size=8000000\u3000\n.. option:: --statement-size, -s\n\nThe maximum size for an insert statement before breaking into a new\nstatement, default 1,000,000 bytes\n\nmyloader\n\n--enable-binlog  \u542f\u7528\u8fd8\u539f\u6570\u636e\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\n--overwrite-tables  \u5982\u679c\u8981\u6062\u590d\u7684\u8868\u5b58\u5728\uff0c\u5219\u5148drop\u6389\u8be5\u8868\uff0c\u4f7f\u7528\u8be5\u53c2\u6570\uff0c\u9700\u8981\u5907\u4efd\u65f6\u5019\u8981\u5907\u4efd\u8868\u7ed3\u6784\n\n# install zstd\n\nwget https://github.com/mydumper/mydumper/releases/download/v0.11.5-2/mydumper-0.11.5-2-zstd.el7.x86_64.rpm\nyum install glib2-devel mysql-devel openssl-devel pcre-devel zlib-devel libzstd-devel\u3000\uff5a\uff53\uff54\uff44\nyum install mydumper-0.11.5-2-zstd.el7.x86_64.rpm\n\n[root@test mysqldump]# mydumper -V\nmydumper 0.11.5, built against MySQL 5.7.34-37\n</code></pre> </li> <li> <p>https://github.com/mydumper/mydumper/blob/master/docs/mydumper_usage.rst\u3000\u3000\u3000\uff1c\u30fc\u30fc\u3000\u516c\u5f0f\u30de\u30cb\u30e5\u30a2\u30eb</p> </li> <li>https://www.cndba.cn/dave/article/4624</li> <li>https://www.modb.pro/db/34039\u3000\u3000\u3000\uff1c\u30fc\u30fc\u3000\u8a73\u7d30\u306a\u30b7\u30ca\u30ea\u30aa</li> <li>https://www.nmirage.com/database/427.html</li> <li>\u30de\u30eb\u30c1\u30b9\u30ec\u30c3\u30c9\u306e\u305f\u3081\u3001mysqldump\u3068mysqlpump\u3088\u308a\u65e9\u3044\u3067\u3059\u3002</li> <li> <p>\u554f\u984c\u70b9</p> <ul> <li>Waiting for global read lock\u3000\u306e\u554f\u984c</li> <li>dump\u6642\u3001global read lock\u304c\u304b\u304b\u3063\u3066\u308b\u305f\u3081\u3001MySQL\u306e\u5168\u64cd\u4f5c\u304c\u3067\u304d\u306a\u3044\uff08SELECT\u4ee5\u5916\uff09<ul> <li><code>Waiting for global read lock</code></li> </ul> </li> <li>\u5bfe\u5fdc\u65b9\u6cd5<ul> <li>--trx-consistency-only\u3000\u3092\u3064\u3051\u308b</li> <li>--trx-consistency-only \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u6574\u5408\u6027\u306e\u307f\u3001mysqldump\u306esingle-transaction\u3068\u540c\u3058\u3002</li> </ul> </li> </ul> </li> <li> <p>MySQL\u5bfe\u5fdc\u8868</p> <ul> <li> <p>\u5bfe\u5fdc\u72b6\u6cc1</p> MySQL4.0 MySQL5.1 MySQL5.5 MySQL5.7 MySQL8.0 mydumper X O O O O xtrabackup X X O O O </li> <li> <p>\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u901f\u5ea6</p> MySQL4.0 MySQL5.1 MySQL5.5 MySQL5.7 MySQL8.0 mydumper X \u65e9\u3044 \u65e9\u3044 \u65e9\u3044 \u65e9\u3044 xtrabackup X X DB\u6570\u3068\u30c6\u30fc\u30d6\u30eb\u6570\u306b\u5de6\u53f3\u3059\u308b DB\u6570\u3068\u30c6\u30fc\u30d6\u30eb\u6570\u306b\u5de6\u53f3\u3059\u308b DB\u6570\u3068\u30c6\u30fc\u30d6\u30eb\u6570\u306b\u5de6\u53f3\u3059\u308b </li> <li> <p>\u30e1\u30ea\u30c3\u30c8\u30fb\u30c7\u30e1\u30ea\u30c3\u30c8</p> \u30e1\u30ea\u30c3\u30c8 \u30c7\u30e1\u30ea\u30c3\u30c8 mydumper dump\u3057\u305f\u3082\u306e\u306fsql\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3001\u5fa9\u65e7\u6642DB\u6bce\u306bimport\u3067\u304d\u308b\u3002\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u901f\u5ea6\u3082\u65e9\u3044\u3002 \u5727\u7e2e\u306a\u3057\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u306f\u65e9\u3044\u3067\u3059\u304c\u3001\u5727\u7e2e\u4ed8\u304d\u306e\u5834\u5408\u304c\u9045\u3044\u3001\u3055\u3089\u306bdump\u4e2d\u3001\u5bfe\u8c61\u30c6\u30fc\u30d6\u30eb\u304clock\u3055\u308c\u305f\u307e\u307e\u3001\u64cd\u4f5c\u3067\u304d\u306a\u3044\u3002\u5727\u7e2e\u306a\u3057\u3067\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u3001\u305d\u306e\u5f8c\u5727\u7e2e(tar)\u3059\u308b\u3068\u30011\u30b5\u30fc\u30d0\u304c\u534a\u65e5\u4ee5\u4e0a\u304b\u304b\u308a\u307e\u3059\u3002 xtrabackup \u5897\u91cf\u5206\u3060\u3051\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\u305f\u3081\u3001\u30c6\u30fc\u30d6\u30eb\u6570\u5c11\u306a\u3044\u5834\u5408\u304c\u3068\u3066\u3082\u65e9\u3044\u3002\u5897\u91cf\u5206\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30b5\u30a4\u30ba\u306e\u5272\u3068\u5c0f\u3055\u3044\u3002 \u5fa9\u65e7\u306f\u5168DB\u3057\u304b\u5bfe\u5fdc\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u8a66\u9a13\u6a5f\u306bimport\u5f8c\u3001\u5bfe\u8c61DB\u3092\u62bd\u51fa\u3059\u308b\u65b9\u6cd5\u3057\u304b\u306a\u3044\u3002\u624b\u9593\u304b\u304b\u308b\u3002\u5bfe\u8c61\u30b5\u30fc\u30d0\u306eDB/TB\u304c\u591a\u3044\u5834\u5408\u3001\u3068\u3066\u3082\u9045\u3044\u4e0a\u306b\u3001\u5bfe\u8c61\u30c6\u30fc\u30d6\u30eb\u3082lock\u3055\u308c\u305f\u307e\u307e\u64cd\u4f5c\u3067\u304d\u306a\u3044\u3002 </li> </ul> </li> </ul>"},{"location":"mydumper/#_1","title":"\u5fa9\u65e7\u624b\u9806\u66f8","text":"<ul> <li>https://www.cxybb.com/article/qq_33656602/90671188#myloader__253</li> </ul> <p>\u5fa9\u65e7\u65b9\u6cd5\u4e3b\u306b2\u3064\u3042\u308a\u307e\u3059\u3002</p> <ol> <li> <p>DB\u30b5\u30fc\u30d0\u4e0a\u306e\u5fa9\u65e7\u4f5c\u696d \u30b5\u30fc\u30d3\u30b9DB\u30b5\u30fc\u30d0\u4e0a\u306e\u76f4\u63a5\u5fa9\u65e7\u4f5c\u696d\u306e\u5834\u5408\u306f\u3001\u30b5\u30fc\u30d0\u4e0a\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30c7\u30fc\u30bf\u304b\u3089\u76f4\u63a5\u5fa9\u65e7\u3059\u308b\u3002 \u3053\u306e\u65b9\u6cd5\u306f\u30aa\u30b9\u30b9\u30e1\u3057\u306a\u3044\u3001\u30b5\u30fc\u30d3\u30b9\u30b5\u30fc\u30d0\u4e0a\u5b9f\u884c\u3057\u305f\u5834\u5408\u3001\u305d\u308c\u306a\u308a\u306e\u5371\u967a\u6027\u3082\u3042\u308b\u305f\u3081\u3001\u7406\u89e3\u3057\u3066\u304b\u3089\u4f5c\u696d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff08\u57fa\u672c\u306f\u65b9\u6cd5\uff12\u3067\u5b9f\u65bd\u3059\u308b\uff09</p> <ul> <li> mydumper\u5907\u4efd\u8fc7\u7a0b <pre><code>\u4f8b\uff1a\n[root@mysqlxxx backup]# ll /home/backup/\ntotal 15G\ndrwxr-xr-x  2 root root  152 May 13 03:31 .\ndrwxr-xr-x. 8 root root   82 Feb 25  2021 ..\n-rw-r--r--  1 root root    0 Nov 18 11:34 exclude-custom-list\n-rw-r--r--  1 root root    0 May 13 03:18 exclude-db-list\n-rw-r--r--  1 root root 7.1G May 12 05:00 mysqlxxx.db.sakura.ne.jp-dump_20220512.tar\n-rw-r--r--  1 root root 7.2G May 13 03:31 mysqlxxx.db.sakura.ne.jp-dump_20220513.tar\n[root@mysqlxxx backup]#\n1. \u5bfe\u8c61\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u89e3\u51cd\u3059\u308b\u3002\n[root@mysqlxxx backup]# tar xf /home/backup/mysqlxxx.db.sakura.ne.jp-dump_20220512.tar  -C ./\n2. \u5bfe\u8c61DB\u306e\u307f\u3092\u5fa9\u65e7\u3057\u305f\u3044\u5834\u5408\u3002\uff08\u5358\u4e00DB\u306e\u5834\u5408\uff09\n# \u65e2\u5b58DB\u304c\u5b58\u5728\u3057\u305f\u5834\u5408\u3001\u4e0a\u66f8\u304d\u3055\u308c\u307e\u3059\u3002\n[root@mysqlxxx backup]# myloader --directory=20220512  --threads=8 --verbose=3  -B \u5fa9\u65e7\u3057\u305f\u3044\u5bfe\u8c61DB\u540d -s \uff08--source-db\uff09\u5fa9\u65e7\u306b\u4f7f\u3046DB\u540d -o -e\n\u4f8b\uff1a\n[root@mysql57 20220513]# myloader --directory=20220512  --threads=8 --verbose=3  -B test_www -s test_www -o -e\n** Message: 15:26:59.030: 0 00:00:25    | 0 00:00:00    | 0 00:00:25    | `test_www`.`history_xm`\n** Message: 15:26:59.030: 0 00:00:38    | 0 00:00:00    | 0 00:00:38    | `test_www`.`wp_posts`\n** Message: 15:26:59.030: 0 00:08:20    | 0 00:00:00    | 0 00:08:20    | `test_www`.`history`\n** Message: 15:26:59.030: Thread 8 restoring post on `test_www` from aaa.sql.zst\n** Message: 15:26:59.034: Thread 8 restoring post on `test_www` from bbb.sql.zst\n** Message: 15:26:59.035: Starting table checksum verification\n[root@mysql57 20220513]#\n\u4f8b\uff1a\n[root@ work]#\n[root@ work]# tar xf mysql-dump_20220726.tar -C ./\n[root@ work]# myloader --directory=20220726 --verbose=3 -B installer -s installer -o -e\n[root@ work]# myloader --directory=20220726 --verbose=3 -B installer -s installer -o -e\n** Message: 15:58:04.336: Server version reported as: 5.7.34-log\n** Message: 15:58:04.340: Thread 4 restoring table `installer`.`migrations` from /root/work/20220726/installer.migrations-schema.sql.zst\n** Message: 15:58:04.340: Dropping table or view (if exists) `installer`.`migrations`\n** Message: 15:58:04.340: Thread 1 restoring table `installer`.`m_switches` from /root/work/20220726/installer.m_switches-schema.sql.zst\n** Message: 15:58:04.340: Thread 3 restoring table `installer`.`t_networks` from /root/work/20220726/installer.t_networks-schema.sql.zst\n** Message: 15:58:04.340: Dropping table or view (if exists) `installer`.`t_networks`\n** Message: 15:58:04.340: Dropping table or view (if exists) `installer`.`m_switches`\n** Message: 15:58:04.340: Thread 2 restoring table `installer`.`t_processing_segments` from /root/work/20220726/installer.t_processing_segments-schema.sql.zst\n** Message: 15:58:04.341: Dropping table or view (if exists) `installer`.`t_processing_segments`\n** Message: 15:58:04.355: Creating table `installer`.`migrations` from content in /root/work/20220726/installer.migrations-schema.sql.zst\n** Message: 15:58:04.357: Creating table `installer`.`t_networks` from content in /root/work/20220726/installer.t_networks-schema.sql.zst\n** Message: 15:58:04.359: Creating table `installer`.`m_switches` from content in /root/work/20220726/installer.m_switches-schema.sql.zst\n** Message: 15:58:04.360: Creating table `installer`.`t_processing_segments` from content in /root/work/20220726/installer.t_processing_segments-schema.sql.zst\n** Message: 15:58:04.414: Thread 2 restoring `installer`.`t_networks` part 0 of 1 from installer.t_networks.00000.sql.zst. Progress 1 of 4.\n** Message: 15:58:04.414: Thread 4 restoring `installer`.`t_processing_segments` part 0 of 1 from installer.t_processing_segments.00000.sql.zst. Progress 2 of 4.\n** Message: 15:58:04.414: Thread 3 restoring `installer`.`m_switches` part 0 of 1 from installer.m_switches.00000.sql.zst. Progress 3 of 4.\n** Message: 15:58:04.414: Thread 1 restoring `installer`.`migrations` part 0 of 1 from installer.migrations.00000.sql.zst. Progress 4 of 4.\n** Message: 15:58:04.430: Import timings:\n** Message: 15:58:04.430: Data          | Index         | Total         | Table\n** Message: 15:58:04.430: 0 00:00:00    | 0 00:00:00    | 0 00:00:00    | `installer`.`migrations`\n** Message: 15:58:04.430: 0 00:00:00    | 0 00:00:00    | 0 00:00:00    | `installer`.`t_processing_segments`\n** Message: 15:58:04.430: 0 00:00:00    | 0 00:00:00    | 0 00:00:00    | `installer`.`m_switches`\n** Message: 15:58:04.430: 0 00:00:00    | 0 00:00:00    | 0 00:00:00    | `installer`.`t_networks`\n** Message: 15:58:04.431: Starting table checksum verification\n[root@ work]#\n</code></pre> </li> <li> myloader \u8fd8\u539f\u5e38\u7528\u8bed\u53e5 <pre><code>\u8fd8\u539f\u6574\u4e2a\u5b9e\u4f8b\n\u5907\u4efd\u6574\u4e2a\u5b9e\u4f8b\uff0c\u5305\u62ec\u89e6\u53d1\u5668\uff0c\u4e8b\u4ef6\uff0c\u51fd\u6570\u548c\u5b58\u50a8\u8fc7\u7a0b\n\n\u8fd8\u539f\u6574\u4e2a\u5b9e\u4f8b\nmyloader -u root -p root -S /tmp/mysql3307.sock -d /backup/mysql/bak/\n\nmysql_upgrade \u5347\u7ea7 slave \u540e\u8fd8\u539f\u5907\u4efd\nmaster\n\nmydumper -u root -p root -S /tmp/mysql3306.sock -G -R -E -o /backup/mysql/bak\nslave\n\n\u5148\u5347\u7ea7 mysql,\u5426\u5219\u4f1a\u62a5 mysql.event, mysql.proc \u8fd9\u4e9b\u8868\u4e0d\u5b58\u5728\u7684\u9519\u8bef\n\nmysql_upgrade -u root -p root -S /tmp/mysql3307.sock -P 3307\n\u8fd8\u539f 3306 \u5b9e\u4f8b\u4e0a\u5907\u4efd\u7684\u6570\u636e\u5230 3307 \u5b9e\u4f8b\u4e0a, 3307 \u5b9e\u4f8b\u662f\u521d\u59cb\u5316\u7684\uff0c\u6ca1\u6709\u6570\u636e\u5199\u5165\u7684\u5b9e\u4f8b\n\nmyloader -u root -p root -S /tmp/mysql3307.sock -d /backup/mysql/bak\n\u6ce8\u610f\u4e8b\u9879\nslave \u4e0a\u7684 GTID \u4fe1\u606f\u9700\u8981\u6839\u636e metadata \u6587\u4ef6\u8fdb\u884c\u624b\u52a8\u66f4\u65b0\uff0cmyloader \u5e76\u6ca1\u6709\u81ea\u52a8\u66f4\u65b0 GTID \u4fe1\u606f\n\nslave\nreset master;\nset global gtid_purged = 'xxx';\n\u8fd8\u539f\u5355\u5e93\n\u4ece\u5907\u4efd\u7684\u5355\u4e2a\u5e93\u6587\u4ef6\u4e2d\u8fd8\u539f\u5355\u5e93\n\nmyloader -u root -p root -h 192.168.2.249 -P 3307 -B zst -d /backup/mysql/bak/\n\u4ece\u5907\u4efd\u7684\u771f\u4e2a\u5b9e\u4f8b\u6587\u4ef6\u4e2d\u8fd8\u539f\u5355\u5e93\n\nmyloader -u root -p root -h 192.168.2.249 -P 3307 -B zst -s zst -d /backup/mysql/bak/\n\u8fd8\u539f\u591a\u4e2a\u5e93\n\n\u5907\u4efd\u591a\u4e2a\u5e93\nmydumper -u root -p root -h 192.168.2.249 -P 3306 --regex 'zst|db3' -o /backup/mysql/bak\n\n\u8fd8\u539f\u591a\u4e2a\u5e93\nmyloader -u root -p root -h 192.168.2.249 -P 3307 -d /backup/mysql/bak/\n\u5bfc\u5165\u5355\u5e93\u591a\u8868\n\n\u5907\u4efd\u5355\u5e93\u591a\u8868\nmydumper -u root -p root -h 192.168.2.249 -P 3306 -B zst -T sbtest1,sbtest2 -o /backup/mysql/bak\n\n\u8fd8\u539f\u5355\u5e93\u591a\u8868\nmyloader -u root -p root -h 192.168.2.249 -P 3307 -d /backup/mysql/bak/\n\n\u5f53\u5907\u4efd\u662f\u5b9e\u4f8b\u7ea7\u522b\u7684\u5907\u4efd\u65f6\uff0c\u53ef\u4ee5\u5c06\u9700\u8981\u7684\u8868\u7684\u6587\u4ef6\u653e\u5230\u53e6\u4e00\u4e2a\u76ee\u5f55\u4e2d\uff0c\u8fd8\u539f\u65f6\u6307\u5b9a\u8be5\u76ee\u5f55\u5373\u53ef\n\n\u591a\u5e93\u5bfc\u5165\u5355\u5e93\uff08\u5408\u670d\uff09\n\n\u5907\u4efd\u591a\u4e2a\u5e93\nmydumper -u root -p root -h 192.168.2.249 -P 3306 --regex 'zst|db3' -o /backup/mysql/bak\n\n\u8fd8\u539f\u591a\u4e2a\u5e93\u5230\u4e00\u4e2a\u5e93\nmyloader -u root -p root -h 192.168.2.249 -P 3307 -B zst -d /backup/mysql/bak/\n</code></pre> </li> </ul> </li> <li> <p>\u304a\u5ba2\u3055\u3093\u304b\u3089dump\u30d5\u30a1\u30a4\u30eb\u63d0\u4f9b\u4f9d\u983c\u306e\u5fa9\u65e7\u4f5c\u696d</p> <ul> <li>\u76f4\u63a5\u30b5\u30fc\u30d3\u30b9\u30b5\u30fc\u30d0\u4e0a\u306eDB dump\u62bd\u51fa\u306f\u3057\u306a\u3044\u3002</li> <li>\u5bfe\u8c61\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u8a66\u9a13\u6a5f\u306b\u8ee2\u9001\u3057\u3001\u8a66\u9a13\u6a5f\u4e0a\u3067\u4f5c\u696d\u3059\u308b\u3002 <pre><code>1. \u5bfe\u8c61\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30d5\u30a1\u30a4\u30eb\u3092\u8a66\u9a13\u6a5f\u306b\u8ee2\u9001\u3059\u308b\u3002\n[root@mysql57 backup]# scp -r mysqlxxx:/home/backup/mysqlxxx-dump_2022xxxx.tar ./\n2. \u5bfe\u8c61\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30d5\u30a1\u30a4\u30eb\u3092\u89e3\u51cd\u3059\u308b\u3002\n[root@mysql57 backup]# tar xvf mysqlxxx-dump_2022xxxx.tar\n3. \u5bfe\u8c61DB\u3060\u3051\u3092\u8a66\u9a13\u6a5f\u306bimport\n[root@mysql57 backup]# myloader --directory=2022xxxx  --threads=8 --verbose=3  -B \u5bfe\u8c61DB\u540d -s \u5bfe\u8c61DB\u540d -o -e\n4. \u5bfe\u8c61DB\u3092SQL\u5f62\u5f0f\u306e\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066dump\u3059\u308b\u3002\n[root@mysql57 backup]# mysqldump --opt --databases  \u5bfe\u8c61DB\u540d --hex-blob --quote-names --force --max_allowed_packet=128M --events --single-transaction --default-character-set=binary &gt; \u5bfe\u8c61DB\u540d.sql\n5. dump\u3057\u305fSQL\u30d5\u30a1\u30a4\u30eb\u3092\uff57\uff57\uff57\u30b5\u30fc\u30d3\u30b9\u30b5\u30fc\u30d0\u306b\u8ee2\u9001\u3059\u308b\u3002\n[root@mysql57 ~]# scp \u5bfe\u8c61DB\u540d.sql admin@server:/home/admin/\n</code></pre></li> </ul> </li> </ol>"},{"location":"mydumper/#db","title":"\u5168DB\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u304b\u3089\u5fa9\u65e7\u3059\u308b\u5834\u5408","text":"\u5168DB\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u304b\u3089\u5fa9\u65e7\u3059\u308b\u5834\u5408 <pre><code># \u5bfe\u8c61\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u89e3\u51cd\n[root]# tar xf mysqlxxx.sakura.ne.jp-dump_20220826.tar -C ./\n# mysqld\u3092\u505c\u6b62\n[root]# systemctl stop mysqld\n# mysql\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30ea\u30cd\u30fc\u30e0\n[root]# mv -v /home/mysql /home/mysql_2022xxxx\n# mysql\u3092\u521d\u671f\u5316\u3059\u308b\n[root]# mysqld --initialize-insecure --user=mysql\n# \u78ba\u8a8d\u3059\u308b\u3002\n[root]# ls -lah /home/mysql/\n# mysqld\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root]# systemctl start mysqld\n# \u30a8\u30e9\u30fc\u30ed\u30b0\u3092\u78ba\u8a8d\n[root]# less /var/log/mysql/error.log\n# \u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30c7\u30fc\u30bf\u304b\u3089\u5168\u30c7\u30fc\u30bf\u3092\u30ea\u30b9\u30c8\u30a2\u3059\u308b\u3002\n[root]# myloader --verbose=3 --directory=/home/backup/2022xxxx  -o --user=root --password='' &gt;&amp; restore.log\n# \u30ea\u30b9\u30c8\u30a2\u3067\u304d\u306a\u3044DB\u3092\u78ba\u8a8d\n[root]# grep Error  /home/restore.log\n## \u3053\u3061\u3089\u306futf8m4\u306b\u624b\u52d5\u3067mysqldump\u3067\u5bfe\u5fdc\u5fc5\u8981\u3067\u3059\u3002\n** (myloader:11159): CRITICAL **: 16:36:58.629: Error occours between lines: 4 and 5 on file aaa.xxx.00000.sql.zst: Cannot create a JSON value from a string with CHARACTER SET 'binary'.\n** (myloader:11159): CRITICAL **: 16:36:58.813: Error occours between lines: 4 and 6 on file aaa.yyy.00000.sql.zst: Cannot create a JSON value from a string with CHARACTER SET 'binary'.\n** (myloader:11159): CRITICAL **: 16:36:58.896: Error occours between lines: 4 and 6 on file aaa.zzz.00000.sql.zst: Cannot create a JSON value from a string with CHARACTER SET 'binary'.\n## mysqld\u518d\u8d77\u52d5\u3057\u3066\u306a\u3044\u305f\u3081\u3001definer\u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u3002\n** (myloader:11159): CRITICAL **: 16:38:08.916: Error occours between lines: 10 and 10 on file aaa.xxx-view_test_001-schema-view.sql.zst: The user specified as a definer ('root'@'127.0.0.1') does not exist\n** (myloader:11159): CRITICAL **: 16:38:08.928: Error occours between lines: 10 and 21 on file aaa.yyy-schema-view.sql.zst: The user specified as a definer ('test'@'%') does not exist\n** (myloader:11159): CRITICAL **: 16:38:08.937: Error occours between lines: 10 and 13 on file aaa.zzz-schema-view.sql.zst: The user specified as a definer ('test'@'%') does not exist\n\n# mysqld\u3092\u518d\u8d77\u52d5\n[root]# systemctl restart mysqld\n# \u30ea\u30b9\u30c8\u30a2\u3067\u304d\u306a\u3044DB\u3092\u5358\u72ec\u5bfe\u5fdc\u3059\u308b\n[root@]# myloader --verbose=2 --directory=/home/backup/2022xxxx  -o -B test_db_mig_sf_in_view -s test_db_mig_sf_in_view\n[root@]# myloader --verbose=2 --directory=/home/backup/2022xxxx  -o -B test_57_2 -s test_57_2\n</code></pre>"},{"location":"mydumper/#mysqldump","title":"mysqldump\u306e\u4f7f\u3044\u65b9","text":"<ul> <li> <p>Export: <pre><code>mysqldump -u root -p --all-databases &gt; alldb.sql\n</code></pre></p> </li> <li> <p>Look up the documentation for mysqldump. You may want to use some of the options mentioned in comments: <pre><code>mysqldump -u root -p --opt --all-databases &gt; alldb.sql\nmysqldump -u root -p --all-databases --skip-lock-tables &gt; alldb.sql\n</code></pre></p> </li> <li> <p>\u4f8b: <pre><code># local\nmysqldump \\\n--single-transaction \\\n--hex-blob \\\n--quote-names \\\n--events \\\n--force \\\n--max_allowed_packet=128M \\\n--default-character-set=binary \\\n--all-databases &gt; alldatabases.dump\n\n# remote\n mysqldump -h mysql_server -uroot -ppassword --single-transaction --hex-blob --quote-names --events --force --max_allowed_packet=128M --default-character-set=binary --all-databases &gt; alldatabases.dump\n</code></pre></p> </li> <li> <p>Import: <pre><code>mysql -u root -p &lt; alldb.sql\n</code></pre></p> </li> </ul>"},{"location":"mysql-add-del-user/","title":"mysql\u30e6\u30fc\u30b6\u4f5c\u6210\u524a\u9664","text":""},{"location":"mysql-add-del-user/#mysql8","title":"MySQL8\u306e\u5834\u5408","text":"<ul> <li>https://mebee.info/2019/09/28/post-1518/</li> <li>https://www7390uo.sakura.ne.jp/wordpress/archives/456</li> <li>https://dev.mysql.com/doc/refman/8.0/en/grant.html#grant-overview</li> <li>https://qiita.com/egnr-in-6matroom/items/e77dfc719ed3dfbe0027</li> </ul>"},{"location":"mysql-add-del-user/#_1","title":"\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210","text":"<ol> <li>MySQL5.7\u307e\u3067\u306e\u72b6\u6cc1     <pre><code>GRANT \u6a29\u9650 ON \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d.\u30c6\u30fc\u30d6\u30eb\u540d TO \u2018\u30e6\u30fc\u30b6\u30fc\u540d\u2019 IDENTIFIED BY \u2018\u30d1\u30b9\u30ef\u30fc\u30c9\u2019;\n</code></pre></li> <li>MySQL8.0\u304b\u3089\u3053\u3046\u5909\u308f\u3063\u305f     <pre><code>CREATE USER \u2018\u30e6\u30fc\u30b6\u30fc\u540d\u2019 IDENTIFIED BY \u2018\u30d1\u30b9\u30ef\u30fc\u30c9\u2019;\u3067\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\nGRANT \u6a29\u9650 ON \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d.\u30c6\u30fc\u30d6\u30eb\u540d TO \u2018\u30e6\u30fc\u30b6\u30fc\u540d\u2019;\u3067\u6a29\u9650\u3092\u4ed8\u4e0e\n</code></pre></li> </ol>"},{"location":"mysql-add-del-user/#_2","title":"\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\u4f8b","text":"<ul> <li> <p>MySQL8\u4ee5\u4e0a\u306e\u5834\u5408</p> <ul> <li> MySQL8\u4ee5\u4e0a\u306e\u5834\u5408 <pre><code>-- MySQL8\u4ee5\u4e0a\u306e\u5834\u5408\n-- DB\u4f5c\u6210\n&gt; CREATE DATABASE sbtest;\n-- \u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\n&gt; CREATE USER 'sbtest'@'localhost' IDENTIFIED BY 'sbtest';\n-- \u30e6\u30fc\u30b6\u30fc\u306b\u5168\u6a29\u9650\u8ffd\u52a0\n&gt; GRANT ALL PRIVILEGES ON `sbtest`.* TO 'sbtest'@'localhost';\n-- \u6a29\u9650\u306e\u5909\u66f4\u3092\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u53cd\u6620\n&gt; FLUSH PRIVILEGES;\n-- \u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\u3092\u4e0b\u8a18\u306b\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\n-- https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_authentication_policy\n-- \u30c7\u30d5\u30a9\u30eb\u30c8\u306f \"*,,\"\n-- authentication_policy = 'mysql_native_password,,'  \u306b\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\n-- \u30c7\u30d5\u30a9\u30eb\u30c8\n&gt; show variables like 'auth%';\n+-----------------------+-------------------------+\n| Variable_name         | Value                   |\n+-----------------------+-------------------------+\n| authentication_policy | *,,                     |\n+-----------------------+-------------------------+\n1 row in set (0.01 sec)\n-- \u5909\u66f4\u5f8c\n&gt; show variables like 'auth%';\n+-----------------------+-------------------------+\n| Variable_name         | Value                   |\n+-----------------------+-------------------------+\n| authentication_policy | mysql_native_password,, |\n+-----------------------+-------------------------+\n1 row in set (0.01 sec)\n-- DB\u3068\u30e6\u30fc\u30b6\u524a\u9664\u6642\n&gt; DROP DATABASE IF EXISTS `mydb`;\n&gt; select db,user FROM mysql.db WHERE user = 'myuser' ;\n&gt; DELETE FROM mysql.db WHERE user = 'myuser';\n&gt; DELETE FROM mysql.user WHERE user = 'myuser';\n-- \u524a\u9664\u5f8c\u3082\u3046\u4e00\u5ea6\u78ba\u8a8d\n&gt; select db,user FROM mysql.db WHERE user = 'myuser' ;\n&gt; select user,host FROM mysql.user WHERE user = 'myuser' ;\n</code></pre> </li> </ul> </li> <li> <p>MySQL8\u4ee5\u4e0b\u306e\u5834\u5408</p> <ul> <li> MySQL8\u4ee5\u4e0b\u306e\u5834\u5408 <pre><code>-- MySQL8\u4ee5\u4e0b\u306e\u5834\u5408\n-- DB\u4f5c\u6210\nmysql&gt; CREATE DATABASE sbtest;\nQuery OK, 1 row affected (0.00 sec)\n-- \u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\nmysql&gt; CREATE USER sbtest;\nQuery OK, 0 rows affected (0.00 sec)\n-- \u30e6\u30fc\u30b6\u30fc\u306b\u5168\u6a29\u9650\u8ffd\u52a0\nmysql&gt;  GRANT ALL PRIVILEGES ON `sbtest`.* TO 'sbtest'@'localhost' IDENTIFIED BY 'sbtest';\nQuery OK, 0 rows affected (0.00 sec)\n-- \u6a29\u9650\u306e\u5909\u66f4\u3092\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u53cd\u6620\nmysql&gt; FLUSH PRIVILEGES;\nQuery OK, 0 rows affected (0.00 sec)\n# DB\u3068\u30e6\u30fc\u30b6\u524a\u9664\u6642\n&gt; DROP DATABASE IF EXISTS `mydb`;\n&gt; select db,user FROM mysql.db WHERE user = 'myuser' ;\n&gt; DELETE FROM mysql.db WHERE user = 'myuser';\n&gt; DELETE FROM mysql.user WHERE user = 'myuser';\n-- \u524a\u9664\u5f8c\u3082\u3046\u4e00\u5ea6\u78ba\u8a8d\n&gt; select db,user FROM mysql.db WHERE user = 'myuser' ;\n&gt; select user,host FROM mysql.user WHERE user = 'myuser' ;\n</code></pre> </li> </ul> </li> <li> <p>\u78ba\u8a8d</p> <ul> <li> \u78ba\u8a8d <pre><code>-- \u78ba\u8a8d\n&gt; show databases;\n&gt; select user,host,authentication_string from mysql.user;\n</code></pre> </li> </ul> </li> </ul> MySQL8\u3067DB\u30e6\u30fc\u30b6\u4f5c\u6210\u4f8b <pre><code>-- MySQL8 \u4f8b\n02:03:56 root@localhost[(none)]&gt; CREATE DATABASE `test_mysql8`;\nQuery OK, 1 row affected (0.00 sec)\n02:03:58 root@localhost[(none)]&gt; CREATE USER 'test'@'%' IDENTIFIED BY 'password';\nQuery OK, 0 rows affected (0.02 sec)\n02:04:08 root@localhost[(none)]&gt; GRANT ALL PRIVILEGES ON `test_mysql8`.* TO 'test'@'%';\nQuery OK, 0 rows affected (0.00 sec)\n02:04:48 root@localhost[(none)]&gt; FLUSH PRIVILEGES;\nQuery OK, 0 rows affected (0.00 sec)\n02:04:51 root@localhost[(none)]&gt;\n# \u78ba\u8a8d\n02:04:51 root@localhost[(none)]&gt; select user,host from mysql.user;\n+------------------+-----------+\n| user             | host      |\n+------------------+-----------+\n| test             | %         |\n| root             | %         |\n| root             | 127.0.0.1 |\n| root             | ::1       |\n| mysql.infoschema | localhost |\n| mysql.session    | localhost |\n| mysql.sys        | localhost |\n| root             | localhost |\n+------------------+-----------+\n11 rows in set (0.00 sec)\n02:06:28 root@localhost[(none)]&gt; select user,host from mysql.db;\n+---------------+-----------+\n| user          | host      |\n+---------------+-----------+\n| test          | %         |\n| mysql.session | localhost |\n| mysql.sys     | localhost |\n+---------------+-----------+\n3 rows in set (0.00 sec)\n02:06:32 root@localhost[(none)]&gt;\n</code></pre>"},{"location":"mysql-add-del-user/#authentication_policy","title":"authentication_policy","text":""},{"location":"mysql-add-del-user/#authentication_policy_1","title":"authentication_policy\u306e\u6307\u5b9a\u304c\u306a\u3051\u308c\u3070\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u306b\u306a\u308a\u307e\u3059\u3002","text":"authentication_policy\u3092\u6307\u5b9a\u306a\u3057 <pre><code># authentication_policy\u306e\u6307\u5b9a\u304c\u306a\u3051\u308c\u3070\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u306b\u306a\u308a\u307e\u3059\u3002\nCREATE DATABASE `mydb`;\nCREATE USER 'myuser'@'%' identified BY 'password';\nGRANT ALL PRIVILEGES ON mydb.* TO 'myuser'@'%';\nFLUSH PRIVILEGES;\nselect user,host,plugin from mysql.user where user = 'myuser';\n</code></pre>"},{"location":"mysql-add-del-user/#authentication_policy_2","title":"authentication_policy\u3092\u6307\u5b9a\u3057\u3066\u30e6\u30fc\u30b6\u306e\u4f5c\u6210\u3082\u53ef\u80fd\u3067\u3059\u3002","text":"authentication_policy\u3092\u6307\u5b9a <pre><code># authentication_policy\u3092\u6307\u5b9a\u3057\u3066\u30e6\u30fc\u30b6\u306e\u4f5c\u6210\u3082\u53ef\u80fd\u3067\u3059\u3002\nCREATE DATABASE `mydb`;\nCREATE USER 'myuser'@'%' identified with caching_sha2_password BY 'password';\nGRANT ALL PRIVILEGES ON mydb.* TO 'myuser'@'%';\nFLUSH PRIVILEGES;\nselect user,host,plugin from mysql.user where user = 'myuser';\n</code></pre>"},{"location":"mysql-add-del-user/#_3","title":"\u6a29\u9650\u4ed8\u4e0e\u3001\u6a29\u9650\u53d6\u308a\u6d88\u3057","text":"<p>\u4e00\u90e8\u6a29\u9650\u3057\u304b\u6301\u305f\u306a\u3044\u30e6\u30fc\u30b6(admin)\u306e\u4f5c\u6210</p> admin <pre><code>CREATE USER `admin`@`%` IDENTIFIED BY 'xxx';\nGRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, RELOAD, PROCESS, FILE, REFERENCES, INDEX, ALTER, SHOW DATABASES, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER, CREATE TABLESPACE, CREATE ROLE, DROP ROLE ON *.* TO `admin`@`%` WITH GRANT OPTION\n</code></pre> <ul> <li> <p>\u30d5\u30eb(root)\u6a29\u9650\u306e\u5834\u5408</p> <pre><code>&gt; show grants for `root`@`%`;\n+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Grants for root@%                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, RELOAD, SHUTDOWN, PROCESS, FILE, REFERENCES, INDEX, ALTER, SHOW DATABASES, SUPER, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER, CREATE TABLESPACE, CREATE ROLE, DROP ROLE ON *.* TO `root`@`%` WITH GRANT OPTION                                                                                                                                                                                                                                                                                                                                                                 |\n| GRANT APPLICATION_PASSWORD_ADMIN,AUDIT_ABORT_EXEMPT,AUDIT_ADMIN,AUTHENTICATION_POLICY_ADMIN,BACKUP_ADMIN,BINLOG_ADMIN,BINLOG_ENCRYPTION_ADMIN,CLONE_ADMIN,CONNECTION_ADMIN,ENCRYPTION_KEY_ADMIN,FIREWALL_EXEMPT,FLUSH_OPTIMIZER_COSTS,FLUSH_STATUS,FLUSH_TABLES,FLUSH_USER_RESOURCES,GROUP_REPLICATION_ADMIN,GROUP_REPLICATION_STREAM,INNODB_REDO_LOG_ARCHIVE,INNODB_REDO_LOG_ENABLE,PASSWORDLESS_USER_ADMIN,PERSIST_RO_VARIABLES_ADMIN,REPLICATION_APPLIER,REPLICATION_SLAVE_ADMIN,RESOURCE_GROUP_ADMIN,RESOURCE_GROUP_USER,ROLE_ADMIN,SENSITIVE_VARIABLES_OBSERVER,SERVICE_CONNECTION_ADMIN,SESSION_VARIABLES_ADMIN,SET_USER_ID,SHOW_ROUTINE,SYSTEM_USER,SYSTEM_VARIABLES_ADMIN,TABLE_ENCRYPTION_ADMIN,XA_RECOVER_ADMIN ON *.* TO `root`@`%` WITH GRANT OPTION |\n+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n2 rows in set (0.00 sec)\n</code></pre> </li> <li> <p>\u4e00\u90e8\u306e\u6a29\u9650\u3057\u304b\u4ed8\u4e0e\u3057\u306a\u3044\u5834\u5408</p> <pre><code>&gt; CREATE USER `admin`@`%` IDENTIFIED BY 'xxx';\n&gt; GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, RELOAD, PROCESS, FILE, REFERENCES, INDEX, ALTER, SHOW DATABASES, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER, CREATE TABLESPACE, CREATE ROLE, DROP ROLE ON *.* TO `admin`@`%` WITH GRANT OPTION\n&gt; show grants for `admin`@`%`;\n+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Grants for admin@%                                                                                                                                                                                                                                                                                                                        |\n+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, RELOAD, PROCESS, FILE, REFERENCES, INDEX, ALTER, SHOW DATABASES, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER, CREATE TABLESPACE, CREATE ROLE, DROP ROLE ON *.* TO `admin`@`%` WITH GRANT OPTION |\n+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n1 row in set (0.00 sec)\n</code></pre> </li> <li> <p>\u5dee\u5206</p> <pre><code>- GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, RELOAD, SHUTDOWN, PROCESS, FILE, REFERENCES, INDEX, ALTER, SHOW DATABASES, SUPER, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER, CREATE TABLESPACE, CREATE ROLE, DROP ROLE ON *.* TO `admin`@`%` WITH GRANT OPTION\n+ GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, RELOAD, PROCESS, FILE, REFERENCES, INDEX, ALTER, SHOW DATABASES, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER, CREATE TABLESPACE, CREATE ROLE, DROP ROLE ON *.* TO `admin`@`%` WITH GRANT OPTION\n</code></pre> </li> <li> <p>\u53d6\u308a\u5916\u3057\u305f\u6a29\u9650</p> <ul> <li>https://dev.mysql.com/doc/refman/8.0/ja/privileges-provided.html</li> <li>SHUTDOWN</li> <li>SUPER</li> <li>REPLICATION SLAVE</li> <li>REPLICATION CLIENT</li> </ul> </li> </ul>"},{"location":"mysql-add-del-user/#mysql8_1","title":"MySQL8\u3067\u30e6\u30fc\u30b6\u30fc\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u5909\u66f4 / \u30ea\u30bb\u30c3\u30c8\u65b9\u6cd5","text":"<pre><code>mysql &gt; USE mysql;\nmysql &gt; ALTER USER 'root'@'localhost' identified BY 'hoge';\nQuery OK, 1 row affected (0.04 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n</code></pre>"},{"location":"mysql-add-del-user/#root","title":"root \u30e6\u30fc\u30b6\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u5fd8\u308c\u3066\u3001\u30ed\u30b0\u30a4\u30f3\u51fa\u6765\u306a\u3044\u3068\u304d","text":"<pre><code>// \u4e00\u5ea6\u7d42\u4e86\n$ mysql.server stop\n// \u30bb\u30fc\u30d5\u30e2\u30fc\u30c9\u3067\u306e\u8d77\u52d5\u3001\n$ mysqld_safe --skip-grant-tables &amp;\n// \u30d1\u30b9\u30ef\u30fc\u30c9\u306a\u3057\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\n$ mysql -u root\n// root \u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u7a7a\u306b\u3059\u308b\nmysql &gt; UPDATE mysql.user SET authentication_string=null WHERE User='root';\nmysql &gt; exit;\n// MySQL\u518d\u8d77\u52d5\uff08\u975e\u30bb\u30fc\u30d5\u30e2\u30fc\u30c9\uff09\n$ mysql.server restart\n// \u7a7a\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3067\u30ed\u30b0\u30a4\u30f3\n$ mysql -u root -p // mysql &gt; USE mysql;\nmysql &gt; ALTER USER 'root'@'localhost' identified BY 'hoge';\nQuery OK, 1 row affected (0.04 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n</code></pre>"},{"location":"mysql-clone/","title":"MySQL 8.0 : \u30af\u30ed\u30fc\u30f3\u6a5f\u80fd\u3092\u5229\u7528\u3059\u308b","text":""},{"location":"mysql-clone/#rootlocalhost","title":"\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f <code>'root'@'localhost'</code> \u306e\u6a29\u9650\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3067\u3059\u3002","text":"<pre><code>05:26:02 root@localhost[(none)]&gt; show grants;\n+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Grants for root@localhost                         |\n+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, RELOAD, SHUTDOWN, PROCESS, FILE, REFERENCES, INDEX, ALTER, SHOW DATABASES, SUPER, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER, CREATE TABLESPACE, CREATE ROLE, DROP ROLE ON *.* TO `root`@`localhost` WITH GRANT OPTION |\n| GRANT PROXY ON ``@`` TO `root`@`localhost` WITH GRANT OPTION                                                                                                                                                                                                                                                                                                                                             |\n+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n</code></pre>"},{"location":"mysql-clone/#rootlocalhost-root","title":"<code>'root'@'localhost'</code> \u306b\u3082<code>'root'@'%'</code> \u3068\u540c\u3058\u6a29\u9650\u306b\u8a2d\u5b9a\u3059\u308b\u305f\u3081\u3001\u6a29\u9650\u3092\u4ed8\u4e0e\u3059\u308b","text":"<pre><code>12:43:18 root@localhost[(none)]&gt; grant all on *.* to 'root'@'localhost';\n05:29:34 root@localhost[(none)]&gt; show grants;\n+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Grants for root@localhost                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, RELOAD, SHUTDOWN, PROCESS, FILE, REFERENCES, INDEX, ALTER, SHOW DATABASES, SUPER, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER, CREATE TABLESPACE, CREATE ROLE, DROP ROLE ON *.* TO `root`@`localhost` WITH GRANT OPTION                                                                                                                                                                                                                                                                                                                                                                   |\n| GRANT APPLICATION_PASSWORD_ADMIN,AUDIT_ABORT_EXEMPT,AUDIT_ADMIN,AUTHENTICATION_POLICY_ADMIN,BACKUP_ADMIN,BINLOG_ADMIN,BINLOG_ENCRYPTION_ADMIN,CLONE_ADMIN,CONNECTION_ADMIN,ENCRYPTION_KEY_ADMIN,FIREWALL_EXEMPT,FLUSH_OPTIMIZER_COSTS,FLUSH_STATUS,FLUSH_TABLES,FLUSH_USER_RESOURCES,GROUP_REPLICATION_ADMIN,GROUP_REPLICATION_STREAM,INNODB_REDO_LOG_ARCHIVE,INNODB_REDO_LOG_ENABLE,PASSWORDLESS_USER_ADMIN,PERSIST_RO_VARIABLES_ADMIN,REPLICATION_APPLIER,REPLICATION_SLAVE_ADMIN,RESOURCE_GROUP_ADMIN,RESOURCE_GROUP_USER,ROLE_ADMIN,SENSITIVE_VARIABLES_OBSERVER,SERVICE_CONNECTION_ADMIN,SESSION_VARIABLES_ADMIN,SET_USER_ID,SHOW_ROUTINE,SYSTEM_USER,SYSTEM_VARIABLES_ADMIN,TABLE_ENCRYPTION_ADMIN,TELEMETRY_LOG_ADMIN,XA_RECOVER_ADMIN ON *.* TO `root`@`localhost` |\n| GRANT PROXY ON ``@`` TO `root`@`localhost` WITH GRANT OPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n3 rows in set (0.00 sec)\n05:31:40 root@localhost[(none)]&gt;\n</code></pre>"},{"location":"mysql-dummy/","title":"\u30c0\u30df\u30fc\u30c7\u30fc\u30bf\u3092\u4f5c\u6210","text":"<ul> <li> <p>https://blog.csdn.net/qq_43271844/article/details/122185774</p> </li> <li> <p>\u521b\u5efa\u6570\u636e\u8868(innodb)</p> <ul> <li> Create table <pre><code>\u5b57\u6bb5\u7c7b\u578b\uff1a\nid \uff1a\u7f16\u53f7\nuname\uff1a\u7528\u6237\u540d\nucreatetime: \u521b\u5efa\u65f6\u95f4\nage\uff1a\u5e74\u9f84\ncreate table usertb (\nid serial,\nuname varchar(20),\nucreatetime datetime,\nage int(11)\n)\nengine=innodb\ndefault character set=utf8mb4 COLLATE=utf8mb4_unicode_ci\nauto_increment=1\nrow_format=compact;\n</code></pre> </li> </ul> </li> <li> <p>\u521b\u5efa\u63d2\u5165\u6570\u636e\u5b58\u50a8\u8fc7\u7a0b</p> <ul> <li> Create PROCEDURE <pre><code>-- \u5b58\u50a8\u8fc7\u7a0b\u78ba\u8a8d\nmysql&gt; select * from information_schema.ROUTINES\\G\n-- \u5b58\u50a8\u8fc7\u7a0b\u524a\u9664\nmysql&gt; DROP PROCEDURE dev_test_s10_proc;\n-- \u4f8b1\ndelimiter $$\nset autocommit = 0$$\ncreate PROCEDURE rsmove_test()\nbegin\ndeclare v_cnt decimal(10) default 0;\ndd:loop\ninsert into usertb values\n(null, '\u30e6\u30fc\u30b61','2022-11-20 00:00:00', 20),\n(null, '\u30e6\u30fc\u30b62','2022-11-20 00:00:00', 20),\n(null, '\u30e6\u30fc\u30b63','2022-11-20 00:00:00', 20),\n(null, '\u30e6\u30fc\u30b64','2022-11-20 00:00:00', 20),\n(null, '\u30e6\u30fc\u30b65','2022-11-20 00:00:00', 20),\n(null, '\u30e6\u30fc\u30b66','2022-11-22 00:00:00', 20),\n(null, '\u30e6\u30fc\u30b67','2022-11-22 00:00:00', 20),\n(null, '\u30e6\u30fc\u30b68','2022-11-22 00:00:00', 20),\n(null, '\u30e6\u30fc\u30b69','2022-11-22 00:00:00', 20),\n(null, '\u30e6\u30fc\u30b60','2022-11-22 00:00:00', 20);\ncommit;\nset v_cnt = v_cnt+10;\nif v_cnt = 10000000 then leave dd;\nend if;\nend loop dd;\nend;$$\ndelimiter ;\n-- \u4f8b2\ndelimiter $$\nset autocommit = 0$$\ncreate PROCEDURE dev_test_s10_proc()\nbegin\ndeclare v_cnt decimal(10) default 0;\ndd:loop\ninsert into `dev-test-s10_mysql55test`.usertb values\n(null, 'user1','2022-11-20 00:00:00', 20),\n(null, 'user2','2022-11-20 00:00:00', 20),\n(null, 'user3','2022-11-20 00:00:00', 20),\n(null, 'user4','2022-11-20 00:00:00', 20),\n(null, 'user5','2022-11-20 00:00:00', 20),\n(null, 'user6','2022-11-22 00:00:00', 20),\n(null, 'user7','2022-11-22 00:00:00', 20),\n(null, 'user8','2022-11-22 00:00:00', 20),\n(null, 'user9','2022-11-22 00:00:00', 20),\n(null, 'user0','2022-11-22 00:00:00', 20);\ncommit;\nset v_cnt = v_cnt+10;\nif v_cnt = 10000000 then leave dd;\nend if;\nend loop dd;\nend;$$\ndelimiter ;\n</code></pre> </li> </ul> </li> <li> <p>\u6267\u884c\u5b58\u50a8\u8fc7\u7a0b</p> <ul> <li> CALL <pre><code># call rsmove_test;\n04:32:13 root@localhost[rsmoving-test_fuga]&gt; call rsmove_test;\nQuery OK, 0 rows affected (1 min 16.67 sec)\n# call dev_test_s10_proc;\n</code></pre> </li> </ul> </li> </ul>"},{"location":"mysql-group-replication-how-to-elect-the-new-primary-node/","title":"MGR \u5982\u4f55\u9009\u4e3e\u65b0\u7684\u4e3b\u8282\u70b9","text":"<ul> <li>https://www.percona.com/blog/mysql-group-replication-how-to-elect-the-new-primary-node/</li> </ul> <p>\u5728\u8fd9\u7bc7\u535a\u5ba2\u4e2d\uff0c\u6211\u5c06\u89e3\u91ca\u5728 MySQL \u7ec4\u590d\u5236\u4e2d\u9009\u62e9 PRIMARY \u8282\u70b9\u7684\u4e0d\u540c\u65b9\u5f0f\u3002\u5728 MySQL 8.0.2 \u4e4b\u524d\uff0cprimary \u9009\u4e3e\u662f\u57fa\u4e8e\u6210\u5458\u7684 UUID\uff0c\u5728\u53d1\u751f\u6545\u969c\u8f6c\u79fb\u65f6\uff0c\u6700\u4f4e\u7684 UUID \u88ab\u9009\u4e3a\u65b0\u7684 primary\u3002</p> <ul> <li>\u4eceMySQL 8.0.2\u5f00\u59cb\uff1a\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u670d\u52a1\u5668\u6743\u91cd (<code>group_replication_member_weight</code>) \u9009\u62e9\u8981\u63d0\u5347\u4e3a <code>PRIMARY</code> \u7684\u8282\u70b9\u3002\u8fd9\u53ef\u4ee5\u5728\u5f53\u524d\u4e3b\u8282\u70b9\u53d1\u751f\u6545\u969c\u671f\u95f4\u5b9e\u73b0\u3002  </li> <li>\u4eceMySQL 8.0.12\u5f00\u59cb\uff1a\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u51fd\u6570 <code>group_replication_set_as_primary</code> \u5c06\u4efb\u4f55\u8282\u70b9\u63d0\u5347\u4e3a <code>PRIMARY</code>\u3002\u8fd9\u53ef\u4ee5\u5728\u6ca1\u6709\u4efb\u4f55\u8282\u70b9\u6545\u969c\u7684\u60c5\u51b5\u4e0b\u968f\u65f6\u8bbe\u7f6e\u3002</li> </ul>"},{"location":"mysql-group-replication-how-to-elect-the-new-primary-node/#_1","title":"\u8bbe\u60f3\uff1a","text":"<p>\u6211\u5df2\u7ecf\u5b89\u88c5\u4e86 3 \u8282\u70b9\u7ec4\u590d\u5236\u96c6\u7fa4\u3002\u6211\u6b63\u5728\u4f7f\u7528<code>Percona Server for MySQL 8.0.22</code>\u3002</p> \u786e\u8ba4 <pre><code>mysql&gt; select member_host,member_state,member_role,member_version from performance_schema.replication_group_members;\n+---------------+--------------+-------------+----------------+\n| member_host   | member_state | member_role | member_version |\n+---------------+--------------+-------------+----------------+\n| 172.28.128.15 | ONLINE       | SECONDARY   | 8.0.22         |\n| 172.28.128.14 | ONLINE       | PRIMARY     | 8.0.22         |\n| 172.28.128.13 | ONLINE       | SECONDARY   | 8.0.22         |\n+---------------+--------------+-------------+----------------+\n3 rows in set (0.03 sec)\n</code></pre> <p>\u6211\u8ba1\u5212\u5c06\u5f53\u524d\u7684\u4e3b\u8282\u70b9\u201c172.28.128.14\u201d\u7528\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u4fee\u8865\u7684\u7ef4\u62a4\u3002\u5f53\u6211\u5173\u95ed\u5f53\u524d\u7684 PRIMARY \u8282\u70b9\u65f6\uff0c\u6211\u9700\u8981\u5c06\u670d\u52a1\u5668\u201c172.28.128.15\u201d\u63d0\u5347\u4e3a PRIMARY \u6210\u5458\u3002\u8ba9\u6211\u4eec\u770b\u770b\u5982\u4f55\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5b9e\u73b0\u8fd9\u4e00\u70b9\u3002</p> <ul> <li>\u4f7f\u7528\u670d\u52a1\u5668\u6743\u91cd <code>group_replication_member_weight</code></li> <li>\u4f7f\u7528\u51fd\u6570 <code>group_replication_set_as_primary</code></li> </ul>"},{"location":"mysql-group-replication-how-to-elect-the-new-primary-node/#group_replication_member_weight","title":"\u4f7f\u7528\u670d\u52a1\u5668\u6743\u91cd <code>group_replication_member_weight</code>\uff1a","text":"<ul> <li>https://dev.mysql.com/doc/refman/8.0/en/group-replication-options.html#sysvar_group_replication_member_weight</li> <li>https://docs.oracle.com/cd/E17952_01/mysql-8.0-ja/group-replication-options.html#sysvar_group_replication_member_weight</li> </ul> group_replication_member_weight Command-Line Format <code>--group-replication-member-weight=#</code> System Variable <code>group_replication_member_weight</code> Scope Global Dynamic Yes SET_VAR Hint Applies No Type Integer Default Value 50 Minimum Value 0 Maximum Value 100 Unit percentage <p>\u3053\u306e\u30b7\u30b9\u30c6\u30e0\u5909\u6570\u306e\u5024\u306f\u3001Group Replication \u306e\u5b9f\u884c\u4e2d\u306b\u5909\u66f4\u3067\u304d\u3001\u5909\u66f4\u306f\u305f\u3060\u3061\u306b\u6709\u52b9\u306b\u306a\u308a\u307e\u3059\u3002 \u30b7\u30b9\u30c6\u30e0\u5909\u6570\u306e\u73fe\u5728\u306e\u5024\u306f\u3001\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u72b6\u6cc1\u304c\u767a\u751f\u3057\u305f\u3068\u304d\u306b\u8aad\u307f\u53d6\u3089\u308c\u307e\u3059\u3002</p> <p>group_replication_member_weight \u3067\u306f\u3001\u65e2\u5b58\u306e\u30d7\u30e9\u30a4\u30de\u30ea\u304c\u5358\u4e00\u30d7\u30e9\u30a4\u30de\u30ea\u30b0\u30eb\u30fc\u30d7\u304b\u3089\u96e2\u308c\u308b\u5834\u5408\u306a\u3069\u3001\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u6642\u306b\u30d7\u30e9\u30a4\u30de\u30ea\u3068\u3057\u3066\u9078\u629e\u3055\u308c\u308b\u30e1\u30f3\u30d0\u30fc\u306e\u53ef\u80fd\u6027\u306b\u5f71\u97ff\u3092\u4e0e\u3048\u308b\u305f\u3081\u306b\u30e1\u30f3\u30d0\u30fc\u306b\u5272\u308a\u5f53\u3066\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u91cd\u307f\u306e\u5272\u5408\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002 \u30d7\u30e9\u30a4\u30de\u30ea\u306e\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3055\u308c\u305f\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u4e2d\u3084\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u6642\u306b\u7279\u5b9a\u306e\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u304c\u512a\u5148\u3055\u308c\u308b\u3088\u3046\u306b\u3001\u30e1\u30f3\u30d0\u30fc\u306b\u6570\u5024\u306e\u91cd\u307f\u3092\u5272\u308a\u5f53\u3066\u3066\u7279\u5b9a\u306e\u30e1\u30f3\u30d0\u30fc\u304c\u9078\u629e\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002</p> <p>\u30e1\u30f3\u30d0\u30fc\u304c\u6b21\u306e\u3088\u3046\u306b\u69cb\u6210\u3055\u308c\u3066\u3044\u308b\u30b0\u30eb\u30fc\u30d7\u306e\u5834\u5408:</p> <ul> <li>member-1: group_replication_member_weight=30, server_uuid=aaaa</li> <li>member-2: group_replication_member_weight=40, server_uuid=bbbb</li> <li>member-3: group_replication_member_weight=40, server_uuid=cccc</li> <li>member-4: group_replication_member_weight=40, server_uuid=dddd</li> </ul> <p>\u65b0\u3057\u3044\u30d7\u30e9\u30a4\u30de\u30ea\u306e\u9078\u629e\u6642\u306b\u3001\u524d\u8ff0\u306e\u30e1\u30f3\u30d0\u30fc\u306f member-2, member-3, member-4 \u304a\u3088\u3073 member-1 \u3068\u3057\u3066\u30bd\u30fc\u30c8\u3055\u308c\u307e\u3059\u3002 \u3053\u308c\u306b\u3088\u308a\u3001\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u6642\u306b\u65b0\u3057\u3044\u30d7\u30e9\u30a4\u30de\u30ea\u3068\u3057\u3066 member-2 \u304c\u9078\u629e\u3055\u308c\u307e\u3059\u3002 \u8a73\u7d30\u306f\u3001\u30bb\u30af\u30b7\u30e7\u30f318.1.3.1\u300c\u30b7\u30f3\u30b0\u30eb\u30d7\u30e9\u30a4\u30de\u30ea\u30e2\u30fc\u30c9\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p> <p>\u8fd9\u79cd\u65b9\u6cd5\u5e76\u4e0d\u7b80\u5355\u3002\u5f53\u5f53\u524d\u4e3b\u8981\u6210\u5458\u5173\u95ed\u65f6\uff0c\u65b0\u8282\u70b9\u5c06\u88ab\u63d0\u5347\u4e3a\u4e3b\u8981\u6210\u5458\u3002\u76ee\u524d\uff0c\u6211\u5728\u6240\u6709\u8282\u70b9\u4e0a\u7684\u6743\u91cd\u90fd\u76f8\u540c\u3002</p> <pre><code>[root@innodb1 ~]# mysql -e \"select @@hostname, @@group_replication_member_weight\\G\"\n*************************** 1. row ***************************\n@@hostname: 172.28.128.13\n@@group_replication_member_weight: 50\n[root@innodb2 ~]#  mysql -e \"select @@hostname, @@group_replication_member_weight\\G\"\n*************************** 1. row ***************************\n@@hostname: 172.28.128.14\n@@group_replication_member_weight: 50\n[root@innodb3 ~]# mysql -e \"select @@hostname, @@group_replication_member_weight\\G\"\n*************************** 1. row ***************************\n@@hostname: 172.28.128.15\n@@group_replication_member_weight: 50\n</code></pre> <p>\u589e\u52a0\u670d\u52a1\u5668\u201c172.28.128.15\u201d\u7684\u6743\u91cd\uff0c\u4ee5\u4fbf\u5728\u53d6\u6d88\u201c172.28.128.14\u201d\u65f6\u5c06\u5176\u9009\u4e3a\u4e3b\u8981\u6210\u5458\u3002</p> <ul> <li><code>group_replication_member_weight</code> \u306e\u5909\u66f4\u306f\u4e0b\u8a182\u3064\u65b9\u6cd5\u3042\u308a\u307e\u3059<ol> <li><code>my.cnf</code> \u306b <code>group_replication_member_weight = 70</code>\u3092\u8ffd\u8a18<ul> <li>Primary\u3092\u9078\u629e\u3059\u308b\u969b\u306ePrioriy\u3002\u5404\u30b5\u30fc\u30d0\u30fc\u3067\u8a2d\u5b9a\u3059\u308b\u3002</li> </ul> </li> <li><code>set global group_replication_member_weight = 70;</code></li> </ol> </li> </ul> <p>\u5728<code>172.28.128.15</code> \u4e0a\u901a\u8fc7mysql\u4ea4\u4e92\u754c\u9762\u8bbe\u7f6e</p> <pre><code>mysql&gt; set global group_replication_member_weight = 70;\nQuery OK, 0 rows affected (0.00 sec)\nmysql&gt; select @@group_replication_member_weight;\n+-----------------------------------+\n| @@group_replication_member_weight |\n+-----------------------------------+\n|                                70 |\n+-----------------------------------+\n1 row in set (0.00 sec)\nor mysql&gt; show variables where variable_name like '%group_replication_member_weight%';\n+---------------------------------+-------+\n| Variable_name                   | Value |\n+---------------------------------+-------+\n| group_replication_member_weight | 70    |\n+---------------------------------+-------+\n1 row in set (0.01 sec)\n</code></pre> Warning <p>\u6ce8\u610f\uff1a\u8981\u8bbe\u7f6e\u6743\u91cd\uff0c\u4e0d\u9700\u8981\u6267\u884c STOP/START GROUP_REPLICATION\u3002</p> \u5728<code>my.cnf</code> \u4e0a\u7684\u8bbe\u7f6e\u65b9\u6cd5 <pre><code>[root@node1 work]# grep 'group_replication_member_weight' /etc/my.cnf\ngroup_replication_member_weight=90 #\u6743\u91cd90,\u4f18\u5148\u8bbe\u7f6e\u6b64node1\u4e3a\u4e3b\u670d\u52a1\u5668\n[root@node1 work]#\n[root@node2 work]# grep 'group_replication_member_weight' /etc/my.cnf\ngroup_replication_member_weight=0 #\u6743\u91cd0,\u51e0\u4e4e\u4e0d\u4f1a\u8bbe\u7f6e\u6b64node2\u4e3a\u4e3b\u670d\u52a1\u5668\n[root@node2 work]#\n[root@node3 work]# grep 'group_replication_member_weight' /etc/my.cnf\ngroup_replication_member_weight=90 #\u6743\u91cd90,\u4f18\u5148\u8bbe\u7f6e\u6b64node3\u4e3a\u4e3b\u670d\u52a1\u5668\n[root@node3 work]#\n[root@node1 work]# mysql -e \"select @@hostname, @@group_replication_member_weight\\G\"\n*************************** 1. row ***************************\n                       @@hostname: node1\n@@group_replication_member_weight: 90\n[root@node2 work]# mysql -e \"select @@hostname, @@group_replication_member_weight\\G\"\n*************************** 1. row ***************************\n                       @@hostname: node2\n@@group_replication_member_weight: 0\n[root@node3 work]# mysql -e \"select @@hostname, @@group_replication_member_weight\\G\"\n*************************** 1. row ***************************\n                       @@hostname: node3\n@@group_replication_member_weight: 90\n</code></pre> <p>\u670d\u52a1\u5668\u201c172.28.128.15\u201d\u4e0a\u7684\u6743\u91cd\u589e\u52a0\u5230 70\u3002\u73b0\u5728\uff0c\u6211\u8981\u5173\u95ed\u5f53\u524d\u7684\u4e3b\u8282\u70b9\u201c172.28.128.14\u201d\u3002</p> <p>\u5728\u201c172.28.128.14\u201d\uff0c</p> <pre><code>mysql&gt; stop group_replication;\nQuery OK, 0 rows affected (4.29 sec)\nmysql&gt; select member_host,member_state,member_role,member_version from performance_schema.replication_group_members;\n+---------------+--------------+-------------+----------------+\n| member_host   | member_state | member_role | member_version |\n+---------------+--------------+-------------+----------------+\n| 172.28.128.14 | OFFLINE      |             |                |\n+---------------+--------------+-------------+----------------+\n1 row in set (0.01 sec)\n</code></pre> <p>\u8be5\u8282\u70b9\u5df2\u79bb\u5f00\u96c6\u7fa4\u3002</p> <p>\u5728\u201c172.28.128.15\u201d\uff0c</p> <pre><code>mysql&gt; select member_host,member_state,member_role,member_version from performance_schema.replication_group_members;\n+---------------+--------------+-------------+----------------+\n| member_host   | member_state | member_role | member_version |\n+---------------+--------------+-------------+----------------+\n| 172.28.128.15 | ONLINE       | PRIMARY     | 8.0.22         |\n| 172.28.128.13 | ONLINE       | SECONDARY   | 8.0.22         |\n+---------------+--------------+-------------+----------------+\n2 rows in set (0.04 sec)\n</code></pre> <p>\u60a8\u53ef\u4ee5\u770b\u5230\u201c172.28.128.15\u201d\u88ab\u9009\u4e3a\u65b0\u7684 PRIMARY \u8282\u70b9\u3002</p>"},{"location":"mysql-group-replication-how-to-elect-the-new-primary-node/#_2","title":"\u6210\u5458\u5728\u9009\u4e3e\u521d\u9009\u65f6\u8003\u8651\u7684\u56e0\u7d20\u4f9d\u6b21\u5982\u4e0b\uff1a","text":"<ul> <li>\u8003\u8651\u7684\u7b2c\u4e00\u4e2a\u56e0\u7d20\u662f\u54ea\u4e2a\u6216\u54ea\u4e9b\u6210\u5458\u6b63\u5728\u8fd0\u884c\u6700\u4f4e\u7684 MySQL \u670d\u52a1\u5668\u7248\u672c\u3002\u5982\u679c\u6240\u6709\u7ec4\u6210\u5458\u90fd\u8fd0\u884c MySQL 8.0.17 \u6216\u66f4\u9ad8\u7248\u672c\uff0c\u5219\u6210\u5458\u9996\u5148\u6309\u5176\u53d1\u5e03\u7684\u8865\u4e01\u7248\u672c\u6392\u5e8f\u3002\u5982\u679c\u4efb\u4f55\u6210\u5458\u6b63\u5728\u8fd0\u884c MySQL Server 5.7 \u6216 MySQL 8.0.16 \u6216\u66f4\u4f4e\u7248\u672c\uff0c\u5219\u6210\u5458\u9996\u5148\u6309\u5176\u53d1\u5e03\u7684\u4e3b\u8981\u7248\u672c\u6392\u5e8f\uff0c\u8865\u4e01\u7248\u672c\u5c06\u88ab\u5ffd\u7565\u3002</li> <li>\u5982\u679c\u591a\u4e2a\u6210\u5458\u6b63\u5728\u8fd0\u884c\u6700\u4f4e\u7684 MySQL \u670d\u52a1\u5668\u7248\u672c\uff0c\u5219\u8003\u8651\u7684\u7b2c\u4e8c\u4e2a\u56e0\u7d20\u662f\u6bcf\u4e2a\u6210\u5458\u7684\u6210\u5458\u6743\u91cd\uff0c\u7531 group_replication_member_weight \u6210\u5458\u7684\u7cfb\u7edf\u53d8\u91cf\u6307\u5b9a\u3002\u5982\u679c\u8be5\u7ec4\u7684\u4efb\u4f55\u6210\u5458\u6b63\u5728\u8fd0\u884c MySQL Server 5.7\uff0c\u800c\u8be5\u7cfb\u7edf\u53d8\u91cf\u4e0d\u53ef\u7528\uff0c\u5219\u5ffd\u7565\u8be5\u56e0\u7d20\u3002</li> <li>\u7cfb\u7edf group_replication_member_weight \u53d8\u91cf\u6307\u5b9a 0-100 \u8303\u56f4\u5185\u7684\u6570\u5b57\u3002\u6240\u6709\u6210\u5458\u7684\u9ed8\u8ba4\u6743\u91cd\u5747\u4e3a 50\uff0c\u56e0\u6b64\u5c06\u6743\u91cd\u8bbe\u7f6e\u4e3a\u4f4e\u4e8e\u6b64\u503c\u4ee5\u964d\u4f4e\u5176\u6392\u5e8f\uff0c\u5c06\u6743\u91cd\u8bbe\u7f6e\u4e3a\u9ad8\u4e8e\u6b64\u503c\u4ee5\u589e\u52a0\u5176\u6392\u5e8f\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u6b64\u52a0\u6743\u51fd\u6570\u6765\u4f18\u5148\u4f7f\u7528\u66f4\u597d\u7684\u786c\u4ef6\uff0c\u6216\u786e\u4fdd\u5728\u4e3b\u8981\u7684\u8ba1\u5212\u7ef4\u62a4\u671f\u95f4\u6545\u969c\u8f6c\u79fb\u5230\u7279\u5b9a\u6210\u5458\u3002</li> </ul> <p>\u5982\u679c\u4e0d\u6b62\u4e00\u4e2a\u6210\u5458\u6b63\u5728\u8fd0\u884c\u6700\u4f4e\u7684 MySQL \u670d\u52a1\u5668\u7248\u672c\uff0c\u5e76\u4e14\u5176\u4e2d\u4e0d\u6b62\u4e00\u4e2a\u6210\u5458\u5177\u6709\u6700\u9ad8\u7684\u6210\u5458\u6743\u91cd\uff08\u6216\u8005\u6210\u5458\u6743\u91cd\u88ab\u5ffd\u7565\uff09\uff0c\u5219\u8003\u8651\u7684\u7b2c\u4e09\u4e2a\u56e0\u7d20\u662f\u6bcf\u4e2a\u6210\u5458\u751f\u6210\u7684\u670d\u52a1\u5668 UUID \u7684\u8bcd\u6cd5\u987a\u5e8f\uff0c\u7531\u7cfb\u7edf\u53d8\u91cf\u6307\u5b9a server_uuid\u3002\u5177\u6709\u6700\u4f4e\u670d\u52a1\u5668 UUID \u7684\u6210\u5458\u88ab\u9009\u4e3a\u4e3b\u8981\u6210\u5458\u3002\u8be5\u56e0\u7d20\u5145\u5f53\u6709\u4fdd\u8bc1\u548c\u53ef\u9884\u6d4b\u7684\u51b3\u80dc\u5c40\uff0c\u4ee5\u4fbf\u6240\u6709\u5c0f\u7ec4\u6210\u5458\u5728\u65e0\u6cd5\u7531\u4efb\u4f55\u91cd\u8981\u56e0\u7d20\u51b3\u5b9a\u7684\u60c5\u51b5\u4e0b\u505a\u51fa\u76f8\u540c\u7684\u51b3\u5b9a\u3002</p>"},{"location":"mysql-group-replication-how-to-elect-the-new-primary-node/#group_replication_set_as_primary","title":"\u4f7f\u7528\u51fd\u6570 <code>group_replication_set_as_primary</code>\uff1a","text":"<p>\u8fd9\u79cd\u65b9\u6cd5\u975e\u5e38\u7b80\u5355\uff0c\u4e0d\u9700\u8981\u8ba9\u5f53\u524d\u7684PRIMARY\u8282\u70b9\u5931\u6548\u6765\u5207\u6362\u4e3b\u6210\u5458\u3002</p> <pre><code>+---------------+--------------+-------------+----------------+\n| member_host \u00a0 | member_state | member_role | member_version |\n+---------------+--------------+-------------+----------------+\n| 172.28.128.15 | ONLINE \u00a0 \u00a0 \u00a0 | SECONDARY \u00a0 | 8.0.22 \u00a0 \u00a0 \u00a0 \u00a0 |\n| 172.28.128.14 | ONLINE \u00a0 \u00a0 \u00a0 | PRIMARY \u00a0 \u00a0 | 8.0.22 \u00a0 \u00a0 \u00a0 \u00a0 |\n| 172.28.128.13 | ONLINE \u00a0 \u00a0 \u00a0 | SECONDARY \u00a0 | 8.0.22 \u00a0 \u00a0 \u00a0 \u00a0 |\n+---------------+--------------+-------------+----------------+\n3 rows in set (0.00 sec)\n</code></pre> <p>\u73b0\u5728\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528\u6210\u5458 UUID \u6267\u884c\u51fd\u6570 <code>group_replication_set_as_primary</code>. \u5728 <code>172.28.128.15</code></p> <pre><code>mysql&gt; show global variables like 'server_uu%';\n+---------------+--------------------------------------+\n| Variable_name | Value\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 |\n+---------------+--------------------------------------+\n| server_uuid \u00a0 | c5aed435-d58d-11ea-bb26-5254004d77d3 |\n+---------------+--------------------------------------+\n1 row in set (0.00 sec)\nmysql&gt; select group_replication_set_as_primary('c5aed435-d58d-11ea-bb26-5254004d77d3');\n+--------------------------------------------------------------------------+\n| group_replication_set_as_primary('c5aed435-d58d-11ea-bb26-5254004d77d3') |\n+--------------------------------------------------------------------------+\n| Primary server switched to: c5aed435-d58d-11ea-bb26-5254004d77d3 \u00a0 \u00a0 \u00a0 \u00a0 |\n+--------------------------------------------------------------------------+\n1 row in set (1.03 sec)\nmysql&gt; select member_host,member_state,member_role,member_version from performance_schema.replication_group_members;\n+---------------+--------------+-------------+----------------+\n| member_host \u00a0 | member_state | member_role | member_version |\n+---------------+--------------+-------------+----------------+\n| 172.28.128.15 | ONLINE \u00a0 \u00a0 \u00a0 | PRIMARY \u00a0 \u00a0 | 8.0.22 \u00a0 \u00a0 \u00a0 \u00a0 |\n| 172.28.128.14 | ONLINE \u00a0 \u00a0 \u00a0 | SECONDARY \u00a0 | 8.0.22 \u00a0 \u00a0 \u00a0 \u00a0 |\n| 172.28.128.13 | ONLINE \u00a0 \u00a0 \u00a0 | SECONDARY \u00a0 | 8.0.22 \u00a0 \u00a0 \u00a0 \u00a0 |\n+---------------+--------------+-------------+----------------+\n3 rows in set (0.00 sec)\n</code></pre> <p><code>172.28.128.15</code>\u88ab\u9009\u4e3a<code>PRIMARY</code>\u8282\u70b9\u3002</p> log <ul> <li>node1<ul> <li>\u628a<code>node1</code>\u4ece<code>SECONDARY</code>\u5347\u4e3a<code>PRIMARY</code></li> </ul> </li> </ul> <pre><code>-- node1\n10:36:27 root@localhost[(none)]&gt; show variables where variable_name like '%group_replication_member_weight%';\n+---------------------------------+-------+\n| Variable_name                   | Value |\n+---------------------------------+-------+\n| group_replication_member_weight | 50    |\n+---------------------------------+-------+\n1 row in set (0.01 sec)\n10:36:40 root@localhost[(none)]&gt; SELECT MEMBER_ID,MEMBER_HOST,MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+--------------------------------------+-------------+--------------+-------------+\n| MEMBER_ID                            | MEMBER_HOST | MEMBER_STATE | MEMBER_ROLE |\n+--------------------------------------+-------------+--------------+-------------+\n| 74ba497e-f2f1-11ed-9e8e-5254007b60ca | node2       | ONLINE       | PRIMARY     |\n| d7239f8c-f2f1-11ed-aeeb-525400c72882 | node3       | ONLINE       | SECONDARY   |\n| defba275-f2ef-11ed-9eae-525400e752a2 | node1       | ONLINE       | SECONDARY   |\n+--------------------------------------+-------------+--------------+-------------+\n3 rows in set (0.00 sec)\n10:36:44 root@localhost[(none)]&gt; show global variables like 'server_uu%';\n+---------------+--------------------------------------+\n| Variable_name | Value                                |\n+---------------+--------------------------------------+\n| server_uuid   | defba275-f2ef-11ed-9eae-525400e752a2 |\n+---------------+--------------------------------------+\n1 row in set (0.00 sec)\n10:37:11 root@localhost[(none)]&gt; select group_replication_set_as_primary('defba275-f2ef-11ed-9eae-525400e752a2');\n+--------------------------------------------------------------------------+\n| group_replication_set_as_primary('defba275-f2ef-11ed-9eae-525400e752a2') |\n+--------------------------------------------------------------------------+\n| Primary server switched to: defba275-f2ef-11ed-9eae-525400e752a2         |\n+--------------------------------------------------------------------------+\n1 row in set (0.01 sec)\n10:37:41 root@localhost[(none)]&gt; SELECT MEMBER_ID,MEMBER_HOST,MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+--------------------------------------+-------------+--------------+-------------+\n| MEMBER_ID                            | MEMBER_HOST | MEMBER_STATE | MEMBER_ROLE |\n+--------------------------------------+-------------+--------------+-------------+\n| 74ba497e-f2f1-11ed-9e8e-5254007b60ca | node2       | ONLINE       | SECONDARY   |\n| d7239f8c-f2f1-11ed-aeeb-525400c72882 | node3       | ONLINE       | SECONDARY   |\n| defba275-f2ef-11ed-9eae-525400e752a2 | node1       | ONLINE       | PRIMARY     |\n+--------------------------------------+-------------+--------------+-------------+\n3 rows in set (0.00 sec)\n-- node1\u5347\u7ea7\u65f6\u7684log\n2023-05-19T10:37:41.872162+09:00 63 [System] [MY-013214] [Repl] Plugin group_replication reported: 'Starting group operation local execution: Primary election change'\n2023-05-19T10:37:41.873896+09:00 0 [Note] [MY-013519] [Repl] Plugin group_replication reported: 'Elected primary member gtid_executed: aaaaaaaa-1111-2222-3333-bbbbbbbbbbbb:1-907785:1000006-1118353'\n2023-05-19T10:37:41.873973+09:00 0 [Note] [MY-013519] [Repl] Plugin group_replication reported: 'Elected primary member applier channel received_transaction_set: aaaaaaaa-1111-2222-3333-bbbbbbbbbbbb:1-907785:1000006-1118353'\n2023-05-19T10:37:41.873999+09:00 0 [System] [MY-011507] [Repl] Plugin group_replication reported: 'A new primary with address node1:3306 was elected. The new primary will execute all previous group transactions before allowing writes. Enabling conflict detection until the new primary applies all relay logs.'\n2023-05-19T10:37:41.875034+09:00 64 [System] [MY-011565] [Repl] Plugin group_replication reported: 'Setting super_read_only=ON.'\n2023-05-19T10:37:41.876097+09:00 21 [System] [MY-013731] [Repl] Plugin group_replication reported: 'The member action \"mysql_disable_super_read_only_if_primary\" for event \"AFTER_PRIMARY_ELECTION\" with priority \"1\" will be run.'\n2023-05-19T10:37:41.876140+09:00 21 [System] [MY-011566] [Repl] Plugin group_replication reported: 'Setting super_read_only=OFF.'\n2023-05-19T10:37:41.876294+09:00 21 [System] [MY-013731] [Repl] Plugin group_replication reported: 'The member action \"mysql_start_failover_channels_if_primary\" for event \"AFTER_PRIMARY_ELECTION\" with priority \"10\" will be run.'\n2023-05-19T10:37:41.877063+09:00 64 [System] [MY-011510] [Repl] Plugin group_replication reported: 'This server is working as primary member.'\n2023-05-19T10:37:41.877104+09:00 63 [Note] [MY-013215] [Repl] Plugin group_replication reported: 'Termination of group operation local execution: Primary election change'\n2023-05-19T10:37:41.877082+09:00 13 [Note] [MY-011485] [Repl] Plugin group_replication reported: 'Primary had applied all relay logs, disabled conflict detection.'\n2023-05-19T10:37:41.878392+09:00 0 [System] [MY-013213] [Repl] Plugin group_replication reported: 'Configuration operation 'Primary election change' terminated. Primary server switched to: defba275-f2ef-11ed-9eae-525400e752a2'\n</code></pre> <ul> <li>node2<ul> <li><code>node1</code>\u4ece<code>SECONDARY</code>\u5347\u4e3a<code>PRIMARY</code>\u65f6, <code>node2</code> \u53d1\u751f\u7684log</li> </ul> </li> </ul> <pre><code>2023-05-19T10:45:02.819394+09:00 270 [System] [MY-013214] [Repl] Plugin group_replication reported: 'Starting group operation local execution: Primary election change'\n2023-05-19T10:45:02.820900+09:00 0 [System] [MY-011507] [Repl] Plugin group_replication reported: 'A new primary with address node1:3306 was elected. The new primary will execute all previous group transactions before allowing writes. Enabling conflict detection until the new primary applies all relay logs.'\n2023-05-19T10:45:02.822187+09:00 271 [System] [MY-011565] [Repl] Plugin group_replication reported: 'Setting super_read_only=ON.'\n2023-05-19T10:45:02.824233+09:00 271 [System] [MY-011511] [Repl] Plugin group_replication reported: 'This server is working as secondary member with primary member address node1:3306.'\n2023-05-19T10:45:02.824277+09:00 270 [Note] [MY-013215] [Repl] Plugin group_replication reported: 'Termination of group operation local execution: Primary election change'\n2023-05-19T10:45:02.824285+09:00 11 [Note] [MY-011485] [Repl] Plugin group_replication reported: 'Primary had applied all relay logs, disabled conflict detection.'\n2023-05-19T10:45:02.825496+09:00 0 [System] [MY-013213] [Repl] Plugin group_replication reported: 'Configuration operation 'Primary election change' terminated. Primary server switched to: defba275-f2ef-11ed-9eae-525400e752a2'\n</code></pre> <p>\u6ce8\u610f\uff1a\u60a8\u53ef\u4ee5\u5728\u96c6\u7fa4\u7684\u4efb\u4f55\u670d\u52a1\u5668\u4e0a\u6267\u884c\u51fd\u6570<code>group_replication_set_as_primary_node</code>\u3002 \u8fd9\u79cd\u65b9\u6cd5\u975e\u5e38\u6709\u7528\uff0c\u5982\u679c\u60a8\u60f3\u5c06<code>PRIMARY</code>\u6210\u5458\u5207\u6362\u5230\u9ad8\u5ea6\u914d\u7f6e\u7684\u670d\u52a1\u5668\u6216\u4efb\u4f55\u5176\u4ed6\u539f\u56e0\uff0c\u5b83\u5c06\u975e\u5e38\u6709\u5e2e\u52a9\u3002</p>"},{"location":"mysql-group-replication/","title":"mysql-group-replication","text":""},{"location":"mysql-group-replication/#mysql3","title":"mysql\u306e\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u65b9\u5f0f\u306f\u4ee5\u4e0b\u306e3\u7a2e\u985e\u9032\u5316\u3057\u3066\u304d\u305f\u3002","text":"<ul> <li>MySQL \u975e\u540c\u671f\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3</li> <li>MySQL \u6e96\u540c\u671f\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3</li> <li>MySQL \u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 \u2190 \u73fe\u5728</li> </ul>"},{"location":"mysql-group-replication/#_1","title":"\u516c\u5f0f\u30b5\u30a4\u30c8","text":"<ul> <li>https://dev.mysql.com/doc/refman/8.0/ja/group-replication-primary-secondary-replication.html</li> </ul>"},{"location":"mysql-group-replication/#3mgr","title":"3\u7a2e\u985e\u306eMGR","text":"<ol> <li> <p>\u975e\u540c\u671f\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\uff08Asynchronous Replication\u3001\u5f02\u6b65\u590d\u5236\uff09</p> <ul> <li>\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30b5\u30fc\u30d0\u30fc\u306e\u6545\u969c\u6642\u306b\u3001\u904e\u53bb\u306b\u6210\u529f\u3057\u305f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c\u6d88\u5931\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002</li> <li>\u4f20\u7edfMySQL\u590d\u5236\u9ed8\u8ba4\u63d0\u4f9b\u4e86\u4e00\u79cd\u7b80\u5355\u7684\u4e3b\u4ece\u590d\u5236\u65b9\u6cd5\uff0c\u8fd9\u79cd\u67b6\u6784\u6709\u4e00\u4e2a\u4e3b\uff0c\u4ee5\u53ca\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u4ece\uff0c\u5f53\u4e3b\u8282\u70b9\u6267\u884c\u63d0\u4ea4\u4e8b\u52a1\uff0c\u7136\u540e\u5f02\u6b65\u7684\u65b9\u5f0f\u53d1\u9001\u5230\u5176\u4ed6\u4ece\u8282\u70b9\uff0c\u4ece\u5e93\u91cd\u65b0\u6267\u884crelay log\u65e5\u5fd7\u5185\u5bb9\u8fbe\u5230\u4e3b\u526f\u672c\u4e00\u81f4\u7684\u76ee\u7684\uff0c\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u96c6\u7fa4\u6240\u6709\u8282\u70b9\u6570\u636e\u90fd\u662f\u4e00\u81f4\u7684\u3002</li> <li></li> </ul> </li> <li> <p>\u6e96\u540c\u671f\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\uff08Semisynchronous Replication\u3001\u534a\u540c\u6b65\u590d\u5236\uff09</p> <ul> <li>Semi-synchronous Replication \u3067\u306f\u9069\u5207\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u4e00\u53f0\u306e\u30b5\u30fc\u30d0\u30fc\u304c\u6545\u969c\u3057\u3066\u3082\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c\u6d88\u5931\u3057\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 \u4e00\u65b9\u3067\u3001\u6545\u969c\u30b5\u30fc\u30d0\u30fc\u304c\u5fa9\u5e30\u3059\u308b\u3068 errant transaction \u3068\u3044\u3046\u4e0d\u6574\u5408\u30c7\u30fc\u30bf\u304c\u767a\u751f\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002</li> <li>\u5f02\u6b65\u590d\u5236\u5b58\u5728\u4e00\u5b9a\u7684\u6570\u636e\u4e22\u5931\u98ce\u9669\uff0cMySQL\u53c8\u57285.6\u7248\u672c\u4e2d\u63a8\u51fa\u534a\u540c\u6b65\u590d\u5236\uff0c\u5728\u540c\u6b65\u6570\u636e\u534f\u8bae\u4e2d\u6dfb\u52a0\u4e86\u4e00\u4e2a\u540c\u6b65\u64cd\u4f5c\uff0c\u8fd9\u6837\u610f\u5473\u4e3b\u8282\u70b9\u5728commit\u64cd\u4f5c\uff0c\u9700\u8981\u786e\u8ba4\u6700\u5c11\u4e00\u4e2a\u4ece\u8282\u70b9\u786e\u8ba4\u63a5\u6536\u5230\u5e76\u4e14\u8fd4\u56deACK\uff0c\u53ea\u6709\u8fd9\u6837\u4e3b\u8282\u70b9\u624d\u80fd\u6b63\u786e\u63d0\u4ea4\u6570\u636e\u3002</li> <li></li> </ul> </li> <li> <p>MySQL \u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\uff08Group Replication Protocol\uff09</p> <ul> <li>Group Replication \u306f Paxos \u3092\u30d9\u30fc\u30b9\u306b\u3057\u305f\u5206\u6563\u5408\u610f\u65b9\u5f0f\u306b\u3088\u308a errant transaction \u306e\u767a\u751f\u3092\u9632\u6b62\u3057\u307e\u3059\u3002</li> <li>MySQL MGR \u96c6\u7fa4\u6700\u5c113\u4e2aserver\u8282\u70b9\u5171\u540c\u7ec4\u6210\u7684\u5206\u5e03\u5f0f\u96c6\u7fa4\uff0c\u4e00\u79cdshare-nothing\u590d\u5236\u65b9\u6848\uff0c\u6bcf\u4e2aserver\u8282\u70b9\u90fd\u6709\u5b8c\u6574\u7684\u526f\u672c\u3002 MGR\u7531\u82e5\u5e72\u4e2a\u8282\u70b9\u5171\u540c\u7ec4\u6210\u4e00\u4e2a\u590d\u5236\u7ec4\uff0c\u4e00\u4e2a\u4e8b\u52a1\u7684\u63d0\u4ea4\uff0c\u5fc5\u987b\u7ecf\u8fc7\u7ec4\u5185\u5927\u591a\u6570\u8282\u70b9\uff08N / 2 + 1\uff09\u51b3\u8bae\u5e76\u901a\u8fc7\uff0c\u624d\u80fd\u5f97\u4ee5\u63d0\u4ea4\u3002\u7ec4\u590d\u5236\u7684\u5f15\u5165\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u89e3\u51b3\u4f20\u7edf\u5f02\u6b65\u590d\u5236\u548c\u534a\u540c\u6b65\u590d\u5236\u53ef\u80fd\u4ea7\u751f\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002\u7ec4\u590d\u5236\u4f9d\u9760\u5206\u5e03\u5f0f\u4e00\u81f4\u6027\u534f\u8bae(Paxos\u534f\u8bae\u7684\u53d8\u4f53)\uff0c\u5b9e\u73b0\u4e86\u5206\u5e03\u5f0f\u4e0b\u6570\u636e\u7684\u6700\u7ec8\u4e00\u81f4\u6027\uff0c\u63d0\u4f9b\u4e86\u771f\u6b63\u7684\u6570\u636e\u9ad8\u53ef\u7528\u65b9\u6848\u3002</li> <li></li> <li> <p>f \u969c\u5bb3\u3092\u8a31\u5bb9\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306a\u30b5\u30fc\u30d0\u30fc\u306e\u6570 (n) \u306f\u3001n = 2 x f + 1 \u3067\u3059\u3002</p> \u30b0\u30eb\u30fc\u30d7\u30b5\u30a4\u30ba(node\u6570) \u904e\u534a\u6570(Majority) \u8a31\u5bb9\u3055\u308c\u308b\u5373\u6642\u969c\u5bb3(Instant Failures Tolerated) 7 4 3 6 4 2 5 3 2 4 3 1 3 2 1 2 2 0 1 1 0 </li> </ul> </li> </ol>"},{"location":"mysql-group-replication/#_2","title":"\u30b7\u30f3\u30b0\u30eb\u30d7\u30e9\u30a4\u30de\u30ea\u30e2\u30fc\u30c9","text":"<ul> <li>\u65b0\u898f\u30d7\u30e9\u30a4\u30de\u30ea\u9078\u629e<ul> <li></li> </ul> </li> <li>\u30d7\u30e9\u30a4\u30de\u30ea\u9078\u629e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0<ol> <li>\u30d7\u30e9\u30a4\u30de\u30ea\u30e1\u30f3\u30d0\u30fc\u306e\u81ea\u52d5\u9078\u629e\u30d7\u30ed\u30bb\u30b9\u3067\u306f\u3001\u5404\u30e1\u30f3\u30d0\u30fc\u304c\u30b0\u30eb\u30fc\u30d7\u306e\u65b0\u3057\u3044\u30d3\u30e5\u30fc\u3092\u53c2\u7167\u3057\u3001\u6f5c\u5728\u7684\u306a\u65b0\u3057\u3044\u30d7\u30e9\u30a4\u30de\u30ea\u30e1\u30f3\u30d0\u30fc\u3092\u9806\u5e8f\u4ed8\u3051\u3057\u3001\u6700\u3082\u9069\u3057\u305f\u30e1\u30f3\u30d0\u30fc\u3092\u9078\u629e\u3057\u307e\u3059\u3002 \u5404\u30e1\u30f3\u30d0\u30fc\u306f\u3001MySQL Server \u30ea\u30ea\u30fc\u30b9\u306e\u30d7\u30e9\u30a4\u30de\u30ea\u9078\u629e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306b\u5f93\u3063\u3066\u3001\u72ec\u81ea\u306e\u6c7a\u5b9a\u3092\u30ed\u30fc\u30ab\u30eb\u3067\u884c\u3044\u307e\u3059\u3002 \u3059\u3079\u3066\u306e\u30e1\u30f3\u30d0\u30fc\u306f\u540c\u3058\u6c7a\u5b9a\u306b\u5230\u9054\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3001\u4ed6\u306e\u30b0\u30eb\u30fc\u30d7\u30e1\u30f3\u30d0\u30fc\u304c\u3088\u308a\u4f4e\u3044 MySQL Server \u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u5834\u5408\u3001\u30e1\u30f3\u30d0\u30fc\u306f\u30d7\u30e9\u30a4\u30de\u30ea\u9078\u629e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u8abf\u6574\u3057\u3066\u3001\u30b0\u30eb\u30fc\u30d7\u5185\u3067\u6700\u3082\u4f4e\u3044 MySQL Server \u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u30e1\u30f3\u30d0\u30fc\u3068\u540c\u3058\u52d5\u4f5c\u3092\u3057\u307e\u3059\u3002</li> <li>\u30d7\u30e9\u30a4\u30de\u30ea\u3092\u9078\u629e\u3059\u308b\u3068\u304d\u306b\u30e1\u30f3\u30d0\u30fc\u304c\u8003\u616e\u3059\u308b\u30d5\u30a1\u30af\u30bf\u306f\u3001\u6b21\u306e\u3068\u304a\u308a\u3067\u3059:<ol> <li>\u6700\u521d\u306b\u8003\u616e\u3055\u308c\u308b\u8981\u56e0\u306f\u3001MySQL Server \u306e\u6700\u4e0b\u4f4d\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u30e1\u30f3\u30d0\u30fc\u3067\u3059\u3002 \u3059\u3079\u3066\u306e\u30b0\u30eb\u30fc\u30d7\u30e1\u30f3\u30d0\u30fc\u304c MySQL 8.0.17 \u4ee5\u4e0a\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u5834\u5408\u3001\u30e1\u30f3\u30d0\u30fc\u306f\u6700\u521d\u306b\u305d\u306e\u30ea\u30ea\u30fc\u30b9\u306e\u30d1\u30c3\u30c1\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u9806\u5e8f\u4ed8\u3051\u3055\u308c\u307e\u3059\u3002 MySQL Server 5.7 \u307e\u305f\u306f MySQL 8.0.16 \u4ee5\u4e0b\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u30e1\u30f3\u30d0\u30fc\u304c\u3042\u308b\u5834\u5408\u3001\u30e1\u30f3\u30d0\u30fc\u306f\u6700\u521d\u306b\u30e1\u30b8\u30e3\u30fc\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u30ea\u30ea\u30fc\u30b9\u3067\u9806\u5e8f\u4ed8\u3051\u3055\u308c\u3001\u30d1\u30c3\u30c1\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u7121\u8996\u3055\u308c\u307e\u3059\u3002</li> <li>\u8907\u6570\u306e\u30e1\u30f3\u30d0\u30fc\u3067\u6700\u4f4e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e MySQL Server \u304c\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3001\u8003\u616e\u3055\u308c\u308b 2 \u756a\u76ee\u306e\u30d5\u30a1\u30af\u30bf\u306f\u3001\u30e1\u30f3\u30d0\u30fc\u306e group_replication_member_weight \u30b7\u30b9\u30c6\u30e0\u5909\u6570\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u5404\u30e1\u30f3\u30d0\u30fc\u306e\u30e1\u30f3\u30d0\u30fc\u306e\u91cd\u307f\u3067\u3059\u3002 \u3053\u306e\u30b7\u30b9\u30c6\u30e0\u5909\u6570\u3092\u4f7f\u7528\u3067\u304d\u306a\u304b\u3063\u305f MySQL Server 5.7 \u3092\u30b0\u30eb\u30fc\u30d7\u306e\u3044\u305a\u308c\u304b\u306e\u30e1\u30f3\u30d0\u30fc\u304c\u5b9f\u884c\u3057\u3066\u3044\u308b\u5834\u5408\u3001\u3053\u306e\u4fc2\u6570\u306f\u7121\u8996\u3055\u308c\u307e\u3059\u3002group_replication_member_weight \u30b7\u30b9\u30c6\u30e0\u5909\u6570\u306f\u30010-100 \u306e\u7bc4\u56f2\u306e\u6570\u5024\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002 \u3059\u3079\u3066\u306e\u30e1\u30f3\u30d0\u30fc\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u91cd\u307f\u306f 50 \u3067\u3042\u308b\u305f\u3081\u3001\u9806\u5e8f\u3092\u4e0b\u3052\u308b\u306b\u306f\u3053\u306e\u5024\u3088\u308a\u4e0b\u306e\u91cd\u307f\u3092\u8a2d\u5b9a\u3057\u3001\u9806\u5e8f\u3092\u4e0a\u3052\u308b\u306b\u306f\u305d\u306e\u4e0a\u306e\u91cd\u307f\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002 \u3053\u306e\u91cd\u307f\u4ed8\u3051\u6a5f\u80fd\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u3088\u308a\u9069\u5207\u306a\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u306e\u4f7f\u7528\u306b\u512a\u5148\u9806\u4f4d\u3092\u4ed8\u3051\u308b\u3053\u3068\u3084\u3001\u30d7\u30e9\u30a4\u30de\u30ea\u306e\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3055\u308c\u305f\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u4e2d\u306b\u7279\u5b9a\u306e\u30e1\u30f3\u30d0\u30fc\u306b\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</li> <li>\u8907\u6570\u306e\u30e1\u30f3\u30d0\u30fc\u3067\u6700\u4f4e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e MySQL Server \u304c\u5b9f\u884c\u3055\u308c\u3066\u304a\u308a\u3001\u305d\u308c\u3089\u306e\u30e1\u30f3\u30d0\u30fc\u306e\u3046\u3061\u8907\u6570\u306e\u30e1\u30f3\u30d0\u30fc\u306e\u91cd\u307f\u304c\u6700\u9ad8\u3067\u3042\u308b (\u307e\u305f\u306f\u30e1\u30f3\u30d0\u30fc\u306e\u91cd\u307f\u304c\u7121\u8996\u3055\u308c\u3066\u3044\u308b) \u5834\u5408\u30013 \u756a\u76ee\u306e\u8981\u56e0\u306f\u3001server_uuid \u30b7\u30b9\u30c6\u30e0\u5909\u6570\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306b\u3001\u5404\u30e1\u30f3\u30d0\u30fc\u306e\u751f\u6210\u3055\u308c\u305f\u30b5\u30fc\u30d0\u30fc UUID \u306e\u8f9e\u66f8\u9806\u3067\u3042\u308b\u3068\u307f\u306a\u3055\u308c\u307e\u3059\u3002 \u30b5\u30fc\u30d0\u30fc UUID \u304c\u6700\u3082\u4f4e\u3044\u30e1\u30f3\u30d0\u30fc\u304c\u30d7\u30e9\u30a4\u30de\u30ea\u3068\u3057\u3066\u9078\u629e\u3055\u308c\u307e\u3059\u3002 \u3053\u306e\u30d5\u30a1\u30af\u30bf\u306f\u3001\u3059\u3079\u3066\u306e\u30b0\u30eb\u30fc\u30d7\u30e1\u30f3\u30d0\u30fc\u304c\u91cd\u8981\u306a\u30d5\u30a1\u30af\u30bf\u306b\u3088\u3063\u3066\u6c7a\u5b9a\u3067\u304d\u306a\u3044\u5834\u5408\u306b\u540c\u3058\u6c7a\u5b9a\u306b\u5230\u9054\u3059\u308b\u3088\u3046\u306b\u3001\u4fdd\u8a3c\u4ed8\u304d\u3067\u4e88\u6e2c\u53ef\u80fd\u306a\u30bf\u30a4\u30a8\u30ea\u30a2\u3068\u3057\u3066\u6a5f\u80fd\u3057\u307e\u3059\u3002</li> </ol> </li> </ol> </li> </ul>"},{"location":"mysql-group-replication/#_3","title":"\u30de\u30eb\u30c1\u30d7\u30e9\u30a4\u30de\u30ea\u30e2\u30fc\u30c9","text":"<p>\u8a73\u7d30\u306f\u5272\u611b\u3057\u307e\u3059\u3001\u5236\u9650\u591a\u3044\u4e0a\u306b\u30b0\u30eb\u30fc\u30d7\u5185\u4e00\u756a\u30b9\u30da\u30c3\u30af\u4f4e\u3044\u30b5\u30fc\u30d0\u306b\u6027\u80fd\u5f15\u3063\u5f35\u3089\u308c\u308b\u3001\u66f4\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5e2f\u57df\u3001\u901f\u5ea6\u306a\u3069\u8981\u7d20\u591a\u304f\u5f71\u97ff\u3055\u308c\u308b\u305f\u3081\u3001\u904b\u7528\u306b\u4e0d\u5411\u304d\u3067\u3059\u3002</p> <ul> <li>\u516c\u5f0f\u30b5\u30a4\u30c8</li> <li></li> </ul>"},{"location":"mysql-ha/","title":"mysql+keepalived\u642d\u5efa\u6559\u7a0b","text":"<ul> <li>Mysql\u96c6\u7fa4\u4e4bmysql\u53cc\u4e3b\u53cc\u6d3b+keepalived\u5b9e\u73b0\u9ad8\u53ef\u7528mysql+keepalived\u642d\u5efa\u6559\u7a0b</li> </ul>"},{"location":"mysql-ha/#_1","title":"\u4e00\u3001\u4ecb\u7ecd","text":"<p>MySQL\u53cc\u4e3b\u53cc\u6d3b\u662f\u6307\u4e24\u53f0mysql\u670d\u52a1\u5668mysql-1\u3001mysql-2\u90fd\u4e3amaster\u4e3b\u8282\u70b9\u670d\u52a1\u5668\uff0c\u540c\u65f6\u53c8\u662f\u5bf9\u65b9\u7684slave\u4ece\u8282\u70b9\uff0c\u6bcf\u4e2a\u6570\u636e\u5e93\u90fd\u53ef\u4f5c\u4e3a\u4e3b\u6570\u636e\u5e93\u4f7f\u7528\uff0c\u5e76\u5c06\u5bf9\u6570\u636e\u5e93\u64cd\u4f5c\u7684\u6570\u636e\u540c\u6b65\u81f3\u53e6\u5916\u4e00\u53f0mysql\u670d\u52a1\u4e2d\u3002</p> <p>\u5f53\u5e94\u7528\u670d\u52a1\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u4e86mysql-1\u8fde\u63a5\u4fe1\u606f\uff0c\u5728\u6253\u5305\u53d1\u5e03\u540e\uff0c\u6570\u636e\u5e93\u8fde\u63a5\u4fe1\u606f\u5df2\u7ecf\u56fa\u5b9a\uff0c\u5f53\u6570\u636e\u5e93mysql-1\u51fa\u73b0\u5f02\u5e38\u65f6\uff0c\u9700\u8981\u4eba\u5de5\u5e72\u9884\u5148\u5c06\u5e94\u7528\u670d\u52a1\u505c\u6b62--&gt;\u5c06\u5e94\u7528\u670d\u52a1\u7684mysql\u8fde\u63a5\u4fe1\u606f\u6539\u4e3amysql-2 --&gt;\u5728\u542f\u52a8\u5e94\u7528\u670d\u52a1\u5668\uff0c\u6bd4\u8f83\u7e41\u7410\uff0c\u5f53\u5e94\u7528\u670d\u52a1\u5668\u8f83\u591a\u65f6\uff0c\u4e00\u4e2a\u4e00\u4e2a\u5173\u95ed\uff0c\u4fee\u6539\uff0c\u518d\u91cd\u542f\uff0c\u5c06\u803d\u8bef\u66f4\u591a\u65f6\u95f4\uff0c\u5e94\u7528\u670d\u52a1\u5668\u4fee\u590d\u6545\u969c\u65f6\u95f4\u5ef6\u957f\uff0c\u4e25\u91cd\u65f6\u4f1a\u9020\u6210\u707e\u96be\u6027\u7684\u540e\u679c\u3002</p> <p>\u6545\u800c\u5f15\u5165\u4e86keepalived\uff0ckeepalived\u901a\u8fc7VIP\u865a\u62dfIP\u7684\u6f02\u79fb\u5b9e\u73b0\u9ad8\u53ef\u7528\uff0c\u5728\u76f8\u540c\u96c6\u7fa4\u5185\u53d1\u9001\u7ec4\u64ad\u5305\uff0cmaster\u4e3b\u901a\u8fc7VRRP\u534f\u8bae\u53d1\u9001\u7ec4\u64ad\u5305\uff0c\u544a\u8bc9\u4ece\u4e3b\u7684\u72b6\u6001\u3002</p> <p>\u5f53\u6211\u4eec\u901a\u8fc7keepalived\u865a\u62df\u51fa\u4e00\u4e2aip\u670d\u52a1 mysql-3\uff0c\u5e94\u7528\u670d\u52a1\u53ea\u9700\u8981\u5c06mysql\u914d\u7f6e\u4fe1\u606f\u66f4\u6539\u4e3amysql-3\u7684\u914d\u7f6e\u4fe1\u606f\uff0cmysql-3\u5b9e\u9645\u4ee3\u7406\u7684\u5b9e\u4f53\u670d\u52a1\u5668\u4e3amysql-1\u6216mysql-2\u3002</p> <p>\u4f8b\u5982\uff1a\u5f53mysql-3\u5b9e\u9645\u4ee3\u7406mysql-1\u65f6\uff0cmysql-1\u670d\u52a1\u51fa\u73b0\u6545\u969c\u540e\uff0ckeepalived\u901a\u8fc7\u81ea\u8eab\u673a\u5236\uff0c\u81ea\u52a8\u5c06mysql-2\u4f5c\u4e3a\u5b9e\u9645\u4ee3\u7406\u4e3b\u670d\u52a1\u5668\uff0c\u4e0d\u9700\u8981\u4eba\u5de5\u5e72\u9884\u53bb\u4fee\u6539mysql\u914d\u7f6e\u4fe1\u606f\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u9ad8\u53ef\u7528\u3002</p>"},{"location":"mysql-ha/#_2","title":"\u4e8c\u3001\u51c6\u5907\u5de5\u4f5c","text":"<ol> <li> <p>\u4e24\u53f0centos7 linux\u670d\u52a1\u5668</p> <ul> <li>mysql-1\uff1a192.168.222.128</li> <li>mysql-2\uff1a192.168.222.129</li> </ul> </li> <li> <p>mysql\u5b89\u88c5\u5305</p> <ul> <li>\u7248\u672c\uff1amysql-5.7.36-el7-x86_64.tar.gz</li> <li>\u4e0b\u8f7d\u5730\u5740\uff1ahttps://cdn.mysql.com/archives/mysql-5.7/mysql-test-5.7.36-el7-x86_64.tar.gz</li> </ul> </li> <li> <p>keepalived\u5b89\u88c5\u5305</p> <ul> <li>\u7248\u672c\uff1akeepalived-2.2.7.tar.gz</li> <li>\u4e0b\u8f7d\u5730\u5740\uff1ahttps://www.keepalived.org/software/keepalived-2.2.7.tar.gz</li> </ul> </li> </ol>"},{"location":"mysql-ha/#mysql","title":"\u4e09\u3001\u5b89\u88c5mysql","text":"<ol> <li> <p>\u5728128\u3001129\u4e24\u53f0\u670d\u52a1\u5668\u6839\u636e\u300alinux\u5b89\u88c5mysql\u670d\u52a1-\u4e24\u79cd\u5b89\u88c5\u65b9\u5f0f\u6559\u7a0b\u300b\u5b89\u88c5\u597dmysql\u5e94\u7528\u3002</p> </li> <li> <p>\u4fee\u6539128\u670d\u52a1\u5668/etc/my.cnf\u914d\u7f6e\u6587\u4ef6\uff0c\u6ca1\u6709\u7684\u8bdd\u53ef\u81ea\u884c\u521b\u5efa\uff0c\u914d\u7f6e\u5982\u4e0b\uff1a <pre><code>[client]\n# \u5ba2\u6237\u7aef\u8fde\u63a5\u7aef\u53e3\nport=3306\n# \u5ba2\u6237\u7aef\u8fde\u63a5sock\nsocket=/opt/mysql5.7/log/mysql.socka\n# \u5ba2\u6237\u7aef\u7f16\u7801\ndefault-character-set=utf8\n[mysqld]\n# mysql\u670d\u52a1\u7aef\u53e3\nport=3306\n#\u5b89\u88c5\u76ee\u5f55\nbasedir=/opt/mysql5.7\n#\u6570\u636e\u5b58\u653e\u76ee\u5f55\ndatadir=/opt/mysql5.7/data\n#sock\u6587\u4ef6\u5730\u5740\nsocket=/opt/mysql5.7/log/mysql.sock\n#\u9519\u8bef\u65e5\u5fd7\u5b58\u653e\u5730\u5740\nlog-error=/opt/mysql5.7/log/mysql.log\n#pid\u6587\u4ef6\u5730\u5740\npid-file=/opt/mysql5.7/log/mysql.pid\n#\u4e0b\u9762\u5185\u5bb9\u4e3amysq\u4e3b\u5907\u65f6\u914d\u7f6e\uff0c\u5355mysql\u90e8\u7f72\u62a4\u7406\u4e0b\u9762\u914d\u7f6e\n#server-id \u591a\u53f0\u670d\u52a1\u5668\u65f6\uff0c\u6b64\u8868\u793a\u9700\u8981\u552f\u4e00\nserver-id=1\n#\u4e3b\u4ece\u540c\u6b65bin-log\u65e5\u5fd7\u6587\u4ef6\u540d\nlog-bin=mysql-bin\n#\u4e3b\u4ece\u540c\u6b65\u65f6\uff0c\u9700\u8981\u540c\u6b65\u7684\u6570\u636e\u5e93\uff0c\u591a\u4e2a\u6570\u636e\u5e93\u5199\u591a\u884cbinlog_do_db\u914d\u7f6e\nbinlog_do_db=test_db\n#\u4e3b\u4ece\u540c\u6b65\u65f6\uff0c\u4e0d\u9700\u8981\u540c\u6b65\u7684\u6570\u636e\u5e93\uff0c\u591a\u4e2a\u6570\u636e\u5e93\u5199\u591a\u884cbinlog_ignore_db\u914d\u7f6e\n#binlog_ignore_db=mysql\n#binlog_ignore_db=information_schema\n#binlog_ignore_db=sys\n#binlog_ignore_db=performance_schema\n#\u4e3b\u4ece\u540c\u6b65\u65b9\u5f0f\nbinlog_format=row\n#\u670d\u52a1\u7aef\u7f16\u7801\ncharacter-set-server=utf8\n!includedir /etc/my.cnf.d\n</code></pre></p> </li> <li> <p>\u4fee\u6539129\u670d\u52a1\u5668/etc/my.cnf\u914d\u7f6e\u6587\u4ef6\uff0c\u53ea\u6709server-id\u4e0d\u540c\uff0c\u4e3a2\u914d\u7f6e\u5982\u4e0b</p> </li> </ol> <pre><code>[client]\n#\u5ba2\u6237\u7aef\u8fde\u63a5\u7aef\u53e3\nport=3306\n#\u5ba2\u6237\u7aef\u8fde\u63a5sock\nsocket=/opt/mysql5.7/log/mysql.socka\n#\u5ba2\u6237\u7aef\u7f16\u7801\ndefault-character-set=utf8\n\n[mysqld]\n#mysql\u670d\u52a1\u7aef\u53e3\nport=3306\n#\u5b89\u88c5\u76ee\u5f55\nbasedir=/opt/mysql5.7\n#\u6570\u636e\u5b58\u653e\u76ee\u5f55\ndatadir=/opt/mysql5.7/data\n#sock\u6587\u4ef6\u5730\u5740\nsocket=/opt/mysql5.7/log/mysql.sock\n#\u9519\u8bef\u65e5\u5fd7\u5b58\u653e\u5730\u5740\nlog-error=/opt/mysql5.7/log/mysql.log\n#pid\u6587\u4ef6\u5730\u5740\npid-file=/opt/mysql5.7/log/mysql.pid\n\n#\u4e0b\u9762\u5185\u5bb9\u4e3amysq\u4e3b\u5907\u65f6\u914d\u7f6e\uff0c\u5355mysql\u90e8\u7f72\u62a4\u7406\u4e0b\u9762\u914d\u7f6e\n#server-id \u591a\u53f0\u670d\u52a1\u5668\u65f6\uff0c\u6b64\u8868\u793a\u9700\u8981\u552f\u4e00\nserver-id=2\n#\u4e3b\u4ece\u540c\u6b65bin-log\u65e5\u5fd7\u6587\u4ef6\u540d\nlog-bin=mysql-bin\n#\u4e3b\u4ece\u540c\u6b65\u65f6\uff0c\u9700\u8981\u540c\u6b65\u7684\u6570\u636e\u5e93\uff0c\u591a\u4e2a\u6570\u636e\u5e93\u5199\u591a\u884cbinlog_do_db\u914d\u7f6e\nbinlog_do_db=test_db\n#\u4e3b\u4ece\u540c\u6b65\u65f6\uff0c\u4e0d\u9700\u8981\u540c\u6b65\u7684\u6570\u636e\u5e93\uff0c\u591a\u4e2a\u6570\u636e\u5e93\u5199\u591a\u884cbinlog_ignore_db\u914d\u7f6e\n#binlog_ignore_db=mysql\n#binlog_ignore_db=information_schema\n#binlog_ignore_db=sys\n#binlog_ignore_db=performance_schema\n#\u4e3b\u4ece\u540c\u6b65\u65b9\u5f0f\nbinlog_format=row\n#\u670d\u52a1\u7aef\u7f16\u7801\ncharacter-set-server=utf8\n\n!includedir /etc/my.cnf.d\n</code></pre> <ol> <li>\u91cd\u542fmysql\u670d\u52a1</li> </ol> <pre><code>[root@128 mysql5.7]# systemctl stop mysqld\n[root@128 mysql5.7]# systemctl start mysqld\n</code></pre>"},{"location":"mysql-ha/#mysql_1","title":"\u56db\u3001mysql\u6570\u636e\u5e93\u53cc\u4e3b\u53cc\u4ece\u914d\u7f6e","text":"<p>1.\u8fde\u63a5128\u670d\u52a1\u5668mysql\uff0c\u5e76\u521b\u5efa\u4e3b\u4ece\u540c\u6b65\u8d26\u6237slavebak\uff0c\u5e76\u67e5\u770bmaster\u72b6\u6001\uff0c\u8bb0\u5f55\u4e0bfile\u3001psition\u503c\uff0c\u914d\u7f6e129mysql\u4ece\u5e93\u65f6\u4f7f\u7528</p> <pre><code>[root@128 ~]# /opt/mysql5.7/bin/mysql -uroot -proot\nmysql: [Warning] Using a password on the command line interface can be insecure.\n......\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql&gt; grant replication slave on *.* to slavebak@'%' identified by 'slavebak';\nmysql&gt; flush privileges;\nmysql&gt; show master status;\n+------------------+----------+--------------+------------------+-------------------+\n| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |\n+------------------+----------+--------------+------------------+-------------------+\n| mysql-bin.000002 |     1287 | test_db      |                  |                   |\n+------------------+----------+--------------+------------------+-------------------+\n1 row in set (0.01 sec)\nmysql&gt;\n</code></pre> <p>2.\u8fde\u63a5129\u670d\u52a1\u5668\uff0c\u4f7f\u7528slavebak\u7528\u6237\u8fdc\u7a0b\u767b\u5f55128mysql\uff0c\u6d4b\u8bd5\u8fde\u63a5\u662f\u5426\u6b63\u5e38\u3002</p> <pre><code>[root@129 ~]# /opt/mysql5.7/bin/mysql -h192.168.222.128 -uslavebak -pslavebak\nmysql: [Warning] Using a password on the command line interface can be insecure.\n......\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql&gt; exit;\n[root@129 ~]# \n</code></pre> <p>3.\u5728129\u670d\u52a1\u5668\u7528root\u8fde\u63a5\u672c\u670d\u52a1\u5668mysql\uff0c\u5e76\u914d\u7f6e128\u7684\u4e3b\u5e93\u4fe1\u606f</p> <pre><code>[root@129 ~]# /opt/mysql5.7/bin/mysql -uroot -proot\nmysql: [Warning] Using a password on the command line interface can be insecure.\n......\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql&gt; change master to -&gt; master_host='192.168.222.128',            #128\u670d\u52a1\u5668mysql ip\n-&gt; master_port=3306,                         #128\u670d\u52a1\u5668mysql\u7aef\u53e3\n-&gt; master_user='slavebak',                   #128\u670d\u52a1\u5668mysql\u4ece\u5e93\u540c\u6b65\u7528\u6237\n-&gt; master_password='slavebak',               #128\u670d\u52a1\u5668mysql\u4ece\u5e93\u540c\u6b65\u7528\u6237\u5bc6\u7801\n-&gt; master_log_file='mysql-bin.000002',       #\u524d\u9762\u8bb0\u5f55\u7684128\u670d\u52a1mysql file\u503c\n-&gt; master_log_pos=1287;                      #\u524d\u9762\u8bb0\u5f55\u7684128\u670d\u52a1mysql psition\u503c\nQuery OK, 0 rows affected, 2 warnings (0.02 sec)\nmysql&gt; start slave;            #\u542f\u52a8\u4ece\u5e93\u914d\u7f6e\n</code></pre> <p>4.\u67e5\u770b129\u4ece\u5e93\u914d\u7f6e\u662f\u5426\u6210\u529fSlave_IO_Running\u3001Slave_SQL_Running\u90fd\u4e3ayes\u5219\u6210\u529f</p> <pre><code>mysql&gt; show slave status;\nmysql&gt; show slave status \\G;\n*************************** 1. row ***************************\n            ......\n            Slave_IO_Running:  Yes                    #\u6b64\u503c\u4e3ayes\u914d\u7f6e\u6210\u529f\nSlave_SQL_Running: Yes                    #\u6b64\u503c\u4e3ayes\u914d\u7f6ei\u6210\u529f\n......\n1 row in set (0.01 sec)\n</code></pre> <p>5.\u5728129\u670d\u52a1\u5668mysql\u521b\u5efa\u4e3b\u4ece\u540c\u6b65\u8d26\u6237slavebak\uff0c\u67e5\u770bmaster\u72b6\u6001\uff0c\u8bb0\u5f55\u4e0bfile\u3001psition\u503c</p> <pre><code>mysql&gt; grant replication slave on *.* to slavebak@'%' identified by 'slavebak';\nmysql&gt; flush privileges;\nmysql&gt; show master status;\n+------------------+----------+--------------+------------------+-------------------+\n| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |\n+------------------+----------+--------------+------------------+-------------------+\n| mysql-bin.000002 |     848  | test_db      |                  |                   |\n+------------------+----------+--------------+------------------+-------------------+\n1 row in set (0.01 sec)\n</code></pre> <p>6.\u8fde\u63a5128\u670d\u52a1\u5668\u5e76\u4f7f\u7528root\u7528\u6237\u8fde\u63a5\u672c\u670d\u52a1\u5668mysql\uff0c\u914d\u7f6e129\u7684\u4e3b\u5e93\u4fe1\u606f</p> <p><pre><code>[root@128 ~]# /opt/mysql5.7/bin/mysql -uroot -proot\nmysql: [Warning] Using a password on the command line interface can be insecure.\n......\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql&gt; change master to -&gt; master_host='192.168.222.129',            #129\u670d\u52a1\u5668mysql ip\n-&gt; master_port=3306,                         #129\u670d\u52a1\u5668mysql\u7aef\u53e3\n-&gt; master_user='slavebak',                   #129\u670d\u52a1\u5668mysql\u4ece\u5e93\u540c\u6b65\u7528\u6237\n-&gt; master_password='slavebak',               #129\u670d\u52a1\u5668mysql\u4ece\u5e93\u540c\u6b65\u7528\u6237\u5bc6\u7801\n-&gt; master_log_file='mysql-bin.000002',       #\u524d\u9762\u8bb0\u5f55\u7684129\u670d\u52a1mysql file\u503c\n-&gt; master_log_pos=848;                       #\u524d\u9762\u8bb0\u5f55\u7684129\u670d\u52a1mysql psition\u503c\nQuery OK, 0 rows affected, 2 warnings (0.02 sec)\nmysql&gt; start slave;            #\u542f\u52a8\u4ece\u5e93\u914d\u7f6e\n</code></pre> 7.\u67e5\u770b128\u4ece\u5e93\u914d\u7f6e\u662f\u5426\u6210\u529fSlave_IO_Running\u3001Slave_SQL_Running\u90fd\u4e3ayes\u5219\u6210\u529f</p> <pre><code>mysql&gt; show slave status;\nmysql&gt; show slave status \\G;\n*************************** 1. row ***************************\n            ......\n            Slave_IO_Running:  Yes                    #\u6b64\u503c\u4e3ayes\u914d\u7f6e\u6210\u529f\nSlave_SQL_Running: Yes                    #\u6b64\u503c\u4e3ayes\u914d\u7f6ei\u6210\u529f\n......\n1 row in set (0.01 sec)\n\u81f3\u6b64\uff0c128\u670d\u52a1\u5668\uff0c129\u670d\u52a1\u5668\u53cc\u4e3b\u53cc\u4ece\u914d\u7f6e\u5b8c\u6210\n</code></pre>"},{"location":"mysql-ha/#mysql_2","title":"\u4e94\u3001MySQL\u53cc\u4e3b\u53cc\u4ece\u6d4b\u8bd5","text":"<ol> <li>\u8fde\u63a5128\u670d\u52a1\u5668\uff0c\u4f7f\u7528root\u7528\u6237\u8fde\u63a5\u672c\u673amysql\uff0c\u5e76\u521b\u5efatest_db\u6570\u636e\u5e93\uff0ct_test\u8868\uff0c\u5e76\u63d2\u5165\u4e00\u6761\u6570\u636eid=1,name='zhangsan'</li> </ol> <pre><code>[root@128 ~]# /opt/mysql5.7/bin/mysql -uroot -proot\nmysql: [Warning] Using a password on the command line interface can be insecure.\n......\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql&gt; create database test_db;\nQuery OK, 1 row affected (0.00 sec)\nmysql&gt; use test_db;\nmysql&gt; create table t_test(id int primary key, name varchar(30));\nQuery OK, 0 row affected (0.01 sec)\nmysql&gt; insert into t_test values (1, 'zhangsan');\nQuery OK, 1 row affected (0.01 sec)\nmysql&gt; select * from t_test;\n+----+----------+\n| id | name     |\n+----+----------+\n|  1 | zhangsan |\n+----+----------+\n1 rows in set (0.00 sec)\n</code></pre> <ol> <li>\u8fde\u63a5129\u670d\u52a1\u5668\uff0c\u4f7f\u7528root\u7528\u6237\u8fde\u63a5mysql\uff0c\u67e5\u770btest_db\u6570\u636e\u5e93\u3001t_test\u8868\u4ee5\u53ca\u6570\u636e\u662f\u5426\u540c\u6b65\uff0c\u5e76\u63d2\u5165id=2\uff0cname=\u2018lisi\u2019 </li> </ol> <pre><code>[root@129 ~]# /opt/mysql5.7/bin/mysql -uroot -proot\nmysql: [Warning] Using a password on the command line interface can be insecure.\n......\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql&gt; show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n| test_db            |        #test_db\u6570\u636e\u5e93\u5df2\u540c\u6b65\u8fc7\u6765\n+--------------------+\n5 rows in set (0.01 sec)\nmysql&gt; use test_db;\nmysql&gt; show tables;\n+-------------------+\n| Tables_in_test_db |\n+-------------------+\n| t_test            |        #t_test\u8868\u5df2\u540c\u6b65\u8fc7\u6765\n+-------------------+\n1 row in set (0.01 sec)\nmysql&gt; select * from t_test;\n+----+----------+\n| id | name     |\n+----+----------+\n|  1 | zhangsan |            #\u6570\u636e\u5df2\u540c\u6b65\u8fc7\u6765\n+----+----------+\n1 rows in set (0.00 sec)\nmysql&gt; insert into t_test values (2, 'lisi');\nQuery OK, 1 row affected (0.01 sec)\n</code></pre> <ol> <li>\u5728128\u670d\u52a1\u5668\u67e5\u770bid=2\uff0cname=\"lisi\" \u662f\u5426\u540c\u6b65</li> </ol> <pre><code>[root@128 ~]# /opt/mysql5.7/bin/mysql -uroot -proot\nmysql: [Warning] Using a password on the command line interface can be insecure.\n......\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql&gt; select * from t_test;\n+----+----------+\n| id | name     |\n+----+----------+\n|  1 | zhangsan |\n|  2 | lisi     |            #lisi\u6570\u636e\u5df2\u540c\u6b65\n+----+----------+\n1 rows in set (0.00 sec)\n\u81f3\u6b64\uff0c\u6570\u636e\u5e93\u53cc\u4e3b\u53cc\u4ece\u6d4b\u8bd5\u5b8c\u6210\u3002\n</code></pre>"},{"location":"mysql-ha/#keepalived","title":"\u516d\u3001keepalived\u5b89\u88c5","text":"<p>128\u3001129\u4e24\u53f0\u670d\u52a1\u5668\u5b89\u88c5\u6b65\u9aa4\u76f8\u540c\uff0c\u914d\u7f6e\u6587\u4ef6\u4e0d\u540c\uff0c\u4e0b\u9762\u6709\u4ecb\u7ecd\u3002</p> <ol> <li>\u5b89\u88c5\u76f8\u5173\u4f9d\u8d56\u5305\uff0c\u5e76\u4e0b\u8f7dkeepalived\u5b89\u88c5\u5305\uff0c\u89e3\u538b\uff0c\u914d\u7f6e\uff0c\u7f16\u8bd1</li> </ol> <pre><code>[root@128 ~]# cd /opt\n[root@128 opt]# yum -y install gcc openssl-devel popt-devel psmisc\n[root@128 opt]# wget https://www.keepalived.org/software/keepalived-2.2.7.tar.gz\n[root@128 opt]# tar -zxvf keepalived-2.2.7.tar.gz\n[root@128 opt]# cd keepalived-2.2.7\n[root@128 keepalived-2.2.7]# ./configure --prefix=/opt/keepalived-2.2.7\n[root@128 keepalived-2.2.7]# make &amp;&amp; make install\n</code></pre> <ol> <li>\u5c06\u6587\u4ef6\u590d\u5236\u5230\u5bf9\u5e94\u76ee\u5f55\u4e0b</li> </ol> <pre><code>[root@128 keepalived-2.2.7]# mkdir /etc/keepalived\n[root@128 keepalived-2.2.7]# cp keepalived/etc/keepalived/keepalived.conf.sample /etc/keepalived/keepalived.conf\n[root@128 keepalived-2.2.7]# cp keepalived/etc/init.d/keepalived /etc/init.d/\n[root@128 keepalived-2.2.7]# cp keepalived/etc/sysconfig/keepalived /etc/sysconfig/\n[root@128 keepalived-2.2.7]# cp bin/keepalived /usr/sbin/\n</code></pre> <ol> <li>\u65b0\u5efa/etc/keepalived/shutdown.sh\u6587\u4ef6\uff0c\u5185\u5bb9\u4e3a\uff1a</li> </ol> <pre><code>#!/bin/bash\n#\u8be5\u811a\u672c\u662f\u5728mysql\u670d\u52a1\u51fa\u73b0\u5f02\u5e38\u65f6\uff0c\u5c06keepalived\u5e94\u7528\u505c\u6b62\uff0c\u4ece\u800c\u4f7f\u865a\u62dfvip\u4e3b\u673a\u81ea\u52a8\u8fde\u63a5\u5230\u53e6\u4e00\u53f0mysql\u4e0a\nkillall keepalived\n</code></pre> <ol> <li> <p>\u4f7f\u7528ifconfig\u547d\u4ee4\u67e5\u770b\u4e0b\u7f51\u5361\u540d\u79f0\uff0c\u672c\u673a\u7f51\u5361\u540d\u79f0\u4e3aens33</p> </li> <li> <p>\u4fee\u6539128\u670d\u52a1\u5668/etc/keepalived/keepalived.conf\u914d\u7f6e\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a</p> </li> </ol> <pre><code>! Configuration File for keepalived\n\nglobal_defs {\nnotification_email {\nacassen@firewall.loc\n     failover@firewall.loc\n     sysadmin@firewall.loc\n   }\nnotification_email_from Alexandre.Cassen@firewall.loc\n   smtp_server 192.168.200.1\n   smtp_connect_timeout 30\nrouter_id LVS_MASTER\n   vrrp_skip_check_adv_addr\n   vrrp_strict\n   vrrp_garp_interval 0\nvrrp_gna_interval 0\n}\nvrrp_instance VI_1 {\nstate MASTER\n    #interface\u4e3a\u521a\u624d\u67e5\u5230\u7684\u672c\u673a\u7f51\u5361\u540d\u79f0\ninterface ens33\n    #\u540c\u4e00\u7f51\u6bb5\u4e2d\u540c\u4e00\u7ec4virtual_router_id\u503c\u76f8\u540c\u3002\u4e0d\u540c\u7ec4virtual_router_id\u503c\u552f\u4e00\u3002\n#\u5982server-1\u3001server-2\u4e3a\u4e00\u7ec4\uff0cvirtual_router_id=51\n#server-3\u3001server-4\u4e3a\u4e00\u7ec4\uff0c\u5219virtual_router_id\u4e0d\u80fd\u4e3a51\nvirtual_router_id 51\n#\u5b57\u6570\u8d8a\u5927\uff0c\u4f18\u5148\u7ea7\u8d8a\u9ad8\uff0cmaster\u5fc5\u987b\u5927\u4e8ebackup\npriority 100\nadvert_int 1\nauthentication {\nauth_type PASS\n        auth_pass 1111\n}\nvirtual_ipaddress {\n#\u8be5ip\u4e3a\u865a\u62df\u51fa\u6765\u7684vip\u5730\u5740\n192.168.222.130\n    }\n}\n#\u914d\u7f6evirtual_server  ip\u4e3a\u4e0a\u9762\u914d\u7f6e\u7684\u865a\u62dfvip\u5730\u5740  \u7aef\u53e3\u4e3amysql\u7684\u7aef\u53e3\nvirtual_server 192.168.222.130 3306 {\ndelay_loop 6\nlb_algo rr\n    lb_kind NAT\n    persistence_timeout 50\nprotocol TCP\n    #real_server \u8be5\u914d\u7f6e\u4e3a\u5b9e\u9645\u7269\u7406\u673aip\u5730\u5740 \u4ee5\u53ca\u5b9e\u9645\u7269\u7406\u673amysql\u7aef\u53e3\nreal_server 192.168.222.128 3306 {\n#\u5f53\u8be5ip \u7aef\u53e3\u8fde\u63a5\u5f02\u5e38\u65f6\uff0c\u6267\u884c\u8be5\u811a\u672c\nnotify_down /etc/keepalived/shutdow.sh\n        TCP_CHECK {\n#\u5b9e\u9645\u7269\u7406\u673aip\u5730\u5740\nconnect_ip 192.168.222.128\n            #\u5b9e\u9645\u7269\u7406\u673aport\u7aef\u53e3\nconnect_port 3306\nconnect_timeout 3\nnb_get_retry 3\ndelay_before_retry 3\n}\n}\n}\n</code></pre> <ol> <li>\u4fee\u6539129\u670d\u52a1\u5668/etc/keepalived/keepalived.conf\u914d\u7f6e\u6587\u4ef6\uff0c\u4e0e128\u7684\u914d\u7f6e\u4e0d\u540c\u5730\u65b9\u4e3areal_server\u3001connect_ip \u4e24\u4e2a\u914d\u7f6e\uff0c\u9700\u8981\u914d\u7f6e\u5bf9\u5e94\u7684\u5b9e\u9645\u4e3b\u673aip\uff0c\u8be6\u7ec6\u5185\u5bb9\u5982\u4e0b\uff1a</li> </ol> <pre><code>! Configuration File for keepalived\n\nglobal_defs {\nnotification_email {\nacassen@firewall.loc\n     failover@firewall.loc\n     sysadmin@firewall.loc\n   }\nnotification_email_from Alexandre.Cassen@firewall.loc\n   smtp_server 192.168.200.1\n   smtp_connect_timeout 30\nrouter_id LVS_MASTER\n   vrrp_skip_check_adv_addr\n   vrrp_strict\n   vrrp_garp_interval 0\nvrrp_gna_interval 0\n}\nvrrp_instance VI_1 {\nstate BACKUP\n    #interface\u4e3a\u521a\u624d\u67e5\u5230\u7684\u672c\u673a\u7f51\u5361\u540d\u79f0\ninterface ens33\n    #\u540c\u4e00\u7f51\u6bb5\u4e2d\u540c\u4e00\u7ec4virtual_router_id\u503c\u76f8\u540c\u3002\u4e0d\u540c\u7ec4virtual_router_id\u503c\u552f\u4e00\u3002\n#\u5982server-1\u3001server-2\u4e3a\u4e00\u7ec4\uff0cvirtual_router_id=51\n#server-3\u3001server-4\u4e3a\u4e00\u7ec4\uff0c\u5219virtual_router_id\u4e0d\u80fd\u4e3a51\nvirtual_router_id 51\n#\u5b57\u6570\u8d8a\u5927\uff0c\u4f18\u5148\u7ea7\u8d8a\u9ad8\uff0cmaster\u5fc5\u987b\u5927\u4e8ebackup\npriority 90\nadvert_int 1\nauthentication {\nauth_type PASS\n        auth_pass 1111\n}\nvirtual_ipaddress {\n#\u8be5ip\u4e3a\u865a\u62df\u51fa\u6765\u7684vip\u5730\u5740\n192.168.222.130\n    }\n}\n#\u914d\u7f6evirtual_server  ip\u4e3a\u4e0a\u9762\u914d\u7f6e\u7684\u865a\u62dfvip\u5730\u5740  \u7aef\u53e3\u4e3amysql\u7684\u7aef\u53e3\nvirtual_server 192.168.222.130 3306 {\ndelay_loop 6\nlb_algo rr\n    lb_kind NAT\n    persistence_timeout 50\nprotocol TCP\n    #real_server \u8be5\u914d\u7f6e\u4e3a\u5b9e\u9645\u7269\u7406\u673aip\u5730\u5740 \u4ee5\u53ca\u5b9e\u9645\u7269\u7406\u673amysql\u7aef\u53e3\nreal_server 192.168.222.129 3306 {\n#\u5f53\u8be5ip \u7aef\u53e3\u8fde\u63a5\u5f02\u5e38\u65f6\uff0c\u6267\u884c\u8be5\u811a\u672c\nnotify_down /etc/keepalived/shutdow.sh\n        TCP_CHECK {\n#\u5b9e\u9645\u7269\u7406\u673aip\u5730\u5740\nconnect_ip 192.168.222.129\n            #\u5b9e\u9645\u7269\u7406\u673aport\u7aef\u53e3\nconnect_port 3306\nconnect_timeout 3\nnb_get_retry 3\ndelay_before_retry 3\n}\n}\n}\n</code></pre> <p>\u8be6\u7ec6\u914d\u7f6e\u53c2\u8003\u300aKeepalived \u5b89\u88c5\u548c\u914d\u7f6e\u8be6\u89e3\u300b</p> <ol> <li>\u5c06128\u3001129\u670d\u52a1\u5668keepalived\u52a0\u5165\u5f00\u673a\u81ea\u542f\uff0c\u5e76\u542f\u52a8\u670d\u52a1</li> </ol> <pre><code>[root@128 keepalived-2.2.7]# systemctl enable keepalived\n[root@128 keepalived-2.2.7]# systemctl start keepalived\n</code></pre> <ol> <li> <p>\u542f\u52a8\u540ekeepalived\u72b6\u6001\u4e3a\uff1aactive(running)\u5219\u6b63\u5e38</p> </li> <li> <p>\u542f\u52a8\u540e\u76f8\u5f53\u4e8e\u865a\u62df\u51fa\u4e00\u4e2avip 192.168.222.130\uff0c\u53ef\u4f7f\u7528\u8fdc\u7a0b\u8fde\u63a5\u5de5\u5177\uff0c\u8fde\u63a5\u8be5\u670d\u52a1\u5668\uff0c\u8fde\u63a5\u8fdb\u53bb\u540e\u4f7f\u7528ifconfig\u67e5\u770b\u8be5\u865a\u62dfvip\u5b9e\u9645\u4e0a\u4f7f\u7528\u7684\u5b9e\u4f53\u670d\u52a1\u5668\u662f129\u670d\u52a1\u5668\u3002</p> </li> <li> <p>\u5c06129\u670d\u52a1\u5668\u7684keepalived\u5e94\u7528\u505c\u6b62\uff0c\u518d\u6b21\u67e5\u770b130\u670d\u52a1ifconfig\uff0c\u53ef\u4ee5\u770b\u5230\uff0c130\u670d\u52a1\u5668\u81ea\u52a8\u5c06\u5b9e\u4f53\u673aip\u6f02\u79fb\u5230\u4e86128\u670d\u52a1\u5668\u4e0a</p> </li> </ol> <p>\u81f3\u6b64\uff0ckeepalived\u90e8\u7f72\u5b8c\u6210\u3002</p>"},{"location":"mysql-ha/#_3","title":"\u4e03\u3001\u691c\u8a3c\u4f8b","text":"<ul> <li> <p>keepalived.conf</p> <ul> <li> Note <pre><code>[root@node1 ]# cat /etc/keepalived/keepalived.conf\n! Configuration File for keepalived\n\nglobal_defs {\nrouter_id MGR_NODE1            #\u662f\u8fd0\u884ckeepalived\u7684\u4e00\u4e2a\u8868\u793a\uff0c\u591a\u4e2a\u96c6\u7fa4\u8bbe\u7f6e\u4e0d\u540c\u3002\nnotification_email {           #\u8bbe\u7f6e keepalived \u5728\u53d1\u751f\u4e8b\u4ef6\uff08\u6bd4\u5982\u5207\u6362\uff09\u7684\u65f6\u5019\uff0c\u9700\u8981\u53d1\u9001\u5230\u7684email\u5730\u5740\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\uff0c\u6bcf\u884c\u4e00\u4e2a\u3002\nxxx@mail-server\n   }\nnotification_email_from node3  #\u8bbe\u7f6e\u901a\u77e5\u90ae\u4ef6\u53d1\u9001\u6765\u81ea\u4e8e\u54ea\u91cc\uff0c\u5982\u679c\u672c\u5730\u5f00\u542f\u4e86sendmail\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0a\u9762\u7684\u9ed8\u8ba4\u503c\u3002\n# smtp_server 192.168.200.1    #\u6307\u5b9a\u53d1\u9001\u90ae\u4ef6\u7684smtp\u670d\u52a1\u5668\u3002\nsmtp_connect_timeout 30        #\u8bbe\u7f6esmtp\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2\u3002\n}\n#\u6307\u5b9amysql\u670d\u52a1\u68c0\u6d4b\u811a\u672c\nvrrp_script chk_mysql {\nscript \"/etc/keepalived/chk_mysql.sh\" #\u811a\u672c\u8def\u5f84\ninterval 2            #\u811a\u672c\u68c0\u6d4b\u9891\u7387\nweight -5             #\u811a\u672c\u6267\u884c\u8fd4\u56de\u503c =0 \uff0c\u4f18\u5148\u7ea7\u4e0d\u53d8\u3002 !=0 \u65f6\u4f18\u5148\u7ea7 -5\nfall 2                #\u5982\u679c\u8fde\u7eed\u4e24\u6b21\u68c0\u6d4b\u5931\u8d25\uff0c\u8ba4\u4e3a\u8282\u70b9\u670d\u52a1\u4e0d\u53ef\u7528\nrise 1                #\u5982\u679c\u8fde\u7eed2\u6b21\u68c0\u67e5\u6210\u529f\u5219\u8ba4\u4e3a\u8282\u70b9\u6b63\u5e38\n}\n#\u76d1\u6d4bmysql \u662f\u5426\u662fmaster\nvrrp_script chk_mysql_master {\nscript \"/etc/keepalived/chk_mysql_master.sh\"\ninterval 2\nweight 10             #\u811a\u672c\u6267\u884c\u8fd4\u56de\u503c =0 \uff0c\u4f18\u5148\u7ea7\u52a0 10\u3002 !=0 \u65f6\u4f18\u5148\u7ea7\u4e0d\u53d8\u3002\n}\n# \u7b80\u6613\u68c0\u6d4b\nvrrp_script check_run {\nscript \"/etc/keepalived/mysql_check.sh\"\ninterval 5                              #5\u79d2\u6267\u884c\u4e00\u6b21\u811a\u672c\n}\nvrrp_instance VI_1 {\nstate BACKUP          #\u6307\u5b9a\u5b9e\u4f8b\u521d\u59cb\u72b6\u6001\uff0c\u5b9e\u9645\u7684MASTER\u548cBACKUP\u662f\u9009\u4e3e\u51b3\u5b9a\u7684\u3002\ninterface eth0        #\u6307\u5b9a\u5b9e\u4f8b\u7ed1\u5b9a\u7684\u7f51\u5361\nvirtual_router_id 88  #\u8bbe\u7f6eVRID\u6807\u8bb0(0..255)\npriority 90           #\u8bbe\u7f6e\u4f18\u5148\u7ea7\uff0c\u4f18\u5148\u7ea7\u9ad8\u7684\u4f1a\u88ab\u7ade\u9009\u4e3aMaster\nadvert_int 1          #\u68c0\u67e5\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u9ed8\u8ba41s\nauthentication {      #\u8282\u70b9\u95f4\u7684\u8ba4\u8bc1\uff0c\u6240\u6709\u7684\u5fc5\u987b\u4e00\u81f4\nauth_type PASS\n        auth_pass 1111\n}\nvirtual_ipaddress {   #\u8bbe\u7f6eVIP\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\uff0c\u7528\u4e8e\u5207\u6362\u65f6\u7684\u5730\u5740\u7ed1\u5b9a\u3002\n192.168.1.1       # VIP\u5730\u5740\uff08\u8be5ip\u4e3a\u865a\u62df\u51fa\u6765\u7684vip\u5730\u5740)\n}\ntrack_script { #\u6307\u5b9a\u524d\u9762\u811a\u672c\u7684\u540d\u5b57\n# check_run\nchk_mysql\n        chk_mysql_master\n    }\n}\n[root@node1 ]#\n</code></pre> </li> </ul> </li> <li> <p>mysql_check.sh</p> <ul> <li> Note <pre><code>[root@node1 ]# cat /etc/keepalived/mysql_check.sh\n#!/bin/bash\n# /usr/local/mysql/bin/mysql -uroot -p'root' -e \"show status\" &amp;&gt;/dev/null\nmysql --defaults-file=/root/.my.cnf -e \"show status\" &amp;&gt;/dev/null\n\nif [ $? -ne 0 ] ;then\nsystemctl stop keepalived\nfi\n[root@node1 ]#\n</code></pre> </li> </ul> </li> <li> <p>chk_mysql.sh</p> <ul> <li> Note <pre><code>[root@node1 ]# cat /etc/keepalived/chk_mysql.sh\n#!/bin/bash\nmysql --defaults-file=/root/.my.cnf -e \"show status\" &amp;&gt;/dev/null\n\nif [ $? -ne 0 ] ;then\nsystemctl stop keepalived\nfi\n#counter=`netstat -tulnp |grep -w :::3306 |wc -l`\n#if [ $counter -eq 0 ]; then\n#       systemctl stop keepalived\n#fi\n[root@node1 ]#\n</code></pre> </li> </ul> </li> <li> <p>chk_mysql_master.sh</p> <ul> <li> Note <pre><code>[root@node1 ]# cat /etc/keepalived/chk_mysql_master.sh\n#!/bin/bash\nPATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin\nexport PATH\n\n#priuuid=`/usr/local/mysql8.0/bin/mysql -uroot -S /mysql/data_mgr_8.0/mysql.sock -e \"SELECT * FROM performance_schema.replication_group_members WHERE MEMBER_ID = (SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME= 'group_replication_primary_member')\" |awk 'NR==2{print}'|awk -F\" \" '{print $2}'`\n#uuid=`/usr/local/mysql8.0/bin/mysql -uroot -S /mysql/data_mgr_8.0/mysql.sock -e \"select @@global.server_uuid\" |awk 'NR==2{print}'`\npriuuid=`mysql --defaults-file=/root/.my.cnf -e \"SELECT * FROM performance_schema.replication_group_members WHERE MEMBER_ID = (SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME= 'group_replication_primary_member')\" |awk 'NR==2{print}'|awk -F\" \" '{print $2}'`\nuuid=`mysql --defaults-file=/root/.my.cnf -e \"select @@global.server_uuid\" |awk 'NR==2{print}'`\nif [ $priuuid == $uuid ]; then\nexit 0\nelse\nexit 1\nfi\n[root@node1 ]#\n</code></pre> </li> </ul> </li> </ul>"},{"location":"mysql-kill/","title":"mysqladmin kill","text":"<ul> <li>https://tech.basicinc.jp/articles/41</li> <li>https://stackoverflow.com/questions/44192418/how-to-find-mysql-process-list-and-to-kill-those-processes</li> </ul>"},{"location":"mysql-kill/#60","title":"\u51e6\u7406\u6642\u9593\u306b60\u79d2\u4ee5\u4e0a\u304b\u304b\u3063\u3066\u3044\u308b\u306e\u3092\u8868\u793a","text":"<pre><code>SELECT * FROM information_schema.PROCESSLIST WHERE TIME &gt; 59;\n</code></pre>"},{"location":"mysql-kill/#id","title":"\u6307\u5b9a\u30e6\u30fc\u30b6\u306e\u30d7\u30ed\u30bb\u30b9ID\u306e\u3092\u8868\u793a","text":"<pre><code>SELECT GROUP_CONCAT(ID) FROM information_schema.PROCESSLIST WHERE user='user';\n</code></pre>"},{"location":"mysql-kill/#60id","title":"\u51e6\u7406\u6642\u9593\u306b60\u79d2\u4ee5\u4e0a\u304b\u3064\u6307\u5b9a\u30e6\u30fc\u30b6\u306e\u30d7\u30ed\u30bb\u30b9ID\u306e\u3092\u8868\u793a","text":"<pre><code>SELECT GROUP_CONCAT(ID) FROM information_schema.PROCESSLIST WHERE user='user' and TIME &gt; 59;\n</code></pre>"},{"location":"mysql-kill/#_1","title":"\u7d50\u679c","text":"<pre><code>SELECT GROUP_CONCAT(ID) FROM information_schema.PROCESSLIST WHERE  user='user' and TIME &gt; 59;\n+------------------+\n| group_concat(ID) |\n+------------------+\n| 1,2,3,4,5        |\n+------------------+\n</code></pre>"},{"location":"mysql-kill/#idkill","title":"\u8907\u6570\u306e\u30d7\u30ed\u30bb\u30b9ID\u3092kill\u3059\u308b","text":"<pre><code>$ mysqladmin kill 1,2,3\n</code></pre>"},{"location":"mysql-kill/#kill","title":"kill\u30b3\u30de\u30f3\u30c9\u3092\u51fa\u529b\u3059\u308b","text":"<pre><code>SELECT  concat('mysqladmin kill ', GROUP_CONCAT(ID)) FROM information_schema.PROCESSLIST WHERE user='user';\n\n+--------------------------------------------------------------------------------------------+\n| concat('mysqladmin kill ', GROUP_CONCAT(ID))                                               |\n+--------------------------------------------------------------------------------------------+\n| mysqladmin kill 588732677,326878732692,588732693,588732695,588732684,588732696,588732688   |\n+--------------------------------------------------------------------------------------------+\n\n[root@mysqlxxx ~]# mysql -e \"SELECT  concat('mysqladmin kill ', GROUP_CONCAT(ID)) FROM information_schema.PROCESSLIST WHERE user='user';\"\n</code></pre>"},{"location":"mysql-mgr-copy/","title":"\u3068\u3066\u3082\u826f\u3044\u8a18\u4e8b\u306e\u305f\u3081\u3001\u30e1\u30e2\u3068\u3057\u3066\u8ee2\u8f09\u3044\u305f\u3057\u307e\u3059\u3002","text":"<ul> <li>ngyuki\u306e\u65e5\u8a18\u0006</li> </ul>"},{"location":"mysql-mgr-copy/#mysql-group-replication","title":"MySQL Group Replication \u7d20\u632f\u308a","text":"<p>\u516c\u5f0f\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8aad\u307f\u306a\u304c\u3089\u7d20\u632f\u308a\u3057\u307e\u3057\u305f\u3002</p> <p>MySQL :: MySQL 8.0 Reference Manual :: 18 Group Replication</p> <p>\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u306f\u3001\u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u30b7\u30c3\u30d7\u7ba1\u7406\u3001\u30ce\u30fc\u30c9\u306e\u969c\u5bb3\u691c\u51fa\u3001\u8ffd\u52a0\u30ce\u30fc\u30c9\u306e\u540c\u671f\u3001\u306a\u3069\u304c\u81ea\u52d5\u3067\u884c\u308f\u308c\u307e\u3059\u3002\u4e00\u65b9\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u306e\u63a5\u7d9a\u5148\u3092\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3059\u308b\u3088\u3046\u306a\u6a5f\u80fd\u306f\u306a\u3044\u305f\u3081\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u30af\u30e9\u30b9\u30bf\u306e\u3069\u306e\u30ce\u30fc\u30c9\u306b\u63a5\u7d9a\u3059\u308b\u304b\u306e\u5236\u5fa1\u306b\u306f\u5225\u306e\u306a\u306b\u304b\u304c\u5fc5\u8981\u3067\u3059\uff08MySQL Router \u3068\u304b HAProxy \u3068\u304b\uff09\u3002</p>"},{"location":"mysql-mgr-copy/#configuration","title":"Configuration","text":"<p>\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u305f\u3081\u306e my.cnf \u306e\u629c\u7c8b\u3067\u3059\u3002</p> <ul> <li>\u5404\u8a2d\u5b9a\u9805\u76ee\u306f\u4e0b\u8a18\u53c2\u7167</li> <li>https://lyvivian0077.github.io/mysql-mgr/#mycnf</li> </ul> my.cnf <pre><code># GTID \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u95a2\u3059\u308b\u8a2d\u5b9a\n# \u3082\u3061\u308d\u3093 server_id \u306f\u30ce\u30fc\u30c9\u3054\u3068\u306b\u56fa\u6709\u306e\u5024\u304c\u5fc5\u8981\nserver_id=1\ngtid_mode=ON\nenforce_gtid_consistency=ON\nbinlog_checksum=NONE\n\n# 8.0.3 \u4ee5\u524d\u306a\u3089\u5fc5\u8981\u306a\u30aa\u30d7\u30b7\u30e7\u30f3\uff08\u305d\u308c\u4ee5\u964d\u306a\u3089\u30c7\u30d5\u30a9\u30eb\u30c8\uff09\nlog_bin=binlog\nlog_slave_updates=ON\nbinlog_format=ROW\nmaster_info_repository=TABLE\nrelay_log_info_repository=TABLE\n\n# \u3053\u3053\u304b\u3089\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u95a2\u3059\u308b\u8a2d\u5b9a\n\n# \u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3059\u308b\u306a\u3089 XXHASH64 \u3067\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\n# 8.0.2 \u4ee5\u964d\u306a\u3089\u30c7\u30d5\u30a9\u30eb\u30c8\ntransaction_write_set_extraction=XXHASH64\n\n# \u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u30ed\u30fc\u30c9\nplugin_load=group_replication.so\n\n# \u9069\u5f53\u306a\u65b9\u6cd5\u3067\u751f\u6210\u3057\u305f UUID \u3092\u6307\u5b9a\u3059\u308b\n# \u30b0\u30eb\u30fc\u30d7\u306e\u540d\u524d\u306b\u306a\u3063\u3066 GTID \u3082\u3053\u306e UUID\u304b\u3089\u4f5c\u3089\u308c\u308b\ngroup_replication_group_name=\"470b4daf-6c34-415f-97ad-68cf76ef24e7\"\n\n# \u30ce\u30fc\u30c9\u306e\u8d77\u52d5\u6642\u306b\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u81ea\u52d5\u7684\u306b\u958b\u59cb\u3057\u306a\u3044\ngroup_replication_start_on_boot=off\n\n# \u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u305f\u3081\u306e\u81ea\u30ce\u30fc\u30c9\u306e\u30a2\u30c9\u30ec\u30b9\u3068\u30dd\u30fc\u30c8\u756a\u53f7\ngroup_replication_local_address= \"192.168.88.11:6606\"\n\n# \u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u30fc\u306e\u4e00\u89a7\ngroup_replication_group_seeds= \"192.168.88.11:6606,192.168.88.12:6606,192.168.88.13:6606\"\n\n# \u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u958b\u59cb\u6642\u306b\u65b0\u305f\u306a\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u3089\u306a\u3044\ngroup_replication_bootstrap_group=off\n\n# MySQL 8.0 \u306e\u30e6\u30fc\u30b6\u30fc\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067 caching_sha2_password \u8a8d\u8a3c\u306a\u306e\u3067\u6e96\u5099\u304c\u9762\u5012\n# \u3060\u3051\u3069\u3053\u308c\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u3051\u3070\u9762\u5012\u304c\u306a\u304f\u306a\u308b\u3001\u305f\u3060\u3057\u4e2d\u9593\u8005\u653b\u6483\u306b\u8106\u5f31\ngroup_replication_recovery_get_public_key=ON\n</code></pre> <ul> <li><code>plugin_load=group_replication.so</code> \u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u306e\u3067\u30b5\u30fc\u30d0\u8d77\u52d5\u6642\u306b\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u30ed\u30fc\u30c9\u3055\u308c\u307e\u3059\u3002</li> <li>\u5f8c\u304b\u3089 <code>INSTALL PLUGIN</code> \u3059\u308b\u5834\u5408\u306f <code>group_replication_*</code> \u30d1\u30e9\u30e1\u30fc\u30bf\u306f <code>loose-group_replication_*</code> \u306e\u3088\u3046\u306b <code>loose-</code> \u3092\u3064\u3051\u3066\u304a\u304b\u306a\u3044\u3068\u5b58\u5728\u3057\u306a\u3044\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u30a8\u30e9\u30fc\u3067\u8d77\u52d5\u304c\u30b3\u30b1\u307e\u3059\u3002</li> <li>MySQL 8.0 \u3067\u4f5c\u6210\u3055\u308c\u305f\u30e6\u30fc\u30b6\u30fc\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067 <code>caching_sha2_password</code> \u3068\u3044\u3046\u8a8d\u8a3c\u65b9\u6cd5\u3092\u4f7f\u3046\u305f\u3081\u3001\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u306f\u3044\u308d\u3044\u308d\u6e96\u5099\u304c\u5fc5\u8981\u306a\u3088\u3046\u306a\u306e\u3067\u3059\u304c\u3001<code>group_replication_recovery_get_public_key=ON</code> \u3092\u6307\u5b9a\u3059\u308c\u3070\u305d\u306e\u6e96\u5099\u304c\u7701\u7565\u3067\u304d\u307e\u3059\u3002\u305f\u3060\u3057\u4e2d\u9593\u8005\u653b\u6483\u306b\u5bfe\u3057\u3066\u8106\u5f31\u306b\u306a\u308a\u307e\u3059\u3002</li> <li><code>default_authentication_plugin=mysql_native_password \u3068\u304b\u3067\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a8d\u8a3c\u65b9\u6cd5\u3092\u5909\u3048\u3066\u304a\u304f\u304b\u3001\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3059\u308b\u3068\u304d\u306b</code>mysql_native_password` \u3092\u660e\u793a\u3057\u3066\u304a\u3044\u3066\u3082\u826f\u3044\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3001\u901a\u4fe1\u7d4c\u8def\u304c\u5b89\u5168\u3067\u3042\u308b\u3053\u3068\u304c\u9593\u9055\u3044\u306a\u3044\u306a\u3089\u3002</li> </ul>"},{"location":"mysql-mgr-copy/#docker-compose","title":"docker-compose","text":"docker-compose <p>docker-compose.yml</p> <pre><code>version: '3.4'\n\nservices:\n  sv01:\n    image: mysql:8\n    container_name: sv01\n    hostname: sv01\n    environment:\n      MYSQL_ALLOW_EMPTY_PASSWORD: 1\n      MYSQL_DATABASE: test\n      MYSQL_PS1: \"sv01&gt; \"\n    networks:\n      mysql:\n        ipv4_address: 192.168.88.11\n    command:\n      - --server_id=1\n      - --gtid_mode=ON\n      - --enforce_gtid_consistency=ON\n      - --binlog_checksum=NONE\n      - --relay_log=relay-bin\n      - --transaction_write_set_extraction=XXHASH64\n      - --plugin-load=group_replication.so\n      - --group_replication_group_name=470b4daf-6c34-415f-97ad-68cf76ef24e7\n      - --group_replication_start_on_boot=off\n      - --group_replication_local_address=192.168.88.11:6606\n      - --group_replication_group_seeds=192.168.88.11:6606,192.168.88.12:6606,192.168.88.13:6606\n      - --group_replication_bootstrap_group=off\n      - --group_replication_recovery_get_public_key=ON\n\n  sv02:\n    image: mysql:8\n    container_name: sv02\n    hostname: sv02\n    environment:\n      MYSQL_ALLOW_EMPTY_PASSWORD: 1\n      MYSQL_DATABASE: test\n      MYSQL_PS1: \"sv02&gt; \"\n    networks:\n      mysql:\n        ipv4_address: 192.168.88.12\n    command:\n      - --server_id=2\n      - --gtid_mode=ON\n      - --enforce_gtid_consistency=ON\n      - --binlog_checksum=NONE\n      - --relay_log=relay-bin\n      - --transaction_write_set_extraction=XXHASH64\n      - --plugin-load=group_replication.so\n      - --group_replication_group_name=470b4daf-6c34-415f-97ad-68cf76ef24e7\n      - --group_replication_start_on_boot=off\n      - --group_replication_local_address=192.168.88.12:6606\n      - --group_replication_group_seeds=192.168.88.11:6606,192.168.88.12:6606,192.168.88.13:6606\n      - --group_replication_bootstrap_group=off\n      - --group_replication_recovery_get_public_key=ON\n\n  sv03:\n    image: mysql:8\n    container_name: sv03\n    hostname: sv03\n    environment:\n      MYSQL_ALLOW_EMPTY_PASSWORD: 1\n      MYSQL_DATABASE: test\n      MYSQL_PS1: \"sv03&gt; \"\n    networks:\n      mysql:\n        ipv4_address: 192.168.88.13\n    command:\n      - --server_id=3\n      - --gtid_mode=ON\n      - --enforce_gtid_consistency=ON\n      - --binlog_checksum=NONE\n      - --relay_log=relay-bin\n      - --transaction_write_set_extraction=XXHASH64\n      - --plugin-load=group_replication.so\n      - --group_replication_group_name=470b4daf-6c34-415f-97ad-68cf76ef24e7\n      - --group_replication_start_on_boot=off\n      - --group_replication_local_address=192.168.88.13:6606\n      - --group_replication_group_seeds=192.168.88.11:6606,192.168.88.12:6606,192.168.88.13:6606\n      - --group_replication_bootstrap_group=off\n      - --group_replication_recovery_get_public_key=ON\n\n  sv04:\n    image: mysql:8\n    container_name: sv04\n    hostname: sv04\n    environment:\n      MYSQL_ALLOW_EMPTY_PASSWORD: 1\n      MYSQL_DATABASE: test\n      MYSQL_PS1: \"sv04&gt; \"\n    networks:\n      mysql:\n        ipv4_address: 192.168.88.14\n    command:\n      - --server_id=4\n      - --gtid_mode=ON\n      - --enforce_gtid_consistency=ON\n      - --binlog_checksum=NONE\n      - --relay_log=relay-bin\n      - --transaction_write_set_extraction=XXHASH64\n      - --plugin-load=group_replication.so\n      - --group_replication_group_name=470b4daf-6c34-415f-97ad-68cf76ef24e7\n      - --group_replication_start_on_boot=off\n      - --group_replication_local_address=192.168.88.14:6606\n      - --group_replication_group_seeds=192.168.88.11:6606,192.168.88.12:6606,192.168.88.13:6606\n      - --group_replication_bootstrap_group=off\n      - --group_replication_recovery_get_public_key=ON\n\nnetworks:\n  mysql:\n    driver: bridge\n    ipam:\n      driver: default\n      config:\n        - subnet: 192.168.88.0/24\n</code></pre> <p>docker-compose \u3067\u958b\u59cb\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u308a\u307e\u3059\u3002</p> <pre><code>docker-compose up -d sv01 sv02 sv03\n\ndocker-compose exec sv01 mysql\ndocker-compose exec sv02 mysql\ndocker-compose exec sv03 mysql\n</code></pre>"},{"location":"mysql-mgr-copy/#_2","title":"\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\u3068\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u30ea\u30bb\u30c3\u30c8","text":"<p>\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002</p> <p><pre><code>/* [sv01/sv02/sv03] */\nshow plugins;\n</code></pre> \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u308a\u307e\u3059\u3002</p> <p><pre><code>/* [sv01/sv02/sv03] */\nCREATE USER rpl_user@'%' IDENTIFIED BY 'password';\nGRANT REPLICATION SLAVE ON *.* TO rpl_user@'%';\n</code></pre> \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30c1\u30e3\u30f3\u30cd\u30eb <code>group_replication_recovery</code> \u306b\u2191\u3067\u4f5c\u6210\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u306e\u8cc7\u683c\u60c5\u5831\u3092\u4f7f\u3046\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002</p> <p><pre><code>/* [sv01/sv02/sv03] */\nCHANGE MASTER TO MASTER_USER='rpl_user', MASTER_PASSWORD='password' FOR CHANNEL 'group_replication_recovery';\n</code></pre> docker-compose up \u3067\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304c\u521d\u671f\u5316\u3055\u308c\u305f\u6642\u70b9\u3067\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306b\u3044\u308d\u3044\u308d\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u306e\u307e\u307e\u3060\u3068\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u958b\u59cb\u3057\u305f\u3068\u304d\u306b\u7af6\u5408\u3059\u308b\u306e\u3067\u3001\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u3066\u304a\u304d\u307e\u3059\u3002</p> <p><pre><code>/* [sv01/sv02/sv03] */\nRESET MASTER;\n</code></pre> \u306a\u304a\u3001\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\u306a\u3069\u306e\u3001\u3059\u3079\u3066\u306e\u30ce\u30fc\u30c9\u3067\u500b\u5225\u306b\u5b9f\u884c\u3059\u308b\u305f\u3081\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3055\u308c\u305f\u304f\u306a\u3044\u30af\u30a8\u30ea\u306f <code>set sql_log_bin = 0|1</code> \u3068\u304b\u3067\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e <code>ON/OFF</code> \u3092\u5236\u5fa1\u3057\u3064\u3064\u30af\u30a8\u30ea\u3092\u5b9f\u884c\u3059\u308b\u306e\u304c\u666e\u901a\u306e\u3088\u3046\u3067\u3059\u3002\u305f\u3060\u3001\u521d\u56de\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3067\u306f\u300c\u3059\u3079\u3066\u306e\u30ce\u30fc\u30c9\u3067\u3044\u308d\u3044\u308d\u6e96\u5099\u2192RESET MASTER\u2192\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u958b\u59cb\u300d\u306e\u65b9\u304c\u308f\u304b\u308a\u307f\u304c\u3042\u308b\u304d\u304c\u3059\u308b\u306e\u3067\u3001\u3044\u3064\u3082\u305d\u3046\u3057\u3066\u307e\u3059\u3002</p>"},{"location":"mysql-mgr-copy/#_3","title":"\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u958b\u59cb","text":"<p>\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u3066\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\u3053\u306e\u4f5c\u696d\u306f\u6700\u521d\u306e\uff11\u53f0\u3060\u3051\u3067\u884c\u3044\u307e\u3059\u3002</p> <p><pre><code>/* [sv01] */\nSET GLOBAL group_replication_bootstrap_group=ON;\nSTART GROUP_REPLICATION;\nSET GLOBAL group_replication_bootstrap_group=OFF;\n</code></pre> \u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u30fc\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u3053\u306e\u6642\u70b9\u3067\u306f sv01 \u306e\uff11\u53f0\u3057\u304b\u3042\u308a\u307e\u305b\u3093\u3002</p> <p><pre><code>/* [sv01] */\nSELECT MEMBER_HOST, MEMBER_PORT, MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+-------------+-------------+--------------+-------------+\n| MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE |\n+-------------+-------------+--------------+-------------+\n| sv01        |        3306 | ONLINE       | PRIMARY     |\n+-------------+-------------+--------------+-------------+\n</code></pre> \u6b8b\u308a\u306e\u30ce\u30fc\u30c9\u3067\u3082\u958b\u59cb\u3057\u307e\u3059\u3002\u3053\u306e\u3068\u304d <code>group_replication_bootstrap_group=ON</code> \u3092\u6307\u5b9a\u3057\u307e\u305b\u3093\u3002\u6307\u5b9a\u3059\u308b\u3068\u540c\u3058\u540d\u524d\u306e\u5225\u306e\u30b0\u30eb\u30fc\u30d7\u304c\u4f5c\u6210\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002</p> <p><pre><code>/* [sv02/sv03] */\nSTART GROUP_REPLICATION;\n</code></pre> \u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u30fc\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u3046\u307e\u304f\u30b0\u30eb\u30fc\u30d7\u306b\u53c2\u52a0\u3067\u304d\u308c\u3044\u308c\u3070\u3069\u306e\u30ce\u30fc\u30c9\u3067\u5b9f\u884c\u3057\u3066\u3082\u540c\u3058\u7d50\u679c\u304c\u8fd4\u308a\u307e\u3059\u3002\u6700\u521d\u306e\u30ce\u30fc\u30c9\u3067\u3042\u308b sv01 \u304c\u30d7\u30e9\u30a4\u30de\u30ea\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002</p> <p><pre><code>/* [sv01/sv02/sv03] */\nSELECT MEMBER_HOST, MEMBER_PORT, MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+-------------+-------------+--------------+-------------+\n| MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE |\n+-------------+-------------+--------------+-------------+\n| sv01        |        3306 | ONLINE       | PRIMARY     |\n| sv03        |        3306 | ONLINE       | SECONDARY   |\n| sv02        |        3306 | ONLINE       | SECONDARY   |\n+-------------+-------------+--------------+-------------+\n</code></pre> sv01 \u3067\u9069\u5f53\u306b\u30c7\u30fc\u30bf\u3092\u5165\u308c\u3066\u307f\u307e\u3059\u3002</p> <p><pre><code>/* [sv01] */\nUSE test;\nCREATE TABLE t1 (c1 INT PRIMARY KEY, c2 TEXT NOT NULL);\nINSERT INTO t1 VALUES (1, 'Luis');\n</code></pre> \u4ed6\u306e\u30ce\u30fc\u30c9\u306b\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3055\u308c\u3066\u3044\u307e\u3059\u3002</p> <p><pre><code>/* [sv02/sv03] */\nUSE test;\nselect * from t1;\n</code></pre> \u30d7\u30e9\u30a4\u30de\u30ea\u4ee5\u5916\u306e\u30ce\u30fc\u30c9\u306f\u8aad\u307f\u8fbc\u307f\u5c02\u7528\u306b\u306a\u3063\u3066\u308b\u306e\u3067\u66f4\u65b0\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306f\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002</p> <pre><code>/* [sv02/sv03] */\nINSERT INTO t1 VALUES (2, 'xx');\n/* ERROR 1290 (HY000): The MySQL server is running with the --super-read-only option so it cannot execute this statement */\n</code></pre>"},{"location":"mysql-mgr-copy/#_4","title":"\u30b0\u30eb\u30fc\u30d7\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8ffd\u52a0","text":"<p>\u65b0\u3057\u304f\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002</p> <p><pre><code>docker-compose up -d sv04\ndocker-compose logs -f sv04\ndocker-compose exec sv04 mysql\n</code></pre> \u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002</p> <p><pre><code>/* [sv04] */\nshow plugins;\n</code></pre> \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u3063\u3066\u3001\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u3066\u3001\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u958b\u59cb\u3057\u307e\u3059\u3002</p> <p><pre><code>/* [sv04] */\n/* \u30e6\u30fc\u30b6\u30fc\u4f5c\u6210 */\nCREATE USER rpl_user@'%' IDENTIFIED BY 'password';\nGRANT REPLICATION SLAVE ON *.* TO rpl_user@'%';\n/* \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30c1\u30e3\u30f3\u30cd\u30eb\u306b\u8cc7\u683c\u60c5\u5831\u3092\u8a2d\u5b9a */\nCHANGE MASTER TO MASTER_USER='rpl_user', MASTER_PASSWORD='password' FOR CHANNEL 'group_replication_recovery';\n/* \u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u3092\u30ea\u30bb\u30c3\u30c8 */\nRESET MASTER;\n/* \u30b0\u30eb\u30fc\u30d7\u3092\u958b\u59cb */\nSTART GROUP_REPLICATION;\n</code></pre> \u65b0\u3057\u3044\u30ce\u30fc\u30c9\u304c\u8ffd\u52a0\u3055\u308c\u308b\u3068\u30e9\u30f3\u30c0\u30e0\u306b\u9078\u3070\u308c\u305f\u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u30fc\uff08\u30c9\u30ca\u30fc\uff09\u304b\u3089\u30c7\u30fc\u30bf\u306e\u540c\u671f\u304c\u884c\u308f\u308c\uff08\u30ea\u30ab\u30d0\u30ea\u30d7\u30ed\u30bb\u30b9\uff09\u3001\u540c\u671f\u304c\u5b8c\u4e86\u3059\u308b\u3068\u30aa\u30f3\u30e9\u30a4\u30f3\u306e\u30e1\u30f3\u30d0\u30fc\u3068\u3057\u3066\u4f7f\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002</p> <pre><code>/* [sv04] */\n/* \u30e1\u30f3\u30d0\u30fc\u306e\u4e00\u89a7\u8868\u793a */\nSELECT MEMBER_HOST, MEMBER_PORT, MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n/* \u30c7\u30fc\u30bf\u306e\u78ba\u8a8d */\nUSE test;\nselect * from t1;\n</code></pre>"},{"location":"mysql-mgr-copy/#_5","title":"\u904b\u7528\u4e2d\u306e\u30b0\u30eb\u30fc\u30d7\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8ffd\u52a0","text":"<p>\u30ea\u30ab\u30d0\u30ea\u30d7\u30ed\u30bb\u30b9\u306f MySQL \u306e\u901a\u5e38\u306e\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u5229\u7528\u3057\u3066\u884c\u308f\u308c\u307e\u3059\u3002\u306a\u306e\u3067\u5fc5\u8981\u306a\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u304c\u30b0\u30eb\u30fc\u30d7\u306e\u3059\u3079\u3066\u306e\u30e1\u30f3\u30d0\u30fc\u3067\u65e2\u306b\u30d1\u30fc\u30b8\u3055\u308c\u3066\u3044\u308b\u3068\u30ea\u30ab\u30d0\u30ea\u30d7\u30ed\u30bb\u30b9\u306f\u5931\u6557\u3057\u307e\u3059\u3002</p> <p>\u30b0\u30eb\u30fc\u30d7\u306e\u3059\u3079\u3066\u306e\u30e1\u30f3\u30d0\u304b\u3089\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u3092\u30d1\u30fc\u30b8\u3057\u307e\u3059\u3002</p> <p><pre><code>/* [sv01/sv02/sv03] */\nflush logs;\npurge binary logs before now();\nshow binlog events;\n</code></pre> \u65b0\u3057\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u958b\u59cb\u3057\u3066\u3001</p> <p><pre><code>docker-compose rm -fsv sv04\ndocker-compose up -d sv04\ndocker-compose logs -f sv04\ndocker-compose exec sv04 mysql\n/* [sv04] */\nCREATE USER rpl_user@'%' IDENTIFIED BY 'password';\nGRANT REPLICATION SLAVE ON *.* TO rpl_user@'%';\nCHANGE MASTER TO MASTER_USER='rpl_user', MASTER_PASSWORD='password' FOR CHANNEL 'group_replication_recovery';\nRESET MASTER;\nSTART GROUP_REPLICATION;\n</code></pre> \u30ed\u30b0\u306b\u6b21\u306e\u3088\u3046\u306a\u3082\u306e\u304c\u305f\u304f\u3055\u3093\u51fa\u529b\u3055\u308c\u307e\u3059\u3002</p> <p><pre><code>[ERROR] [MY-010557] [Repl] Error reading packet from server for channel 'group_replication_recovery': Cannot replicate because the master purged required binary logs. Replicate the missing transactions from elsewhere, or provision a new slave from backup. Consider increasing the master's binary log expiration period. To find the missing transactions, see the master's error log or the manual for GTID_SUBTRACT. (server_errno=1236)\n[ERROR] [MY-013114] [Repl] Slave I/O for channel 'group_replication_recovery': Got fatal error 1236 from master when reading data from binary log: 'Cannot replicate because the master purged required binary logs. Replicate the missing transactions from elsewhere, or provision a new slave from backup. Consider increasing the master's binary log expiration period. To find the missing transactions, see the master's error log or the manual for GTID_SUBTRACT.', Error_code: MY-013114\n</code></pre> \u30e1\u30f3\u30d0\u30fc\u306e\u30ea\u30b9\u30c8\u3092\u898b\u3066\u307f\u308b\u3068\u3001\u8ffd\u52a0\u306f\u3055\u308c\u3066\u3044\u307e\u3059\u304c MEMBER_STATE \u304c RECOVERING \u306e\u307e\u307e\u3067\u3059\u3002</p> <p><pre><code>/* [sv04] */\nSELECT MEMBER_HOST, MEMBER_PORT, MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+-------------+-------------+--------------+-------------+\n| MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE |\n+-------------+-------------+--------------+-------------+\n| sv04        |        3306 | RECOVERING   | SECONDARY   |\n| sv01        |        3306 | ONLINE       | PRIMARY     |\n| sv03        |        3306 | ONLINE       | SECONDARY   |\n| sv02        |        3306 | ONLINE       | SECONDARY   |\n+-------------+-------------+--------------+-------------+\n</code></pre> \u3057\u3070\u3089\u304f\u3068 MEMBER_STATE \u306f ERROR \u306b\u306a\u308a\u307e\u3059\u3002</p> <p><pre><code>/* [sv04] */\nSELECT MEMBER_HOST, MEMBER_PORT, MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+-------------+-------------+--------------+-------------+\n| MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE |\n+-------------+-------------+--------------+-------------+\n| sv04        |        3306 | ERROR        |             |\n+-------------+-------------+--------------+-------------+\n</code></pre> \u4ed6\u306e\u30e1\u30f3\u30d0\u30fc\u304b\u3089\u306f\u898b\u3048\u306a\u304f\u306a\u308a\u307e\u3059\u3002</p> <p><pre><code>/* [sv01] */\nSELECT MEMBER_HOST, MEMBER_PORT, MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+-------------+-------------+--------------+-------------+\n| MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE |\n+-------------+-------------+--------------+-------------+\n| sv01        |        3306 | ONLINE       | PRIMARY     |\n| sv03        |        3306 | ONLINE       | SECONDARY   |\n| sv02        |        3306 | ONLINE       | SECONDARY   |\n+-------------+-------------+--------------+-------------+\n</code></pre> \u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u958b\u59cb\u3057\u305f\u76f4\u5f8c\u306e\u3001\u3059\u3079\u3066\u306e\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u304c\u307e\u3060\u6b8b\u3063\u3066\u3044\u308b\u72b6\u614b\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8ffd\u52a0\u3059\u308b\u3088\u3046\u306a\u3068\u304d\u306f\u5225\u3068\u3057\u3066\u3001\u904b\u7528\u4e2d\u306e\u30b0\u30eb\u30fc\u30d7\u306b\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3068\u304d\u306f\u8ffd\u52a0\u524d\u306b mysqldump \u7684\u306a\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\u3002</p> <p>\u516c\u5f0f\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3060\u3068 MySQL Enterprise Backup \u3092\u4f7f\u7528\u3059\u308b\u4f8b\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u304c\u3001mysqldump \u3067\u3082\u826f\u3044\u3068\u601d\u3046\u3057\u3001\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e rsync\uff08auto.cnf \u306b\u6ce8\u610f\uff09\u3067\u3082\u5927\u4e08\u592b\u3060\u3068\u601d\u3044\u307e\u3059\u3002</p> <p>\u8a66\u3057\u306b mysqldump \u3057\u3066\u307f\u307e\u3059\u3002</p> mysqldump <pre><code># \u65b0\u3057\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u958b\u59cb\ndocker-compose rm -fsv sv04\ndocker-compose up -d sv04\ndocker-compose logs -f sv04\n\n# \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\u3084\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u30ea\u30bb\u30c3\u30c8\ndocker-compose exec -T sv04 mysql &lt;&lt;'SQL'\n  CREATE USER rpl_user@'%' IDENTIFIED BY 'password';\n  GRANT REPLICATION SLAVE ON *.* TO rpl_user@'%';\n  CHANGE MASTER TO MASTER_USER='rpl_user', MASTER_PASSWORD='password' FOR CHANNEL 'group_replication_recovery';\n  RESET MASTER;\nSQL\n\n# \u5225\u306e\u30ce\u30fc\u30c9\u304b\u3089\u30c0\u30f3\u30d7\u3057\u3066\u65b0\u3057\u3044\u30ce\u30fc\u30c9\u306b\u30a4\u30f3\u30dd\u30fc\u30c8\ndocker-compose exec -T sv03 mysqldump \\\n    --all-databases --single-transaction --triggers --routines --events |\n  docker-compose exec -T sv04 mysql\n\n# \u30b3\u30f3\u30c6\u30ca\u306b\u5165\u308b docker-compose exec sv04 mysql\n</code></pre> <p><code>show master status</code> \u306e <code>Executed_Gtid_Set</code> \u304c\u4ed6\u306e\u30ce\u30fc\u30c9\u3068\u540c\u3058\u306b\u306a\u3063\u3066\u3044\u308c\u3070\u5927\u4e08\u592b\u3067\u3059\u3002</p> <p><pre><code>/* [sv04] */\nshow master status;\n+---------------+----------+--------------+------------------+------------------------------------------+\n| File          | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set                        |\n+---------------+----------+--------------+------------------+------------------------------------------+\n| binlog.000001 |      151 |              |                  | 470b4daf-6c34-415f-97ad-68cf76ef24e7:1-6 |\n+---------------+----------+--------------+------------------+------------------------------------------+\n</code></pre> \u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u958b\u59cb\u3067\u304d\u307e\u3059\u3002</p> <pre><code>/* [sv04] */\nSTART GROUP_REPLICATION;\nSELECT MEMBER_HOST, MEMBER_PORT, MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+-------------+-------------+--------------+-------------+\n| MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE |\n+-------------+-------------+--------------+-------------+\n| sv04        |        3306 | ONLINE       | SECONDARY   |\n| sv01        |        3306 | ONLINE       | PRIMARY     |\n| sv03        |        3306 | ONLINE       | SECONDARY   |\n| sv02        |        3306 | ONLINE       | SECONDARY   |\n+-------------+-------------+--------------+-------------+\n</code></pre>"},{"location":"mysql-mgr-copy/#ip","title":"IP\u30a2\u30c9\u30ec\u30b9\u306e\u30db\u30ef\u30a4\u30c8\u30ea\u30b9\u30c8","text":"<p>MySQL \u306e\u8a2d\u5b9a\u3067 group_replication_group_seeds \u306b\u30b0\u30eb\u30fc\u30d7\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30a2\u30c9\u30ec\u30b9\u3092\u7f85\u5217\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u5225\u306b\u30b0\u30eb\u30fc\u30d7\u306e\u3059\u3079\u3066\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u7f85\u5217\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002</p> <p>\u3053\u306e\u8a2d\u5b9a\u306f\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u958b\u59cb\u3057\u305f\u3068\u304d\u306b\u3001\u3069\u3053\u304b\u3089\u30b0\u30eb\u30fc\u30d7\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u304b\u306e\u8a2d\u5b9a\u3067\u3059\u3002\u306a\u306e\u3067\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u751f\u304d\u3066\u3044\u308b\u30e1\u30f3\u30d0\u30fc\u306e\u3044\u305a\u308c\u304b\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308c\u3070\u5927\u4e08\u592b\u3067\u3059\u3002\u306a\u306e\u3067\u3001\u30b0\u30eb\u30fc\u30d7\u3078\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8ffd\u52a0\u306f group_replication_group_seeds \u3092\u3044\u3058\u3089\u306a\u304f\u3066\u3082\u3067\u304d\u307e\u3059\u3002</p> <p>\u4e00\u65b9\u3001\u30b0\u30eb\u30fc\u30d7\u306b\u53c2\u52a0\u3067\u304d\u308b\u30a2\u30c9\u30ec\u30b9\u306e\u30db\u30ef\u30a4\u30c8\u30ea\u30b9\u30c8\u306e\u8a2d\u5b9a\u3082\u3042\u3063\u3066\uff08group_replication_ip_whitelist\uff09\u3001\u305d\u3053\u306b\u542b\u307e\u308c\u306a\u3044\u30a2\u30c9\u30ec\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f\u30b0\u30eb\u30fc\u30d7\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u306e\u901a\u4fe1\u304c\u62d2\u5426\u3055\u308c\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30b5\u30fc\u30d0\u306e I/F \u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u304c\u8ffd\u52a0\u3055\u308c\u308b\u306e\u3067\u3001\u8907\u6570\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5206\u6563\u3055\u308c\u308b\u3068\u304b\u3067\u306f\u306a\u3044\u9650\u308a\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u307e\u307e\u3067\u826f\u3055\u305d\u3046\u3067\u3059\u3002</p>"},{"location":"mysql-mgr-copy/#_6","title":"\u30ce\u30fc\u30c9\u306e\u6545\u969c","text":"<p>\u304a\u3082\u3080\u308d\u306b\u30d7\u30e9\u30a4\u30de\u30ea\u30ce\u30fc\u30c9\u3092\u5f37\u5236\u7d42\u4e86\u3057\u307e\u3059\u3002</p> <p><pre><code>docker-compose kill -s KILL sv01\n</code></pre> \u4ed6\u306e\u30ce\u30fc\u30c9\uff08sv02 \u3068\u304b\uff09\u3067\u6b21\u306e\u3088\u3046\u306b\u30ed\u30b0\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002</p> <p><pre><code>[Warning] [MY-011493] [Repl] Plugin group_replication reported: 'Member with address sv01:3306 has become unreachable.'\n[Warning] [MY-011499] [Repl] Plugin group_replication reported: 'Members removed from the group: sv01:3306'\n</code></pre> \u30e1\u30f3\u30d0\u306e\u4e00\u89a7\u3092\u89b3\u3066\u307f\u308b\u3068\u3001sv01 \u304c\u306a\u304f\u306a\u3063\u3066 sv04 \u304c\u30d7\u30e9\u30a4\u30de\u30ea\u306b\u306a\u3063\u3066\u307e\u3057\u305f\u3002</p> <pre><code>/* [sv02] */\nSELECT * FROM performance_schema.replication_group_members;\n/*------------+-------------+--------------+-------------+\n| MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE |\n+-------------+-------------+--------------+-------------+\n| sv04        |        3306 | ONLINE       | PRIMARY     |\n| sv03        |        3306 | ONLINE       | SECONDARY   |\n| sv02        |        3306 | ONLINE       | SECONDARY   |\n+-------------+-------------+--------------+------------*/\n</code></pre>"},{"location":"mysql-mgr-copy/#monitoring-group-replication","title":"Monitoring Group Replication","text":"<p>\u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u3084\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a73\u7d30\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30b9\u30ad\u30fc\u30de\u304b\u3089\u5f97\u3089\u308c\u307e\u3059\u3002</p> <pre><code>/* \u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u306b\u95a2\u3059\u308b\u60c5\u5831 */\nselect * from performance_schema.replication_group_member_stats \\G\nselect * from performance_schema.replication_group_members;\n/* \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30c1\u30e3\u30f3\u30cd\u30eb\u306b\u95a2\u3059\u308b\u60c5\u5831 */\nselect * from performance_schema.replication_connection_status \\G\nselect * from performance_schema.replication_applier_status;\n</code></pre>"},{"location":"mysql-mgr-copy/#2","title":"\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30c1\u30e3\u30f3\u30cd\u30eb\u306b\u306f\u6b21\u306e\u7528\u9014\u306e2\u3064\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002","text":"<ul> <li>group_replication_recovery<ul> <li>\u5206\u6563\u30ea\u30ab\u30d0\u30ea\u30d5\u30a7\u30fc\u30ba\uff08\u30ea\u30ab\u30d0\u30ea\u30d7\u30ed\u30bb\u30b9\uff09\u3067\u4f7f\u7528\u3055\u308c\u308b</li> <li>\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3057\u305f\u3068\u304d\u3084\u6545\u969c\u30ce\u30fc\u30c9\u304c\u5fa9\u5e30\u3057\u305f\u3068\u304d\u306e\u540c\u671f\u7528</li> </ul> </li> <li>group_replication_applier<ul> <li>\u30b0\u30eb\u30fc\u30d7\u3067\u5b9f\u884c\u3055\u308c\u305f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u9069\u7528\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3055\u308c\u308b</li> <li>\u8981\u3059\u308b\u306b\u5e73\u6642\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3</li> </ul> </li> </ul>"},{"location":"mysql-mgr-copy/#_7","title":"\u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u306b\u95a2\u3059\u308b\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30c6\u30fc\u30d6\u30eb\u306e\u30d3\u30e5\u30fc\u306b\u3064\u3044\u3066\u3002","text":"<ul> <li>replication_group_member_stats<ul> <li>\u30e1\u30f3\u30d0\u30fc\u3054\u3068\u306e\u5f85\u6a5f\u4e2d\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u6570\u3068\u304b\u51e6\u7406\u6e08\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u6570\u3068\u304b\u306e\u7d71\u8a08</li> <li>\u7279\u5b9a\u306e\u30e1\u30f3\u30d0\u30fc\u304c\u9045\u308c\u3066\u3044\u308b\u3068\u304b\u3067\u30ad\u30e5\u30fc\u306b\u6e9c\u307e\u3063\u3066\u308b\u306e\u3092\u76e3\u8996\u3057\u305f\u308a\u3059\u308b\u306e\u306b\u4f7f\u3048\u308b</li> </ul> </li> <li>replication_group_members<ul> <li>\u30e1\u30f3\u30d0\u30fc\u306e\u30b9\u30c6\u30fc\u30bf\u30b9</li> </ul> </li> </ul>"},{"location":"mysql-mgr-copy/#replication_group_members","title":"<code>replication_group_members</code> \u3067\u8868\u793a\u3055\u308c\u308b\u30e1\u30f3\u30d0\u30fc\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3002","text":"<ul> <li>ONLINE<ul> <li>\u540c\u671f\u3055\u308c\u3066\u3044\u308b</li> </ul> </li> <li>RECOVERING<ul> <li>\u30ea\u30ab\u30d0\u30ea\u30d7\u30ed\u30bb\u30b9\u4e2d</li> </ul> </li> <li>OFFLINE<ul> <li>\u30e1\u30f3\u30d0\u30fc\u306f\u30b0\u30eb\u30fc\u30d7\u306b\u5c5e\u3057\u3066\u3044\u306a\u3044</li> <li>\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u30ed\u30fc\u30c9\u6e08\u3067\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u958b\u59cb\u3057\u3066\u3044\u306a\u3044\u3068\u304d</li> </ul> </li> <li>ERROR<ul> <li>\u30ea\u30ab\u30d0\u30ea\u30d7\u30ed\u30bb\u30b9\u3084\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u9069\u7528\u4e2d\u306b\u30a8\u30e9\u30fc</li> </ul> </li> <li>UNREACHABLE<ul> <li>\u30e1\u30f3\u30d0\u30fc\u304c\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7684\u306b\u5230\u9054\u4e0d\u80fd</li> </ul> </li> </ul> <p>\u30b5\u30fc\u30d3\u30b9\u76e3\u8996\u3068\u304b\u3059\u308b\u306a\u3089 <code>ONLINE</code> \u4ee5\u5916\u306f\u306a\u306b\u304b\u3057\u3089\u7570\u5e38\u3068\u307f\u306a\u3057\u3066\u826f\u3055\u305d\u3046\u3067\u3059\u3002</p>"},{"location":"mysql-mgr-copy/#deploying-in-multi-primary-or-single-primary-mode","title":"Deploying in Multi-Primary or Single-Primary Mode","text":"<p>\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u306f\u30b7\u30f3\u30b0\u30eb\u30d7\u30e9\u30a4\u30de\u30ea\u30e2\u30fc\u30c9\u3068\u30de\u30eb\u30c1\u30d7\u30e9\u30a4\u30de\u30ea\u30e2\u30fc\u30c9\u304c\u3042\u308a\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306f\u30b7\u30f3\u30b0\u30eb\u30d7\u30e9\u30a4\u30de\u30ea\u3067\u3059\u3002</p> <p>\u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u30fc\u306e\u4e2d\u3067\u30b7\u30f3\u30b0\u30eb\u3068\u30de\u30eb\u30c1\u306f\u6df7\u5728\u3067\u304d\u307e\u305b\u3093\u3002\u5207\u308a\u66ff\u3048\u308b\u305f\u3081\u306b\u306f\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u81ea\u4f53\u3092\u518d\u69cb\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u30de\u30eb\u30c1\u30d7\u30e9\u30a4\u30de\u30ea\u30e2\u30fc\u30c9\u306b\u3059\u308b\u3068\u3001\u6b21\u306e\u3088\u3046\u306a\u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u306e\u30c1\u30a7\u30c3\u30af\u304c\u884c\u308f\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002</p> <ul> <li>\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c SERIALIZABLE \u5206\u96e2\u30ec\u30d9\u30eb\u3067\u5b9f\u884c\u3055\u308c\u308b\u3068\u30b3\u30df\u30c3\u30c8\u304c\u5931\u6557\u3059\u308b</li> <li>CASCADE \u306e\u5916\u90e8\u30ad\u30fc\u3092\u6301\u3064\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3059\u308b\u3068\u30b3\u30df\u30c3\u30c8\u306b\u5931\u6557\u3059\u308b</li> </ul> <p>\u3053\u308c\u3089\u306e\u30c1\u30a7\u30c3\u30af\u306f <code>group_replication_enforce_update_everywhere_checks</code> \u3092 <code>FALSE</code> \u306b\u3059\u308b\u3068\u7121\u52b9\u306b\u3067\u304d\u307e\u3059\u3002\u3082\u3061\u308d\u3093\u7121\u52b9\u306b\u3059\u308b\u3068\u30ce\u30fc\u30c9\u9593\u3067\u30c7\u30fc\u30bf\u4e0d\u6574\u5408\u304c\u8d77\u3053\u308b\u53ef\u80fd\u6027\u304c\u751f\u3058\u308b\u3068\u601d\u3044\u307e\u3059\u3002</p>"},{"location":"mysql-mgr-copy/#single-primary-mode","title":"Single-Primary Mode","text":"<p>\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30b7\u30f3\u30b0\u30eb\u30d7\u30e9\u30a4\u30de\u30ea\u30e2\u30fc\u30c9\u3067\u306f\u3001\u30b0\u30eb\u30fc\u30d7\u306e\u305f\u3060\u4e00\u3064\u306e\u30e1\u30f3\u30d0\u30fc\u3060\u3051\u304c\u30d7\u30e9\u30a4\u30de\u30ea\u3067\u3001\u305d\u308c\u4ee5\u5916\u306f super-read-only=ON \u304c\u8a2d\u5b9a\u3055\u308c\u3066\u8aad\u307f\u53d6\u308a\u5c02\u7528\u306b\u306a\u308a\u307e\u3059\u3002</p> <p>\u30d7\u30e9\u30a4\u30de\u30ea\u304c\u30b3\u30b1\u305f\u3068\u304d\u306b\u65b0\u3057\u3044\u30d7\u30e9\u30a4\u30de\u30ea\u306e\u9078\u51fa\u306f group_replication_member_weight \u3067\u91cd\u307f\u3064\u3051\u3067\u304d\u307e\u3059\u3002\u305f\u3060\u3057\u30b0\u30eb\u30fc\u30d7\u5185\u3067 MySQL \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u5dee\u7570\u304c\u3042\u308b\u3068\u4e0b\u4f4d\u30e1\u30b8\u30e3\u30fc\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u3082\u306e\u304b\u3089\u512a\u5148\u7684\u306b\u9078\u629e\u3055\u308c\u307e\u3059\u3002</p> <p>\u30d7\u30e9\u30a4\u30de\u30ea\u304c\u30b3\u30b1\u305f\u5f8c\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u518d\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3059\u308b\u524d\u306b\u3001\u65b0\u3057\u3044\u30d7\u30e9\u30a4\u30de\u30ea\u304c\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u95a2\u4fc2\u3059\u308b\u30ea\u30ec\u30fc\u30ed\u30b0\u3092\u9069\u5fdc\u3057\u304d\u308b\u306e\u3092\u5f85\u3063\u305f\u307b\u3046\u304c\u826f\u3044\u3067\u3059\u3002\u3053\u308c\u306f\u666e\u901a\u306e\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u3082\u540c\u3058\u3067\u3001\u30ea\u30ec\u30fc\u30ed\u30b0\u304c\u9069\u5fdc\u3057\u5207\u308b\u524d\u306b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u65b0\u3057\u3044\u30d7\u30e9\u30a4\u30de\u30ea\u306b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3059\u308b\u3068\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u306e\u66f4\u65b0\u3068\u30ea\u30ec\u30fc\u30ed\u30b0\u306b\u3088\u308b\u66f4\u65b0\u304c\u7af6\u5408\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u30d7\u30e9\u30a4\u30de\u30ea\u3068\u306a\u3063\u3066\u3044\u308b\u30e1\u30f3\u30d0\u30fc\u306e\u691c\u7d22\u306f performance_schema.replication_group_members \u30c6\u30fc\u30d6\u30eb\u306e MEMBER_ROLE \u3092\u898b\u308c\u3070\u308f\u304b\u308a\u307e\u3059\u3002</p>"},{"location":"mysql-mgr-copy/#tuning-recovery","title":"Tuning Recovery","text":"<p>\u65b0\u898f\u30ce\u30fc\u30c9\u306e\u8ffd\u52a0\u3084\u6545\u969c\u30ce\u30fc\u30c9\u304c\u5fa9\u5e30\u3059\u308b\u3068\u304d\u3001\u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u304b\u3089\u30e9\u30f3\u30c0\u30e0\u3067\uff11\u3064\u304c\u9078\u3070\u308c\u3066\u3001\u305d\u306e\u30ce\u30fc\u30c9\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u3002\u3053\u306e\u51e6\u7406\u306f\u30ea\u30ab\u30d0\u30ea\u30d7\u30ed\u30bb\u30b9\u3068\u547c\u3070\u308c\u3066\u3001\u9078\u3070\u308c\u305f\u30ce\u30fc\u30c9\u306f\u30c9\u30ca\u30fc\u3068\u547c\u3070\u308c\u308b\u3002</p> <p>\u30c9\u30ca\u30fc\u3078\u306e\u63a5\u7d9a\u304c\u5931\u6557\u3057\u305f\u3068\u304d\u306f\u81ea\u52d5\u7684\u306b\u5225\u306e\u30c9\u30ca\u30fc\u304c\u9078\u629e\u3055\u308c\u3066\u63a5\u7d9a\u304c\u518d\u8a66\u884c\u3055\u308c\u308b\u3002\u63a5\u7d9a\u306e\u30ea\u30c8\u30e9\u30a4\u306e\u9650\u754c\u306b\u9054\u3059\u308b\u3068\u30ea\u30ab\u30d0\u30ea\u30d7\u30ed\u30bb\u30b9\u306f\u30a8\u30e9\u30fc\u3067\u7d42\u4e86\u3059\u308b\u3002</p> <p>\u30ea\u30ab\u30d0\u30ea\u30d7\u30ed\u30bb\u30b9\u3067\u306f\u5358\u306a\u308b\u63a5\u7d9a\u30a8\u30e9\u30fc\u3060\u3051\u3067\u306f\u306a\u304f\u3001\u3044\u308d\u3044\u308d\u306a\u30a8\u30e9\u30fc\u3092\u691c\u51fa\u3057\u3066\u5225\u306e\u30c9\u30ca\u30fc\u3067\u518d\u8a66\u884c\u304c\u884c\u308f\u308c\u308b\u3002</p> <ul> <li>\u30d1\u30fc\u30b8\u3055\u308c\u305f\u30c7\u30fc\u30bf<ul> <li>\u30c9\u30ca\u30fc\u3067\u30ea\u30ab\u30d0\u30ea\u306b\u5fc5\u8981\u306a\u30c7\u30fc\u30bf\u304c\u65e2\u306b\u30d1\u30fc\u30b8\u3055\u308c\u3066\u3044\u308b</li> </ul> </li> <li>\u91cd\u8907\u30c7\u30fc\u30bf<ul> <li>\u65b0\u3057\u3044\u30ce\u30fc\u30c9\u304c\u65e2\u306b\u6301\u3063\u3066\u3044\u308b\u30c7\u30fc\u30bf\u3068\u3001\u30c9\u30ca\u304b\u3089\u540c\u671f\u3055\u308c\u308b\u30c7\u30fc\u30bf\u3068\u304c\u7af6\u5408\u3057\u305f\u3068\u304d</li> <li>\u4ed6\u306e\u30c9\u30ca\u30fc\u306b\u306f\u5207\u308a\u66ff\u3048\u305a\u306b\u30a8\u30e9\u30fc\u306b\u3059\u308b\u3053\u3068\u3082\u8003\u3048\u3089\u308c\u308b\u3051\u3069\u3001\u4e0d\u5747\u8cea\u306a\u30b0\u30eb\u30fc\u30d7\u3067\u306f\u3042\u308b\u30e1\u30f3\u30d0\u30fc\u306f\u7af6\u5408\u3059\u308b\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u6301\u3063\u3066\u3044\u3066\u3001\u3042\u308b\u30e1\u30f3\u30d0\u30fc\u306f\u7af6\u5408\u3059\u308b\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u6301\u3063\u3066\u3044\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308b\u305f\u3081\u3001\u3053\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u3068\u304d\u3082\u4ed6\u306e\u30c9\u30ca\u30fc\u3067\u518d\u8a66\u884c\u3055\u308c\u307e\u3059</li> </ul> </li> <li>\u305d\u306e\u4ed6\u306e\u30a8\u30e9\u30fc<ul> <li>\u30ea\u30ab\u30d0\u30ea\u30b9\u30ec\u30c3\u30c9\u304c\u30b3\u30b1\u305f\u3068\u304d\u30fb\u30fb\u3048\u30fc\u3068\u307e\u3042\u306a\u3093\u304b\u30a8\u30e9\u30fc\uff1f\u3067\u3059</li> </ul> </li> </ul> <p>\u30ea\u30ab\u30d0\u30ea\u30d7\u30ed\u30bb\u30b9\u306f\u666e\u901a\u306eMySQL\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u5b9f\u88c5\u306b\u4f9d\u5b58\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u3053\u3053\u3067\u8aac\u660e\u3057\u305f\u518d\u8a66\u884c\u3068\u306f\u5225\u306b\u3001\u666e\u901a\u306eMySQL\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u3057\u3066\u306e\u518d\u8a66\u884c\u3082\u884c\u308f\u308c\u308b\u3053\u3068\u304c\u3042\u308b\u3002</p> <p>\u30ea\u30ab\u30d0\u30ea\u306e\u518d\u8a66\u884c\u56de\u6570\u306f group_replication_recovery_retry_count \u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u8a2d\u5b9a\u3067\u304d\u308b\u3002</p> <p>group_replication_recovery_reconnect_interval \u3067\u518d\u8a66\u884c\u306e\u30a4\u30f3\u30bf\u30fc\u30d0\u30eb\u3092\u8a2d\u5b9a\u3067\u304d\u308b\u3002\u518d\u8a66\u884c\u306e\u90fd\u5ea6\u3001\u6bce\u56de\u30a4\u30f3\u30bf\u30fc\u30d0\u30eb\u304c\u631f\u307e\u308c\u308b\u308f\u3051\u3067\u306f\u306a\u304f\u3001\u3059\u3079\u3066\u306e\u30c9\u30ca\u30fc\u3067\u4e00\u901a\u308a\u5931\u6557\u3057\u305f\u3068\u304d\u3060\u3051\u30a4\u30f3\u30bf\u30fc\u30d0\u30eb\u304c\u631f\u307e\u308c\u3066\u6b21\u306e\u30c9\u30ca\u30fc\uff08\u4e00\u5ea6\u5931\u6557\u3057\u3066\u3044\u308b\uff09\u3067\u518d\u8a66\u884c\u3055\u308c\u308b\u3002</p>"},{"location":"mysql-mgr-copy/#network-partitioning","title":"Network Partitioning","text":"<p>\u30af\u30aa\u30e9\u30e0\u306e\u305f\u3081\u306b\u30b0\u30eb\u30fc\u30d7\u306e\u904e\u534a\u6570\u304c\u751f\u304d\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\u305f\u3060\u3057\u30b5\u30fc\u30d0\u304c\u30b0\u30eb\u30fc\u30d7\u304b\u3089\u81ea\u767a\u7684\u306b\u53bb\u3063\u305f\u3068\u304d\u306f\u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u306b\u53bb\u308b\u3053\u3068\u304c\u4f1d\u3048\u3089\u308c\u308b\u306e\u3067\u3001\u305d\u306e\u6642\u70b9\u3067\u30b0\u30eb\u30fc\u30d7\u304c\u518d\u69cb\u6210\u3055\u308c\u308b\u306e\u3067\u30af\u30aa\u30e9\u30e0\u6570\u3082\u518d\u8a08\u7b97\u3055\u308c\u308b\u3002</p> <p>\u30af\u30aa\u30e9\u30e0\u4f4e\u4e0b\u306b\u3088\u308b\u505c\u6b62\u304b\u3089\u306e\u5fa9\u5e30\u306e\u65b9\u6cd5\u3002\u307e\u305a\u3001\u751f\u304d\u3066\u308b\u30ce\u30fc\u30c9\u3067\u30a2\u30c9\u30ec\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u3001</p> <p><pre><code>/* \u751f\u304d\u3066\u308b\u3059\u3079\u3066\u306e\u30ce\u30fc\u30c9\u3067\u78ba\u8a8d */\nSELECT @@group_replication_local_address;\n</code></pre> \u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u30b7\u30c3\u30d7\u3092\u5f37\u5236\u7684\u306b\u5909\u66f4\u3059\u308b\u3002</p> <pre><code>SET GLOBAL group_replication_force_members=\"192.168.88.11:6606,192.168.88.12:6606\";\n</code></pre>"},{"location":"mysql-mgr-copy/#group-replication-requirements","title":"Group Replication Requirements","text":"<p>\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u4f7f\u7528\u3059\u308b\u30b5\u30fc\u30d0\u306e\u8981\u4ef6\u3002</p> <ul> <li>InnoDB \u30b9\u30c8\u30ec\u30fc\u30b8\u30a8\u30f3\u30b8\u30f3<ul> <li>\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u524d\u63d0\u3067\u3059</li> </ul> </li> <li>\u4e3b\u30ad\u30fc<ul> <li>\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u7af6\u5408\u306e\u691c\u51fa\u306e\u305f\u3081\u306b\u4e3b\u30ad\u30fc\u304c\u5fc5\u8981\u3067\u3059</li> </ul> </li> <li>IPv4 \u30cd\u30c3\u30c8\u30ef\u30fc\u30af<ul> <li>IPv6 \u306f\u672a\u5bfe\u5fdc\u3067\u3059</li> </ul> </li> <li>\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9<ul> <li>\u305d\u308c\u306a\u308a\u306b\u592a\u3044\u5e2f\u57df\u3068\u305d\u308c\u306a\u308a\u306b\u4f4e\u3044\u30ec\u30a4\u30c6\u30f3\u30b7\u304c\u524d\u63d0\u3067\u3059</li> </ul> </li> </ul>"},{"location":"mysql-mgr-copy/#_8","title":"\u5236\u9650","text":"<p>\u8a8d\u8a3c\u30d7\u30ed\u30bb\u30b9\uff1f\uff08\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u30b3\u30df\u30c3\u30c8\u6642\u306b\u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u3067\u5408\u610f\u3092\u5f97\u308b\u30d7\u30ed\u30bb\u30b9\uff09\u3067\u306f\u30ae\u30e3\u30c3\u30d7\u30ed\u30c3\u30af\u304c\u5229\u7528\u3067\u304d\u306a\u3044\uff08InnoDB \u306e\u5916\u90e8\u3067\u306f\u30ae\u30e3\u30c3\u30d7\u30ed\u30c3\u30af\u306b\u95a2\u3059\u308b\u60c5\u5831\u3092\u5229\u7528\u3067\u304d\u306a\u3044\u305f\u3081\uff09\u3002\u306a\u306e\u3067\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5206\u96e2\u30ec\u30d9\u30eb\u306b\u306f READ COMMITTED \u3092\u4f7f\u3046\u3053\u3068\u3092\u304a\u3059\u3059\u3081\u3059\u308b\uff08\u305f\u3076\u3093\u8981\u3059\u308b\u306b\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c\u30b0\u30eb\u30fc\u30d7\u306b\u4f1d\u64ad\u3055\u308c\u308b\u3068\u304d\u306b\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c\u767a\u751f\u3057\u305f\u30ce\u30fc\u30c9\u4ee5\u5916\u3067\u306f\u30ae\u30e3\u30c3\u30d7\u30ed\u30c3\u30af\u304c\u5229\u304b\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u3060\u3068\u601d\u3044\u307e\u3059\u3002\u305d\u308c\u3067\u56f0\u308b\u306e\u306f\u30de\u30eb\u30c1\u30d7\u30e9\u30a4\u30de\u30ea\u306e\u3068\u304d\u3060\u3051\u3060\u3068\u601d\u3046\u306e\u3067\u30b7\u30f3\u30b0\u30eb\u30d7\u30e9\u30a4\u30de\u30ea\u306a\u3089\u95a2\u4fc2\u306a\u3044\u3088\u3046\u306b\u601d\u3044\u307e\u3059\uff09\u3002</p> <p><code>LOCK TABLES</code> \u3084 <code>GET_LOCK()</code> \u306f\u4f7f\u7528\u3067\u304d\u306a\u3044\uff08\u3053\u308c\u3082\u30b7\u30f3\u30b0\u30eb\u30d7\u30e9\u30a4\u30de\u30ea\u306a\u3089\u95a2\u4fc2\u306a\u3044\u3088\u3046\u306b\u601d\u3044\u307e\u3059\u3002\u30d7\u30e9\u30a4\u30de\u30ea\u3067\u306f\u5229\u304d\u307e\u3059\u3088\u306d\uff1f \u3068\u3044\u3046\u304b LOCK TABLES \u3068\u304b GET_LOCK() \u3068\u304b\u306a\u3093\u3066\u666e\u6bb5\u4f7f\u308f\u306a\u3044\u3067\u3059\u306d\u3002\u3002\u3002\uff09\u3002</p> <p>\u30de\u30eb\u30c1\u30d7\u30e9\u30a4\u30de\u30ea\u30e2\u30fc\u30c9\u3067\u306f <code>SERIALIZABLE</code> \u5206\u96e2\u30ec\u30d9\u30eb\u306f\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u3044\u3002</p> <p>\u30de\u30eb\u30c1\u30d7\u30e9\u30a4\u30de\u30ea\u30e2\u30fc\u30c9\u3067\u306f\u540c\u3058\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5bfe\u3057\u3066\u7570\u306a\u308b\u30b5\u30fc\u30d0\u3067 DDL \u3068 DML \u304c\u540c\u6642\u306b\u5b9f\u884c\u3055\u308c\u308b\u3068 DDL \u306e\u7af6\u5408\u304c\u691c\u51fa\u3055\u308c\u306a\u3044\u30ea\u30b9\u30af\u304c\u3042\u308b\uff1f</p> <p>\u30de\u30eb\u30c1\u30d7\u30e9\u30a4\u30de\u30ea\u30e2\u30fc\u30c9\u3067\u306f CASCADE \u3092\u6307\u5b9a\u3057\u305f\u5916\u90e8\u30ad\u30fc\u5236\u7d04\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u3044\u3002\u30ab\u30b9\u30b1\u30fc\u30c9\u64cd\u4f5c\u304c\u884c\u308f\u308c\u308b\u3068\u304d\u306b\u691c\u51fa\u3067\u304d\u306a\u3044\u7af6\u5408\u304c\u751f\u3058\u308b\u3053\u3068\u304c\u3042\u308b\u305f\u3081\u3002\u306a\u306e\u3067\u30de\u30eb\u30c1\u30d7\u30e9\u30a4\u30de\u30ea\u30e2\u30fc\u30c9\u3067\u306f group_replication_enforce_update_everywhere_checks \u3092\u6709\u52b9\u306b\u3059\u308b\u3053\u3068\u3092\u304a\u3059\u3059\u3081\u3059\u308b\u3002\u30b7\u30f3\u30b0\u30eb\u30d7\u30e9\u30a4\u30de\u30ea\u30e2\u30fc\u30c9\u306a\u3089\u554f\u984c\u306a\u3044\u3002</p> <p>\u30b0\u30eb\u30fc\u30d7\u5185\u3067\u306e\u8907\u88fd\u306b5\u79d2\u4ee5\u4e0a\u3092\u8981\u3059\u308b\u3088\u3046\u306a\u901a\u4fe1\u304c\u3042\u308b\u3068\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u901a\u4fe1\u306e\u5931\u6557\u3092\u5f15\u304d\u8d77\u3053\u3059\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002LOAD DATA INFILE \u306a\u3069\u3067\u4f7f\u7528\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u5c0f\u3055\u304f\u5206\u5272\u3059\u308b\u306a\u3069\u306e\u5bfe\u5fdc\u304c\u5fc5\u8981\u3002</p> <p>\u30de\u30eb\u30c1\u30d7\u30e9\u30a4\u30de\u30ea\u30e2\u30fc\u30c9\u3067\u306f SELECT .. FOR UPDATE \u3067\u30c7\u30c3\u30c9\u30ed\u30c3\u30af\u3059\u308b\u3053\u3068\u304c\u3042\u308b\u3002\u3053\u308c\u306f\u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u30fc\u9593\u3067\u30ed\u30c3\u30af\u304c\u5171\u6709\u3055\u308c\u306a\u3044\u305f\u3081\u3002 \uff08SELECT .. FOR UPDATE \u306f\u666e\u901a\u306b\u30c7\u30c3\u30c9\u30ed\u30c3\u30af\u3059\u308b\u53ef\u80fd\u6027\u306f\u3042\u308b\u3068\u601d\u3046\u306e\u3060\u3051\u3069\u30fb\u30fb\u3069\u3046\u3044\u3046\u3053\u3068\uff1f\uff09</p> <p>\u30b0\u30ed\u30fc\u30d0\u30eb\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30d5\u30a3\u30eb\u30bf\u306f\u4f7f\u7528\u3067\u304d\u306a\u3044\u3002\u4e00\u90e8\u306e\u30e1\u30f3\u30d0\u30fc\u3067\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u30d5\u30a3\u30eb\u30bf\u3059\u308b\u3068\u30b0\u30eb\u30fc\u30d7\u304c\u4e00\u8cab\u306e\u3042\u308b\u72b6\u614b\u3067\u540c\u671f\u3067\u304d\u306a\u304f\u306a\u308b\u305f\u3081\u3002\u30b0\u30eb\u30fc\u30d7\u5916\u306e\u30b5\u30fc\u30d0\u3068\u306e\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306a\u3069\u306e\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u76f4\u63a5\u95a2\u4fc2\u3057\u306a\u3044\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30c1\u30e3\u30f3\u30cd\u30eb\u306b\u306a\u3089\u4f7f\u7528\u3067\u304d\u308b\u3002 \uff08\u3044\u308f\u3086\u308b replicate-do-db \u3068\u304b\u306e\u3053\u3068\u3060\u3068\u601d\u308f\u308c\u308b\uff09</p>"},{"location":"mysql-mgr-copy/#_9","title":"\u3055\u3044\u3054\u306b","text":"<p>GTID \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068 mysqlfailover \u306b\u6bdb\u304c\u751f\u3048\u305f\u3088\u3046\u306a\u3082\u306e\u304b\u3068\u601d\u3063\u3066\u305f\u3093\u3067\u3059\u3051\u3069</p> <ul> <li>https://dev.mysql.com/doc/refman/8.0/en/group-replication-summary.html</li> </ul> <p>\u3068\u304b\u3092\u898b\u308b\u306b\u5358\u7d14\u306b\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u3092\u8ee2\u9001\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u306f\u306a\u3055\u305d\u3046\u3067\u3059\u3002\u305f\u3060\u30b7\u30f3\u30b0\u30eb\u30d7\u30e9\u30a4\u30de\u30ea\u3060\u3068\u5b9f\u8cea\u5358\u7d14\u306b\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u3092\u8ee2\u9001\u3057\u3066\u3044\u308b\u3060\u3051\u306b\u306a\u308a\u305d\u3046\u306a\u6c17\u3082\u3059\u308b\u306e\u3067\u3001\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u6700\u5927\u306e\u65e8\u5473\u306f\u30de\u30eb\u30c1\u30d7\u30e9\u30a4\u30de\u30ea\u30e2\u30fc\u30c9\u3067\u3059\u304b\u306d\uff1f \u6700\u3082\u30ce\u30fc\u30c9\u306e\u30d8\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u3084\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u306e\u81ea\u52d5\u5316\u306e\u9762\u3060\u3051\u3067\u3082\u5341\u5206\u30e1\u30ea\u30c3\u30c8\u3042\u308b\u3068\u601d\u3046\u306e\u3067\u4eca\u5f8c\u4f7f\u3048\u305d\u3046\u306a\u3089\u4f7f\u3063\u3066\u3044\u304d\u305f\u3044\u304b\u3082\u3002</p> <p>\u305d\u308c\u3068\u3001\u30b0\u30eb\u30fc\u30d7\u5168\u4f53\u3092\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3059\u308b\u3068 group_replication_bootstrap_group \u304c\u518d\u3073\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u3061\u3087\u3063\u3068\u9762\u5012\u3067\u3059\u306d\u3002\u3044\u308f\u3086\u308b\u672c\u756a\u74b0\u5883\u306a\u3089\u6b62\u3081\u308b\u3053\u3068\u306f\u306a\u3044\u306e\u3067\u826f\u3044\u3067\u3059\u3051\u3069\u3001\u691c\u8a3c\u74b0\u5883\u3068\u304b\u3067\u4e0a\u3052\u305f\u308a\u4e0b\u3052\u305f\u308a\u3059\u308b\u3053\u3068\u304c\u3042\u308b\u3068\u904b\u7528\u304c\u9762\u5012\u305d\u3046\u3067\u3059\u3002</p>"},{"location":"mysql-mgr/","title":"MYSQL MGR","text":""},{"location":"mysql-mgr/#_1","title":"\u53c2\u8003","text":"<ul> <li>https://www.modb.pro/db/337457</li> <li>https://www.modb.pro/db/377620</li> <li>https://www.modb.pro/db/25554</li> <li>https://www.cndba.cn/dave/article/108030</li> <li>https://blog.51cto.com/imysql/3199719</li> <li>https://dev.mysql.com/doc/refman/8.0/ja/group-replication-adding-instances.html</li> <li>https://ngyuki.hatenablog.com/entry/2018/07/02/072619</li> </ul>"},{"location":"mysql-mgr/#mgr","title":"MGR\u7684\u4f7f\u7528\u7ea6\u675f","text":"<ol> <li>\u4ec5\u652f\u6301InnoDB\u8868,\u5e76\u4e14\u6bcf\u5f20\u8868\u4e00\u5b9a\u8981\u6709\u4e00\u4e2a\u4e3b\u952e,\u7528\u4e8e\u505awrite set \u7684\u51b2\u7a81\u68c0\u6d4b<ul> <li>mgr\u6a21\u5f0f\u4e0b\u6240\u6709\u8868\u90fd\u9700\u8981\u8bbe\u7f6e\u4e3b\u952e\uff0c\u4e0d\u7136\u4f1a\u62a5\u9519</li> <li><code>ERROR 3098 (HY000): The table does not comply with the requirements by an external plugin.</code></li> </ul> </li> <li>\u5fc5\u987b\u6253\u5f00GTID\u7279\u6027,\u4e8c\u8fdb\u5236\u65e5\u5fd7\u683c\u5f0f\u5fc5\u987b\u8bbe\u7f6e\u4e3aROW,\u7528\u4e8e\u9009\u4e3b\u4e0ewrite set; <ul> <li>\u4e3b\u4ece\u72b6\u6001\u4fe1\u606f\u5b58\u4e8e\u8868\u4e2d,(--master-info-repository=TABLE, --relay-log-info-repository=TABLE), --log-slave-updates\u6253\u5f00.</li> </ul> </li> <li>MGR\u4e0d\u652f\u6301\u5927\u4e8b\u52a1,\u4e8b\u52a1\u5927\u5c0f\u6700\u597d\u4e0d\u8d85\u8fc7143MB, \u5f53\u4e8b\u52a1\u8fc7\u5927,\u65e0\u6cd5\u57285\u79d2\u7684\u65f6\u95f4\u5185\u901a\u8fc7\u7f51\u7edc\u5728\u7ec4\u6210\u5458\u4e4b\u95f4\u590d\u5236\u6d88\u606f,\u5219\u53ef\u80fd\u4f1a\u6000\u7591\u6210\u5458\u5931\u8d25\u4e86,\u7136\u540e\u5c06\u5176\u9010\u51fa\u5c40</li> <li>\u76ee\u524d\u4e00\u4e2aMGR\u7fa4\u96c6\u6700\u591a\u652f\u63019\u4e2a\u8282\u70b9</li> <li>\u4e0d\u652f\u6301\u5916\u952e\u4e8esave point\u7279\u6027, \u65e0\u6cd5\u505a\u5168\u5c40\u95f4\u7684\u7ea6\u675f\u68c0\u6d4b\u4e0e\u90e8\u5206\u4e8b\u52a1\u56de\u6eda</li> <li>\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e0d\u652f\u6301binlog Event Checksum (\u5728 MySQL 8.0.20 \u4e4b\u524d)<ul> <li>\u4ece MySQL 8.0.21 \u5f00\u59cb\uff0cGroup Replication \u652f\u6301\u6821\u9a8c\u548c\uff0c\u56e0\u6b64\u7ec4\u6210\u5458\u53ef\u4ee5\u4f7f\u7528\u9ed8\u8ba4\u8bbe\u7f6e\u3002</li> <li>From MySQL 8.0.21, Group Replication supports checksums, so group members may use the default setting.</li> <li>https://dev.mysql.com/doc/refman/8.0/en/replication-options-binary-log.html#sysvar_binlog_checksum</li> </ul> </li> </ol>"},{"location":"mysql-mgr/#vm","title":"\u691c\u8a3cVM","text":"IP Hostname virt_name spec HV xx.yyy.zzz.1 node1 (rocky8) mysql8-test 22c/160g hv1 xx.yyy.zzz.2 node2 (rocky87-mysql8) rocky87-test 8c/16g hv2 xx.yyy.zzz.3 node3 (amd-rocky8) rocky-mysql8 22c/160g hv2 <ul> <li> <p>MySQL\u518d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb</p> </li> <li> <p>mysql8\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u306e\u305f\u3081\u3001\u4e00\u65e6\u524a\u9664\u3059\u308b</p> </li> </ul> <pre><code># backup\n\n[root@node3 work]# pwd\n/root/work\n[root@node3 work]#\ncp /etc/my.cnf my.cnf.20230515\ncp /root/.my.cnf .my.cnf.20230515\ncp /root/.mytop .mytop.20230515\n\n# rpm\u3092\u524a\u9664\n\n[root@node1 work]# for i in `rpm -aq | grep mysql`; do yum -y remove $i; done\n[root@node2 work]# for i in `rpm -aq | grep mysql`; do yum -y remove $i; done\n[root@node3 work]# for i in `rpm -aq | grep mysql`; do yum -y remove $i; done\n\n# \u4e0d\u8981\u30d5\u30a1\u30a4\u30eb\u524a\u9664\n\nrm -rf /etc/my.cnf.rpmsave\nrm -rf /etc/my.cnf\nrm -rf /etc/mysql-version.txt\nrm -rf /home/mysql\nrm -rf /root/.my.cnf\nrm -rf /root/.mytop\n\n# Ansible\u3067MySQL8.0\u3092\u518d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n$ sudo /usr/local/bin/ansible-playbook mysql80.yml --limit xx.yyy.zzz.1,xx.yyy.zzz.2,xx.yyy.zzz.3  -t systool,mysql80 -v\nPLAY RECAP *********************************************************************************************************************\nxx.yyy.zzz.1              : ok=29   changed=12   unreachable=0    failed=0    skipped=6    rescued=0    ignored=0\nxx.yyy.zzz.2              : ok=29   changed=12   unreachable=0    failed=0    skipped=6    rescued=0    ignored=0\nxx.yyy.zzz.3              : ok=28   changed=14   unreachable=0    failed=0    skipped=6    rescued=0    ignored=0\n</code></pre>"},{"location":"mysql-mgr/#mycnf","title":"my.cnf","text":"my.cnf <pre><code>[mysql]\ndefault-character-set=utf8mb4\nsocket=/tmp/mysql.sock\nauto-rehash\nprompt=\"\\\\r:\\\\m:\\\\s \\\\u@\\\\h[\\\\d]&gt; \"\n\n[mysqld]\n# mgr\nserver_id=1\ngtid_mode=ON\nenforce_gtid_consistency=ON\nbinlog_checksum=NONE\nlog_replica_updates=ON\nlog_bin=binlog\nrelay_log=relay_log\nbinlog_format=ROW\nplugin-load=mysql_clone.so;group_replication.so\n\nloose-group_replication_group_name=\"aaaaaaaa-1111-2222-3333-bbbbbbbbbbbb\"\nloose-group_replication_start_on_boot=off\nloose-group_replication_local_address=\"node1:33061\"\nloose-group_replication_group_seeds=\"node1:33061,node2:33061,node3:33061\"\nloose-group_replication_bootstrap_group=off\nloose-group_replication_ip_allowlist=\"xx.yyy.zzz.0/25\"\nreport-host=\"node1\"\n\nbinlog_expire_logs_seconds=86400 # \u8868\u793a\u81ea\u52a8\u5220\u96641\u5929\u4ee5\u524d\u7684binlog\uff0c\u53ef\u9009\n\n# general\nuser=mysql\ndatadir=/home/mysql\nsocket=/tmp/mysql.sock\ntmpdir=/home/tmp\nbind-address=0.0.0.0\n\nperformance_schema_show_processlist=1\ndefault_storage_engine=INNODB\nskip-name-resolve\nskip-mysqlx\n# skip-log-bin # MGR\u306e\u305f\u3081\u3001\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\nevent_scheduler=OFF\n\ntls_version=TLSv1.2,TLSv1.3\nsql_mode=\"ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION\"\n\nmax_connections=100\nmax_connect_errors=300\nmax_allowed_packet=32M\nconnect_timeout=30\nmax_user_connections=30\ntable_open_cache=9600\ninteractive_timeout=300\nwait_timeout=300\ntmp_table_size=256M\nmax_heap_table_size=256M\ndefault_password_lifetime=0\nexplicit_defaults_for_timestamp=1\nlog_timestamps=SYSTEM\ncharacter-set-server=utf8mb4\ncollation-server=utf8mb4_general_ci\n\n# auth\nauthentication_policy = 'mysql_native_password,,'\n\n# ssl_rsa\nauto_generate_certs=ON\ncaching_sha2_password_auto_generate_rsa_keys=0\nsha256_password_auto_generate_rsa_keys=0\n\n# innodb doublewrite\ninnodb_doublewrite_dir=\"/home/mysql/#innodb_dblwr\"\n# innodb_doublewrite_files=16 # (innodb_buffer_pool_instances * 2)\n\n# undo log\ninnodb_max_undo_log_size=1G\n\n# log\nslow_query_log=1\nlog_error_verbosity=3\nlong_query_time=10\nslow_query_log_file=/var/log/mysql/slow_query.log\nlog_error=/var/log/mysql/error.log\nlog_output=FILE\n\n# buffer\nsort_buffer_size=1M\nread_buffer_size=1M\nread_rnd_buffer_size=1M\n\n# MyISAM\nmyisam_sort_buffer_size=128M\nkey_buffer_size=512M\n\n# InnoDB\ninnodb-adaptive-hash-index=OFF\ninnodb-strict-mode=1\ninnodb_file_per_table=1\ninnodb_temp_data_file_path=ibtmp1:12M:autoextend:max:10G\ninnodb_buffer_pool_size=4G\ninnodb_buffer_pool_dump_pct=100\ninnodb_buffer_pool_dump_at_shutdown=1\ninnodb_buffer_pool_load_at_startup=0\ninnodb_redo_log_capacity=512M\ninnodb_io_capacity=2000\ninnodb_io_capacity_max=5000\ninnodb_flush_log_at_trx_commit=2\ninnodb_flush_method=O_DIRECT\ninnodb_flush_neighbors=0\ninnodb_read_ahead_threshold=0\ninnodb_purge_threads=1\n</code></pre>"},{"location":"mysql-mgr/#_2","title":"\u5404\u8282\u70b9\u914d\u7f6e","text":"\u914d\u7f6e\u9879 \u503c \u8bf4\u660e server_id 1 \u552f\u4e00\u6807\u8bc6MySQL\u5b9e\u4f8b gtid_mode ON \u5f00\u542f\u4e8b\u52a1\u7684gtid enforce_gtid_consistency ON \u5f3a\u5236gtid\u4e00\u81f4\u6027 master_info_repository(deprecated) TABLE <code>master.info</code>\u4f7f\u7528\u6570\u636e\u8868\u65b9\u5f0f\u8bb0\u5f55 log_bin ON \u5f00\u542fbinlog binlog_format ROW binlog\u7684\u590d\u5236\u6a21\u5f0f binlog_checksum NONE \u4e0d\u4f7f\u7528binlog\u6821\u9a8c\u548c relay_log_info_repository(deprecated) TABLE \u4f5c\u4e3a\u4ece\u5e93\u540c\u6b65\u4e8b\u52a1\u540e\uff0c\u8bb0\u5f55\u81f3\u6570\u636e\u8868 transaction_write_set_extraction (deprecated) XXHASH64 deprecated as of MySQL 8.0.26 default_authentication_plugin mysql_native_password \u914d\u7f6e\u7528\u6237\u8d26\u6237\u7684\u52a0\u5bc6\u65b9\u5f0f plugin_load mysql_clone.so;group_replication.so \u52a0\u8f7d\u7ec4\u590d\u5236\u63d2\u4ef6 loose-group_replication_group_name \"aaaaaaaa-1111-2222-3333-bbbbbbbbbbbb\" UUID\uff0c\u5206\u7ec4\u7684\u8282\u70b9\u9700\u914d\u7f6e\u4e00\u81f4 loose-group_replication_start_on_boot OFF \u542f\u52a8MySQL\u65f6\u4e0d\u81ea\u52a8\u5f00\u542f\u7ec4\u590d\u5236 loose-group_replication_bootstrap_group OFF \u5173\u95ed\u6b64MySQL\u5b9e\u4f8b\u7684\u7ec4\u5f15\u5bfc loose-group_replication_single_primary_mode OFF \u5173\u95ed\u5355\u4e3b\u6a21\u5f0f\uff0c\u5373\u4f7f\u7528\u591a\u4e3b\u6a21\u5f0f loose-group_replication_enforce_update_everywhere_checks ON \u5728\u591a\u4e3b\u6a21\u5f0f\u4e0b\uff0c\u5efa\u8bae\u5f00\u542f\u6b64\u9009\u9879\uff0c\u4e25\u683c\u68c0\u67e5\u4e00\u81f4\u6027 loose-group_replication_ssl_mode DISABLED \u7ec4\u590d\u5236\u8282\u70b9\u901a\u4fe1\u7981\u7528SSL loose-group_replication_local_address \"node1:33061\" \u5f53\u524dMySQL\u5b9e\u4f8b\u7684\u7ec4\u590d\u5236\u901a\u4fe1\u5730\u5740 loose-group_replication_group_seeds \"node1:33061,node2:33061,node3:33061\" \u7ec4\u590d\u5236\u7684\u8282\u70b9\u901a\u4fe1\u5730\u5740 loose-group_replication_ip_whitelist orloose-group_replication_ip_allowlist xx.yyy.zzz.0/25,127.0.0.1\" \u8bbe\u7f6e\u7ec4\u590d\u5236\u8282\u70b9\u901a\u4fe1\u7684IP\u767d\u540d\u5355\uff0c\u540c\u7f51\u6bb5\u53ef\u7701\u7565 report-host \"node1\" \u8bbe\u7f6e\u672c\u673aMEMBER_HOST,\u9ed8\u8ba4\u4e3ahostname,\u7531\u4e8e\u5f00\u542f\u4e86skip-name-resolve,\u6b64\u5904\u7528IP\u65b9\u5f0f\u901a\u8baf"},{"location":"mysql-mgr/#_3","title":"\u8bbe\u7f6e\u590d\u5236\u8d26\u53f7","text":"<ul> <li>\u4e0b\u8a18\u4f5c\u696d\u306f\u5168node\u3067\u5b9f\u65bd\u3059\u308b</li> </ul> <pre><code>-- \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u308a\u307e\u3059\u3002\nmysql&gt; SET SQL_LOG_BIN=0;\nmysql&gt; CREATE USER 'repl_user'@'%' IDENTIFIED BY 'password';\nmysql&gt; GRANT REPLICATION SLAVE ON *.* TO repl_user@'%';\nmysql&gt; FLUSH PRIVILEGES;\nmysql&gt; SET SQL_LOG_BIN=1;\n-- \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30c1\u30e3\u30f3\u30cd\u30eb group_replication_recovery \u306b\u2191\u3067\u4f5c\u6210\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u306e\u8cc7\u683c\u60c5\u5831\u3092\u4f7f\u3046\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\nmysql&gt; CHANGE REPLICATION SOURCE TO SOURCE_USER='repl_user', SOURCE_PASSWORD='password' FOR CHANNEL 'group_replication_recovery';\n-- \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304c\u521d\u671f\u5316\u3055\u308c\u305f\u6642\u70b9\u3067\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306b\u3044\u308d\u3044\u308d\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u306e\u307e\u307e\u3060\u3068\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u958b\u59cb\u3057\u305f\u3068\u304d\u306b\u7af6\u5408\u3059\u308b\u306e\u3067\u3001\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nmysql&gt; RESET MASTER;\n</code></pre> warning\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u308b\u5834\u5408 <pre><code># replication\u30e6\u30fc\u30b6\u3092\u8ffd\u52a0\u6642\u3001\u4e0b\u8a18\u306ewarning\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u308b\u3002\n01:52:21 root@localhost[(none)]&gt; CHANGE REPLICATION SOURCE TO SOURCE_USER='repl_user', SOURCE_PASSWORD='password' FOR CHANNEL 'group_replication_recovery';\nQuery OK, 0 rows affected, 2 warnings (0.00 sec)\n01:52:21 root@localhost[(none)]&gt; show warnings\\G\n*************************** 1. row ***************************\nLevel: Note\nCode: 1759\nMessage: Sending passwords in plain text without SSL/TLS is extremely insecure.\n*************************** 2. row ***************************\nLevel: Note\nCode: 1760\nMessage: Storing MySQL user name or password information in the connection metadata repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.\n2 rows in set (0.00 sec)\n01:52:29 root@localhost[(none)]&gt;\n# \u539f\u56e0\u306fmysql\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u63a5\u7d9a\u6642ssl\u306a\u3057\u3067\u63a5\u7d9a\u3057\u3066\u3044\u308b\u305f\u3081\u3067\u3059\u3002 (node1)\n01:42:17 root@localhost[(none)]&gt; \\s\n--------------\nmysql  Ver 8.0.33 for Linux on x86_64 (MySQL Community Server - GPL)\nCurrent user:           root@localhost\nSSL:                    Not in use     &lt;&lt;-- \u3053\u3053\u304cSSL\u306a\u3057\n&lt;SKIP&gt;\n--------------\n01:44:41 root@localhost[(none)]&gt;\n# \u5bfe\u5fdc\u65b9\u6cd5 (node2)\n- /root/.my.cnf \u306b\u4e0b\u8a18\u306e\u901a\u308a\u306b\u5909\u66f4\n01:53:27 root@localhost[(none)]&gt; \\! cat /root/.my.cnf\n[client]\nsocket=/tmp/mysql.sock\nuser=root\npassword=password\nhost=localhost\nssl-mode=required  &lt;--- ssl-mode\u3092\u8ffd\u52a0\u3059\u308b\u3002\u5f37\u5236\u7684\u306bssl\u3092\u5229\u7528\u3059\u308b\n01:53:30 root@localhost[(none)]&gt;\n## \u7d50\u679c\n- warning\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u4e00\u3064\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n01:55:10 root@localhost[(none)]&gt; CHANGE REPLICATION SOURCE TO SOURCE_USER='repl_user', SOURCE_PASSWORD='password' FOR CHANNEL 'group_replication_recovery';\nQuery OK, 0 rows affected, 1 warning (0.01 sec)\n01:55:10 root@localhost[(none)]&gt;\n01:55:10 root@localhost[(none)]&gt; show warnings\\G\n*************************** 1. row ***************************\nLevel: Note\nCode: 1760\nMessage: Storing MySQL user name or password information in the connection metadata repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START REPLICA; see the 'START REPLICA Syntax' in the MySQL Manual for more information.\n1 row in set (0.00 sec)\n01:55:17 root@localhost[(none)]&gt;\n</code></pre>"},{"location":"mysql-mgr/#master","title":"MASTER\u30b5\u30fc\u30d0","text":"Tip <p>\u306a\u304a\u3001\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\u306a\u3069\u306e\u3001\u3059\u3079\u3066\u306e\u30ce\u30fc\u30c9\u3067\u500b\u5225\u306b\u5b9f\u884c\u3059\u308b\u305f\u3081\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3055\u308c\u305f\u304f\u306a\u3044\u30af\u30a8\u30ea\u306f <code>set sql_log_bin = 0|1</code> \u3068\u304b\u3067\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e <code>ON/OFF</code> \u3092\u5236\u5fa1\u3057\u3064\u3064\u30af\u30a8\u30ea\u3092\u5b9f\u884c\u3059\u308b\u306e\u304c\u666e\u901a\u306e\u3088\u3046\u3067\u3059\u3002 \u305f\u3060\u3001\u521d\u56de\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3067\u306f\u300c<code>\u3059\u3079\u3066\u306e\u30ce\u30fc\u30c9\u3067\u3044\u308d\u3044\u308d\u6e96\u5099</code>\u2192<code>RESET MASTER</code>\u2192 <code>\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u958b\u59cb</code>\u300d\u306e\u65b9\u304c\u308f\u304b\u308a\u307f\u304c\u3042\u308b\u304d\u304c\u3059\u308b\u306e\u3067\u3001\u3044\u3064\u3082\u305d\u3046\u3057\u3066\u307e\u3059\u3002</p> <pre><code># \u4e3b\u670d\u52a1\u5668\nmysql&gt; reset master;\nmysql&gt; SET GLOBAL group_replication_bootstrap_group=ON;\nmysql&gt; START GROUP_REPLICATION;\nmysql&gt; SET GLOBAL group_replication_bootstrap_group=OFF;\n# mysql&gt; START GROUP_REPLICATION;\n# mysql&gt; START GROUP_REPLICATION USER='repl_user', PASSWORD='password';\n# mysql&gt; CHANGE REPLICATION SOURCE TO SOURCE_PORT='3306' FOR CHANNEL 'group_replication_recovery';\n# \u53e6\u4e00\u79cd\u5199\u6cd5.\n# CHANGE REPLICATION SOURCE TO SOURCE_HOST='xx.yyy.zzz.1', SOURCE_PORT=33061 FOR CHANNEL 'group_replication_recovery'\n# CHANGE REPLICATION SOURCE TO\n#   SOURCE_HOST='xx.yyy.zzz.1',\n#   SOURCE_USER='repl_user',\n#   SOURCE_PASSWORD='password',\n#   SOURCE_PORT=33061;\n# # START GROUP_REPLICATION USER='repl_user', PASSWORD='password';\nmysql&gt; SHOW VARIABLES LIKE 'gtid_executed';\n+---------------+------------------------------------------+\n| Variable_name | Value                                    |\n+---------------+------------------------------------------+\n| gtid_executed | aaaaaaaa-1111-2222-3333-bbbbbbbbbbbb:1-3 |\n+---------------+------------------------------------------+\n1 row in set (0.00 sec)\n-- \u5e38\u7528\u67e5\u770bMGR\u7ec4\u4fe1\u606f\u7684\u8bed\u53e5\nmysql&gt; SELECT * FROM performance_schema.replication_group_members;\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+\n| CHANNEL_NAME              | MEMBER_ID                            | MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE | MEMBER_VERSION | MEMBER_COMMUNICATION_STACK |\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+\n| group_replication_applier | defba275-f2ef-11ed-9eae-525400e752a2 | node1       |        3306 | ONLINE       | PRIMARY     | 8.0.33         | XCom                       |\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+\n1 row in set (0.00 sec)\n10:27:13 root@localhost[(none)]&gt; SELECT ta.* ,tb.MEMBER_HOST,tb.MEMBER_PORT,tb.MEMBER_STATE FROM performance_schema.global_status ta,performance_schema.replication_group_members tb  WHERE ta.VARIABLE_NAME='group_replication_primary_member' and ta.VARIABLE_VALUE=tb.MEMBER_ID;\n+----------------------------------+--------------------------------------+-------------+-------------+--------------+\n| VARIABLE_NAME                    | VARIABLE_VALUE                       | MEMBER_HOST | MEMBER_PORT | MEMBER_STATE |\n+----------------------------------+--------------------------------------+-------------+-------------+--------------+\n| group_replication_primary_member | defba275-f2ef-11ed-9eae-525400e752a2 | node1       |        3306 | ONLINE       |\n+----------------------------------+--------------------------------------+-------------+-------------+--------------+\n1 row in set (0.00 sec)\n10:27:19 root@localhost[(none)]&gt; SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME='group_replication_primary_member';\n+--------------------------------------+\n| VARIABLE_VALUE                       |\n+--------------------------------------+\n| defba275-f2ef-11ed-9eae-525400e752a2 |\n+--------------------------------------+\n1 row in set (0.00 sec)\n10:27:32 root@localhost[(none)]&gt; SHOW STATUS LIKE 'group_replication_primary_member';\n+----------------------------------+--------------------------------------+\n| Variable_name                    | Value                                |\n+----------------------------------+--------------------------------------+\n| group_replication_primary_member | defba275-f2ef-11ed-9eae-525400e752a2 |\n+----------------------------------+--------------------------------------+\n1 row in set (0.00 sec)\n10:27:37 root@localhost[(none)]&gt;\n</code></pre> replication_group_member_stats.VIEW_ID <ul> <li>\u89c6\u56fe\u53ca\u89c6\u56fe\u5207\u6362<ul> <li>MGR\u4ee5\u7ec4\u89c6\u56fe\uff08Group View\uff0c\u7b80\u79f0\u89c6\u56fe\uff09\u4e3a\u57fa\u7840\u6765\u8fdb\u884c\u6210\u5458\u7ba1\u7406\u3002\u89c6\u56fe\u6307Group\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\u7684\u6210\u5458\u72b6\u6001\uff0c\u5982\u679c\u5728\u8fd9\u6bb5\u65f6\u95f4\u5185\u6ca1\u6709\u6210\u5458\u53d8\u5316\uff0c\u4e5f\u5c31\u662f\u8bf4\u6ca1\u6709\u6210\u5458\u52a0\u5165\u6216\u9000\u51fa\uff0c\u5219\u8fd9\u6bb5\u8fde\u7eed\u7684\u65f6\u95f4\u4e3a\u4e00\u4e2a\u89c6\u56fe\uff0c\u5982\u679c\u53d1\u751f\u4e86\u6210\u5458\u52a0\u5165\u6216\u9000\u51fa\u53d8\u5316\uff0c\u5219\u89c6\u56fe\u4e5f\u5c31\u53d1\u751f\u4e86\u53d8\u5316\uff0cMGR\u4f7f\u7528\u89c6\u56feID\uff08<code>View_ID</code>\uff09\u6765\u8ddf\u8e2a\u89c6\u56fe\u7684\u53d8\u5316\u5e76\u533a\u5206\u89c6\u56fe\u7684\u5148\u540e\u65f6\u95f4\u3002</li> </ul> </li> </ul> <pre><code>10:14:59 root@localhost[(none)]&gt; select * from performance_schema.replication_group_member_stats limit 1\\G\n*************************** 1. row ***************************\nCHANNEL_NAME: group_replication_applier\nVIEW_ID: 16842195647561739:69\nMEMBER_ID: 74ba497e-f2f1-11ed-9e8e-5254007b60ca\nCOUNT_TRANSACTIONS_IN_QUEUE: 0\nCOUNT_TRANSACTIONS_CHECKED: 326523\nCOUNT_CONFLICTS_DETECTED: 0\nCOUNT_TRANSACTIONS_ROWS_VALIDATING: 298\nTRANSACTIONS_COMMITTED_ALL_MEMBERS: aaaaaaaa-1111-2222-3333-bbbbbbbbbbbb:1-3461902\nLAST_CONFLICT_FREE_TRANSACTION: aaaaaaaa-1111-2222-3333-bbbbbbbbbbbb:3462145\nCOUNT_TRANSACTIONS_REMOTE_IN_APPLIER_QUEUE: 0\nCOUNT_TRANSACTIONS_REMOTE_APPLIED: 326523\nCOUNT_TRANSACTIONS_LOCAL_PROPOSED: 0\nCOUNT_TRANSACTIONS_LOCAL_ROLLBACK: 0\n1 row in set (0.00 sec)\n</code></pre> <ul> <li>Group\u89c6\u56feViewID\u7531\u524d\u7f00\u65f6\u95f4\u6233+\u5e8f\u53f7\u90e8\u5206\u7ec4\u6210\u3002<ul> <li><code>VIEW_ID: 16842195647561739:69</code></li> </ul> </li> </ul> <pre><code>10:15:02 root@localhost[(none)]&gt; select from_unixtime(FLOOR(16842195647561739/10000000),'%Y-%m-%d %h:%m:%s');\n+----------------------------------------------------------------------+\n| from_unixtime(FLOOR(16842195647561739/10000000),'%Y-%m-%d %h:%m:%s') |\n+----------------------------------------------------------------------+\n| 2023-05-16 03:05:04                                                  |\n+----------------------------------------------------------------------+\n1 row in set (0.00 sec)\n10:15:07 root@localhost[(none)]&gt;\n</code></pre>"},{"location":"mysql-mgr/#slave","title":"SLAVE\u30b5\u30fc\u30d0\u8ffd\u52a0","text":"Tip <p>\u6b8b\u308a\u306e\u30ce\u30fc\u30c9\u3067\u3082\u958b\u59cb\u3057\u307e\u3059\u3002\u3053\u306e\u3068\u304d <code>group_replication_bootstrap_group=ON</code> \u3092\u6307\u5b9a\u3057\u307e\u305b\u3093\u3002 \u6307\u5b9a\u3059\u308b\u3068\u540c\u3058\u540d\u524d\u306e\u5225\u306e\u30b0\u30eb\u30fc\u30d7\u304c\u4f5c\u6210\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002</p> <pre><code>mysql&gt; stop replica;\nmysql&gt; reset replica all;\nmysql&gt; start group_replication;\nmysql&gt; SHOW VARIABLES LIKE 'gtid_executed';\nmysql&gt; select * from performance_schema.replication_group_members;\nmysql&gt; select * from performance_schema.replication_connection_status;\n# \u78ba\u8a8d\n04:15:18 root@localhost[(none)]&gt; select * from performance_schema.replication_group_members ;\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+\n| CHANNEL_NAME              | MEMBER_ID                            | MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE | MEMBER_VERSION | MEMBER_COMMUNICATION_STACK |\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+\n| group_replication_applier | 74ba497e-f2f1-11ed-9e8e-5254007b60ca | node2       |        3306 | ONLINE       | SECONDARY   | 8.0.33         | XCom                       |\n| group_replication_applier | d7239f8c-f2f1-11ed-aeeb-525400c72882 | node3       |        3306 | ONLINE       | SECONDARY   | 8.0.33         | XCom                       |\n| group_replication_applier | defba275-f2ef-11ed-9eae-525400e752a2 | node1       |        3306 | ONLINE       | PRIMARY     | 8.0.33         | XCom                       |\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+\n3 rows in set (0.00 sec)\n04:15:48 root@localhost[(none)]&gt;\n</code></pre> <ul> <li>CHANNEL_NAME:\u663e\u793a\u7684\u503c\u6c38\u8fdc\u4e3agroup_replication_applier</li> <li>MEMBER_ID :\u5b9e\u4f8b\u8282\u70b9\u7684serer_uuid\u503c</li> <li>MEMBER_PORT :\u5b9e\u4f8b\u8282\u70b9\u670d\u52a1\u7aef\u53e3\uff0c\u53d6\u503c\u4e3aserver_port\u6307\u5b9a\u7684\u7aef\u53e3</li> <li>MEMBER_HOST :\u5982\u679c\u6ca1\u6709\u914d\u7f6ereport_host\u9009\u9879\uff0c\u90a3\u4e48\u53d6\u503c\u4e3a\u673a\u5668\u7684hostname\uff0c\u53ef\u4ee5\u901a\u8fc7report_host\u914d\u7f6e\u6307\u5b9a\u5177\u4f53\u7684IP</li> <li>MEMBER_STATE : \u8282\u70b9\u72b6\u6001<ul> <li>ONLINE \u8868\u793a\u8be5\u8282\u70b9\u53ef\u6b63\u5e38\u63d0\u4f9b\u670d\u52a1</li> <li>RECOVERING \u8868\u793a\u8be5\u8282\u70b9\u6b63\u5728\u4ece\u5176\u4ed6\u8282\u70b9\u6062\u590d\u6570\u636e</li> <li>OFFLINE \u8868\u793aMGR\u63d2\u4ef6\u5df2\u7ecf\u52a0\u8f7d\uff0c\u4f46\u662f\u8be5\u8282\u70b9\u4e0d\u5c5e\u4e8e\u4efb\u4f55\u4e00\u4e2aGR\u7ec4</li> <li>ERROR \u8868\u793a\u8be5\u8282\u70b9\u5728recovery\u9636\u6bb5\u51fa\u73b0\u9519\u8bef\u6216\u8005\u4ece\u5176\u4ed6\u8282\u70b9\u540c\u6b65\u72b6\u6001\u4e2d\u51fa\u73b0\u9519\u8bef</li> <li>UNREACHABLE \u8868\u793a\u8be5\u8282\u70b9\u5904\u4e8e\u4e0d\u53ef\u8fbe\u72b6\u6001\uff0c\u65e0\u6cd5\u4e0e\u4e4b\u53d1\u751f\u7f51\u7edc\u901a\u8baf</li> </ul> </li> </ul>"},{"location":"mysql-mgr/#recovering","title":"RECOVERING\u306b\u306a\u3063\u305f\u5834\u5408","text":"<pre><code># slave\u30b5\u30fc\u30d0\u8ffd\u52a0\u306e\u969b\u3001MEMBER_STATE\u304c\u305a\u3063\u3068RECOVERING\u306b\u306a\u3063\u305f\u5834\u5408\n-- select * from performance_schema.replication_connection_status\\G \u3067\u30a8\u30e9\u30fc\u3092\u78ba\u8a8d\n-- \u57fa\u672c\u7684\u306b\u306freplication\u30e6\u30fc\u30b6\u306e\u8ffd\u52a0\u3067\u304d\u3066\u306a\u3044\u306e\u304c\u539f\u56e0\u3067\u3059\u3002\n## \u5bfe\u7b56\n-- replication\u30e6\u30fc\u30b6\u3092\u8ffd\u52a0\u3059\u308b\n-- CHANGE REPLICATION SOURCE TO SOURCE_USER='repl_user', SOURCE_PASSWORD='password' FOR CHANNEL 'group_replication_recovery';\n-- SELECT MEMBER_ID,MEMBER_HOST,MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members; \u3067\u78ba\u8a8d\n04:14:34 root@localhost[(none)]&gt; SELECT MEMBER_ID,MEMBER_HOST,MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+--------------------------------------+-------------+--------------+-------------+\n| MEMBER_ID                            | MEMBER_HOST | MEMBER_STATE | MEMBER_ROLE |\n+--------------------------------------+-------------+--------------+-------------+\n| 74ba497e-f2f1-11ed-9e8e-5254007b60ca | node2       | ONLINE       | SECONDARY   |\n| d7239f8c-f2f1-11ed-aeeb-525400c72882 | node3       | ONLINE       | SECONDARY   |\n| defba275-f2ef-11ed-9eae-525400e752a2 | node1       | ONLINE       | PRIMARY     |\n+--------------------------------------+-------------+--------------+-------------+\n3 rows in set (0.00 sec)\n04:15:18 root@localhost[(none)]&gt;\n04:17:57 root@localhost[(none)]&gt; select * from performance_schema.replication_group_members ;\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+\n| CHANNEL_NAME              | MEMBER_ID                            | MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE | MEMBER_VERSION | MEMBER_COMMUNICATION_STACK |\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+\n| group_replication_applier | 74ba497e-f2f1-11ed-9e8e-5254007b60ca | node2       |        3306 | ONLINE       | SECONDARY   | 8.0.33         | XCom                       |\n| group_replication_applier | d7239f8c-f2f1-11ed-aeeb-525400c72882 | node3       |        3306 | RECOVERING   | SECONDARY   | 8.0.33         | XCom                       |\n| group_replication_applier | defba275-f2ef-11ed-9eae-525400e752a2 | node1       |        3306 | ONLINE       | PRIMARY     | 8.0.33         | XCom                       |\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+\n3 rows in set (0.00 sec)\n04:18:01 root@localhost[(none)]&gt; select * from performance_schema.replication_connection_status\\G\n*************************** 2. row ***************************\nCHANNEL_NAME: group_replication_recovery\nLAST_ERROR_NUMBER: 13117\nLAST_ERROR_MESSAGE: Fatal error: Invalid (empty) username when attempting to connect to the source server. Connection attempt terminated.\nLAST_ERROR_TIMESTAMP: 2023-05-16 16:17:55.939759\n2 rows in set (0.00 sec)\n</code></pre>"},{"location":"mysql-mgr/#_4","title":"\u78ba\u8a8d","text":"<ul> <li>master\u5074\u306fNOT READ_ONLY\u3001slave\u5074\u306fREAD_ONLY</li> </ul> <pre><code># node1\n04:29:11 root@localhost[(none)]&gt; show global variables where Variable_name  like '%hostname%' or Variable_name like '%read_only%';\n+-----------------------+-------+\n| Variable_name         | Value |\n+-----------------------+-------+\n| hostname              | node1 |\n| innodb_read_only      | OFF   |\n| read_only             | OFF   |\n| super_read_only       | OFF   |\n| transaction_read_only | OFF   |\n+-----------------------+-------+\n5 rows in set (0.01 sec)\n04:29:44 root@localhost[(none)]&gt;\n# node2\n04:33:09 root@localhost[(none)]&gt; show global variables where Variable_name  like '%hostname%' or Variable_name like '%read_only%';\n+-----------------------+-------+\n| Variable_name         | Value |\n+-----------------------+-------+\n| hostname              | node2 |\n| innodb_read_only      | OFF   |\n| read_only             | ON    |\n| super_read_only       | ON    |\n| transaction_read_only | OFF   |\n+-----------------------+-------+\n5 rows in set (0.01 sec)\n04:37:22 root@localhost[(none)]&gt;\n# node3\n04:35:53 root@localhost[(none)]&gt; show global variables where Variable_name  like '%hostname%' or Variable_name like '%read_only%';\n+-----------------------+-------+\n| Variable_name         | Value |\n+-----------------------+-------+\n| hostname              | node3 |\n| innodb_read_only      | OFF   |\n| read_only             | ON    |\n| super_read_only       | ON    |\n| transaction_read_only | OFF   |\n+-----------------------+-------+\n5 rows in set (0.00 sec)\n04:40:09 root@localhost[(none)]&gt;\n</code></pre>"},{"location":"mysql-mgr/#sysbench","title":"sysbench\u306e\u691c\u8a3c","text":"sysbench\u306e\u691c\u8a3c <pre><code>## DB\u4f5c\u6210\n&gt; CREATE DATABASE sbtest;\n## \u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\n&gt; CREATE USER 'sbtest'@'%' IDENTIFIED BY 'sbtest';\n## \u30e6\u30fc\u30b6\u30fc\u306b\u5168\u6a29\u9650\u8ffd\u52a0\n&gt; GRANT all ON *.* TO 'sbtest'@'%';\n## \u6a29\u9650\u306e\u5909\u66f4\u3092\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u53cd\u6620\n&gt; FLUSH PRIVILEGES;\n## \u78ba\u8a8d\n&gt; show databases;\n&gt; select user,host,authentication_string from mysql.user;\n## \u691c\u8a3c\u7528\u30b9\u30af\u30ea\u30d7\u30c8\u4f5c\u6210\n#!/usr/bin/env bash\nPATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin\nexport PATH\nset -e\n\nclear\n\nTHR=$1\nCMD=$2\nif [ ! \"$THR\" ]; then\necho \"Not threads set! \"\nexit 1;\nfi\nif [ ! \"$CMD\" ]; then\necho \"Not command selected! \"\nexit 1;\nfi\nsysbench oltp_read_write \\\n--mysql-host=xx.yyy.zzz.1 \\\n--mysql-dry-run=off \\\n--db-driver=mysql \\\n--mysql-user=sbtest \\\n--mysql-password=sbtest \\\n--table_size=10000 \\\n--threads=$THR \\\n--tables=30 \\\n--time=120 \\\n--report-interval=10 \\\n$CMD\n## 2. \u30c6\u30fc\u30d6\u30eb\u6e96\u5099\n&gt; bash sysbench_mgr.sh 300 prepare\n\n## \u6027\u80fd\u691c\u8a3c\n&gt; for i in $(seq 10 10 300); do echo $i; bash sysbench_mgr.sh $i run &gt;&gt; mgr_sysbench.log; done\n</code></pre>"},{"location":"mysql-mgr/#master_1","title":"MASTER\u6b7b\u3093\u3060\u5834\u5408\u306e\u78ba\u8a8d","text":"<ul> <li>master\u304c\u6b63\u5e38\u306b\u5207\u308a\u66ff\u3048\u305f\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d</li> </ul> <pre><code># master\n04:49:35 root@localhost[sbtest]&gt; select * from performance_schema.replication_group_members ;\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+\n| CHANNEL_NAME              | MEMBER_ID                            | MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE | MEMBER_VERSION | MEMBER_COMMUNICATION_STACK |\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+\n| group_replication_applier | 74ba497e-f2f1-11ed-9e8e-5254007b60ca | node2       |        3306 | ONLINE       | SECONDARY   | 8.0.33         | XCom                       |\n| group_replication_applier | d7239f8c-f2f1-11ed-aeeb-525400c72882 | node3       |        3306 | ONLINE       | SECONDARY   | 8.0.33         | XCom                       |\n| group_replication_applier | defba275-f2ef-11ed-9eae-525400e752a2 | node1       |        3306 | ONLINE       | PRIMARY     | 8.0.33         | XCom                       |\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+\n3 rows in set (0.00 sec)\n04:50:18 root@localhost[sbtest]&gt; select @@hostname;\n+------------+\n| @@hostname |\n+------------+\n| node1      |\n+------------+\n1 row in set (0.00 sec)\n04:50:23 root@localhost[sbtest]&gt;\n</code></pre> <ul> <li>master\u306emysqld\u3092\u505c\u6b62</li> </ul> <pre><code># master\u306emysqld\u3092\u505c\u6b62\n[root@node1 work]# systemctl stop mysqld\n</code></pre> <ul> <li>slave\u4e0a\u3067\u78ba\u8a8d</li> </ul> <pre><code># slave\u4e0a\u3067\u78ba\u8a8d\n## node2\n04:59:20 root@localhost[(none)]&gt; SELECT MEMBER_ID,MEMBER_HOST,MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+--------------------------------------+-------------+--------------+-------------+\n| MEMBER_ID                            | MEMBER_HOST | MEMBER_STATE | MEMBER_ROLE |\n+--------------------------------------+-------------+--------------+-------------+\n| 74ba497e-f2f1-11ed-9e8e-5254007b60ca | node2       | ONLINE       | PRIMARY     |  &lt;&lt;-- master\u304cnode2\u306b\u5207\u308a\u66ff\u3048\u305f\u3053\u3068\u78ba\u8a8d\u3067\u304d\u305f\u3002\n| d7239f8c-f2f1-11ed-aeeb-525400c72882 | node3       | ONLINE       | SECONDARY   |\n+--------------------------------------+-------------+--------------+-------------+\n2 rows in set (0.00 sec)\n05:00:19 root@localhost[(none)]&gt;\n## node3\n05:01:55 root@localhost[(none)]&gt; SELECT MEMBER_ID,MEMBER_HOST,MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+--------------------------------------+-------------+--------------+-------------+\n| MEMBER_ID                            | MEMBER_HOST | MEMBER_STATE | MEMBER_ROLE |\n+--------------------------------------+-------------+--------------+-------------+\n| 74ba497e-f2f1-11ed-9e8e-5254007b60ca | node2       | ONLINE       | PRIMARY     |  &lt;&lt;-- master\u304cnode2\u306b\u5207\u308a\u66ff\u3048\u305f\u3053\u3068\u78ba\u8a8d\u3067\u304d\u305f\u3002\n| d7239f8c-f2f1-11ed-aeeb-525400c72882 | node3       | ONLINE       | SECONDARY   |\n+--------------------------------------+-------------+--------------+-------------+\n2 rows in set (0.00 sec)\n# mysql\u30ed\u30b0\n## mysqld\u3092\u505c\u6b62\u306e\u969b\n2023-05-16T16:50:39.420249+09:00 13 [Note] [MY-010559] [Repl] Multi-threaded replica statistics for channel 'group_replication_applier': seconds elapsed = 3044; events assigned = 1025; worker queues filled over overrun level = 0; waited due a Worker queue full = 0; waited due the total size = 0; waited at clock conflicts = 433423400 waited (count) when Workers occupied = 0 waited when Workers occupied = 0\n2023-05-16T16:50:56.719644+09:00 41 [Note] [MY-013730] [Server] 'wait_timeout' period of 300 seconds was exceeded for `root`@`localhost`. The idle time since last command was too long.\n2023-05-16T16:50:56.719745+09:00 41 [Note] [MY-010914] [Server] Aborted connection 41 to db: 'unconnected' user: 'root' host: 'localhost' (The client was disconnected by the server because of inactivity.).\n2023-05-16T16:52:39.039940+09:00 13 [Note] [MY-010559] [Repl] Multi-threaded replica statistics for channel 'group_replication_applier': seconds elapsed = 120; events assigned = 1155073; worker queues filled over overrun level = 0; waited due a Worker queue full = 0; waited due the total size = 0; waited at clock conflicts = 1878944800 waited (count) when Workers occupied = 20404 waited when Workers occupied = 11202672000\n2023-05-16T16:54:39.060182+09:00 13 [Note] [MY-010559] [Repl] Multi-threaded replica statistics for channel 'group_replication_applier': seconds elapsed = 120; events assigned = 3861505; worker queues filled over overrun level = 0; waited due a Worker queue full = 0; waited due the total size = 0; waited at clock conflicts = 1881781000 waited (count) when Workers occupied = 134123 waited when Workers occupied = 63201443400\n2023-05-16T16:56:39.016324+09:00 13 [Note] [MY-010559] [Repl] Multi-threaded replica statistics for channel 'group_replication_applier': seconds elapsed = 120; events assigned = 7382017; worker queues filled over overrun level = 0; waited due a Worker queue full = 0; waited due the total size = 0; waited at clock conflicts = 1883981300 waited (count) when Workers occupied = 361966 waited when Workers occupied = 163103230800\n2023-05-16T16:58:58.960486+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] Updating physical connections to other servers'\n2023-05-16T16:58:58.960609+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] Using existing server node 0 host node2:33061'\n2023-05-16T16:58:58.960624+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] Using existing server node 1 host node3:33061'\n2023-05-16T16:58:58.960636+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] Sucessfully installed new site definition. Start synode for this configuration is {dd63b25c 719175 0}, boot key synode is {dd63b25c 719164 0}, configured event horizon=10, my node identifier is 0'\n2023-05-16T16:58:59.735276+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] A configuration change was detected. Sending a Global View Message to all nodes. My node identifier is 0 and my address is node2:33061'\n2023-05-16T16:58:59.739469+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] Group is able to support up to communication protocol version 8.0.27'\n## MGR\u304b\u3089node1\u3092\u9664\u5916\u3055\u308c\u308b\n2023-05-16T16:58:59.739611+09:00 0 [Warning] [MY-011499] [Repl] Plugin group_replication reported: 'Members removed from the group: node1:3306'\n2023-05-16T16:58:59.739642+09:00 0 [System] [MY-011500] [Repl] Plugin group_replication reported: 'Primary server with address node1:3306 left the group. Electing new Primary.'\n2023-05-16T16:58:59.739912+09:00 0 [Note] [MY-013519] [Repl] Plugin group_replication reported: 'Elected primary member gtid_executed: aaaaaaaa-1111-2222-3333-bbbbbbbbbbbb:1-852676'\n2023-05-16T16:58:59.739948+09:00 0 [Note] [MY-013519] [Repl] Plugin group_replication reported: 'Elected primary member applier channel received_transaction_set: aaaaaaaa-1111-2222-3333-bbbbbbbbbbbb:1-852676'\n## \u65b0\u305f\u306a Primary server \u3092node2\u306b\u9078\u629e\u3055\u308c\u305f\n2023-05-16T16:58:59.740007+09:00 0 [System] [MY-011507] [Repl] Plugin group_replication reported: 'A new primary with address node2:3306 was elected. The new primary will execute all previous group transactions before allowing writes.'\n2023-05-16T16:58:59.740757+09:00 0 [System] [MY-011503] [Repl] Plugin group_replication reported: 'Group membership changed to node2:3306, node3:3306 on view 16842195647561739:10.'\n2023-05-16T16:58:59.741723+09:00 46 [System] [MY-011565] [Repl] Plugin group_replication reported: 'Setting super_read_only=ON.'\n2023-05-16T16:58:59.742265+09:00 19 [System] [MY-013731] [Repl] Plugin group_replication reported: 'The member action \"mysql_disable_super_read_only_if_primary\" for event \"AFTER_PRIMARY_ELECTION\" with priority \"1\" will be run.'\n2023-05-16T16:58:59.742318+09:00 19 [System] [MY-011566] [Repl] Plugin group_replication reported: 'Setting super_read_only=OFF.'\n2023-05-16T16:58:59.742649+09:00 19 [System] [MY-013731] [Repl] Plugin group_replication reported: 'The member action \"mysql_start_failover_channels_if_primary\" for event \"AFTER_PRIMARY_ELECTION\" with priority \"10\" will be run.'\n2023-05-16T16:58:59.743420+09:00 46 [System] [MY-011510] [Repl] Plugin group_replication reported: 'This server is working as primary member.'\n2023-05-16T16:58:59.743453+09:00 11 [Note] [MY-011485] [Repl] Plugin group_replication reported: 'Primary had applied all relay logs, disabled conflict detection.'\n2023-05-16T16:59:01.971224+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] Failure reading from fd=56 n=0 from node1:33061'\n2023-05-16T17:05:19.471719+09:00 42 [Note] [MY-013730] [Server] 'wait_timeout' period of 300 seconds was exceeded for `root`@`localhost`. The idle time since last command was too long.\n2023-05-16T17:05:19.472016+09:00 42 [Note] [MY-010914] [Server] Aborted connection 42 to db: 'unconnected' user: 'root' host: 'localhost' (The client was disconnected by the server because of inactivity.).\n## node1\u306emysqld\u3092\u8d77\u52d5\u3057\u3001start group_replication\u3057\u307e\u3057\u305f\u3002\n2023-05-16T17:06:30.683150+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] Adding new node to the configuration: node1:33061'\n2023-05-16T17:06:30.683570+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] Updating physical connections to other servers'\n2023-05-16T17:06:30.683610+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] Using existing server node 0 host node2:33061'\n2023-05-16T17:06:30.683623+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] Using existing server node 1 host node3:33061'\n2023-05-16T17:06:30.683634+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] Using existing server node 2 host node1:33061'\n2023-05-16T17:06:30.683652+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] Sucessfully installed new site definition. Start synode for this configuration is {dd63b25c 834186 0}, boot key synode is {dd63b25c 834175 0}, configured event horizon=10, my node identifier is 0'\n2023-05-16T17:06:30.684085+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] Sender task disconnected from node1:33061'\n2023-05-16T17:06:30.684112+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] Connecting to node1:33061'\n2023-05-16T17:06:30.684368+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] Connected to node1:33061'\n2023-05-16T17:06:31.487931+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] A configuration change was detected. Sending a Global View Message to all nodes. My node identifier is 0 and my address is node2:33061'\n2023-05-16T17:06:37.966205+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] A configuration change was detected. Sending a Global View Message to all nodes. My node identifier is 0 and my address is node2:33061'\n2023-05-16T17:06:38.065989+09:00 0 [Note] [MY-011735] [Repl] Plugin group_replication reported: '[GCS] Group is able to support up to communication protocol version 8.0.27'\n2023-05-16T17:06:38.066211+09:00 0 [Note] [MY-011501] [Repl] Plugin group_replication reported: 'Members joined the group: node1:3306'\n2023-05-16T17:06:38.066410+09:00 0 [System] [MY-011503] [Repl] Plugin group_replication reported: 'Group membership changed to node2:3306, node3:3306, node1:3306 on view 16842195647561739:11.'\n## binlog\u3092node1\u306b\u8ee2\u9001\u3059\u308b\n2023-05-16T17:06:38.092124+09:00 62 [Note] [MY-010462] [Repl] Start binlog_dump to source_thread_id(62) replica_server(1), pos(, 4)\n## node1\u3092MGR\u306e\u4e00\u54e1\u3068\u3057\u3066join\u3057\u307e\u3057\u305f\u3002\n2023-05-16T17:07:48.293141+09:00 0 [System] [MY-011492] [Repl] Plugin group_replication reported: 'The member with address node1:3306 was declared online within the replication group.'\n2023-05-16T17:08:20.217670+09:00 62 [Note] [MY-010914] [Server] Aborted connection 62 to db: 'unconnected' user: 'repl_user' host: '49.212.126.51' (failed on flush_net()).\n2023-05-16T17:10:49.417733+09:00 58 [Note] [MY-013730] [Server] 'wait_timeout' period of 300 seconds was exceeded for `root`@`localhost`. The idle time since last command was too long.\n2023-05-16T17:10:49.418050+09:00 58 [Note] [MY-010914] [Server] Aborted connection 58 to db: 'unconnected' user: 'root' host: 'localhost' (The client was disconnected by the server because of inactivity.).\n</code></pre>"},{"location":"mysql-mgr/#master_2","title":"MASTER\u30b5\u30fc\u30d0\u3092\u969c\u5bb3\u304b\u3089\u5fa9\u6d3b\u306e\u5834\u5408","text":"<ul> <li>\u3053\u306e\u3068\u304d <code>group_replication_bootstrap_group=ON</code> \u3092\u6307\u5b9a\u3057\u307e\u305b\u3093\u3002\u6307\u5b9a\u3059\u308b\u3068\u540c\u3058\u540d\u524d\u306e\u5225\u306e\u30b0\u30eb\u30fc\u30d7\u304c\u4f5c\u6210\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002</li> </ul> <pre><code>-- mysqld\u3092\u8d77\u52d5\n[root@node1 work]# systemctl start mysqld\n-- \u73fe\u72b6\u78ba\u8a8d\n-- offline\u3067\u3042\u308b\u3053\u3068\n04:59:07 root@localhost[(none)]&gt; select * from performance_schema.replication_group_members ;\n+---------------------------+-----------+-------------+-------------+--------------+-------------+----------------+----------------------------+\n| CHANNEL_NAME              | MEMBER_ID | MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE | MEMBER_VERSION | MEMBER_COMMUNICATION_STACK |\n+---------------------------+-----------+-------------+-------------+--------------+-------------+----------------+----------------------------+\n| group_replication_applier |           |             |        NULL | OFFLINE      |             |                |                            |\n+---------------------------+-----------+-------------+-------------+--------------+-------------+----------------+----------------------------+\n1 row in set (0.00 sec)\n-- MGR\u3092\u8d77\u52d5\u3059\u308b\n-- \u3053\u306e\u3068\u304d group_replication_bootstrap_group=ON \u3092\u6307\u5b9a\u3057\u307e\u305b\u3093\u3002\u6307\u5b9a\u3059\u308b\u3068\u540c\u3058\u540d\u524d\u306e\u5225\u306e\u30b0\u30eb\u30fc\u30d7\u304c\u4f5c\u6210\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n04:59:10 root@localhost[(none)]&gt; start group_replication;\nQuery OK, 0 rows affected (8.60 sec)\n-- MGR\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u78ba\u8a8d\n-- \u8d77\u52d5\u76f4\u5f8c\u306eMEMBER_STATE\u304cRECOVERING\u3067\u3042\u308b\u3053\u3068\n-- \u30c7\u30fc\u30bf\u306e\u81ea\u52d5\u540c\u671f\u4e2d\n04:59:25 root@localhost[(none)]&gt; select * from performance_schema.replication_group_members ;\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+\n| CHANNEL_NAME              | MEMBER_ID                            | MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE | MEMBER_VERSION | MEMBER_COMMUNICATION_STACK |\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+\n| group_replication_applier | 74ba497e-f2f1-11ed-9e8e-5254007b60ca | node2       |        3306 | ONLINE       | PRIMARY     | 8.0.33         | XCom                       |\n| group_replication_applier | d7239f8c-f2f1-11ed-aeeb-525400c72882 | node3       |        3306 | ONLINE       | SECONDARY   | 8.0.33         | XCom                       |\n| group_replication_applier | defba275-f2ef-11ed-9eae-525400e752a2 | node1       |        3306 | RECOVERING   | SECONDARY   | 8.0.33         | XCom                       |\n+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+\n3 rows in set (0.00 sec)\n-- \u3057\u3070\u3089\u304f\u5f8c\u72b6\u6cc1\u3092\u78ba\u8a8d\n05:04:19 root@localhost[(none)]&gt; SELECT MEMBER_ID,MEMBER_HOST,MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+--------------------------------------+-------------+--------------+-------------+\n| MEMBER_ID                            | MEMBER_HOST | MEMBER_STATE | MEMBER_ROLE |\n+--------------------------------------+-------------+--------------+-------------+\n| 74ba497e-f2f1-11ed-9e8e-5254007b60ca | node2       | ONLINE       | PRIMARY     |\n| d7239f8c-f2f1-11ed-aeeb-525400c72882 | node3       | ONLINE       | SECONDARY   |\n| defba275-f2ef-11ed-9eae-525400e752a2 | node1       | ONLINE       | SECONDARY   |  &lt;&lt;-- ONLINE\u306b\u623b\u308a\u307e\u3057\u305f\u3002\n+--------------------------------------+-------------+--------------+-------------+\n3 rows in set (0.00 sec)\n05:04:19 root@localhost[(none)]&gt;\n</code></pre>"},{"location":"mysql-mgr/#_5","title":"\u904b\u7528\u4e2d\u306e\u30b0\u30eb\u30fc\u30d7\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8ffd\u52a0","text":"<p>\u30ea\u30ab\u30d0\u30ea\u30d7\u30ed\u30bb\u30b9\u306f MySQL \u306e\u901a\u5e38\u306e\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u5229\u7528\u3057\u3066\u884c\u308f\u308c\u307e\u3059\u3002 \u306a\u306e\u3067\u5fc5\u8981\u306a\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u304c\u30b0\u30eb\u30fc\u30d7\u306e\u3059\u3079\u3066\u306e\u30e1\u30f3\u30d0\u30fc\u3067\u65e2\u306b\u30d1\u30fc\u30b8\u3055\u308c\u3066\u3044\u308b\u3068\u30ea\u30ab\u30d0\u30ea\u30d7\u30ed\u30bb\u30b9\u306f\u5931\u6557\u3057\u307e\u3059\u3002 \u30b0\u30eb\u30fc\u30d7\u306e\u3059\u3079\u3066\u306e\u30e1\u30f3\u30d0\u304b\u3089\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u3092\u30d1\u30fc\u30b8\u3057\u307e\u3059\u3002</p> <pre><code>/* [sv01/sv02/sv03] */\nflush logs;\npurge binary logs before now();\nshow binlog events;\n</code></pre> <p>\u65b0\u3057\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u958b\u59cb\u3057\u3066\u3001</p> <p><pre><code>docker-compose rm -fsv sv04\ndocker-compose up -d sv04\ndocker-compose logs -f sv04\ndocker-compose exec sv04 mysql\n/* [sv04] */\nCREATE USER rpl_user@'%' IDENTIFIED BY 'password';\nGRANT REPLICATION SLAVE ON *.* TO rpl_user@'%';\nCHANGE MASTER TO MASTER_USER='rpl_user', MASTER_PASSWORD='password' FOR CHANNEL 'group_replication_recovery';\nRESET MASTER;\nSTART GROUP_REPLICATION;\n</code></pre> \u30ed\u30b0\u306b\u6b21\u306e\u3088\u3046\u306a\u3082\u306e\u304c\u305f\u304f\u3055\u3093\u51fa\u529b\u3055\u308c\u307e\u3059\u3002</p> <p><pre><code>[ERROR] [MY-010557] [Repl] Error reading packet from server for channel 'group_replication_recovery': Cannot replicate because the master purged required binary logs. Replicate the missing transactions from elsewhere, or provision a new slave from backup. Consider increasing the master's binary log expiration period. To find the missing transactions, see the master's error log or the manual for GTID_SUBTRACT. (server_errno=1236)\n[ERROR] [MY-013114] [Repl] Slave I/O for channel 'group_replication_recovery': Got fatal error 1236 from master when reading data from binary log: 'Cannot replicate because the master purged required binary logs. Replicate the missing transactions from elsewhere, or provision a new slave from backup. Consider increasing the master's binary log expiration period. To find the missing transactions, see the master's error log or the manual for GTID_SUBTRACT.', Error_code: MY-013114\n</code></pre> \u30e1\u30f3\u30d0\u30fc\u306e\u30ea\u30b9\u30c8\u3092\u898b\u3066\u307f\u308b\u3068\u3001\u8ffd\u52a0\u306f\u3055\u308c\u3066\u3044\u307e\u3059\u304c MEMBER_STATE \u304c RECOVERING \u306e\u307e\u307e\u3067\u3059\u3002</p> <p><pre><code>/* [sv04] */\nSELECT MEMBER_HOST, MEMBER_PORT, MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+-------------+-------------+--------------+-------------+\n| MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE |\n+-------------+-------------+--------------+-------------+\n| sv04        |        3306 | RECOVERING   | SECONDARY   |\n| sv01        |        3306 | ONLINE       | PRIMARY     |\n| sv03        |        3306 | ONLINE       | SECONDARY   |\n| sv02        |        3306 | ONLINE       | SECONDARY   |\n+-------------+-------------+--------------+-------------+\n</code></pre> \u3057\u3070\u3089\u304f\u3068 MEMBER_STATE \u306f ERROR \u306b\u306a\u308a\u307e\u3059\u3002</p> <p><pre><code>/* [sv04] */\nSELECT MEMBER_HOST, MEMBER_PORT, MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+-------------+-------------+--------------+-------------+\n| MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE |\n+-------------+-------------+--------------+-------------+\n| sv04        |        3306 | ERROR        |             |\n+-------------+-------------+--------------+-------------+\n</code></pre> \u4ed6\u306e\u30e1\u30f3\u30d0\u30fc\u304b\u3089\u306f\u898b\u3048\u306a\u304f\u306a\u308a\u307e\u3059\u3002</p> <pre><code>/* [sv01] */\nSELECT MEMBER_HOST, MEMBER_PORT, MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+-------------+-------------+--------------+-------------+\n| MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE |\n+-------------+-------------+--------------+-------------+\n| sv01        |        3306 | ONLINE       | PRIMARY     |\n| sv03        |        3306 | ONLINE       | SECONDARY   |\n| sv02        |        3306 | ONLINE       | SECONDARY   |\n+-------------+-------------+--------------+-------------+\n</code></pre> \u6ce8\u610f <p>\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u958b\u59cb\u3057\u305f\u76f4\u5f8c\u306e\u3001\u3059\u3079\u3066\u306e\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u304c\u307e\u3060\u6b8b\u3063\u3066\u3044\u308b\u72b6\u614b\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8ffd\u52a0\u3059\u308b\u3088\u3046\u306a\u3068\u304d\u306f\u5225\u3068\u3057\u3066\u3001\u904b\u7528\u4e2d\u306e\u30b0\u30eb\u30fc\u30d7\u306b\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3068\u304d\u306f\u8ffd\u52a0\u524d\u306b mysqldump \u7684\u306a\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\u3002 \u516c\u5f0f\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3060\u3068 MySQL Enterprise Backup \u3092\u4f7f\u7528\u3059\u308b\u4f8b\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u304c\u3001mysqldump \u3067\u3082\u826f\u3044\u3068\u601d\u3046\u3057\u3001\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e rsync\uff08auto.cnf \u306b\u6ce8\u610f\uff09\u3067\u3082\u5927\u4e08\u592b\u3060\u3068\u601d\u3044\u307e\u3059\u3002</p> <p>\u8a66\u3057\u306b mysqldump \u3057\u3066\u307f\u307e\u3059\u3002</p> <pre><code># \u65b0\u3057\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u958b\u59cb\ndocker-compose rm -fsv sv04\ndocker-compose up -d sv04\ndocker-compose logs -f sv04\n\n# \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\u3084\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u30ea\u30bb\u30c3\u30c8\ndocker-compose exec -T sv04 mysql &lt;&lt;'SQL'\n  CREATE USER rpl_user@'%' IDENTIFIED BY 'password';\n  GRANT REPLICATION SLAVE ON *.* TO rpl_user@'%';\n  CHANGE MASTER TO MASTER_USER='rpl_user', MASTER_PASSWORD='password' FOR CHANNEL 'group_replication_recovery';\n  RESET MASTER;\nSQL\n# \u5225\u306e\u30ce\u30fc\u30c9\u304b\u3089\u30c0\u30f3\u30d7\n[root@node3 work]# mysqldump --all-databases --single-transaction --triggers --routines --events &gt; bk.sql\n# \u30c0\u30f3\u30d7\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u65b0\u30ce\u30fc\u30c9\u306b\u30a4\u30f3\u30dd\u30fc\u30c8\n[root@node1 work]# mysql &lt; bk.sql\n# \u30b3\u30f3\u30c6\u30ca\u306b\u5165\u308b\ndocker-compose exec sv04 mysql\n</code></pre> \u30a4\u30f3\u30dd\u30fc\u30c8\u5931\u6557\u3057\u305f\u5834\u5408 <pre><code># \u30c0\u30f3\u30d7\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u65b0\u30ce\u30fc\u30c9\u306b\u30a4\u30f3\u30dd\u30fc\u30c8\n[root@node1 work]# mysql &lt; bk.sql\nERROR 3546 (HY000) at line 26: @@GLOBAL.GTID_PURGED cannot be changed: the added gtid set must not overlap with @@GLOBAL.GTID_EXECUTED\n[root@node1 work]#\n\n# \u4e0a\u8a18\u306e\u901a\u308a\u5931\u6557\u3057\u305f\u5834\u5408\nhttps://blog.s-style.co.jp/2021/10/8244/\nhttps://acind.hatenablog.jp/entry/2021/03/18/115957\nhttps://gihyo.jp/dev/serial/01/mysql-road-construction-news/0025\n\n# \u30a4\u30f3\u30dd\u30fc\u30c8\u6642GTID\u304c\u7a7a\u3067\u3042\u308b\u5fc5\u8981\u3067\u3059\u3002\n# \u5bfe\u8c61\u306e\u884c\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3059\u308b\n\n[root@node1 work]# vi bk.sql\n## -- SET @@GLOBAL.GTID_PURGED=/*!80000 '+'*/ 'aaaaaaaa-1111-2222-3333-bbbbbbbbbbbb:1-907783:1000006-1118353';\n\n# \u30a4\u30f3\u30dd\u30fc\u30c8\u3059\u308b\n[root@node1 work]# mysql &lt; bk.sql\n</code></pre> <p><code>show master status</code> \u306e <code>Executed_Gtid_Set</code> \u304c\u4ed6\u306e\u30ce\u30fc\u30c9\u3068\u540c\u3058\u306b\u306a\u3063\u3066\u3044\u308c\u3070\u5927\u4e08\u592b\u3067\u3059\u3002</p> <pre><code>/* [sv04] */\nshow master status;\n+---------------+----------+--------------+------------------+------------------------------------------+\n| File          | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set                        |\n+---------------+----------+--------------+------------------+------------------------------------------+\n| binlog.000001 |      151 |              |                  | 470b4daf-6c34-415f-97ad-68cf76ef24e7:1-6 |\n+---------------+----------+--------------+------------------+------------------------------------------+\n04:50:20 root@localhost[(none)]&gt; SHOW GLOBAL VARIABLES LIKE 'gtid_executed';\n+---------------+---------------------------------------------------------------+\n| Variable_name | Value                                                         |\n+---------------+---------------------------------------------------------------+\n| gtid_executed | aaaaaaaa-1111-2222-3333-bbbbbbbbbbbb:1-907784:1000006-1118353 |\n+---------------+---------------------------------------------------------------+\n1 row in set (0.01 sec)\n04:50:27 root@localhost[(none)]&gt;\n</code></pre> <p>\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u958b\u59cb\u3067\u304d\u307e\u3059\u3002</p> <pre><code>/* [sv04] */\nSTART GROUP_REPLICATION;\nSELECT MEMBER_HOST, MEMBER_PORT, MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+-------------+-------------+--------------+-------------+\n| MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE |\n+-------------+-------------+--------------+-------------+\n| sv04        |        3306 | ONLINE       | SECONDARY   |\n| sv01        |        3306 | ONLINE       | PRIMARY     |\n| sv03        |        3306 | ONLINE       | SECONDARY   |\n| sv02        |        3306 | ONLINE       | SECONDARY   |\n+-------------+-------------+--------------+-------------+\n</code></pre>"},{"location":"mysql-mgr/#ip","title":"IP\u30a2\u30c9\u30ec\u30b9\u306e\u30db\u30ef\u30a4\u30c8\u30ea\u30b9\u30c8","text":"<p>MySQL \u306e\u8a2d\u5b9a\u3067 <code>group_replication_group_seeds</code> \u306b\u30b0\u30eb\u30fc\u30d7\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30a2\u30c9\u30ec\u30b9\u3092\u7f85\u5217\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u5225\u306b\u30b0\u30eb\u30fc\u30d7\u306e\u3059\u3079\u3066\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u7f85\u5217\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002 \u3053\u306e\u8a2d\u5b9a\u306f\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u958b\u59cb\u3057\u305f\u3068\u304d\u306b\u3001\u3069\u3053\u304b\u3089\u30b0\u30eb\u30fc\u30d7\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u304b\u306e\u8a2d\u5b9a\u3067\u3059\u3002 \u306a\u306e\u3067\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u751f\u304d\u3066\u3044\u308b\u30e1\u30f3\u30d0\u30fc\u306e\u3044\u305a\u308c\u304b\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308c\u3070\u5927\u4e08\u592b\u3067\u3059\u3002\u306a\u306e\u3067\u3001\u30b0\u30eb\u30fc\u30d7\u3078\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8ffd\u52a0\u306f <code>group_replication_group_seeds</code> \u3092\u3044\u3058\u3089\u306a\u304f\u3066\u3082\u3067\u304d\u307e\u3059\u3002 \u4e00\u65b9\u3001\u30b0\u30eb\u30fc\u30d7\u306b\u53c2\u52a0\u3067\u304d\u308b\u30a2\u30c9\u30ec\u30b9\u306e\u30db\u30ef\u30a4\u30c8\u30ea\u30b9\u30c8\u306e\u8a2d\u5b9a\u3082\u3042\u3063\u3066\uff08<code>group_replication_ip_whitelist</code>\uff09\u3001\u305d\u3053\u306b\u542b\u307e\u308c\u306a\u3044\u30a2\u30c9\u30ec\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f\u30b0\u30eb\u30fc\u30d7\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u306e\u901a\u4fe1\u304c\u62d2\u5426\u3055\u308c\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30b5\u30fc\u30d0\u306e I/F \u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u304c\u8ffd\u52a0\u3055\u308c\u308b\u306e\u3067\u3001\u8907\u6570\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5206\u6563\u3055\u308c\u308b\u3068\u304b\u3067\u306f\u306a\u3044\u9650\u308a\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u307e\u307e\u3067\u826f\u3055\u305d\u3046\u3067\u3059\u3002</p>"},{"location":"mysql-mgr/#monitoring-group-replication","title":"Monitoring Group Replication","text":"<p>\u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u3084\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a73\u7d30\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30b9\u30ad\u30fc\u30de\u304b\u3089\u5f97\u3089\u308c\u307e\u3059\u3002</p> <pre><code>/* \u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u306b\u95a2\u3059\u308b\u60c5\u5831 */\nselect * from performance_schema.replication_group_member_stats \\G\nselect * from performance_schema.replication_group_members;\n/* \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30c1\u30e3\u30f3\u30cd\u30eb\u306b\u95a2\u3059\u308b\u60c5\u5831 */\nselect * from performance_schema.replication_connection_status \\G\nselect * from performance_schema.replication_applier_status;\n</code></pre>"},{"location":"mysql-mgr/#2","title":"\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30c1\u30e3\u30f3\u30cd\u30eb\u306b\u306f\u6b21\u306e\u7528\u9014\u306e2\u3064\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002","text":"<ul> <li>group_replication_recovery<ul> <li>\u5206\u6563\u30ea\u30ab\u30d0\u30ea\u30d5\u30a7\u30fc\u30ba\uff08\u30ea\u30ab\u30d0\u30ea\u30d7\u30ed\u30bb\u30b9\uff09\u3067\u4f7f\u7528\u3055\u308c\u308b</li> <li>\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3057\u305f\u3068\u304d\u3084\u6545\u969c\u30ce\u30fc\u30c9\u304c\u5fa9\u5e30\u3057\u305f\u3068\u304d\u306e\u540c\u671f\u7528</li> </ul> </li> <li>group_replication_applier<ul> <li>\u30b0\u30eb\u30fc\u30d7\u3067\u5b9f\u884c\u3055\u308c\u305f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u9069\u7528\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3055\u308c\u308b</li> <li>\u8981\u3059\u308b\u306b\u5e73\u6642\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3</li> </ul> </li> </ul>"},{"location":"mysql-mgr/#_6","title":"\u30b0\u30eb\u30fc\u30d7\u306e\u30e1\u30f3\u30d0\u306b\u95a2\u3059\u308b\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30c6\u30fc\u30d6\u30eb\u306e\u30d3\u30e5\u30fc\u306b\u3064\u3044\u3066\u3002","text":"<ul> <li>replication_group_member_stats<ul> <li>\u30e1\u30f3\u30d0\u30fc\u3054\u3068\u306e\u5f85\u6a5f\u4e2d\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u6570\u3068\u304b\u51e6\u7406\u6e08\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u6570\u3068\u304b\u306e\u7d71\u8a08</li> <li>\u7279\u5b9a\u306e\u30e1\u30f3\u30d0\u30fc\u304c\u9045\u308c\u3066\u3044\u308b\u3068\u304b\u3067\u30ad\u30e5\u30fc\u306b\u6e9c\u307e\u3063\u3066\u308b\u306e\u3092\u76e3\u8996\u3057\u305f\u308a\u3059\u308b\u306e\u306b\u4f7f\u3048\u308b</li> </ul> </li> <li>replication_group_members<ul> <li>\u30e1\u30f3\u30d0\u30fc\u306e\u30b9\u30c6\u30fc\u30bf\u30b9</li> </ul> </li> </ul>"},{"location":"mysql-mgr/#replication_group_members","title":"<code>replication_group_members</code> \u3067\u8868\u793a\u3055\u308c\u308b\u30e1\u30f3\u30d0\u30fc\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3002","text":"<ul> <li>ONLINE<ul> <li>\u540c\u671f\u3055\u308c\u3066\u3044\u308b</li> </ul> </li> <li>RECOVERING<ul> <li>\u30ea\u30ab\u30d0\u30ea\u30d7\u30ed\u30bb\u30b9\u4e2d</li> </ul> </li> <li>OFFLINE<ul> <li>\u30e1\u30f3\u30d0\u30fc\u306f\u30b0\u30eb\u30fc\u30d7\u306b\u5c5e\u3057\u3066\u3044\u306a\u3044</li> <li>\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u30ed\u30fc\u30c9\u6e08\u3067\u30b0\u30eb\u30fc\u30d7\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u958b\u59cb\u3057\u3066\u3044\u306a\u3044\u3068\u304d</li> </ul> </li> <li>ERROR<ul> <li>\u30ea\u30ab\u30d0\u30ea\u30d7\u30ed\u30bb\u30b9\u3084\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u9069\u7528\u4e2d\u306b\u30a8\u30e9\u30fc</li> </ul> </li> <li>UNREACHABLE<ul> <li>\u30e1\u30f3\u30d0\u30fc\u304c\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7684\u306b\u5230\u9054\u4e0d\u80fd</li> </ul> </li> </ul> <p>\u30b5\u30fc\u30d3\u30b9\u76e3\u8996\u3068\u304b\u3059\u308b\u306a\u3089 <code>ONLINE</code> \u4ee5\u5916\u306f\u306a\u306b\u304b\u3057\u3089\u7570\u5e38\u3068\u307f\u306a\u3057\u3066\u826f\u3055\u305d\u3046\u3067\u3059\u3002</p>"},{"location":"mysql-mgr/#keepalived","title":"keepalived","text":"keepalived.conf <pre><code># node1\n[root@node1 work]# cat /etc/keepalived/keepalived.conf\n! Configuration File for keepalived\n\nglobal_defs {\nrouter_id MGR_NODE1            #\u662f\u8fd0\u884ckeepalived\u7684\u4e00\u4e2a\u8868\u793a\uff0c\u591a\u4e2a\u96c6\u7fa4\u8bbe\u7f6e\u4e0d\u540c\u3002\nnotification_email {           #\u8bbe\u7f6e keepalived \u5728\u53d1\u751f\u4e8b\u4ef6\uff08\u6bd4\u5982\u5207\u6362\uff09\u7684\u65f6\u5019\uff0c\u9700\u8981\u53d1\u9001\u5230\u7684email\u5730\u5740\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\uff0c\u6bcf\u884c\u4e00\u4e2a\u3002\ny-ryu@sakura.ad.jp\n   }\nnotification_email_from node3  #\u8bbe\u7f6e\u901a\u77e5\u90ae\u4ef6\u53d1\u9001\u6765\u81ea\u4e8e\u54ea\u91cc\uff0c\u5982\u679c\u672c\u5730\u5f00\u542f\u4e86sendmail\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0a\u9762\u7684\u9ed8\u8ba4\u503c\u3002\n# smtp_server 192.168.200.1    #\u6307\u5b9a\u53d1\u9001\u90ae\u4ef6\u7684smtp\u670d\u52a1\u5668\u3002\nsmtp_connect_timeout 30        #\u8bbe\u7f6esmtp\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2\u3002\n}\n#\u6307\u5b9amysql\u670d\u52a1\u68c0\u6d4b\u811a\u672c\nvrrp_script chk_mysql {\nscript \"/etc/keepalived/chk_mysql.sh\" #\u811a\u672c\u8def\u5f84\ninterval 2            #\u811a\u672c\u68c0\u6d4b\u9891\u7387\nweight -5             #\u811a\u672c\u6267\u884c\u8fd4\u56de\u503c =0 \uff0c\u4f18\u5148\u7ea7\u4e0d\u53d8\u3002 !=0 \u65f6\u4f18\u5148\u7ea7 -5\nfall 2                #\u5982\u679c\u8fde\u7eed\u4e24\u6b21\u68c0\u6d4b\u5931\u8d25\uff0c\u8ba4\u4e3a\u8282\u70b9\u670d\u52a1\u4e0d\u53ef\u7528\nrise 1                #\u5982\u679c\u8fde\u7eed2\u6b21\u68c0\u67e5\u6210\u529f\u5219\u8ba4\u4e3a\u8282\u70b9\u6b63\u5e38\n}\n#\u76d1\u6d4bmysql \u662f\u5426\u662fmaster\nvrrp_script chk_mysql_master {\nscript \"/etc/keepalived/chk_mysql_master.sh\"\ninterval 2\nweight 10             #\u811a\u672c\u6267\u884c\u8fd4\u56de\u503c =0 \uff0c\u4f18\u5148\u7ea7\u52a0 10\u3002 !=0 \u65f6\u4f18\u5148\u7ea7\u4e0d\u53d8\u3002\n}\n# \u7b80\u6613\u68c0\u6d4b\nvrrp_script check_run {\nscript \"/etc/keepalived/mysql_check.sh\"\ninterval 5                              #5\u79d2\u6267\u884c\u4e00\u6b21\u811a\u672c\n}\nvrrp_instance VI_1 {\nstate BACKUP          #\u6307\u5b9a\u5b9e\u4f8b\u521d\u59cb\u72b6\u6001\uff0c\u5b9e\u9645\u7684MASTER\u548cBACKUP\u662f\u9009\u4e3e\u51b3\u5b9a\u7684\u3002\ninterface eth0        #\u6307\u5b9a\u5b9e\u4f8b\u7ed1\u5b9a\u7684\u7f51\u5361\nvirtual_router_id 88  #\u8bbe\u7f6eVRID\u6807\u8bb0(0..255)\npriority 90           #\u8bbe\u7f6e\u4f18\u5148\u7ea7\uff0c\u4f18\u5148\u7ea7\u9ad8\u7684\u4f1a\u88ab\u7ade\u9009\u4e3aMaster\nadvert_int 1          #\u68c0\u67e5\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u9ed8\u8ba41s\nauthentication {      #\u8282\u70b9\u95f4\u7684\u8ba4\u8bc1\uff0c\u6240\u6709\u7684\u5fc5\u987b\u4e00\u81f4\nauth_type PASS\n        auth_pass 1111\n}\nvirtual_ipaddress {   #\u8bbe\u7f6eVIP\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\uff0c\u7528\u4e8e\u5207\u6362\u65f6\u7684\u5730\u5740\u7ed1\u5b9a\u3002\nVIP               # VIP\u5730\u5740\uff08\u8be5ip\u4e3a\u865a\u62df\u51fa\u6765\u7684vip\u5730\u5740)\n}\ntrack_script { #\u6307\u5b9a\u524d\u9762\u811a\u672c\u7684\u540d\u5b57\n# check_run\nchk_mysql\n        chk_mysql_master\n    }\n}\n# node2\n[root@node2 ~]# cat /etc/keepalived/keepalived.conf\n! Configuration File for keepalived\n\nglobal_defs {\nrouter_id MGR_NODE2            #\u662f\u8fd0\u884ckeepalived\u7684\u4e00\u4e2a\u8868\u793a\uff0c\u591a\u4e2a\u96c6\u7fa4\u8bbe\u7f6e\u4e0d\u540c\u3002\nnotification_email {           #\u8bbe\u7f6e keepalived \u5728\u53d1\u751f\u4e8b\u4ef6\uff08\u6bd4\u5982\u5207\u6362\uff09\u7684\u65f6\u5019\uff0c\u9700\u8981\u53d1\u9001\u5230\u7684email\u5730\u5740\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\uff0c\u6bcf\u884c\u4e00\u4e2a\u3002\ny-ryu@sakura.ad.jp\n   }\nnotification_email_from node3  #\u8bbe\u7f6e\u901a\u77e5\u90ae\u4ef6\u53d1\u9001\u6765\u81ea\u4e8e\u54ea\u91cc\uff0c\u5982\u679c\u672c\u5730\u5f00\u542f\u4e86sendmail\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0a\u9762\u7684\u9ed8\u8ba4\u503c\u3002\n# smtp_server 192.168.200.1    #\u6307\u5b9a\u53d1\u9001\u90ae\u4ef6\u7684smtp\u670d\u52a1\u5668\u3002\nsmtp_connect_timeout 30        #\u8bbe\u7f6esmtp\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2\u3002\n}\n#\u6307\u5b9amysql\u670d\u52a1\u68c0\u6d4b\u811a\u672c\nvrrp_script chk_mysql {\nscript \"/etc/keepalived/chk_mysql.sh\" #\u811a\u672c\u8def\u5f84\ninterval 2                            #\u811a\u672c\u68c0\u6d4b\u9891\u7387\nweight -5                             #\u811a\u672c\u6267\u884c\u8fd4\u56de\u503c =0 \uff0c\u4f18\u5148\u7ea7\u4e0d\u53d8\u3002 !=0 \u65f6\u4f18\u5148\u7ea7 -5\nfall 2                                #\u5982\u679c\u8fde\u7eed\u4e24\u6b21\u68c0\u6d4b\u5931\u8d25\uff0c\u8ba4\u4e3a\u8282\u70b9\u670d\u52a1\u4e0d\u53ef\u7528\nrise 1                                #\u5982\u679c\u8fde\u7eed2\u6b21\u68c0\u67e5\u6210\u529f\u5219\u8ba4\u4e3a\u8282\u70b9\u6b63\u5e38\n}\n#\u76d1\u6d4bmysql \u662f\u5426\u662fmaster\nvrrp_script chk_mysql_master {\nscript \"/etc/keepalived/chk_mysql_master.sh\"\ninterval 2\nweight 10                             #\u811a\u672c\u6267\u884c\u8fd4\u56de\u503c =0 \uff0c\u4f18\u5148\u7ea7\u52a0 10\u3002 !=0 \u65f6\u4f18\u5148\u7ea7\u4e0d\u53d8\u3002\n}\n# \u7b80\u6613\u68c0\u6d4b\nvrrp_script check_run {\nscript \"/etc/keepalived/mysql_check.sh\"\ninterval 5                              #5\u79d2\u6267\u884c\u4e00\u6b21\u811a\u672c\n}\nvrrp_instance VI_1 {\nstate BACKUP          #\u6307\u5b9a\u5b9e\u4f8b\u521d\u59cb\u72b6\u6001\uff0c\u5b9e\u9645\u7684MASTER\u548cBACKUP\u662f\u9009\u4e3e\u51b3\u5b9a\u7684\u3002\ninterface eth0        #\u6307\u5b9a\u5b9e\u4f8b\u7ed1\u5b9a\u7684\u7f51\u5361\nvirtual_router_id 88  #\u8bbe\u7f6eVRID\u6807\u8bb0(0..255)\npriority 10           #\u8bbe\u7f6e\u4f18\u5148\u7ea7\uff0c\u4f18\u5148\u7ea7\u9ad8\u7684\u4f1a\u88ab\u7ade\u9009\u4e3aMaster\nadvert_int 1          #\u68c0\u67e5\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u9ed8\u8ba41s\nauthentication {      #\u8282\u70b9\u95f4\u7684\u8ba4\u8bc1\uff0c\u6240\u6709\u7684\u5fc5\u987b\u4e00\u81f4\nauth_type PASS\n        auth_pass 1111\n}\nvirtual_ipaddress {   #\u8bbe\u7f6eVIP\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\uff0c\u7528\u4e8e\u5207\u6362\u65f6\u7684\u5730\u5740\u7ed1\u5b9a\u3002\nVIP               # VIP\u5730\u5740\uff08\u8be5ip\u4e3a\u865a\u62df\u51fa\u6765\u7684vip\u5730\u5740)\n}\ntrack_script { #\u6307\u5b9a\u524d\u9762\u811a\u672c\u7684\u540d\u5b57\n# check_run\nchk_mysql\n        chk_mysql_master\n    }\n}\n[root@node2 ~]#\n# node3\n[root@node3 work]# cat /etc/keepalived/keepalived.conf\n! Configuration File for keepalived\n\nglobal_defs {\nnotification_email {           #\u8bbe\u7f6e keepalived \u5728\u53d1\u751f\u4e8b\u4ef6\uff08\u6bd4\u5982\u5207\u6362\uff09\u7684\u65f6\u5019\uff0c\u9700\u8981\u53d1\u9001\u5230\u7684email\u5730\u5740\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\uff0c\u6bcf\u884c\u4e00\u4e2a\u3002\ny-ryu@sakura.ad.jp\n   }\nnotification_email_from node3  #\u8bbe\u7f6e\u901a\u77e5\u90ae\u4ef6\u53d1\u9001\u6765\u81ea\u4e8e\u54ea\u91cc\uff0c\u5982\u679c\u672c\u5730\u5f00\u542f\u4e86sendmail\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0a\u9762\u7684\u9ed8\u8ba4\u503c\u3002\n# smtp_server 192.168.200.1    #\u6307\u5b9a\u53d1\u9001\u90ae\u4ef6\u7684smtp\u670d\u52a1\u5668\u3002\nsmtp_connect_timeout 30        #\u8bbe\u7f6esmtp\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2\u3002\nrouter_id MGR_NODE3            #\u662f\u8fd0\u884ckeepalived\u7684\u4e00\u4e2a\u8868\u793a\uff0c\u591a\u4e2a\u96c6\u7fa4\u8bbe\u7f6e\u4e0d\u540c\u3002\n}\n#\u6307\u5b9amysql\u670d\u52a1\u68c0\u6d4b\u811a\u672c\nvrrp_script chk_mysql {\nscript \"/etc/keepalived/chk_mysql.sh\" #\u811a\u672c\u8def\u5f84\ninterval 2            #\u811a\u672c\u68c0\u6d4b\u9891\u7387\nweight -5             #\u811a\u672c\u6267\u884c\u8fd4\u56de\u503c =0 \uff0c\u4f18\u5148\u7ea7\u4e0d\u53d8\u3002 !=0 \u65f6\u4f18\u5148\u7ea7 -5\nfall 2                #\u5982\u679c\u8fde\u7eed\u4e24\u6b21\u68c0\u6d4b\u5931\u8d25\uff0c\u8ba4\u4e3a\u8282\u70b9\u670d\u52a1\u4e0d\u53ef\u7528\nrise 1                #\u5982\u679c\u8fde\u7eed2\u6b21\u68c0\u67e5\u6210\u529f\u5219\u8ba4\u4e3a\u8282\u70b9\u6b63\u5e38\n}\n#\u76d1\u6d4bmysql \u662f\u5426\u662fmaster\nvrrp_script chk_mysql_master {\nscript \"/etc/keepalived/chk_mysql_master.sh\"\ninterval 2\nweight 10             #\u811a\u672c\u6267\u884c\u8fd4\u56de\u503c =0 \uff0c\u4f18\u5148\u7ea7\u52a0 10\u3002 !=0 \u65f6\u4f18\u5148\u7ea7\u4e0d\u53d8\u3002\n}\n# \u7b80\u6613\u68c0\u6d4b\nvrrp_script check_run {\nscript \"/etc/keepalived/mysql_check.sh\"\ninterval 5                              #5\u79d2\u6267\u884c\u4e00\u6b21\u811a\u672c\n}\nvrrp_instance VI_1 {\nstate MASTER          #\u6307\u5b9a\u5b9e\u4f8b\u521d\u59cb\u72b6\u6001\uff0c\u5b9e\u9645\u7684MASTER\u548cBACKUP\u662f\u9009\u4e3e\u51b3\u5b9a\u7684\u3002\ninterface eth0        #\u6307\u5b9a\u5b9e\u4f8b\u7ed1\u5b9a\u7684\u7f51\u5361\nvirtual_router_id 88  #\u8bbe\u7f6eVRID\u6807\u8bb0(0..255)\npriority 100          #\u8bbe\u7f6e\u4f18\u5148\u7ea7\uff0c\u4f18\u5148\u7ea7\u9ad8\u7684\u4f1a\u88ab\u7ade\u9009\u4e3aMaster\nadvert_int 1          #\u68c0\u67e5\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u9ed8\u8ba41s\nauthentication {      #\u8282\u70b9\u95f4\u7684\u8ba4\u8bc1\uff0c\u6240\u6709\u7684\u5fc5\u987b\u4e00\u81f4\nauth_type PASS\n        auth_pass 1111\n}\nvirtual_ipaddress {       #\u8bbe\u7f6eVIP\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\uff0c\u7528\u4e8e\u5207\u6362\u65f6\u7684\u5730\u5740\u7ed1\u5b9a\u3002\nVIP               # VIP\u5730\u5740\uff08\u8be5ip\u4e3a\u865a\u62df\u51fa\u6765\u7684vip\u5730\u5740)\n}\ntrack_script { #\u6307\u5b9a\u524d\u9762\u811a\u672c\u7684\u540d\u5b57\n# check_run\nchk_mysql\n        chk_mysql_master\n    }\n}\n</code></pre> chk_mysql.sh <pre><code>[root@node3 work]# cat /etc/keepalived/chk_mysql.sh\n#!/bin/bash\nmysql --defaults-file=/root/.my.cnf -e \"show status\" &amp;&gt;/dev/null\n\nif [ $? -ne 0 ] ;then\nsystemctl stop keepalived\nfi\n</code></pre> chk_mysql_master.sh <pre><code>[root@node3 work]# cat /etc/keepalived/chk_mysql_master.sh\n#!/bin/bash\nPATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin\nexport PATH\n\npriuuid=`mysql --defaults-file=/root/.my.cnf -e \"SELECT * FROM performance_schema.replication_group_members WHERE MEMBER_ID = (SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME= 'group_replication_primary_member')\" |awk 'NR==2{print}'|awk -F\" \" '{print $2}'`\nuuid=`mysql --defaults-file=/root/.my.cnf -e \"select @@global.server_uuid\" |awk 'NR==2{print}'`\nif [ $priuuid == $uuid ]; then\nexit 0\nelse\nexit 1\nfi\n</code></pre>"},{"location":"mysql-mgr/#mysqldmysql","title":"mysqld/mysql\u30b5\u30fc\u30d0\u304c\u843d\u3061\u305f\u5834\u5408\u306e\u5fa9\u65e7\u624b\u9806","text":""},{"location":"mysql-mgr/#mgr_1","title":"\u843d\u3061\u305f\u30b5\u30fc\u30d0\u3092MGR\u306b\u53c2\u52a0\u3059\u308b","text":"<pre><code># mysqld\u3092\u5148\u306b\u8d77\u52d5\u3059\u308b\n[root@node3 ~]# systemctl start mysqld\n# mysql\u8d77\u52d5\u5f8c\u3001\u72b6\u6cc1\u78ba\u8a8d\n03:15:46 root@localhost[(none)]&gt; SELECT MEMBER_ID,MEMBER_HOST,MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+-----------+-------------+--------------+-------------+\n| MEMBER_ID | MEMBER_HOST | MEMBER_STATE | MEMBER_ROLE |\n+-----------+-------------+--------------+-------------+\n|           |             | OFFLINE      |             |\n+-----------+-------------+--------------+-------------+\n1 row in set (0.00 sec)\n# mysql\u8d77\u52d5\u5f8c\u3001\u8a72\u5f53mysql\u3092MGR\u306b\u53c2\u52a0\u3055\u305b\u308b\u3002\n03:15:48 root@localhost[(none)]&gt; start group_replication;\nQuery OK, 0 rows affected (2.75 sec)\n# MGR\u306b\u78ba\u8a8d\n03:15:52 root@localhost[(none)]&gt; SELECT MEMBER_ID,MEMBER_HOST,MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+--------------------------------------+-------------+--------------+-------------+\n| MEMBER_ID                            | MEMBER_HOST | MEMBER_STATE | MEMBER_ROLE |\n+--------------------------------------+-------------+--------------+-------------+\n| 74ba497e-f2f1-11ed-9e8e-5254007b60ca | node2       | ONLINE       | SECONDARY   |\n| d7239f8c-f2f1-11ed-aeeb-525400c72882 | node3       | RECOVERING   | SECONDARY   |\n| defba275-f2ef-11ed-9eae-525400e752a2 | node1       | ONLINE       | PRIMARY     |\n+--------------------------------------+-------------+--------------+-------------+\n3 rows in set (0.00 sec)\n# \u3057\u3070\u3089\u304f\u3068RECOVERING\u304b\u3089ONLINE\u306b\u306a\u308b\n03:19:47 root@localhost[(none)]&gt; SELECT MEMBER_ID,MEMBER_HOST,MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+--------------------------------------+-------------+--------------+-------------+\n| MEMBER_ID                            | MEMBER_HOST | MEMBER_STATE | MEMBER_ROLE |\n+--------------------------------------+-------------+--------------+-------------+\n| 74ba497e-f2f1-11ed-9e8e-5254007b60ca | node2       | ONLINE       | SECONDARY   |\n| d7239f8c-f2f1-11ed-aeeb-525400c72882 | node3       | ONLINE       | SECONDARY   |\n| defba275-f2ef-11ed-9eae-525400e752a2 | node1       | ONLINE       | PRIMARY     |\n+--------------------------------------+-------------+--------------+-------------+\n3 rows in set (0.00 sec)\n03:21:05 root@localhost[(none)]&gt;\n</code></pre>"},{"location":"mysql-mgr/#_7","title":"\u8d77\u52d5\u9806\u756a","text":"<ol> <li>mysql\u3092MGR\u306b\u53c2\u52a0\u3055\u305b\u308b</li> <li>keepalived\u3092\u8d77\u52d5\u3059\u308b</li> </ol> <pre><code># ONLINE\u306b\u306a\u3063\u305f\u5f8c\u3001keepalived\u3092\u8d77\u52d5\u3059\u308b\n[root@node3 ~]# systemctl start keepalived.service\n# \u8d77\u52d5\u5f8cstatus\u78ba\u8a8d\u3059\u308b\n[root@node3 ~]# systemctl status keepalived.service\n\u25cf keepalived.service - LVS and VRRP High Availability Monitor\n   Loaded: loaded (/usr/lib/systemd/system/keepalived.service; enabled; vendor preset: disabled)\nActive: active (running) since Fri 2023-05-19 15:15:27 JST; 7min ago\n  Process: 3765 ExecStart=/usr/sbin/keepalived $KEEPALIVED_OPTIONS (code=exited, status=0/SUCCESS)\nMain PID: 3766 (keepalived)\nTasks: 2 (limit: 1031248)\nMemory: 2.7M\n   CGroup: /system.slice/keepalived.service\n           \u251c\u25003766 /usr/sbin/keepalived -D\n           \u2514\u25003767 /usr/sbin/keepalived -D\n\nMay 19 15:15:27 node3 systemd[1]: Starting LVS and VRRP High Availability Monitor...\nMay 19 15:15:27 node3 systemd[1]: Started LVS and VRRP High Availability Monitor.\n[root@node3 ~]#\n</code></pre>"},{"location":"mysql-mgr/#clone","title":"clone","text":"<ul> <li>\u30ea\u30e2\u30fc\u30c8\u30c7\u30fc\u30bf\u306e\u30af\u30ed\u30fc\u30cb\u30f3\u30b0</li> </ul> <pre><code>CLONE INSTANCE FROM 'user'@'host':port\nIDENTIFIED BY 'password'\n[DATA DIRECTORY [=] 'clone_dir']\n[REQUIRE [NO] SSL];\n</code></pre> <ul> <li><code>user</code> \u306f\u3001\u30c9\u30ca\u30fc MySQL \u30b5\u30fc\u30d0\u30fc\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u306e\u30af\u30ed\u30fc\u30f3\u30e6\u30fc\u30b6\u30fc\u3067\u3059\u3002</li> <li><code>password</code> \u306f user \u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3067\u3059\u3002</li> <li><code>host</code> \u306f\u3001\u30c9\u30ca\u30fc MySQL \u30b5\u30fc\u30d0\u30fc\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e hostname \u30a2\u30c9\u30ec\u30b9\u3067\u3059\u3002 \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30d7\u30ed\u30c8\u30b3\u30eb\u30d0\u30fc\u30b8\u30e7\u30f3 6 (IPv6) \u30a2\u30c9\u30ec\u30b9\u5f62\u5f0f\u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002 \u304b\u308f\u308a\u306b\u3001IPv6 \u30a2\u30c9\u30ec\u30b9\u306e\u30a8\u30a4\u30ea\u30a2\u30b9\u3092\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002 IPv4 \u30a2\u30c9\u30ec\u30b9\u306f\u305d\u306e\u307e\u307e\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002</li> <li><code>port</code> \u306f\u3001\u30c9\u30ca\u30fc MySQL \u30b5\u30fc\u30d0\u30fc\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e port \u756a\u53f7\u3067\u3059\u3002 (mysqlx_port \u3067\u6307\u5b9a\u3055\u308c\u305f X \u30d7\u30ed\u30c8\u30b3\u30eb \u30dd\u30fc\u30c8\u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002 MySQL Router \u3092\u4ecb\u3057\u305f\u30c9\u30ca\u30fc MySQL \u30b5\u30fc\u30d0\u30fc\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u306e\u63a5\u7d9a\u3082\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002)</li> <li><code>DATA DIRECTORY [=] 'clone_dir'</code>\u306f\u3001\u30af\u30ed\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u30c7\u30fc\u30bf\u306e\u53d7\u4fe1\u8005\u4e0a\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u53e5\u3067\u3059\u3002 \u3053\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u3001\u53d7\u4fe1\u8005\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306e\u65e2\u5b58\u306e\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3057\u306a\u3044\u5834\u5408\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002 \u7d76\u5bfe\u30d1\u30b9\u304c\u5fc5\u8981\u3067\u3042\u308a\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u5b58\u5728\u3057\u3066\u3044\u306a\u3044\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 MySQL \u30b5\u30fc\u30d0\u30fc\u306b\u306f\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\u306b\u5fc5\u8981\u306a\u66f8\u8fbc\u307f\u30a2\u30af\u30bb\u30b9\u6a29\u304c\u5fc5\u8981\u3067\u3059\u3002 \u30aa\u30d7\u30b7\u30e7\u30f3\u306e <code>DATA DIRECTORY [=] 'clone_dir'</code>\u53e5\u3092\u4f7f\u7528\u3057\u306a\u3044\u5834\u5408\u3001\u30af\u30ed\u30fc\u30cb\u30f3\u30b0\u64cd\u4f5c\u3067\u306f\u3001\u53d7\u4fe1\u8005\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306e\u65e2\u5b58\u306e\u30c7\u30fc\u30bf\u304c\u524a\u9664\u3055\u308c\u3001\u30af\u30ed\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306b\u7f6e\u304d\u63db\u3048\u3089\u308c\u3001\u305d\u306e\u5f8c\u30b5\u30fc\u30d0\u30fc\u304c\u81ea\u52d5\u7684\u306b\u518d\u8d77\u52d5\u3055\u308c\u307e\u3059\u3002</li> <li><code>[REQUIRE [NO] SSL]</code>\u306f\u3001\u30af\u30ed\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3092\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7d4c\u7531\u3067\u8ee2\u9001\u3059\u308b\u3068\u304d\u306b\u3001\u6697\u53f7\u5316\u3055\u308c\u305f\u63a5\u7d9a\u3092\u4f7f\u7528\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u660e\u793a\u7684\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002 \u660e\u793a\u7684\u306a\u6307\u5b9a\u304c\u6e80\u305f\u3055\u308c\u306a\u3044\u5834\u5408\u306f\u3001\u30a8\u30e9\u30fc\u304c\u8fd4\u3055\u308c\u307e\u3059\u3002 SSL \u53e5\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u3001\u30af\u30ed\u30fc\u30f3\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u6697\u53f7\u5316\u3055\u308c\u305f\u63a5\u7d9a\u3092\u78ba\u7acb\u3057\u3088\u3046\u3068\u3057\u3001\u30bb\u30ad\u30e5\u30a2\u306a\u63a5\u7d9a\u8a66\u884c\u304c\u5931\u6557\u3057\u305f\u5834\u5408\u306f\u30bb\u30ad\u30e5\u30a2\u3067\u306a\u3044\u63a5\u7d9a\u306b\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u3057\u307e\u3059\u3002 \u6697\u53f7\u5316\u30c7\u30fc\u30bf\u3092\u30af\u30ed\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u5834\u5408\u306f\u3001\u3053\u306e\u53e5\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u306b\u95a2\u4fc2\u306a\u304f\u3001\u30bb\u30ad\u30e5\u30a2\u306a\u63a5\u7d9a\u304c\u5fc5\u8981\u3067\u3059\u3002 \u8a73\u7d30\u306f\u3001\u30af\u30ed\u30fc\u30cb\u30f3\u30b0\u7528\u306e\u6697\u53f7\u5316\u3055\u308c\u305f\u63a5\u7d9a\u306e\u69cb\u6210\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002</li> </ul> \u6ce8\u8a18 <ul> <li>\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001\u30c9\u30ca\u30fc MySQL \u30b5\u30fc\u30d0\u30fc\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u5b58\u5728\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\u306e InnoDB \u30c6\u30fc\u30d6\u30eb\u304a\u3088\u3073\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u306f\u3001\u53d7\u4fe1\u8005 MySQL \u30b5\u30fc\u30d0\u30fc\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30af\u30ed\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002 DATA DIRECTORY [=] 'clone_dir'\u53e5\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u6307\u5b9a\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30af\u30ed\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002</li> <li>\u30c9\u30ca\u30fc MySQL \u30b5\u30fc\u30d0\u30fc\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5916\u306b\u3042\u308b\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\u306e InnoDB \u30c6\u30fc\u30d6\u30eb\u304a\u3088\u3073\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u306f\u3001\u53d7\u4fe1\u8005 MySQL \u30b5\u30fc\u30d0\u30fc\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u540c\u3058\u30d1\u30b9\u306b\u30af\u30ed\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002 \u30c6\u30fc\u30d6\u30eb\u307e\u305f\u306f\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u304c\u3059\u3067\u306b\u5b58\u5728\u3059\u308b\u5834\u5408\u306f\u3001\u30a8\u30e9\u30fc\u304c\u5831\u544a\u3055\u308c\u307e\u3059\u3002</li> <li>\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001InnoDB \u30b7\u30b9\u30c6\u30e0\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u3001redo \u30ed\u30b0\u304a\u3088\u3073 undo \u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u306f\u3001\u30c9\u30ca\u30fc\u306b\u69cb\u6210\u3055\u308c\u3066\u3044\u308b\u306e\u3068\u540c\u3058\u5834\u6240\u306b\u30af\u30ed\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u307e\u3059 (\u305d\u308c\u305e\u308c\u3001innodb_data_home_dir \u304a\u3088\u3073 innodb_data_file_path\u3001innodb_log_group_home_dir \u304a\u3088\u3073 innodb_undo_directory \u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059)\u3002 DATA DIRECTORY [=] 'clone_dir'\u53e5\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3001\u3053\u308c\u3089\u306e\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u304a\u3088\u3073\u30ed\u30b0\u306f\u6307\u5b9a\u3055\u308c\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30af\u30ed\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002</li> </ul> <pre><code>[root@node1 backup]# grep clone /etc/my.cnf\nplugin-load=mysql_clone.so;group_replication.so\n[root@node1 backup]#\n05:05:23 root@localhost[(none)]&gt; select plugin_name, plugin_status, plugin_type from information_schema.plugins where plugin_name = 'clone';\n+-------------+---------------+-------------+\n| plugin_name | plugin_status | plugin_type |\n+-------------+---------------+-------------+\n| clone       | ACTIVE        | CLONE       |\n+-------------+---------------+-------------+\n1 row in set (0.00 sec)\n05:05:24 root@localhost[(none)]&gt;\nmysql&gt; SET GLOBAL clone_valid_donor_list = 'xx.yyy.zzz.2:3306';\n# DATA DIRECTORY [=] 'clone_dir'\u53e5\u3092\u4f7f\u7528\u3057\u306a\u3044\u305f\u3081\u3001\u305d\u306e\u307e\u307e\u53d7\u4fe1\u8005\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306e\u65e2\u5b58\u306e\u30c7\u30fc\u30bf\u304c\u524a\u9664\u3055\u308c\u3001\u30af\u30ed\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306b\u7f6e\u304d\u63db\u3048\u3089\u308c\u308b\nmysql&gt; CLONE INSTANCE FROM 'repl_user'@'xx.yyy.zzz.2':3306 IDENTIFIED BY 'password';\n# DATA DIRECTORY [=] 'clone_dir'\u53e5\u3092\u4f7f\u7528\u3057\u305f\u305f\u3081\u3001\u53d7\u4fe1\u8005\u306e\u6307\u5b9a\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306b\u30af\u30ed\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u308b\nmysql&gt; CLONE LOCAL DATA DIRECTORY '/home/mysql/cloned_data/'\n</code></pre> clone \u691c\u8a3c <ul> <li>\u672c\u6765\u306fclone\u5c02\u7528\u30e6\u30fc\u30b6\u3067\u5b9f\u884c\u3059\u308b\u3079\u304d\u3067\u3059\u304c\u3001\u691c\u8a3c\u306e\u305f\u3081\u3001root\u3067\u691c\u8a3c\u3044\u305f\u3057\u307e\u3059\u3002</li> <li>\u524d\u63d0\u6761\u4ef6\u3068\u3057\u3066\u65b0\u898f\u30b5\u30fc\u30d0\u3092MGR\u306b\u53c2\u52a0\u3059\u308b\u305f\u3081\u3001\u4e8b\u524d\u306b\u30c7\u30fc\u30bf\u3092\u540c\u671f\u3059\u308b\u3002</li> <li><code>DATA DIRECTORY [=] 'clone_dir'</code>\u53e5\u3092\u4f7f\u7528\u3057\u306a\u3044\u305f\u3081\u3001\u305d\u306e\u307e\u307e\u53d7\u4fe1\u8005\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306e\u65e2\u5b58\u306e\u30c7\u30fc\u30bf\u304c\u524a\u9664\u3055\u308c\u3001\u30af\u30ed\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306b\u7f6e\u304d\u63db\u3048\u3089\u308c\u3001\u305d\u306e\u5f8c\u30b5\u30fc\u30d0\u30fc\u304c\u81ea\u52d5\u7684\u306b\u518d\u8d77\u52d5\u3055\u308c\u307e\u3059</li> <li>\u30a4\u30e1\u30fc\u30b8: <code>node1</code>(\u30c9\u30ca\u30fc) \u304b\u3089 <code>node2</code>(\u53d7\u4fe1\u8005/\u30b3\u30d4\u30fc\u5148) \u3078\u30c7\u30fc\u30bf\u540c\u671f\u3059\u308b <pre><code># node2 \u3092\u78ba\u8a8d\u3059\u308b\n05:25:29 root@localhost[(none)]&gt; SELECT MEMBER_ID,MEMBER_HOST,MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+--------------------------------------+-------------+--------------+-------------+\n| MEMBER_ID                            | MEMBER_HOST | MEMBER_STATE | MEMBER_ROLE |\n+--------------------------------------+-------------+--------------+-------------+\n| 74ba497e-f2f1-11ed-9e8e-5254007b60ca | node2       | ONLINE       | SECONDARY   |\n| d7239f8c-f2f1-11ed-aeeb-525400c72882 | node3       | ONLINE       | SECONDARY   |\n| defba275-f2ef-11ed-9eae-525400e752a2 | node1       | ONLINE       | PRIMARY     |\n+--------------------------------------+-------------+--------------+-------------+\n3 rows in set (0.01 sec)\n# node2 \u3092MGR\u304b\u3089\u5916\u3059\n05:30:44 root@localhost[(none)]&gt; stop group_replication;\nQuery OK, 0 rows affected (5.18 sec)\n# node2 \u3092\u78ba\u8a8d\u3059\u308b\n05:30:54 root@localhost[(none)]&gt; SELECT MEMBER_ID,MEMBER_HOST,MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+--------------------------------------+-------------+--------------+-------------+\n| MEMBER_ID                            | MEMBER_HOST | MEMBER_STATE | MEMBER_ROLE |\n+--------------------------------------+-------------+--------------+-------------+\n| 74ba497e-f2f1-11ed-9e8e-5254007b60ca | node2       | OFFLINE      |             |\n+--------------------------------------+-------------+--------------+-------------+\n1 row in set (0.00 sec)\n05:30:56 root@localhost[(none)]&gt;\n# \u30c9\u30ca\u30fc(node1)\u304b\u3089\u53d7\u4fe1\u8005(node2)\u3078\u30c7\u30fc\u30bf\u3092\u53d7\u4fe1\u3059\u308b\n05:34:28 root@localhost[(none)]&gt; SET GLOBAL clone_valid_donor_list = 'xx.yyy.zzz.1:3306';\nQuery OK, 0 rows affected (0.00 sec)\n05:34:33 root@localhost[(none)]&gt; select @@clone_valid_donor_list;\n+--------------------------+\n| @@clone_valid_donor_list |\n+--------------------------+\n| xx.yyy.zzz.1:3306        |\n+--------------------------+\n1 row in set (0.00 sec)\n05:34:39 root@localhost[(none)]&gt; CLONE INSTANCE FROM 'root'@'xx.yyy.zzz.1':3306 IDENTIFIED BY 'password';\nERROR 1290 (HY000): The MySQL server is running with the --super-read-only option so it cannot execute this statement\n05:34:59 root@localhost[(none)]&gt;\n# MGR\u304b\u3089\u5916\u308c\u305f\u306e\u305f\u3081read-only\u306e\u307e\u307e\u3067\u3059\u3002mysqld\u3092\u518d\u8d77\u52d5\u3059\u308b\u5fc5\u8981\u3067\u3059\u3002\n05:37:20 root@localhost[(none)]&gt; show global variables where Variable_name  like '%hostname%' or Variable_name like '%read_only%';\n+-----------------------+-------+\n| Variable_name         | Value |\n+-----------------------+-------+\n| hostname              | node2 |\n| innodb_read_only      | OFF   |\n| read_only             | ON    |\n| super_read_only       | ON    |\n| transaction_read_only | OFF   |\n+-----------------------+-------+\n# mysqld\u3092\u518d\u8d77\u52d5\u3059\u308b\n[root@node2 ~]# systemctl restart mysqld\n# read-only\u30e2\u30fc\u30c9\u3067\u306f\u306a\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n05:38:01 root@localhost[(none)]&gt; show global variables where Variable_name  like '%hostname%' or Variable_name like '%read_only%';\n+-----------------------+-------+\n| Variable_name         | Value |\n+-----------------------+-------+\n| hostname              | node2 |\n| innodb_read_only      | OFF   |\n| read_only             | OFF   |\n| super_read_only       | OFF   |\n| transaction_read_only | OFF   |\n+-----------------------+-------+\n5 rows in set (0.00 sec)\n# clone\u3092\u5b9f\u884c\u3059\u308b\n05:38:31 root@localhost[(none)]&gt; CLONE INSTANCE FROM 'root'@'xx.yyy.zzz.1':3306 IDENTIFIED BY 'password';\nQuery OK, 0 rows affected (19.61 sec)\n# clone\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u78ba\u8a8d\n05:39:12 root@localhost[(none)]&gt; SELECT STATE FROM performance_schema.clone_status;\n+-----------+\n| STATE     |\n+-----------+\n| Completed |\n+-----------+\n1 row in set (0.00 sec)\n05:38:00 root@localhost[(none)]&gt; SELECT MEMBER_ID,MEMBER_HOST,MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+-----------+-------------+--------------+-------------+\n| MEMBER_ID | MEMBER_HOST | MEMBER_STATE | MEMBER_ROLE |\n+-----------+-------------+--------------+-------------+\n|           |             | OFFLINE      |             |\n+-----------+-------------+--------------+-------------+\n1 row in set (0.00 sec)\n05:39:45 root@localhost[(none)]&gt; SELECT STATE, ERROR_NO, ERROR_MESSAGE FROM performance_schema.clone_status;\n+-----------+----------+---------------+\n| STATE     | ERROR_NO | ERROR_MESSAGE |\n+-----------+----------+---------------+\n| Completed |        0 |               |\n+-----------+----------+---------------+\n1 row in set (0.00 sec)\n05:39:52 root@localhost[(none)]&gt; SELECT STAGE, STATE, END_TIME FROM performance_schema.clone_progress;\n+-----------+-----------+----------------------------+\n| STAGE     | STATE     | END_TIME                   |\n+-----------+-----------+----------------------------+\n| DROP DATA | Completed | 2023-05-21 17:38:41.202984 |\n| FILE COPY | Completed | 2023-05-21 17:38:58.597719 |\n| PAGE COPY | Completed | 2023-05-21 17:38:58.831569 |\n| REDO COPY | Completed | 2023-05-21 17:38:59.062794 |\n| FILE SYNC | Completed | 2023-05-21 17:38:59.283958 |\n| RESTART   | Completed | 2023-05-21 17:39:04.721238 |\n| RECOVERY  | Completed | 2023-05-21 17:39:06.078122 |\n+-----------+-----------+----------------------------+\n7 rows in set (0.00 sec)\n05:39:56 root@localhost[(none)]&gt;\n# clone\u5b8c\u4e86\u5f8c\u3001MGR\u306b\u53c2\u52a0\u3055\u305b\u308b\n05:39:56 root@localhost[(none)]&gt; start group_replication;\nQuery OK, 0 rows affected (2.19 sec)\n05:40:59 root@localhost[(none)]&gt; SELECT MEMBER_ID,MEMBER_HOST,MEMBER_STATE, MEMBER_ROLE FROM performance_schema.replication_group_members;\n+--------------------------------------+-------------+--------------+-------------+\n| MEMBER_ID                            | MEMBER_HOST | MEMBER_STATE | MEMBER_ROLE |\n+--------------------------------------+-------------+--------------+-------------+\n| 74ba497e-f2f1-11ed-9e8e-5254007b60ca | node2       | ONLINE       | SECONDARY   |\n| d7239f8c-f2f1-11ed-aeeb-525400c72882 | node3       | ONLINE       | SECONDARY   |\n| defba275-f2ef-11ed-9eae-525400e752a2 | node1       | ONLINE       | PRIMARY     |\n+--------------------------------------+-------------+--------------+-------------+\n3 rows in set (0.01 sec)\n05:41:02 root@localhost[(none)]&gt;\n</code></pre></li> </ul>"},{"location":"mysql-mgr/#clone-status","title":"clone status","text":"<ul> <li>https://dev.mysql.com/doc/refman/8.0/ja/clone-plugin-replication.html</li> <li>https://dev.mysql.com/doc/refman/8.0/ja/clone-plugin-monitoring.html</li> </ul> <pre><code>05:17:36 root@localhost[(none)]&gt; SELECT STATE FROM performance_schema.clone_status;\nEmpty set (0.00 sec)\n05:18:08 root@localhost[(none)]&gt; SELECT STATE, ERROR_NO, ERROR_MESSAGE FROM performance_schema.clone_status;\nEmpty set (0.00 sec)\n05:18:12 root@localhost[(none)]&gt; SELECT STAGE, STATE, END_TIME FROM performance_schema.clone_progress;\nEmpty set (0.01 sec)\n05:18:21 root@localhost[(none)]&gt;\n</code></pre>"},{"location":"mysql-ssl/","title":"MySQL\u5b89\u5168SSL\u4ecb\u7ecd","text":"<ul> <li>\u539f\u6587</li> </ul>"},{"location":"mysql-ssl/#1-ssl","title":"1. SSL\u539f\u7406","text":"<p>SSL\uff08Secure Sockets Layer\uff09\u662f\u4e00\u79cd\u7528\u4e8e\u5b89\u5168\u5730\u4f20\u8f93\u6570\u636e\u7684\u52a0\u5bc6\u534f\u8bae\u3002\u5728MySQL\u4e2d\uff0cSSL\u53ef\u4ee5\u7528\u4e8e\u52a0\u5bc6\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u4ee5\u9632\u6b62\u6570\u636e\u88ab\u7a83\u53d6\u6216\u7be1\u6539\u3002SSL\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5b9e\u73b0\u6570\u636e\u7684\u52a0\u5bc6\u548c\u8eab\u4efd\u9a8c\u8bc1\uff1a</p> <ul> <li> <p>\u52a0\u5bc6\u901a\u4fe1\uff1aSSL\u4f7f\u7528\u975e\u5bf9\u79f0\u52a0\u5bc6\u548c\u5bf9\u79f0\u52a0\u5bc6\u76f8\u7ed3\u5408\u7684\u65b9\u5f0f\u6765\u52a0\u5bc6\u901a\u4fe1\u3002\u5728\u8fde\u63a5\u5efa\u7acb\u9636\u6bb5\uff0c\u670d\u52a1\u5668\u4f7f\u7528\u81ea\u5df1\u7684\u79c1\u94a5\u5bf9\u516c\u94a5\u52a0\u5bc6\u8fdb\u884c\u901a\u4fe1\u7684\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\u8fdb\u884c\u52a0\u5bc6\uff0c\u7136\u540e\u5c06\u52a0\u5bc6\u540e\u7684\u5bc6\u94a5\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002\u5ba2\u6237\u7aef\u4f7f\u7528\u79c1\u94a5\u89e3\u5bc6\u670d\u52a1\u5668\u53d1\u9001\u7684\u5bc6\u94a5\uff0c\u4ece\u800c\u83b7\u53d6\u901a\u4fe1\u6240\u4f7f\u7528\u7684\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\u3002\u4e4b\u540e\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4f7f\u7528\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\u5bf9\u6570\u636e\u8fdb\u884c\u52a0\u5bc6\u548c\u89e3\u5bc6\u3002</p> </li> <li> <p>\u8eab\u4efd\u9a8c\u8bc1\uff1aSSL\u8fd8\u7528\u4e8e\u9a8c\u8bc1\u670d\u52a1\u5668\u7684\u8eab\u4efd\u3002\u670d\u52a1\u5668\u4f7f\u7528\u6570\u5b57\u8bc1\u4e66\u6765\u8bc1\u660e\u81ea\u5df1\u7684\u8eab\u4efd\u3002\u6570\u5b57\u8bc1\u4e66\u5305\u542b\u4e86\u670d\u52a1\u5668\u7684\u516c\u94a5\u4ee5\u53ca\u5176\u4ed6\u4e0e\u670d\u52a1\u5668\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u5e76\u7531\u53ef\u4fe1\u7684\u7b2c\u4e09\u65b9\u8bc1\u4e66\u9881\u53d1\u673a\u6784\uff08CA\uff09\u7b7e\u540d\u3002\u5ba2\u6237\u7aef\u5728\u8fde\u63a5\u5efa\u7acb\u9636\u6bb5\u4f1a\u9a8c\u8bc1\u670d\u52a1\u5668\u7684\u8bc1\u4e66\uff0c\u4ee5\u786e\u4fdd\u8fde\u63a5\u7684\u5b89\u5168\u6027\u548c\u5408\u6cd5\u6027\u3002</p> </li> <li> <p>\u6570\u636e\u52a0\u5bc6\uff1aSSL\u4f7f\u7528\u5bf9\u79f0\u52a0\u5bc6\u548c\u975e\u5bf9\u79f0\u52a0\u5bc6\u76f8\u7ed3\u5408\u7684\u65b9\u5f0f\u6765\u52a0\u5bc6\u901a\u4fe1\u3002\u5728\u8fde\u63a5\u5efa\u7acb\u8fc7\u7a0b\u4e2d\uff0c\u670d\u52a1\u5668\u4f7f\u7528\u79c1\u94a5\u5bf9\u516c\u94a5\u52a0\u5bc6\u8fdb\u884c\u901a\u4fe1\u7684\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\uff0c\u7136\u540e\u5c06\u52a0\u5bc6\u540e\u7684\u5bc6\u94a5\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002\u5ba2\u6237\u7aef\u4f7f\u7528\u79c1\u94a5\u89e3\u5bc6\u670d\u52a1\u5668\u53d1\u9001\u7684\u5bc6\u94a5\uff0c\u4ece\u800c\u83b7\u53d6\u901a\u4fe1\u6240\u4f7f\u7528\u7684\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\u3002\u4e4b\u540e\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4f7f\u7528\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\u5bf9\u6570\u636e\u8fdb\u884c\u52a0\u5bc6\u548c\u89e3\u5bc6\u3002</p> </li> </ul>"},{"location":"mysql-ssl/#2-ssl","title":"2. SSL\u914d\u7f6e\u4e0e\u5b9e\u8df5","text":"<p>\u4ee5\u4e0b\u662f\u5728MySQL 8\u4e2d\u542f\u7528SSL\u6240\u9700\u7684\u914d\u7f6e\u548c\u5b9e\u8df5\u6b65\u9aa4\uff1a</p>"},{"location":"mysql-ssl/#1ssl","title":"\u6b65\u9aa41\uff1a\u751f\u6210SSL\u8bc1\u4e66\u548c\u79c1\u94a5","text":"<p>\u9996\u5148\uff0c\u60a8\u9700\u8981\u751f\u6210\u7528\u4e8eSSL\u8fde\u63a5\u7684\u8bc1\u4e66\u548c\u79c1\u94a5\u3002\u53ef\u4ee5\u4f7f\u7528OpenSSL\u5de5\u5177\u6765\u751f\u6210\u81ea\u7b7e\u540d\u8bc1\u4e66\u548c\u79c1\u94a5\u3002\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <p><pre><code>openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout server-key.pem -out server-cert.pem\n</code></pre> \u8be5\u547d\u4ee4\u5c06\u751f\u6210\u4e00\u4e2a\u81ea\u7b7e\u540d\u7684\u670d\u52a1\u5668\u8bc1\u4e66\uff08server-cert.pem\uff09\u548c\u79c1\u94a5\uff08server-key.pem\uff09\u6587\u4ef6\u3002</p>"},{"location":"mysql-ssl/#2mysql","title":"\u6b65\u9aa42\uff1a\u5c06\u8bc1\u4e66\u548c\u79c1\u94a5\u590d\u5236\u5230MySQL\u670d\u52a1\u5668","text":"<p>\u5c06\u751f\u6210\u7684\u670d\u52a1\u5668\u8bc1\u4e66\u548c\u79c1\u94a5\u6587\u4ef6\u590d\u5236\u5230MySQL\u670d\u52a1\u5668\u7684\u5b89\u5168\u76ee\u5f55\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cMySQL\u670d\u52a1\u5668\u4f1a\u5728\u6570\u636e\u76ee\u5f55\u4e0b\u7684<code>ssl</code>\u5b50\u76ee\u5f55\u4e2d\u67e5\u627e\u8bc1\u4e66\u548c\u79c1\u94a5\u6587\u4ef6\u3002</p>"},{"location":"mysql-ssl/#3mysqlssl","title":"\u6b65\u9aa43\uff1a\u914d\u7f6eMySQL\u670d\u52a1\u5668\u4ee5\u4f7f\u7528SSL","text":"<p>\u7f16\u8f91MySQL\u670d\u52a1\u5668\u7684\u914d\u7f6e\u6587\u4ef6\uff08\u901a\u5e38\u662f<code>my.cnf</code>\u6216<code>my.ini</code>\uff09\u5e76\u6dfb\u52a0\u4ee5\u4e0b\u914d\u7f6e\uff1a</p> <pre><code>[mysqld]\nssl-ca=ssl/server-cert.pem\nssl-cert=ssl/server-cert.pem\nssl-key=ssl/server-key.pem\n</code></pre> <p>\u4e0a\u8ff0\u914d\u7f6e\u5c06SSL\u8bc1\u4e66\u548c\u79c1\u94a5\u7684\u8def\u5f84\u544a\u77e5MySQL\u670d\u52a1\u5668\u3002\u786e\u4fdd\u8def\u5f84\u4e0e\u5b9e\u9645\u8bc1\u4e66\u548c\u79c1\u94a5\u6587\u4ef6\u7684\u4f4d\u7f6e\u76f8\u5339\u914d\u3002</p>"},{"location":"mysql-ssl/#4mysql","title":"\u6b65\u9aa44\uff1a\u91cd\u542fMySQL\u670d\u52a1\u5668","text":"<p>\u4fdd\u5b58\u914d\u7f6e\u6587\u4ef6\u5e76\u91cd\u542fMySQL\u670d\u52a1\u5668\uff0c\u4ee5\u4f7f\u66f4\u6539\u751f\u6548\u3002</p>"},{"location":"mysql-ssl/#5mysqlssl","title":"\u6b65\u9aa45\uff1a\u914d\u7f6eMySQL\u7528\u6237\u4ee5\u4f7f\u7528SSL","text":"<p>\u5982\u679c\u60a8\u5e0c\u671b\u7279\u5b9a\u7684MySQL\u7528\u6237\u4f7f\u7528SSL\u8fde\u63a5\u5230\u670d\u52a1\u5668\uff0c\u60a8\u9700\u8981\u4e3a\u8be5\u7528\u6237\u914d\u7f6eSSL\u9009\u9879\u3002\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u8fde\u63a5\u5230MySQL\u670d\u52a1\u5668\uff1a</p> <pre><code>mysql -u &lt;username&gt; -p\n</code></pre> <p>\u7136\u540e\uff0c\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u4e3a\u7528\u6237\u542f\u7528SSL\u8fde\u63a5\uff1a</p> <pre><code>ALTER USER '&lt;username&gt;'@'localhost' REQUIRE SSL;\n</code></pre> <p>\u5c06<code>&lt;username&gt;</code>\u66ff\u6362\u4e3a\u5b9e\u9645\u7684\u7528\u6237\u540d\u3002</p>"},{"location":"mysql-ssl/#6ssl","title":"\u6b65\u9aa46\uff1a\u6d4b\u8bd5SSL\u8fde\u63a5","text":"<p>\u73b0\u5728\uff0c\u60a8\u53ef\u4ee5\u6d4b\u8bd5SSL\u8fde\u63a5\u662f\u5426\u6b63\u5e38\u5de5\u4f5c\u3002\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u8fde\u63a5\u5230MySQL\u670d\u52a1\u5668\uff1a</p> <pre><code>mysql -u &lt;username&gt; -p --ssl-ca=ssl/server-cert.pem\n</code></pre> <p>\u786e\u4fdd\u5c06<code>&lt;username&gt;</code>\u66ff\u6362\u4e3a\u914d\u7f6e\u4e86SSL\u9009\u9879\u7684\u5b9e\u9645\u7528\u6237\u540d\uff0c\u5e76\u6307\u5b9a\u6b63\u786e\u7684<code>--ssl-ca</code>\u53c2\u6570\u4ee5\u6307\u5b9aCA\u8bc1\u4e66\u7684\u8def\u5f84\u3002 \u8fde\u63a5\u6210\u529f\u540e\uff0c\u60a8\u53ef\u4ee5\u8fd0\u884c\u4e00\u4e9b\u67e5\u8be2\u6765\u9a8c\u8bc1SSL\u8fde\u63a5\u662f\u5426\u6b63\u5e38\u5de5\u4f5c\u3002</p>"},{"location":"mysql-ssl/#_1","title":"\u7ed3\u8bba","text":"<p>\u901a\u8fc7\u542f\u7528SSL\u8fde\u63a5\uff0c\u60a8\u53ef\u4ee5\u5728MySQL 8\u4e2d\u786e\u4fdd\u6570\u636e\u7684\u52a0\u5bc6\u548c\u8fde\u63a5\u7684\u5b89\u5168\u6027\u3002\u9075\u5faa\u4e0a\u8ff0\u6b65\u9aa4\uff0c\u60a8\u53ef\u4ee5\u6210\u529f\u914d\u7f6e\u548c\u5b9e\u8df5MySQL 8\u7684SSL\u529f\u80fd\u3002</p> <p> </p>"},{"location":"mysql-sysbench/","title":"Mysql sysbench mark","text":""},{"location":"mysql-sysbench/#sysbench-install","title":"sysbench Install","text":"install <pre><code>1. Install Sysbench\n[root@localhost sysbench]# yum   --enablerepo=epel install sysbench\n</code></pre> create user <ul> <li> <p>MySQL8\u4ee5\u4e0a\u306e\u5834\u5408     <pre><code>-- MySQL8\u4ee5\u4e0a\u306e\u5834\u5408\n-- DB\u4f5c\u6210\n&gt; CREATE DATABASE sbtest;\n-- \u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\n&gt; CREATE USER 'sbtest'@'localhost' IDENTIFIED BY 'sbtest';\n-- \u30e6\u30fc\u30b6\u30fc\u306b\u5168\u6a29\u9650\u8ffd\u52a0\n&gt; GRANT ALL PRIVILEGES ON `sbtest`.* TO 'sbtest'@'localhost' WITH GRANT OPTION;     -- \u6a29\u9650\u306e\u5909\u66f4\u3092\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u53cd\u6620\n&gt; FLUSH PRIVILEGES;\n</code></pre></p> </li> <li> <p>MySQL8\u4ee5\u4e0b\u306e\u5834\u5408     <pre><code>-- MySQL8\u4ee5\u4e0b\u306e\u5834\u5408\nmysql&gt; CREATE DATABASE sbtest;\nQuery OK, 1 row affected (0.00 sec)\nmysql&gt; CREATE USER sbtest;\nQuery OK, 0 rows affected (0.00 sec)\nmysql&gt;  GRANT ALL PRIVILEGES ON `sbtest`.* TO 'sbtest'@'localhost' IDENTIFIED BY 'sbtest';\nQuery OK, 0 rows affected (0.00 sec)\nmysql&gt; FLUSH PRIVILEGES;\nQuery OK, 0 rows affected (0.00 sec)\n</code></pre></p> </li> <li> <p>\u78ba\u8a8d     <pre><code>-- \u78ba\u8a8d\n&gt; show databases;\n&gt; select user,host,authentication_string from mysql.user;\n</code></pre></p> </li> <li> <p>DB\u3068\u30e6\u30fc\u30b6\u524a\u9664\u6642     <pre><code># DB\u3068\u30e6\u30fc\u30b6\u524a\u9664\u6642\n&gt; DROP DATABASE IF EXISTS `mydb`;\n&gt; select db,user FROM mysql.db WHERE user = 'myuser' ;\n&gt; DELETE FROM mysql.db WHERE user = 'myuser';\n&gt; DELETE FROM mysql.user WHERE user = 'myuser';\n-- \u524a\u9664\u5f8c\u3082\u3046\u4e00\u5ea6\u78ba\u8a8d\n&gt; select db,user FROM mysql.db WHERE user = 'myuser' ;\n&gt; select user,host FROM mysql.user WHERE user = 'myuser' ;\n</code></pre></p> </li> </ul>"},{"location":"mysql-sysbench/#sysbench","title":"sysbench\u7528\u30b9\u30af\u30ea\u30d7\u30c8","text":"\u30b9\u30af\u30ea\u30d7\u30c8 <pre><code>root@xxx ~]# cat sysbench_test.sh\n#!/usr/bin/env bash\nPATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin\nexport PATH\nset -e\n\nclear\necho\necho \"##############################################################################\"\necho \"# prepare:                                                                   #\"\necho \"# performs preparative actions for those tests which need them, e.g.         #\"\necho \"# creating the necessary files on disk for the fileio test,                  #\"\necho \"# or filling the test database for database benchmarks.                      #\"\necho \"# run:                                                                       #\"\necho \"# runs the actual test specified with the testname argument.                 #\"\necho \"# This command is provided by all tests.                                     #\"\necho \"# cleanup:                                                                   #\"\necho \"# removes temporary data after the test run in those tests which create one. #\"\necho \"# help:                                                                      #\"\necho \"# displays usage information for the test specified with the testname        #\"\necho \"# argument. This includes the full list of commands provided by the test,    #\"\necho \"# so it should be used to get the available commands.                        #\"\necho \"##############################################################################\"\necho\nTHR=$1\nCMD=$2\nif [ ! \"$THR\" ]; then\necho \"Not threads set! \"\nexit 1;\nfi\nif [ ! \"$CMD\" ]; then\necho \"Not command selected! \"\nexit 1;\nfi\nsysbench oltp_read_write \\\n--mysql-dry-run=off \\\n--db-driver=mysql \\\n--mysql-socket=/tmp/mysql.sock \\\n--mysql-user=sbtest \\\n--mysql-password=sbtest \\\n--table_size=10000 \\\n--threads=$THR \\\n--tables=30 \\\n--time=120 \\\n--report-interval=10 \\\n$CMD\n# \u30aa\u30d7\u30b7\u30e7\u30f3\n1. table_size=10000 \u30c6\u30fc\u30d6\u30eb\u30b5\u30a4\u30ba\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u307e\u307e\n2. tebles=30 \u30c6\u30fc\u30d6\u30eb\u6570\u3002WP\u306f\u57fa\u672c\u7684\u306b29\u500b\u30c6\u30fc\u30d6\u30eb\u306e\u305f\u3081\u3001\u30c6\u30b9\u30c8\u306b\u306f30\u306b\u8a2d\u5b9a\n3. time=120 \u30c6\u30b9\u30c8\u6642\u9593\u3002 2\u5206\u9593\u306e\u30c6\u30b9\u30c8\u3092\u5b9f\u65bd\u3059\u308b\n4. report-interval=10 \u30ed\u30b0\u306e\u51fa\u529b\u9593\u9694\u3002 10\u79d2\u3054\u3068\u30ec\u30dd\u30fc\u30c8\u3092\u51fa\u529b\u3059\u308b\n\n# \u4f7f\u3044\u65b9\n1. \u5bfe\u8c61\u30b5\u30fc\u30d0\u4e0aDB, DB_USER \u4f5c\u6210\nCREATE DATABASE sbtest;\nCREATE USER sbtest;\nGRANT ALL PRIVILEGES ON sbtest.* TO 'sbtest'@'localhost' IDENTIFIED BY 'sbtest';\nFLUSH PRIVILEGES;\n&gt;&gt; MySQL8\u306e\u5834\u5408\n# CREATE USER 'sbtest'@'localhost' IDENTIFIED BY 'sbtest';\n# GRANT all ON *.* TO 'sbtest'@'localhost';\n2. \u30c6\u30fc\u30d6\u30eb\u6e96\u5099\nbash sysbench_test.sh 300 prepare\n\n3. DB\u3092\u6e29\u3081\u308b\nsysbench oltp_read_write --mysql-dry-run=off --db-driver=mysql --mysql-socket=/tmp/mysql.sock --mysql-user=sbtest --mysql-password=sbtest --table_size=10000 --threads=10 --tables=30 --time=60 --report-interval=10 run\n\n3. \u691c\u8a3c\u958b\u59cb\n- bash sysbench_test.sh 10 run\n- for i in $(seq 10 10 300); do echo $i; bash sysbench_test.sh $i run &gt;&gt; sysbench.log; done\n4. bash sysbench_test.sh 10 cleanup\n# \u30b9\u30af\u30ea\u30d7\u30c8\u5f15\u6570\n1. $1 \u306f threads\u6570\u3001\u30c6\u30b9\u30c8\u6642MySQL\u306b\u540c\u6642\u63a5\u7d9a\u6570\n2. \uff042 \u306f command \u3067\u3059\u3001 \u9806\u756a\u3068\u3057\u3066\u3001\u307e\u305a\u3001 prepare\uff08\u6e96\u5099\uff09\u3057\u3001\u305d\u306e\u5f8c\u3001run(\u5b9f\u65bd)\u3001\u6700\u5f8c\u306b\u4e0d\u8981\u3068\u306a\u308b\u30c7\u30fc\u30bf\u524a\u9664cleanup\u3002\n</code></pre>"},{"location":"mysql-sysbench/#sysbench_1","title":"sysbench\u306e\u969b","text":"<ul> <li>\u540c\u6642\u63a5\u7d9a\u6570\u3092\u5909\u66f4\u5fc5\u8981\u3042\u308a\u307e\u3059\u3002</li> <li>https://blog.csdn.net/vkingnew/article/details/81025882</li> <li>https://blog.csdn.net/luoqinglong850102/article/details/104367743</li> <li>https://blog.csdn.net/luoqinglong850102/article/details/104341695</li> <li>https://blog.csdn.net/z136370204/article/details/102715652?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-0&amp;spm=1001.2101.3001.4242</li> <li>https://github.com/akopytov/sysbench</li> <li> <p>FATAL: MySQL error: 1461 \"Can't create more than max_prepared_stmt_count statements \u30a8\u30e9\u30fc\u56de\u907f\u306e\u305f\u3081\u3001max_prepared_stmt_count\u3092\u6700\u5927\u5024\u306b\u5909\u66f4</p> <ul> <li>https://dev.mysql.com/doc/refman/5.6/ja/server-system-variables.html#sysvar_max_prepared_stmt_count</li> </ul> </li> <li> <p>\u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u5834\u5408</p> \u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u5834\u5408 <pre><code>FATAL: mysql_stmt_prepare() failed\nFATAL: MySQL error: 1461 \"Can't create more than max_prepared_stmt_count statements (current value: 16382)\"\nFATAL: mysql_stmt_prepare() failed\nFATAL: MySQL error: 1461 \"Can't create more than max_prepared_stmt_count statements (current value: 16382)\"\nFATAL: `thread_init' function failed: /usr/share/sysbench/oltp_common.lua:284: SQL API error\nFATAL: `thread_init' function failed: /usr/share/sysbench/oltp_common.lua:284: SQL API error\nFATAL: Thread initialization failed!\nError in my_thread_global_end(): 100 threads didn't exit\n-- \u4e0a\u8a18\u306e\u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u5834\u5408\nset global max_prepared_stmt_count=1048576;\n12:40:01 root@localhost[(none)]&gt; show global status like 'com_stmt%';\n+-------------------------+---------+\n| Variable_name           | Value   |\n+-------------------------+---------+\n| Com_stmt_execute        | 2460896 |\n| Com_stmt_close          | 3620    |\n| Com_stmt_fetch          | 0       |\n| Com_stmt_prepare        | 20122   |\n| Com_stmt_reset          | 0       |\n| Com_stmt_send_long_data | 0       |\n| Com_stmt_reprepare      | 0       |\n+-------------------------+---------+\n7 rows in set (0.00 sec)\n12:40:08 root@localhost[(none)]&gt; show global variables like 'max_prepared_stmt_count';\n+-------------------------+-------+\n| Variable_name           | Value |\n+-------------------------+-------+\n| max_prepared_stmt_count | 16382 |\n+-------------------------+-------+\n1 row in set (0.00 sec)\n12:40:33 root@localhost[(none)]&gt;\nshow global status like 'com_stmt%';\nshow global variables like 'max_prepared_stmt_count';\nset global max_prepared_stmt_count=1048576;\n</code></pre> </li> </ul>"},{"location":"mysql-sysbench/#mycnf","title":"my.cnf","text":"Info <pre><code>[root@test work]# diff -u my.cnf /etc/my.cnf\n--- my.cnf      2021-05-12 10:49:21.439565689 +0900\n+++ /etc/my.cnf 2021-05-12 10:50:33.733737035 +0900\n@@ -5,6 +5,7 @@\n prompt=\"\\\\r:\\\\m:\\\\s \\\\u@\\\\h[\\\\d]&gt; \"\n\n [mysqld]\n+max_prepared_stmt_count=1048576\n user=mysql\n datadir=/home/mysql\n socket=/tmp/mysql.sock\n@@ -27,11 +28,11 @@\n skip-ssl\n skip-symbolic-links\n skip-innodb_adaptive_hash_index\n-max_connections=600\n+max_connections=2048\n max_connect_errors=300\n max_allowed_packet=32M\n connect_timeout=30\n-max_user_connections=30\n+max_user_connections=1024\n table_open_cache=19200\n interactive_timeout=300\n wait_timeout=300\n@@ -72,4 +73,3 @@\n innodb_flush_neighbors=0\n innodb_read_ahead_threshold=0\n innodb_purge_threads=1\n-\n[root@test work]#\n</code></pre>"},{"location":"mysql-table/","title":"MySQL-table","text":"<p>=========================================================================================================================================</p>"},{"location":"mysql-table/#databasetable","title":"\u6307\u5b9a\u7684Database\u91cc\u7684\u6307\u5b9a\u7684Table\u5bb9\u91cf","text":"<pre><code>SELECT \n    table_name AS `Table`, \n    round(((data_length + index_length) / 1024 / 1024), 2) `Size in MB` \nFROM information_schema.TABLES \nWHERE table_schema = \"$DB_NAME\"\n    AND table_name = \"$TABLE_NAME\";\n\nmysql -uroot -e\n  \"SELECT TABLE_NAME, round(((data_length+index_length) / 1024 / 1024 / 1024), 2) AS 'Size (GB)'\n   FROM information_schema.tables \n   WHERE table_schema = '$DB_NAME' AND table_name = '$TABLE_NAME';\"\n - mysql55-dev# mysql -uroot -e \" SELECT TABLE_NAME, round(((data_length+index_length) / 1024 / 1024 / 1024), 2) AS 'Size (GB)' FROM information_schema.tables WHERE table_schema = 'tigrex_mygoods2' AND table_name = 'g5_apms_like';\"\n</code></pre>"},{"location":"mysql-table/#databasetable_1","title":"\u6307\u5b9a\u7684Database\u91cc\u7684\u6240\u6709\u7684Table\u5bb9\u91cf","text":"<pre><code>[root@mysqlxxx log]# mysql -uroot -e \"SELECT TABLE_SCHEMA, TABLE_NAME, round(((data_length+index_length) / 1024 / 1024 ),2)  AS 'Size (MB)' FROM information_schema.tables  WHERE table_schema = 'zeroen_wp'ORDER BY (data_length + index_length) DESC ;\"\n+--------------+--------------------------------+-----------+\n| TABLE_SCHEMA | TABLE_NAME                     | Size (GB) |\n+--------------+--------------------------------+-----------+\n| zeroen_wp    | wp74e2b1options                |      0.39 |\n| zeroen_wp    | wp74e2b1postmeta               |      0.28 |\n| zeroen_wp    | wp74e2b1posts                  |      0.13 |\n| zeroen_wp    | wp74e2b1comments               |      0.09 |\n| zeroen_wp    | wp74e2b1users                  |      0.06 |\n| zeroen_wp    | wp74e2b1usermeta               |      0.05 |\n| zeroen_wp    | wp74e2b1terms                  |      0.05 |\n| zeroen_wp    | wp74e2b1termmeta               |      0.05 |\n| zeroen_wp    | wp74e2b1term_taxonomy          |      0.05 |\n| zeroen_wp    | wp74e2b1commentmeta            |      0.05 |\n| zeroen_wp    | wp74e2b1term_relationships     |      0.03 |\n| zeroen_wp    | wp74e2b1links                  |      0.03 |\n| zeroen_wp    | wp74e2b1aiowps_login_lockdown  |      0.02 |\n| zeroen_wp    | wp74e2b1aiowps_login_activity  |      0.02 |\n| zeroen_wp    | wp74e2b1aiowps_global_meta     |      0.02 |\n| zeroen_wp    | wp74e2b1aiowps_failed_logins   |      0.02 |\n| zeroen_wp    | wp74e2b1aiowps_events          |      0.02 |\n| zeroen_wp    | wp74e2b1aiowps_permanent_block |      0.02 |\n+--------------+--------------------------------+-----------+\n[root@mysqlxxx log]#\n</code></pre>"},{"location":"mysql-table/#databasetable_2","title":"\u6240\u6709\u7684Database\u91cc\u7684\u6240\u6709\u7684Table\u5bb9\u91cf","text":"<pre><code>SELECT \n     table_schema as `Database`, \n     table_name AS `Table`, \n     round(((data_length + index_length) / 1024 / 1024), 2) `Size in MB` \nFROM information_schema.TABLES \nORDER BY (data_length + index_length) DESC;\n - mysql -uroot -e \"SELECT TABLE_SCHEMA, TABLE_NAME, round(((data_length+index_length) / 1024),2)  AS 'Size (GB)' FROM information_schema.tables  ORDER BY (data_length + index_length) DESC;\"\n - mysql55-dev# mysql -uroot -e \" SELECT TABLE_NAME, round(((data_length+index_length) / 1024 / 1024 / 1024), 2) AS 'Size (GB)' FROM information_schema.tables ORDER BY (data_length + index_length) DESC;\"\n</code></pre>"},{"location":"mysql-table/#databasetable_3","title":"\u6307\u5b9a\u7684Database\u91cc\u7684\u6240\u6709\u7684Table\u5bb9\u91cf","text":"<pre><code>mysql -uroot -e\n  \"SELECT TABLE_SCHEMA AS 'Database Name',\n   TABLE_NAME AS 'TABLE_NAME',\n   SUM(data_length+index_length) / 1024 / 1024 / 1024 AS 'Size (GB)'\n   FROM information_schema.tables \n   WHERE table_schema = '$DB_NAME'\n   ORDER BY (data_length + index_length) DESC;\"\n\n - mysql -uroot -e \"SELECT TABLE_SCHEMA, TABLE_NAME, round(((data_length+index_length) / 1024),2)  AS 'Size (GB)' FROM information_schema.tables WHERE table_schema = 'tigrex_mygoods' ORDER BY (data_length + index_length) DESC;\"\n</code></pre> <pre><code>use databaseName;\nselect  \ntable_name, engine, table_rows as tbl_rows, avg_row_length as rlen,  \nfloor((data_length+index_length)/1024/1024) as allMB,  #\u7dcf\u5bb9\u91cf\nfloor((data_length)/1024/1024) as dMB,  #\u30c7\u30fc\u30bf\u5bb9\u91cf\nfloor((index_length)/1024/1024) as iMB   #\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u5bb9\u91cf\nfrom information_schema.tables  \nwhere table_schema=database()  \norder by (data_length+index_length) desc; \n</code></pre> <p>=========================================================================================================================================</p> <pre><code>mysql&gt; select TABLE_NAME from information_schema.TABLES where TABLE_SCHEMA = 'spacerental2_kikou' and  TABLE_TYPE = 'VIEW';\n+------------------------+\n| TABLE_NAME             |\n+------------------------+\n| roomtimetable_chk_v01  |\n| roomtimetable_disp     |\n| roomtimetable_disp_v01 |\n| roomtimetable_disp_v02 |\n| sagakuview             |\n| sagakuview1            |\n| sagakuview_Ytmp        |\n| sagakuview_n           |\n| sagakuview_ngaku       |\n| sagakuview_s           |\n| sagakuview_sgaku       |\n| sagakuview_y           |\n| sagakuview_ygaku       |\n| yoyakubihintable_v01   |\n| yoyakubihintable_v02   |\n| yoyakubihintable_v03   |\n| yoyakubihintable_v04   |\n+------------------------+\n17 rows in set (0.01 sec)\n</code></pre>"},{"location":"mysql-table/#database","title":"\u6307\u5b9a\u7684Database\u91cc\u7684\u7dcf\u5bb9\u91cf","text":"<pre><code>mysql# mysql -uroot -e \"SELECT TABLE_SCHEMA, SUM(data_length+index_length) / 1024 / 1024 / 1024 AS 'Size (GB)' FROM information_schema.tables WHERE table_schema = 'test45_wdpress';\"\n\nmysql&gt; sELECT TABLE_SCHEMA, SUM(data_length+index_length) / 1024 / 1024 / 1024 AS 'Size (GB)' FROM information_schema.tables WHERE table_schema = 'test45_wdpress';\n+----------------+----------------+\n| TABLE_SCHEMA   | Size (GB)      |\n+----------------+----------------+\n| test45_wdpress | 0.000793457031 |\n+----------------+----------------+\n1 row in set (0.01 sec)\n\nmysql&gt;\n</code></pre>"},{"location":"mysql-table/#database_1","title":"\u8907\u6570Database\u306e\u5404\u5bb9\u91cf","text":"<pre><code>mysql&gt; SELECT TABLE_SCHEMA, SUM(data_length+index_length) / 1024 / 1024 AS 'Size'  FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA IN  (\"dbname_table1\", \"dbname_table2\") GROUP BY TABLE_SCHEMA;\n+--------------------+--------------+\n| TABLE_SCHEMA       | Size         |\n+--------------------+--------------+\n| dbname_table1      | 688.31250000 |\n| dbname_table2      | 657.39062500 |\n+--------------------+--------------+\n2 rows in set (0.09 sec)\n\nmysql&gt;\n</code></pre>"},{"location":"mysql-table/#database-and","title":"\u8907\u6570Database\u306e\u7dcf\u5bb9\u91cf and \u5404\u5bb9\u91cf","text":"<pre><code>mysql&gt; SELECT  SUM(data_length+index_length) / 1024 / 1024 / 1024 AS 'Size GB'  FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA like \"dbname_table_%\"  ;\n+----------------+\n| Size GB        |\n+----------------+\n| 3.150512695313 |\n+----------------+\n1 row in set (0.58 sec)\n\nmysql&gt; SELECT TABLE_SCHEMA, SUM(data_length+index_length) / 1024 / 1024 AS 'Size'  FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA like \"dbname_table_%\"  GROUP BY TABLE_SCHEMA;\n+---------------------------+--------------+\n| TABLE_SCHEMA              | Size         |\n+---------------------------+--------------+\n| dbname_table_1            | 661.78125000 |\n| dbname_table_2            | 158.42187500 |\n| dbname_table_3            | 472.39062500 |\n| dbname_table_4            | 196.60937500 |\n| dbname_table_5            |  82.23437500 |\n| dbname_table_6            | 479.35937500 |\n| dbname_table_7            | 403.57812500 |\n| dbname_table_8            | 197.03125000 |\n| dbname_table_9            | 156.93750000 |\n| dbname_table_10           | 400.75000000 |\n| dbname_table_11           |  17.03125000 |\n+---------------------------+--------------+\n11 rows in set (0.60 sec)\n\nmysql&gt;\n</code></pre>"},{"location":"mysql/","title":"MySQL","text":""},{"location":"mysql/#mysql","title":"Mysql\u53c2\u6570\u4f18\u5316\u5bf9\u4e8e\u65b0\u624b\u6765\u8bb2\uff0c\u662f\u6bd4\u8f83\u96be\u61c2\u7684\u4e1c\u897f\uff0c\u5176\u5b9e\u8fd9\u4e2a\u53c2\u6570\u4f18\u5316\uff0c\u662f\u4e2a\u5f88\u590d\u6742\u7684\u4e1c\u897f\uff0c","text":"<p>\u5bf9\u4e8e\u4e0d\u540c\u7684\u7f51\u7ad9\uff0c\u53ca\u5176\u5728\u7ebf\u91cf\uff0c\u8bbf\u95ee\u91cf\uff0c\u5e16\u5b50\u6570\u91cf\uff0c\u7f51\u7edc\u60c5\u51b5\uff0c\u4ee5\u53ca\u673a\u5668\u786c\u4ef6\u914d\u7f6e\u90fd\u6709\u5173\u7cfb\uff0c\u4f18\u5316\u4e0d\u53ef\u80fd\u4e00\u6b21\u6027\u5b8c\u6210\uff0c\u9700\u8981\u4e0d\u65ad\u7684\u89c2\u5bdf\u4ee5\u53ca\u8c03\u8bd5\uff0c\u624d\u6709\u53ef\u80fd\u5f97\u5230\u6700\u4f73\u6548\u679c\u3002</p> <pre><code>[client]\nport = 3306\nsocket = /tmp/mysql.sock\n[mysqld]\nport = 3306\nsocket = /tmp/mysql.sock\nbasedir = /usr/local/mysql\ndatadir = /data/mysql\npid-file = /data/mysql/mysql.pid\nuser = mysql\nbind-address = 0.0.0.0\nserver-id = 1 #\u8868\u793a\u662f\u672c\u673a\u7684\u5e8f\u53f7\u4e3a1,\u4e00\u822c\u6765\u8bb2\u5c31\u662fmaster\u7684\u610f\u601d\nskip-name-resolve\n# \u7981\u6b62MySQL\u5bf9\u5916\u90e8\u8fde\u63a5\u8fdb\u884cDNS\u89e3\u6790\uff0c\u4f7f\u7528\u8fd9\u4e00\u9009\u9879\u53ef\u4ee5\u6d88\u9664MySQL\u8fdb\u884cDNS\u89e3\u6790\u7684\u65f6\u95f4\u3002\u4f46\u9700\u8981\u6ce8\u610f\uff0c\u5982\u679c\u5f00\u542f\u8be5\u9009\u9879\uff0c\n# \u5219\u6240\u6709\u8fdc\u7a0b\u4e3b\u673a\u8fde\u63a5\u6388\u6743\u90fd\u8981\u4f7f\u7528IP\u5730\u5740\u65b9\u5f0f\uff0c\u5426\u5219MySQL\u5c06\u65e0\u6cd5\u6b63\u5e38\u5904\u7406\u8fde\u63a5\u8bf7\u6c42\n#skip-networking\nback_log = 600\n# MySQL\u80fd\u6709\u7684\u8fde\u63a5\u6570\u91cf\u3002\u5f53\u4e3b\u8981MySQL\u7ebf\u7a0b\u5728\u4e00\u4e2a\u5f88\u77ed\u65f6\u95f4\u5185\u5f97\u5230\u975e\u5e38\u591a\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u8fd9\u5c31\u8d77\u4f5c\u7528\uff0c\n# \u7136\u540e\u4e3b\u7ebf\u7a0b\u82b1\u4e9b\u65f6\u95f4(\u5c3d\u7ba1\u5f88\u77ed)\u68c0\u67e5\u8fde\u63a5\u5e76\u4e14\u542f\u52a8\u4e00\u4e2a\u65b0\u7ebf\u7a0b\u3002back_log\u503c\u6307\u51fa\u5728MySQL\u6682\u65f6\u505c\u6b62\u56de\u7b54\u65b0\u8bf7\u6c42\u4e4b\u524d\u7684\u77ed\u65f6\u95f4\u5185\u591a\u5c11\u4e2a\u8bf7\u6c42\u53ef\u4ee5\u88ab\u5b58\u5728\u5806\u6808\u4e2d\u3002\n# \u5982\u679c\u671f\u671b\u5728\u4e00\u4e2a\u77ed\u65f6\u95f4\u5185\u6709\u5f88\u591a\u8fde\u63a5\uff0c\u4f60\u9700\u8981\u589e\u52a0\u5b83\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679cMySQL\u7684\u8fde\u63a5\u6570\u636e\u8fbe\u5230max_connections\u65f6\uff0c\u65b0\u6765\u7684\u8bf7\u6c42\u5c06\u4f1a\u88ab\u5b58\u5728\u5806\u6808\u4e2d\uff0c\n# \u4ee5\u7b49\u5f85\u67d0\u4e00\u8fde\u63a5\u91ca\u653e\u8d44\u6e90\uff0c\u8be5\u5806\u6808\u7684\u6570\u91cf\u5373back_log\uff0c\u5982\u679c\u7b49\u5f85\u8fde\u63a5\u7684\u6570\u91cf\u8d85\u8fc7back_log\uff0c\u5c06\u4e0d\u88ab\u6388\u4e88\u8fde\u63a5\u8d44\u6e90\u3002\n# \u53e6\u5916\uff0c\u8fd9\u503c\uff08back_log\uff09\u9650\u4e8e\u60a8\u7684\u64cd\u4f5c\u7cfb\u7edf\u5bf9\u5230\u6765\u7684TCP/IP\u8fde\u63a5\u7684\u4fa6\u542c\u961f\u5217\u7684\u5927\u5c0f\u3002\n# \u4f60\u7684\u64cd\u4f5c\u7cfb\u7edf\u5728\u8fd9\u4e2a\u961f\u5217\u5927\u5c0f\u4e0a\u6709\u5b83\u81ea\u5df1\u7684\u9650\u5236\uff08\u53ef\u4ee5\u68c0\u67e5\u4f60\u7684OS\u6587\u6863\u627e\u51fa\u8fd9\u4e2a\u53d8\u91cf\u7684\u6700\u5927\u503c\uff09\uff0c\u8bd5\u56fe\u8bbe\u5b9aback_log\u9ad8\u4e8e\u4f60\u7684\u64cd\u4f5c\u7cfb\u7edf\u7684\u9650\u5236\u5c06\u662f\u65e0\u6548\u7684\u3002\n\nmax_connections = 1000\n# MySQL\u7684\u6700\u5927\u8fde\u63a5\u6570\uff0c\u5982\u679c\u670d\u52a1\u5668\u7684\u5e76\u53d1\u8fde\u63a5\u8bf7\u6c42\u91cf\u6bd4\u8f83\u5927\uff0c\u5efa\u8bae\u8c03\u9ad8\u6b64\u503c\uff0c\u4ee5\u589e\u52a0\u5e76\u884c\u8fde\u63a5\u6570\u91cf\uff0c\n# \u5f53\u7136\u8fd9\u5efa\u7acb\u5728\u673a\u5668\u80fd\u652f\u6491\u7684\u60c5\u51b5\u4e0b\uff0c\u56e0\u4e3a\u5982\u679c\u8fde\u63a5\u6570\u8d8a\u591a\uff0c\u4ecb\u4e8eMySQL\u4f1a\u4e3a\u6bcf\u4e2a\u8fde\u63a5\u63d0\u4f9b\u8fde\u63a5\u7f13\u51b2\u533a\uff0c\n# \u5c31\u4f1a\u5f00\u9500\u8d8a\u591a\u7684\u5185\u5b58\uff0c\u6240\u4ee5\u8981\u9002\u5f53\u8c03\u6574\u8be5\u503c\uff0c\u4e0d\u80fd\u76f2\u76ee\u63d0\u9ad8\u8bbe\u503c\u3002\u53ef\u4ee5\u8fc7'conn%'\u901a\u914d\u7b26\u67e5\u770b\u5f53\u524d\u72b6\u6001\u7684\u8fde\u63a5\u6570\u91cf\uff0c\u4ee5\u5b9a\u593a\u8be5\u503c\u7684\u5927\u5c0f\u3002\n\nmax_connect_errors = 6000\n# \u5bf9\u4e8e\u540c\u4e00\u4e3b\u673a\uff0c\u5982\u679c\u6709\u8d85\u51fa\u8be5\u53c2\u6570\u503c\u4e2a\u6570\u7684\u4e2d\u65ad\u9519\u8bef\u8fde\u63a5\uff0c\u5219\u8be5\u4e3b\u673a\u5c06\u88ab\u7981\u6b62\u8fde\u63a5\u3002\u5982\u9700\u5bf9\u8be5\u4e3b\u673a\u8fdb\u884c\u89e3\u7981\uff0c\u6267\u884c\uff1aFLUSH HOST\u3002\n\nopen_files_limit = 65535\n# MySQL\u6253\u5f00\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u9650\u5236\uff0c\u9ed8\u8ba4\u6700\u5c0f1024;\u5f53open_files_limit\u6ca1\u6709\u88ab\u914d\u7f6e\u7684\u65f6\u5019\uff0c\u6bd4\u8f83max_connections*5\u548culimit -n\u7684\u503c\uff0c\u54ea\u4e2a\u5927\u7528\u54ea\u4e2a\uff0c\n# \u5f53open_file_limit\u88ab\u914d\u7f6e\u7684\u65f6\u5019\uff0c\u6bd4\u8f83open_files_limit\u548cmax_connections*5\u7684\u503c\uff0c\u54ea\u4e2a\u5927\u7528\u54ea\u4e2a\u3002\n\ntable_open_cache = 128\n# MySQL\u6bcf\u6253\u5f00\u4e00\u4e2a\u8868\uff0c\u90fd\u4f1a\u8bfb\u5165\u4e00\u4e9b\u6570\u636e\u5230table_open_cache\u7f13\u5b58\u4e2d\uff0c\u5f53MySQL\u5728\u8fd9\u4e2a\u7f13\u5b58\u4e2d\u627e\u4e0d\u5230\u76f8\u5e94\u4fe1\u606f\u65f6\uff0c\u624d\u4f1a\u53bb\u78c1\u76d8\u4e0a\u8bfb\u53d6\u3002\u9ed8\u8ba4\u503c64\n# \u5047\u5b9a\u7cfb\u7edf\u6709200\u4e2a\u5e76\u53d1\u8fde\u63a5\uff0c\u5219\u9700\u5c06\u6b64\u53c2\u6570\u8bbe\u7f6e\u4e3a200*N(N\u4e3a\u6bcf\u4e2a\u8fde\u63a5\u6240\u9700\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u6570\u76ee)\uff1b\n# \u5f53\u628atable_open_cache\u8bbe\u7f6e\u4e3a\u5f88\u5927\u65f6\uff0c\u5982\u679c\u7cfb\u7edf\u5904\u7406\u4e0d\u4e86\u90a3\u4e48\u591a\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u90a3\u4e48\u5c31\u4f1a\u51fa\u73b0\u5ba2\u6237\u7aef\u5931\u6548\uff0c\u8fde\u63a5\u4e0d\u4e0a\n\nmax_allowed_packet = 4M\n# \u63a5\u53d7\u7684\u6570\u636e\u5305\u5927\u5c0f\uff1b\u589e\u52a0\u8be5\u53d8\u91cf\u7684\u503c\u5341\u5206\u5b89\u5168\uff0c\u8fd9\u662f\u56e0\u4e3a\u4ec5\u5f53\u9700\u8981\u65f6\u624d\u4f1a\u5206\u914d\u989d\u5916\u5185\u5b58\u3002\n# \u4f8b\u5982\uff0c\u4ec5\u5f53\u4f60\u53d1\u51fa\u957f\u67e5\u8be2\u6216MySQLd\u5fc5\u987b\u8fd4\u56de\u5927\u7684\u7ed3\u679c\u884c\u65f6MySQLd\u624d\u4f1a\u5206\u914d\u66f4\u591a\u5185\u5b58\u3002\n# \u8be5\u53d8\u91cf\u4e4b\u6240\u4ee5\u53d6\u8f83\u5c0f\u9ed8\u8ba4\u503c\u662f\u4e00\u79cd\u9884\u9632\u63aa\u65bd\uff0c\u4ee5\u6355\u83b7\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u9519\u8bef\u4fe1\u606f\u5305\uff0c\u5e76\u786e\u4fdd\u4e0d\u4f1a\u56e0\u5076\u7136\u4f7f\u7528\u5927\u7684\u4fe1\u606f\u5305\u800c\u5bfc\u81f4\u5185\u5b58\u6ea2\u51fa\u3002\n\nbinlog_cache_size = 1M\n# \u4e00\u4e2a\u4e8b\u52a1\uff0c\u5728\u6ca1\u6709\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u4ea7\u751f\u7684\u65e5\u5fd7\uff0c\u8bb0\u5f55\u5230Cache\u4e2d\uff1b\u7b49\u5230\u4e8b\u52a1\u63d0\u4ea4\u9700\u8981\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u5219\u628a\u65e5\u5fd7\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002\u9ed8\u8ba4binlog_cache_size\u5927\u5c0f32K\n\nmax_heap_table_size = 8M\n# \u5b9a\u4e49\u4e86\u7528\u6237\u53ef\u4ee5\u521b\u5efa\u7684\u5185\u5b58\u8868(memory table)\u7684\u5927\u5c0f\u3002\u8fd9\u4e2a\u503c\u7528\u6765\u8ba1\u7b97\u5185\u5b58\u8868\u7684\u6700\u5927\u884c\u6570\u503c\u3002\u8fd9\u4e2a\u53d8\u91cf\u652f\u6301\u52a8\u6001\u6539\u53d8\n\ntmp_table_size = 16M\n# MySQL\u7684heap\uff08\u5806\u79ef\uff09\u8868\u7f13\u51b2\u5927\u5c0f\u3002\u6240\u6709\u8054\u5408\u5728\u4e00\u4e2aDML\u6307\u4ee4\u5185\u5b8c\u6210\uff0c\u5e76\u4e14\u5927\u591a\u6570\u8054\u5408\u751a\u81f3\u53ef\u4ee5\u4e0d\u7528\u4e34\u65f6\u8868\u5373\u53ef\u4ee5\u5b8c\u6210\u3002\n# \u5927\u591a\u6570\u4e34\u65f6\u8868\u662f\u57fa\u4e8e\u5185\u5b58\u7684(HEAP)\u8868\u3002\u5177\u6709\u5927\u7684\u8bb0\u5f55\u957f\u5ea6\u7684\u4e34\u65f6\u8868 (\u6240\u6709\u5217\u7684\u957f\u5ea6\u7684\u548c)\u6216\u5305\u542bBLOB\u5217\u7684\u8868\u5b58\u50a8\u5728\u786c\u76d8\u4e0a\u3002\n# \u5982\u679c\u67d0\u4e2a\u5185\u90e8heap\uff08\u5806\u79ef\uff09\u8868\u5927\u5c0f\u8d85\u8fc7tmp_table_size\uff0cMySQL\u53ef\u4ee5\u6839\u636e\u9700\u8981\u81ea\u52a8\u5c06\u5185\u5b58\u4e2d\u7684heap\u8868\u6539\u4e3a\u57fa\u4e8e\u786c\u76d8\u7684MyISAM\u8868\u3002\n# \u8fd8\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6etmp_table_size\u9009\u9879\u6765\u589e\u52a0\u4e34\u65f6\u8868\u7684\u5927\u5c0f\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u8c03\u9ad8\u8be5\u503c\uff0cMySQL\u540c\u65f6\u5c06\u589e\u52a0heap\u8868\u7684\u5927\u5c0f\uff0c\u53ef\u8fbe\u5230\u63d0\u9ad8\u8054\u63a5\u67e5\u8be2\u901f\u5ea6\u7684\u6548\u679c\n\nread_buffer_size = 2M\n# MySQL\u8bfb\u5165\u7f13\u51b2\u533a\u5927\u5c0f\u3002\u5bf9\u8868\u8fdb\u884c\u987a\u5e8f\u626b\u63cf\u7684\u8bf7\u6c42\u5c06\u5206\u914d\u4e00\u4e2a\u8bfb\u5165\u7f13\u51b2\u533a\uff0cMySQL\u4f1a\u4e3a\u5b83\u5206\u914d\u4e00\u6bb5\u5185\u5b58\u7f13\u51b2\u533a\u3002\n# read_buffer_size\u53d8\u91cf\u63a7\u5236\u8fd9\u4e00\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u3002\n# \u5982\u679c\u5bf9\u8868\u7684\u987a\u5e8f\u626b\u63cf\u8bf7\u6c42\u975e\u5e38\u9891\u7e41\uff0c\u5e76\u4e14\u4f60\u8ba4\u4e3a\u9891\u7e41\u626b\u63cf\u8fdb\u884c\u5f97\u592a\u6162\uff0c\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0\u8be5\u53d8\u91cf\u503c\u4ee5\u53ca\u5185\u5b58\u7f13\u51b2\u533a\u5927\u5c0f\u63d0\u9ad8\u5176\u6027\u80fd\n\nread_rnd_buffer_size = 8M\n# MySQL\u7684\u968f\u673a\u8bfb\u7f13\u51b2\u533a\u5927\u5c0f\u3002\u5f53\u6309\u4efb\u610f\u987a\u5e8f\u8bfb\u53d6\u884c\u65f6(\u4f8b\u5982\uff0c\u6309\u7167\u6392\u5e8f\u987a\u5e8f)\uff0c\u5c06\u5206\u914d\u4e00\u4e2a\u968f\u673a\u8bfb\u7f13\u5b58\u533a\u3002\u8fdb\u884c\u6392\u5e8f\u67e5\u8be2\u65f6\uff0c\n# MySQL\u4f1a\u9996\u5148\u626b\u63cf\u4e00\u904d\u8be5\u7f13\u51b2\uff0c\u4ee5\u907f\u514d\u78c1\u76d8\u641c\u7d22\uff0c\u63d0\u9ad8\u67e5\u8be2\u901f\u5ea6\uff0c\u5982\u679c\u9700\u8981\u6392\u5e8f\u5927\u91cf\u6570\u636e\uff0c\n# \u53ef\u9002\u5f53\u8c03\u9ad8\u8be5\u503c\u3002\u4f46MySQL\u4f1a\u4e3a\u6bcf\u4e2a\u5ba2\u6237\u8fde\u63a5\u53d1\u653e\u8be5\u7f13\u51b2\u7a7a\u95f4\uff0c\u6240\u4ee5\u5e94\u5c3d\u91cf\u9002\u5f53\u8bbe\u7f6e\u8be5\u503c\uff0c\u4ee5\u907f\u514d\u5185\u5b58\u5f00\u9500\u8fc7\u5927\n\nsort_buffer_size = 8M\n# MySQL\u6267\u884c\u6392\u5e8f\u4f7f\u7528\u7684\u7f13\u51b2\u5927\u5c0f\u3002\u5982\u679c\u60f3\u8981\u589e\u52a0ORDER BY\u7684\u901f\u5ea6\uff0c\u9996\u5148\u770b\u662f\u5426\u53ef\u4ee5\u8ba9MySQL\u4f7f\u7528\u7d22\u5f15\u800c\u4e0d\u662f\u989d\u5916\u7684\u6392\u5e8f\u9636\u6bb5\u3002\n# \u5982\u679c\u4e0d\u80fd\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u589e\u52a0sort_buffer_size\u53d8\u91cf\u7684\u5927\u5c0f\n\njoin_buffer_size = 8M\n# \u8054\u5408\u67e5\u8be2\u64cd\u4f5c\u6240\u80fd\u4f7f\u7528\u7684\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u548csort_buffer_size\u4e00\u6837\uff0c\u8be5\u53c2\u6570\u5bf9\u5e94\u7684\u5206\u914d\u5185\u5b58\u4e5f\u662f\u6bcf\u8fde\u63a5\u72ec\u4eab\n\nthread_cache_size = 8\n# \u8fd9\u4e2a\u503c\uff08\u9ed8\u8ba48\uff09\u8868\u793a\u53ef\u4ee5\u91cd\u65b0\u5229\u7528\u4fdd\u5b58\u5728\u7f13\u5b58\u4e2d\u7ebf\u7a0b\u7684\u6570\u91cf\uff0c\u5f53\u65ad\u5f00\u8fde\u63a5\u65f6\u5982\u679c\u7f13\u5b58\u4e2d\u8fd8\u6709\u7a7a\u95f4\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u7684\u7ebf\u7a0b\u5c06\u88ab\u653e\u5230\u7f13\u5b58\u4e2d\uff0c\n# \u5982\u679c\u7ebf\u7a0b\u91cd\u65b0\u88ab\u8bf7\u6c42\uff0c\u90a3\u4e48\u8bf7\u6c42\u5c06\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6,\u5982\u679c\u7f13\u5b58\u4e2d\u662f\u7a7a\u7684\u6216\u8005\u662f\u65b0\u7684\u8bf7\u6c42\uff0c\u90a3\u4e48\u8fd9\u4e2a\u7ebf\u7a0b\u5c06\u88ab\u91cd\u65b0\u521b\u5efa,\u5982\u679c\u6709\u5f88\u591a\u65b0\u7684\u7ebf\u7a0b\uff0c\n# \u589e\u52a0\u8fd9\u4e2a\u503c\u53ef\u4ee5\u6539\u5584\u7cfb\u7edf\u6027\u80fd.\u901a\u8fc7\u6bd4\u8f83Connections\u548cThreads_created\u72b6\u6001\u7684\u53d8\u91cf\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u53d8\u91cf\u7684\u4f5c\u7528\u3002(\u2013&gt;\u8868\u793a\u8981\u8c03\u6574\u7684\u503c)\n# \u6839\u636e\u7269\u7406\u5185\u5b58\u8bbe\u7f6e\u89c4\u5219\u5982\u4e0b\uff1a\n# 1G - &gt; 8\n# 2G - &gt; 16\n# 3G - &gt; 32\n# \u5927\u4e8e3G - &gt; 64\n\nquery_cache_size = 8M\n# MySQL\u7684\u67e5\u8be2\u7f13\u51b2\u5927\u5c0f\uff08\u4ece4.0.1\u5f00\u59cb\uff0cMySQL\u63d0\u4f9b\u4e86\u67e5\u8be2\u7f13\u51b2\u673a\u5236\uff09\u4f7f\u7528\u67e5\u8be2\u7f13\u51b2\uff0cMySQL\u5c06SELECT\u8bed\u53e5\u548c\u67e5\u8be2\u7ed3\u679c\u5b58\u653e\u5728\u7f13\u51b2\u533a\u4e2d\uff0c\n# \u4eca\u540e\u5bf9\u4e8e\u540c\u6837\u7684SELECT\u8bed\u53e5\uff08\u533a\u5206\u5927\u5c0f\u5199\uff09\uff0c\u5c06\u76f4\u63a5\u4ece\u7f13\u51b2\u533a\u4e2d\u8bfb\u53d6\u7ed3\u679c\u3002\u6839\u636eMySQL\u7528\u6237\u624b\u518c\uff0c\u4f7f\u7528\u67e5\u8be2\u7f13\u51b2\u6700\u591a\u53ef\u4ee5\u8fbe\u5230238%\u7684\u6548\u7387\u3002\n# \u901a\u8fc7\u68c0\u67e5\u72b6\u6001\u503c'Qcache_%'\uff0c\u53ef\u4ee5\u77e5\u9053query_cache_size\u8bbe\u7f6e\u662f\u5426\u5408\u7406\uff1a\u5982\u679cQcache_lowmem_prunes\u7684\u503c\u975e\u5e38\u5927\uff0c\u5219\u8868\u660e\u7ecf\u5e38\u51fa\u73b0\u7f13\u51b2\u4e0d\u591f\u7684\u60c5\u51b5\uff0c\n# \u5982\u679cQcache_hits\u7684\u503c\u4e5f\u975e\u5e38\u5927\uff0c\u5219\u8868\u660e\u67e5\u8be2\u7f13\u51b2\u4f7f\u7528\u975e\u5e38\u9891\u7e41\uff0c\u6b64\u65f6\u9700\u8981\u589e\u52a0\u7f13\u51b2\u5927\u5c0f\uff1b\u5982\u679cQcache_hits\u7684\u503c\u4e0d\u5927\uff0c\u5219\u8868\u660e\u4f60\u7684\u67e5\u8be2\u91cd\u590d\u7387\u5f88\u4f4e\uff0c\n# \u8fd9\u79cd\u60c5\u51b5\u4e0b\u4f7f\u7528\u67e5\u8be2\u7f13\u51b2\u53cd\u800c\u4f1a\u5f71\u54cd\u6548\u7387\uff0c\u90a3\u4e48\u53ef\u4ee5\u8003\u8651\u4e0d\u7528\u67e5\u8be2\u7f13\u51b2\u3002\u6b64\u5916\uff0c\u5728SELECT\u8bed\u53e5\u4e2d\u52a0\u5165SQL_NO_CACHE\u53ef\u4ee5\u660e\u786e\u8868\u793a\u4e0d\u4f7f\u7528\u67e5\u8be2\u7f13\u51b2\n\nquery_cache_limit = 2M\n#\u6307\u5b9a\u5355\u4e2a\u67e5\u8be2\u80fd\u591f\u4f7f\u7528\u7684\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u9ed8\u8ba41M\n\nkey_buffer_size = 4M\n# \u6307\u5b9a\u7528\u4e8e\u7d22\u5f15\u7684\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u589e\u52a0\u5b83\u53ef\u5f97\u5230\u66f4\u597d\u5904\u7406\u7684\u7d22\u5f15(\u5bf9\u6240\u6709\u8bfb\u548c\u591a\u91cd\u5199)\uff0c\u5230\u4f60\u80fd\u8d1f\u62c5\u5f97\u8d77\u90a3\u6837\u591a\u3002\u5982\u679c\u4f60\u4f7f\u5b83\u592a\u5927\uff0c\n# \u7cfb\u7edf\u5c06\u5f00\u59cb\u6362\u9875\u5e76\u4e14\u771f\u7684\u53d8\u6162\u4e86\u3002\u5bf9\u4e8e\u5185\u5b58\u57284GB\u5de6\u53f3\u7684\u670d\u52a1\u5668\u8be5\u53c2\u6570\u53ef\u8bbe\u7f6e\u4e3a384M\u6216512M\u3002\u901a\u8fc7\u68c0\u67e5\u72b6\u6001\u503cKey_read_requests\u548cKey_reads\uff0c\n# \u53ef\u4ee5\u77e5\u9053key_buffer_size\u8bbe\u7f6e\u662f\u5426\u5408\u7406\u3002\u6bd4\u4f8bkey_reads/key_read_requests\u5e94\u8be5\u5c3d\u53ef\u80fd\u7684\u4f4e\uff0c\n# \u81f3\u5c11\u662f1:100\uff0c1:1000\u66f4\u597d(\u4e0a\u8ff0\u72b6\u6001\u503c\u53ef\u4ee5\u4f7f\u7528SHOW STATUS LIKE 'key_read%'\u83b7\u5f97)\u3002\u6ce8\u610f\uff1a\u8be5\u53c2\u6570\u503c\u8bbe\u7f6e\u7684\u8fc7\u5927\u53cd\u800c\u4f1a\u662f\u670d\u52a1\u5668\u6574\u4f53\u6548\u7387\u964d\u4f4e\n\nft_min_word_len = 4\n# \u5206\u8bcd\u8bcd\u6c47\u6700\u5c0f\u957f\u5ea6\uff0c\u9ed8\u8ba44\n\ntransaction_isolation = REPEATABLE-READ\n# MySQL\u652f\u63014\u79cd\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\uff0c\u4ed6\u4eec\u5206\u522b\u662f\uff1a\n# READ-UNCOMMITTED, READ-COMMITTED, REPEATABLE-READ, SERIALIZABLE.\n# \u5982\u6ca1\u6709\u6307\u5b9a\uff0cMySQL\u9ed8\u8ba4\u91c7\u7528\u7684\u662fREPEATABLE-READ\uff0cORACLE\u9ed8\u8ba4\u7684\u662fREAD-COMMITTED\n\nlog_bin = mysql-bin\nbinlog_format = mixed\nexpire_logs_days = 30 #\u8d85\u8fc730\u5929\u7684binlog\u5220\u9664\nlog_error = /data/mysql/mysql-error.log #\u9519\u8bef\u65e5\u5fd7\u8def\u5f84\nslow_query_log = 1\nlong_query_time = 1 #\u6162\u67e5\u8be2\u65f6\u95f4 \u8d85\u8fc71\u79d2\u5219\u4e3a\u6162\u67e5\u8be2\nslow_query_log_file = /data/mysql/mysql-slow.log\nperformance_schema = 0\nexplicit_defaults_for_timestamp\n#lower_case_table_names = 1 #\u4e0d\u533a\u5206\u5927\u5c0f\u5199\nskip-external-locking #MySQL\u9009\u9879\u4ee5\u907f\u514d\u5916\u90e8\u9501\u5b9a\u3002\u8be5\u9009\u9879\u9ed8\u8ba4\u5f00\u542f\ndefault-storage-engine = InnoDB #\u9ed8\u8ba4\u5b58\u50a8\u5f15\u64ce\n\ninnodb_file_per_table = 1\n# InnoDB\u4e3a\u72ec\u7acb\u8868\u7a7a\u95f4\u6a21\u5f0f\uff0c\u6bcf\u4e2a\u6570\u636e\u5e93\u7684\u6bcf\u4e2a\u8868\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u6570\u636e\u7a7a\u95f4\n# \u72ec\u7acb\u8868\u7a7a\u95f4\u4f18\u70b9\uff1a\n# 1\uff0e\u6bcf\u4e2a\u8868\u90fd\u6709\u81ea\u5df2\u72ec\u7acb\u7684\u8868\u7a7a\u95f4\u3002\n# 2\uff0e\u6bcf\u4e2a\u8868\u7684\u6570\u636e\u548c\u7d22\u5f15\u90fd\u4f1a\u5b58\u5728\u81ea\u5df2\u7684\u8868\u7a7a\u95f4\u4e2d\u3002\n# 3\uff0e\u53ef\u4ee5\u5b9e\u73b0\u5355\u8868\u5728\u4e0d\u540c\u7684\u6570\u636e\u5e93\u4e2d\u79fb\u52a8\u3002\n# 4\uff0e\u7a7a\u95f4\u53ef\u4ee5\u56de\u6536\uff08\u9664drop table\u64cd\u4f5c\u5904\uff0c\u8868\u7a7a\u4e0d\u80fd\u81ea\u5df2\u56de\u6536\uff09\n# \u7f3a\u70b9\uff1a\n# \u5355\u8868\u589e\u52a0\u8fc7\u5927\uff0c\u5982\u8d85\u8fc7100G\n# \u7ed3\u8bba\uff1a\n# \u5171\u4eab\u8868\u7a7a\u95f4\u5728Insert\u64cd\u4f5c\u4e0a\u5c11\u6709\u4f18\u52bf\u3002\u5176\u5b83\u90fd\u6ca1\u72ec\u7acb\u8868\u7a7a\u95f4\u8868\u73b0\u597d\u3002\u5f53\u542f\u7528\u72ec\u7acb\u8868\u7a7a\u95f4\u65f6\uff0c\u8bf7\u5408\u7406\u8c03\u6574\uff1ainnodb_open_files\n\ninnodb_open_files = 500\n# \u9650\u5236Innodb\u80fd\u6253\u5f00\u7684\u8868\u7684\u6570\u636e\uff0c\u5982\u679c\u5e93\u91cc\u7684\u8868\u7279\u522b\u591a\u7684\u60c5\u51b5\uff0c\u8bf7\u589e\u52a0\u8fd9\u4e2a\u3002\u8fd9\u4e2a\u503c\u9ed8\u8ba4\u662f300\n\ninnodb_buffer_pool_size = 64M\n# InnoDB\u4f7f\u7528\u4e00\u4e2a\u7f13\u51b2\u6c60\u6765\u4fdd\u5b58\u7d22\u5f15\u548c\u539f\u59cb\u6570\u636e, \u4e0d\u50cfMyISAM.\n# \u8fd9\u91cc\u4f60\u8bbe\u7f6e\u8d8a\u5927,\u4f60\u5728\u5b58\u53d6\u8868\u91cc\u9762\u6570\u636e\u65f6\u6240\u9700\u8981\u7684\u78c1\u76d8I/O\u8d8a\u5c11.\n# \u5728\u4e00\u4e2a\u72ec\u7acb\u4f7f\u7528\u7684\u6570\u636e\u5e93\u670d\u52a1\u5668\u4e0a,\u4f60\u53ef\u4ee5\u8bbe\u7f6e\u8fd9\u4e2a\u53d8\u91cf\u5230\u670d\u52a1\u5668\u7269\u7406\u5185\u5b58\u5927\u5c0f\u768480%\n# \u4e0d\u8981\u8bbe\u7f6e\u8fc7\u5927,\u5426\u5219,\u7531\u4e8e\u7269\u7406\u5185\u5b58\u7684\u7ade\u4e89\u53ef\u80fd\u5bfc\u81f4\u64cd\u4f5c\u7cfb\u7edf\u7684\u6362\u9875\u98a0\u7c38.\n# \u6ce8\u610f\u572832\u4f4d\u7cfb\u7edf\u4e0a\u4f60\u6bcf\u4e2a\u8fdb\u7a0b\u53ef\u80fd\u88ab\u9650\u5236\u5728 2-3.5G \u7528\u6237\u5c42\u9762\u5185\u5b58\u9650\u5236,\n# \u6240\u4ee5\u4e0d\u8981\u8bbe\u7f6e\u7684\u592a\u9ad8.\n\ninnodb_write_io_threads = 4\ninnodb_read_io_threads = 4\n# innodb\u4f7f\u7528\u540e\u53f0\u7ebf\u7a0b\u5904\u7406\u6570\u636e\u9875\u4e0a\u7684\u8bfb\u5199 I/O(\u8f93\u5165\u8f93\u51fa)\u8bf7\u6c42,\u6839\u636e\u4f60\u7684 CPU \u6838\u6570\u6765\u66f4\u6539,\u9ed8\u8ba4\u662f4\n# \u6ce8:\u8fd9\u4e24\u4e2a\u53c2\u6570\u4e0d\u652f\u6301\u52a8\u6001\u6539\u53d8,\u9700\u8981\u628a\u8be5\u53c2\u6570\u52a0\u5165\u5230my.cnf\u91cc\uff0c\u4fee\u6539\u5b8c\u540e\u91cd\u542fMySQL\u670d\u52a1,\u5141\u8bb8\u503c\u7684\u8303\u56f4\u4ece 1-64\n\ninnodb_thread_concurrency = 0\n# \u9ed8\u8ba4\u8bbe\u7f6e\u4e3a 0,\u8868\u793a\u4e0d\u9650\u5236\u5e76\u53d1\u6570\uff0c\u8fd9\u91cc\u63a8\u8350\u8bbe\u7f6e\u4e3a0\uff0c\u66f4\u597d\u53bb\u53d1\u6325CPU\u591a\u6838\u5904\u7406\u80fd\u529b\uff0c\u63d0\u9ad8\u5e76\u53d1\u91cf\n\ninnodb_purge_threads = 1\n# InnoDB\u4e2d\u7684\u6e05\u9664\u64cd\u4f5c\u662f\u4e00\u7c7b\u5b9a\u671f\u56de\u6536\u65e0\u7528\u6570\u636e\u7684\u64cd\u4f5c\u3002\u5728\u4e4b\u524d\u7684\u51e0\u4e2a\u7248\u672c\u4e2d\uff0c\n# \u6e05\u9664\u64cd\u4f5c\u662f\u4e3b\u7ebf\u7a0b\u7684\u4e00\u90e8\u5206\uff0c\u8fd9\u610f\u5473\u7740\u8fd0\u884c\u65f6\u5b83\u53ef\u80fd\u4f1a\u5835\u585e\u5176\u5b83\u7684\u6570\u636e\u5e93\u64cd\u4f5c\u3002\n# \u4eceMySQL5.5.X\u7248\u672c\u5f00\u59cb\uff0c\u8be5\u64cd\u4f5c\u8fd0\u884c\u4e8e\u72ec\u7acb\u7684\u7ebf\u7a0b\u4e2d,\u5e76\u652f\u6301\u66f4\u591a\u7684\u5e76\u53d1\u6570\u3002\u7528\u6237\u53ef\u901a\u8fc7\u8bbe\u7f6einnodb_purge_threads\u914d\u7f6e\u53c2\u6570\u6765\u9009\u62e9\u6e05\u9664\u64cd\u4f5c\u662f\u5426\u4f7f\u7528\u5355\n# \u72ec\u7ebf\u7a0b,\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u53c2\u6570\u8bbe\u7f6e\u4e3a0(\u4e0d\u4f7f\u7528\u5355\u72ec\u7ebf\u7a0b),\u8bbe\u7f6e\u4e3a 1 \u65f6\u8868\u793a\u4f7f\u7528\u5355\u72ec\u7684\u6e05\u9664\u7ebf\u7a0b\u3002\u5efa\u8bae\u4e3a1\n\ninnodb_flush_log_at_trx_commit = 2\n# 0\uff1a\u5982\u679cinnodb_flush_log_at_trx_commit\u7684\u503c\u4e3a0,\n#    log buffer\u6bcf\u79d2\u5c31\u4f1a\u88ab\u5237\u5199\u65e5\u5fd7\u6587\u4ef6\u5230\u78c1\u76d8\uff0c\u63d0\u4ea4\u4e8b\u52a1\u7684\u65f6\u5019\u4e0d\u505a\u4efb\u4f55\u64cd\u4f5c\uff08\u6267\u884c\u662f\u7531mysql\u7684master thread\u7ebf\u7a0b\u6765\u6267\u884c\u7684\u3002\n#    \u4e3b\u7ebf\u7a0b\u4e2d\u6bcf\u79d2\u4f1a\u5c06\u91cd\u505a\u65e5\u5fd7\u7f13\u51b2\u5199\u5165\u78c1\u76d8\u7684\u91cd\u505a\u65e5\u5fd7\u6587\u4ef6(REDO LOG)\u4e2d\u3002\u4e0d\u8bba\u4e8b\u52a1\u662f\u5426\u5df2\u7ecf\u63d0\u4ea4\uff09\u9ed8\u8ba4\u7684\u65e5\u5fd7\u6587\u4ef6\u662fib_logfile0,ib_logfile1\n# 1\uff1a\u5f53\u8bbe\u4e3a\u9ed8\u8ba4\u503c1\u7684\u65f6\u5019\uff0c\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u5c06log buffer\u5237\u5199\u5230\u65e5\u5fd7\u3002\n# 2\uff1a\u5982\u679c\u8bbe\u4e3a2,\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd\u4f1a\u5199\u65e5\u5fd7\uff0c\u4f46\u5e76\u4e0d\u4f1a\u6267\u884c\u5237\u7684\u64cd\u4f5c\u3002\u6bcf\u79d2\u5b9a\u65f6\u4f1a\u5237\u5230\u65e5\u5fd7\u6587\u4ef6\u3002\n#    \u8981\u6ce8\u610f\u7684\u662f\uff0c\u5e76\u4e0d\u80fd\u4fdd\u8bc1100%\u6bcf\u79d2\u4e00\u5b9a\u90fd\u4f1a\u5237\u5230\u78c1\u76d8\uff0c\u8fd9\u8981\u53d6\u51b3\u4e8e\u8fdb\u7a0b\u7684\u8c03\u5ea6\u3002\n#    \u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\u5c06\u6570\u636e\u5199\u5165\u4e8b\u52a1\u65e5\u5fd7\uff0c\u800c\u8fd9\u91cc\u7684\u5199\u5165\u4ec5\u662f\u8c03\u7528\u4e86\u6587\u4ef6\u7cfb\u7edf\u7684\u5199\u5165\u64cd\u4f5c\uff0c\n#    \u800c\u6587\u4ef6\u7cfb\u7edf\u662f\u6709 \u7f13\u5b58\u7684\uff0c\u6240\u4ee5\u8fd9\u4e2a\u5199\u5165\u5e76\u4e0d\u80fd\u4fdd\u8bc1\u6570\u636e\u5df2\u7ecf\u5199\u5165\u5230\u7269\u7406\u78c1\u76d8\n# \u9ed8\u8ba4\u503c1\u662f\u4e3a\u4e86\u4fdd\u8bc1\u5b8c\u6574\u7684ACID\u3002\u5f53\u7136\uff0c\u4f60\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u4e3a1\u4ee5\u5916\u7684\u503c\u6765\u6362\u53d6\u66f4\u9ad8\u7684\u6027\u80fd\uff0c\u4f46\u662f\u5728\u7cfb\u7edf\u5d29\u6e83\u7684\u65f6\u5019\uff0c\u4f60\u5c06\u4f1a\u4e22\u59311\u79d2\u7684\u6570\u636e\u3002\n# \u8bbe\u4e3a0\u7684\u8bdd\uff0cmysqld\u8fdb\u7a0b\u5d29\u6e83\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u4e22\u5931\u6700\u540e1\u79d2\u7684\u4e8b\u52a1\u3002\n# \u8bbe\u4e3a2,\u53ea\u6709\u5728\u64cd\u4f5c\u7cfb\u7edf\u5d29\u6e83\u6216\u8005\u65ad\u7535\u7684\u65f6\u5019\u624d\u4f1a\u4e22\u5931\u6700\u540e1\u79d2\u7684\u6570\u636e\u3002InnoDB\u5728\u505a\u6062\u590d\u7684\u65f6\u5019\u4f1a\u5ffd\u7565\u8fd9\u4e2a\u503c\u3002\n### \u603b\u7ed3 ###\n# \u8bbe\u4e3a1\u5f53\u7136\u662f\u6700\u5b89\u5168\u7684\uff0c\u4f46\u6027\u80fd\u9875\u662f\u6700\u5dee\u7684\uff08\u76f8\u5bf9\u5176\u4ed6\u4e24\u4e2a\u53c2\u6570\u800c\u8a00\uff0c\u4f46\u4e0d\u662f\u4e0d\u80fd\u63a5\u53d7\uff09\u3002\n# \u5982\u679c\u5bf9\u6570\u636e\u4e00\u81f4\u6027\u548c\u5b8c\u6574\u6027\u8981\u6c42\u4e0d\u9ad8\uff0c\u5b8c\u5168\u53ef\u4ee5\u8bbe\u4e3a2\uff0c\u5982\u679c\u53ea\u6700\u6c42\u6027\u80fd\uff0c\u4f8b\u5982\u9ad8\u5e76\u53d1\u5199\u7684\u65e5\u5fd7\u670d\u52a1\u5668\uff0c\u8bbe\u4e3a0\u6765\u83b7\u5f97\u66f4\u9ad8\u6027\u80fd\n\ninnodb_log_buffer_size = 2M\n# \u6b64\u53c2\u6570\u786e\u5b9a\u4e9b\u65e5\u5fd7\u6587\u4ef6\u6240\u7528\u7684\u5185\u5b58\u5927\u5c0f\uff0c\u4ee5M\u4e3a\u5355\u4f4d\u3002\u7f13\u51b2\u533a\u66f4\u5927\u80fd\u63d0\u9ad8\u6027\u80fd\uff0c\u4f46\u610f\u5916\u7684\u6545\u969c\u5c06\u4f1a\u4e22\u5931\u6570\u636e\u3002MySQL\u5f00\u53d1\u4eba\u5458\u5efa\u8bae\u8bbe\u7f6e\u4e3a1\uff0d8M\u4e4b\u95f4\n\ninnodb_log_file_size = 32M\n# \u6b64\u53c2\u6570\u786e\u5b9a\u6570\u636e\u65e5\u5fd7\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u66f4\u5927\u7684\u8bbe\u7f6e\u53ef\u4ee5\u63d0\u9ad8\u6027\u80fd\uff0c\u4f46\u4e5f\u4f1a\u589e\u52a0\u6062\u590d\u6545\u969c\u6570\u636e\u5e93\u6240\u9700\u7684\u65f6\u95f4\n\ninnodb_log_files_in_group = 3\n# \u4e3a\u63d0\u9ad8\u6027\u80fd\uff0cMySQL\u53ef\u4ee5\u4ee5\u5faa\u73af\u65b9\u5f0f\u5c06\u65e5\u5fd7\u6587\u4ef6\u5199\u5230\u591a\u4e2a\u6587\u4ef6\u3002\u63a8\u8350\u8bbe\u7f6e\u4e3a3\n\ninnodb_max_dirty_pages_pct = 90\n# innodb\u4e3b\u7ebf\u7a0b\u5237\u65b0\u7f13\u5b58\u6c60\u4e2d\u7684\u6570\u636e\uff0c\u4f7f\u810f\u6570\u636e\u6bd4\u4f8b\u5c0f\u4e8e90%\n\ninnodb_lock_wait_timeout = 120 \n# InnoDB\u4e8b\u52a1\u5728\u88ab\u56de\u6eda\u4e4b\u524d\u53ef\u4ee5\u7b49\u5f85\u4e00\u4e2a\u9501\u5b9a\u7684\u8d85\u65f6\u79d2\u6570\u3002\n# InnoDB\u5728\u5b83\u81ea\u5df1\u7684\u9501\u5b9a\u8868\u4e2d\u81ea\u52a8\u68c0\u6d4b\u4e8b\u52a1\u6b7b\u9501\u5e76\u4e14\u56de\u6eda\u4e8b\u52a1\u3002InnoDB\u7528LOCK TABLES\u8bed\u53e5\u6ce8\u610f\u5230\u9501\u5b9a\u8bbe\u7f6e\u3002\u9ed8\u8ba4\u503c\u662f50\u79d2\n\nbulk_insert_buffer_size = 8M\n# \u6279\u91cf\u63d2\u5165\u7f13\u5b58\u5927\u5c0f\uff0c \u8fd9\u4e2a\u53c2\u6570\u662f\u9488\u5bf9MyISAM\u5b58\u50a8\u5f15\u64ce\u6765\u8bf4\u7684\u3002\n# \u9002\u7528\u4e8e\u5728\u4e00\u6b21\u6027\u63d2\u5165100-1000+\u6761\u8bb0\u5f55\u65f6\uff0c \u63d0\u9ad8\u6548\u7387\u3002\u9ed8\u8ba4\u503c\u662f8M\u3002\u53ef\u4ee5\u9488\u5bf9\u6570\u636e\u91cf\u7684\u5927\u5c0f\uff0c\u7ffb\u500d\u589e\u52a0\u3002\n\nmyisam_sort_buffer_size = 8M\n# MyISAM\u8bbe\u7f6e\u6062\u590d\u8868\u4e4b\u65f6\u4f7f\u7528\u7684\u7f13\u51b2\u533a\u7684\u5c3a\u5bf8\uff0c\u5f53\u5728REPAIR TABLE\u6216\u7528CREATE INDEX\u521b\u5efa\u7d22\u5f15\u6216ALTER TABLE\u8fc7\u7a0b\u4e2d\u6392\u5e8f MyISAM\u7d22\u5f15\u5206\u914d\u7684\u7f13\u51b2\u533a\n\nmyisam_max_sort_file_size = 10G\n# \u5982\u679c\u4e34\u65f6\u6587\u4ef6\u4f1a\u53d8\u5f97\u8d85\u8fc7\u7d22\u5f15\uff0c\u4e0d\u8981\u4f7f\u7528\u5feb\u901f\u6392\u5e8f\u7d22\u5f15\u65b9\u6cd5\u6765\u521b\u5efa\u4e00\u4e2a\u7d22\u5f15\u3002\u6ce8\u91ca\uff1a\u8fd9\u4e2a\u53c2\u6570\u4ee5\u5b57\u8282\u7684\u5f62\u5f0f\u7ed9\u51fa\n\nmyisam_repair_threads = 1\n# \u5982\u679c\u8be5\u503c\u5927\u4e8e1\uff0c\u5728Repair by sorting\u8fc7\u7a0b\u4e2d\u5e76\u884c\u521b\u5efaMyISAM\u8868\u7d22\u5f15(\u6bcf\u4e2a\u7d22\u5f15\u5728\u81ea\u5df1\u7684\u7ebf\u7a0b\u5185) \n\ninteractive_timeout = 28800\n# \u670d\u52a1\u5668\u5173\u95ed\u4ea4\u4e92\u5f0f\u8fde\u63a5\u524d\u7b49\u5f85\u6d3b\u52a8\u7684\u79d2\u6570\u3002\u4ea4\u4e92\u5f0f\u5ba2\u6237\u7aef\u5b9a\u4e49\u4e3a\u5728\n# mysql_real_connect()\u4e2d\u4f7f\u7528CLIENT_INTERACTIVE\u9009\u9879\u7684\u5ba2\u6237\u7aef\u3002\u9ed8\u8ba4\u503c\uff1a28800\u79d2\uff088\u5c0f\u65f6\uff09\n\nwait_timeout = 28800\n# \u670d\u52a1\u5668\u5173\u95ed\u975e\u4ea4\u4e92\u8fde\u63a5\u4e4b\u524d\u7b49\u5f85\u6d3b\u52a8\u7684\u79d2\u6570\u3002\u5728\u7ebf\u7a0b\u542f\u52a8\u65f6\uff0c\u6839\u636e\u5168\u5c40wait_timeout\u503c\u6216\u5168\u5c40interactive_timeout\u503c\u521d\u59cb\u5316\u4f1a\u8bddwait_timeout\u503c\uff0c\n# \u53d6\u51b3\u4e8e\u5ba2\u6237\u7aef\u7c7b\u578b(\u7531mysql_real_connect()\u7684\u8fde\u63a5\u9009\u9879CLIENT_INTERACTIVE\u5b9a\u4e49)\u3002\u53c2\u6570\u9ed8\u8ba4\u503c\uff1a28800\u79d2\uff088\u5c0f\u65f6\uff09\n# MySQL\u670d\u52a1\u5668\u6240\u652f\u6301\u7684\u6700\u5927\u8fde\u63a5\u6570\u662f\u6709\u4e0a\u9650\u7684\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u8fde\u63a5\u7684\u5efa\u7acb\u90fd\u4f1a\u6d88\u8017\u5185\u5b58\uff0c\u56e0\u6b64\u6211\u4eec\u5e0c\u671b\u5ba2\u6237\u7aef\u5728\u8fde\u63a5\u5230MySQL Server\u5904\u7406\u5b8c\u76f8\u5e94\u7684\u64cd\u4f5c\u540e\uff0c\n# \u5e94\u8be5\u65ad\u5f00\u8fde\u63a5\u5e76\u91ca\u653e\u5360\u7528\u7684\u5185\u5b58\u3002\u5982\u679c\u4f60\u7684MySQL Server\u6709\u5927\u91cf\u7684\u95f2\u7f6e\u8fde\u63a5\uff0c\u4ed6\u4eec\u4e0d\u4ec5\u4f1a\u767d\u767d\u6d88\u8017\u5185\u5b58\uff0c\u800c\u4e14\u5982\u679c\u8fde\u63a5\u4e00\u76f4\u5728\u7d2f\u52a0\u800c\u4e0d\u65ad\u5f00\uff0c\n# \u6700\u7ec8\u80af\u5b9a\u4f1a\u8fbe\u5230MySQL Server\u7684\u8fde\u63a5\u4e0a\u9650\u6570\uff0c\u8fd9\u4f1a\u62a5'too many connections'\u7684\u9519\u8bef\u3002\u5bf9\u4e8ewait_timeout\u7684\u503c\u8bbe\u5b9a\uff0c\u5e94\u8be5\u6839\u636e\u7cfb\u7edf\u7684\u8fd0\u884c\u60c5\u51b5\u6765\u5224\u65ad\u3002\n# \u5728\u7cfb\u7edf\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7show processlist\u547d\u4ee4\u67e5\u770b\u5f53\u524d\u7cfb\u7edf\u7684\u8fde\u63a5\u72b6\u6001\uff0c\u5982\u679c\u53d1\u73b0\u6709\u5927\u91cf\u7684sleep\u72b6\u6001\u7684\u8fde\u63a5\u8fdb\u7a0b\uff0c\u5219\u8bf4\u660e\u8be5\u53c2\u6570\u8bbe\u7f6e\u7684\u8fc7\u5927\uff0c\n# \u53ef\u4ee5\u8fdb\u884c\u9002\u5f53\u7684\u8c03\u6574\u5c0f\u4e9b\u3002\u8981\u540c\u65f6\u8bbe\u7f6einteractive_timeout\u548cwait_timeout\u624d\u4f1a\u751f\u6548\u3002\n[mysqldump]\nquick\nmax_allowed_packet = 16M #\u670d\u52a1\u5668\u53d1\u9001\u548c\u63a5\u53d7\u7684\u6700\u5927\u5305\u957f\u5ea6\n[myisamchk]\nkey_buffer_size = 8M\nsort_buffer_size = 8M\nread_buffer = 4M\nwrite_buffer = 4M\n</code></pre>"},{"location":"mysql/#innodb_flush_log_at_trx_commit","title":"innodb_flush_log_at_trx_commit","text":""},{"location":"mysql/#innodb_buffer_pool_size","title":"innodb_buffer_pool_size","text":"<p>\u5982 \u679c\u7528Innodb\uff0c\u90a3\u4e48\u8fd9\u662f\u4e00\u4e2a\u91cd\u8981\u53d8\u91cf\u3002\u76f8\u5bf9\u4e8eMyISAM\u6765\u8bf4\uff0cInnodb\u5bf9\u4e8ebuffer size\u66f4\u654f\u611f\u3002MySIAM\u53ef\u80fd\u5bf9\u4e8e\u5927\u6570\u636e\u91cf\u4f7f\u7528\u9ed8\u8ba4\u7684key_buffer_size\u4e5f\u8fd8\u597d\uff0c\u4f46Innodb\u5728\u5927\u6570\u636e\u91cf\u65f6\u7528\u9ed8\u8ba4\u503c\u5c31\u611f\u89c9\u5728\u722c\u4e86\u3002 Innodb\u7684\u7f13\u51b2\u6c60\u4f1a\u7f13\u5b58\u6570\u636e\u548c\u7d22\u5f15\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u7ed9\u7cfb\u7edf\u7684\u7f13\u5b58\u7559\u7a7a\u95f4\uff0c\u5982\u679c\u53ea\u7528Innodb\uff0c\u53ef\u4ee5\u628a\u8fd9\u4e2a\u503c\u8bbe\u4e3a\u5185\u5b58\u768470%-80%\u3002\u548c key_buffer\u76f8\u540c\uff0c\u5982\u679c\u6570\u636e\u91cf\u6bd4\u8f83\u5c0f\u4e5f\u4e0d\u600e\u4e48\u589e\u52a0\uff0c\u90a3\u4e48\u4e0d\u8981\u628a\u8fd9\u4e2a\u503c\u8bbe\u592a\u9ad8\u4e5f\u53ef\u4ee5\u63d0\u9ad8\u5185\u5b58\u7684\u4f7f\u7528\u7387\u3002</p>"},{"location":"mysql/#innodb_additional_pool_size","title":"innodb_additional_pool_size","text":"<p>\u8fd9\u4e2a\u7684\u6548\u679c\u4e0d\u662f\u5f88\u660e\u663e\uff0c\u81f3\u5c11\u662f\u5f53\u64cd\u4f5c\u7cfb\u7edf\u80fd\u5408\u7406\u5206\u914d\u5185\u5b58\u65f6\u3002\u4f46\u4f60\u53ef\u80fd\u4ecd\u9700\u8981\u8bbe\u621020M\u6216\u66f4\u591a\u4e00\u70b9\u4ee5\u770bInnodb\u4f1a\u5206\u914d\u591a\u5c11\u5185\u5b58\u505a\u5176\u4ed6\u7528\u9014\u3002</p>"},{"location":"mysql/#innodb_log_file_size","title":"innodb_log_file_size","text":"<p>\u5bf9\u4e8e\u5199\u5f88\u591a\u5c24\u5176\u662f\u5927\u6570\u636e\u91cf\u65f6\u975e\u5e38\u91cd\u8981\u3002\u8981\u6ce8\u610f\uff0c\u5927\u7684\u6587\u4ef6\u63d0\u4f9b\u66f4\u9ad8\u7684\u6027\u80fd\uff0c\u4f46\u6570\u636e\u5e93\u6062\u590d\u65f6\u4f1a\u7528\u66f4\u591a\u7684\u65f6\u95f4\u3002\u6211\u4e00\u822c\u752864M-512M\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u670d\u52a1\u5668\u7684\u7a7a\u95f4\u3002</p>"},{"location":"mysql/#innodb_log_buffer_size","title":"innodb_log_buffer_size","text":"<p>\u9ed8\u8ba4\u503c\u5bf9\u4e8e\u591a\u6570\u4e2d\u7b49\u5199\u64cd\u4f5c\u548c\u4e8b\u52a1\u77ed\u7684\u8fd0\u7528\u90fd\u662f\u53ef\u4ee5\u7684\u3002\u5982 \u679c\u7ecf\u5e38\u505a\u66f4\u65b0\u6216\u8005\u4f7f\u7528\u4e86\u5f88\u591ablob\u6570\u636e\uff0c\u5e94\u8be5\u589e\u5927\u8fd9\u4e2a\u503c\u3002\u4f46\u592a\u5927\u4e86\u4e5f\u662f\u6d6a\u8d39\u5185\u5b58\uff0c\u56e0\u4e3a1\u79d2\u949f\u603b\u4f1a flush\uff08\u8fd9\u4e2a\u8bcd\u7684\u4e2d\u6587\u600e\u4e48\u8bf4\u5462\uff1f\uff09\u4e00\u6b21\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u8bbe\u5230\u8d85\u8fc71\u79d2\u7684\u9700\u6c42\u30028M-16M\u4e00\u822c\u5e94\u8be5\u591f\u4e86\u3002\u5c0f\u7684\u8fd0\u7528\u53ef\u4ee5\u8bbe\u66f4\u5c0f\u4e00\u70b9\u3002</p>"},{"location":"mysql/#innodb_flush_log_at_trx_commit_1","title":"innodb_flush_log_at_trx_commit  \uff08\u8fd9\u4e2a\u5f88\u7ba1\u7528\uff09","text":"<p>\u62b1\u6028Innodb\u6bd4MyISAM\u6162 100\u500d\uff1f\u90a3\u4e48\u4f60\u5927\u6982\u662f\u5fd8\u4e86\u8c03\u6574\u8fd9\u4e2a\u503c\u3002\u9ed8\u8ba4\u503c1\u7684\u610f\u601d\u662f\u6bcf\u4e00\u6b21\u4e8b\u52a1\u63d0\u4ea4\u6216\u4e8b\u52a1\u5916\u7684\u6307\u4ee4\u90fd\u9700\u8981\u628a\u65e5\u5fd7\u5199\u5165\uff08flush\uff09\u786c\u76d8\uff0c\u8fd9\u662f\u5f88\u8d39\u65f6\u7684\u3002\u7279\u522b\u662f\u4f7f\u7528\u7535 \u6c60\u4f9b\u7535\u7f13\u5b58\uff08Battery backed up cache\uff09\u65f6\u3002\u8bbe\u62102\u5bf9\u4e8e\u5f88\u591a\u8fd0\u7528\uff0c\u7279\u522b\u662f\u4eceMyISAM\u8868\u8f6c\u8fc7\u6765\u7684\u662f\u53ef\u4ee5\u7684\uff0c\u5b83\u7684\u610f\u601d\u662f\u4e0d\u5199\u5165\u786c\u76d8\u800c\u662f\u5199\u5165\u7cfb\u7edf\u7f13\u5b58\u3002\u65e5\u5fd7\u4ecd\u7136\u4f1a\u6bcf\u79d2flush\u5230\u786c \u76d8\uff0c\u6240\u4ee5\u4f60\u4e00\u822c\u4e0d\u4f1a\u4e22\u5931\u8d85\u8fc71-2\u79d2\u7684\u66f4\u65b0\u3002\u8bbe\u62100\u4f1a\u66f4\u5feb\u4e00\u70b9\uff0c\u4f46\u5b89\u5168\u65b9\u9762\u6bd4\u8f83\u5dee\uff0c\u5373\u4f7fMySQL\u6302\u4e86\u4e5f\u53ef\u80fd\u4f1a\u4e22\u5931\u4e8b\u52a1\u7684\u6570\u636e\u3002\u800c\u503c2\u53ea\u4f1a\u5728\u6574\u4e2a\u64cd\u4f5c\u7cfb\u7edf \u6302\u4e86\u65f6\u624d\u53ef\u80fd\u4e22\u6570\u636e\u3002 </p>"},{"location":"mysql/#innodb_flush_log_at_trx_commit_2","title":"innodb_flush_log_at_trx_commit","text":"<pre><code>If the value of innodb_flush_log_at_trx_commit is 0, the log buffer is written out to the log file once per second and the flush to disk operation is performed on the log file, but nothing is done at a transaction commit. When the value is 1, the log buffer is written out to the log file at each transaction commit and the flush to disk operation is performed on the log file. When the value is 2, the log buffer is written out to the file at each commit, but the flush to disk operation is not performed on it. However, the flushing on the log file takes place once per second also when the value is 2. Note that the once-per-second flushing is not 100% guaranteed to happen every second, due to process scheduling issues.\n\nThe default value of this variable is 1 (prior to MySQL 4.0.13, the default is 0).\n\nA value of 1 is required for ACID compliance. You can achieve better performance by setting the value different from 1, but then you can lose at most one second worth of transactions in a crash. With a value of 0, any mysqldprocess crash can erase the last second of transactions. With a value of 2, then only an operating system crash or a power outage can erase the last second of transactions. However, InnoDB's crash recovery is not affected and thus crash recovery does work regardless of the value.\nNote\n\nFor the greatest possible durability and consistency in a replication setup using InnoDB with transactions, use innodb_flush_log_at_trx_commit=1, sync_binlog=1, and innodb-safe-binlog in your master server my.cnf file.\nCaution\n\nMany operating systems and some disk hardware fool the flush-to-disk operation. They may tellmysqld that the flush has taken place, even though it has not. Then the durability of transactions is not guaranteed even with the setting 1, and in the worst case a power outage can even corrupt theInnoDB database. Using a battery-backed disk cache in the SCSI disk controller or in the disk itself speeds up file flushes, and makes the operation safer. You can also try using the Unix commandhdparm to disable the caching of disk writes in hardware caches, or use some other command specific to the hardware vendor.\n</code></pre>"},{"location":"mysql/#mycnf","title":"my.cnf \u6700\u7d42\u5f62\u614b","text":"<pre><code>[mysql]\ndefault-character-set=utf8\nsocket=/tmp/mysql.sock\n\n[mysqld]\nuser=mysql\ndatadir=/home/mysql\nsocket=/tmp/mysql.sock\ntmpdir=/home/tmp\nslow_query_log=1\n# slow query \u6a5f\u80fd\u3092ON\u306b\u3059\u308b\nlong_query_time=10\n# slow query \u6642\u9593\u309210\u79d2\u306b\u8a2d\u5b9a\nslow_query_log_file=/var/log/mysql/slow_query.log\nlog-error=/var/log/mysql/error.log\nlog_output=FILE\n# log\u5f62\u5f0f\u3092file\u5f0f\u306b\u8a2d\u5b9a\n\n#myisam\nmyisam_sort_buffer_size=128M\n# MyISAM\u3067\u4ee5\u4e0b\u306e\u6642\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u30bd\u30fc\u30c8\u306b\u4f7f\u308f\u308c\u308b\u30e1\u30e2\u30ea\u4e0a\u306e\u9818\u57df\u3067\u3059\u3002 \n# REPAIR TABLE\u3001CREATE INDEX\u3001ALTER INDEX\u3002\u901a\u5e38\u306e\u30af\u30a8\u30ea(DML)\u3067\u306f\u4f7f\u308f\u308c\u306a\u3044\u3088\u3046\u306a\u306e\u3067\u3001\u305d\u308c\u307b\u3069\u591a\u304f\u3059\u308b\u5fc5\u8981\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u3002\n\nkey_buffer_size=512M\n# MyISAM\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\u30e1\u30e2\u30ea\u4e0a\u306e\u9818\u57df\u3067\u3059\u3002\n# \u591a\u304f\u5272\u308a\u5f53\u3066\u305f\u65b9\u304c\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u5411\u4e0a\u3057\u307e\u3059\u3002\u30b0\u30ed\u30fc\u30d0\u30eb\u30d0\u30c3\u30d5\u30a1\u306a\u306e\u3067\u3069\u304b\u3093\u3068\u5272\u308a\u5f53\u3066\u3089\u308c\u307e\u3059\u3002\n# \u3082\u3057\u3001MyISAM\u3092(\u3042\u307e\u308a)\u4f7f\u3063\u3066\u306a\u3044\u306e\u306a\u3089\u3070\u3001\u5c0f\u3055\u304f\u3057\u3066\u307b\u304b\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u56de\u3059\u306e\u3082\u30a2\u30ea\u3067\u3059\u3002\n\nsort_buffer_size=2M\n# ORDER BY\u3084GROUP BY\u306e\u3068\u304d\u306b\u4f7f\u308f\u308c\u308b\u30e1\u30e2\u30ea\u4e0a\u306e\u9818\u57df\u3067\u3059\u3002\n\nread_buffer_size=2M\n# \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u7528\u3044\u306a\u3044\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30e3\u30f3\u306e\u3068\u304d\u306b\u4f7f\u308f\u308c\u308b\u30e1\u30e2\u30ea\u4e0a\u306e\u9818\u57df\u3067\u3059\u3002\n\nread_rnd_buffer_size=2M\n# \u30bd\u30fc\u30c8\u5f8c\u306b\u30ec\u30b3\u30fc\u30c9\u3092\u8aad\u3080\u3068\u304d\u306b\u4f7f\u308f\u308c\u308b\u30e1\u30e2\u30ea\u4e0a\u306e\u9818\u57df\u3067\u3059\u3002\n# \u30c7\u30a3\u30b9\u30afI/O\u304c\u6e1b\u308b\u306e\u3067ORDER BY\u306e\u6027\u80fd\u5411\u4e0a\u304c\u671f\u5f85\u3067\u304d\u307e\u3059\u3002\n\n#server\ndefault-storage-engine=INNODB\nskip-name-resolve\n# DNS\u89e3\u6c7a\u3092OFF\u306b\u3059\u308b\nskip-ssl\n# MySQL5.7\u3067\u306fSSL\u5229\u7528\u3057\u306a\u3044\u305f\u3081\u3001OFF\u306b\u3059\u308b\n\nmax_connections=300\n# \u6700\u5927\u63a5\u7d9a\u6570\u3092300\u306b\u3059\u308b\u3001\u30b5\u30fc\u30d0\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3068\u30cd\u30c3\u30c8\u5e2f\u57df\u306b\u3088\u308b\u3082\u306e\u3067\u3001\n# \u4eca\u5f8c\u30b5\u30fc\u30d0\u30ea\u30d7\u30ec\u30fc\u30b9\u306810G\u5316\u3057\u305f\u5f8c\u3001\u5909\u66f4\u3059\u308b\u5fc5\u8981\u3042\u308a\u307e\u3059\u3002\n\nmax_connect_errors=300\n# \u9023\u7d9a\u3057\u3066\u63a5\u7d9a\u8981\u6c42\u304c\u4e2d\u65ad\u3055\u308c\u305f\u5834\u5408\u306b\u305d\u308c\u3092\u8a31\u53ef\u3059\u308b\u56de\u6570\u3092\u6c7a\u5b9a\u3057\u307e\u3059\u3002\n\nmax_allowed_packet=16M\n# MySQL Server \u304a\u3088\u3073\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u9593\u3067\u8ee2\u9001\u53ef\u80fd\u306a\u30d1\u30b1\u30c3\u30c8\u6570\u3002\n\nquery_cache_size=512M\n# \u30af\u30a8\u30ea\u30ad\u30e3\u30c3\u30b7\u30e5\u9818\u57df\u3002\n\nquery_cache_limit=32M\n# \u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\u30af\u30a8\u30ea\u7d50\u679c\u306e\u6700\u5927\u30b5\u30a4\u30ba\u3002\nquery_cache_type=1\n# SELECT SQL_NO_CACHE \u4ee5\u5916\u306e\u30af\u30a8\u30ea\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\n\nconnect_timeout=30\n# connect timeout \u6642\u9593\u309230\u79d2\u306b\u8a2d\u5b9a\n\nmax_user_connections=30\n# \u5358\u4e00\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u3088\u308b\u540c\u6642\u63a5\u7d9a\u306e\u6570\n\nthread_cache_size=300\n# \u30b9\u30ec\u30c3\u30c9\u3092\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u306e\u5207\u65ad\u5f8c\u306b\u3082\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u304a\u304f\u6570\u3002\n# thread_cache_size\u3092N\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u3001N\u500b\u306e\u30a2\u30af\u30c6\u30a3\u30d6\u3067\u306a\u3044\u63a5\u7d9a\u30b9\u30ec\u30c3\u30c9\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3067\u304d\u308b\u3002\n# \u95a2\u9023\u4ed8\u3051\u3089\u308c\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u63a5\u7d9a\u304c\u7d42\u4e86\u3059\u308b\u3068\u3001\u63a5\u7d9a\u30b9\u30ec\u30c3\u30c9\u306f\u30a2\u30af\u30c6\u30a3\u30d6\u3067\u306a\u304f\u306a\u308b\u3002\n\nback_log=50\n# MySQL \u3067\u4fdd\u6301\u3067\u304d\u308b\u672a\u51e6\u7406\u306e\u63a5\u7d9a\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u6570\u3002\n\ntable_open_cache=19200\n# \u3059\u3079\u3066\u306e\u30b9\u30ec\u30c3\u30c9\u306b\u3064\u3044\u3066\u958b\u3044\u3066\u3044\u308b\u30c6\u30fc\u30d6\u30eb\u306e\u6570\u3002\n\ntable_definition_cache=16000\n# \u5b9a\u7fa9\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u683c\u7d0d\u53ef\u80fd\u306a (.frm \u30d5\u30a1\u30a4\u30eb\u304b\u3089\u306e) \u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\u306e\u6570\u3002\n\ndelayed_insert_timeout=60\n# \u7d42\u4e86\u3059\u308b\u524d\u306b\u3001INSERT DELAYED \u30cf\u30f3\u30c9\u30e9\u30b9\u30ec\u30c3\u30c9\u304c INSERT \u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u3092\u5f85\u6a5f\u3059\u308b\u79d2\u6570\u3002\n\ninteractive_timeout=300\n# \u30b5\u30fc\u30d0\u30fc\u304c\u5bfe\u8a71\u578b\u306e\u63a5\u7d9a\u3067\u3001\u5bfe\u8a71\u578b\u306e\u63a5\u7d9a\u3092\u9589\u3058\u308b\u524d\u306b\u30a2\u30af\u30c6\u30a3\u30d3\u30c6\u30a3\u30fc\u3092\u5f85\u6a5f\u3059\u308b\u79d2\u6570\u3002\n\nwait_timeout=300\n# \u975e\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u306a\u63a5\u7d9a\u3092\u9589\u3058\u308b\u524d\u306b\u3001\u30b5\u30fc\u30d0\u30fc\u304c\u305d\u306e\u63a5\u7d9a\u4e0a\u3067\u30a2\u30af\u30c6\u30a3\u30d3\u30c6\u30a3\u30fc\u3092\u5f85\u6a5f\u3059\u308b\u79d2\u6570\u3002\n\ntmp_table_size=256M\n# \u5185\u90e8\u30a4\u30f3\u30e1\u30e2\u30ea\u30fc\u306e\u4e00\u6642\u30c6\u30fc\u30d6\u30eb\u306e\u6700\u5927\u30b5\u30a4\u30ba\u3002\n\nmax_heap_table_size=256M\n# \u30e6\u30fc\u30b6\u30fc\u304c\u4f5c\u6210\u3057\u305f MEMORY \u30c6\u30fc\u30d6\u30eb\u306e\u5897\u52a0\u304c\u8a31\u53ef\u3055\u308c\u308b\u6700\u5927\u30b5\u30a4\u30ba\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n# \ncharacter-set-server=utf8\ncollation-server=utf8_general_ci\n\n#innodb options\ninnodb_thread_concurrency=32\n# InnoDB \u306f\u3001\u3053\u306e\u5909\u6570\u3067\u6307\u5b9a\u3055\u308c\u305f\u5236\u9650\u4ee5\u4e0b\u306e\u6570\u306e\u30aa\u30da\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u30b7\u30b9\u30c6\u30e0\u30b9\u30ec\u30c3\u30c9\u3092\u540c\u6642\u306b InnoDB \u5185\u90e8\u306b\u4fdd\u6301\u3057\u3088\u3046\u3068\u8a66\u307f\u307e\u3059 \n# \u30b9\u30ec\u30c3\u30c9\u6570\u304c\u3053\u306e\u5236\u9650\u306b\u9054\u3059\u308b\u3068\u3001\u305d\u308c\u4ee5\u964d\u306e\u30b9\u30ec\u30c3\u30c9\u306f\u5b9f\u884c\u3055\u308c\u308b\u307e\u3067,\n# \u300c\u5148\u5165\u308c\u5148\u51fa\u3057\u300d (FIFO) \u30ad\u30e5\u30fc\u5185\u3067\u5f85\u6a5f\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\u30ed\u30c3\u30af\u3092\u5f85\u6a5f\u3057\u3066\u3044\u308b\u30b9\u30ec\u30c3\u30c9\u306f\u3001\u4e26\u5217\u5b9f\u884c\u4e2d\u306e\u30b9\u30ec\u30c3\u30c9\u306e\u6570\u306b\u30ab\u30a6\u30f3\u30c8\u3055\u308c\u307e\u305b\u3093\u3002\n\ninnodb_buffer_pool_size=48G\n# \u5168\u4f53\u30e1\u30e2\u30ea\u306e50%\u301c60%\u306b\u8a2d\u5b9a\u3059\u308b\u30028\u306e\u500d\u6570\u3002\n\ninnodb_buffer_pool_dump_pct=100\ninnodb_buffer_pool_dump_at_shutdown=1\ninnodb_buffer_pool_load_at_startup=0\n# http://tech.gmo-media.jp/post/128523146249/innodb-buffer-pool-load-at-startup\n\ninnodb_log_file_size=2G\ninnodb_log_files_in_group=2\n# \u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u5404\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u30b5\u30a4\u30ba\u3067\u3059\u3002\u901a\u5e38\u306finnodb_buffer_pool_size\u306e25\uff05\u304c\u826f\u3044\u3068\u8a00\u308f\u308c\u3066\u307e\u3059\u304c\u3001\n# 12G\u306eib_logfile\u304c\u751f\u6210\u3055\u308c\u3001\u30af\u30e9\u30c3\u30b7\u30e5\u30ea\u30ab\u30d0\u30ea\u6642\u306e\u901f\u5ea6\u304c\u9045\u304f\u306a\u308b\u305f\u3081\u30014G\u306b\u3057\u307e\u3057\u305f\u3002\n# \u3082\u3057\u3001SSD\u3067\u306f\u306a\u304f\u3001NVME\u3067\u3042\u308c\u3070\u3001\u9069\u5f53\u306a\u5024\u306b\u5909\u66f4\u3059\u308b\u3079\u304d\u3060\u308d\u3046\u3002\n\ninnodb_log_buffer_size=4M\n# \u30c7\u30a3\u30b9\u30af\u4e0a\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u8fbc\u3080\u969b\u306b InnoDB \u3067\u4f7f\u7528\u3055\u308c\u308b\u30d0\u30c3\u30d5\u30a1\u30fc\u306e\u30b5\u30a4\u30ba\u3067\u3059\u3002\n# \u30ed\u30b0\u30d0\u30c3\u30d5\u30a1\u30fc\u3092\u5927\u304d\u304f\u3059\u308b\u3068\u3001\u30c7\u30a3\u30b9\u30af I/O \u3092\u7bc0\u7d04\u3067\u304d\u307e\u3059\u304c\u3001\u969c\u5bb3\u6642\u30ed\u30fc\u30b9\u3059\u308b\u30c7\u30fc\u30bf\u3082\u591a\u3044\u3001\n# \u63a8\u5968\u306f1\u301c8M\u3067\u3059\u3002\n\ninnodb_file_per_table\n# \u65b0\u305f\u306b\u4f5c\u6210\u3055\u308c\u305f\u5404\u30c6\u30fc\u30d6\u30eb\u306e\u30c7\u30fc\u30bf\u304a\u3088\u3073\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u30b7\u30b9\u30c6\u30e0\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u3067\u306f\u306a\u304f,\n# \u500b\u5225\u306e .ibd \u30d5\u30a1\u30a4\u30eb\u306b\u683c\u7d0d\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u3089\u306e InnoDB \u30c6\u30fc\u30d6\u30eb\u7528\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u306f\u3001\u30c6\u30fc\u30d6\u30eb\u304c\u524a\u9664\u3055\u308c\u305f\u308a\u3001\n# \u5207\u308a\u6368\u3066\u3089\u308c\u305f\u308a\u3059\u308b\u3068\u518d\u5229\u7528\u3055\u308c\u307e\u3059\u30025.6.6 \u4ee5\u4e0a\u306f\u30c7\u30d5\u30a9\u30eb\u30c8ON\u3067\u3059\u3002\n\ninnodb_open_files=9600\n# \u3053\u306e\u5909\u6570\u306f\u3001\u8907\u6570\u306e InnoDB \u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306b\u306e\u307f\u95a2\u9023\u3057\u307e\u3059\u3002\n# MySQL \u3067\u4e00\u5ea6\u306b\u958b\u3044\u305f\u307e\u307e\u306b\u3067\u304d\u308b .ibd \u30d5\u30a1\u30a4\u30eb\u306e\u6700\u5927\u6570\u304c\u6307\u5b9a\u3055\u308c\u307e\u3059\u3002\n\ninnodb_flush_method=O_DIRECT\n# InnoDB \u306e\u30c7\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb\u304a\u3088\u3073\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306b\u30c7\u30fc\u30bf\u3092\u30d5\u30e9\u30c3\u30b7\u30e5\u3059\u308b\u969b\u306b\u4f7f\u7528\u3055\u308c\u308b\u65b9\u6cd5\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n# \u3053\u308c\u306b\u3088\u308a\u3001I/O \u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u304c\u5f71\u97ff\u3092\u53d7\u3051\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u5909\u6570\u306f\u3001Unix \u304a\u3088\u3073 Linux \u30b7\u30b9\u30c6\u30e0\u3067\u306e\u307f\u69cb\u6210\u53ef\u80fd\u3067\u3059\u3002\n# Windows \u30b7\u30b9\u30c6\u30e0\u3067\u306f\u3001\u30d5\u30e9\u30c3\u30b7\u30e5\u65b9\u6cd5\u306f\u5e38\u306b async_unbuffered \u3067\u3042\u308a\u3001\u5909\u66f4\u3067\u304d\u307e\u305b\u3093\u3002\n\n# - fsync: InnoDB \u306f fsync() \u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u3066\u3001\u30c7\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb\u3068\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u4e21\u65b9\u3092\u30d5\u30e9\u30c3\u30b7\u30e5\u3057\u307e\u3059\u3002fsync \u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u3067\u3059\u3002\n# \n# - O_DSYNC: InnoDB \u306f\u3001O_SYNC \u3092\u4f7f\u7528\u3057\u3066\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u3044\u3066\u30d5\u30e9\u30c3\u30b7\u30e5\u3057\u3001fsync() \u3092\u4f7f\u7528\u3057\u3066\u30c7\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb\u3092\u30d5\u30e9\u30c3\u30b7\u30e5\u3057\u307e\u3059\u3002\u3055\u307e\u3056\u307e\u306a\u7a2e\u985e\u306e Unix \u3067\u554f\u984c\u304c\u767a\u751f\u3057\u3066\u3044\u308b\u305f\u3081\u3001InnoDB \u3067\u306f\u76f4\u63a5 O_DSYNC \u304c\u4f7f\u7528\u3055\u308c\u307e\u305b\u3093\u3002\n# \n# - O_DIRECT: InnoDB \u306f\u3001O_DIRECT (Solaris \u3067\u306f directio()) \u3092\u4f7f\u7528\u3057\u3066\u30c7\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304d\u3001fsync() \u3092\u4f7f\u7528\u3057\u3066\u30c7\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb\u3068\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u4e21\u65b9\u3092\u30d5\u30e9\u30c3\u30b7\u30e5\u3057\u307e\u3059\u3002\u3053\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u3001\u4e00\u90e8\u306e GNU/Linux \u30d0\u30fc\u30b8\u30e7\u30f3\u3001FreeBSD\u3001\u304a\u3088\u3073 Solaris \u3067\u4f7f\u7528\u53ef\u80fd\u3067\u3059\u3002\n# \n# - O_DIRECT_NO_FSYNC: InnoDB \u306f\u3001I/O \u306e\u30d5\u30e9\u30c3\u30b7\u30e5\u6642\u306b O_DIRECT \u3092\u4f7f\u7528\u3057\u307e\u3059\u304c\u3001\u5f8c\u7d9a\u306e fsync() \u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\u306f\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059\u3002\u3053\u306e\u8a2d\u5b9a\u306f\u3001\u4e00\u90e8\u306e\u30bf\u30a4\u30d7\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306b\u306f\u9069\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u306e\u4ed6\u306b\u306f\u9069\u3057\u3066\u3044\u307e\u305b\u3093\u3002\u305f\u3068\u3048\u3070\u3001XFS \u306b\u306f\u9069\u3057\u3066\u3044\u307e\u305b\u3093\u3002\u305f\u3068\u3048\u3070\u3001\u4f7f\u7528\u4e2d\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3067\u3059\u3079\u3066\u306e\u30d5\u30a1\u30a4\u30eb\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u4fdd\u6301\u3059\u308b\u305f\u3081\u306b\u3001fsync() \u304c\u5fc5\u8981\u3067\u3042\u308b\u306e\u304b\u3069\u3046\u304b\u304c\u4e0d\u660e\u306a\u5834\u5408\u306f\u3001\u4ee3\u308f\u308a\u306b O_DIRECT \u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f MySQL 5.6.7 (Bug #11754304\u3001Bug #45892) \u3067\u5c0e\u5165\u3055\u308c\u307e\u3057\u305f\u3002\n\ndefault_password_lifetime=0\n# \u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\u3001\u30ec\u30f3\u30b5\u30d0\u3068\u9023\u643a\u3057\u3066\u3044\u308b\u305f\u3081\u3001OFF\u306b\u3057\u307e\u3057\u305f\u3002\n#enforce-gtid-consistency=1\n#gtid-mode=ON\n#safe-user-create=1\n#explicit_defaults_for_timestamp=1\nlog_timestamps=SYSTEM\n# \u30ed\u30b0\u306b\u51fa\u529b\u3055\u308c\u308b\u6642\u523b\u5909\u6570\u3067\u3059\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306fUTC\u3067\u3059\u304c\u3001\u8aad\u307f\u306b\u304f\u3044\u305f\u3081\u3001SYSTEM\u306b\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\n\ndisable-partition-engine-check=1\n# https://yoku0825.blogspot.jp/2017/04/mysql-5717-deprecated-partition-engine.html\n# MySQL8 \u306e\u904e\u6e21\u671f\u306b\u3042\u305f\u308bMySQL 5.7\u306b\u8ffd\u52a0\u3055\u308c\u305f\u3082\u306e\u3067\u3059\u3001\u4eca\u5f8cMySQL8\u30ea\u30ea\u30fc\u30b9\u3057\u305f\u5834\u5408\u3001\n# \u30e6\u30fc\u30b6\u304cDB\u79fb\u8a2d\u3059\u308b\u6642\u7d04\u7acb\u3064\u3060\u308d\u3046\uff08\u3068\u601d\u3046\uff09\u3001\u3057\u304b\u3057\u3001\u6bce\u56deMySQL\u8d77\u52d5\u6642\u306btable\u3068\u30c1\u30a7\u30c3\u30af\u3059\u308b\u305f\u3081\u3001\n# \u6642\u9593\u304b\u304b\u308b\u305f\u3081\u3001disable\u3057\u307e\u3057\u305f\u3002 \n\nshow_compatibility_56=on\n# https://yakst.com/ja/posts/2733\n\ninnodb_buffer_pool_instances=8\n# InnoDB \u306e\u30d0\u30c3\u30d5\u30a1\u30fc\u30d7\u30fc\u30eb\u304c\u5206\u5272\u3055\u308c\u308b\u9818\u57df\u306e\u6570\u3067\u3059\u3002CPU\u30b3\u30a2\u6570\u306b\u5408\u308f\u305b\u308b\u3002\n\ninnodb_rollback_segments=32\n# \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5185\u3067 InnoDB \u304c\u4f7f\u7528\u3059\u308b\u30b7\u30b9\u30c6\u30e0\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u306b\u3042\u308b\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u30bb\u30b0\u30e1\u30f3\u30c8\u306e\u6570\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\ninnodb_write_io_threads=16\ninnodb_read_io_threads=16\n\ninnodb_io_capacity=2000\ninnodb_io_capacity_max=5000\n# MySQL\u30b5\u30fc\u30d0\u306fSSD\u306e\u305f\u3081\u3001io_capacity\u30922000\u301c5000\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n\ninnodb_max_dirty_pages_pct=40\n# InnoDB \u306f\u3001\u30c0\u30fc\u30c6\u30a3\u30fc\u30da\u30fc\u30b8\u306e\u5272\u5408\u304c\u3053\u306e\u5024\u3092\u8d85\u3048\u306a\u3044\u3088\u3046\u306b\u3001\u30d0\u30c3\u30d5\u30a1\u30fc\u30d7\u30fc\u30eb\u304b\u3089\u30c7\u30fc\u30bf\u3092\u30d5\u30e9\u30c3\u30b7\u30e5\u3057\u3088\u3046\u3068\u8a66\u307f\u307e\u3059\u3002\n\ninnodb_flush_log_at_trx_commit=2\n</code></pre>"},{"location":"mysql/#_1","title":"\u73b0\u5728\u7684\u8bbe\u7f6e","text":""},{"location":"mysql/#_2","title":"\u751f\u4ea7\u73af\u5883","text":"<pre><code>[mysql]\ndefault-character-set=utf8mb4\nsocket=/tmp/mysql.sock\n\n[mysqld]\nserver_id=1\nuser=mysql\ndatadir=/home/mysql\nsocket=/tmp/mysql.sock\ntmpdir=/home/tmp\nbind-address=0.0.0.0\n\n# log\nlog_bin=mysql-bin\nbinlog_error_action=IGNORE_ERROR\nexpire_logs_days=2\nslow_query_log=1\nlong_query_time=10\nslow_query_log_file=/var/log/mysql/slow_query.log\nlog_error=/var/log/mysql/error.log\nlog_output=FILE\n\n# server\nsql_mode=\"ONLY_FULL_GROUP_BY,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION\"\ndefault_storage_engine=INNODB\nskip-partition\nskip-name-resolve\nskip-ssl\nskip-symbolic-links\nmax_connections=600\nmax_connect_errors=300\nmax_allowed_packet=16M\nconnect_timeout=30\nmax_user_connections=30\ntable_open_cache=19200\ninteractive_timeout=300\nwait_timeout=300\ntmp_table_size=256M\nmax_heap_table_size=256M\ndefault_password_lifetime=0\nexplicit_defaults_for_timestamp=1\nlog_timestamps=SYSTEM\ndisable_partition_engine_check=1\ncharacter-set-server=utf8mb4\ncollation-server=utf8mb4_general_ci\n\n# buffer\nsort_buffer_size=1M\nread_buffer_size=1M\nread_rnd_buffer_size=1M\n\n# MyISAM\nmyisam_sort_buffer_size=128M\nkey_buffer_size=512M\n\n# InnoDB\ninnodb_strict_mode=1\ninnodb_file_per_table\ninnodb_temp_data_file_path=ibtmp1:12M:autoextend:max:10G\ninnodb_buffer_pool_size=56G\ninnodb_buffer_pool_dump_pct=100\ninnodb_buffer_pool_dump_at_shutdown=1\ninnodb_buffer_pool_load_at_startup=0\ninnodb_log_file_size=512M\ninnodb_write_io_threads=16\ninnodb_read_io_threads=16\ninnodb_io_capacity=2000\ninnodb_io_capacity_max=5000\ninnodb_flush_log_at_trx_commit=2\ninnodb_flush_method=O_DIRECT\ninnodb_flush_neighbors=0\ninnodb_read_ahead_threshold=0\n</code></pre>"},{"location":"mysql8-basic/","title":"mysql8-basic","text":""},{"location":"mysql8-basic/#mysql8","title":"MySQL8\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210","text":"<ul> <li> \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210 <pre><code>[root@rocky8 work]# ll /home/mysql\ntotal 82M\ndrwx------. 11 mysql mysql 4.0K Nov 14 13:24  .\ndrwxr-xr-x.  9 root  root   108 Nov  4 13:54  ..\n-rw-r-----   1 mysql mysql   56 Oct 31 12:16  auto.cnf\n-rw-r-----   1 mysql mysql  11K Nov 14 13:22  ib_buffer_pool\n-rw-r-----   1 mysql mysql  12M Nov 14 13:24  ibdata1\n-rw-r-----   1 mysql mysql  12M Nov 14 13:24  ibtmp1\ndrwxr-xr-x   2 mysql mysql 4.0K Nov 14 11:49 '#innodb_dblwr'\ndrwxr-x---   2 mysql mysql 4.0K Nov 14 13:24 '#innodb_redo'\ndrwxr-x---   2 mysql mysql  187 Nov 14 13:24 '#innodb_temp'\ndrwxr-x---   2 mysql mysql    6 Nov  7 11:49  mydb\ndrwxr-x---   2 mysql mysql  143 Oct 31 12:16  mysql\n-rw-r-----   1 mysql mysql  25M Nov 14 13:24  mysql.ibd\ndrwxr-x---   2 mysql mysql 8.0K Nov 14 10:39  performance_schema\ndrwxr-xr-x   2 mysql mysql  173 Nov  4 12:58  pki\n-rw-r-----   1 mysql mysql    6 Nov 14 13:24  rocky8.pid\ndrwxr-x---   2 mysql mysql 4.0K Oct 31 12:20  sbtest\ndrwxr-x---   2 mysql mysql   28 Oct 31 12:16  sys\n-rw-r-----   1 mysql mysql  16M Nov 14 13:24  undo_001\n-rw-r-----   1 mysql mysql  16M Nov 14 13:24  undo_002\n[root@rocky8 work]#\n</code></pre> </li> </ul>"},{"location":"mysql8-basic/#_1","title":"\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\u8aac\u660e","text":"\u30c7\u30a3\u30ec\u30af\u30c8\u30ea \u8aac\u660e <code>ib_buffer_pool</code> innodb_buffer_pool_dump_at_shutdown \u307e\u305f\u306f innodb_buffer_pool_dump_now \u3067\u751f\u6210\u3055\u308c\u308b\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9 ID \u304a\u3088\u3073\u30da\u30fc\u30b8 ID \u306e\u30ea\u30b9\u30c8\u3092\u4fdd\u6301\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u306e\u540d\u524d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002 \u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9 ID \u304a\u3088\u3073\u30da\u30fc\u30b8 ID \u306f\u3001space, page_id \u3068\u3044\u3046\u5f62\u5f0f\u3067\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002 <code>ibdata1</code> InnoDB \u30b7\u30b9\u30c6\u30e0\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u30c7\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb\u306e\u540d\u524d\u3001\u30b5\u30a4\u30ba\u304a\u3088\u3073\u5c5e\u6027\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002 innodb_data_file_path \u306e\u5024\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u52d5\u4f5c\u3067\u306f\u300112MB \u3092\u5c11\u3057\u8d85\u3048\u308b\u5358\u4e00\u306e\u81ea\u52d5\u62e1\u5f35\u30c7\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb\u304c ibdata1 \u3068\u3044\u3046\u540d\u524d\u3067\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\u3000\u6700\u521d\u306e\u30b7\u30b9\u30c6\u30e0\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u30c7\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb (ibdata1) \u306e\u6700\u5c0f\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u306f\u3001innodb_page_size \u306e\u5024\u306b\u3088\u3063\u3066\u7570\u306a\u308a\u307e\u3059\u3002 \u8a73\u7d30\u306f\u3001innodb_data_file_path \u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u8aac\u660e\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002 <code>ibtmp1</code> \u30b0\u30ed\u30fc\u30d0\u30eb\u4e00\u6642\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u30c7\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb\u306e\u76f8\u5bfe\u30d1\u30b9\u3001\u540d\u524d\u3001\u30b5\u30a4\u30ba\u304a\u3088\u3073\u5c5e\u6027\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002 \u30b0\u30ed\u30fc\u30d0\u30eb\u4e00\u6642\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u306b\u306f\u3001\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\u4e00\u6642\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3059\u308b\u5909\u66f4\u306e\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u30bb\u30b0\u30e1\u30f3\u30c8\u304c\u683c\u7d0d\u3055\u308c\u307e\u3059\u3002innodb_temp_data_file_path \u306b\u5024\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u52d5\u4f5c\u3067\u306f\u3001ibtmp1 \u3068\u3044\u3046\u540d\u524d\u306e\u5358\u4e00\u306e\u81ea\u52d5\u62e1\u5f35\u30c7\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb\u304c innodb_data_home_dir \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002 \u521d\u671f\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u306f 12MB \u3092\u5c11\u3057\u8d85\u3048\u3066\u3044\u307e\u3059\u3002 <code>#innodb_dblwr</code> (#ib_16384_0.dblwr)\u4e8c\u91cd\u66f8\u8fbc\u307f\u30d5\u30a1\u30a4\u30eb\u306e\u6570\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5024 innodb_buffer_pool_instances * 2 <code>/home/mysql/#innodb_dblwr</code>innodb_doublewrite_pages=4  \u25cf  innodb_write_io_threads valueinnodb_doublewrite_files=16  \u25cf  innodb_buffer_pool_instances * 2 <code>#innodb_redo</code> innodb_redo_log_capacity \u25cf  536870912(512MB) \u25cf  ib_logfileInnoDB \u306e Redo \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3078\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30d1\u30b9\u3067\u3059\u3002\u3053\u306e\u6570\u306f\u3001innodb_log_files_in_group \u3067\u6307\u5b9a\u3055\u308c\u307e\u3059\u3002 \u3069\u306e InnoDB \u30ed\u30b0\u5909\u6570\u3082\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u3001MySQL \u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306b ib_logfile0 \u304a\u3088\u3073 ib_logfile1 \u3068\u3044\u3046\u540d\u524d\u306e 2 \u3064\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002 \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u30b5\u30a4\u30ba\u306f\u3001innodb_log_file_size \u30b7\u30b9\u30c6\u30e0\u5909\u6570\u306b\u3088\u3063\u3066\u6307\u5b9a\u3055\u308c\u307e\u3059\u3002 <code>#innodb_temp</code> innodb_temp_data_file_path-  ibtmp1:12M:autoextend:max:10Ginnodb_temp_tablespaces_dir-  <code>./#innodb_temp/</code>\u8d77\u52d5\u6642\u306b InnoDB \u304c\u30bb\u30c3\u30b7\u30e7\u30f3\u4e00\u6642\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u306e\u30d7\u30fc\u30eb\u3092\u4f5c\u6210\u3059\u308b\u5834\u6240\u3092\u5b9a\u7fa9\u3057\u307e\u3059 <code>pki</code> \u79d8\u5bc6/\u516c\u958b\u9375\u30da\u30a2\u30d5\u30a1\u30a4\u30eb\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea <code>undolog</code> innodb_undo_directory  -  <code>./</code>  -  <code>undo_001, undo_002</code>innodb_max_undo_log_size  -  <code>1073741824(1GB)</code> innodb_undo_tablespaces=2 undo \u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u306e\u3057\u304d\u3044\u5024\u30b5\u30a4\u30ba\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002 undo \u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9\u304c\u3057\u304d\u3044\u5024\u3092\u8d85\u3048\u308b\u3068\u3001innodb_undo_log_truncate \u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u308b\u3068\u304d\u306b\u5207\u308a\u6368\u3066\u3089\u308c\u308b\u3088\u3046\u306b\u30de\u30fc\u30af\u3067\u304d\u307e\u3059\u3002 \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f 1073741824 \u30d0\u30a4\u30c8 (1024 MiB) \u3067\u3059\u3002"},{"location":"mysql8-basic/#redo_log","title":"redo_log","text":"<ul> <li>https://blog.s-style.co.jp/2022/08/9229/</li> <li>MySQL 8.0.30 \u304b\u3089\u306f\u3001\u30b7\u30f3\u30d7\u30eb\u306b\u4ee5\u4e0b\u306e\u30b7\u30b9\u30c6\u30e0\u5909\u6570\u3067\u30b5\u30a4\u30ba\u304c\u5236\u5fa1\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002</li> </ul> \u30b7\u30b9\u30c6\u30e0\u5909\u6570\u540d \u30c7\u30d5\u30a9\u30eb\u30c8\u5024 \u8aac\u660e innodb_redo_log_capacity 104857600(100MB) redo \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u5bb9\u91cf\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\u3053\u306e\u5024\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u3001\u4ee3\u308f\u308a\u306b\u300cinnodb_log_file_size * innodb_log_files_in_group\u300d\u304c\u3053\u306e\u5024\u3068\u3057\u3066\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002 <p>\u3053\u306e\u30b7\u30b9\u30c6\u30e0\u5909\u6570\u306e\u8ffd\u52a0\u306b\u3068\u3082\u306a\u3044\u3001\u3053\u308c\u307e\u3067\u306e innodb_log_file_size \u3068 innodb_log_files_in_group \u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u306f\u975e\u63a8\u5968\u3068\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p> <p>\u307e\u305f\u3001\u51fa\u529b\u5148\u306f innodb_log_group_home_dir \u304b\u3089\u5909\u5316\u3057\u3066\u3044\u307e\u305b\u3093\u304c\u3001\u65b0\u3057\u304f #innodb_redo \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u4f5c\u6210\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u3001redo \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306f\u3053\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u3067\u7ba1\u7406\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"mysql8-basic/#mysql","title":"MySQL\u306e\u30e6\u30fc\u30b6\u63a5\u7d9a\u306e\u4f7f\u7528\u30e1\u30e2\u30ea\u306e\u4e0a\u9650\u3092\u8a2d\u5b9a\u3059\u308b","text":"<ul> <li>https://blog.s-style.co.jp/2022/02/8620/</li> </ul>"},{"location":"mysql8-basic/#mysql-8013ibtmp1","title":"MySQL 8.0.13\u3068\u305d\u308c\u4ee5\u964d\u3067\u306fibtmp1\u306f\u80a5\u5927\u5316\u3057\u306a\u3044","text":"<ul> <li>https://yoku0825.blogspot.com/2020/06/mysql-8013ibtmp1-varlibmysqlinnodbtemp.html</li> </ul>"},{"location":"mysql8-basic/#_2","title":"\u4e88\u7d04\u6e08\u30a2\u30ab\u30a6\u30f3\u30c8","text":"<ul> <li>https://dev.mysql.com/doc/refman/8.0/ja/reserved-accounts.html</li> </ul> <p>MySQL \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30d7\u30ed\u30bb\u30b9\u306e\u4e00\u90e8\u3068\u3057\u3066\u3001\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u521d\u671f\u5316\u304c\u3042\u308a\u307e\u3059 (\u30bb\u30af\u30b7\u30e7\u30f32.10.1\u300c\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u521d\u671f\u5316\u300d \u3092\u53c2\u7167)\u3002 \u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u521d\u671f\u5316\u4e2d\u306b\u3001MySQL \u306f\u4e88\u7d04\u6e08\u3068\u307f\u306a\u3059\u5fc5\u8981\u304c\u3042\u308b\u30e6\u30fc\u30b6\u30fc\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059:</p> <ul> <li>'root'@'localhost: \u7ba1\u7406\u76ee\u7684\u3067\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002 \u3053\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u306f\u3059\u3079\u3066\u306e\u6a29\u9650\u304c\u3042\u308a\u3001\u30b7\u30b9\u30c6\u30e0\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u3042\u308a\u3001\u4efb\u610f\u306e\u64cd\u4f5c\u3092\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002   \u53b3\u5bc6\u306b\u8a00\u3046\u3068\u3001\u3053\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u540d\u306f\u4e88\u7d04\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u4e00\u90e8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u306f\u3001\u3088\u304f\u77e5\u3089\u308c\u305f\u540d\u524d\u3092\u6301\u3064\u7279\u6a29\u306e\u9ad8\u3044\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u516c\u958b\u3055\u308c\u306a\u3044\u3088\u3046\u306b\u3001root \u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u540d\u524d\u304c\u5225\u306e\u540d\u524d\u306b\u5909\u66f4\u3055\u308c\u307e\u3059\u3002</li> <li>'mysql.sys'@'localhost': sys \u30b9\u30ad\u30fc\u30de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e DEFINER \u3068\u3057\u3066\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002 mysql.sys \u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001DBA \u304c root \u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u540d\u524d\u3092\u5909\u66f4\u307e\u305f\u306f\u524a\u9664\u3057\u305f\u5834\u5408\u306b\u767a\u751f\u3059\u308b\u554f\u984c\u3092\u56de\u907f\u3067\u304d\u307e\u3059\u3002 \u3053\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u306f\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u63a5\u7d9a\u306b\u4f7f\u7528\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u30ed\u30c3\u30af\u3055\u308c\u3066\u3044\u307e\u3059\u3002</li> <li>'mysql.session'@'localhost': \u30b5\u30fc\u30d0\u30fc\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306b\u30d7\u30e9\u30b0\u30a4\u30f3\u306b\u3088\u3063\u3066\u5185\u90e8\u7684\u306b\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002 \u3053\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u306f\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u63a5\u7d9a\u306b\u4f7f\u7528\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u30ed\u30c3\u30af\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u30a2\u30ab\u30a6\u30f3\u30c8\u306f\u30b7\u30b9\u30c6\u30e0\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u3059\u3002</li> <li>'mysql.infoschema'@'localhost': INFORMATION_SCHEMA \u30d3\u30e5\u30fc\u306e DEFINER \u3068\u3057\u3066\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002 mysql.infoschema \u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001DBA \u304c root \u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u540d\u524d\u3092\u5909\u66f4\u307e\u305f\u306f\u524a\u9664\u3057\u305f\u5834\u5408\u306b\u767a\u751f\u3059\u308b\u554f\u984c\u3092\u56de\u907f\u3067\u304d\u307e\u3059\u3002 \u3053\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u306f\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u63a5\u7d9a\u306b\u4f7f\u7528\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u30ed\u30c3\u30af\u3055\u308c\u3066\u3044\u307e\u3059\u3002</li> <li>https://dev.mysql.com/doc/refman/8.0/ja/innodb-parameters.html#sysvar_innodb_log_files_in_group</li> </ul>"},{"location":"mysql_backup/","title":"MySQL\u5907\u4efd\u7c7b\u578b","text":"<ul> <li> <p>\u70ed\u5907\u4efd,\u6587\u5907\u4efd\u548c\u51b7\u5907\u4efd</p> <ul> <li>\u70ed\u5907\u4efd: \u8bfb,\u5199\u4e0d\u53d7\u5f71\u54cd</li> <li>\u6e29\u5907\u4efd:\u4ec5\u53ef\u4ee5\u6267\u884c\u5ea6\u8bfb\u64cd\u4f5c</li> <li>\u51b7\u5907\u4efd:\u79bb\u7ebf\u5907\u4efd,\u8bfb\u5199\u64cd\u4f5c\u7ec8\u6b62</li> </ul> </li> <li> <p>\u7269\u7406\u5907\u4efd\u548c\u903b\u8f91\u5907\u4efd</p> <ul> <li>\u7269\u7406\u5907\u4efd: \u590d\u5236\u6570\u636e\u6587\u4ef6</li> <li>\u903b\u8f91\u5907\u4efd: \u5c06\u6570\u636e\u5bfc\u51fa\u81f3\u6587\u672c\u6587\u4ef6\u4e2d.</li> </ul> </li> </ul>"},{"location":"mysql_backup/#mysql_1","title":"MySQL\u5907\u4efd\u5de5\u5177","text":"<ul> <li>mysqldump: \u903b\u8f91\u5907\u4efd\u5de5\u5177, MyISAM(\u6e29), InnoDB(\u70ed\u5907\u4efd)</li> <li>mysqlshotcopy: \u6587\u4ef6\u5907\u4efd\u5de5\u5177(\u9501\u8868),\u6e29\u5907\u4efd,\u5b9e\u9645\u662f\u51b7\u5907\u4efd</li> </ul>"},{"location":"mysql_backup/#_1","title":"\u6587\u4ef6\u7cfb\u7edf\u5de5\u5177","text":"<ul> <li>cp: \u51b7\u5907\u4efd</li> <li>LV: \u903b\u8f91\u5377\u7684\u5feb\u7167\u529f\u80fd,\u51e0\u4e4e\u70ed\u5907<ul> <li>mysql&gt; FLUSH TABLES;</li> <li>mysql&gt; LOCK TABLES;</li> <li>\u521b\u5efa\u5feb\u7167: \u91ca\u653e\u9501,\u800c\u540e\u590d\u5236\u6570\u636e</li> </ul> </li> </ul>"},{"location":"mysql_backup/#_2","title":"\u7b2c\u4e09\u7ec4\u5de5\u5177:","text":"<ul> <li>ibbackup:\u5546\u4e1a\u5de5\u5177</li> <li>xtrabackup: \u5f00\u6e90\u5de5\u5177</li> <li>https://www.processon.com/mindmap/61b2bbc863768956b5f5c7da</li> </ul>"},{"location":"mysql_backup/#_3","title":"\u4ed6\u793e\u306e\u30c4\u30fc\u30eb","text":"<ul> <li>https://main.qcloudimg.com/raw/document/intl/product/pdf/236_19886_jp.pdf</li> <li>https://intl.cloud.tencent.com/jp/document/product/236/31910</li> <li>https://intl.cloud.tencent.com/jp/document/product/236/31910</li> </ul>"},{"location":"mysql_backup/#xtrabackup","title":"\u4e0b\u8f7dXtraBackup","text":"<ul> <li>https://www.percona.com/doc/percona-xtrabackup/2.4/installation.html#installing-percona-xtrabackup-from-a-binary-tarball</li> </ul> <pre><code>$ wget https://downloads.percona.com/downloads/Percona-XtraBackup-2.4/Percona-XtraBackup-2.4.21/binary/tarball/percona-xtrabackup-2.4.21-Linux-x86_64.glibc2.12.tar.gz\n$ tar xvf percona-xtrabackup-2.4.21-Linux-x86_64.glibc2.12.tar.gz\n$ ln -sv /root/work/percona-xtrabackup-2.4.21-Linux-x86_64.glibc2.12 /usr/local/percona-xtrabackup\n\n# \u5b89\u88c5\u5fc5\u8981\u5de5\u5177\n# yum install -y https://repo.percona.com/yum/percona-release-latest.noarch.rpm\n# yum install qpress perl-Digest-MD5 \"perl(DBD::mysql)\" -y\n</code></pre>"},{"location":"mysql_backup/#ssh-xbstream","title":"\u8fdc\u7a0b\u5b8c\u5168\u5907\u4efd(ssh,\u538b\u7f29) xbstream","text":""},{"location":"mysql_backup/#_4","title":"\u65b9\u6cd5\u4e00(\u4e0d\u91c7\u7528)","text":"<ul> <li>\u76f4\u63a5\u4fdd\u5b58\u5728backup\u670d\u52a1\u5668\u4e0a</li> <li>\u65e0\u6cd5\u8bb0\u5f55to_lsn <pre><code># [root@test ]# ssh mysql5.7 \"/usr/bin/xtrabackup --backup --stream=xbstream --compress --compress-thread=8 --parallel=8 --target-dir=/home/backup/test/\" &gt; full-mysql5.7-20211125.xbstream\n- 1.4G Nov 25 15:07 full-mysql5.7-20211125.xbstream &lt;- \u6253\u5305\u538b\u7f29\u540e\u4e3a1.4G\n- \u62c6\u5305xbstream\n- # ./bin/xbstream -x &lt; full-mysql5.7-20211125 -C ./test/\n- # 1.4G   ./test     &lt;- \u62c6\u5305\u540e\u4e3a1.4G,\u5bb9\u91cf\u4e0d\u4f1a\u53d8\u5927,\u56e0\u4e3a\u4ec5\u4ec5\u662f\u62c6\u5305.\n- \u89e3\u538b\u62c6\u5305\u540e\u7684\u6587\u4ef6\u5939 (\u53ef\u4f7f\u7528 --remove-original \u6765\u5220\u9664\u538b\u7f29\u7684\u6e90\u6587\u4ef6)\n- # ./bin/xtrabackup --decompress --parallel=8 --target-dir=./test/\n</code></pre></li> </ul>"},{"location":"mysql_backup/#_5","title":"\u65b9\u6cd5\u4e8c(\u91c7\u7528)","text":"<ul> <li>\u5728\u88ab\u5907\u4efd\u670d\u52a1\u5668\u4e0a\u521b\u5efaDB,\u8bb0\u5f55\u5b8c\u5168\u5907\u4efd\u65f6\u7684to_lsn</li> <li>--history=NAME</li> <li>\u5728\u88ab\u5907\u4efd\u670d\u52a1\u5668\u4e0a\u65b0\u5efa\u6570\u636e\u5e93 (PERCONA_SCHEMA), \u540e\u5728\u8be5\u6570\u636e\u5e93\u5185\u5efa\u7acb\u8868(xtrabackup_history),\u8be5\u8868\u5185\u8bb0\u5f55\u4e86\u5b8c\u5168\u5907\u4efd\u65f6\u7684\u8be6\u7ec6\u4fe1\u606f.</li> <li>https://www.percona.com/doc/percona-xtrabackup/2.4/innobackupex/innobackupex_option_reference.html#cmdoption-innobackupex-no-lock</li> <li> <p>--no-lock \u5907\u4efd\u65f6\u4e0d\u9501\u8868</p> <ul> <li>\u7531\u4e8emysql318\u7b49\u5927\u578b\u670d\u52a1\u5668,\u5907\u4efd\u65f6\u7684\u9501\u8868\u65f6\u95f4\u8fc7\u957f\u4f1a\u5f71\u54cduser\u7684\u8fde\u63a5\u4f53\u9a8c[\u9501\u8868\u4e3a\u5927\u7ea66\u5206\u949f],\u6240\u4ee5\u4e3a\u4e86\u63d0\u9ad8\u6548\u7387\u53ca\u7528\u6237\u4f53\u9a8c,\u51b3\u5b9a\u4e0d\u9501\u8868</li> <li>MyISAM\u7531\u4e8e\u4e0d\u662fInnoDB,\u65e0\u8bba\u5982\u4f55\u90fd\u4f1a\u9501\u8868 <pre><code>\u4f7f\u7528\u6b64\u9009\u9879\u53ef\u901a\u8fc7 FLUSH TABLES WITH READ LOCK \u7981\u7528\u8868\u9501\u5b9a\u3002\u4ec5\u5f53\u60a8\u7684\u6240\u6709\u8868\u90fd\u662f InnoDB \u5e76\u4e14\u60a8\u4e0d\u5173\u5fc3\u5907\u4efd\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4f4d\u7f6e\u65f6\u624d\u4f7f\u7528\u5b83\u3002\u5982\u679c\u6709\u4efb\u4f55 DDL \u8bed\u53e5\u6b63\u5728\u6267\u884c\u6216\u5728\u975e InnoDB \u8868\uff08\u8fd9\u5305\u62ec mysql \u6570\u636e\u5e93\u4e2d\u7684\u7cfb\u7edf MyISAM \u8868\uff09\u4e0a\u53d1\u751f\u4efb\u4f55\u66f4\u65b0\uff0c\u5219\u4e0d\u5e94\u4f7f\u7528\u6b64\u9009\u9879\uff0c\u5426\u5219\u53ef\u80fd\u5bfc\u81f4\u4e0d\u4e00\u81f4\u7684\u5907\u4efd\u3002\u5728\u652f\u6301\uff08Percona Server 5.6+\uff09\u7684\u60c5\u51b5\u4e0b\uff0cxtrabackup \u5c06\u81ea\u52a8\u4f7f\u7528\u5907\u4efd\u9501\u4f5c\u4e3a FLUSH TABLES WITH READ LOCK \u7684\u8f7b\u91cf\u7ea7\u66ff\u4ee3\u65b9\u6848\u6765\u590d\u5236\u975e InnoDB \u6570\u636e\uff0c\u4ee5\u907f\u514d\u963b\u585e\u4fee\u6539 InnoDB \u8868\u7684 DML \u67e5\u8be2\u3002\u5982\u679c\u60a8\u6b63\u5728\u8003\u8651\u4f7f\u7528 innobackupex --no-lock \u56e0\u4e3a\u60a8\u7684\u5907\u4efd\u65e0\u6cd5\u83b7\u53d6\u9501\uff0c\u8fd9\u53ef\u80fd\u662f\u56e0\u4e3a\u4f20\u5165\u7684\u590d\u5236\u4e8b\u4ef6\u963b\u6b62\u4e86\u9501\u6210\u529f\u3002\u8bf7\u5c1d\u8bd5\u4f7f\u7528 innobackupex --safe-slave-backup \u6682\u65f6\u505c\u6b62\u590d\u5236\u526f\u672c\u7ebf\u7a0b\uff0c\u8fd9\u53ef\u80fd\u6709\u52a9\u4e8e\u5907\u4efd\u6210\u529f\uff0c\u7136\u540e\u60a8\u65e0\u9700\u6c42\u52a9\u4e8e\u4f7f\u7528\u6b64\u9009\u9879\u3002\u4f7f\u7528 \u2013no-lock \u9009\u9879\u65f6\u4e0d\u4f1a\u521b\u5efa xtrabackup_binlog_info\uff08\u56e0\u4e3a SHOW MASTER STATUS \u53ef\u80fd\u4e0d\u4e00\u81f4\uff09\uff0c\u4f46\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528 xtrabackup_binlog_pos_innodb \u6765\u83b7\u5f97\u4e00\u81f4\u7684 binlog \u5750\u6807\uff0c\u5982\u4f7f\u7528\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u6240\u8ff0\u3002\n</code></pre></li> <li> <p>--no-lock <pre><code>Use this option to disable table lock with FLUSH TABLES WITH READ LOCK. Use it only if ALL your tables are InnoDB and you DO NOT CARE about the binary log position of the backup. This option shouldn\u2019t be used if there are any DDL statements being executed or if any updates are happening on non-InnoDB tables (this includes the system MyISAM tables in the mysql database), otherwise it could lead to an inconsistent backup. Where supported (Percona Server 5.6+) xtrabackup will automatically use Backup Locks as a lightweight alternative to FLUSH TABLES WITH READ LOCK to copy non-InnoDB data to avoid blocking DML queries that modify InnoDB tables. If you are considering to use innobackupex --no-lock because your backups are failing to acquire the lock, this could be because of incoming replication events preventing the lock from succeeding. Please try using innobackupex --safe-slave-backup to momentarily stop the replication replica thread, this may help the backup to succeed and you then don\u2019t need to resort to using this option. xtrabackup_binlog_info is not created when \u2013no-lock option is used (because SHOW MASTER STATUS may be inconsistent), but under certain conditions xtrabackup_binlog_pos_innodb can be used instead to get consistent binlog coordinates as described in Working with Binary Logs.\n</code></pre></p> </li> <li> \u4f8b <pre><code># [root@test]# ssh mysql5.7 \"/usr/bin/xtrabackup --backup --no-lock --history=testhis --stream=xbstream --compress --compress-thread=8 --parallel=8 --target-dir=/home/backup/test/\"  &gt; full-mysql5.7-compress-`date +%F`.xbstream\n- --history=testhis\n  - --no-lock (\u7531\u4e8emysql5.7_test\u7b49\u5927\u578b\u670d\u52a1\u5668,\u5907\u4efd\u65f6\u7684\u9501\u8868\u65f6\u95f4\u8fc7\u957f\u4f1a\u5f71\u54cduser\u7684\u8fde\u63a5\u4f53\u9a8c[\u9501\u8868\u4e3a\u5927\u7ea66\u5206\u949f],\u6240\u4ee5\u4e3a\u4e86\u63d0\u9ad8\u6548\u7387\u53ca\u7528\u6237\u4f53\u9a8c,\u51b3\u5b9a\u4e0d\u9501\u8868)\n- MyISAM\u7531\u4e8e\u4e0d\u662fInnoDB,\u65e0\u8bba\u5982\u4f55\u90fd\u4f1a\u9501\u8868\n  - \u5728\u88ab\u5907\u4efd\u670d\u52a1\u5668\u4e0a\u65b0\u5efa\u6570\u636e\u5e93 (PERCONA_SCHEMA), \u540e\u5728\u8be5\u6570\u636e\u5e93\u5185\u5efa\u7acb\u8868(xtrabackup_history),\u8be5\u8868\u5185\u8bb0\u5f55\u4e86\u5b8c\u5168\u5907\u4efd\u65f6\u7684\u8be6\u7ec6\u4fe1\u606f.\n  =====================================================================\n01:40:32 root@localhost[PERCONA_SCHEMA]&gt; select * from xtrabackup_history\\G\n*************************** 1. row ***************************\n                uuid: d7dce218-50c1-11ec-96c6-9ca3ba306e71\n                name: testhis         &lt;-- \u6b64\u9879\u4e3a--history=\u7684\u540d\u5b57\n           tool_name: xtrabackup\n        tool_command: --backup --history=testhis --stream=xbstream --compress --compress-thread=8 --parallel=8 --target-dir=/home/backup/test/\n        tool_version: 2.4.18\n    ibbackup_version: 2.4.18\n      server_version: 5.7.28-log\n          start_time: 2021-11-29 12:09:24\n            end_time: 2021-11-29 12:10:02\n           lock_time: 0\nbinlog_pos: NULL\n     innodb_from_lsn: 0\ninnodb_to_lsn: 632730709693   &lt;------- \u6b64\u9879\u4e3a\u5b8c\u5168\u5907\u4efd\u65f6\u7684to_lsn\n             partial: N\n         incremental: N\n              format: xbstream\n             compact: N\n          compressed: Y\n           encrypted: N\n    1 row in set (0.00 sec)\n01:40:39 root@localhost[PERCONA_SCHEMA]&gt; show tables;\n=====================================================================\n</code></pre> </li> </ul> </li> </ul>"},{"location":"mysql_backup/#ssh-tar","title":"\u8fdc\u7a0b\u5b8c\u5168\u5907\u4efd(ssh,\u538b\u7f29) tar","text":"<pre><code># [root@test]# ssh mysql5.7 \"/usr/bin/xtrabackup --backup --stream=tar --parallel=8 --target-dir=/home/backup/test/\" | gzip - &gt; full-mysql5.7-20211126.tar.gz\n- 1.1G Nov 26 11:00 full-mysql5.7-20211126.tar.gz   &lt;- \u6253\u5305\u538b\u7f29\u540e\u4e3a1.1G\n  - \u89e3\u538b\u7f29\n  - # tar xf full-mysql5.7-20211126.tar.gz -C test-tar/\n</code></pre>"},{"location":"mysql_backup/#ssh-xbstream_1","title":"\u8fdc\u7a0b\u589e\u91cf\u5907\u4efd(ssh,\u538b\u7f29) xbstream","text":"<ul> <li>\u589e\u91cf\u5907\u4efd\u4ec5\u80fd\u5e94\u7528\u4e8eInnoDB\u6216XtraDB\u8868.</li> <li>\u5bf9\u4e8eMyISAM\u8868\u800c\u8a00,\u6267\u884c\u589e\u91cf\u5907\u4efd\u5176\u5b9e\u8fdb\u884c\u7684\u662f\u5b8c\u5168\u5907\u4efd</li> </ul>"},{"location":"mysql_backup/#_6","title":"\u65b9\u6cd5\u4e00(\u4e0d\u91c7\u7528)","text":"<ul> <li> \u4f8b <pre><code># [root@test inc1]# ssh mysql5.7 \"/usr/bin/xtrabackup --backup --stream=xbstream --compress --compress-thread=8 --parallel=8  --target-dir=/home/backup/test/ --incremental-lsn=626713424502\" &gt; inc1/inc1-mysql5.7-20211125.xbstream\n- \u53d6\u5f97to_lsn\u7684\u65b9\u6cd51\n  - \u901a\u8fc7\u4e0a\u9762\u7684\u62c6\u5305\u540e\u7684\u76ee\u5f55\u91cc\u7684xtrabackup_checkpoints\u6587\u4ef6\u53d6\u5f97to_lsn\u7684\u503c. to_lsn = 626713424502\n- \u5c06to_lsn\u7684\u503c\u5e26\u5165--incremental-lsn\u91cc,\u5c31\u662f\u5f97\u5230\u4ece\u4e0a\u6b21\u7684\u5b8c\u5168\u5907\u4efd\u5f00\u59cb\u8fdb\u884c\u589e\u91cf\u5907\u4efd\u7684\u8d77\u59cb\u70b9.\n  - \u6700\u7ec8\u5f97\u5230\u589e\u91cf\u5907\u4efd.\n- \u589e\u91cf\u5907\u4efd\u62c6\u5305\u89e3\u538b\n  - \u62c6\u5305\n    # ../bin/xbstream -x &lt; inc1-mysql5.7-20211125.xbstream  -C ./\n- \u89e3\u538b\n    # ../bin/xtrabackup --decompress --remove-original --target-dir=./\n- \u786e\u8ba4\n    # cat xtrabackup_checkpoints\nbackup_type = incremental  &lt;-- \u589e\u91cf\u5907\u4efd\n          from_lsn = 626713424502    &lt;-- \u5907\u4efd\u8d77\u59cb\u70b9\n          to_lsn = 627081604734      &lt;-- \u5907\u4efd\u7ed3\u675f\u70b9\n          last_lsn = 627081604743    &lt;-- DB\u7684\u6700\u540e\u8282\u70b9\n          compact = 0\nrecover_binlog_info = 0\nflushed_lsn = 627081604743\n- \u53d6\u5f97to_lsn\u7684\u65b9\u6cd52\n    - \u8fdc\u7a0b\u5b8c\u5168\u5907\u4efd(ssh,\u538b\u7f29) xbstream, \u8fdc\u7a0b\u5b8c\u5168\u5907\u4efd(ssh,\u538b\u7f29) tar, \u65f6,stdout\u7684log\u6700\u7ec8\u884c\u663e\u793a\u4e86to_lsn\u7684\u4fe1\u606f.\n    - [xtrabackup: Transaction log of lsn (632523322653) to (632524719449) was copied.] \u7684 to (632524719449) \u5c31\u662f\u6b64\u6b21\u5907\u4efd\u65f6\u7684\u6700\u7ec8lsn\u70b9\n    - \u6b64\u65b9\u6cd5\u9700\u8981\u4fdd\u5b58\u6807\u51c6\u8f93\u51fa,\u540e\u67e5\u8be2\u6700\u540e\u8f93\u51fa\u503c,\u5f88\u4e0d\u65b9\u4fbf.(\u4e0d\u91c7\u7528)\n211129 11:36:38 [01] Streaming ./mysql/event.MYD to &lt;STDOUT&gt;\n    211129 11:36:38 [01]        ...done\n    211129 11:36:38 Finished backing up non-InnoDB tables and files\n    211129 11:36:38 Executing FLUSH NO_WRITE_TO_BINLOG ENGINE LOGS...\n    xtrabackup: The latest check point (for incremental): '632524361908'\nxtrabackup: Stopping log copying thread.\n    .211129 11:36:38 &gt;&gt; log scanned up to (632524719449)\n211129 11:36:38 Executing UNLOCK TABLES\n    211129 11:36:38 All tables unlocked\n    211129 11:36:38 [00] Streaming ib_buffer_pool to &lt;STDOUT&gt;\n    211129 11:36:39 [00]        ...done\n    211129 11:36:39 Backup created in directory '/home/backup/test/'\n211129 11:36:39 [00] Streaming &lt;STDOUT&gt;\n    211129 11:36:39 [00]        ...done\n    211129 11:36:39 [00] Streaming &lt;STDOUT&gt;\n    211129 11:36:39 [00]        ...done\n    xtrabackup: Transaction log of lsn (632523322653) to (632524719449) was copied.     &lt;--- {to (632524719449)}\u7684\u6570\u636e\u5c31\u662fto_lsn\u70b9\n    211129 11:36:39 completed OK!\n    [root@test ]#\n</code></pre> </li> </ul>"},{"location":"mysql_backup/#_7","title":"\u65b9\u6cd5\u4e8c(\u91c7\u7528)","text":"<ul> <li>\u6b64\u65b9\u6cd5\u901a\u8fc7\u88ab\u5907\u4efd\u670d\u52a1\u5668\u4e0a\u7684DB\u6570\u636e\u5e93PERCONA_SCHEMA,\u8868xtrabackup_history \u6765\u83b7\u53d6\u4e0a\u6b21\u5b8c\u5168\u5907\u4efd\u65f6\u7684to_lsn\u70b9.</li> <li>\u4e0d\u9700\u8981\u989d\u5916\u914d\u7f6e\u9009\u9879,\u800c\u4e14DB\u4e0a\u6709\u4e0a\u6b21\u5907\u4efd\u7684\u8be6\u7ec6\u4fe1\u606f,\u53ef\u4f9b\u4e4b\u540e\u7684\u6545\u969c\u67e5\u8be2.\u975e\u5e38\u65b9\u4fbf.</li> <li>\u589e\u91cf\u5907\u4efd\u65f6\u53ea\u9700\u589e\u52a0\u9009\u9879<ul> <li>--incremental-history-name=NAME(testhis) \u6b64name\u4e3a\u5b8c\u5168\u5907\u4efd\u65f6\u8bbe\u5b9a\u7684NAME</li> <li>--history=NAME(testhis) \u6b64name\u4e3a\u5b8c\u5168\u5907\u4efd\u65f6\u8bbe\u5b9a\u7684NAME</li> </ul> </li> <li>\u589e\u91cf\u5907\u4efd\u65f6,\u53ea\u9700\u589e\u52a0\u8fd9\u4e24\u9879,XtraBackup\u4f1a\u81ea\u52a8\u8bc6\u522b\u6700\u65b0\u7684\u5907\u4efd\u70b9,\u4e4b\u540e\u8fdb\u884c\u589e\u91cf\u5907\u4efd <pre><code># [root@test ]# ssh mysql5.7 \"/usr/bin/xtrabackup --backup --no-lock --history=testhis --stream=xbstream --compress --compress-thread=8 --parallel=8  --target-dir=/home/backup/test/ --incremental-history-name=testhis\"  &gt; inc1/inc1-mysql5.7-`date +%F`.xbstream\n- \u589e\u91cf\u5907\u4efd\u65f6\u53ea\u9700\u589e\u52a0\u9009\u9879\n    - --incremental-history-name=NAME(testhis) \u6b64name\u4e3a\u5b8c\u5168\u5907\u4efd\u65f6\u8bbe\u5b9a\u7684NAME\n      - https://www.percona.com/doc/percona-xtrabackup/2.4/innobackupex/innobackupex_option_reference.html#cmdoption-innobackupex-incremental-history-name\n    - --history=NAME(testhis) \u6b64name\u4e3a\u5b8c\u5168\u5907\u4efd\u65f6\u8bbe\u5b9a\u7684NAME\n      - https://www.percona.com/doc/percona-xtrabackup/2.4/innobackupex/innobackupex_option_reference.html#cmdoption-innobackupex-history\n</code></pre></li> </ul>"},{"location":"mysql_backup/#ssh-xbstream_2","title":"\u8fdc\u7a0b\u5b8c\u5168\u5907\u4efd(ssh,\u672a\u538b\u7f29) xbstream","text":"<ul> <li>\u8fdc\u7a0b\u5b8c\u5168\u5907\u4efd(ssh,\u672a\u538b\u7f29) xbstream <pre><code># [root@test]# ssh mysql5.7 \"/usr/bin/xtrabackup --backup --stream=xbstream --parallel=8 --target-dir=/home/backup/test/\" &gt; full-mysql5.7.xbstream\n</code></pre></li> </ul>"},{"location":"mysql_backup/#prepare","title":"\"\u51c6\u5907\"(prepare)\u589e\u91cf\u5907\u4efd","text":"<ul> <li>\u9700\u8981\u5728\u6bcf\u4e2a\u5907\u4efd(\u5305\u542b\u5b8c\u5168\u5907\u4efd\u548c\u5404\u4e2a\u589e\u91cf\u5907\u4efd)\u4e0a,\u5c06\u5df2\u7ecf\u63d0\u4ea4\u7684\u4e8b\u52a1\u8fdb\u884c\"\u91cd\u653e\".\"\u91cd\u653e\"\u4e4b\u540e,\u6240\u6709\u7684\u5907\u4efd\u6570\u636e\u5c06\u5408\u5e76\u5230\u5b8c\u5168\u5907\u4efd\u4e0a.</li> <li>\u57fa\u4e8e\u6240\u6709\u7684\u5907\u4efd\u5c06\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1\u8fdb\u884c\"\u56de\u6eda\".</li> <li>Preparing an Incremental Backup with innobackupex</li> <li>BASE-DIR \u4e3a\u5b8c\u5168\u5907\u4efd\u6240\u5728\u7684\u76ee\u5f55.</li> <li>INCREMENTAL-DIR-1 \u4e3a\u7b2c\u4e00\u6b21\u589e\u91cf\u5907\u4efd\u7684\u76ee\u5f55</li> <li>INCREMENTAL-DIR-2 \u4e3a\u7b2c\u4e8c\u6b21\u589e\u91cf\u5907\u4efd\u7684\u76ee\u5f55</li> <li> \u4f8b <pre><code>\u5982\u4f55\u4e3a\u6253\u5305\u538b\u7f29\u6587\u4ef6,\u9700\u5148\u62c6\u5305,\u540e\u89e3\u538b.\n\n- \u62c6\u5305xbstream\n  - # ./bin/xbstream -x &lt; full-mysql5.7-20211125 -C ./test/\n- # 1.4G    ./test      &lt;- \u62c6\u5305\u540e\u4e3a1.4G,\u5bb9\u91cf\u4e0d\u4f1a\u53d8\u5927,\u56e0\u4e3a\u4ec5\u4ec5\u662f\u62c6\u5305.\n- \u89e3\u538b\u62c6\u5305\u540e\u7684\u6587\u4ef6\u5939 (\u53ef\u4f7f\u7528 --remove-original \u6765\u5220\u9664\u538b\u7f29\u7684\u6e90\u6587\u4ef6)\n- # ./bin/xtrabackup --decompress  --parallel=8 --target-dir=./test/\n- \u62c6\u5305\u5b8c\u5168\u5907\u4efd\n    # mkdir full-mysql5.7\n# ../bin/xbstream -x &lt; full-mysql5.7-compress-2021-11-30.xbstream  -C ./full-mysql5.7\n- \u89e3\u538b\u62c6\u5305\u540e\u7684\u5b8c\u5168\u5907\u4efd (\u53ef\u4f7f\u7528 --remove-original \u6765\u5220\u9664\u538b\u7f29\u7684\u6e90\u6587\u4ef6)\n# ../bin/xtrabackup --decompress --remove-original --target-dir=./full-mysql5.7\n- \u786e\u8ba4\n\n- \u62c6\u5305\u589e\u91cf\u5907\u4efd\n    # [root@test inc1]# mkdir inc1-mysql5.7-2021-11-30\n# [root@test inc1]# mkdir inc1-mysql5.7-2021-12-01\n# [root@test inc1]# xbstream -x &lt; inc1-mysql5.7-2021-11-30.xbstream -C ./inc1-mysql5.7-2021-11-30\n# [root@test inc1]# xbstream -x &lt; inc1-mysql5.7-2021-12-01.xbstream -C ./inc1-mysql5.7-2021-12-01\n# [root@test inc1]# xbstream -x &lt; inc1-mysql5.7-2021-12-02.xbstream -C ./inc1-mysql5.7-2021-12-02\n- \u89e3\u538b\u62c6\u5305\u540e\u7684\u589e\u91cf\u5907\u4efd\n    # [root@test inc1]# xtrabackup --decompress --remove-original --target-dir=./inc1-mysql5.7-2021-11-30\n# [root@test inc1]# xtrabackup --decompress --remove-original --target-dir=./inc1-mysql5.7-2021-12-01\n# [root@test inc1]# xtrabackup --decompress --remove-original --target-dir=./inc1-mysql5.7-2021-12-02\n1, \u51c6\u5907\u5b8c\u5168\u5907\u4efd\n# innobackupex --apply-log --redo-only BASE-DIR\n2, \u6267\u884c\u7b2c\u4e00\u6b21\u7684\u589e\u91cf\u5907\u4efd\n# innobackupex --apply-log --redo-only BASE-DIR --incremental-dir=INCREMENTAL-DIR-1\n3, \u6267\u884c\u7b2c\u4e8c\u6b21\u7684\u589e\u91cf\u5907\u4efd\n# innobackupex --apply-log --redo-only BASE-DIR --incremental-dir=INCREMENTAL-DIR-2\n\u4f9d\u6b21\u7c7b\u63a8.\n</code></pre> </li> </ul>"},{"location":"mysql_backup/#_8","title":"\u4f8b","text":"<ul> <li> \u4f8b <pre><code># \u7b2c\u4e00\u6b21\u5b8c\u5168\u5907\u4efd\n- --rsync\n  - https://www.percona.com/doc/percona-xtrabackup/8.0/xtrabackup_bin/backup.accelerating.html\n\n# ssh mysql5.7 \"/usr/bin/xtrabackup --backup --no-lock --history=full_bk --stream=xbstream --compress --compress-thread=8 --parallel=8 --target-dir=/home/backup/\"  &gt; full-mysql5.7-compress-`date +%F`.xbstream\n# \u7b2c\u4e00\u6b21\u589e\u91cf\u5907\u4efd\n# ssh mysql5.7 \"/usr/bin/xtrabackup --backup --no-lock --history=inc_bk --stream=xbstream --compress --compress-thread=8 --parallel=8 --target-dir=/home/backup/ --incremental-history-name=full_bk\"  &gt; inc1/inc1-mysql5.7-`date +%F-%H-%M`.xbstream\n# MySQL\u7684\u6570\u636e\u5e93PERCONA_SCHEMA\u4e0a\u7684\u5907\u4efd\u5c65\u5386\n04:10:02 root@localhost[PERCONA_SCHEMA]&gt; select name,innodb_from_lsn,innodb_to_lsn,start_time from xtrabackup_history where start_time like '2021-12%' ;\n+----------+-----------------+---------------+---------------------+\n| name     | innodb_from_lsn | innodb_to_lsn | start_time          |\n+----------+-----------------+---------------+---------------------+\n| inc_bk   |    639056296812 |  639056301332 | 2021-12-03 16:09:45 |  &lt;-- \u589e\u91cf\u5907\u4efd(from_lsn\u4e3a\u5b8c\u5168\u5907\u4efd\u7684to_lsn\u503c)\n| testhis  |    635749601741 |  637257897756 | 2021-12-02 14:45:36 |\n| testhis  |    634038213077 |  635749601741 | 2021-12-01 14:32:58 |\n| mysql_bk |    639056292808 |  639056295402 | 2021-12-03 16:03:47 |\n| mysql_bk |               0 |  639056292808 | 2021-12-03 15:57:34 |\n| full_bk  |               0 |  639056296812 | 2021-12-03 16:07:30 |  &lt;-- \u5b8c\u5168\u5907\u4efd(from_lsn\u4e3a0)\n+----------+-----------------+---------------+---------------------+\n6 rows in set, 1 warning (0.00 sec)\n04:10:23 root@localhost[PERCONA_SCHEMA]&gt;\n\n10:23:24 root@localhost[PERCONA_SCHEMA]&gt; select name,innodb_from_lsn,innodb_to_lsn,start_time from xtrabackup_history  order by start_time;\n+---------+-----------------+---------------+---------------------+\n| name    | innodb_from_lsn | innodb_to_lsn | start_time          |\n+---------+-----------------+---------------+---------------------+\n| full_bk |               0 |   64701439242 | 2021-12-13 15:32:32 |\n| inc_bk  |     64701439242 |   64701499648 | 2021-12-14 08:30:07 |\n| inc_bk  |     64701439242 |   64701562443 | 2021-12-15 08:30:02 |\n| inc_bk  |     64701439242 |   64701624918 | 2021-12-16 08:30:09 |\n| inc_bk  |     64701439242 |   64701687401 | 2021-12-17 08:30:02 |\n| inc_bk  |     64701439242 |   64701757198 | 2021-12-18 08:30:04 |\n| inc_bk  |     64701439242 |   64701846068 | 2021-12-19 08:30:02 |\n| inc_bk  |     64701439242 |   64701908176 | 2021-12-20 08:30:05 |\n| full_bk |               0 |   64701970385 | 2021-12-21 08:30:01 |\n| inc_bk  |     64701970385 |   64702034882 | 2021-12-22 08:30:02 |\n+---------+-----------------+---------------+---------------------+\n10 rows in set (0.00 sec)\n10:23:25 root@localhost[PERCONA_SCHEMA]&gt;\n\n@@ \u62c6\u5305\u5b8c\u5168\u5907\u4efd\n# mkdir full-mysql5.7\n[root@test mysql5.7]# xbstream -x &lt; full-mysql5.7-compress-2021-12-03.xbstream  -C ./full-mysql5.7\n@@ \u89e3\u538b\u62c6\u5305\u540e\u7684\u5b8c\u5168\u5907\u4efd (\u53ef\u4f7f\u7528 --remove-original \u6765\u5220\u9664\u538b\u7f29\u7684\u6e90\u6587\u4ef6)\n[root@test mysql5.7]# xtrabackup --decompress --remove-original --target-dir=./full-mysql5.7\n@@ \u62c6\u5305\u589e\u91cf\u5907\u4efd\n[root@test inc1]# mkdir inc1-mysql5.7-2021-12-03\n[root@test inc1]# xbstream -x &lt; inc1-mysql5.7-2021-12-03-16-09.xbstream -C ./inc1-mysql5.7-2021-12-03\n@@ \u89e3\u538b\u62c6\u5305\u540e\u7684\u589e\u91cf\u5907\u4efd\n[root@ inc1]# xtrabackup --decompress --remove-original --target-dir=./inc1-mysql5.7-2021-12-03\n@@ \u51c6\u5907\u5b8c\u5168\u5907\u4efd\u76ee\u5f55\n  - \u5b8c\u5168\u5907\u4efd\u76ee\u5f55:full-mysql5.7\n\n[root@test mysql5.7]# xtrabackup --prepare --apply-log-only --target-dir=./full-mysql5.7\ntrabackup: starting shutdown with innodb_fast_shutdown = 1\nInnoDB: Starting shutdown...\nInnoDB: Shutdown completed; log sequence number 639056296830\nInnoDB: Number of pools: 1\n211203 16:35:55 completed OK!\n\n@@ \u6267\u884c\u7b2c\u4e00\u6b21\u7684\u589e\u91cf\u5907\u4efd(\u8fd9\u91cc\u65e2\u662f\u7b2c\u4e00\u6b21\u589e\u91cf\u5907\u4efd,\u4e5f\u662f\u6700\u540e\u4e00\u6b21\u589e\u91cf\u5907\u4efd)\n- \u65e0apply-log-only\n  - \u5b8c\u5168\u5907\u4efd\u76ee\u5f55:full-mysql5.7\n  - \u589e\u91cf\u5907\u4efd\u76ee\u5f55:inc1-mysql5.7-2021-12-03\n\n[root@test mysql5.7]# xtrabackup --prepare --target-dir=full-mysql5.7 --incremental-dir=inc1/inc1-mysql5.7-2021-12-03\nInnoDB: 5.7.32 started; log sequence number 639056306197\nxtrabackup: starting shutdown with innodb_fast_shutdown = 1\nInnoDB: FTS optimize thread exiting.\nInnoDB: Starting shutdown...\nInnoDB: Shutdown completed; log sequence number 639056309393\n211203 16:38:15 completed OK!\n[root@rs-os1a-backup1 mysql318]#\n# \u4ece\u5907\u4efd\u6587\u4ef6\u6062\u590d\n- \u9996\u5148\u628a\u51c6\u5907\u597d\u7684\u5b8c\u5168\u5907\u4efd\u76ee\u5f55(\u5df2\u6267\u884c\u8fc7\u589e\u91cf\u51c6\u5907)\u4f20\u5230\u5bf9\u5e94\u7684\u4e3b\u673a(\u9700\u8981\u6062\u590d\u7684\u4e3b\u673a)\n- stop mysqld\n  - \u6e05\u7a7a\u6570\u636e\u5e93\u6240\u5728\u76ee\u5f55. \u6216\u4f7f\u7528 --force-non-empty-directories \u9009\u9879.\n\n# \u5f00\u59cb\u6062\u590d\u6570\u636e\n- \u53ea\u9700\u6307\u5b9a\u5907\u4efd\u76ee\u5f55,\u4e0d\u9700\u8981\u6307\u5b9amysql datadir \u76ee\u5f55, extrabackup\u4f1a\u6839\u636e\u5907\u4efd\u6587\u4ef6\u4e2d\u7684\u8bbe\u7f6e\u6587\u4ef6\u81ea\u884c\u5bfb\u627e.\n$ xtrabackup --copy-back /path/to/BACKUP-DIR\n\n# \u6062\u590d\u5b8c\u6210\u540e\u8981\u6062\u590d\u6570\u636e\u5e93\u7684\u6743\u9650\n$ chown -R mysql:mysql /home/mysql\n\n# \u542f\u52a8mysqld\n$ systemctl start mysqld\n</code></pre> </li> </ul>"},{"location":"mysqld_exporter_flags/","title":"mysqld_exporter","text":""},{"location":"mysqld_exporter_flags/#url","title":"\u53c2\u8003URL","text":"<ul> <li>https://github.com/prometheus/mysqld_exporter</li> <li>https://github.com/prometheus/mysqld_exporter?tab=readme-ov-file#collector-flags</li> </ul>"},{"location":"mysqld_exporter_flags/#collector-flags","title":"Collector Flags","text":"<ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u78ba\u8a8d\u3001\u5404SQL\u304c\u78ba\u8a8d\u3067\u304d\u308b\uff08\u81ea\u5206\u306eMySQL\u306b\u5408\u3046\u304b\u3069\u3046\u304b\uff09</li> <li>https://github.com/prometheus/mysqld_exporter/blob/main/collector/info_schema_auto_increment.go</li> <li>\u53ce\u96c6\u5143\u30c6\u30fc\u30d6\u30eb</li> <li>https://blog.s-style.co.jp/2023/04/9829/</li> </ul> Name MySQL Version \u4f7f\u7528 Description collect.auto_increment.columns 5.1 X Collect auto_increment columns and max values from information_schema.information_schema.columns\u3068information_schema.tables\u3092select\u306e\u305f\u3081\u3001\u91cd\u3044 collect.binlog_size 5.1 X Collect the current size of all registered binlog files<code>SELECT @@log_bin</code>\u3068<code>SHOW BINARY LOGS</code>\u306eSQL\u3092\u5229\u7528\u306e\u305f\u3081\u3001\u5272\u3068\u8efd\u3044\u3002binlog\u306a\u3057\u306e\u305f\u3081\u3001\u4e0d\u8981 collect.engine_innodb_status 5.1 O Collect from SHOW ENGINE INNODB STATUS.<code>SHOW ENGINE INNODB STATUS</code> collect.engine_tokudb_status 5.6 X Collect from SHOW ENGINE TOKUDB STATUS.<code>SHOW ENGINE TOKUDB STATUS</code> collect.global_status 5.1 O Collect from SHOW GLOBAL STATUS (Enabled by default)<code>SHOW GLOBAL STATUS</code> collect.global_variables 5.1 O Collect from SHOW GLOBAL VARIABLES (Enabled by default)<code>SHOW GLOBAL VARIABLES</code> collect.heartbeat 5.1 X Collect from heartbeat. collect.heartbeat.database 5.1 X Database from where to collect heartbeat data. (default: heartbeat) collect.heartbeat.table 5.1 X Table from where to collect heartbeat data. (default: heartbeat) collect.heartbeat.utc 5.1 X Use UTC for timestamps of the current server (<code>pt-heartbeat</code> is called with <code>--utc</code>). (default: false) collect.info_schema.clientstats 5.5 X If running with userstat=1, set to true to collect client statistics.prenona\u5c02\u7528\u30d1\u30e9\u30e1\u30fc\u30bf collect.info_schema.innodb_metrics 5.6 X Collect metrics from information_schema.innodb_metrics.<code>FROM information_schema.columns</code> Select\u3060\u3051\u3067\u3068\u3066\u3082\u91cd\u3044 collect.info_schema.innodb_tablespaces 5.7 X Collect metrics from information_schema.innodb_sys_tablespaces.\u5168\u30c6\u30fc\u30d6\u30eb\u30b5\u30a4\u30ba\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u3001\u3068\u3066\u3082\u91cd\u3044\u3001\u9014\u4e2d\u3067\u5931\u6557\u3059\u308b\u3002 collect.info_schema.innodb_cmp 5.5 O Collect InnoDB compressed tables metrics from information_schema.innodb_cmp. collect.info_schema.innodb_cmpmem 5.5 O Collect InnoDB buffer pool compression metrics from information_schema.innodb_cmpmem. collect.info_schema.processlist 5.1 O Collect thread state counts from information_schema.processlist.<code>FROM information_schema.processlist</code> collect.info_schema.processlist.min_time 5.1 O Minimum time a thread must be in each state to be counted. (default: 0) collect.info_schema.query_response_time 5.5 X Collect query response time distribution if query_response_time_stats is ON.prenona\u5c02\u7528 collect.info_schema.replica_host 5.6 X Collect metrics from information_schema.replica_host_status. collect.info_schema.tables 5.1 X Collect metrics from information_schema.tables.<code>FROM information_schema.tables</code> \u5168\u30c6\u30fc\u30d6\u30eb\u30b5\u30a4\u30ba\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u3001\u3068\u3066\u3082\u91cd\u3044\u3001\u9014\u4e2d\u3067\u5931\u6557\u3059\u308b\u3002 collect.info_schema.tables.databases 5.1 X The list of databases to collect table stats for, or '<code>*</code>' for all.\u5168\u30c6\u30fc\u30d6\u30eb\u30b5\u30a4\u30ba\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u3001\u3068\u3066\u3082\u91cd\u3044\u3001\u9014\u4e2d\u3067\u5931\u6557\u3059\u308b\u3002 collect.info_schema.tablestats 5.1 X If running with userstat=1, set to true to collect table statistics.<code>information_schema.table_statistics</code> \u306fprenona\u5c02\u7528 collect.info_schema.schemastats 5.1 X If running with userstat=1, set to true to collect schema statistics<code>information_schema.table_statistics</code> \u306fprenona\u5c02\u7528 collect.info_schema.userstats 5.1 X If running with userstat=1, set to true to collect user statistics.<code>information_schema.table_statistics</code> \u306fprenona\u5c02\u7528 collect.mysql.user 5.5 O Collect data from mysql.user table collect.perf_schema.eventsstatements 5.6 O Collect metrics from performance_schema.events_statements_summary_by_digest. collect.perf_schema.eventsstatements.digest_text_limit 5.6 O (10) Maximum length of the normalized statement text. (default: 120) collect.perf_schema.eventsstatements.limit 5.6 O Limit the number of events statements digests by response time. (default: 250) collect.perf_schema.eventsstatements.timelimit 5.6 O Limit how old the 'last_seen' events statements can be, in seconds. (default: 86400) collect.perf_schema.eventsstatementssum 5.7 O Collect metrics from performance_schema.events_statements_summary_by_digest summed. collect.perf_schema.eventswaits 5.5 O Collect metrics from performance_schema.events_waits_summary_global_by_event_name.<code>FROM performance_schema.events_waits_summary_global_by_event_name</code> collect.perf_schema.file_events 5.6 O Collect metrics from performance_schema.file_summary_by_event_name.<code>FROM performance_schema.file_summary_by_event_name;</code> collect.perf_schema.file_instances 5.5 \u25b3 Collect metrics from performance_schema.file_summary_by_instance.<code>FROM performance_schema.file_summary_by_instance</code> collect.perf_schema.file_instances.remove_prefix 5.5 \u25b3 Remove path prefix in performance_schema.file_summary_by_instance.Default(\"/var/lib/mysql/\") collect.perf_schema.indexiowaits 5.6 X Collect metrics from performance_schema.table_io_waits_summary_by_index_usage.\u5168\u30c6\u30fc\u30d6\u30eb\u60c5\u5831\u53d6\u5f97\u3059\u308b\u305f\u3081\u3068\u3066\u3082\u91cd\u3044\u3002 collect.perf_schema.memory_events 5.7 O Collect metrics from performance_schema.memory_summary_global_by_event_name. collect.perf_schema.memory_events.remove_prefix 5.7 O Remove instrument prefix in performance_schema.memory_summary_global_by_event_name. collect.perf_schema.tableiowaits 5.6 X Collect metrics from performance_schema.table_io_waits_summary_by_table.<code>FROM performance_schema.table_io_waits_summary_by_table</code> collect.perf_schema.tablelocks 5.6 X Collect metrics from performance_schema.table_lock_waits_summary_by_table.<code>FROM performance_schema.table_lock_waits_summary_by_table</code> collect.perf_schema.replication_group_members 5.7 X Collect metrics from performance_schema.replication_group_members. collect.perf_schema.replication_group_member_stats 5.7 X Collect metrics from performance_schema.replication_group_member_stats. collect.perf_schema.replication_applier_status_by_worker 5.7 X Collect metrics from performance_schema.replication_applier_status_by_worker. collect.slave_status 5.1 X Collect from SHOW SLAVE STATUS (Enabled by default) collect.slave_hosts 5.1 X Collect from SHOW SLAVE HOSTS collect.sys.user_summary 5.7 X Collect metrics from sys.x$user_summary (disabled by default).\u91cd\u3044\u3001user\u306e\u6570\u304c\u591a\u3044\u305f\u3081\u3001\u30b5\u30fc\u30d0\u306b\u91cd\u3044\u3002"},{"location":"mysql%E3%82%92%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%8B%E3%82%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/","title":"mysql\u3092\u30bd\u30fc\u30b9\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb","text":""},{"location":"mysql%E3%82%92%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%8B%E3%82%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/#linux","title":"Linux\u7cfb\u306e\u30d3\u30eb\u30c9\u30aa\u30d7\u30b7\u30e7\u30f3","text":""},{"location":"mysql%E3%82%92%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%8B%E3%82%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/#mysql56","title":"MySQL5.6","text":"<pre><code>$ cat build-mysql5.6.sh\nexport CC=\"cc\"\nexport CXX=\"c++\"\nexport CFLAGS=\"-O2 -fPIC -fno-omit-frame-pointer\"\nexport CXXFLAGS=\"${CFLAGS} -Wno-narrowing -felide-constructors -fno-rtti -fexceptions\"\n\n#export CXXFLAGS=\"${CFLAGS} -Wno-c++11-narrowing -felide-constructors -fno-rtti -fno-exceptions\"\n\ncmake \\\n-DCMAKE_INSTALL_PREFIX=\"/home/USER/myetc/mysql/5.6\" \\\n-DINSTALL_DOCDIR=\"share/doc/mysql\" \\\n-DINSTALL_DOCREADMEDIR=\"share/doc/mysql\" \\\n-DINSTALL_INCLUDEDIR=\"include/mysql\" \\\n-DINSTALL_INFODIR=\"info\" \\\n-DINSTALL_LIBDIR=\"lib/mysql\" \\\n-DINSTALL_MANDIR=\"man\" \\\n-DINSTALL_MYSQLSHAREDIR=\"share/mysql\" \\\n-DINSTALL_MYSQLTESTDIR=\"share/mysql/tests\" \\\n-DINSTALL_PLUGINDIR=\"lib/mysql/plugin\" \\\n-DINSTALL_SBINDIR=\"libexec\" \\\n-DINSTALL_SCRIPTDIR=\"bin\" \\\n-DINSTALL_SHAREDIR=\"share\" \\\n-DINSTALL_SQLBENCHDIR=\"share/mysql\" \\\n-DINSTALL_SUPPORTFILESDIR=\"share/mysql\" \\\n-DWITH_UNIT_TESTS=0 \\\n-DWITH_SSL=system \\\n-DWITH_READLINE=1 \\\n-DWITH_LIBWRAP=0 \\\n-DWITHOUT_SERVER=1 \\\n-DWITH_EMBEDDED_SERVER=\"ON\"\n</code></pre> <p><code>make</code> <code>make install</code></p>"},{"location":"mysql%E3%82%92%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%8B%E3%82%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/#mysql55","title":"MySQL5.5","text":"<pre><code>$ cat build-mysql5.5.sh\nexport CC=\"cc\"\nexport CXX=\"c++\"\nexport CFLAGS=\"-O2 -fPIC -fno-omit-frame-pointer\"\nexport CXXFLAGS=\"${CFLAGS} -Wno-narrowing -felide-constructors -fno-rtti -fexceptions -fpermissive \"\n\n#export CXXFLAGS=\"${CFLAGS} -Wno-c++11-narrowing -felide-constructors -fno-rtti -fno-exceptions\"\n\ncmake \\\n-DCMAKE_INSTALL_PREFIX=\"/home/USER/myetc/mysql/5.5\" \\\n-DINSTALL_DOCDIR=\"share/doc/mysql\" \\\n-DINSTALL_DOCREADMEDIR=\"share/doc/mysql\" \\\n-DINSTALL_INCLUDEDIR=\"include/mysql\" \\\n-DINSTALL_INFODIR=\"info\" \\\n-DINSTALL_LIBDIR=\"lib/mysql\" \\\n-DINSTALL_MANDIR=\"man\" \\\n-DINSTALL_MYSQLSHAREDIR=\"share/mysql\" \\\n-DINSTALL_MYSQLTESTDIR=\"share/mysql/tests\" \\\n-DINSTALL_PLUGINDIR=\"lib/mysql/plugin\" \\\n-DINSTALL_SBINDIR=\"libexec\" \\\n-DINSTALL_SCRIPTDIR=\"bin\" \\\n-DINSTALL_SHAREDIR=\"share\" \\\n-DINSTALL_SQLBENCHDIR=\"share/mysql\" \\\n-DINSTALL_SUPPORTFILESDIR=\"share/mysql\" \\\n-DWITH_UNIT_TESTS=0 \\\n-DWITH_SSL=system \\\n-DWITH_READLINE=1 \\\n-DWITH_LIBWRAP=0 \\\n-DWITHOUT_SERVER=0 \\\n-DWITH_EMBEDDED_SERVER=\"ON\"\n</code></pre> <p><code>make</code> <code>make install</code></p>"},{"location":"mysql%E3%82%92%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%8B%E3%82%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/#freebsd","title":"FreeBSD\u7cfb\u306e\u30d3\u30eb\u30c9\u30aa\u30d7\u30b7\u30e7\u30f3","text":""},{"location":"mysql%E3%82%92%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%8B%E3%82%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/#mysql56_1","title":"MySQL5.6","text":"<pre><code>export CC=\"cc\"\nexport CXX=\"c++\"\nexport CFLAGS=\"-O2 -fPIC -fno-omit-frame-pointer\"\n#export CXXFLAGS=\"${CFLAGS} -Wno-c++11-narrowing -felide-constructors -fno-rtti -fno-exceptions\"\nexport CXXFLAGS=\"${CFLAGS} -Wno-narrowing -felide-constructors -fno-rtti -fexceptions\"\n\ncmake \\\n-DCMAKE_INSTALL_PREFIX=\"/home/USER/myetc/mysql/5.6\" \\\n-DINSTALL_DOCDIR=\"share/doc/mysql\" \\\n-DINSTALL_DOCREADMEDIR=\"share/doc/mysql\" \\\n-DINSTALL_INCLUDEDIR=\"include/mysql\" \\\n-DINSTALL_INFODIR=\"info\" \\\n-DINSTALL_LIBDIR=\"lib/mysql\" \\\n-DINSTALL_MANDIR=\"man\" \\\n-DINSTALL_MYSQLSHAREDIR=\"share/mysql\" \\\n-DINSTALL_MYSQLTESTDIR=\"share/mysql/tests\" \\\n-DINSTALL_PLUGINDIR=\"lib/mysql/plugin\" \\\n-DINSTALL_SBINDIR=\"libexec\" \\\n-DINSTALL_SCRIPTDIR=\"bin\" \\\n-DINSTALL_SHAREDIR=\"share\" \\\n-DINSTALL_SQLBENCHDIR=\"share/mysql\" \\\n-DINSTALL_SUPPORTFILESDIR=\"share/mysql\" \\\n-DWITH_UNIT_TESTS=0 \\\n-DWITH_SSL=system \\\n-DWITH_READLINE=1 \\\n-DWITH_LIBWRAP=0 \\\n-DWITHOUT_SERVER=1 \\\n-DWITH_EMBEDDED_SERVER=\"ON\"\n</code></pre> <p><code>make</code> <code>make install</code></p>"},{"location":"mysql%E3%82%92%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%8B%E3%82%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/#mysql55_1","title":"MySQL5.5","text":"<pre><code>$ cat mysql-5.5.61/build-mysql5.5.sh\nexport CC=\"cc\"\nexport CXX=\"c++\"\nexport CFLAGS=\"-O2 -fPIC -fno-omit-frame-pointer\"\nexport CXXFLAGS=\"${CFLAGS} -Wno-c++11-narrowing -felide-constructors -fno-rtti -fno-exceptions -fpermissive\"\n#export CXXFLAGS=\"${CFLAGS} -Wno-c++11-narrowing -felide-constructors -fno-rtti -fno-exceptions\"\n#export CXXFLAGS=\"${CFLAGS} -Wno-narrowing -felide-constructors -fno-rtti -fexceptions -fpermissive\"\n\ncmake \\\n-DCMAKE_INSTALL_PREFIX=\"/home/USER/myetc/mysql/5.5\" \\\n-DINSTALL_DOCDIR=\"share/doc/mysql\" \\\n-DINSTALL_DOCREADMEDIR=\"share/doc/mysql\" \\\n-DINSTALL_INCLUDEDIR=\"include/mysql\" \\\n-DINSTALL_INFODIR=\"info\" \\\n-DINSTALL_LIBDIR=\"lib/mysql\" \\\n-DINSTALL_MANDIR=\"man\" \\\n-DINSTALL_MYSQLSHAREDIR=\"share/mysql\" \\\n-DINSTALL_MYSQLTESTDIR=\"share/mysql/tests\" \\\n-DINSTALL_PLUGINDIR=\"lib/mysql/plugin\" \\\n-DINSTALL_SBINDIR=\"libexec\" \\\n-DINSTALL_SCRIPTDIR=\"bin\" \\\n-DINSTALL_SHAREDIR=\"share\" \\\n-DINSTALL_SQLBENCHDIR=\"share/mysql\" \\\n-DINSTALL_SUPPORTFILESDIR=\"share/mysql\" \\\n-DWITH_UNIT_TESTS=0 \\\n-DWITH_SSL=system \\\n-DWITH_READLINE=1 \\\n-DWITH_LIBWRAP=0 \\\n-DWITHOUT_SERVER=0 \\\n-DWITHOUT_PARTITION_STORAGE_ENGINE=1 \\\n-DWITH_EMBEDDED_SERVER=\"ON\"\n</code></pre> <p><code>make</code> <code>make install</code></p>"},{"location":"osinfo-query/","title":"HV\u306eosinfo-query\u66f4\u65b0","text":"<ul> <li>https://releases.pagure.org/libosinfo/ \u304b\u3089\u6700\u65b0\u306eXML database files\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b</li> <li>https://libosinfo.org/download/ \u306e\u624b\u9806\u66f8\u304b\u3089\u4e0b\u8a18\u306e\u624b\u9806\u3067upgrade\u3059\u308b</li> </ul> <pre><code>$ apt install osinfo-db-tools\n$ osinfo-db-import --system osinfo-db-$VERSION.tar.xz\n</code></pre>"},{"location":"osinfo-query/#_1","title":"\u4e8b\u4f8b","text":"<pre><code>wget https://releases.pagure.org/libosinfo/osinfo-db-20221018.tar.xz\nosinfo-query os &gt; osinfo.list\nosinfo-db-import --system osinfo-db-20221018.tar.xz\nosinfo-query os &gt; osinfo.list.new\n\ndiff -u osinfo.list osinfo.list.new\n</code></pre>"},{"location":"osinfo-query/#osinfo-db-20230518tarxz","title":"osinfo-db-20230518.tar.xz\u66f4\u65b0\u4f8b","text":"\u66f4\u65b0\u4f8b <pre><code>root@localhost:~/work# pwd\n/root/work\nroot@localhost:~/work# wget https://releases.pagure.org/libosinfo/osinfo-db-20230518.tar.xz\nroot@localhost:~/work# osinfo-query os &gt; osinfo.list\nroot@localhost:~/work# osinfo-db-import --system osinfo-db-20230518.tar.xz\nroot@localhost:~/work# osinfo-query os &gt; osinfo.list.new\nroot@localhost:~/work#\n</code></pre>"},{"location":"osinfo-query/#upgrade","title":"upgrade\u5f8c\u4e0b\u8a18\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u305f\u5834\u5408\u306e\u5bfe\u7b56","text":"\u30a8\u30e9\u30fc <pre><code>** (osinfo-query:2504547): WARNING **: 14:36:52.317: Entity http://fedoraproject.org/fedora/rawhide must be in file os/fedoraproject.org/fedora-rawhide.xml not tests/data/positive/os/fedoraproject.org/fedora-rawhide.xml\n** (osinfo-query:2504547): WARNING **: 14:36:52.351: Entity http://fedoraproject.org/fedora/rawhide must be in file os/fedoraproject.org/fedora-rawhide.xml not tests/data/negative/os/fedoraproject.org/fedora-rawhide.xml\n** (osinfo-query:2504547): WARNING **: 14:36:52.455: Entity http://fedoraproject.org/silverblue/kickstart/desktop must be in file install-script/fedoraproject.org/silverblue-kickstart-desktop.xml not tests/data/positive/install-script/fedoraproject.org/silverblue-kickstart-desktop.xml\n** (osinfo-query:2504547): WARNING **: 14:36:52.343: Entity http://ibm.com/ps2/keyboard must be in file device/ibm.com/ps2-keyboard.xml not tests/data/positive/device/ibm.com/ps2-keyboard.xml\n** (osinfo-query:2504547): WARNING **: 14:36:52.439: Entity http://linux-kvm.org/qemu-kvm/1.2.0 must be in file platform/linux-kvm.org/qemu-kvm-1.2.0.xml not tests/data/positive/platform/linux-kvm.org/qemu-kvm-1.2.0.xml\n** (osinfo-query:2504547): WARNING **: 14:36:52.482: Entity http://x.org/x11-keyboard must be in file datamap/x.org/x11-keyboard.xml not tests/data/positive/datamap/x.org/x11-keyboard.xml\n</code></pre> \u5bfe\u7b56 <pre><code># backup\u3092\u4f5c\u6210\nroot@localhost:~/work/osinfo_back# mkdir -p tests/data/positive/install-script/fedoraproject.org\n\n# \u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\u3092\u79fb\u52d5\u3059\u308b\nroot@localhost:~/work/osinfo_back# mv /etc/osinfo/tests/data/positive/install-script/fedoraproject.org/silverblue-kickstart-desktop.xml  tests/data/positive/install-script/fedoraproject.org/\n</code></pre>"},{"location":"pfctl/","title":"pfctl","text":"<ul> <li>https://blog.masa23.jp/posts/2022/07/07/pfctl/</li> </ul>"},{"location":"pfctl/#pfctl","title":"pfctl\u306e\u30b3\u30de\u30f3\u30c9\u3092\u6bce\u56de\u5fd8\u308c\u308b\u306e\u3067\u30e1\u30e2","text":"<p>\u3044\u3064\u3082pfctl\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5fd8\u308c\u308b\u306e\u3067\u4e00\u90e8\u3092\u30e1\u30e2\u3002</p>"},{"location":"pfctl/#_1","title":"\u30eb\u30fc\u30eb\u95a2\u9023","text":"<ul> <li>\u73fe\u5728\u306e\u30eb\u30fc\u30eb\u3092\u78ba\u8a8d\u3059\u308b</li> </ul> Tip <pre><code># pfctl -s rules\n</code></pre> <ul> <li>\u7d71\u8a08\u5024\u3092\u898b\u308b\u5834\u5408\u306f-v\u3092\u4ed8\u3051\u308b</li> </ul> Tip <pre><code># pfctl -vs rules\n</code></pre>"},{"location":"pfctl/#_2","title":"\u30c6\u30fc\u30d6\u30eb\u64cd\u4f5c","text":"<ul> <li>\u30c6\u30fc\u30d6\u30eb\u30ea\u30b9\u30c8</li> </ul> Tip <pre><code># pfctl -s Tables\n</code></pre> <ul> <li>\u7d71\u8a08\u5024\u3092\u898b\u308b\u5834\u5408\u306f-vv\u3092\u4ed8\u3051\u308b</li> </ul> Tip <pre><code># pfctl -vvs Tables\n</code></pre> <ul> <li>\u30c6\u30fc\u30d6\u30eb\u306eIP\u30a2\u30c9\u30ec\u30b9\u30ea\u30b9\u30c8\u3092\u8868\u793a</li> </ul> Tip <pre><code># pfctl -t &lt;table&gt; -T show\n</code></pre> <ul> <li>\u30c6\u30fc\u30d6\u30eb\u306bIP\u30a2\u30c9\u30ec\u30b9\u3092\u8ffd\u52a0</li> </ul> Tip <pre><code># pfctl -t &lt;table&gt; -T add &lt;IPAddress&gt;\n</code></pre> <ul> <li>\u30c6\u30fc\u30d6\u30eb\u304b\u3089IP\u30a2\u30c9\u30ec\u30b9\u3092\u524a\u9664</li> </ul> Tip <pre><code># pfctl -t &lt;table&gt; -T delete &lt;IPAddress&gt;\n</code></pre> <ul> <li>\u30c6\u30fc\u30d6\u30eb\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u3059\u3079\u3066\u6d88\u3059</li> </ul> Tip <pre><code># pfctl -t &lt;table&gt; -T flush\n</code></pre>"},{"location":"prometheus/","title":"Prometheus\u69cb\u7bc9\u624b\u9806\u66f8","text":""},{"location":"prometheus/#url","title":"\u53c2\u8003URL","text":"<ul> <li>\u76d1\u63a7\u7cfb\u5217\u8bb2\u5ea7\uff08\u5341\u516b\uff09Thanos\u7684\u6982\u5ff5\u4e0e\u7ec4\u4ef6</li> <li>\u76d1\u63a7\u7cfb\u5217\u8bb2\u5ea7\uff08\u4e09\uff09Prometheus\u6982\u89c8</li> <li>\u76d1\u63a7\u7cfb\u5217\u8bb2\u5ea7\uff08\u5341\u516d\uff09Prometheus\u81ea\u52a8\u53d1\u73b0</li> <li>Prometheus+Grafana\u7ed3\u5408VictoriaMetrics Cluster\u5b9e\u73b0\u76d1\u63a7\u6307\u6807\u6570\u636e\u8fdc\u7a0b\u8bfb\u5199</li> <li>\u3053\u308c\u304b\u3089\u306f\u3058\u3081\u308bThanos</li> <li>Exporter \u8be6\u89e3</li> <li>\u76d1\u63a7MySQL\u8fd0\u884c\u72b6\u6001\uff1aMySQLD Exporter</li> <li>Prometheus + Thanos\u3092\u4f7f\u7528\u3057\u305fHA Kubernetes\u76e3\u8996</li> </ul> <p>Thanos\u306f\u3001Prometheus\u306e\u30c7\u30fc\u30bf\u3092\u9577\u671f\u9593\u4fdd\u7ba1\u3057\u3001\u5927\u898f\u6a21\u306a\u76e3\u8996\u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u3059\u3002Thanos\u306f\u8907\u6570\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304b\u3089\u6210\u308a\u7acb\u3063\u3066\u304a\u308a\u3001\u305d\u308c\u305e\u308c\u304c\u7279\u5b9a\u306e\u5f79\u5272\u3092\u62c5\u3063\u3066\u3044\u307e\u3059\u3002\u4ee5\u4e0b\u306b\u3001\u4e3b\u8981\u306a\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u7528\u9014\u3092\u8aac\u660e\u3057\u307e\u3059\u3002</p>"},{"location":"prometheus/#1-thanos-sidecar","title":"1. Thanos Sidecar","text":"<ul> <li>\u7528\u9014: Thanos Sidecar\u306f\u3001\u5b9f\u884c\u4e2d\u306ePrometheus\u30b5\u30fc\u30d0\u30fc\u306b\u96a3\u63a5\u3057\u3066\u52d5\u4f5c\u3057\u307e\u3059\u3002\u305d\u306e\u4e3b\u306a\u5f79\u5272\u306f\u3001Prometheus\u304c\u53ce\u96c6\u3057\u305f\u30c7\u30fc\u30bf\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u8aad\u307f\u53d6\u308a\u3001Thanos\u30b7\u30b9\u30c6\u30e0\u306e\u4ed6\u306e\u90e8\u5206\u304c\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u3055\u3089\u306b\u3001Sidecar\u306fPrometheus\u306eTSDB\u30d6\u30ed\u30c3\u30af\u3092\u30ea\u30e2\u30fc\u30c8\u30b9\u30c8\u30ec\u30fc\u30b8\uff08\u4f8b\uff1aS3\u3001GCS\u306a\u3069\uff09\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30c7\u30fc\u30bf\u306e\u9577\u671f\u4fdd\u7ba1\u3068\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u304c\u5411\u4e0a\u3057\u307e\u3059\u3002</li> </ul>"},{"location":"prometheus/#2-thanos-query","title":"2. Thanos Query","text":"<ul> <li>\u7528\u9014: Thanos Query\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306f\u3001\u8907\u6570\u306eThanos Sidecar\u3084Thanos Store\u304b\u3089\u30c7\u30fc\u30bf\u3092\u96c6\u7d04\u3057\u3066\u30af\u30a8\u30ea\u3059\u308b\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3068\u3057\u3066\u6a5f\u80fd\u3057\u307e\u3059\u3002\u30e6\u30fc\u30b6\u30fc\u306fThanos Query\u3092\u901a\u3058\u3066\u3001\u5206\u6563\u3055\u308c\u305f\u76e3\u8996\u30c7\u30fc\u30bf\u306b\u5bfe\u3057\u3066\u7d71\u4e00\u7684\u306a\u30af\u30a8\u30ea\u3092\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30b7\u30b9\u30c6\u30e0\u5168\u4f53\u306e\u53ef\u8996\u6027\u304c\u5411\u4e0a\u3057\u3001\u30c7\u30fc\u30bf\u306e\u5206\u6790\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002</li> </ul>"},{"location":"prometheus/#3-thanos-store","title":"3. Thanos Store","text":"<ul> <li>\u7528\u9014: Thanos Store\u306f\u3001\u30ea\u30e2\u30fc\u30c8\u30b9\u30c8\u30ec\u30fc\u30b8\uff08S3\u3001GCS\u306a\u3069\uff09\u306b\u4fdd\u5b58\u3055\u308c\u305f\u6b74\u53f2\u30c7\u30fc\u30bf\u306b\u5bfe\u3059\u308b\u9577\u671f\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3068\u3057\u3066\u6a5f\u80fd\u3057\u307e\u3059\u3002Store\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306f\u3001\u3053\u308c\u3089\u306e\u9577\u671f\u30c7\u30fc\u30bf\u3092Thanos Query\u306b\u63d0\u4f9b\u3057\u3001\u30af\u30a8\u30ea\u306e\u5b9f\u884c\u3092\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002Thanos Store\u306f\u3001\u5927\u91cf\u306e\u76e3\u8996\u30c7\u30fc\u30bf\u3092\u6271\u3046\u969b\u306b\u3001\u52b9\u7387\u7684\u306a\u30c7\u30fc\u30bf\u30a2\u30af\u30bb\u30b9\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</li> </ul>"},{"location":"prometheus/#4-thanos-compact","title":"4. Thanos Compact","text":"<ul> <li>\u7528\u9014: Thanos Compact\u306f\u3001\u30ea\u30e2\u30fc\u30c8\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u4fdd\u5b58\u3055\u308c\u305f\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u3092\u3088\u308a\u52b9\u7387\u7684\u306b\u7ba1\u7406\u3059\u308b\u305f\u3081\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3067\u3059\u3002\u3053\u308c\u306f\u3001\u8907\u6570\u306e\u5c0f\u3055\u3044\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u3092\u5927\u304d\u306a\u30d6\u30ed\u30c3\u30af\u306b\u7d71\u5408\uff08\u30b3\u30f3\u30d1\u30af\u30b7\u30e7\u30f3\uff09\u3057\u3001\u30af\u30a8\u30ea\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u5411\u4e0a\u3055\u305b\u308b\u3068\u540c\u6642\u306b\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u4f7f\u7528\u91cf\u3092\u6700\u9069\u5316\u3057\u307e\u3059\u3002\u307e\u305f\u3001Thanos Compact\u306f\u30c7\u30fc\u30bf\u306e\u30c0\u30a6\u30f3\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3082\u884c\u3044\u3001\u7570\u306a\u308b\u89e3\u50cf\u5ea6\u3067\u306e\u30c7\u30fc\u30bf\u30d3\u30e5\u30fc\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002</li> </ul> <p>\u3053\u308c\u3089\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306f\u5408\u308f\u3055\u3063\u3066\u3001Thanos\u304c\u63d0\u4f9b\u3059\u308b\u5f37\u529b\u306a\u30c7\u30fc\u30bf\u4fdd\u7ba1\u3068\u30af\u30a8\u30ea\u306e\u6a5f\u80fd\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002\u30e2\u30b8\u30e5\u30fc\u30eb\u5f0f\u306e\u8a2d\u8a08\u306b\u3088\u308a\u3001Thanos\u306f\u67d4\u8edf\u306b\u62e1\u5f35\u53ef\u80fd\u3067\u3042\u308a\u3001\u5c0f\u898f\u6a21\u306a\u74b0\u5883\u304b\u3089\u5927\u898f\u6a21\u306a\u30af\u30e9\u30b9\u30bf\u307e\u3067\u3001\u3055\u307e\u3056\u307e\u306a\u76e3\u8996\u30b7\u30b9\u30c6\u30e0\u306e\u30cb\u30fc\u30ba\u306b\u5bfe\u5fdc\u3067\u304d\u307e\u3059\u3002</p> <p>Thanos Sidecar\u304cS3\uff08\u307e\u305f\u306fS3\u4e92\u63db\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30b9\u30c8\u30ec\u30fc\u30b8\uff09\u306b\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u30bf\u30a4\u30df\u30f3\u30b0\u306f\u3001\u4e3b\u306bPrometheus\u306e\u30d6\u30ed\u30c3\u30af\u306e\u751f\u6210\u3068\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306e\u5468\u671f\u306b\u4f9d\u5b58\u3057\u307e\u3059\u3002Prometheus\u306f\u901a\u5e38\u30012\u6642\u9593\u3054\u3068\u306b\u30c7\u30fc\u30bf\u306e\u30d6\u30ed\u30c3\u30af\u3092\u751f\u6210\u3057\u3001\u3053\u308c\u3089\u306e\u30d6\u30ed\u30c3\u30af\u306fThanos Sidecar\u306b\u3088\u3063\u3066\u81ea\u52d5\u7684\u306bS3\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u307e\u3059\u3002\u4ee5\u4e0b\u306f\u3001\u305d\u306e\u30d7\u30ed\u30bb\u30b9\u306e\u6982\u8981\u3067\u3059\uff1a</p> <ol> <li>\u30d6\u30ed\u30c3\u30af\u306e\u751f\u6210: Prometheus\u306f\u76e3\u8996\u30c7\u30fc\u30bf\u3092\u6642\u9593\u5358\u4f4d\u3067\u533a\u5207\u308a\u30012\u6642\u9593\u3054\u3068\u306b\u30c7\u30fc\u30bf\u30d6\u30ed\u30c3\u30af\u3068\u3057\u3066\u30c7\u30a3\u30b9\u30af\u306b\u66f8\u304d\u8fbc\u307f\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u30d6\u30ed\u30c3\u30af\u306b\u306f\u3001\u53ce\u96c6\u3055\u308c\u305f\u30e1\u30c8\u30ea\u30af\u30b9\u30c7\u30fc\u30bf\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3059\u3002</li> <li>\u30d6\u30ed\u30c3\u30af\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9: Thanos Sidecar\u306f\u3001Prometheus\u304c\u65b0\u3057\u3044\u30d6\u30ed\u30c3\u30af\u3092\u751f\u6210\u3059\u308b\u3068\u3001\u305d\u308c\u3092\u691c\u51fa\u3057\u3001S3\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u3053\u306e\u30d7\u30ed\u30bb\u30b9\u306f\u3001\u30d6\u30ed\u30c3\u30af\u304c\u4f5c\u6210\u3055\u308c\u308b\u305f\u3073\u306b\u81ea\u52d5\u7684\u306b\u884c\u308f\u308c\u307e\u3059\u3002</li> <li>\u30b3\u30f3\u30d1\u30af\u30b7\u30e7\u30f3: Prometheus\u306b\u306f\u3001\u6642\u9593\u304c\u7d4c\u3064\u306b\u3064\u308c\u3066\u5c0f\u3055\u306a\u30d6\u30ed\u30c3\u30af\u3092\u3088\u308a\u5927\u304d\u306a\u30d6\u30ed\u30c3\u30af\u306b\u7d71\u5408\u3059\u308b\u30b3\u30f3\u30d1\u30af\u30b7\u30e7\u30f3\u30d7\u30ed\u30bb\u30b9\u304c\u3042\u308a\u307e\u3059\u3002Thanos\u3067\u306f\u3001Thanos Compactor\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304cS3\u306b\u4fdd\u5b58\u3055\u308c\u305f\u30d6\u30ed\u30c3\u30af\u306e\u30b3\u30f3\u30d1\u30af\u30b7\u30e7\u30f3\u3092\u62c5\u3044\u307e\u3059\u3002\u3053\u306e\u30d7\u30ed\u30bb\u30b9\u306b\u3088\u308a\u3001\u9577\u671f\u9593\u306e\u30af\u30a8\u30ea\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u5411\u4e0a\u3057\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u4f7f\u7528\u52b9\u7387\u304c\u6539\u5584\u3057\u307e\u3059\u3002</li> <li>\u5373\u6642\u6027\uff1aThanos Sidecar\u306f\u3001Prometheus\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u53ce\u96c6\u3057\u3001Thanos\u30af\u30a8\u30ea\u30ec\u30a4\u30e4\u30fc\u3092\u901a\u3058\u3066\u30af\u30a8\u30ea\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002\u3057\u304b\u3057\u3001S3\uff08\u307e\u305f\u306f\u4ed6\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30b9\u30c8\u30ec\u30fc\u30b8\uff09\u306b\u6c38\u7d9a\u7684\u306b\u30c7\u30fc\u30bf\u304c\u4fdd\u5b58\u3055\u308c\u308b\u306e\u306f\u3001\u30d6\u30ed\u30c3\u30af\u304c\u751f\u6210\u3055\u308c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u305f\u5f8c\u3067\u3059\u3002</li> </ol> <p>Thanos Sidecar\u3092\u4f7f\u3046\u5229\u70b9\u306e\u4e00\u3064\u306f\u3001\u3053\u306e\u81ea\u52d5\u7684\u306a\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30d7\u30ed\u30bb\u30b9\u306b\u3088\u3063\u3066\u3001\u76e3\u8996\u30c7\u30fc\u30bf\u306e\u9577\u671f\u4fdd\u7ba1\u3068\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u304c\u5411\u4e0a\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u305f\u3060\u3057\u3001\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u30c7\u30fc\u30bf\u3068S3\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u308b\u30c7\u30fc\u30bf\u9593\u306e\u308f\u305a\u304b\u306a\u9045\u5ef6\u306f\u3001\u3053\u306e\u30d7\u30ed\u30bb\u30b9\u306e\u6027\u8cea\u4e0a\u767a\u751f\u3057\u307e\u3059\u3002</p> <p>\u307e\u305f\u3001Thanos Sidecar\u306e\u8a2d\u5b9a\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u901a\u3058\u3066\u3001\u3053\u306e\u6319\u52d5\u306b\u5f71\u97ff\u3092\u4e0e\u3048\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\u4f8b\u3048\u3070\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u9593\u9694\u3092\u8abf\u6574\u3059\u308b\u3053\u3068\u3067\u3001\u3069\u306e\u304f\u3089\u3044\u306e\u983b\u5ea6\u3067\u30c7\u30fc\u30bf\u304cS3\u306b\u9001\u4fe1\u3055\u308c\u308b\u304b\u3092\u5236\u5fa1\u3067\u304d\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u57fa\u672c\u7684\u306a\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u306f\u3001Prometheus\u306e\u30d6\u30ed\u30c3\u30af\u751f\u6210\u5468\u671f\u306b\u5f93\u3044\u307e\u3059\u3002</p>"},{"location":"prometheus/#_1","title":"\u30b7\u30b9\u30c6\u30e0\u30a4\u30e1\u30fc\u30b8\u56f3","text":"<pre><code>   HOST1       [prometheus:9090    ]\n[exporter]-----[thanos-sidecar:19190(http),19090(grpc)]-----[nginx]-----[grafana]\n :9100    \\    [thanos-query:29190(http),29090(grpc),19090(sidecar_grpc) ]\n           \\   [thanos-store:19190(http),19191(grpc) ]\n            \\  [thanos-query:19190(http) ]\n             \\   /\n              \\ /\n               \\\n              / \\\n             /   \\\n   HOST2    /  [prometheus:9090    ]\n[exporter]-----[thanos-sidecar:19190(http),19090(grpc)]-----[nginx]-----[grafana]\n :9100         [thanos-query:29190(http),29090(grpc),19090(sidecar_grpc) ]\n               [thanos-store:19190(http),19191(grpc) ]\n               [thanos-query:19190(http) ]\n</code></pre>"},{"location":"prometheus/#_2","title":"\u69cb\u7bc9\u5c65\u6b74","text":"<pre><code>[root@prom-mysql bin]# vi iptables.sh \n[root@prom-mysql bin]# cat iptables.sh\n#!/bin/sh\n\nset -e\n\niptables -F\niptables -X\niptables -P INPUT ACCEPT\niptables -P OUTPUT ACCEPT\niptables -A INPUT -i lo -j ACCEPT\niptables -I INPUT -p icmp --icmp-type 0 -j ACCEPT\niptables -I INPUT -p icmp --icmp-type 8 -j ACCEPT\niptables -A INPUT -m state --state ESTABLISH,RELATED -j ACCEPT\n\niptables -A INPUT -s 172.16.0.0/12 -j ACCEPT\niptables -A INPUT -s 192.168.0.0/16 -j ACCEPT\n\niptables -A INPUT -j DROP\n\n/sbin/iptables-save &gt; /etc/sysconfig/iptables\n\n[root@prom-mysql bin]# sh /root/bin/iptables.sh\n\n[root@prom-mysql ~]# mv /etc/NetworkManager/system-connections/ens3.nmconnection /etc/NetworkManager/system-connections/eth0.nmconnection\n[root@prom-mysql ~]# vi /etc/default/grub\n[root@prom-mysql ~]# grub2-mkconfig -o /boot/grub2/grub.cfg\n[root@prom-mysql ~]# nmcli c delete \"System eth0\"\n[root@prom-mysql ~]# systemctl restart NetworkManager\n[root@prom-mysql ~]# vi /etc/udev/rules.d/99-net.rules\n[root@prom-mysql ~]# nmcli connection modify eth0 ipv4.method manual ipv4.addresses 192.168.xx.yy/24 ipv4.gateway 192.168.xx.1\n[root@prom-mysql ~]# yum install iotop\n[root@prom-mysql ~]# for i in `rpm -aq | grep iw`; do echo $i; yum remove -y $i; done\n[root@prom-mysql ~]# yum remove javapackages-filesystem-6.0.0-4.el9.noarch tzdata-java-2024a-1.el9.noarch java-1.8.0-openjdk-headless-1.8.0.402.b06-2.el9.x86_64\n[root@prom-mysql ~]# mkdir bin\n[root@prom-mysql ~]# vi /root/bin/iptables.sh\n[root@prom-mysql ~]# chmod 755 /root/bin/iptables.sh\n[root@prom-mysql ~]# mkdir docker\n[root@prom-mysql ~]# cd docker\n[root@prom-mysql docker]# curl https://download.docker.com/linux/centos/docker-ce.repo -o /etc/yum.repos.d/docker-ce.repo\n[root@prom-mysql docker]# sed -i -e \"s/enabled=1/enabled=0/g\" /etc/yum.repos.d/docker-ce.repo\n[root@prom-mysql docker]# yum --enablerepo=docker-ce-stable -y install docker-ce\n\n[root@prom-mysql docker]# systemctl enable --now docker\nCreated symlink /etc/systemd/system/multi-user.target.wants/docker.service \u2192 /usr/lib/systemd/system/docker.service.\n[root@prom-mysql docker]# rpm -q docker-ce\ndocker-ce-26.0.0-1.el9.x86_64\n[root@prom-mysql docker]# docker version\nClient: Docker Engine - Community\n Version:           26.0.0\n API version:       1.45\n Go version:        go1.21.8\n Git commit:        2ae903e\n Built:             Wed Mar 20 15:20:36 2024\n OS/Arch:           linux/amd64\n Context:           default\n\nServer: Docker Engine - Community\n Engine:\n  Version:          26.0.0\n  API version:      1.45 (minimum version 1.24)\n  Go version:       go1.21.8\n  Git commit:       8b79278\n  Built:            Wed Mar 20 15:18:58 2024\n  OS/Arch:          linux/amd64\n  Experimental:     false\n containerd:\n  Version:          1.6.28\n  GitCommit:        ae07eda36dd25f8a1b98dfbf587313b99c0190bb\n runc:\n  Version:          1.1.12\n  GitCommit:        v1.1.12-0-g51d5e94\n docker-init:\n  Version:          0.19.0\n  GitCommit:        de40ad0\n[root@prom-mysql docker]#\n\n# docker-compose\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n[root@prom-mysql docker]# ll /usr/libexec/docker/cli-plugins/docker-compose\n-rwxr-xr-x 1 root root 61585384 Mar 20 00:09 /usr/libexec/docker/cli-plugins/docker-compose\n[root@prom-mysql docker]# ln -s /usr/libexec/docker/cli-plugins/docker-compose /usr/bin/docker-compose\n[root@prom-mysql docker]# ll /usr/bin/docker\n-rwxr-xr-x 1 root root 30099688 Mar 21 00:21 /usr/bin/docker\n[root@prom-mysql docker]# ll /usr/bin/docker-compose\nlrwxrwxrwx 1 root root 46 Mar 27 15:31 /usr/bin/docker-compose -&gt; /usr/libexec/docker/cli-plugins/docker-compose\n[root@prom-mysql docker]# docker-compose --version\nDocker Compose version v2.25.0\n[root@prom-mysql docker]#\n\n# grafana\u30e6\u30fc\u30b6\u4f5c\u6210\n[root@prom-mysql docker]# useradd -s /sbin/nologin -u 472 -g 0 grafana\nuseradd warning: grafana's uid 472 outside of the UID_MIN 1000 and UID_MAX 60000 range.\n[root@prom-mysql docker]# grep grafana /etc/passwd\ngrafana:x:472:0::/home/grafana:/sbin/nologin\n[root@prom-mysql docker]#\n\n# mysql-client\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[root@prom-mysql docker]# wget http://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm\n[root@prom-mysql docker]# rpm --import https://repo.mysql.com/RPM-GPG-KEY-mysql-2022\n[root@prom-mysql docker]# rpm --import https://repo.mysql.com/RPM-GPG-KEY-mysql-2023\n[root@prom-mysql docker]# yum install mysql57-community-release-el7-11.noarch.rpm\n[root@prom-mysql docker]# yum install mysql-community-client\n\n# aws\u30b3\u30de\u30f3\u30c9\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[root@prom-mysql docker]# curl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"awscliv2.zip\"\n[root@prom-mysql docker]# unzip awscliv2.zip\n[root@prom-mysql docker]# ./aws/install\n[root@prom-mysql docker]# aws\n[root@prom-mysql docker]# aws configure \uff1c\u30fc\u30fc obj\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u8a2d\u5b9a\n[root@prom-mysql docker]# aws s3 --endpoint-url https://bucket.&lt;\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3054\u3068\u56fa\u6709\u306e\u5024&gt;.s3.ap-northeast-1.vpce.amazonaws.com ls s3://&lt;\u30d0\u30b1\u30c3\u30c8\u540d&gt;\n\n# prometheus\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n[root@prom-mysql docker]# mkdir /home/prometheus/\n\n# docker compose\u3000\u306e\u8a2d\u5b9a\n[root@prom-mysql docker]# docker network prune\n[root@prom-mysql docker]# docker network create docker_default\n[root@prom-mysql docker]# docker network ls\n\n[root@prom-mysql docker]# cat docker-compose.yaml\n\nservices:\n  prometheus:\n    image: prom/prometheus\n    container_name: prometheus\n    user: root\n    volumes:\n      - /home/prometheus:/etc/prometheus  # prometheus \u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5834\u6240\n      - /home/prometheus/data:/prometheus # prometheus \u306e\u30c7\u30fc\u30bf\u4fdd\u5b58\u5834\u6240\n    command:\n      - \"--config.file=/etc/prometheus/prometheus.yaml\"\n      - \"--web.enable-admin-api\"          # HTTP API \u8a31\u53ef\n      - \"--web.enable-lifecycle\"          # localhost:9090/-/reload \u5bfe\u5fdc\u306a\u3069\n      - \"--storage.tsdb.path=/prometheus\"\n      - \"--storage.tsdb.retention.time=15d\" # 30d\n      - \"--storage.tsdb.min-block-duration=2h\"\n      - \"--storage.tsdb.max-block-duration=2h\"\n\n    ports:\n      - 9090:9090\n    restart: always\n    networks:\n      - default\n\n# thanos-sidecar\n  thanos-sidecar:\n    container_name: thanos-sidecar\n    image: thanosio/thanos:main-2024-03-26-6c613fc\n    user: root\n    volumes:\n      - /home/prometheus:/prometheus\n    command:\n      - 'sidecar'\n      - '--tsdb.path=/prometheus/data'\n      - '--objstore.config-file=/prometheus/bucket_config.yaml'\n      - '--prometheus.url=http://prometheus:9090'\n      - '--http-address=0.0.0.0:19190'\n      - '--grpc-address=0.0.0.0:19090'\n      - '--log.level=debug'\n      - '--log.format=logfmt'\n    restart: always\n    depends_on:\n      - prometheus\n\n# thanos-query\n  thanos-query:\n    container_name: thanos-query\n    image: thanosio/thanos:main-2024-03-26-6c613fc\n    user: root\n    command:\n      - 'query'\n      - '--http-address=0.0.0.0:29190'    # web\u7528\n      - '--grpc-address=0.0.0.0:29090'    # query\u540c\u58eb\u7528\n      - '--endpoint=thanos-sidecar:19090' # sidecar\u306egrpc\u3001\u8907\u6570\u8ffd\u52a0\u3067\u304d\u308b \"&lt;sidecar-api&gt;:&lt;grpc-port&gt;\"\n      - '--endpoint=thanos-store:19191'   # store\u306egrpc\u3001\u8907\u6570\u8ffd\u52a0\u3067\u304d\u308b \"&lt;store-api&gt;:&lt;grpc-port&gt;\"\n      - '--query.replica-label=replica'\n    ports:\n      - 29190:29190\n    restart: always\n    depends_on:\n      - thanos-sidecar\n      - thanos-store\n\n# thanos-store\n  thanos-store:\n    container_name: thanos-store\n    image: thanosio/thanos:main-2024-03-26-6c613fc\n    user: root\n    volumes:\n      - /home/prometheus:/prometheus\n    command:\n      - 'store'\n      - '--objstore.config-file=/prometheus/bucket_config.yaml'\n      - '--http-address=0.0.0.0:19190'\n      - '--grpc-address=0.0.0.0:19191'\n      - '--data-dir=/prometheus/thanos/store'\n    restart: always\n    depends_on:\n      - thanos-sidecar\n\n# thanos-compact\n  thanos-compact:\n    container_name: thanos-compact\n    image: thanosio/thanos:main-2024-03-26-6c613fc\n    user: root\n    volumes:\n      - /home/prometheus:/prometheus\n    command:\n      - 'compact'\n      - '--objstore.config-file=/prometheus/bucket_config.yaml'\n      - '--http-address=0.0.0.0:19190'\n      - '--data-dir=/prometheus/thanos/compact'\n      - '--wait'\n    restart: always\n    depends_on:\n      - thanos-sidecar\n\n# for test\n# # consul\n#   consul-server:\n#     image: hashicorp/consul:1.15.4\n#     container_name: consul-server\n#     restart: always\n# #    volumes:\n# #     - /home/consul/server.json:/consul/config/server.json:ro\n#     ports:\n#       - \"8500:8500\"\n# #      - \"8600:8600/tcp\"\n# #      - \"8600:8600/udp\"\n# #    command: \"agent -bootstrap-expect=3\"\n\nnetworks:\n  default:\n    name: docker_default\n    external: true\n\n# bucket_config\n[root@prom-mysql prometheus]# cat bucket_config.yaml\ntype: S3\nconfig:\n  bucket: \"mysql-prometheus\"\n  endpoint: \"s3.ap-northeast-1.vpce.amazonaws.com\"\n  region: \"xxxx\"\n  access_key: \"\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\"\n  insecure: false\n  signature_version2: true\n  secret_key: \"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30ad\u30fc\"\n  put_user_metadata: {}\n  http_config:\n    idle_conn_timeout: 0s\n    response_header_timeout: 0s\n    insecure_skip_verify: false\n  trace:\n    enable: false\n  part_size: 0\n</code></pre>"},{"location":"psql-vs-mysql/","title":"MySQL\u3068PostgreSQL\u30b3\u30de\u30f3\u30c9\u6bd4\u8f03\u8868","text":""},{"location":"psql-vs-mysql/#mysqlpostgresql","title":"MySQL\u3068PostgreSQL\u30b3\u30de\u30f3\u30c9\u6bd4\u8f03\u8868","text":"<p>\u672c\u6587</p> \u6a5f\u80fd MySQL PostgreSQL \u8d77\u52d5 <code>$ mysql -p -h \u30db\u30b9\u30c8\u540d -P \u30dd\u30fc\u30c8\u756a\u53f7 -u \u30e6\u30fc\u30b6\u540d DB\u540d</code> <code>$ psql -h \u30db\u30b9\u30c8\u540d -p \u30dd\u30fc\u30c8\u756a\u53f7 -U \u30e6\u30fc\u30b6\u540d DB\u540d</code> \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u4e00\u89a7 show databases; \\l \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u5207\u66ff use DB\u540d \\u DB\u540d \\c DB\u540d \u30c6\u30fc\u30d6\u30eb\u4e00\u89a7 show tables; \\d\u3001\\dt\u3001\\d+\u3001\\dt+ \u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\u78ba\u8a8d desc \u30c6\u30fc\u30d6\u30eb\u540d; \\d \u30c6\u30fc\u30d6\u30eb\u540d \u30c6\u30fc\u30d6\u30ebCREATE\u6587\u78ba\u8a8d show create table \u30c6\u30fc\u30d6\u30eb\u540d pg_dump DB\u540d -U \u30e6\u30fc\u30b6\u540d -s -t \u30c6\u30fc\u30d6\u30eb\u540d \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4e00\u89a7 SHOW INDEX FROM tbl_name; \\d table_name \u884c\u8868\u793a\u306e\u5207\u308a\u66ff\u3048 select * from t \\G \\x select * from t; \u203bmysql\u540c\u69d8\u30011\u56de\u306e\u30af\u30a8\u30ea\u3060\u3051\\x\u3057\u305f\u3044\u5834\u5408\u306f select * from t \\gx psql 9\u4ee5\u524d\u306e\u5834\u5408\u306f\u3053\u3061\u3089 SQL\u30d5\u30a1\u30a4\u30eb\u5b9f\u884c . \\i SQL\u30c0\u30f3\u30d7 mysqldump pg_dump TSV\u30c0\u30f3\u30d7 mysqldump -u USER --password=PASS DATABASE_NAME TABLE_NAME -T /tmp \\copy \u30c6\u30fc\u30d6\u30eb\u540d to 'data.tsv' csv delimiter E'\\t' header; \u307e\u305f\u306f \\copy (select * from \u30c6\u30fc\u30d6\u30eb\u540d) to 'data.tsv' csv delimiter E'\\t' header; TSV\u30a4\u30f3\u30dd\u30fc\u30c8 LOAD DATA LOCAL INFILE \u30d5\u30a1\u30a4\u30eb\u540d REPLACE INTO TABLE \u30c6\u30fc\u30d6\u30eb\u540d IGNORE 1 LINES; copy \u30c6\u30fc\u30d6\u30eb\u540d from '/absolute_path/to/data.tsv' ( delimiter E'\\t', format csv, header true ); SQL\u6642\u9593\u8a08\u6e2c \u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u8868\u793a\u3055\u308c\u308b \\timing on \u30ed\u30b0\u51fa\u529b\u958b\u59cb \\T log.txt \\o log.txt \u30ed\u30b0\u51fa\u529b\u7d42\u4e86 \\t \\o 1\u56de\u306e\u30af\u30a8\u30ea\u3060\u3051\u30d5\u30a1\u30a4\u30eb\u306b\u51fa\u529b \u4e0d\u660e SQL\u306e\u672b\u5c3e\u306b\\g FILENAME\u3092\u3064\u3051\u308b 1\u56de\u306e\u30af\u30a8\u30ea\u3060\u3051vim\u3067\u8868\u793a \u4e0d\u660e SQL\u306e\u672b\u5c3e\u306b\\g |vim -\u3092\u3064\u3051\u308b \u5b9a\u7fa9\u3092\u30b3\u30d4\u30fc\u3057\u3066\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210 create table t2 like t1; create table t2 (like t1); \u5b9f\u884c\u8a08\u753b SQL\u306e\u5148\u982d\u306bEXPLAIN\u3092\u3064\u3051\u308b SQL\u306e\u5148\u982d\u306bEXPLAIN\u3092\u3064\u3051\u308b \u63a5\u7d9a\u5148\u30b5\u30fc\u30d0\u78ba\u8a8d \\s \\conninfo SELECT version(); \u63a5\u7d9a\u3092\u78ba\u8a8d show processlist; select * from pg_stat_activity; \u9023\u756aID \u30ab\u30e9\u30e0\u540d int auto_increment \u30ab\u30e9\u30e0\u540d serial \u4eca\u65e5\u306e\u65e5\u4ed8 curdate() current_date \u73fe\u5728\u6642\u523b now() now() \u30d8\u30eb\u30d7 \\h \u307e\u305f\u306f \\? \\h \u3068 \\? \uff08\u5185\u5bb9\u304c\u7570\u306a\u308b\uff09 \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb ~/.my.cnf ~/.psqlrc"},{"location":"psql-vs-mysql/#information_schema","title":"information_schema\u306f\u4e21\u65b9\u306b\u5171\u901a","text":"<p>information_schema\u306fSQL\u6a19\u6e96\u306a\u306e\u3067\u3001\u3069\u3061\u3089\u3067\u3082\u540c\u3058SQL\u304c\u4f7f\u3048\u308b\u3002</p>"},{"location":"psql-vs-mysql/#_1","title":"\u30c6\u30fc\u30d6\u30eb\u4e00\u89a7\u3092\u8868\u793a","text":"<pre><code>SELECT table_catalog\n       ,table_schema\n       ,table_name\n       ,table_type\nFROM   information_schema.tables;\n</code></pre>"},{"location":"psql-vs-mysql/#_2","title":"\u30ab\u30e9\u30e0\u4e00\u89a7\u3092\u8868\u793a","text":"<pre><code>SELECT table_schema\n       ,table_name\n       ,column_name\n       ,data_type\n       ,character_maximum_length\n       ,numeric_precision\n       ,column_default\nFROM   information_schema.columns\nWHERE  table_name = 't1'\nORDER  BY table_name\n          ,ordinal_position;\n</code></pre>"},{"location":"psql-vs-mysql/#_3","title":"\u30c7\u30d5\u30a9\u30eb\u30c8\u63a5\u7d9a\u5148","text":"<p>PostgreSQL\uff1a\u74b0\u5883\u5909\u6570\u3067\u8a2d\u5b9a</p> <pre><code>export PGDATABASE=DB\u540d\nexport PGHOST=\u30db\u30b9\u30c8\nexport PGPORT=\u30dd\u30fc\u30c8\u756a\u53f7\nexport PGUSER=\u30e6\u30fc\u30b6\u30fc\u540d\nexport PGPASSWORD=\u30d1\u30b9\u30ef\u30fc\u30c9\n\n\u30d1\u30b9\u30ef\u30fc\u30c9\u306f~/.pgpass\u3067\u3082\u8a2d\u5b9a\u3067\u304d\u308b\u3002\n</code></pre> <p>MySQL\uff1a~/.my.cnf\u3067\u8a2d\u5b9a</p> <pre><code>[client]\ndatabase=DB\u540d\nuser=\u30e6\u30fc\u30b6\u30fc\u540d\npassword=\u30d1\u30b9\u30ef\u30fc\u30c9\n</code></pre>"},{"location":"py-pip/","title":"\u4f7f\u7528 Python Pip \u7684 10 \u4e2a\u6280\u5de7","text":"<p>\u4f17\u6240\u5468\u77e5\uff0cpip \u53ef\u4ee5\u5b89\u88c5\u3001\u66f4\u65b0\u3001\u5378\u8f7d Python \u7684\u7b2c\u4e09\u65b9\u5e93\uff0c\u975e\u5e38\u65b9\u4fbf\u3002\u4f60\u4eec\u4e2d\u7684\u8bb8\u591a\u4eba\u53ef\u80fd\u5df2\u7ecf\u4f7f\u7528 pip \u5f88\u957f\u65f6\u95f4\u4e86\uff0c\u4f46\u4e0d\u6e05\u695a\u5b83\u6709\u54ea\u4e9b\u8fd8\u4e0d\u9519\u7684\u529f\u80fd\u3002\u5e0c\u671b\u6211\u4eca\u5929\u5206\u4eab\u7684\u6280\u5de7\u80fd\u8ba9\u4f60\u4ece Python pip \u4e2d\u53d7\u76ca\u3002</p>"},{"location":"py-pip/#python-pip","title":"Python pip","text":"<p>\u8ba9\u6211\u4eec\u4ece Python \u8bed\u8a00\u5f00\u59cb\u3002Python \u4e4b\u6240\u4ee5\u53d7\u6b22\u8fce\uff0c\u4e0d\u4ec5\u56e0\u4e3a\u5b83\u6613\u4e8e\u5b66\u4e60\uff0c\u8fd8\u56e0\u4e3a\u5b83\u62e5\u6709\u6210\u5343\u4e0a\u4e07\u7684\uff08\u5b9d\uff09\u5e93\u3002</p> <p>\u8fd9\u4e9b\u5e93\u76f8\u5f53\u4e8e\u5df2\u7ecf\u96c6\u6210\u7684\u5de5\u5177\uff0c\u53ea\u8981\u5b89\u88c5\u4e86\u5c31\u53ef\u4ee5\u5728 Python \u4e2d\u4f7f\u7528\u3002\u5b83\u4eec\u53ef\u4ee5\u5904\u7406\u5404\u79cd\u5404\u6837\u7684\u95ee\u9898\uff0c\u800c\u65e0\u9700\u4f60\u91cd\u65b0\u9020\u8f6e\u5b50\uff0c\u800c\u4e14\u968f\u7740\u793e\u533a\u7684\u4e0d\u65ad\u66f4\u65b0\u548c\u7ef4\u62a4\uff0c\u4e00\u4e9b\u5e93\u8d8a\u6765\u8d8a\u5f3a\u5927\uff0c\u51e0\u4e4e\u53ef\u4ee5\u4e0e\u4f01\u4e1a\u7ea7\u5e94\u7528\u7a0b\u5e8f\u5ab2\u7f8e\u3002</p> <p>\u90a3\u4e48\u5982\u4f55\u4e0b\u8f7d\u5b89\u88c5\u8fd9\u4e9b\u5de5\u5177\u5e93\u5462\uff1f\u5b83\u4eec\u88ab\u653e\u7f6e\u5728\u4e00\u4e2a\u540d\u4e3a PyPi\uff08Python \u5305\u7d22\u5f15\uff09\u7684\u7edf\u4e00\u201c\u4ed3\u5e93\u201d\u4e2d\uff0c\u6240\u6709\u5e93\u5b89\u88c5\u90fd\u4f1a\u6765\u6e90\u4e8e\u8be5\u4ed3\u5e93\u3002</p> <p>\u6709\u4e86\u4ed3\u5e93\u4e4b\u540e\uff0c\u8fd8\u9700\u8981\u4e00\u4e2a\u7ba1\u7406\u5458\uff0cpip \u5c31\u662f\u8fd9\u6837\u4e00\u4e2a\u89d2\u8272\u3002pip \u4ece PyPi \u4e2d\u53d6\u51fa\u5e93\u5e76\u5c06\u5176\u5b89\u88c5\u5230 Python \u4e2d\u3002\u5b83\u8fd8\u53ef\u4ee5\u7ba1\u7406\u5df2\u5b89\u88c5\u7684\u5e93\uff0c\u5982\u66f4\u65b0\u3001\u67e5\u770b\u3001\u641c\u7d22\u3001\u5378\u8f7d\u7b49\u3002</p> <p>\u4e0b\u9762\u603b\u7ed3\u4e86 10 \u4e2a\u4f7f\u7528 pip \u7684\u5e38\u8bc6\u548c\u6280\u5de7\uff0c\u4f9b\u5927\u5bb6\u53c2\u8003\u3002</p>"},{"location":"py-pip/#1-pip","title":"1.\u5b89\u88c5 pip","text":"<p>\u4ece Python 3.4 \u5f00\u59cb\uff0cpip \u5df2\u7ecf\u5185\u7f6e\u5728 Python \u4e2d\uff0c\u56e0\u6b64\u65e0\u9700\u518d\u6b21\u5b89\u88c5\u3002</p> <p>\u5982\u679c\u4f60\u7684 Python \u7248\u672c\u6ca1\u6709 pip\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u4e24\u79cd\u65b9\u6cd5\u5b89\u88c5\u5b83\u3002</p> <ul> <li>\u5728\u547d\u4ee4\u884c\u8f93\u5165 easy_install pip\uff0c\u975e\u5e38\u8fc5\u901f\u3002</li> <li>\u4ece\u4ee5\u4e0b\u7f51\u5740\u4e0b\u8f7d pip \u5b89\u88c5\u6587\u4ef6\uff0c\u7136\u540e\u5c06\u5176\u63d0\u53d6\u5230 Python \u811a\u672c\u76ee\u5f55\uff0c\u5e76\u6267\u884c python setup.py install \u547d\u4ee4\u3002</li> </ul> <p>pip \u7684\u4e0b\u8f7d\u5730\u5740\uff1ahttps://pypi.org/project/pip/#files</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u60a8\u8fd8\u5728\u4f7f\u7528 Python3.4 \u53ca\u66f4\u65e9\u7248\u672c\uff0c\u8bf7\u5347\u7ea7\u5230 Python \u7684\u6700\u65b0\u7a33\u5b9a\u7248\u672c\uff08https://www.python.org/downloads/\uff09\u3002\u5426\u5219\uff0c\u60a8\u6bcf\u5929\u90fd\u4f1a\u589e\u52a0\u66f4\u591a\u7684\u6280\u672f\u503a\u52a1\u3002</p>"},{"location":"py-pip/#2-pip","title":"2.\u5347\u7ea7 pip","text":"<p>\u5982\u679c pip \u7684\u7248\u672c\u592a\u4f4e\uff0c\u53ef\u4ee5\u5347\u7ea7\u5f53\u524d\u7248\u672c\uff1apip install --upgrade pip \u6216 pip install -U pip\u3002</p> <pre><code>$ pip install -U pip\nLooking in indexes: https://pypi.python.org/simple\nRequirement already satisfied: pip in ./test/lib/python3.8/site-packages (21.1.1)\nCollecting pip\n  Using cached pip-22.0.4-py3-none-any.whl (2.1 MB)\nInstalling collected packages: pip\n  Attempting uninstall: pip\n    Found existing installation: pip 21.1.1\n    Uninstalling pip-21.1.1:\n      Successfully uninstalled pip-21.1.1\nSuccessfully installed pip-22.0.4\n</code></pre>"},{"location":"py-pip/#3","title":"3.\u5b89\u88c5\u5e93","text":"<p>\u4f7f\u7528 pip \u5b89\u88c5\u7b2c\u4e09\u65b9\u5e93\uff0c\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u8bed\u53e5\uff1apip install package_name</p> <p>\u6307\u5b9a\u5305\u7248\u672c\uff1apip install package_name==1.1.2</p> <p>\u6bd4\u5982\uff0c\u6211\u8981\u5b89\u88c5 3.4.1 \u7248\u672c\u7684 matplotlib\uff1apip install matplotlib==3.4.1</p>"},{"location":"py-pip/#4","title":"4. \u5e93\u7684\u6279\u91cf\u5b89\u88c5","text":"<p>\u5982\u679c\u4e00\u4e2a\u9879\u76ee\u9700\u8981\u5b89\u88c5\u5f88\u591a\u5e93\uff0c\u53ef\u4ee5\u6279\u91cf\u5b89\u88c5\uff1apip install -r requirements.txt</p> <p>\u6587\u4ef6\u7684\u5185\u5bb9\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code># This is a comment\n# Specify a diffrent index\n-i http://dist.repoze.org/zope2/2.10/simple\n# Package with versions\ntensorflow==2.3.1\nuvicorn==0.12.2\nfastapi==0.63.0\npkg1\npkg2\npkg3&gt;=1.0,&lt;=2.0\n# It is possible to refer to specific local distribution paths.\n./downloads/numpy-1.9.2-cp34-none-win32.whl\n# It is possible to refer to other requirement files or constraints files.\n-r other-requirements.txt\n-c constraints.txt\n# It is possible to specify requirements as plain names.\npytest\npytest-cov\nbeautifulsoup4\n</code></pre>"},{"location":"py-pip/#5","title":"5.\u5378\u8f7d\u548c\u5347\u7ea7\u5305","text":"<p>\u5df2\u5b89\u88c5\u7684\u5e93\u53ef\u4ee5\u518d\u6b21\u5378\u8f7d\uff1a$ pip uninstall package_name</p> <p>\u5f53\u524d\u5e93\u7684\u7248\u672c\u5347\u7ea7\uff1a</p> <pre><code>$ pip install --upgrade package_name\n\u6216\n\n$ pip install -U package_name\n</code></pre>"},{"location":"py-pip/#6-python-pip","title":"6. \u51bb\u7ed3 Python pip \u4f9d\u8d56","text":"<p>\u6709\u65f6\u60a8\u60f3\u8f93\u51fa\u5f53\u524d\u73af\u5883\u4e2d\u6240\u6709\u5df2\u5b89\u88c5\u7684\u5305\uff0c\u6216\u751f\u6210\u4e00\u4e2a\u9700\u6c42\u6587\u4ef6\uff0c\u7136\u540e\u901a\u8fc7\u8be5\u6587\u4ef6\u5728\u53e6\u4e00\u4e2a\u73af\u5883\u4e2d\u8fdb\u884c\u5b89\u88c5\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 pip freeze \u547d\u4ee4\uff1a</p> <p><pre><code># List packages\n$ pip freeze\ndocutils==0.11\nJinja2==2.7.2\nMarkupSafe==0.19\nPygments==1.6\nSphinx==1.2.2\n# Generate requirements.txt file\n$ pip freeze &gt; requirements.txt\n</code></pre> \u8bf7\u6ce8\u610f\uff0c\u5305\u4f1a\u4ee5\u6392\u5e8f\u987a\u5e8f\u5217\u51fa\uff08\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff09\u3002\u5982\u679c\u60a8\u53ea\u60f3\u5217\u51fa\u975e\u5168\u5c40\u5b89\u88c5\u7684\u8f6f\u4ef6\u5305\uff0c\u8bf7\u4f7f\u7528 -l/--local\u3002</p>"},{"location":"py-pip/#7","title":"7.\u67e5\u770b\u5e93\u4fe1\u606f","text":"<p>\u60a8\u53ef\u4ee5\u4f7f\u7528 pip show -f package_name \u5217\u51fa\u5305\u4fe1\u606f\uff1a</p> <pre><code>$ pip show -f pyyaml\nName: PyYAML\nVersion: 5.4.1\nSummary: YAML parser and emitter for Python\nHome-page: https://pyyaml.org/\nAuthor: Kirill Simonov\nAuthor-email: xi@resolvent.net\nLicense: MIT\nLocation: /private/tmp/test/lib/python3.8/site-packages\nRequires:\nRequired-by: awscli\nFiles:\n  PyYAML-5.4.1.dist-info/INSTALLER\n  PyYAML-5.4.1.dist-info/LICENSE\n  PyYAML-5.4.1.dist-info/METADATA\n  PyYAML-5.4.1.dist-info/RECORD\n  PyYAML-5.4.1.dist-info/WHEEL\n  PyYAML-5.4.1.dist-info/top_level.txt\n...\n</code></pre>"},{"location":"py-pip/#8","title":"8.\u67e5\u770b\u9700\u8981\u5347\u7ea7\u7684\u5e93","text":"<p>\u5728\u5f53\u524d\u5b89\u88c5\u7684\u5e93\u4e2d\uff0c\u67e5\u770b\u6709\u54ea\u4e9b\u5e93\u9700\u8981\u8fdb\u884c\u7248\u672c\u5347\u7ea7\uff1a</p> <pre><code>$ pip list -o\nPackage    Version Latest Type\n---------- ------- ------ -----\ndocutils   0.15.2  0.18.1 wheel\nPyYAML     5.4.1   6.0    wheel\nrsa        4.7.2   4.8    wheel\nsetuptools 56.0.0  62.1.0 wheel\n</code></pre>"},{"location":"py-pip/#9","title":"9. \u68c0\u67e5\u517c\u5bb9\u6027\u95ee\u9898","text":"<p>\u9a8c\u8bc1\u5df2\u5b89\u88c5\u7684\u5e93\u7684\u517c\u5bb9\u6027\u4f9d\u8d56\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 pip check package-name\uff1a</p> <pre><code>$ pip check awscli\nNo broken requirements found.\n\u5982\u679c\u60a8\u4e0d\u6307\u5b9a\u5305\u540d\u79f0\uff0c\u5c06\u68c0\u67e5\u6240\u6709\u5305\u7684\u517c\u5bb9\u6027\u3002\n\n$ pip check\npyramid 1.5.2 requires WebOb, which is not installed.\n</code></pre>"},{"location":"py-pip/#10","title":"10. \u5c06\u5e93\u4e0b\u8f7d\u5230\u672c\u5730","text":"<p>\u5c06\u5e93\u4e0b\u8f7d\u5230\u672c\u5730\u7684\u6307\u5b9a\u4f4d\u7f6e\u5e76\u4ee5 whl \u683c\u5f0f\u4fdd\u5b58\uff1apip download package_name -d \"path\"</p> <pre><code>$ pip download PyYAML  -d \"/tmp/\"\nLooking in indexes: https://pypi.python.org/simple\nCollecting PyYAML\n  Downloading PyYAML-6.0-cp38-cp38-macosx_10_9_x86_64.whl (192 kB)\n     \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 192.2/192.2 KB 4.7 MB/s eta 0:00:00\nSaved ./PyYAML-6.0-cp38-cp38-macosx_10_9_x86_64.whl\nSuccessfully downloaded PyYAML\n$ ls /tmp/PyYAML-6.0-cp38-cp38-macosx_10_9_x86_64.whl\n/tmp/PyYAML-6.0-cp38-cp38-macosx_10_9_x86_64.whl\n</code></pre> <ul> <li>https://blog.devgenius.io/python-10-tips-for-using-pip-3126537e8a6b</li> </ul>"},{"location":"python-config/","title":"Python \u7a0b\u5e8f\u914d\u7f6e\u6587\u4ef6\u7ba1\u7406\u7684\u6700\u4f73\u5de5\u7a0b\u5b9e\u8df5","text":"<ul> <li>https://cloud.tencent.com/developer/beta/article/2269479</li> </ul> <p>\u6700\u8fd1\u5728\u7ed3\u5408 Python-3.12.0a6 \u7248\u672c\u5f00\u53d1\u4e00\u4e2a\u591a\u7ebf\u7a0b\u67b6\u6784\u7684\u540e\u53f0\u670d\u52a1\uff1b\u670d\u52a1\u542f\u52a8\u65f6\u4f1a\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\uff0c\u5e76\u4e14\u8981\u6c42\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\u540c\u4e00\u4efd\u914d\u7f6e\u3002 \u670d\u52a1\u672c\u8eab\u76f4\u63a5\u901a\u8fc7 http \u63a5\u53e3\u6765\u52a8\u6001\u8c03\u6574\u914d\u7f6e\u9879\u7684\u503c\uff0c\u8fd8\u8981\u505a\u5230\u670d\u52a1\u9000\u51fa\u4e4b\u540e\u6301\u4e45\u5316\u914d\u7f6e\u9879\u5230\u914d\u7f6e\u6587\u4ef6\u3002 \u4e00\u5f00\u59cb\u4ee5\u4e3a\u8fd9\u4e2a\u7528 Python \u5199\u4e5f\u4f1a\u8981\u7528\u51e0\u767e\u884c \uff0c\u6700\u540e\u53d1\u73b0\u5b8c\u6210\u6838\u5fc3\u529f\u80fd\u5c31\u53ea\u9700\u8981\u4e0d\u5230 50 \u884c\uff0cPython \u725b\u903c\uff01\uff01\uff01</p>"},{"location":"python-config/#_1","title":"\u9700\u6c42\u4e00\uff1a\u652f\u6301\u7b80\u5355\u7684\u914d\u7f6e\u9879","text":"<p>\u5047\u8bbe\u6211\u4eec\u76ee\u524d\u53ea\u652f\u6301 name \u548c port \u4e24\u4e2a\u914d\u7f6e\u9879\uff0c\u591a\u652f\u6301\u51e0\u4e2a\u4e0d\u96be\uff0c\u53ea\u662f\u4e0d\u65b9\u4fbf\u6f14\u793a\u3002</p> <pre><code>\"\"\"\u5b9e\u4f8b\u914d\u7f6e\u7ba1\u7406\n\"\"\"\nfrom dataclasses import dataclass\n@dataclass\nclass Config(object):\nname:str= \"mysql\"\nport:int = 3306\n</code></pre> <p>\u770b\u8d77\u6765\u662f\u6ca1\u95ee\u9898\u4e86\uff0c\u4e0b\u9762\u53ef\u4ee5\u8bd5\u7528\u4e00\u4e0b\uff0c\u4e5f\u987a\u5e26\u5f15\u5bfc\u51fa\u7b2c\u4e8c\u4e2a\u9700\u6c42\u3002</p> <pre><code>In [6]: a = Config()\nIn [7]: b = Config()\nIn [8]: id(a)\nOut[8]: 4407850896\nIn [9]: id(b)\nOut[9]: 4407852496\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u4e24\u4e2a\u914d\u7f6e\u5bf9\u8c61\u7684 ID \u503c\u4e0d\u4e00\u6837\u3002\u7531\u4e8e\u914d\u7f6e\u6587\u4ef6\u53ea\u6709\u4e00\u4e2a\uff0c\u6211\u4eec\u5e0c\u671b\u914d\u7f6e\u5bf9\u8c61\u4e5f\u53ea\u6709\u4e00\u4e2a\u3002</p>"},{"location":"python-config/#_2","title":"\u9700\u6c42\u4e8c\uff1a\u914d\u7f6e\u5bf9\u8c61\u5168\u5c40\u552f\u4e00","text":"<p>\u4ea4\u4ee3\u4e00\u4e2a\u80cc\u666f\uff0c\u89e3\u91ca\u5668\u5728\u505a import \u7684\u65f6\u5019\u662f\u5355\u4e00\u7ebf\u7a0b\u5728\u8dd1\u7684\u3002\u6709\u4e86\u8fd9\u4e2a\u524d\u63d0\u6211\u4eec\u53ef\u4ee5\u5c11\u5199\u4e00\u4e9b\u52a0\u9501\u7684\u4ee3\u7801\uff0c\u80fd\u5c11\u5199\u4e00\u884c\u7b97\u4e00\u884c\u5427\u3002</p> <pre><code>\"\"\"\u5b9e\u4f8b\u914d\u7f6e\u7ba1\u7406\n\"\"\"\nfrom dataclasses import dataclass\n@dataclass\nclass Config(object):\nname:str= \"mysql\"\nport:int = 3306\n_instance = None\n# \u5355\u4f8b\u6a21\u5f0f\ndef __new__(cls, *args, **kw):\nif cls._instance is None:\ncls._instance = object.__new__(cls, *args, **kw)\nreturn cls._instance\n</code></pre> <p>\u7528 Python \u5c31\u662f\u8fd9\u4e48\u7684\u7b80\u5355\uff0c\u51e0\u884c\u4ee3\u7801\u5c31\u641e\u5b9a\u4e86\u3002\u4f46\u662f\u8fd8\u662f\u8981\u6d4b\u8bd5\u4e00\u4e0b\u987a\u5e26\u5f15\u5bfc\u51fa\u4e0b\u4e00\u4e2a\u9700\u6c42\u3002</p> <pre><code>In [4]: a = Config()\nIn [5]: b = Config()\nIn [6]: id(a)\nOut[6]: 4414751568\nIn [7]: id(b)\nOut[7]: 4414751568\n</code></pre> <p>\u73b0\u5728\u914d\u7f6e\u5bf9\u8c61\u5df2\u7ecf\u662f\u5355\u4f8b\u4e86\uff0c\u4f46\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5b83\u7684\u6bcf\u4e2a\u914d\u7f6e\u9879\u7684\u503c\u90fd\u662f\u9ed8\u8ba4\u503c\uff0c\u6211\u4eec\u5f53\u7136\u662f\u5e0c\u671b\u5b83\u5728\u521b\u5efa\u5bf9\u8c61\u7684\u65f6\u5019\u662f\u4f7f\u7528\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u503c\u5566\u3002\u4e0b\u9762\u770b\u9700\u6c42\u4e09\u600e\u4e48\u5b9e\u73b0</p>"},{"location":"python-config/#_3","title":"\u9700\u6c42\u4e09\uff1a\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u6784\u9020\u914d\u7f6e\u5bf9\u8c61","text":"<p>\u5047\u8bbe\u6211\u4eec\u7684\u914d\u7f6e\u6587\u4ef6\u88ab \u201c\u6301\u4e45\u5316\u201d \u5230\u4e86 /tmp/config.json \uff0c\u73b0\u5728\u5c31\u53ef\u4ee5\u5199\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\u5e76\u66f4\u65b0\u914d\u7f6e\u5bf9\u8c61\u503c\u7684\u4ee3\u7801\u4e86\u3002</p> <p><pre><code>\"\"\"\u5b9e\u4f8b\u914d\u7f6e\u7ba1\u7406\n\"\"\"\nimport json\nimport logging\nfrom pathlib import Path\nfrom dataclasses import dataclass\n@dataclass\nclass Config(object):\nname:str= \"mysql\"\nport:int = 3306\n_instance = None\n# \u5355\u4f8b\u6a21\u5f0f\ndef __new__(cls, *args, **kw):\nif cls._instance is None:\ncls._instance = object.__new__(cls, *args, **kw)\nreturn cls._instance\n# \u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\ndef __post_init__(self):\n\"\"\"\u5982\u679c\u914d\u7f6e\u6587\u4ef6\u5b58\u5728\u5c31\u7528\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u503c\uff0c\u8986\u76d6\u9ed8\u8ba4\u503c\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u5982\u679c\u9047\u5230\u5f02\u5e38\u5c31\u4fdd\u6301\u9ed8\u8ba4\u503c\n        \"\"\"\nif (config_file:=Path(\"/tmp/config.json\")) and config_file.exists():\ntry:\nwith open(config_file) as f:\njson_data = json.loads(f.read())\nself.__dict__.update(json_data)\nexcept Exception as err:\npass\nelse:\nlogging.warn(\"config file '{}' not exists. well using defautl values .\".format(config_file))\n</code></pre> \u5047\u8bbe\u6211\u4eec\u7684\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\u662f\u8fd9\u6837\u7684\u3002 <pre><code>cat /tmp/config.json \n{\n  \"name\": \"trump\",\n  \"port\": 8848\n}\n</code></pre></p> <p>\u4e0b\u9762\u7684\u6d4b\u8bd5\u4e00\u4e0b</p> <pre><code>In [2]: a = Config()\n\nIn [3]: a\nOut[3]: Config(name='trump', port=8848)\n\nIn [4]: b = Config()\n\nIn [5]: b\nOut[5]: Config(name='trump', port=8848)\n\nIn [6]: a == b\nOut[6]: True\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230 name \u548c port \u5df2\u7ecf\u6ca1\u6709\u4f7f\u7528\u9ed8\u8ba4\u7684 \"mysql\" \u548c 3306 \u4e86\uff0c\u800c\u662f\u4f7f\u7528\u4e86\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u503c\u3002 \u5230\u8fd9\u91cc\u6211\u4eec\u53ea\u5269\u4e0b\u6700\u540e\u4e00\u4e2a\u9700\u6c42\uff0c\u5c31\u662f\u5728\u7a0b\u5e8f\u9000\u51fa\u7684\u65f6\u5019\uff0c\u628a\u914d\u7f6e\u5bf9\u8c61\u7684\u503c\u66f4\u65b0\u56de\u914d\u7f6e\u6587\u4ef6\u3002\u8fd9\u4e2a\u5c31\u770b\u9700\u6c42\u56db\u600e\u4e48\u5199\u3002</p>"},{"location":"python-config/#_4","title":"\u9700\u6c42\u56db\uff1a\u7a0b\u5e8f\u9000\u51fa\u524d\u81ea\u52a8\u6301\u4e45\u5316\u914d\u7f6e\u5bf9\u8c61\u5230\u914d\u7f6e\u6587\u4ef6","text":"<p>\u89e3\u91ca\u5668\u5728\u9000\u51fa\u524d\u6709\u4e2a\u94a9\u5b50(atexit)\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u8fd9\u91cc\u6307\u5b9a\u56de\u8c03\u51fd\u6570\uff0c\u8fd9\u4e2a\u65f6\u5019\u4fdd\u5b58\u914d\u7f6e\u6587\u4ef6\u518d\u9002\u5408\u4e0d\u8fc7\u3002</p> <pre><code>\"\"\"\u5b9e\u4f8b\u914d\u7f6e\u7ba1\u7406\n\"\"\"\nimport json\nimport atexit\nimport logging\nfrom pathlib import Path\nfrom dataclasses import dataclass, asdict\n@dataclass\nclass Config(object):\nname:str= \"mysql\"\nport:int = 3306\n_instance = None\n# \u5355\u4f8b\u6a21\u5f0f\ndef __new__(cls, *args, **kw):\nif cls._instance is None:\ncls._instance = object.__new__(cls, *args, **kw)\nreturn cls._instance\n# \u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\ndef __post_init__(self):\n\"\"\"\u5982\u679c\u914d\u7f6e\u6587\u4ef6\u5b58\u5728\u5c31\u7528\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u503c\uff0c\u8986\u76d6\u9ed8\u8ba4\u503c\uff1b\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u5982\u679c\u9047\u5230\u5f02\u5e38\u5c31\u4fdd\u6301\u9ed8\u8ba4\u503c\u3002\u7a0b\u5e8f\u9000\u51fa\u65f6\u6301\u4e45\u5230\u5230\u914d\u7f6e\u5230\u6587\u4ef6\u3002\n        \"\"\"\nif (config_file:=Path(\"/tmp/config.json\")) and config_file.exists():\ntry:\nwith open(config_file) as f:\njson_data = json.loads(f.read())\nself.__dict__.update(json_data)\nexcept Exception as err:\npass\nelse:\nlogging.warn(\"config file '{}' not exists. well using defautl values .\".format(config_file))\n# \u7a0b\u5e8f\u9000\u51fa\u65f6\u4fdd\u5b58\u914d\u7f6e\u5230\u914d\u7f6e\u6587\u4ef6 /tmp/config.json\ndef sync_to_disk():\n\"\"\"\n            \"\"\"\njson_str = json.dumps(asdict(self), indent=4)\nwith open(config_file, 'w') as f:\nlogging.warning(\"save configs to '{}' \".format(config_file))\nf.write(json_str) \natexit.register(sync_to_disk)\n</code></pre> <p>\u9a8c\u8bc1\u4e00\u4e0b</p> <pre><code>In [1]: from appconfig import Config\n\nIn [2]: a = Config()\n\nIn [3]: a.name\nOut[3]: 'trump'\n\nIn [4]: a.name = \"hello-world\"\n\nIn [5]: exit()\nWARNING:root:save configs to '/tmp/config.json' \n</code></pre> <p>\u770b\u65e5\u5fd7\u662f\u5df2\u7ecf\u628a\u914d\u7f6e\u9879\u66f4\u65b0\u56de\u914d\u7f6e\u6587\u4ef6\u4e86\uff0c\u4f46\u662f\u8fd8\u662f cat \u786e\u8ba4\u4e00\u4e0b\u4e3a\u597d\u3002</p> <pre><code>cat /tmp/config.json \n{\n    \"name\": \"hello-world\",\n    \"port\": 8848\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u786e\u5b9e\u5df2\u7ecf\u628a\u914d\u7f6e\u9879\u7684\u503c\u66f4\u65b0\u5230\u6587\u4ef6\u4e86\u3002</p>"},{"location":"python-decorator/","title":"\u8de8\u8fc7\u8fd9\u9053\u88c5\u9970\u5668\u7684\u574e\uff0c\u6216\u8bb8\u4f60\u5c31\u5347\u7ea7\u4e86","text":"<p>\u88c5\u9970\u5668\u662f\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684 Python \u6982\u5ff5\uff0c\u53ef\u80fd\u7b97\u662f\u8fdb\u9636\u7684\u4e00\u5927\u95e8\u69db\u3002\u672c\u6587\u6bd4\u8f83\u5168\u9762\u5730\u5bf9\u88c5\u9970\u5668\u8fdb\u884c\u4e86\u4ecb\u7ecd\uff0c\u5e76\u4e14\u914d\u5907\u4e86\u8be6\u7ec6\u7684\u4ee3\u7801\u793a\u4f8b\uff0c\u63a8\u8350\u9605\u8bfb\u3002</p> <p>\u4f5c\u8005\uff1aToby \u539f\u6587\uff1ahttps://betacat.online/posts/python-decorator/index.html</p> <p>Python \u4e2d\u7684\u88c5\u9970\u5668\u662f\u4f60\u8fdb\u5165 Python \u5927\u95e8\u7684\u4e00\u9053\u574e\uff0c\u4e0d\u7ba1\u4f60\u8de8\u4e0d\u8de8\u8fc7\u53bb\u5b83\u90fd\u5728\u90a3\u91cc\u3002</p>"},{"location":"python-decorator/#_1","title":"\u4e3a\u4ec0\u4e48\u9700\u8981\u88c5\u9970\u5668","text":"<p>\u6211\u4eec\u5047\u8bbe\u4f60\u7684\u7a0b\u5e8f\u5b9e\u73b0\u4e86 <code>say_hello ()</code> \u548c <code>say_goodbye ()</code> \u4e24\u4e2a\u51fd\u6570\u3002</p> <pre><code>def say_hello():\nprint \"hello!\"\ndef say_goodbye():\nprint \"hello!\"  # bug here\nif __name__ == '__main__':\nsay_hello()\nsay_goodbye()\n</code></pre> <p>\u4f46\u662f\u5728\u5b9e\u9645\u8c03\u7528\u4e2d\uff0c\u6211\u4eec\u53d1\u73b0\u7a0b\u5e8f\u51fa\u9519\u4e86\uff0c\u4e0a\u9762\u7684\u4ee3\u7801\u6253\u5370\u4e86\u4e24\u4e2a hello \u3002\u7ecf\u8fc7\u8c03\u8bd5\u4f60\u53d1\u73b0\u662f <code>say_goodbye ()</code> \u51fa\u9519\u4e86\u3002\u8001\u677f\u8981\u6c42\u8c03\u7528\u6bcf\u4e2a\u65b9\u6cd5\u524d\u90fd\u8981\u8bb0\u5f55\u8fdb\u5165\u51fd\u6570\u7684\u65f6\u95f4\u548c\u540d\u79f0\uff0c\u6bd4\u5982\u8fd9\u6837\uff1a</p> <p><pre><code>[DEBUG] 2016 - 10 - 27 11:11:11 - Enter say_hello()\nHello!\n[DEBUG] 2016 - 10 - 27 11:11:11 - Enter say_goodbye()\nGoodbye!\n</code></pre> \u597d\uff0c\u5c0f A \u662f\u4e2a\u6bd5\u4e1a\u751f\uff0c\u4ed6\u662f\u8fd9\u6837\u5b9e\u73b0\u7684\u3002</p> <p><pre><code>def say_hello():\nprint \"[DEBUG]: enter say_hello()\"\nprint \"hello!\"\ndef say_goodbye():\nprint \"[DEBUG]: enter say_goodbye()\"\nprint \"hello!\"\nif __name__ == '__main__':\nsay_hello()\nsay_goodbye()\n</code></pre> \u5f88 low \u5427\uff1f \u55ef\u662f\u7684\u3002\u5c0f B \u5de5\u4f5c\u6709\u4e00\u6bb5\u65f6\u95f4\u4e86\uff0c\u4ed6\u544a\u8bc9\u5c0f A \u5e94\u8be5\u8fd9\u6837\u5199\u3002</p> <pre><code>def debug():\nimport inspect\ncaller_name = inspect.stack()[1][3]    \nprint \"[DEBUG]: enter {}()\".format(caller_name)\ndef say_hello():\ndebug()    \nprint \"hello!\"\ndef say_goodbye():\ndebug()    \nprint \"goodbye!\"\nif __name__ == '__main__':\nsay_hello()\nsay_goodbye()\n</code></pre> <p>\u662f\u4e0d\u662f\u597d\u4e00\u70b9\uff1f\u90a3\u5f53\u7136\uff0c\u4f46\u662f\u6bcf\u4e2a\u4e1a\u52a1\u51fd\u6570\u91cc\u90fd\u8981\u8c03\u7528\u4e00\u4e0b debug () \u51fd\u6570\uff0c\u662f\u4e0d\u662f\u5f88\u96be\u53d7\uff1f\u4e07\u4e00\u8001\u677f\u8bf4 say \u76f8\u5173\u7684\u51fd\u6570\u4e0d\u7528 debug \uff0c do \u76f8\u5173\u7684\u624d\u9700\u8981\u5462\uff1f</p> <p>\u90a3\u4e48\u88c5\u9970\u5668\u8fd9\u65f6\u5019\u5e94\u8be5\u767b\u573a\u4e86\u3002</p> <p>\u88c5\u9970\u5668\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a Python \u51fd\u6570\uff0c\u5b83\u53ef\u4ee5\u8ba9\u5176\u4ed6\u51fd\u6570\u5728\u4e0d\u9700\u8981\u505a\u4efb\u4f55\u4ee3\u7801\u53d8\u52a8\u7684\u524d\u63d0\u4e0b\u589e\u52a0\u989d\u5916\u529f\u80fd\uff0c\u88c5\u9970\u5668\u7684\u8fd4\u56de\u503c\u4e5f\u662f\u4e00\u4e2a\u51fd\u6570\u5bf9\u8c61\u3002\u5b83\u7ecf\u5e38\u7528\u4e8e\u6709\u5207\u9762\u9700\u6c42\u7684\u573a\u666f\uff0c\u6bd4\u5982\uff1a\u63d2\u5165\u65e5\u5fd7\u3001\u6027\u80fd\u6d4b\u8bd5\u3001\u4e8b\u52a1\u5904\u7406\u3001\u7f13\u5b58\u3001\u6743\u9650\u6821\u9a8c\u7b49\u573a\u666f\u3002\u88c5\u9970\u5668\u662f\u89e3\u51b3\u8fd9\u7c7b\u95ee\u9898\u7684\u7edd\u4f73\u8bbe\u8ba1\uff0c\u6709\u4e86\u88c5\u9970\u5668\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u62bd\u79bb\u51fa\u5927\u91cf\u4e0e\u51fd\u6570\u529f\u80fd\u672c\u8eab\u65e0\u5173\u7684\u96f7\u540c\u4ee3\u7801\u5e76\u7ee7\u7eed\u91cd\u7528\u3002</p> <p>\u6982\u62ec\u7684\u8bb2\uff0c\u88c5\u9970\u5668\u7684\u4f5c\u7528\u5c31\u662f<code>\u4e3a\u5df2\u7ecf\u5b58\u5728\u7684\u51fd\u6570\u6216\u5bf9\u8c61\u6dfb\u52a0\u989d\u5916\u7684\u529f\u80fd\u3002</code></p> <p>\u600e\u4e48\u5199\u4e00\u4e2a\u88c5\u9970\u5668</p> <p>\u5728\u65e9\u4e9b\u65f6\u5019  (Python Version &lt; 2.4\uff0c2004\u5e74\u4ee5\u524d)\uff0c\u4e3a\u4e00\u4e2a\u51fd\u6570\u6dfb\u52a0\u989d\u5916\u529f\u80fd\u7684\u5199\u6cd5\u662f\u8fd9\u6837\u7684\u3002</p> <p><pre><code>def debug(func):\ndef wrapper():\nprint \"[DEBUG]: enter {}()\".format(func.__name__)        \nreturn func()    \nreturn wrapper\ndef say_hello():\nprint \"hello!\"\nsay_hello = debug(say_hello)  # \u6dfb\u52a0\u529f\u80fd\u5e76\u4fdd\u6301\u539f\u51fd\u6570\u540d\u4e0d\u53d8\n</code></pre> \u4e0a\u9762\u7684 debug \u51fd\u6570\u5176\u5b9e\u5df2\u7ecf\u662f\u4e00\u4e2a\u88c5\u9970\u5668\u4e86\uff0c\u5b83\u5bf9\u539f\u51fd\u6570\u505a\u4e86\u5305\u88c5\u5e76\u8fd4\u56de\u4e86\u53e6\u5916\u4e00\u4e2a\u51fd\u6570\uff0c\u989d\u5916\u6dfb\u52a0\u4e86\u4e00\u4e9b\u529f\u80fd\u3002\u56e0\u4e3a\u8fd9\u6837\u5199\u5b9e\u5728\u4e0d\u592a\u4f18\u96c5\uff0c\u4e0b\u9762\u4ee3\u7801\u7b49\u540c\u4e8e\u65e9\u671f\u7684\u5199\u6cd5\u3002</p> <pre><code>def debug(func):\ndef wrapper():\nprint \"[DEBUG]: enter {}()\".format(func.__name__)        \nreturn func()    \nreturn wrapper\n@debug\ndef say_hello():\nprint \"hello!\"\n</code></pre> <p>\u8fd9\u662f\u6700\u7b80\u5355\u7684\u88c5\u9970\u5668\uff0c\u4f46\u662f\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5982\u679c\u88ab\u88c5\u9970\u7684\u51fd\u6570\u9700\u8981\u4f20\u5165\u53c2\u6570\uff0c\u90a3\u4e48\u8fd9\u4e2a\u88c5\u9970\u5668\u5c31\u574f\u4e86\u3002\u56e0\u4e3a\u8fd4\u56de\u7684\u51fd\u6570\u5e76\u4e0d\u80fd\u63a5\u53d7\u53c2\u6570\uff0c\u4f60\u53ef\u4ee5\u6307\u5b9a\u88c5\u9970\u5668\u51fd\u6570 <code>wrapper</code> \u63a5\u53d7\u548c\u539f\u51fd\u6570\u4e00\u6837\u7684\u53c2\u6570\uff0c\u6bd4\u5982\uff1a</p> <pre><code>def debug(func):\ndef wrapper(something):  # \u6307\u5b9a\u4e00\u6bdb\u4e00\u6837\u7684\u53c2\u6570\nprint \"[DEBUG]: enter {}()\".format(func.__name__)        \nreturn func(something)    \nreturn wrapper  # \u8fd4\u56de\u5305\u88c5\u8fc7\u51fd\u6570\n@debug\ndef say(something):\nprint \"hello {}!\".format(something)\n</code></pre> <p>\u8fd9\u6837\u4f60\u5c31\u89e3\u51b3\u4e86\u4e00\u4e2a\u95ee\u9898\uff0c\u4f46\u53c8\u591a\u4e86 N \u4e2a\u95ee\u9898\u3002\u56e0\u4e3a\u51fd\u6570\u6709\u5343\u5343\u4e07\uff0c\u4f60\u53ea\u7ba1\u4f60\u81ea\u5df1\u7684\u51fd\u6570\uff0c\u522b\u4eba\u7684\u51fd\u6570\u53c2\u6570\u662f\u4ec0\u4e48\u6837\u5b50\uff0c\u9b3c\u77e5\u9053\uff1f\u8fd8\u597d Python \u63d0\u4f9b\u4e86\u53ef\u53d8\u53c2\u6570 <code>* args</code> \u548c\u5173\u952e\u5b57\u53c2\u6570 <code>** kwargs</code> \uff0c\u6709\u4e86\u8fd9\u4e24\u4e2a\u53c2\u6570\uff0c\u88c5\u9970\u5668\u5c31\u53ef\u4ee5\u7528\u4e8e\u4efb\u610f\u76ee\u6807\u51fd\u6570\u4e86\u3002</p> <p><pre><code>def debug(func):\ndef wrapper(*args, **kwargs):  # \u6307\u5b9a\u5b87\u5b99\u65e0\u654c\u53c2\u6570\nprint \"[DEBUG]: enter {}()\".format(func.__name__)        \nprint 'Prepare and say...',        \nreturn func(*args, **kwargs)    \nreturn wrapper  # \u8fd4\u56de\n@debug\ndef say(something):\nprint \"hello {}!\".format(something)\n</code></pre> \u81f3\u6b64\uff0c\u4f60\u5df2\u5b8c\u5168\u638c\u63e1\u521d\u7ea7\u7684\u88c5\u9970\u5668\u5199\u6cd5\u3002</p>"},{"location":"python-decorator/#_2","title":"\u9ad8\u7ea7\u4e00\u70b9\u7684\u88c5\u9970\u5668","text":"<p>\u5e26\u53c2\u6570\u7684\u88c5\u9970\u5668\u548c\u7c7b\u88c5\u9970\u5668\u5c5e\u4e8e\u8fdb\u9636\u7684\u5185\u5bb9\u3002\u5728\u7406\u89e3\u8fd9\u4e9b\u88c5\u9970\u5668\u4e4b\u524d\uff0c\u6700\u597d\u5bf9\u51fd\u6570\u7684\u95ed\u5305\u548c\u88c5\u9970\u5668\u7684\u63a5\u53e3\u7ea6\u5b9a\u6709\u4e00\u5b9a\u4e86\u89e3\u3002(\u53c2\u89c1http://betacat.online/posts/python- closure/)</p>"},{"location":"python-decorator/#_3","title":"\u5e26\u53c2\u6570\u7684\u88c5\u9970\u5668","text":"<p>\u5047\u8bbe\u6211\u4eec\u524d\u6587\u7684\u88c5\u9970\u5668\u9700\u8981\u5b8c\u6210\u7684\u529f\u80fd\u4e0d\u4ec5\u4ec5\u662f\u80fd\u5728\u8fdb\u5165\u67d0\u4e2a\u51fd\u6570\u540e\u6253\u51fa log \u4fe1\u606f\uff0c\u800c\u4e14\u8fd8\u9700\u6307\u5b9a log \u7684\u7ea7\u522b\uff0c\u90a3\u4e48\u88c5\u9970\u5668\u5c31\u4f1a\u662f\u8fd9\u6837\u7684\u3002</p> <pre><code>def debug(func):\ndef logging(level):\ndef wrapper(func):\ndef inner_wrapper(*args, **kwargs):\nprint \"[{level}]: enter function {func}()\".format(\nlevel=level,\nfunc=func.__name__)            \nreturn func(*args, **kwargs)        \nreturn inner_wrapper    \nreturn wrapper\n@logging(level='INFO')\ndef say(something):\nprint \"say {}!\".format(something)\n@logging(level='DEBUG')\ndef do(something):\nprint \"do {}...\".format(something)\nif __name__ == '__main__':\nsay('hello')\ndo(\"my work\")\n</code></pre> <p>\u662f\u4e0d\u662f\u6709\u4e00\u4e9b\u6655\uff1f\u4f60\u53ef\u4ee5\u8fd9\u4e48\u7406\u89e3\uff0c\u5f53\u5e26\u53c2\u6570\u7684\u88c5\u9970\u5668\u88ab\u6253\u5728\u67d0\u4e2a\u51fd\u6570\u4e0a\u65f6\uff0c\u6bd4\u5982 <code>@ logging ( level =' DEBUG ')</code> \uff0c\u5b83\u5176\u5b9e\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u4f1a\u9a6c\u4e0a\u88ab\u6267\u884c\uff0c\u53ea\u8981\u8fd9\u4e2a\u5b83\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u4e00\u4e2a\u88c5\u9970\u5668\u65f6\uff0c\u90a3\u5c31\u6ca1\u95ee\u9898\u3002\u7ec6\u7ec6\u518d\u4f53\u4f1a\u4e00\u4e0b\u3002</p>"},{"location":"python-decorator/#_4","title":"\u57fa\u4e8e\u7c7b\u5b9e\u73b0\u7684\u88c5\u9970\u5668","text":"<p>\u88c5\u9970\u5668\u51fd\u6570\u5176\u5b9e\u662f\u8fd9\u6837\u4e00\u4e2a\u63a5\u53e3\u7ea6\u675f\uff0c\u5b83\u5fc5\u987b\u63a5\u53d7\u4e00\u4e2a callable \u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\uff0c\u7136\u540e\u8fd4\u56de\u4e00\u4e2a callable \u5bf9\u8c61\u3002\u5728 Python \u4e2d\u4e00\u822c callable \u5bf9\u8c61\u90fd\u662f\u51fd\u6570\uff0c\u4f46\u4e5f\u6709\u4f8b\u5916\u3002\u53ea\u8981\u67d0\u4e2a\u5bf9\u8c61\u91cd\u8f7d\u4e86 <code>__call__ ()</code> \u65b9\u6cd5\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5bf9\u8c61\u5c31\u662f callable \u7684\u3002</p> <pre><code>class Test():\ndef __call__(self):\nprint 'call me!'t = Test()\nt()  # call me\n</code></pre> <p>\u50cf <code>__call__</code> \u8fd9\u6837\u524d\u540e\u90fd\u5e26\u4e0b\u5212\u7ebf\u7684\u65b9\u6cd5\u5728 Python \u4e2d\u88ab\u79f0\u4e3a\u5185\u7f6e\u65b9\u6cd5\uff0c\u6709\u65f6\u5019\u4e5f\u88ab\u79f0\u4e3a\u9b54\u6cd5\u65b9\u6cd5\u3002\u91cd\u8f7d\u8fd9\u4e9b\u9b54\u6cd5\u65b9\u6cd5\u4e00\u822c\u4f1a\u6539\u53d8\u5bf9\u8c61\u7684\u5185\u90e8\u884c\u4e3a\u3002\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u5c31\u8ba9\u4e00\u4e2a\u7c7b\u5bf9\u8c61\u62e5\u6709\u4e86\u88ab\u8c03\u7528\u7684\u884c\u4e3a\u3002</p> <p>\u56de\u5230\u88c5\u9970\u5668\u4e0a\u7684\u6982\u5ff5\u4e0a\u6765\uff0c\u88c5\u9970\u5668\u8981\u6c42\u63a5\u53d7\u4e00\u4e2a callable \u5bf9\u8c61\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a callable \u5bf9\u8c61\uff08\u4e0d\u592a\u4e25\u8c28\uff0c\u8be6\u89c1\u540e\u6587\uff09\u3002\u90a3\u4e48\u7528\u7c7b\u6765\u5b9e\u73b0\u4e5f\u662f\u4e5f\u53ef\u4ee5\u7684\u3002\u6211\u4eec\u53ef\u4ee5\u8ba9\u7c7b\u7684\u6784\u9020\u51fd\u6570 <code>__init__ ()</code> \u63a5\u53d7\u4e00\u4e2a\u51fd\u6570\uff0c\u7136\u540e\u91cd\u8f7d <code>__call__ ()</code> \u5e76\u8fd4\u56de\u4e00\u4e2a\u51fd\u6570\uff0c\u4e5f\u53ef\u4ee5\u8fbe\u5230\u88c5\u9970\u5668\u51fd\u6570\u7684\u6548\u679c\u3002</p> <pre><code>class logging(object):\ndef __init__(self, func):\nself.func = func    \ndef __call__(self, *args, **kwargs):\nprint \"[DEBUG]: enter function {func}()\".format(\nfunc=self.func.__name__)        \nreturn self.func(*args, **kwargs)\n@logging\ndef say(something):\nprint \"say {}!\".format(something)\n</code></pre>"},{"location":"python-decorator/#_5","title":"\u5e26\u53c2\u6570\u7684\u7c7b\u88c5\u9970\u5668","text":"<p>\u5982\u679c\u9700\u8981\u901a\u8fc7\u7c7b\u5f62\u5f0f\u5b9e\u73b0\u5e26\u53c2\u6570\u7684\u88c5\u9970\u5668\uff0c\u90a3\u4e48\u4f1a\u6bd4\u524d\u9762\u7684\u4f8b\u5b50\u7a0d\u5fae\u590d\u6742\u4e00\u70b9\u3002\u90a3\u4e48\u5728\u6784\u9020\u51fd\u6570\u91cc\u63a5\u53d7\u7684\u5c31\u4e0d\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u800c\u662f\u4f20\u5165\u7684\u53c2\u6570\u3002\u901a\u8fc7\u7c7b\u628a\u8fd9\u4e9b\u53c2\u6570\u4fdd\u5b58\u8d77\u6765\u3002\u7136\u540e\u5728\u91cd\u8f7d <code>__call__</code> \u65b9\u6cd5\u662f\u5c31\u9700\u8981\u63a5\u53d7\u4e00\u4e2a\u51fd\u6570\u5e76\u8fd4\u56de\u4e00\u4e2a\u51fd\u6570\u3002</p> <pre><code>class logging(object):\ndef __init__(self, level='INFO'):\nself.level = level    \ndef __call__(self, func):  # \u63a5\u53d7\u51fd\u6570\ndef wrapper(*args, **kwargs):\nprint \"[{level}]: enter function {func}()\".format(\nlevel=self.level,\nfunc=func.__name__)\nfunc(*args, **kwargs)        \nreturn wrapper  # \u8fd4\u56de\u51fd\u6570\n@logging(level='INFO')\ndef say(something):\nprint \"say {}!\".format(something)\n</code></pre>"},{"location":"python-decorator/#_6","title":"\u5185\u7f6e\u7684\u88c5\u9970\u5668","text":"<p>\u5185\u7f6e\u7684\u88c5\u9970\u5668\u548c\u666e\u901a\u7684\u88c5\u9970\u5668\u539f\u7406\u662f\u4e00\u6837\u7684\uff0c\u53ea\u4e0d\u8fc7\u8fd4\u56de\u7684\u4e0d\u662f\u51fd\u6570\uff0c\u800c\u662f\u7c7b\u5bf9\u8c61\uff0c\u6240\u4ee5\u66f4\u96be\u7406\u89e3\u4e00\u4e9b\u3002</p>"},{"location":"python-decorator/#property","title":"@ property","text":"<p>\u5728\u4e86\u89e3\u8fd9\u4e2a\u88c5\u9970\u5668\u524d\uff0c\u4f60\u9700\u8981\u77e5\u9053\u5728\u4e0d\u4f7f\u7528\u88c5\u9970\u5668\u600e\u4e48\u5199\u4e00\u4e2a\u5c5e\u6027\u3002</p> <pre><code>def getx(self):\nreturn self._x\ndef setx(self, value):\nself._x = value\ndef delx(self):\ndel self._x# create a property\nx = property(getx, setx, delx, \"I am doc for x property\")\n</code></pre> <p>\u4ee5\u4e0a\u5c31\u662f\u4e00\u4e2aPython\u5c5e\u6027\u7684\u6807\u51c6\u5199\u6cd5\uff0c\u5176\u5b9e\u548cJava\u633a\u50cf\u7684\uff0c\u80fd\u8fbe\u5230\u4e00\u6837\u7684\u6548\u679c\u4f46\u770b\u8d77\u6765\u66f4\u7b80\u5355\u3002</p> <pre><code>@property\ndef x(self): ...\n# \u7b49\u540c\u4e8e\ndef x(self): ...\nx = property(x)\n</code></pre> <p>\u5c5e\u6027\u6709\u4e09\u4e2a\u88c5\u9970\u5668\uff1a <code>setter</code> , <code>getter</code> , <code>deleter</code> \uff0c\u90fd\u662f\u5728 <code>property ()</code> \u7684\u57fa\u7840\u4e0a\u505a\u4e86\u4e00\u4e9b\u5c01\u88c5\uff0c\u56e0\u4e3a <code>setter</code> \u548c <code>deleter</code> \u662f <code>property ()</code> \u7684\u7b2c\u4e8c\u548c\u7b2c\u4e09\u4e2a\u53c2\u6570\uff0c<code>getter</code> \u88c5\u9970\u5668\u548c\u4e0d\u5e26 <code>getter</code> \u7684\u5c5e\u6027\u88c5\u9970\u5668\u6548\u679c\u662f\u4e00\u6837\u7684\uff0c\u4f30\u8ba1\u53ea\u662f\u4e3a\u4e86\u51d1\u6570\uff0c\u672c\u8eab\u6ca1\u6709\u4efb\u4f55\u5b58\u5728\u7684\u610f\u4e49\u3002\u7ecf\u8fc7 <code>@ property</code> \u88c5\u9970\u8fc7\u7684\u51fd\u6570\u8fd4\u56de\u7684\u4e0d\u518d\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u800c\u662f\u4e00\u4e2a <code>property</code> \u5bf9\u8c61\u3002</p> <pre><code>&gt;&gt;&gt; property()\n&lt;property object at 0x10ff07940 &gt;\n</code></pre>"},{"location":"python-decorator/#classmethod","title":"@ classmethod","text":"<p>\u6709\u4e86 <code>@ property</code> \u88c5\u9970\u5668\u7684\u4e86\u89e3\uff0c\u8fd9\u4e24\u4e2a\u88c5\u9970\u5668\u7684\u539f\u7406\u662f\u5dee\u4e0d\u591a\u7684\u3002 <code>@ staticmethod</code> \u8fd4\u56de\u7684\u662f\u4e00\u4e2a <code>staticmethod</code> \u7c7b\u5bf9\u8c61\uff0c\u800c <code>@ classmethod</code> \u8fd4\u56de\u7684\u662f\u4e00\u4e2a <code>classmethod</code> \u7c7b\u5bf9\u8c61\u3002\u4ed6\u4eec\u90fd\u662f\u8c03\u7528\u7684\u662f\u5404\u81ea\u7684 <code>__init__ ()</code> \u6784\u9020\u51fd\u6570\u3002</p> <pre><code>class classmethod(object):\n\"\"\"\n   classmethod(function) -&gt; method\n   \"\"\"\ndef __init__(self, function):  # for @classmethod decorator\npass\n# ...\nclass staticmethod(object):\n\"\"\"\n   staticmethod(function) -&gt; method\n   \"\"\"\ndef __init__(self, function):  # for @staticmethod decorator\npass\n# ...\nclass Foo(object):\n@staticmethod\ndef bar():\npass\n# \u7b49\u540c\u4e8e bar = staticmethod(bar)\n</code></pre> <p>\u81f3\u6b64\uff0c\u6211\u4eec\u4e0a\u6587\u63d0\u5230\u7684\u88c5\u9970\u5668\u63a5\u53e3\u5b9a\u4e49\u53ef\u4ee5\u66f4\u52a0\u660e\u786e\u4e00\u4e9b\uff0c\u88c5\u9970\u5668\u5fc5\u987b\u63a5\u53d7\u4e00\u4e2a callable \u5bf9\u8c61\uff0c\u5176\u5b9e\u5b83\u5e76\u4e0d\u5173\u5fc3\u4f60\u8fd4\u56de\u4ec0\u4e48\uff0c\u53ef\u4ee5\u662f\u53e6\u5916\u4e00\u4e2a callable \u5bf9\u8c61\uff08\u5927\u90e8\u5206\u60c5\u51b5\uff09\uff0c\u4e5f\u53ef\u4ee5\u662f\u5176\u4ed6\u7c7b\u5bf9\u8c61\uff0c\u6bd4\u5982 property \u3002</p>"},{"location":"python-decorator/#_7","title":"\u88c5\u9970\u5668\u91cc\u7684\u90a3\u4e9b\u5751","text":"<p>\u88c5\u9970\u5668\u53ef\u4ee5\u8ba9\u4f60\u4ee3\u7801\u66f4\u52a0\u4f18\u96c5\uff0c\u51cf\u5c11\u91cd\u590d\uff0c\u4f46\u4e5f\u4e0d\u5168\u662f\u4f18\u70b9\uff0c\u4e5f\u4f1a\u5e26\u6765\u4e00\u4e9b\u95ee\u9898\u3002</p>"},{"location":"python-decorator/#_8","title":"\u4f4d\u7f6e\u9519\u8bef\u7684\u4ee3\u7801","text":"<p>\u8ba9\u6211\u4eec\u76f4\u63a5\u770b\u793a\u4f8b\u4ee3\u7801\u3002</p> <pre><code>def html_tags(tag_name):\nprint 'begin outer function.'\ndef wrapper_(func):\nprint \"begin of inner wrapper function.\"\ndef wrapper(*args, **kwargs):\ncontent = func(*args, **kwargs)            \nprint \"&lt;{tag}&gt;{content}&lt;/{tag}&gt;\".format(tag=tag_name, content=content)               print 'end of inner wrapper function.'\nreturn wrapper    \nprint 'end of outer function'\nreturn wrapper_@html_tags('b')\ndef hello(name='Toby'):\nreturn 'Hello {}!'.format(name)\nhello()\nhello()\n</code></pre> <p>\u5728\u88c5\u9970\u5668\u4e2d\u6211\u5728\u5404\u4e2a\u53ef\u80fd\u7684\u4f4d\u7f6e\u90fd\u52a0\u4e0a\u4e86 print \u8bed\u53e5\uff0c\u7528\u4e8e\u8bb0\u5f55\u88ab\u8c03\u7528\u7684\u60c5\u51b5\u3002\u4f60\u77e5\u9053\u4ed6\u4eec\u6700\u540e\u6253\u5370\u51fa\u6765\u7684\u987a\u5e8f\u5417\uff1f\u5982\u679c\u4f60\u5fc3\u91cc\u6ca1\u5e95\uff0c\u90a3\u4e48\u6700\u597d\u4e0d\u8981\u5728\u88c5\u9970\u5668\u51fd\u6570\u4e4b\u5916\u6dfb\u52a0\u903b\u8f91\u529f\u80fd\uff0c\u5426\u5219\u8fd9\u4e2a\u88c5\u9970\u5668\u5c31\u4e0d\u53d7\u4f60\u63a7\u5236\u4e86\u3002\u4ee5\u4e0b\u662f\u8f93\u51fa\u7ed3\u679c\uff1a</p> <pre><code>begin outer function.\nend of outer function\nbegin of inner wrapper function.\nend of inner wrapper function.\n&lt;b &gt; Hello Toby!&lt; /b &gt;\n&lt;b &gt; Hello Toby!&lt; /b &gt;\n</code></pre>"},{"location":"python-decorator/#_9","title":"\u9519\u8bef\u7684\u51fd\u6570\u7b7e\u540d\u548c\u6587\u6863","text":"<p>\u88c5\u9970\u5668\u88c5\u9970\u8fc7\u7684\u51fd\u6570\u770b\u4e0a\u53bb\u540d\u5b57\u6ca1\u53d8\uff0c\u5176\u5b9e\u5df2\u7ecf\u53d8\u4e86\u3002</p> <pre><code>def logging(func):\ndef wrapper(*args, **kwargs):\n\"\"\"print log before a function.\"\"\"\nprint \"[DEBUG] {}: enter {}()\".format(datetime.now(), func.__name__)        \nreturn func(*args, **kwargs)    \nreturn wrapper\n@logging\ndef say(something):\n\"\"\"say something\"\"\"\nprint \"say {}!\".format(something)\nprint say.__name__  # wrapper\n</code></pre> <p>\u4e3a\u4ec0\u4e48\u4f1a\u8fd9\u6837\u5462\uff1f@\u7b49\u540c\u4e8e\u8fd9\u6837\u7684\u5199\u6cd5\u3002</p> <pre><code>say = logging(say)\n</code></pre> <p><code>logging</code> \u5176\u5b9e\u8fd4\u56de\u7684\u51fd\u6570\u540d\u5b57\u521a\u597d\u662f <code>wrapper</code> \uff0c\u90a3\u4e48\u4e0a\u9762\u7684\u8fd9\u4e2a\u8bed\u53e5\u521a\u597d\u5c31\u662f\u628a\u8fd9\u4e2a\u7ed3\u679c\u8d4b\u503c\u7ed9 <code>say</code> \uff0c <code>say</code> \u7684 <code>__name__</code> \u81ea\u7136\u4e5f\u5c31\u662f <code>wrapper</code> \u4e86\uff0c\u4e0d\u4ec5\u4ec5\u662f <code>name</code> \uff0c\u5176\u4ed6\u5c5e\u6027\u4e5f\u90fd\u662f\u6765\u81ea <code>wrapper</code> \uff0c\u6bd4\u5982 <code>doc</code> \uff0c <code>source</code> \u7b49\u7b49\u3002</p> <p>\u4f7f\u7528\u6807\u51c6\u5e93\u91cc\u7684 functools.wraps \uff0c\u53ef\u4ee5\u57fa\u672c\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <pre><code>from functools import wrapsdef logging(func):\n@wraps(func)\ndef wrapper(*args, **kwargs):\n\"\"\"print log before a function.\"\"\"\nprint \"[DEBUG] {}: enter {}()\".format(datetime.now(), func.__name__)        \nreturn func(*args, **kwargs)    \nreturn wrapper\n@logging\ndef say(something):\n\"\"\"say something\"\"\"\nprint \"say {}!\".format(something)\nprint say.__name__  # say\nprint say.__doc__  # say something\n</code></pre> <p>\u770b\u4e0a\u53bb\u4e0d\u9519\uff01\u4e3b\u8981\u95ee\u9898\u89e3\u51b3\u4e86\uff0c\u4f46\u5176\u5b9e\u8fd8\u4e0d\u592a\u5b8c\u7f8e\u3002\u56e0\u4e3a\u51fd\u6570\u7684\u7b7e\u540d\u548c\u6e90\u7801\u8fd8\u662f\u62ff\u4e0d\u5230\u7684\u3002</p> <pre><code>import inspect\nprint inspect.getargspec(say)  # failed\nprint inspect.getsource(say)  # failed\n</code></pre> <p>\u5982\u679c\u8981\u5f7b\u5e95\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u53ef\u4ee5\u501f\u7528\u7b2c\u4e09\u65b9\u5305\uff0c\u6bd4\u5982 <code>wrapt</code> \u3002\u540e\u6587\u6709\u4ecb\u7ecd\u3002</p>"},{"location":"python-decorator/#staticmethod-classmethod","title":"\u4e0d\u80fd\u88c5\u9970@staticmethod \u6216\u8005 @classmethod","text":"<p>\u5f53\u4f60\u60f3\u628a\u88c5\u9970\u5668\u7528\u5728\u4e00\u4e2a\u9759\u6001\u65b9\u6cd5\u6216\u8005\u7c7b\u65b9\u6cd5\u65f6\uff0c\u4e0d\u597d\u610f\u601d\uff0c\u62a5\u9519\u4e86\u3002</p> <pre><code>class Car(object):\ndef __init__(self, model):\nself.model = model    \n@logging  # \u88c5\u9970\u5b9e\u4f8b\u65b9\u6cd5\uff0cOK\ndef run(self):\nprint \"{} is running!\".format(self.model)    \n@logging  # \u88c5\u9970\u9759\u6001\u65b9\u6cd5\uff0cFailed\n@staticmethod\ndef check_model_for(obj):\nif isinstance(obj, Car):            \nprint \"The model of your car is {}\".format(obj.model)        \nelse:            \nprint \"{} is not a car!\".format(obj)     \n\"\"\"\nTraceback (most recent call last):\n...\n File \"example_4.py\", line 10, in logging\n   @wraps(func)\n File \"C:\\Python27\\lib\\functools.py\", line 33, in update_wrapper\n   setattr(wrapper, attr, getattr(wrapped, attr))\nAttributeError: 'staticmethod' object has no attribute '__module__'\n\"\"\"\n</code></pre> <p>\u524d\u9762\u5df2\u7ecf\u89e3\u91ca\u4e86 <code>@ staticmethod</code> \u8fd9\u4e2a\u88c5\u9970\u5668\uff0c\u5176\u5b9e\u5b83\u8fd4\u56de\u7684\u5e76\u4e0d\u662f\u4e00\u4e2a <code>callable</code> \u5bf9\u8c61\uff0c\u800c\u662f\u4e00\u4e2a <code>staticmethod</code> \u5bf9\u8c61\uff0c\u90a3\u4e48\u5b83\u662f\u4e0d\u7b26\u5408\u88c5\u9970\u5668\u8981\u6c42\u7684\uff08\u6bd4\u5982\u4f20\u5165\u4e00\u4e2a callable \u5bf9\u8c61\uff09\uff0c\u4f60\u81ea\u7136\u4e0d\u80fd\u5728\u5b83\u4e4b\u4e0a\u518d\u52a0\u522b\u7684\u88c5\u9970\u5668\u3002\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5f88\u7b80\u5355\uff0c\u53ea\u8981\u628a\u4f60\u7684\u88c5\u9970\u5668\u653e\u5728 <code>@ staticmethod</code> \u4e4b\u524d\u5c31\u597d\u4e86\uff0c\u56e0\u4e3a\u4f60\u7684\u88c5\u9970\u5668\u8fd4\u56de\u7684\u8fd8\u662f\u4e00\u4e2a\u6b63\u5e38\u7684\u51fd\u6570\uff0c\u7136\u540e\u518d\u52a0\u4e0a\u4e00\u4e2a <code>@ staticmethod</code> \u662f\u4e0d\u4f1a\u51fa\u95ee\u9898\u7684\u3002</p> <pre><code>class Car(object):\ndef __init__(self, model):\nself.model = model    \n@staticmethod\n@logging  \ndef check_model_for(obj):\npass\n</code></pre>"},{"location":"python-decorator/#_10","title":"\u5982\u4f55\u4f18\u5316\u4f60\u7684\u88c5\u9970\u5668","text":"<p>\u5d4c\u5957\u7684\u88c5\u9970\u51fd\u6570\u4e0d\u592a\u76f4\u89c2\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u7b2c\u4e09\u65b9\u5305\u7c7b\u6539\u8fdb\u8fd9\u6837\u7684\u60c5\u51b5\uff0c\u8ba9\u88c5\u9970\u5668\u51fd\u6570\u53ef\u8bfb\u6027\u66f4\u597d\u3002</p>"},{"location":"python-decorator/#decoratorpy","title":"decorator.py","text":"<p><code>decorator.py</code>\u662f\u4e00\u4e2a\u975e\u5e38\u7b80\u5355\u7684\u88c5\u9970\u5668\u52a0\u5f3a\u5305\u3002\u4f60\u53ef\u4ee5\u5f88\u76f4\u89c2\u7684\u5148\u5b9a\u4e49\u5305\u88c5\u51fd\u6570 <code>wrapper ()</code> \uff0c\u518d\u4f7f\u7528 <code>decorate ( func , wrapper )</code> \u65b9\u6cd5\u5c31\u53ef\u4ee5\u5b8c\u6210\u4e00\u4e2a\u88c5\u9970\u5668\u3002</p> <pre><code>from decorator import decorate\ndef wrapper(func, *args, **kwargs):\n\"\"\"print log before a function.\"\"\"\nprint \"[DEBUG] {}: enter {}()\".format(datetime.now(), func.__name__)    \nreturn func(*args, **kwargs)\ndef logging(func):\nreturn decorate(func, wrapper)  # \u7528wrapper\u88c5\u9970func\n</code></pre> <p>\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5b83\u81ea\u5e26\u7684 <code>@ decorator</code> \u88c5\u9970\u5668\u6765\u5b8c\u6210\u4f60\u7684\u88c5\u9970\u5668\u3002</p> <pre><code>from decorator import decorator\n@decorator\ndef logging(func, *args, **kwargs):\nprint \"[DEBUG] {}: enter {}()\".format(datetime.now(), func.__name__)    \nreturn func(*args, **kwargs)\n</code></pre> <p><code>decorator.py</code> \u5b9e\u73b0\u7684\u88c5\u9970\u5668\u80fd\u5b8c\u6574\u4fdd\u7559\u539f\u51fd\u6570\u7684 <code>name</code> \uff0c <code>doc</code> \u548c <code>args</code> \uff0c\u552f\u4e00\u6709\u95ee\u9898\u7684\u5c31\u662f <code>inspect.getsource ( func )</code> \u8fd4\u56de\u7684\u8fd8\u662f\u88c5\u9970\u5668\u7684\u6e90\u4ee3\u7801\uff0c\u4f60\u9700\u8981\u6539\u6210 <code>inspect.getsource ( func.__wrapped__ )</code> \u3002</p>"},{"location":"python-decorator/#wrapt","title":"wrapt","text":"<p><code>wrapt</code>\u662f\u4e00\u4e2a\u529f\u80fd\u975e\u5e38\u5b8c\u5584\u7684\u5305\uff0c\u7528\u4e8e\u5b9e\u73b0\u5404\u79cd\u4f60\u60f3\u5230\u6216\u8005\u4f60\u6ca1\u60f3\u5230\u7684\u88c5\u9970\u5668\u3002\u4f7f\u7528 wrapt \u5b9e\u73b0\u7684\u88c5\u9970\u5668\u4f60\u4e0d\u9700\u8981\u62c5\u5fc3\u4e4b\u524d inspect \u4e2d\u9047\u5230\u7684\u6240\u6709\u95ee\u9898\uff0c\u56e0\u4e3a\u5b83\u90fd\u5e2e\u4f60\u5904\u7406\u4e86\uff0c\u751a\u81f3 <code>inspect.getsource ( func )</code> \u4e5f\u51c6\u786e\u65e0\u8bef\u3002</p> <pre><code>import wrapt# without argument in decorator\n@wrapt.decorator\ndef logging(wrapped, instance, args, kwargs):  # instance is must\nprint \"[DEBUG]: enter {}()\".format(wrapped.__name__)    \nreturn wrapped(*args, **kwargs)\n@logging\ndef say(something): pass\n</code></pre> <p>\u4f7f\u7528 <code>wrapt</code> \u4f60\u53ea\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u88c5\u9970\u5668\u51fd\u6570\uff0c\u4f46\u662f\u51fd\u6570\u7b7e\u540d\u662f\u56fa\u5b9a\u7684\uff0c\u5fc5\u987b\u662f <code>( wrapped , instance, args, kwargs )</code> \uff0c\u6ce8\u610f\u7b2c\u4e8c\u4e2a\u53c2\u6570 <code>instance</code> \u662f\u5fc5\u987b\u7684\uff0c\u5c31\u7b97\u4f60\u4e0d\u7528\u5b83\u3002\u5f53\u88c5\u9970\u5668\u88c5\u9970\u5728\u4e0d\u540c\u4f4d\u7f6e\u65f6\u5b83\u5c06\u5f97\u5230\u4e0d\u540c\u7684\u503c\uff0c\u6bd4\u5982\u88c5\u9970\u5728\u7c7b\u5b9e\u4f8b\u65b9\u6cd5\u65f6\u4f60\u53ef\u4ee5\u62ff\u5230\u8fd9\u4e2a\u7c7b\u5b9e\u4f8b\u3002\u6839\u636e <code>instance</code> \u7684\u503c\u4f60\u80fd\u591f\u66f4\u52a0\u7075\u6d3b\u7684\u8c03\u6574\u4f60\u7684\u88c5\u9970\u5668\u3002\u53e6\u5916\uff0c <code>args</code> \u548c <code>kwargs</code> \u4e5f\u662f\u56fa\u5b9a\u7684\uff0c\u6ce8\u610f\u524d\u9762\u6ca1\u6709\u661f\u53f7\u3002\u5728\u88c5\u9970\u5668\u5185\u90e8\u8c03\u7528\u539f\u51fd\u6570\u65f6\u624d\u5e26\u661f\u53f7\u3002</p> <p>\u5982\u679c\u4f60\u9700\u8981\u4f7f\u7528 wrapt \u5199\u4e00\u4e2a\u5e26\u53c2\u6570\u7684\u88c5\u9970\u5668\uff0c\u53ef\u4ee5\u8fd9\u6837\u5199\u3002</p> <pre><code>def logging(level):\n@wrapt.decorator\ndef wrapper(wrapped, instance, args, kwargs):\nprint \"[{}]: enter {}()\".format(level, wrapped.__name__)        \nreturn wrapped(*args, **kwargs)    \nreturn wrapper@logging(level=\"INFO\")\ndef do(work): pass\n</code></pre> <p>\u5173\u4e8e wrapt \u7684\u4f7f\u7528\uff0c\u5efa\u8bae\u67e5\u9605\u5b98\u65b9\u6587\u6863\uff0c\u5728\u6b64\u4e0d\u5728\u8d58\u8ff0\u3002 http://wrapt.readthedocs.io/en/latest/quick-start.html</p>"},{"location":"python-decorator/#_11","title":"\u5c0f\u7ed3","text":"<p>Python \u7684\u88c5\u9970\u5668\u548c Java \u7684\u6ce8\u89e3\uff08 Annotation \uff09\u5e76\u4e0d\u662f\u540c\u4e00\u56de\u4e8b\uff0c\u548c C# \u4e2d\u7684\u7279\u6027\uff08 Attribute \uff09\u4e5f\u4e0d\u4e00\u6837\uff0c\u5b8c\u5168\u662f\u4e24\u4e2a\u6982\u5ff5\u3002</p> <p>\u88c5\u9970\u5668\u7684\u7406\u5ff5\u662f\u5bf9\u539f\u51fd\u6570\u3001\u5bf9\u8c61\u7684\u52a0\u5f3a\uff0c\u76f8\u5f53\u4e8e\u91cd\u65b0\u5c01\u88c5\uff0c\u6240\u4ee5\u4e00\u822c\u88c5\u9970\u5668\u51fd\u6570\u90fd\u88ab\u547d\u540d\u4e3a <code>wrapper ()</code> \uff0c\u610f\u4e49\u5728\u4e8e\u5305\u88c5\u3002\u51fd\u6570\u53ea\u6709\u5728\u88ab\u8c03\u7528\u65f6\u624d\u4f1a\u53d1\u6325\u5176\u4f5c\u7528\u3002\u6bd4\u5982 <code>@ logging</code> \u88c5\u9970\u5668\u53ef\u4ee5\u5728\u51fd\u6570\u6267\u884c\u65f6\u989d\u5916\u8f93\u51fa\u65e5\u5fd7\uff0c <code>@ cache</code> \u88c5\u9970\u8fc7\u7684\u51fd\u6570\u53ef\u4ee5\u7f13\u5b58\u8ba1\u7b97\u7ed3\u679c\u7b49\u7b49\u3002</p> <p>\u800c\u6ce8\u89e3\u548c\u7279\u6027\u5219\u662f\u5bf9\u76ee\u6807\u51fd\u6570\u6216\u5bf9\u8c61\u6dfb\u52a0\u4e00\u4e9b\u5c5e\u6027\uff0c\u76f8\u5f53\u4e8e\u5c06\u5176\u5206\u7c7b\u3002\u8fd9\u4e9b\u5c5e\u6027\u53ef\u4ee5\u901a\u8fc7\u53cd\u5c04\u62ff\u5230\uff0c\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u5bf9\u4e0d\u540c\u7684\u7279\u6027\u51fd\u6570\u6216\u5bf9\u8c61\u52a0\u4ee5\u5e72\u9884\u3002\u6bd4\u5982\u5e26\u6709 <code>Setup</code> \u7684\u51fd\u6570\u5c31\u5f53\u6210\u51c6\u5907\u6b65\u9aa4\u6267\u884c\uff0c\u6216\u8005\u627e\u5230\u6240\u6709\u5e26\u6709 <code>TestMethod</code> \u7684\u51fd\u6570\u4f9d\u6b21\u6267\u884c\u7b49\u7b49\u3002</p> <p>\u81f3\u6b64\u6211\u6240\u4e86\u89e3\u7684\u88c5\u9970\u5668\u5df2\u7ecf\u8bb2\u5b8c\uff0c\u4f46\u662f\u8fd8\u6709\u4e00\u4e9b\u5185\u5bb9\u6ca1\u6709\u63d0\u5230\uff0c\u6bd4\u5982\u88c5\u9970\u7c7b\u7684\u88c5\u9970\u5668\u3002\u6709\u673a\u4f1a\u518d\u8865\u5145\u3002\u8c22\u8c22\u89c2\u770b\u3002</p> <p>\u672c\u6587\u6e90\u7801 &lt;https://github.com/tobyqin/python_decorator</p>"},{"location":"python-dunder/","title":"Python\u4e2d\u4e0b\u5212\u7ebf\u76845\u79cd\u542b\u4e49","text":"<p>\u672c\u6587\u4ecb\u7ecd\u4e86Python\u4e2d\u5355\u4e0b\u5212\u7ebf\u548c\u53cc\u4e0b\u5212\u7ebf\uff08\"dunder\"\uff09\u7684\u5404\u79cd\u542b\u4e49\u548c\u547d\u540d\u7ea6\u5b9a\uff0c\u540d\u79f0\u4fee\u9970\uff08name mangling\uff09\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u4ee5\u53ca\u5b83\u5982\u4f55\u5f71\u54cd\u4f60\u81ea\u5df1\u7684Python\u7c7b\u3002</p> <p>\u5355\u4e0b\u5212\u7ebf\u548c\u53cc\u4e0b\u5212\u7ebf\u5728Python\u53d8\u91cf\u548c\u65b9\u6cd5\u540d\u79f0\u4e2d\u90fd\u5404\u6709\u5176\u542b\u4e49\u3002\u6709\u4e00\u4e9b\u542b\u4e49\u4ec5\u4ec5\u662f\u4f9d\u7167\u7ea6\u5b9a\uff0c\u88ab\u89c6\u4f5c\u662f\u5bf9\u7a0b\u5e8f\u5458\u7684\u63d0\u793a - \u800c\u6709\u4e00\u4e9b\u542b\u4e49\u662f\u7531Python\u89e3\u91ca\u5668\u4e25\u683c\u6267\u884c\u7684\u3002</p> <p>\u5982\u679c\u4f60\u60f3\u77e5\u9053\u201cPython\u53d8\u91cf\u548c\u65b9\u6cd5\u540d\u79f0\u4e2d\u5355\u4e0b\u5212\u7ebf\u548c\u53cc\u4e0b\u5212\u7ebf\u7684\u542b\u4e49\u662f\u4ec0\u4e48\uff1f\u201d\uff0c\u6211\u4f1a\u5c3d\u6211\u6240\u80fd\u5728\u8fd9\u91cc\u4e3a\u4f60\u89e3\u7b54\u3002</p> <p>\u5728\u672c\u6587\u4e2d\uff0c\u6211\u5c06\u8ba8\u8bba\u4ee5\u4e0b\u4e94\u79cd\u4e0b\u5212\u7ebf\u6a21\u5f0f\u548c\u547d\u540d\u7ea6\u5b9a\uff0c\u4ee5\u53ca\u5b83\u4eec\u5982\u4f55\u5f71\u54cdPython\u7a0b\u5e8f\u7684\u884c\u4e3a\uff1a</p> <ul> <li>\u5355\u524d\u5bfc\u4e0b\u5212\u7ebf\uff1a_var</li> <li>\u5355\u672b\u5c3e\u4e0b\u5212\u7ebf\uff1avar_</li> <li>\u53cc\u524d\u5bfc\u4e0b\u5212\u7ebf\uff1a__var</li> <li>\u53cc\u524d\u5bfc\u548c\u672b\u5c3e\u4e0b\u5212\u7ebf\uff1a__var__</li> <li>\u5355\u4e0b\u5212\u7ebf\uff1a_</li> </ul> <p>\u5728\u6587\u7ae0\u7ed3\u5c3e\u5904\uff0c\u4f60\u53ef\u4ee5\u627e\u5230\u4e00\u4e2a\u7b80\u77ed\u7684\u201c\u901f\u67e5\u8868\u201d\uff0c\u603b\u7ed3\u4e86\u4e94\u79cd\u4e0d\u540c\u7684\u4e0b\u5212\u7ebf\u547d\u540d\u7ea6\u5b9a\u53ca\u5176\u542b\u4e49\uff0c\u4ee5\u53ca\u4e00\u4e2a\u7b80\u77ed\u7684\u89c6\u9891\u6559\u7a0b\uff0c\u53ef\u8ba9\u4f60\u4eb2\u8eab\u4f53\u9a8c\u5b83\u4eec\u7684\u884c\u4e3a\u3002</p>"},{"location":"python-dunder/#1-_var","title":"1. \u5355\u524d\u5bfc\u4e0b\u5212\u7ebf _var","text":"<p>\u5f53\u6d89\u53ca\u5230\u53d8\u91cf\u548c\u65b9\u6cd5\u540d\u79f0\u65f6\uff0c\u5355\u4e2a\u4e0b\u5212\u7ebf\u524d\u7f00\u6709\u4e00\u4e2a\u7ea6\u5b9a\u4fd7\u6210\u7684\u542b\u4e49\u3002 \u5b83\u662f\u5bf9\u7a0b\u5e8f\u5458\u7684\u4e00\u4e2a\u63d0\u793a - \u610f\u5473\u7740Python\u793e\u533a\u4e00\u81f4\u8ba4\u4e3a\u5b83\u5e94\u8be5\u662f\u4ec0\u4e48\u610f\u601d\uff0c\u4f46\u7a0b\u5e8f\u7684\u884c\u4e3a\u4e0d\u53d7\u5f71\u54cd\u3002</p> <p>\u4e0b\u5212\u7ebf\u524d\u7f00\u7684\u542b\u4e49\u662f\u544a\u77e5\u5176\u4ed6\u7a0b\u5e8f\u5458\uff1a\u4ee5\u5355\u4e2a\u4e0b\u5212\u7ebf\u5f00\u5934\u7684\u53d8\u91cf\u6216\u65b9\u6cd5\u4ec5\u4f9b\u5185\u90e8\u4f7f\u7528\u3002 \u8be5\u7ea6\u5b9a\u5728PEP 8\u4e2d\u6709\u5b9a\u4e49\u3002</p> <p>\u8fd9\u4e0d\u662fPython\u5f3a\u5236\u89c4\u5b9a\u7684\u3002 Python\u4e0d\u50cfJava\u90a3\u6837\u5728\u201c\u79c1\u6709\u201d\u548c\u201c\u516c\u5171\u201d\u53d8\u91cf\u4e4b\u95f4\u6709\u5f88\u5f3a\u7684\u533a\u522b\u3002 \u8fd9\u5c31\u50cf\u6709\u4eba\u63d0\u51fa\u4e86\u4e00\u4e2a\u5c0f\u5c0f\u7684\u4e0b\u5212\u7ebf\u8b66\u544a\u6807\u5fd7\uff0c\u8bf4\uff1a</p> <p>\u201c\u563f\uff0c\u8fd9\u4e0d\u662f\u771f\u7684\u8981\u6210\u4e3a\u7c7b\u7684\u516c\u5171\u63a5\u53e3\u7684\u4e00\u90e8\u5206\u3002\u4e0d\u53bb\u7ba1\u5b83\u5c31\u597d\u3002\u201c \u770b\u770b\u4e0b\u9762\u7684\u4f8b\u5b50\uff1a</p> <pre><code>class Test:\ndef __init__(self):\nself.foo = 11\nself._bar = 23\n</code></pre> <p>\u5982\u679c\u4f60\u5b9e\u4f8b\u5316\u6b64\u7c7b\uff0c\u5e76\u5c1d\u8bd5\u8bbf\u95ee\u5728__init__\u6784\u9020\u51fd\u6570\u4e2d\u5b9a\u4e49\u7684foo\u548c_bar\u5c5e\u6027\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\u60c5\u51b5\uff1f \u8ba9\u6211\u4eec\u6765\u770b\u770b\uff1a</p> <pre><code>&gt;&gt;&gt; t = Test()\n&gt;&gt;&gt; t.foo\n11\n&gt;&gt;&gt; t._bar\n23\n</code></pre> <p>\u4f60\u4f1a\u770b\u5230_bar\u4e2d\u7684\u5355\u4e2a\u4e0b\u5212\u7ebf\u5e76\u6ca1\u6709\u963b\u6b62\u6211\u4eec\u201c\u8fdb\u5165\u201d\u7c7b\u5e76\u8bbf\u95ee\u8be5\u53d8\u91cf\u7684\u503c\u3002 \u8fd9\u662f\u56e0\u4e3aPython\u4e2d\u7684\u5355\u4e2a\u4e0b\u5212\u7ebf\u524d\u7f00\u4ec5\u4ec5\u662f\u4e00\u4e2a\u7ea6\u5b9a - \u81f3\u5c11\u76f8\u5bf9\u4e8e\u53d8\u91cf\u548c\u65b9\u6cd5\u540d\u800c\u8a00\u3002</p> <p>\u4f46\u662f\uff0c\u524d\u5bfc\u4e0b\u5212\u7ebf\u7684\u786e\u4f1a\u5f71\u54cd\u4ece\u6a21\u5757\u4e2d\u5bfc\u5165\u540d\u79f0\u7684\u65b9\u5f0f\u3002 </p> <p>\u5047\u8bbe\u4f60\u5728\u4e00\u4e2a\u540d\u4e3amy_module\u7684\u6a21\u5757\u4e2d\u6709\u4ee5\u4e0b\u4ee3\u7801\uff1a</p> <pre><code># This is my_module.py:\ndef external_func():\nreturn 23\ndef _internal_func():\nreturn 42\n</code></pre> <p>\u73b0\u5728\uff0c\u5982\u679c\u4f7f\u7528\u901a\u914d\u7b26\u4ece\u6a21\u5757\u4e2d\u5bfc\u5165\u6240\u6709\u540d\u79f0\uff0c\u5219Python\u4e0d\u4f1a\u5bfc\u5165\u5e26\u6709\u524d\u5bfc\u4e0b\u5212\u7ebf\u7684\u540d\u79f0\uff08\u9664\u975e\u6a21\u5757\u5b9a\u4e49\u4e86\u8986\u76d6\u6b64\u884c\u4e3a\u7684__all__\u5217\u8868\uff09\uff1a</p> <pre><code>&gt;&gt;&gt; from my_module import *\n&gt;&gt;&gt; external_func()\n23\n&gt;&gt;&gt; _internal_func()\nNameError: \"name '_internal_func' is not defined\"\n</code></pre> <p>\u987a\u4fbf\u8bf4\u4e00\u4e0b\uff0c\u5e94\u8be5\u907f\u514d\u901a\u914d\u7b26\u5bfc\u5165\uff0c\u56e0\u4e3a\u5b83\u4eec\u4f7f\u540d\u79f0\u7a7a\u95f4\u4e2d\u5b58\u5728\u54ea\u4e9b\u540d\u79f0\u4e0d\u6e05\u695a\u3002 \u4e3a\u4e86\u6e05\u695a\u8d77\u89c1\uff0c\u575a\u6301\u5e38\u89c4\u5bfc\u5165\u66f4\u597d\u3002 \u4e0e\u901a\u914d\u7b26\u5bfc\u5165\u4e0d\u540c\uff0c\u5e38\u89c4\u5bfc\u5165\u4e0d\u53d7\u524d\u5bfc\u5355\u4e2a\u4e0b\u5212\u7ebf\u547d\u540d\u7ea6\u5b9a\u7684\u5f71\u54cd\uff1a</p> <pre><code>&gt;&gt;&gt; import my_module\n&gt;&gt;&gt; my_module.external_func()\n23\n&gt;&gt;&gt; my_module._internal_func()\n42\n</code></pre> <p>\u6211\u77e5\u9053\u8fd9\u4e00\u70b9\u53ef\u80fd\u6709\u70b9\u4ee4\u4eba\u56f0\u60d1\u3002 \u5982\u679c\u4f60\u9075\u5faaPEP 8\u63a8\u8350\uff0c\u907f\u514d\u901a\u914d\u7b26\u5bfc\u5165\uff0c\u90a3\u4e48\u4f60\u771f\u6b63\u9700\u8981\u8bb0\u4f4f\u7684\u53ea\u6709\u8fd9\u4e2a\uff1a</p> <p>\u5355\u4e2a\u4e0b\u5212\u7ebf\u662f\u4e00\u4e2aPython\u547d\u540d\u7ea6\u5b9a\uff0c\u8868\u793a\u8fd9\u4e2a\u540d\u79f0\u662f\u4f9b\u5185\u90e8\u4f7f\u7528\u7684\u3002 \u5b83\u901a\u5e38\u4e0d\u7531Python\u89e3\u91ca\u5668\u5f3a\u5236\u6267\u884c\uff0c\u4ec5\u4ec5\u4f5c\u4e3a\u4e00\u79cd\u5bf9\u7a0b\u5e8f\u5458\u7684\u63d0\u793a\u3002</p>"},{"location":"python-dunder/#2-var_","title":"2. \u5355\u672b\u5c3e\u4e0b\u5212\u7ebf var_","text":"<p>\u6709\u65f6\u5019\uff0c\u4e00\u4e2a\u53d8\u91cf\u7684\u6700\u5408\u9002\u7684\u540d\u79f0\u5df2\u7ecf\u88ab\u4e00\u4e2a\u5173\u952e\u5b57\u6240\u5360\u7528\u3002 \u56e0\u6b64\uff0c\u50cfclass\u6216def\u8fd9\u6837\u7684\u540d\u79f0\u4e0d\u80fd\u7528\u4f5cPython\u4e2d\u7684\u53d8\u91cf\u540d\u79f0\u3002 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u4ee5\u9644\u52a0\u4e00\u4e2a\u4e0b\u5212\u7ebf\u6765\u89e3\u51b3\u547d\u540d\u51b2\u7a81\uff1a</p> <pre><code>&gt;&gt;&gt; def make_object(name, class):\nSyntaxError: \"invalid syntax\"\n&gt;&gt;&gt; def make_object(name, class_):\npass\n</code></pre> <p>\u603b\u4e4b\uff0c\u5355\u4e2a\u672b\u5c3e\u4e0b\u5212\u7ebf\uff08\u540e\u7f00\uff09\u662f\u4e00\u4e2a\u7ea6\u5b9a\uff0c\u7528\u6765\u907f\u514d\u4e0ePython\u5173\u952e\u5b57\u4ea7\u751f\u547d\u540d\u51b2\u7a81\u3002 PEP 8\u89e3\u91ca\u4e86\u8fd9\u4e2a\u7ea6\u5b9a\u3002</p>"},{"location":"python-dunder/#3-__var","title":"3. \u53cc\u524d\u5bfc\u4e0b\u5212\u7ebf __var","text":"<p>\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u6211\u4eec\u6240\u6d89\u53ca\u7684\u6240\u6709\u547d\u540d\u6a21\u5f0f\u7684\u542b\u4e49\uff0c\u6765\u81ea\u4e8e\u5df2\u8fbe\u6210\u5171\u8bc6\u7684\u7ea6\u5b9a\u3002 \u800c\u5bf9\u4e8e\u4ee5\u53cc\u4e0b\u5212\u7ebf\u5f00\u5934\u7684Python\u7c7b\u7684\u5c5e\u6027\uff08\u5305\u62ec\u53d8\u91cf\u548c\u65b9\u6cd5\uff09\uff0c\u60c5\u51b5\u5c31\u6709\u70b9\u4e0d\u540c\u4e86\u3002</p> <p>\u53cc\u4e0b\u5212\u7ebf\u524d\u7f00\u4f1a\u5bfc\u81f4Python\u89e3\u91ca\u5668\u91cd\u5199\u5c5e\u6027\u540d\u79f0\uff0c\u4ee5\u907f\u514d\u5b50\u7c7b\u4e2d\u7684\u547d\u540d\u51b2\u7a81\u3002</p> <p>\u8fd9\u4e5f\u53eb\u505a\u540d\u79f0\u4fee\u9970\uff08name mangling\uff09 - \u89e3\u91ca\u5668\u66f4\u6539\u53d8\u91cf\u7684\u540d\u79f0\uff0c\u4ee5\u4fbf\u5728\u7c7b\u88ab\u6269\u5c55\u7684\u65f6\u5019\u4e0d\u5bb9\u6613\u4ea7\u751f\u51b2\u7a81\u3002 \u6211\u77e5\u9053\u8fd9\u542c\u8d77\u6765\u5f88\u62bd\u8c61\u3002 \u56e0\u6b64\uff0c\u6211\u7ec4\u5408\u4e86\u4e00\u4e2a\u5c0f\u5c0f\u7684\u4ee3\u7801\u793a\u4f8b\u6765\u4e88\u4ee5\u8bf4\u660e\uff1a</p> <p><pre><code>class Test:\ndef __init__(self):\nself.foo = 11\nself._bar = 23\nself.__baz = 23\n</code></pre> \u8ba9\u6211\u4eec\u7528\u5185\u7f6e\u7684dir()\u51fd\u6570\u6765\u770b\u770b\u8fd9\u4e2a\u5bf9\u8c61\u7684\u5c5e\u6027\uff1a</p> <pre><code>&gt;&gt;&gt; t = Test()\n&gt;&gt;&gt; dir(t)\n['_Test__baz', '__class__', '__delattr__', '__dict__', '__dir__',\n'__doc__', '__eq__', '__format__', '__ge__', '__getattribute__',\n'__gt__', '__hash__', '__init__', '__le__', '__lt__', '__module__',\n'__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__',\n'__setattr__', '__sizeof__', '__str__', '__subclasshook__',\n'__weakref__', '_bar', 'foo']\n</code></pre> <p>\u4ee5\u4e0a\u662f\u8fd9\u4e2a\u5bf9\u8c61\u5c5e\u6027\u7684\u5217\u8868\u3002 \u8ba9\u6211\u4eec\u6765\u770b\u770b\u8fd9\u4e2a\u5217\u8868\uff0c\u5e76\u5bfb\u627e\u6211\u4eec\u7684\u539f\u59cb\u53d8\u91cf\u540d\u79f0foo\uff0c_bar\u548c__baz - \u6211\u4fdd\u8bc1\u4f60\u4f1a\u6ce8\u610f\u5230\u4e00\u4e9b\u6709\u8da3\u7684\u53d8\u5316\u3002   - self.foo\u53d8\u91cf\u5728\u5c5e\u6027\u5217\u8868\u4e2d\u663e\u793a\u4e3a\u672a\u4fee\u6539\u4e3afoo\u3002   - self._bar\u7684\u884c\u4e3a\u65b9\u5f0f\u76f8\u540c - \u5b83\u4ee5_bar\u7684\u5f62\u5f0f\u663e\u793a\u5728\u7c7b\u4e0a\u3002 \u5c31\u50cf\u6211\u4e4b\u524d\u8bf4\u8fc7\u7684\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u524d\u5bfc\u4e0b\u5212\u7ebf\u4ec5\u4ec5\u662f\u4e00\u4e2a\u7ea6\u5b9a\u3002 \u7ed9\u7a0b\u5e8f\u5458\u4e00\u4e2a\u63d0\u793a\u800c\u5df2\u3002   - \u7136\u800c\uff0c\u5bf9\u4e8eself.__baz\u800c\u8a00\uff0c\u60c5\u51b5\u770b\u8d77\u6765\u6709\u70b9\u4e0d\u540c\u3002 \u5f53\u4f60\u5728\u8be5\u5217\u8868\u4e2d\u641c\u7d22__baz\u65f6\uff0c\u4f60\u4f1a\u770b\u4e0d\u5230\u6709\u8fd9\u4e2a\u540d\u5b57\u7684\u53d8\u91cf\u3002</p> <p>__baz\u51fa\u4ec0\u4e48\u60c5\u51b5\u4e86\uff1f</p> <p>\u5982\u679c\u4f60\u4ed4\u7ec6\u89c2\u5bdf\uff0c\u4f60\u4f1a\u770b\u5230\u6b64\u5bf9\u8c61\u4e0a\u6709\u4e00\u4e2a\u540d\u4e3a_Test__baz\u7684\u5c5e\u6027\u3002 \u8fd9\u5c31\u662fPython\u89e3\u91ca\u5668\u6240\u505a\u7684\u540d\u79f0\u4fee\u9970\u3002 \u5b83\u8fd9\u6837\u505a\u662f\u4e3a\u4e86\u9632\u6b62\u53d8\u91cf\u5728\u5b50\u7c7b\u4e2d\u88ab\u91cd\u5199\u3002</p> <p>\u8ba9\u6211\u4eec\u521b\u5efa\u53e6\u4e00\u4e2a\u6269\u5c55Test\u7c7b\u7684\u7c7b\uff0c\u5e76\u5c1d\u8bd5\u91cd\u5199\u6784\u9020\u51fd\u6570\u4e2d\u6dfb\u52a0\u7684\u73b0\u6709\u5c5e\u6027\uff1a</p> <p><pre><code>class ExtendedTest(Test):\ndef __init__(self):\nsuper().__init__()\nself.foo = 'overridden'\nself._bar = 'overridden'\nself.__baz = 'overridden'\n</code></pre> \u73b0\u5728\uff0c\u4f60\u8ba4\u4e3afoo\uff0c_bar\u548c__baz\u7684\u503c\u4f1a\u51fa\u73b0\u5728\u8fd9\u4e2aExtendedTest\u7c7b\u7684\u5b9e\u4f8b\u4e0a\u5417\uff1f \u6211\u4eec\u6765\u770b\u4e00\u770b\uff1a</p> <p><pre><code>&gt;&gt;&gt; t2 = ExtendedTest()\n&gt;&gt;&gt; t2.foo\n'overridden'\n&gt;&gt;&gt; t2._bar\n'overridden'\n&gt;&gt;&gt; t2.__baz\nAttributeError: \"'ExtendedTest' object has no attribute '__baz'\"\n</code></pre> \u7b49\u4e00\u4e0b\uff0c\u5f53\u6211\u4eec\u5c1d\u8bd5\u67e5\u770bt2 .__ baz\u7684\u503c\u65f6\uff0c\u4e3a\u4ec0\u4e48\u6211\u4eec\u4f1a\u5f97\u5230AttributeError\uff1f \u540d\u79f0\u4fee\u9970\u88ab\u518d\u6b21\u89e6\u53d1\u4e86\uff01 \u4e8b\u5b9e\u8bc1\u660e\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u751a\u81f3\u6ca1\u6709__baz\u5c5e\u6027\uff1a</p> <p><pre><code>&gt;&gt;&gt; dir(t2)\n['_ExtendedTest__baz', '_Test__baz', '__class__', '__delattr__',\n'__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__',\n'__getattribute__', '__gt__', '__hash__', '__init__', '__le__',\n'__lt__', '__module__', '__ne__', '__new__', '__reduce__',\n'__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__',\n'__subclasshook__', '__weakref__', '_bar', 'foo', 'get_vars']\n</code></pre> \u6b63\u5982\u4f60\u53ef\u4ee5\u770b\u5230__baz\u53d8\u6210_ExtendedTest__baz\u4ee5\u9632\u6b62\u610f\u5916\u4fee\u6539\uff1a</p> <p><pre><code>&gt;&gt;&gt; t2._ExtendedTest__baz\n'overridden'\n</code></pre> \u4f46\u539f\u6765\u7684_Test__baz\u8fd8\u5728\uff1a</p> <p><pre><code>&gt;&gt;&gt; t2._Test__baz\n42\n</code></pre> \u53cc\u4e0b\u5212\u7ebf\u540d\u79f0\u4fee\u9970\u5bf9\u7a0b\u5e8f\u5458\u662f\u5b8c\u5168\u900f\u660e\u7684\u3002 \u4e0b\u9762\u7684\u4f8b\u5b50\u8bc1\u5b9e\u4e86\u8fd9\u4e00\u70b9\uff1a</p> <pre><code>class ManglingTest:\ndef __init__(self):\nself.__mangled = 'hello'\ndef get_mangled(self):\nreturn self.__mangled\n&gt;&gt;&gt; ManglingTest().get_mangled()\n'hello'\n&gt;&gt;&gt; ManglingTest().__mangled\nAttributeError: \"'ManglingTest' object has no attribute '__mangled'\"\n</code></pre> <p>\u540d\u79f0\u4fee\u9970\u662f\u5426\u4e5f\u9002\u7528\u4e8e\u65b9\u6cd5\u540d\u79f0\uff1f \u662f\u7684\uff0c\u4e5f\u9002\u7528\u3002\u540d\u79f0\u4fee\u9970\u4f1a\u5f71\u54cd\u5728\u4e00\u4e2a\u7c7b\u7684\u4e0a\u4e0b\u6587\u4e2d\uff0c\u4ee5\u4e24\u4e2a\u4e0b\u5212\u7ebf\u5b57\u7b26\uff08\"dunders\"\uff09\u5f00\u5934\u7684\u6240\u6709\u540d\u79f0\uff1a</p> <p><pre><code>class MangledMethod:\ndef __method(self):\nreturn 42\ndef call_it(self):\nreturn self.__method()\n&gt;&gt;&gt; MangledMethod().__method()\nAttributeError: \"'MangledMethod' object has no attribute '__method'\"\n&gt;&gt;&gt; MangledMethod().call_it()\n42\n</code></pre> \u8fd9\u662f\u53e6\u4e00\u4e2a\u4e5f\u8bb8\u4ee4\u4eba\u60ca\u8bb6\u7684\u8fd0\u7528\u540d\u79f0\u4fee\u9970\u7684\u4f8b\u5b50\uff1a</p> <pre><code>_MangledGlobal__mangled = 23\nclass MangledGlobal:\ndef test(self):\nreturn __mangled\n&gt;&gt;&gt; MangledGlobal().test()\n23\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u58f0\u660e\u4e86\u4e00\u4e2a\u540d\u4e3a_MangledGlobal__mangled\u7684\u5168\u5c40\u53d8\u91cf\u3002\u7136\u540e\u6211\u5728\u540d\u4e3aMangledGlobal\u7684\u7c7b\u7684\u4e0a\u4e0b\u6587\u4e2d\u8bbf\u95ee\u53d8\u91cf\u3002\u7531\u4e8e\u540d\u79f0\u4fee\u9970\uff0c\u6211\u80fd\u591f\u5728\u7c7b\u7684test()\u65b9\u6cd5\u5185\uff0c\u4ee5__mangled\u6765\u5f15\u7528_MangledGlobal__mangled\u5168\u5c40\u53d8\u91cf\u3002</p> <p>Python\u89e3\u91ca\u5668\u81ea\u52a8\u5c06\u540d\u79f0__mangled\u6269\u5c55\u4e3a_MangledGlobal__mangled\uff0c\u56e0\u4e3a\u5b83\u4ee5\u4e24\u4e2a\u4e0b\u5212\u7ebf\u5b57\u7b26\u5f00\u5934\u3002\u8fd9\u8868\u660e\u540d\u79f0\u4fee\u9970\u4e0d\u662f\u4e13\u95e8\u4e0e\u7c7b\u5c5e\u6027\u5173\u8054\u7684\u3002\u5b83\u9002\u7528\u4e8e\u5728\u7c7b\u4e0a\u4e0b\u6587\u4e2d\u4f7f\u7528\u7684\u4e24\u4e2a\u4e0b\u5212\u7ebf\u5b57\u7b26\u5f00\u5934\u7684\u4efb\u4f55\u540d\u79f0\u3002</p> <p>\u6709\u5f88\u591a\u8981\u5438\u6536\u7684\u5185\u5bb9\u5427\u3002</p> <p>\u8001\u5b9e\u8bf4\uff0c\u8fd9\u4e9b\u4f8b\u5b50\u548c\u89e3\u91ca\u4e0d\u662f\u4ece\u6211\u8111\u5b50\u91cc\u8e66\u51fa\u6765\u7684\u3002\u6211\u4f5c\u4e86\u4e00\u4e9b\u7814\u7a76\u548c\u52a0\u5de5\u624d\u5f04\u51fa\u6765\u3002\u6211\u4e00\u76f4\u4f7f\u7528Python\uff0c\u6709\u5f88\u591a\u5e74\u4e86\uff0c\u4f46\u662f\u50cf\u8fd9\u6837\u7684\u89c4\u5219\u548c\u7279\u6b8a\u60c5\u51b5\u5e76\u4e0d\u603b\u662f\u6d6e\u73b0\u5728\u8111\u6d77\u91cc\u3002</p> <p>\u6709\u65f6\u5019\u7a0b\u5e8f\u5458\u6700\u91cd\u8981\u7684\u6280\u80fd\u662f\u201c\u6a21\u5f0f\u8bc6\u522b\u201d\uff0c\u800c\u4e14\u77e5\u9053\u5728\u54ea\u91cc\u67e5\u9605\u4fe1\u606f\u3002\u5982\u679c\u60a8\u5728\u8fd9\u4e00\u70b9\u4e0a\u611f\u5230\u6709\u70b9\u4e0d\u77e5\u6240\u63aa\uff0c\u8bf7\u4e0d\u8981\u62c5\u5fc3\u3002\u6162\u6162\u6765\uff0c\u8bd5\u8bd5\u8fd9\u7bc7\u6587\u7ae0\u4e2d\u7684\u4e00\u4e9b\u4f8b\u5b50\u3002</p> <p>\u8ba9\u8fd9\u4e9b\u6982\u5ff5\u5b8c\u5168\u6c89\u6d78\u4e0b\u6765\uff0c\u4ee5\u4fbf\u4f60\u80fd\u591f\u7406\u89e3\u540d\u79f0\u4fee\u9970\u7684\u603b\u4f53\u601d\u8def\uff0c\u4ee5\u53ca\u6211\u5411\u60a8\u5c55\u793a\u7684\u4e00\u4e9b\u5176\u4ed6\u7684\u884c\u4e3a\u3002\u5982\u679c\u6709\u4e00\u5929\u4f60\u548c\u5b83\u4eec\u4e0d\u671f\u800c\u9047\uff0c\u4f60\u4f1a\u77e5\u9053\u5728\u6587\u6863\u4e2d\u6309\u4ec0\u4e48\u6765\u67e5\u3002</p>"},{"location":"python-dunder/#4-var","title":"4. \u53cc\u524d\u5bfc\u548c\u53cc\u672b\u5c3e\u4e0b\u5212\u7ebf var","text":"<p>\u4e5f\u8bb8\u4ee4\u4eba\u60ca\u8bb6\u7684\u662f\uff0c\u5982\u679c\u4e00\u4e2a\u540d\u5b57\u540c\u65f6\u4ee5\u53cc\u4e0b\u5212\u7ebf\u5f00\u59cb\u548c\u7ed3\u675f\uff0c\u5219\u4e0d\u4f1a\u5e94\u7528\u540d\u79f0\u4fee\u9970\u3002 \u7531\u53cc\u4e0b\u5212\u7ebf\u524d\u7f00\u548c\u540e\u7f00\u5305\u56f4\u7684\u53d8\u91cf\u4e0d\u4f1a\u88abPython\u89e3\u91ca\u5668\u4fee\u6539\uff1a</p> <pre><code>class PrefixPostfixTest:\ndef __init__(self):\nself.__bam__ = 42\n&gt;&gt;&gt; PrefixPostfixTest().__bam__\n42\n</code></pre> <p>\u4f46\u662f\uff0cPython\u4fdd\u7559\u4e86\u6709\u53cc\u524d\u5bfc\u548c\u53cc\u672b\u5c3e\u4e0b\u5212\u7ebf\u7684\u540d\u79f0\uff0c\u7528\u4e8e\u7279\u6b8a\u7528\u9014\u3002 \u8fd9\u6837\u7684\u4f8b\u5b50\u6709\uff0cinit__\u5bf9\u8c61\u6784\u9020\u51fd\u6570\uff0c\u6216__call --- \u5b83\u4f7f\u5f97\u4e00\u4e2a\u5bf9\u8c61\u53ef\u4ee5\u88ab\u8c03\u7528\u3002 \u8fd9\u4e9bdunder\u65b9\u6cd5\u901a\u5e38\u88ab\u79f0\u4e3a\u795e\u5947\u65b9\u6cd5 - \u4f46Python\u793e\u533a\u4e2d\u7684\u8bb8\u591a\u4eba\uff08\u5305\u62ec\u6211\u81ea\u5df1\uff09\u90fd\u4e0d\u559c\u6b22\u8fd9\u79cd\u65b9\u6cd5\u3002 \u6700\u597d\u907f\u514d\u5728\u81ea\u5df1\u7684\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u4ee5\u53cc\u4e0b\u5212\u7ebf\uff08\u201cdunders\u201d\uff09\u5f00\u5934\u548c\u7ed3\u5c3e\u7684\u540d\u79f0\uff0c\u4ee5\u907f\u514d\u4e0e\u5c06\u6765Python\u8bed\u8a00\u7684\u53d8\u5316\u4ea7\u751f\u51b2\u7a81\u3002</p>"},{"location":"python-dunder/#5-_","title":"5.\u5355\u4e0b\u5212\u7ebf _","text":"<p>\u6309\u7167\u4e60\u60ef\uff0c\u6709\u65f6\u5019\u5355\u4e2a\u72ec\u7acb\u4e0b\u5212\u7ebf\u662f\u7528\u4f5c\u4e00\u4e2a\u540d\u5b57\uff0c\u6765\u8868\u793a\u67d0\u4e2a\u53d8\u91cf\u662f\u4e34\u65f6\u7684\u6216\u65e0\u5173\u7d27\u8981\u7684\u3002 \u4f8b\u5982\uff0c\u5728\u4e0b\u9762\u7684\u5faa\u73af\u4e2d\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u8bbf\u95ee\u6b63\u5728\u8fd0\u884c\u7684\u7d22\u5f15\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u201c_\u201d\u6765\u8868\u793a\u5b83\u53ea\u662f\u4e00\u4e2a\u4e34\u65f6\u503c\uff1a</p> <pre><code>&gt;&gt;&gt; for _ in range(32):\n...    print('Hello, World.')\n</code></pre> <p>\u4f60\u4e5f\u53ef\u4ee5\u5728\u62c6\u5206(unpacking)\u8868\u8fbe\u5f0f\u4e2d\u5c06\u5355\u4e2a\u4e0b\u5212\u7ebf\u7528\u4f5c\u201c\u4e0d\u5173\u5fc3\u7684\u201d\u53d8\u91cf\uff0c\u4ee5\u5ffd\u7565\u7279\u5b9a\u7684\u503c\u3002 \u540c\u6837\uff0c\u8fd9\u4e2a\u542b\u4e49\u53ea\u662f\u201c\u4f9d\u7167\u7ea6\u5b9a\u201d\uff0c\u5e76\u4e0d\u4f1a\u5728Python\u89e3\u91ca\u5668\u4e2d\u89e6\u53d1\u7279\u6b8a\u7684\u884c\u4e3a\u3002 \u5355\u4e2a\u4e0b\u5212\u7ebf\u4ec5\u4ec5\u662f\u4e00\u4e2a\u6709\u6548\u7684\u53d8\u91cf\u540d\u79f0\uff0c\u4f1a\u6709\u8fd9\u4e2a\u7528\u9014\u800c\u5df2\u3002 \u5728\u4e0b\u9762\u7684\u4ee3\u7801\u793a\u4f8b\u4e2d\uff0c\u6211\u5c06\u6c7d\u8f66\u5143\u7ec4\u62c6\u5206\u4e3a\u5355\u72ec\u7684\u53d8\u91cf\uff0c\u4f46\u6211\u53ea\u5bf9\u989c\u8272\u548c\u91cc\u7a0b\u503c\u611f\u5174\u8da3\u3002 \u4f46\u662f\uff0c\u4e3a\u4e86\u4f7f\u62c6\u5206\u8868\u8fbe\u5f0f\u6210\u529f\u8fd0\u884c\uff0c\u6211\u9700\u8981\u5c06\u5305\u542b\u5728\u5143\u7ec4\u4e2d\u7684\u6240\u6709\u503c\u5206\u914d\u7ed9\u53d8\u91cf\u3002 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u201c_\u201d\u4f5c\u4e3a\u5360\u4f4d\u7b26\u53d8\u91cf\u53ef\u4ee5\u6d3e\u4e0a\u7528\u573a\uff1a</p> <pre><code>&gt;&gt;&gt; car = ('red', 'auto', 12, 3812.4)\n&gt;&gt;&gt; color, _, _, mileage = car\n&gt;&gt;&gt; color\n'red'\n&gt;&gt;&gt; mileage\n3812.4\n&gt;&gt;&gt; _\n12\n</code></pre> <p>\u9664\u4e86\u7528\u4f5c\u4e34\u65f6\u53d8\u91cf\u4e4b\u5916\uff0c\u201c_\u201d\u662f\u5927\u591a\u6570Python REPL\u4e2d\u7684\u4e00\u4e2a\u7279\u6b8a\u53d8\u91cf\uff0c\u5b83\u8868\u793a\u7531\u89e3\u91ca\u5668\u8bc4\u4f30\u7684\u6700\u8fd1\u4e00\u4e2a\u8868\u8fbe\u5f0f\u7684\u7ed3\u679c\u3002 \u8fd9\u6837\u5c31\u5f88\u65b9\u4fbf\u4e86\uff0c\u6bd4\u5982\u4f60\u53ef\u4ee5\u5728\u4e00\u4e2a\u89e3\u91ca\u5668\u4f1a\u8bdd\u4e2d\u8bbf\u95ee\u5148\u524d\u8ba1\u7b97\u7684\u7ed3\u679c\uff0c\u6216\u8005\uff0c\u4f60\u662f\u5728\u52a8\u6001\u6784\u5efa\u591a\u4e2a\u5bf9\u8c61\u5e76\u4e0e\u5b83\u4eec\u4ea4\u4e92\uff0c\u65e0\u9700\u4e8b\u5148\u7ed9\u8fd9\u4e9b\u5bf9\u8c61\u5206\u914d\u540d\u5b57\uff1a</p> <pre><code>&gt;&gt;&gt; 20 + 3\n23\n&gt;&gt;&gt; _\n23\n&gt;&gt;&gt; print(_)\n23\n&gt;&gt;&gt; list()\n[]\n&gt;&gt;&gt; _.append(1)\n&gt;&gt;&gt; _.append(2)\n&gt;&gt;&gt; _.append(3)\n&gt;&gt;&gt; _\n[1, 2, 3]\n</code></pre> <p>Python\u4e0b\u5212\u7ebf\u547d\u540d\u6a21\u5f0f - \u5c0f\u7ed3 \u4ee5\u4e0b\u662f\u4e00\u4e2a\u7b80\u77ed\u7684\u5c0f\u7ed3\uff0c\u5373\u201c\u901f\u67e5\u8868\u201d\uff0c\u7f57\u5217\u4e86\u6211\u5728\u672c\u6587\u4e2d\u8c08\u5230\u7684\u4e94\u79cdPython\u4e0b\u5212\u7ebf\u6a21\u5f0f\u7684\u542b\u4e49\uff1a</p> <p></p>"},{"location":"python-function/","title":"Python\u4f20\u5165\u53c2\u6570\u7684\u51e0\u79cd\u65b9\u6cd5","text":"<p>Python\u4f20\u5165\u53c2\u6570\u7684\u65b9\u6cd5\u6709\uff1a\u4f4d\u7f6e\u53c2\u6570\u3001\u9ed8\u8ba4\u53c2\u6570\u3001\u53ef\u53d8\u53c2\u6570\u3001\u5173\u952e\u5b57\u53c2\u6570\u3001\u548c\u547d\u540d\u5173\u952e\u5b57\u53c2\u6570\u3001\u4ee5\u53ca\u5404\u79cd\u53c2\u6570\u8c03\u7528\u7684\u7ec4\u5408</p>"},{"location":"python-function/#_1","title":"\u5199\u5728\u524d\u9762","text":"<p>Python\u552f\u4e00\u652f\u6301\u7684\u53c2\u6570\u4f20\u9012\u65b9\u5f0f\u662f\u300e\u5171\u4eab\u4f20\u53c2\u300f\uff08call by sharing\uff09</p> <p>\u591a\u6570\u9762\u5411\u5bf9\u8c61\u8bed\u8a00\u90fd\u91c7\u7528\u8fd9\u4e00\u6a21\u5f0f\uff0c\u5305\u62ecRuby\u3001Smalltalk\u548cJava\uff08Java\u7684\u5f15\u7528\u7c7b\u578b\u662f\u8fd9\u6837\uff0c\u57fa\u672c\u7c7b\u578b\u6309\u503c\u4f20\u9012\uff09</p> <p>\u5171\u4eab\u4f20\u53c2\u662f\u6307\u51fd\u6570\u7684\u5404\u4e2a\u5f62\u5f0f\u53c2\u6570\u83b7\u5f97\u5b9e\u53c2\u4e2d\u5404\u4e2a\u5f15\u7528\u7684\u526f\u672c\uff1b\u4e5f\u5c31\u662f\u8bf4\uff0c\u51fd\u6570\u5185\u90e8\u7684\u5f62\u53c2\u662f\u5b9e\u53c2\u7684\u522b\u540d\uff08alias\uff09</p> <p>\u8fd9\u79cd\u65b9\u6848\u7684\u7ed3\u679c\u662f\uff0c\u51fd\u6570\u53ef\u80fd\u4f1a\u4fee\u6539\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u7684\u53ef\u53d8\u5bf9\u8c61\uff0c\u4f46\u662f\u65e0\u6cd5\u4fee\u6539\u90a3\u4e9b\u5bf9\u8c61\u7684\u6807\u8bc6\uff08\u5373\u4e0d\u80fd\u628a\u4e00\u4e2a\u5bf9\u8c61\u66ff\u6362\u4e3a\u53e6\u4e00\u4e2a\u5bf9\u8c61\uff09</p>"},{"location":"python-function/#_2","title":"\u4f4d\u7f6e\u53c2\u6570","text":"<p>\u4f4d\u7f6e\u53c2\u6570\u662f\u6700\u7b80\u5355\u7684\u4f20\u5165\u53c2\u6570\u7684\u65b9\u5f0f\uff0c\u5728\u5176\u5b83\u7684\u8bed\u8a00\u4e2d\u4e5f\u5e38\u5e38\u88ab\u4f7f\u7528</p>"},{"location":"python-function/#_3","title":"\u6f14\u793a\u4e00\uff1a","text":"<pre><code>def func(a, b):\nprint(a+b)\nfunc(1, 2)  #3\n</code></pre>"},{"location":"python-function/#_4","title":"\u6f14\u793a\u4e8c\uff1a","text":"<pre><code>def power(x, n):\ns = 1\nwhile(n &gt; 0):\nn -= 1\ns *= n\nreturn s\npower(2, 3) #8\n</code></pre>"},{"location":"python-function/#_5","title":"\u9ed8\u8ba4\u53c2\u6570","text":"<p>\u9ed8\u8ba4\u53c2\u6570\u5c31\u662f\u5728\u8c03\u7528\u51fd\u6570\u7684\u65f6\u5019\u4f7f\u7528\u4e00\u4e9b\u5305\u542b\u9ed8\u8ba4\u503c\u7684\u53c2\u6570</p> <pre><code>def power(x, n=2):\ns = 1\nwhile(n &gt; 0):\nn -= 1\ns *= n\nreutrn s\npower(3)    #9\npower(2, 3) #8\n</code></pre>"},{"location":"python-function/#_6","title":"\u5b9a\u4e49\u9ed8\u8ba4\u53c2\u6570\u8981\u7262\u8bb0\u4e00\u70b9\uff1a\u9ed8\u8ba4\u53c2\u6570\u5fc5\u987b\u6307\u5411\u4e0d\u53d8\u5bf9\u8c61\uff01","text":"<pre><code>#\u4ee5\u4e0b\u8fd9\u4e2a\u51fd\u6570\u5982\u679c\u88ab\u591a\u6b21\u8c03\u7528\u4f1a\u5728\u9ed8\u8ba4\u6dfb\u52a0\u591a\u4e2aEND\u5b57\u7b26\u4e32\ndef add_end(l = []):\nl.append('END')\nreturn l\n</code></pre> <pre><code>#\u4e3a\u4e86\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\uff0c\u5e94\u8be5\u628a\u4f20\u5165\u7684\u9ed8\u8ba4\u53c2\u6570\u8bbe\u7f6e\u4e3a\u4e0d\u53ef\u53d8\u7684\ndef add_end(l = None):\nl = []\nl.append('END')\nreturn l\n</code></pre>"},{"location":"python-function/#_7","title":"\u53ef\u53d8\u53c2\u6570","text":"<p>\u53ef\u53d8\u53c2\u6570\u5c31\u662f\u5141\u8bb8\u5728\u8c03\u7528\u53c2\u6570\u7684\u65f6\u5019\u4f20\u5165\u591a\u4e2a\uff08\u22650\u4e2a\uff09\u53c2\u6570\uff08\u7c7b\u4f3c\u4e8e\u5217\u8868\u3001\u5b57\u5178\uff09</p> <pre><code>#\u4f20\u5165\u4e00\u4e2a\u5217\u8868\uff0c\u4e25\u683c\u5730\u8bf4\u8fd9\u4e0d\u662f\u53ef\u53d8\u53c2\u6570\ndef calc(l):\nsum = 0\nfor n in l:\nsum += n\nreturn sum\n&gt;&gt;&gt; calc([1,2,3])\n</code></pre> <pre><code>#\u8fd9\u624d\u662f\u53ef\u53d8\u53c2\u6570\uff0c\u867d\u7136\u5728\u4f7f\u7528\u4e0a\u548c\u5217\u8868\u6ca1\u6709\u533a\u522b\uff0c\u4f46\u662f\u53c2\u6570nums\u63a5\u6536\u5230\u7684\u662f\u4e00\u4e2atuple\uff08\u8fd9\u4e9b\u53c2\u6570\u5728\u4f20\u5165\u65f6\u88ab\u81ea\u52a8\u7ec4\u7ec4\u88c5\u4e3a\u4e00\u4e2a\u5143\u7956\uff09\ndef calc(*nums):\nsum = 0\nfor n in nums:\nsum += n\nreturn sum\n&gt;&gt;&gt; calc(1,2,3)\n7\n&gt;&gt;&gt; my_ls = [1,2,3]\n&gt;&gt;&gt; calc(*my_ls)\n7\n</code></pre>"},{"location":"python-function/#_8","title":"\u5173\u952e\u5b57\u53c2\u6570","text":"<p>\u53ef\u53d8\u53c2\u6570\u5141\u8bb8\u4f20\u51650\u4e2a\uff5e\u591a\u4e2a\u53c2\u6570\uff0c\u800c\u5173\u952e\u5b57\u53c2\u6570\u5141\u8bb8\u5728\u8c03\u7528\u65f6\u4ee5\u5b57\u5178\u5f62\u5f0f\u4f20\u51650\u4e2a\u6216\u591a\u4e2a\u53c2\u6570\uff08\u6ce8\u610f\u533a\u522b\uff0c\u4e00\u4e2a\u662f\u5b57\u5178\u4e00\u4e2a\u662f\u5217\u8868\uff09\uff1b\u5728\u4f20\u9012\u53c2\u6570\u65f6\u7528\u7b49\u53f7\uff08=\uff09\u8fde\u63a5\u952e\u548c\u503c</p> <pre><code>#\u7528\u4e24\u4e2a\u661f\u53f7\u8868\u793a\u5173\u952e\u5b57\u53c2\u6570\ndef person_info(name, age, **kw):\nprint(\"name\", name, \"age\", age, \"other\", kw)\n&gt;&gt;&gt; person_info(\"Xiaoming\", 12)\nname Xiaoming age 12 other{}\n&gt;&gt;&gt; person_info(\"Dahuang\", 35, city = \"Beijing\")\nname Dahuang age 35 other {'city':'Beijing'}\n</code></pre>"},{"location":"python-function/#_9","title":"\u547d\u540d\u5173\u952e\u5b57\u53c2\u6570","text":"<p>\u547d\u540d\u5173\u952e\u5b57\u53c2\u6570\u5728\u5173\u952e\u5b57\u53c2\u6570\u7684\u57fa\u7840\u4e0a\u9650\u5236\u4f20\u5165\u7684\u7684\u5173\u952e\u5b57\u7684\u53d8\u91cf\u540d</p> <p>\u548c\u666e\u901a\u5173\u952e\u5b57\u53c2\u6570\u4e0d\u540c\uff0c\u547d\u540d\u5173\u952e\u5b57\u53c2\u6570\u9700\u8981\u4e00\u4e2a\u7528\u6765\u533a\u5206\u7684\u5206\u9694\u7b26*\uff0c\u5b83\u540e\u9762\u7684\u53c2\u6570\u88ab\u8ba4\u4e3a\u662f\u547d\u540d\u5173\u952e\u5b57\u53c2\u6570</p> <pre><code>#\u8fd9\u91cc\u661f\u53f7\u5206\u5272\u7b26\u540e\u9762\u7684city\u3001job\u662f\u547d\u540d\u5173\u952e\u5b57\u53c2\u6570\nperson_info(name, age, *, city, job):\nprint(name, age, city, job)\n&gt;&gt;&gt; person_info(\"Alex\", 17, city = \"Beijing\", job = \"Engineer\")\nAlex 17 Beijing Engineer    #\u770b\u6765\u8fd9\u91cc\u4e0d\u518d\u88ab\u81ea\u52a8\u7ec4\u88c5\u4e3a\u5b57\u5178\n</code></pre> <p>\u4e0d\u8fc7\u4e5f\u6709\u4f8b\u5916\uff0c\u5982\u679c\u53c2\u6570\u4e2d\u5df2\u7ecf\u6709\u4e00\u4e2a\u53ef\u53d8\u53c2\u6570\u7684\u8bdd\uff0c\u524d\u9762\u8bb2\u7684\u661f\u53f7\u5206\u5272\u7b26\u5c31\u4e0d\u8981\u5199\u4e86\uff08\u5176\u5b9e\u661f\u53f7\u662f\u5199\u7ed9Python\u89e3\u91ca\u5668\u770b\u7684\uff0c\u5982\u679c\u4e00\u4e2a\u661f\u53f7\u4e5f\u6ca1\u6709\u7684\u8bdd\u5c31\u65e0\u6cd5\u533a\u5206\u547d\u540d\u5173\u952e\u5b57\u53c2\u6570\u548c\u4f4d\u7f6e\u53c2\u6570\u4e86\uff0c\u800c\u5982\u679c\u6709\u4e00\u4e2a\u661f\u53f7\u5373\u4f7f\u6765\u81ea\u53d8\u957f\u53c2\u6570\u5c31\u53ef\u4ee5\u533a\u5206\u5f00\u6765\uff09</p> <pre><code>#args\u662f\u53d8\u957f\u53c2\u6570\uff0c\u800ccity\u548cjob\u662f\u547d\u540d\u5173\u952e\u5b57\u53c2\u6570\nperson_info(name, age, *args, city, job):\nprint(name, age, args, city)\n&gt;&gt;&gt; person_info(\"Liqiang\", 43, \"balabala\", city = \"Wuhan\", job = \"Coder\")\nLiqiang 43 balabala Wuhan Coder\n</code></pre>"},{"location":"python-function/#_10","title":"\u53c2\u6570\u7ec4\u5408","text":"<p>\u603b\u7ed3\u4e00\u4e0b\uff0c\u5728Python\u4e2d\u4e00\u79cd\u53ef\u4ee5\u4f7f\u75285\u4e2d\u4f20\u9012\u53c2\u6570\u7684\u65b9\u5f0f\uff08\u4f4d\u7f6e\u53c2\u6570\u3001\u9ed8\u8ba4\u53c2\u6570\u3001\u53d8\u957f\u53c2\u6570\u3001\u5173\u952e\u5b57\u53c2\u6570\u3001\u547d\u540d\u5173\u952e\u5b57\u53c2\u6570\uff09</p> <p>\u6ce8\u610f\uff0c\u8fd9\u4e9b\u53c2\u6570\u5728\u4e66\u5199\u65f6\u8981\u9075\u5faa\u4e00\u5b9a\u7684\u987a\u5e8f\u5373\uff1a\u4f4d\u7f6e\u53c2\u6570\u3001\u9ed8\u8ba4\u53c2\u6570\u3001\u53d8\u957f\u53c2\u6570\u3001\u5173\u952e\u5b57\u53c2\u6570\u3001\u547d\u540d\u5173\u952e\u5b57\u53c2\u6570\uff08\u548c\u672c\u6587\u7684\u884c\u6587\u987a\u5e8f\u4e00\u81f4\uff09</p> <p>\u8fd9\u91cc\u7b80\u5355\u4e3e\u4e24\u4e2a\u6817\u5b50</p> <pre><code>def f1(a, b, c=0, *args, **kw):\nprint(\"a = \", a, \"b = \", b, \"args = \", args, \"kw = \",kw)\ndef f2(a, b, c=0, *, d, **kw):\nprint(\"a = \", a, \"b = \", b, \"c = \", c, \"d = \", d, \"kw = \", kw)\n&gt;&gt;&gt; f1(1, 2)\na = 1 b = 2 c = 0 args =() kw = {}\n&gt;&gt;&gt; f1(1, 2, c=3)\na = 1 b = 2 c = 3 args = () kw = {}\n&gt;&gt;&gt; f1(1, 2, 3, 'a', 'b')\na = 1 b = 2 c = 3 args = ('a', 'b') kw = {}\n&gt;&gt;&gt; f1(1, 2, 3, 'a', 'b', x = 99)\na = 1 b = 2 c = 3 args = ('a', 'b') kw = {'x':99}\n&gt;&gt;&gt; f2(1, 2, d = 99, ext = None)\na = 1 b =2 c = 0 d = 99 kw = {'ext':None}\n</code></pre>"},{"location":"python-function/#_11","title":"\u5199\u5728\u540e\u9762","text":"<p>\u5173\u4e8ePython\u53c2\u6570\u4f20\u9012\uff0c\u6709\u4ee5\u4e0b\u51e0\u70b9\u63d0\u8bf7\u6ce8\u610f\uff1a</p> <ol> <li>\u53c2\u6570\u7684\u4f20\u9012\u662f\u901a\u8fc7\u81ea\u52a8\u5c06\u5bf9\u8c61\u8d4b\u503c\u7ed9\u672c\u5730\u53d8\u91cf\u540d\u6765\u5b9e\u73b0\u7684</li> <li> <p>\u51fd\u6570\u53c2\u6570\u5728\u5b9e\u9645\u4e2d\u53ea\u662fPython\u8d4b\u503c\u7684\u53e6\u4e00\u4e2a\u5b9e\u4f8b\u800c\u5df2\uff0c\u56e0\u4e3a\u5f15\u7528\u53ef\u4ee5\u662f\u4ee5\u6307\u9488\u7684\u5f62\u5f0f\u6765\u5b9e\u73b0\u7684\uff0c\u6240\u6709\u7684\u53c2\u6570\u5b9e\u9645\u4e0a\u90fd\u662f\u901a\u8fc7\u6307\u9488\u8fdb\u884c\u4f20\u9012\u7684\uff0c\u4f5c\u4e3a\u53c2\u6570\u88ab\u4f20\u9012\u7684\u5bf9\u8c61\u4ece\u6765\u4e0d\u81ea\u52a8\u62f7\u8d1d</p> </li> <li> <p>\u5728\u51fd\u6570\u5185\u90e8\u7684\u53c2\u6570\u540d\u7684\u8d4b\u503c\u4e0d\u4f1a\u5f71\u54cd\u8c03\u7528\u8005 </p> </li> <li> <p>\u5728\u51fd\u6570\u8fd0\u884c\u65f6\uff0c\u5728\u51fd\u6570\u5934\u90e8\u7684\u53c2\u6570\u540d\u65f6\u4e00\u4e2a\u65b0\u7684\u3001\u672c\u5730\u7684\u53d8\u91cf\u540d\uff0c\u8fd9\u4e2a\u53d8\u91cf\u540d\u662f\u5728\u51fd\u6570\u7684\u672c\u5730\u4f5c\u7528\u57df\u5185\u7684\uff0c\u51fd\u6570\u53c2\u6570\u540d\u548c\u8c03\u7528\u8005\u4f5c\u7528\u57df\u4e2d\u7684\u53d8\u91cf\u662f\u6ca1\u6709\u533a\u522b\u7684</p> </li> <li> <p>\u6539\u53d8\u51fd\u6570\u7684\u53ef\u53d8\u5bf9\u8c61\u53c2\u6570\u7684\u503c\u4e5f\u8bb8\u4f1a\u5bf9\u8c03\u7528\u8005\u6709\u5f71\u54cd </p> </li> <li>\u6362\u53e5\u8bdd\u8bf4\uff0c\u56e0\u4e3a\u53c2\u6570\u662f\u7b80\u5355\u5730\u8d4b\u503c\u7ed9\u4f20\u5165\u7684\u5bf9\u8c61\uff0c\u51fd\u6570\u5c31\u80fd\u591f\u5c31\u5730\u6539\u53d8\u4f20\u5165\u7684\u53ef\u53d8\u5bf9\u8c61\uff0c\u56e0\u6b64\u5176\u7ed3\u679c\u4f1a\u5f71\u54cd\u8c03\u7528\u8005\uff1b\u53ef\u53d8\u53c2\u6570\u5bf9\u51fd\u6570\u6765\u8bf4\u53ef\u4ee5\u505a\u8f93\u5165\u548c\u8f93\u51fa\u7684</li> </ol>"},{"location":"python-function/#pythoncc","title":"Python\u7684\u901a\u8fc7\u8d4b\u503c\u8fdb\u884c\u4f20\u9012\u7684\u673a\u5236\u4e0eC++\u7684\u5f15\u7528\u53c2\u6570\u9009\u9879\u4e0d\u5b8c\u5168\u76f8\u540c\uff0c\u4f46\u662f\u5b9e\u9645\u4e2d\uff0c\u5b83\u4e0eC\u8bed\u8a00\u7684\u53c2\u6570\u4f20\u9012\u6a21\u578b\u76f8\u5f53\u7c7b\u4f3c\uff1a","text":"<ol> <li>\u4e0d\u53ef\u53d8\u53c2\u6570\u201c\u901a\u8fc7\u503c\u201d\u8fdb\u884c\u4f20\u9012 </li> <li> <p>\u50cf\u6574\u6570\u548c\u5b57\u7b26\u4e32\u8fd9\u6837\u7684\u5bf9\u8c61\u662f\u4e0d\u53ef\u53d8\u5bf9\u8c61\uff0c\u5b83\u4eec\u901a\u8fc7\u5bf9\u8c61\u5f15\u7528\u800c\u4e0d\u662f\u62f7\u8d1d\u8fdb\u884c\u4f20\u9012\u7684\uff0c\u4f46\u662f\u56e0\u4e3a\u65e0\u8bba\u5982\u4f55\u90fd\u4e0d\u53ef\u80fd\u5728\u539f\u5904\u6539\u53d8\u4e0d\u53ef\u53d8\u5bf9\u8c61\uff0c\u5b9e\u9645\u7684\u6548\u679c\u5c31\u5f88\u50cf\u521b\u5efa\u4e86\u4e00\u4efd\u62f7\u8d1d</p> </li> <li> <p>\u53ef\u53d8\u5bf9\u8c61\u662f\u901a\u8fc7\u201c\u6307\u9488\u201d\u8fdb\u884c\u4f20\u9012\u7684 </p> </li> <li>\u5217\u8868\u548c\u5b57\u5178\u8fd9\u6837\u7684\u5bf9\u8c61\u4e5f\u662f\u901a\u8fc7\u5bf9\u8c61\u5f15\u7528\u8fdb\u884c\u4f20\u9012\u7684\uff0c\u8fd9\u4e00\u70b9\u4e0eC\u8bed\u8a00\u4f7f\u7528\u6307\u9488\u4f20\u9012\u6570\u7ec4\u5f88\u76f8\u4f3c\uff0c\u53ef\u53d8\u5bf9\u8c61\u80fd\u591f\u5728\u51fd\u6570\u5185\u90e8\u8fdb\u884c\u539f\u5904\u7684\u6539\u53d8\uff0c\u8fd9\u4e00\u70b9\u548cC\u6570\u7ec4\u5f88\u50cf</li> </ol> <p> </p>"},{"location":"python-mysql/","title":"python \u64cd\u4f5c mysql\u57fa\u7840\u8865\u5145","text":"<p>\u8001\u4e86\u8001\u4e86\uff0c\u8bb0\u4e0d\u4f4f\u4e86\u3002 http://www.cnblogs.com/wenchengxiaopenyou/p/5701899.html</p>"},{"location":"python-mysql/#_1","title":"\u524d\u8a00","text":"<p>\u672c\u7bc7\u7684\u4e3b\u8981\u5185\u5bb9\u4e3a\u6574\u7406mysql\u7684\u57fa\u7840\u5185\u5bb9\uff0c\u5206\u4eab\u7684\u540c\u65f6\u65b9\u4fbf\u65e5\u540e\u67e5\u9605\uff0c\u540c\u65f6\u7ed3\u5408python\u7684\u5b66\u4e60\u6574\u7406python\u64cd\u4f5cmysql\u7684\u65b9\u6cd5\u4ee5\u53capython\u7684ORM\u3002</p>"},{"location":"python-mysql/#_2","title":"\u4e00.\u6570\u636e\u5e93\u521d\u63a2","text":"<pre><code>\u5728\u5f00\u59cbmysql\u4e4b\u524d\u5148\u4e86\u89e3\u4e0b\u4ec0\u4e48\u662f\u6570\u636e\u5e93\uff1a\n\u6570\u636e\u5e93\uff08Database\uff09\u662f\u6309\u7167\u6570\u636e\u7ed3\u6784\u6765\u7ec4\u7ec7\u3001\u5b58\u50a8\u548c\u7ba1\u7406\u6570\u636e\u7684\u4ed3\u5e93\uff0c\u5b83\u4ea7\u751f\u4e8e\u8ddd\u4eca\u516d\u5341\u591a\u5e74\u524d\uff0c\u968f\u7740\u4fe1\u606f\u6280\u672f\u548c\u5e02\u573a\u7684\u53d1\u5c55\uff0c\u7279\u522b\u662f\u4e8c\u5341\u4e16\u7eaa\u4e5d\u5341\u5e74\u4ee3\u4ee5\u540e\uff0c\u6570\u636e\u7ba1\u7406\u4e0d\u518d\u4ec5\u4ec5\u662f\u5b58\u50a8\u548c\u7ba1\u7406\u6570\u636e\uff0c\u800c\u8f6c\u53d8\u6210\u7528\u6237\u6240\u9700\u8981\u7684\u5404\u79cd\u6570\u636e\u7ba1\u7406\u7684\u65b9\u5f0f\u3002\u6570\u636e\u5e93\u6709\u5f88\u591a\u79cd\u7c7b\u578b\uff0c\u4ece\u6700\u7b80\u5355\u7684\u5b58\u50a8\u6709\u5404\u79cd\u6570\u636e\u7684\u8868\u683c\u5230\u80fd\u591f\u8fdb\u884c\u6d77\u91cf\u6570\u636e\u5b58\u50a8\u7684\u5927\u578b\u6570\u636e\u5e93\u7cfb\u7edf\u90fd\u5728\u5404\u4e2a\u65b9\u9762\u5f97\u5230\u4e86\u5e7f\u6cdb\u7684\u5e94\u7528\u3002\n\u901a\u4fd7\u7684\u8bb2\u6570\u636e\u5e93\u5c31\u662f\u8bb2\u6570\u636e\u4fdd\u5b58\u5728\u6587\u4ef6\u6216\u8005\u5185\u5b58\u4e2d\uff0c\u63a5\u6536\u7279\u5b9a\u7684\u547d\u4ee4\u7136\u540e\u5bf9\u6587\u4ef6\u8fdb\u884c\u64cd\u4f5c\uff0c\u800c\u6570\u636e\u5e93\u5c31\u662f\u4e00\u4e2a\u5de5\u5177\u5b83\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u53bb\u7ba1\u7406\u8fd9\u4e9b\u6587\u4ef6\u5939\u6216\u8005\u6587\u4ef6\uff0c\u6211\u95e8\u53ea\u9700\u8981\u901a\u8fc7\u547d\u4ee4\u7684\u65b9\u5f0f\u544a\u8bc9\u4ed6\u4eec\u53bb\u6267\u884c\u5c31\u884c\u4e86\u3002\n\n\u90a3\u4e48mysql\u53c8\u662f\u4ec0\u4e48\u5462\uff1f\n\nMySQL\u662f\u4e00\u4e2a\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u7531\u745e\u5178MySQL AB \u516c\u53f8\u5f00\u53d1\uff0c\u76ee\u524d\u5c5e\u4e8e Oracle \u65d7\u4e0b\u516c\u53f8\u3002MySQL \u6700\u6d41\u884c\u7684\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u5728 WEB \u5e94\u7528\u65b9\u9762MySQL\u662f\u6700\u597d\u7684 RDBMS (Relational Database Management System\uff0c\u5173\u7cfb\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf) \u5e94\u7528\u8f6f\u4ef6\u4e4b\u4e00\u3002 \u4e0emysql\u76f8\u7c7b\u4f3c\u529f\u80fd\u7684\u6570\u636e\u5e93\u8fd8\u6709\uff1aMySQL\u3001Oracle\u3001SQLite\u3001Access\u3001MS SQL Server\u7b49\n\n\u518d\u4e86\u89e3\u4e0b\u4ec0\u4e48\u662fSQL\uff1a\n\nSQL\u662fStructured Query Language(\u7ed3\u6784\u5316\u67e5\u8be2\u8bed\u8a00)\u7684\u7f29\u5199\u3002SQL\u662f\u4e13\u4e3a\u6570\u636e\u5e93\u800c\u5efa\u7acb\u7684\u64cd\u4f5c\u547d\u4ee4\u96c6\uff0c\u662f\u4e00\u79cd\u529f\u80fd\u9f50\u5168\u7684\u6570\u636e\u5e93\u8bed\u8a00\u3002\u5728\u4f7f\u7528\u5b83\u65f6\uff0c\u53ea\u9700\u8981\u53d1\u51fa\u201c\u505a\u4ec0\u4e48\u201d\u7684\u547d\u4ee4\uff0c\u201c\u600e\u4e48\u505a\u201d\u662f\u4e0d\u7528\u4f7f\u7528\u8005\u8003\u8651\u7684\u3002SQL\u529f\u80fd\u5f3a\u5927\u3001\u7b80\u5355\u6613\u5b66\u3001\u4f7f\u7528\u65b9\u4fbf\uff0c\u5df2\u7ecf\u6210\u4e3a\u4e86\u6570\u636e\u5e93\u64cd\u4f5c\u7684\u57fa\u7840\uff0c\u5e76\u4e14\u73b0\u5728\u51e0\u4e4e\u6240\u6709\u7684\u6570\u636e\u5e93\u5747\u652f\u6301SQL\u3002\u6b63\u5982\u4e0a\u6587\u63d0\u5230\u7684SQl\u5c31\u662f\u6211\u4eec\u63a7\u5236\u6570\u636e\u5e93\u7684\u65b9\u6cd5\uff0c\u547d\u4ee4\u3002\n</code></pre>"},{"location":"python-mysql/#_3","title":"\u4e09.\u771f\u6b63\u7684\u6570\u636e\u5e93\u64cd\u4f5c\uff1a","text":"<p>1.\u663e\u793a\u6570\u636e\u5e93</p> <p><code>SHOW DATABASES;</code></p> <p>\u5b89\u88c5\u5b8cmysql\u6570\u636e\u5e93\u540e\u9ed8\u8ba4\u6570\u636e\u5e93\u5982\u4e0b\uff1a</p> <ul> <li>mysql - \u7528\u6237\u6743\u9650\u76f8\u5173\u6570\u636e</li> <li>test - \u7528\u4e8e\u7528\u6237\u6d4b\u8bd5\u6570\u636e</li> <li>information_schema - MySQL\u672c\u8eab\u67b6\u6784\u76f8\u5173\u6570\u636e</li> </ul> <p>2.\u4f7f\u7528\u6570\u636e\u5e93 <pre><code>USE db_name;   \uff03\u6307\u5b9a\u8981\u64cd\u4f5c\u7684\u6570\u636e\u5e93\u540d\u5b57\n</code></pre></p> <p>3.\u663e\u793a\u6240\u6709\u8868 <pre><code>SHOW TABLES;\n</code></pre> 4.\u7528\u6237\u6388\u6743</p> <p>\u5728\u7528\u6237\u6388\u6743\u90e8\u5206\u5305\u62ec\uff1a</p> <ul> <li>\u7528\u6237\u7ba1\u7406</li> <li>\u6388\u6743\u7ba1\u7406 </li> </ul> <p>\u7528\u6237\u7ba1\u7406\uff1a <pre><code>\u521b\u5efa\u7528\u6237\n    create user '\u7528\u6237\u540d'@'IP\u5730\u5740' identified by '\u5bc6\u7801';\n\u5220\u9664\u7528\u6237\n    drop user '\u7528\u6237\u540d'@'IP\u5730\u5740';\n\u4fee\u6539\u7528\u6237\n    rename user '\u7528\u6237\u540d'@'IP\u5730\u5740'; to '\u65b0\u7528\u6237\u540d'@'IP\u5730\u5740';\n\u4fee\u6539\u5bc6\u7801\n    set password for '\u7528\u6237\u540d'@'IP\u5730\u5740' = Password('\u65b0\u5bc6\u7801');\n\n\u6ce8\u610f\uff1a\u7528\u6237\u6743\u9650\u76f8\u5173\u6570\u636e\u4fdd\u5b58\u5728\u9ed8\u8ba4\u7684mysql\u6570\u636e\u5e93\u7684user\u8868\u4e2d\uff0c\u867d\u7136\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5bf9\u5176\u8fdb\u884c\u64cd\u4f5c\uff0c\u4f46\u662f\u672a\u6765\u5b89\u5168\u6027\u4e0d\u5efa\u8bae\u90a3\u4e48\u505a\u3002\n</code></pre></p> <p>\u6388\u6743\u7ba1\u7406\uff1a <pre><code>show grants for '\u7528\u6237'@'IP\u5730\u5740'                  -- \u67e5\u770b\u6743\u9650\ngrant  \u6743\u9650 on \u6570\u636e\u5e93.\u8868 to   '\u7528\u6237'@'IP\u5730\u5740'      -- \u6388\u6743\nrevoke \u6743\u9650 on \u6570\u636e\u5e93.\u8868 from '\u7528\u6237'@'IP\u5730\u5740'      -- \u53d6\u6d88\u6743\u9650\n</code></pre></p> <p>\u66f4\u52a0\u8be6\u7ec6\uff1a <pre><code>all privileges  \u9664grant\u5916\u7684\u6240\u6709\u6743\u9650\n            select          \u4ec5\u67e5\u6743\u9650\n            select,insert   \u67e5\u548c\u63d2\u5165\u6743\u9650\n            ...\n            usage                   \u65e0\u8bbf\u95ee\u6743\u9650\n            alter                   \u4f7f\u7528alter table\n            alter routine           \u4f7f\u7528alter procedure\u548cdrop procedure\n            create                  \u4f7f\u7528create table\n            create routine          \u4f7f\u7528create procedure\n            create temporary tables \u4f7f\u7528create temporary tables\n            create user             \u4f7f\u7528create user\u3001drop user\u3001rename user\u548crevoke  all privileges\n            create view             \u4f7f\u7528create view\n            delete                  \u4f7f\u7528delete\n            drop                    \u4f7f\u7528drop table\n            execute                 \u4f7f\u7528call\u548c\u5b58\u50a8\u8fc7\u7a0b\n            file                    \u4f7f\u7528select into outfile \u548c load data infile\n            grant option            \u4f7f\u7528grant \u548c revoke\n            index                   \u4f7f\u7528index\n            insert                  \u4f7f\u7528insert\n            lock tables             \u4f7f\u7528lock table\n            process                 \u4f7f\u7528show full processlist\n            select                  \u4f7f\u7528select\n            show databases          \u4f7f\u7528show databases\n            show view               \u4f7f\u7528show view\n            update                  \u4f7f\u7528update\n            reload                  \u4f7f\u7528flush\n            shutdown                \u4f7f\u7528mysqladmin shutdown(\u5173\u95edMySQL)\n            super                   \udbff\udc42\udbff\udc08\u4f7f\u7528change master\u3001kill\u3001logs\u3001purge\u3001master\u548cset global\u3002\u8fd8\u5141\u8bb8mysqladmin\udbff\udd57\udbff\udd58\udbff\udc8a\udbff\udc8b\u8c03\u8bd5\u767b\u9646\n            replication client      \u670d\u52a1\u5668\u4f4d\u7f6e\u7684\u8bbf\u95ee\n            replication slave       \u7531\u590d\u5236\u4ece\u5c5e\u4f7f\u7528\n\n        \u5bf9\u4e8e\u76ee\u6807\u6570\u636e\u5e93\u4ee5\u53ca\u5185\u90e8\u5176\u4ed6\uff1a\n            \u6570\u636e\u5e93\u540d.*           \u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\n            \u6570\u636e\u5e93\u540d.\u8868          \u6307\u5b9a\u6570\u636e\u5e93\u4e2d\u7684\u67d0\u5f20\u8868\n            \u6570\u636e\u5e93\u540d.\u5b58\u50a8\u8fc7\u7a0b     \u6307\u5b9a\u6570\u636e\u5e93\u4e2d\u7684\u5b58\u50a8\u8fc7\u7a0b\n            *.*                \u6240\u6709\u6570\u636e\u5e93\n\n            \u7528\u6237\u540d@IP\u5730\u5740         \u7528\u6237\u53ea\u80fd\u5728\u6539IP\u4e0b\u624d\u80fd\u8bbf\u95ee\n            \u7528\u6237\u540d@192.168.1.%   \u7528\u6237\u53ea\u80fd\u5728\u6539IP\u6bb5\u4e0b\u624d\u80fd\u8bbf\u95ee(\u901a\u914d\u7b26%\u8868\u793a\u4efb\u610f)\n            \u7528\u6237\u540d@%             \u7528\u6237\u53ef\u4ee5\u518d\u4efb\u610fIP\u4e0b\u8bbf\u95ee(\u9ed8\u8ba4IP\u5730\u5740\u4e3a%)\n</code></pre></p>"},{"location":"python-mysql/#_4","title":"\u56db.\u8868\u64cd\u4f5c","text":"<p>1.\u521b\u5efa\u8868</p> <p><pre><code>create table \u8868\u540d(\n    \u5217\u540d  \u7c7b\u578b  \u662f\u5426\u53ef\u4ee5\u4e3a\u7a7a\uff0c\n    \u5217\u540d  \u7c7b\u578b  \u662f\u5426\u53ef\u4ee5\u4e3a\u7a7a\n)\n</code></pre> * \u662f\u5426\u53ef\u7a7a <pre><code>        \u662f\u5426\u53ef\u7a7a\uff0cnull\u8868\u793a\u7a7a\uff0c\u975e\u5b57\u7b26\u4e32\n            not null    - \u4e0d\u53ef\u7a7a\n            null        - \u53ef\u7a7a\n</code></pre></p> <ul> <li> <p>\u9ed8\u8ba4\u503c <pre><code>        \u9ed8\u8ba4\u503c\uff0c\u521b\u5efa\u5217\u65f6\u53ef\u4ee5\u6307\u5b9a\u9ed8\u8ba4\u503c\uff0c\u5f53\u63d2\u5165\u6570\u636e\u65f6\u5982\u679c\u672a\u4e3b\u52a8\u8bbe\u7f6e\uff0c\u5219\u81ea\u52a8\u6dfb\u52a0\u9ed8\u8ba4\u503c\n            create table tb1(\n                nid int not null defalut 2,\n                num int not null\n            )\n</code></pre></p> </li> <li> <p>\u81ea\u589e <pre><code>\u81ea\u589e\uff0c\u5982\u679c\u4e3a\u67d0\u5217\u8bbe\u7f6e\u81ea\u589e\u5217\uff0c\u63d2\u5165\u6570\u636e\u65f6\u65e0\u9700\u8bbe\u7f6e\u6b64\u5217\uff0c\u9ed8\u8ba4\u5c06\u81ea\u589e\uff08\u8868\u4e2d\u53ea\u80fd\u6709\u4e00\u4e2a\u81ea\u589e\u5217\uff09\n            create table tb1(\n                nid int not null auto_increment primary key,\n                num int null\n            )\n            \u6216\n            create table tb1(\n                nid int not null auto_increment,\n                num int null,\n                index(nid)\n            )\n            \u6ce8\u610f\uff1a1\u3001\u5bf9\u4e8e\u81ea\u589e\u5217\uff0c\u5fc5\u987b\u662f\u7d22\u5f15\uff08\u542b\u4e3b\u952e\uff09\u3002\n                 2\u3001\u5bf9\u4e8e\u81ea\u589e\u53ef\u4ee5\u8bbe\u7f6e\u6b65\u957f\u548c\u8d77\u59cb\u503c\n                     show session variables like 'auto_inc%';\n                     set session auto_increment_increment=2;\n                     set session auto_increment_offset=10;\n\n                     shwo global  variables like 'auto_inc%';\n                     set global auto_increment_increment=2;\n                     set global auto_increment_offset=10;\n</code></pre></p> </li> <li> <p>\u4e3b\u952e <pre><code>\u5916\u952e\uff0c\u4e00\u4e2a\u7279\u6b8a\u7684\u7d22\u5f15\uff0c\u53ea\u80fd\u662f\u6307\u5b9a\u5185\u5bb9\n            creat table color(\n                nid int not null primary key,\n                name char(16) not null\n            )\n\n            create table fruit(\n                nid int not null primary key,\n                smt char(32) null ,\n                color_id int not null,\n                constraint fk_cc foreign key (color_id) references color(nid)\n            )\n</code></pre></p> </li> </ul> <p>2.\u5220\u9664\u8868 <pre><code>drop table \u8868\u540d\n</code></pre></p> <p>3.\u6e05\u7a7a\u8868 <pre><code>delete from \u8868\u540d\ntruncate table \u8868\u540d\n</code></pre></p> <p>4.\u4fee\u6539\u8868 <pre><code>\u6dfb\u52a0\u5217\uff1aalter table \u8868\u540d add \u5217\u540d \u7c7b\u578b\n\u5220\u9664\u5217\uff1aalter table \u8868\u540d drop column \u5217\u540d\n\u4fee\u6539\u5217\uff1a\n        alter table \u8868\u540d modify column \u5217\u540d \u7c7b\u578b;  -- \u7c7b\u578b\n        alter table \u8868\u540d change \u539f\u5217\u540d \u65b0\u5217\u540d \u7c7b\u578b; -- \u5217\u540d\uff0c\u7c7b\u578b\n\n\u6dfb\u52a0\u4e3b\u952e\uff1a\n        alter table \u8868\u540d add primary key(\u5217\u540d);\n\u5220\u9664\u4e3b\u952e\uff1a\n        alter table \u8868\u540d drop primary key;\n        alter table \u8868\u540d  modify  \u5217\u540d int, drop primary key;\n\n\u6dfb\u52a0\u5916\u952e\uff1aalter table \u4ece\u8868 add constraint \u5916\u952e\u540d\u79f0\uff08\u5f62\u5982\uff1aFK_\u4ece\u8868_\u4e3b\u8868\uff09 foreign key \u4ece\u8868(\u5916\u952e\u5b57\u6bb5) references \u4e3b\u8868(\u4e3b\u952e\u5b57\u6bb5);\n\u5220\u9664\u5916\u952e\uff1aalter table \u8868\u540d drop foreign key \u5916\u952e\u540d\u79f0\n\n\u4fee\u6539\u9ed8\u8ba4\u503c\uff1aALTER TABLE testalter_tbl ALTER i SET DEFAULT 1000;\n\u5220\u9664\u9ed8\u8ba4\u503c\uff1aALTER TABLE testalter_tbl ALTER i DROP DEFAULT;\n</code></pre></p>"},{"location":"python-mysql/#mysql","title":"\u4e94.mysql\u7684\u57fa\u672c\u64cd\u4f5c","text":"<p>1.\u589e <pre><code>        insert into \u8868 (\u5217\u540d,\u5217\u540d...) values (\u503c,\u503c,\u503c...)\n        insert into \u8868 (\u5217\u540d,\u5217\u540d...) values (\u503c,\u503c,\u503c...),(\u503c,\u503c,\u503c...)\n        insert into \u8868 (\u5217\u540d,\u5217\u540d...) select (\u5217\u540d,\u5217\u540d...) from \u8868\n</code></pre></p> <p>2.\u5220 <pre><code>        delete from \u8868\n        delete from \u8868 where id\uff1d1 and name\uff1d'zhaowencheng'\n</code></pre></p> <p>3.\u6539 <pre><code>        update \u8868 set name \uff1d 'zhaowencheng' where id&gt;1\n</code></pre></p> <p>4.\u67e5 <pre><code>        select * from \u8868\n        select * from \u8868 where id &gt; 1\n        select nid,name,gender as gg from \u8868 where id &gt; 1\n</code></pre></p> <p>5.\u5176\u5b83 <pre><code>1\u3001\u6761\u4ef6\n        select * from \u8868 where id &gt; 1 and name != 'zhaowencheng' and num = 12;\n\n        select * from \u8868 where id between 5 and 16;\n\n        select * from \u8868 where id in (11,22,33)\n        select * from \u8868 where id not in (11,22,33)\n        select * from \u8868 where id in (select nid from \u8868)\n\n    2\u3001\u901a\u914d\u7b26\n        select * from \u8868 where name like 'zhao%'  - zhao\u5f00\u5934\u7684\u6240\u6709\uff08\u591a\u4e2a\u5b57\u7b26\u4e32\uff09\n        select * from \u8868 where name like 'zhao_'  - zhao\u5f00\u5934\u7684\u6240\u6709\uff08\u4e00\u4e2a\u5b57\u7b26\uff09\n\n    3\u3001\u9650\u5236\n        select * from \u8868 limit 5;            - \u524d5\u884c\n        select * from \u8868 limit 4,5;          - \u4ece\u7b2c4\u884c\u5f00\u59cb\u76845\u884c\n        select * from \u8868 limit 5 offset 4    - \u4ece\u7b2c4\u884c\u5f00\u59cb\u76845\u884c\n\n    4\u3001\u6392\u5e8f\n        select * from \u8868 order by \u5217 asc              - \u6839\u636e \u201c\u5217\u201d \u4ece\u5c0f\u5230\u5927\u6392\u5217\n        select * from \u8868 order by \u5217 desc             - \u6839\u636e \u201c\u5217\u201d \u4ece\u5927\u5230\u5c0f\u6392\u5217\n        select * from \u8868 order by \u52171 desc,\u52172 asc    - \u6839\u636e \u201c\u52171\u201d \u4ece\u5927\u5230\u5c0f\u6392\u5217\uff0c\u5982\u679c\u76f8\u540c\u5219\u6309\u52172\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\n\n    5\u3001\u5206\u7ec4\n        select num from \u8868 group by num\n        select num,nid from \u8868 group by num,nid\n        select num,nid from \u8868  where nid &gt; 10 group by num,nid order nid desc\n        select num,nid,count(*),sum(score),max(score),min(score) from \u8868 group by num,nid\n\n        select num from \u8868 group by num having max(id) &gt; 10\n\n        \u7279\u522b\u7684\uff1agroup by \u5fc5\u987b\u5728where\u4e4b\u540e\uff0corder by\u4e4b\u524d\n\n    6\u3001\u8fde\u8868\n        \u65e0\u5bf9\u5e94\u5173\u7cfb\u5219\u4e0d\u663e\u793a\n        select A.num, A.name, B.name\n        from A,B\n        Where A.nid = B.nid\n\n        \u65e0\u5bf9\u5e94\u5173\u7cfb\u5219\u4e0d\u663e\u793a\n        select A.num, A.name, B.name\n        from A inner join B\n        on A.nid = B.nid\n\n        A\u8868\u6240\u6709\u663e\u793a\uff0c\u5982\u679cB\u4e2d\u65e0\u5bf9\u5e94\u5173\u7cfb\uff0c\u5219\u503c\u4e3anull\n        select A.num, A.name, B.name\n        from A left join B\n        on A.nid = B.nid\n\n        B\u8868\u6240\u6709\u663e\u793a\uff0c\u5982\u679cB\u4e2d\u65e0\u5bf9\u5e94\u5173\u7cfb\uff0c\u5219\u503c\u4e3anull\n        select A.num, A.name, B.name\n        from A right join B\n        on A.nid = B.nid\n\n    7\u3001\u7ec4\u5408\n        \u7ec4\u5408\uff0c\u81ea\u52a8\u5904\u7406\u91cd\u5408\n        select nickname\n        from A\n        union\n        select name\n        from B\n\n        \u7ec4\u5408\uff0c\u4e0d\u5904\u7406\u91cd\u5408\n        select nickname\n        from A\n        union all\n        select name\n        from B\n</code></pre></p>"},{"location":"python-mysql/#pymsql","title":"\u516d.pymsql","text":"<p>1.\u5b89\u88c5pymysql <pre><code>\uff03\u76f4\u63a5pip\u5b89\u88c5\npip3 install pymysql\n</code></pre></p> <p>2.\u4f7f\u7528</p> <ul> <li>\u6267\u884csql</li> </ul> <pre><code>#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport pymysql\n\n# \u521b\u5efa\u8fde\u63a5\nconn = pymysql.connect(host='127.0.0.1', port=3306, user='root', passwd='123', db='t1')\n# \u521b\u5efa\u6e38\u6807\ncursor = conn.cursor()\n\n# \u6267\u884cSQL\uff0c\u5e76\u8fd4\u56de\u6536\u5f71\u54cd\u884c\u6570\neffect_row = cursor.execute(\"update hosts set host = '1.1.1.2'\")\n\n# \u6267\u884cSQL\uff0c\u5e76\u8fd4\u56de\u53d7\u5f71\u54cd\u884c\u6570\n#effect_row = cursor.execute(\"update hosts set host = '1.1.1.2' where nid &gt; %s\", (1,))\n\n# \u6267\u884cSQL\uff0c\u5e76\u8fd4\u56de\u53d7\u5f71\u54cd\u884c\u6570\n#effect_row = cursor.executemany(\"insert into hosts(host,color_id)values(%s,%s)\", [(\"1.1.1.11\",1),(\"1.1.1.11\",2)])\n\n# \u63d0\u4ea4\uff0c\u4e0d\u7136\u65e0\u6cd5\u4fdd\u5b58\u65b0\u5efa\u6216\u8005\u4fee\u6539\u7684\u6570\u636e\nconn.commit()\n\n# \u5173\u95ed\u6e38\u6807\ncursor.close()\n# \u5173\u95ed\u8fde\u63a5\nconn.close()\n</code></pre> <ul> <li>\u83b7\u53d6\u65b0\u521b\u5efa\u6570\u636e\u81ea\u589eID</li> </ul> <pre><code>#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport pymysql\n\nconn = pymysql.connect(host='127.0.0.1', port=3306, user='root', passwd='123', db='t1')\ncursor = conn.cursor()\ncursor.executemany(\"insert into hosts(host,color_id)values(%s,%s)\", [(\"1.1.1.11\",1),(\"1.1.1.11\",2)])\nconn.commit()\ncursor.close()\nconn.close()\n\n# \u83b7\u53d6\u6700\u65b0\u81ea\u589eID\nnew_id = cursor.lastrowid\n</code></pre> <ul> <li>\u83b7\u53d6\u67e5\u8be2\u6570\u636e</li> </ul> <pre><code>#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport pymysql\n\nconn = pymysql.connect(host='127.0.0.1', port=3306, user='root', passwd='123', db='t1')\ncursor = conn.cursor()\ncursor.execute(\"select * from hosts\")\n\n# \u83b7\u53d6\u7b2c\u4e00\u884c\u6570\u636e\nrow_1 = cursor.fetchone()\n\n# \u83b7\u53d6\u524dn\u884c\u6570\u636e\n# row_2 = cursor.fetchmany(3)\n# \u83b7\u53d6\u6240\u6709\u6570\u636e\n# row_3 = cursor.fetchall()\n\nconn.commit()\ncursor.close()\nconn.close()\n\n\u6ce8\uff1a\u5728fetch\u6570\u636e\u65f6\u6309\u7167\u987a\u5e8f\u8fdb\u884c\uff0c\u53ef\u4ee5\u4f7f\u7528cursor.scroll(num,mode)\u6765\u79fb\u52a8\u6e38\u6807\u4f4d\u7f6e\uff0c\u5982\uff1a\ncursor.scroll(1,mode='relative')  # \u76f8\u5bf9\u5f53\u524d\u4f4d\u7f6e\u79fb\u52a8\ncursor.scroll(2,mode='absolute') # \u76f8\u5bf9\u7edd\u5bf9\u4f4d\u7f6e\u79fb\u52a8\n</code></pre> <ul> <li>fetch\u6570\u636e\u7c7b\u578b</li> </ul> <p>\u5173\u4e8e\u9ed8\u8ba4\u83b7\u53d6\u7684\u6570\u636e\u662f\u5143\u7956\u7c7b\u578b\uff0c\u5982\u679c\u60f3\u8981\u6216\u8005\u5b57\u5178\u7c7b\u578b\u7684\u6570\u636e\uff0c\u5373\uff1a <pre><code>#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport pymysql\n\nconn = pymysql.connect(host='127.0.0.1', port=3306, user='root', passwd='123', db='t1')\n\n# \u6e38\u6807\u8bbe\u7f6e\u4e3a\u5b57\u5178\u7c7b\u578b\ncursor = conn.cursor(cursor=pymysql.cursors.DictCursor)\nr = cursor.execute(\"call p1()\")\n\nresult = cursor.fetchone()\n\nconn.commit()\ncursor.close()\nconn.close()\n</code></pre></p>"},{"location":"python-styleguide/","title":"Python \u98ce\u683c\u6307\u5357 - \u5185\u5bb9\u76ee\u5f55","text":"<p>https://zh-google-styleguide.readthedocs.io/en/latest/google-python-styleguide/contents/</p>"},{"location":"python/","title":"python","text":""},{"location":"python/#python-3","title":"Python 3 \u90a3\u4e9b\u975e\u5e38\u89c4\u7684\u6280\u5de7","text":"<ul> <li>\u539f\u6587</li> </ul>"},{"location":"python/#_1","title":"\u5217\u8868\u63a8\u5bfc\u5f0f","text":"<p>\u4f60\u6709\u4e00\u4e2alist\uff1abag = [1, 2, 3, 4, 5]</p> <p>\u73b0\u5728\u4f60\u60f3\u8ba9\u6240\u6709\u5143\u7d20\u7ffb\u500d\uff0c\u8ba9\u5b83\u770b\u8d77\u6765\u662f\u8fd9\u4e2a\u6837\u5b50\uff1a[2, 4, 6, 8, 10]</p> <p>\u5927\u591a\u521d\u5b66\u8005\uff0c\u6839\u636e\u4e4b\u524d\u8bed\u8a00\u7684\u7ecf\u9a8c\u4f1a\u5927\u6982\u8fd9\u6837\u6765\u505a</p> <pre><code>bag = [1, 2, 3, 4, 5]\nfor i in range(len(bag)):\nbag[i] = bag[i] * 2\n</code></pre> <p>\u4f46\u662f\u6709\u66f4\u597d\u7684\u65b9\u6cd5\uff1a</p> <p><code>bag = [elem * 2 for elem in bag]</code></p> <p>\u5f88\u7b80\u6d01\u5bf9\u4e0d\u5bf9\uff1f\u8fd9\u53eb\u505aPython\u7684\u5217\u8868\u63a8\u5bfc\u5f0f\u3002</p> <p>\u70b9\u51fbTrey Hunner\u2019s tutorial[1]\u67e5\u770b\u66f4\u591a\u5173\u4e8e\u5217\u8868\u63a8\u5bfc\u5f0f\u7684\u4ecb\u7ecd\u3002</p>"},{"location":"python/#_2","title":"\u904d\u5386\u5217\u8868","text":"<p>\u7ee7\u7eed\uff0c\u8fd8\u662f\u4e0a\u9762\u7684\u5217\u8868\u3002</p> <p>\u5982\u679c\u53ef\u80fd\u5c3d\u91cf\u907f\u514d\u8fd9\u6837\u505a\uff1a</p> <pre><code>bag = [1, 2, 3, 4, 5]\nfor i in range(len(bag)):\nprint(bag[i])\n</code></pre> <p>\u53d6\u800c\u4ee3\u4e4b\u7684\u5e94\u8be5\u662f\u8fd9\u6837\uff1a</p> <pre><code>bag = [1, 2, 3, 4, 5]\nfor i in bag:\nprint(i)\n</code></pre> <p>\u5982\u679cx\u662f\u4e00\u4e2a\u5217\u8868\uff0c\u4f60\u53ef\u4ee5\u5bf9\u5b83\u7684\u5143\u7d20\u8fdb\u884c\u8fed\u4ee3\u3002\u591a\u6570\u60c5\u51b5\u4e0b\u4f60\u4e0d\u9700\u8981\u5404\u5143\u7d20\u7684\u7d22\u5f15\uff0c\u4f46\u5982\u679c\u4f60\u975e\u8981\u8fd9\u6837\u505a\uff0c\u90a3\u5c31\u7528enumerate\u51fd\u6570\u3002\u5b83\u50cf\u4e0b\u8fb9\u7684\u6837\u5b50\uff1a</p> <pre><code>bag = [1, 2, 3, 4, 5]\nfor index, element in enumerate(bag):\nprint(index, element)\n</code></pre> <p>\u975e\u5e38\u76f4\u89c2\u660e\u4e86\u3002</p>"},{"location":"python/#_3","title":"\u5143\u7d20\u4e92\u6362","text":"<p>\u5982\u679c\u4f60\u662f\u4ecejava\u6216\u8005C\u8bed\u8a00\u8f6c\u5230Python\u6765\uff0c\u53ef\u80fd\u4f1a\u4e60\u60ef\u4e8e\u8fd9\u6837\uff1a</p> <pre><code>a = 5\nb = 10\n\n# \u4ea4\u6362 a \u548c b\n\ntmp = a\na = b\nb = tmp\n</code></pre> <p>\u4f46Python\u63d0\u4f9b\u4e86\u4e00\u4e2a\u66f4\u81ea\u7136\u66f4\u597d\u7684\u65b9\u6cd5\uff01</p> <pre><code>a = 5\nb = 10\n\n# \u4ea4\u6362a \u548c b\n\na, b = b, a\n</code></pre> <p>\u591f\u6f02\u4eae\u5427\uff1f</p>"},{"location":"python/#_4","title":"\u521d\u59cb\u5316\u5217\u8868","text":"<p>\u5047\u5982\u4f60\u8981\u4e00\u4e2a\u662f10\u4e2a\u6574\u65700\u7684\u5217\u8868\uff0c\u4f60\u53ef\u80fd\u9996\u5148\u60f3\u5230\uff1a</p> <pre><code>bag =  \nfor _ in range(10):\nbag.append(0)\n</code></pre> <p>\u6362\u4e2a\u65b9\u5f0f\u5427\uff1a</p> <p><code>bag = [0] * 10</code></p> <p>\u770b\uff0c\u591a\u4f18\u96c5\u3002 \u6ce8\u610f\uff1a\u5982\u679c\u4f60\u5217\u8868\u5305\u542b\u4e86\u5217\u8868\uff0c\u8fd9\u6837\u505a\u4f1a\u4ea7\u751f\u6d45\u62f7\u8d1d\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff1a</p> <pre><code>bag_of_bags = [[0]] * 5 # [[0], [0], [0], [0], [0]]\nbag_of_bags[0][0] = 1 # [[1], [1], [1], [1], [1]]\n</code></pre> <p>Oops\uff01\u6240\u6709\u7684\u5217\u8868\u90fd\u6539\u53d8\u4e86\uff0c\u800c\u6211\u4eec\u53ea\u662f\u60f3\u8981\u6539\u53d8\u7b2c\u4e00\u4e2a\u5217\u8868\u3002</p> <p>\u6539\u4e00\u6539\u5566\uff1a</p> <pre><code>bag_of_bags = [[0] for _ in range(5)]\n# [[0], [0], [0], [0], [0]]\nbag_of_bags[0][0] = 1\n# [[1], [0], [0], [0], [0]]\n</code></pre> <p>\u540c\u65f6\u8bb0\u4f4f\uff1a</p> <p>\u201c\u8fc7\u65e9\u4f18\u5316\u662f\u4e07\u6076\u4e4b\u6e90\u201d</p> <p>\u95ee\u95ee\u81ea\u5df1\uff0c\u521d\u59cb\u5316\u4e00\u4e2a\u5217\u8868\u662f\u5fc5\u987b\u7684\u5417\uff1f</p>"},{"location":"python/#_5","title":"\u6784\u9020\u5b57\u7b26\u4e32","text":"<p>\u4f60\u4f1a\u7ecf\u5e38\u9700\u8981\u6253\u5370\u5b57\u7b26\u4e32\u3002\u8981\u662f\u6709\u5f88\u591a\u53d8\u91cf\uff0c\u907f\u514d\u4e0b\u9762\u8fd9\u6837\uff1a</p> <pre><code>name = \"Raymond\"\nage = 22\nborn_in = \"Oakland, CA\"\nstring = \"Hello my name is \" + name + \"and I'm \" + str(age) + \" years old. I was born in \" + born_in + \".\"\nprint(string)\n</code></pre> <p>\u989d\uff0c\u8fd9\u770b\u8d77\u6765\u591a\u4e71\u5440\uff1f\u4f60\u53ef\u4ee5\u7528\u4e2a\u6f02\u4eae\u7b80\u6d01\u7684\u65b9\u6cd5\u6765\u4ee3\u66ff\uff0c.format\u3002</p> <p>\u8fd9\u6837\u505a\uff1a</p> <pre><code>name = \"Raymond\"\nage = 22\nborn_in = \"Oakland, CA\"\nstring = \"Hello my name is {0} and I'm {1} years old. I was born in {2}.\".format(name, age, born_in)\nprint(string)\n</code></pre> <p>\u597d\u591a\u4e86\uff01</p>"},{"location":"python/#_6","title":"\u8fd4\u56de","text":"<p>Python\u5141\u8bb8\u4f60\u5728\u4e00\u4e2a\u51fd\u6570\u4e2d\u8fd4\u56de\u591a\u4e2a\u5143\u7d20\uff0c\u8fd9\u8ba9\u751f\u6d3b\u66f4\u7b80\u5355\u3002\u4f46\u662f\u5728\u89e3\u5305\u5143\u7ec4\u7684\u65f6\u5019\u51fa\u51fa\u7ebf\u8fd9\u6837\u7684\u5e38\u89c1\u9519\u8bef\uff1a</p> <pre><code>def binary:\nreturn 0, 1\nresult = binary\nzero = result[0]\none = result[1]\n</code></pre> <p>\u8fd9\u662f\u6ca1\u5fc5\u8981\u7684\uff0c\u4f60\u5b8c\u5168\u53ef\u4ee5\u6362\u6210\u8fd9\u6837\uff1a</p> <pre><code>def binary:\nreturn 0, 1\nzero, one = binary\n\u8981\u662f\u4f60\u9700\u8981\u6240\u6709\u7684\u5143\u7d20\u88ab\u8fd4\u56de\uff0c\u7528\u4e2a\u4e0b\u5212\u7ebf_\uff1a\nzero, _ = binary\n</code></pre> <p>\u5c31\u662f\u8fd9\u4e48\u9ad8\u6548\u7387\uff01</p>"},{"location":"python/#_7","title":"\u8bbf\u95ee","text":"<p>\u4f60\u4e5f\u4f1a\u7ecf\u5e38\u7ed9dicts\u4e2d\u5199\u5165key\uff0cpair\uff08\u952e\uff0c\u503c\uff09\u3002</p> <p>\u5982\u679c\u4f60\u8bd5\u56fe\u8bbf\u95ee\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u4e8edict\u7684key\uff0c\u53ef\u80fd\u4f1a\u4e3a\u4e86\u907f\u514dKeyError\u9519\u8bef\uff0c\u4f60\u4f1a\u503e\u5411\u4e8e\u8fd9\u6837\u505a\uff1a</p> <pre><code>countr = {}\nbag = [2, 3, 1, 2, 5, 6, 7, 9, 2, 7]\nfor i in bag:\n    if i in countr:\n        countr[i] += 1\n    else:\n        countr[i] = 1\nfor i in range(10):\n    if i in countr:\n        print(\"Count of {}: {}\".format(i, countr[i]))\n    else:\n        print(\"Count of {}: {}\".format(i, 0))\n</code></pre> <p>\u4f46\u662f\uff0c\u7528get\u662f\u4e2a\u66f4\u597d\u7684\u529e\u6cd5\u3002</p> <pre><code>countr = {}\nbag = [2, 3, 1, 2, 5, 6, 7, 9, 2, 7]\nfor i in bag:\n    countr[i] = countr.get(i, 0) + 1\n    for i in range(10):\n        print(\"Count of {}: {}\".format(i, countr.get(i, 0)))\n\n\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u7528setdefault\u6765\u4ee3\u66ff\u3002\n</code></pre> <p>\u8fd9\u8fd8\u7528\u4e00\u4e2a\u66f4\u7b80\u5355\u5374\u591a\u8d39\u70b9\u5f00\u9500\u7684\u529e\u6cd5\uff1a</p> <pre><code>bag = [2, 3, 1, 2, 5, 6, 7, 9, 2, 7]\ncountr = dict([(num, bag.count(num)) for num in bag])\nfor i in range(10):\n    print(\"Count of {}: {}\".format(i, countr.get(i, 0)))\n</code></pre> <p>\u4f60\u4e5f\u53ef\u4ee5\u7528dict\u63a8\u5bfc\u5f0f\u3002</p> <p><code>countr = {num: bag.count(num) for num in bag}</code></p> <p>\u8fd9\u4e24\u79cd\u65b9\u6cd5\u5f00\u9500\u5927\u662f\u56e0\u4e3a\u5b83\u4eec\u5728\u6bcf\u6b21count\u88ab\u8c03\u7528\u65f6\u90fd\u4f1a\u5bf9\u5217\u8868\u904d\u5386\u3002</p>"},{"location":"python/#_8","title":"\u4f7f\u7528\u5e93","text":"<p>\u73b0\u6709\u7684\u5e93\u53ea\u9700\u5bfc\u5165\u4f60\u5c31\u53ef\u4ee5\u505a\u4f60\u771f\u6b63\u60f3\u505a\u7684\u4e86\u3002</p> <p>\u8fd8\u662f\u8bf4\u524d\u9762\u7684\u4f8b\u5b50\uff0c\u6211\u4eec\u5efa\u4e00\u4e2a\u51fd\u6570\u6765\u6570\u4e00\u4e2a\u6570\u5b57\u5728\u5217\u8868\u4e2d\u51fa\u73b0\u7684\u6b21\u6570\u3002\u90a3\u4e48\uff0c\u5df2\u7ecf\u6709\u4e00\u4e2a\u5e93\u5c31\u53ef\u4ee5\u505a\u8fd9\u6837\u7684\u4e8b\u60c5\u3002</p> <pre><code>from collections import Counter\nbag = [2, 3, 1, 2, 5, 6, 7, 9, 2, 7]\ncountr = Counter(bag)\nfor i in range(10):\nprint(\"Count of {}: {}\".format(i, countr[i]))\n</code></pre> <p>\u4e00\u4e9b\u7528\u5e93\u7684\u7406\u7531\uff1a</p> <p>\u4ee3\u7801\u662f\u6b63\u786e\u800c\u4e14\u7ecf\u8fc7\u6d4b\u8bd5\u7684\u3002</p> <p>\u5b83\u4eec\u7684\u7b97\u6cd5\u53ef\u80fd\u4f1a\u662f\u6700\u4f18\u7684\uff0c\u8fd9\u6837\u5c31\u8dd1\u7684\u66f4\u5feb\u3002</p> <p>\u62bd\u8c61\u5316\uff1a\u5b83\u4eec\u6307\u5411\u660e\u786e\u800c\u4e14\u6587\u6863\u53cb\u597d\uff0c\u4f60\u53ef\u4ee5\u4e13\u6ce8\u4e8e\u90a3\u4e9b\u8fd8\u6ca1\u6709\u88ab\u5b9e\u73b0\u7684\u3002</p> <p>\u6700\u540e\uff0c\u5b83\u90fd\u5df2\u7ecf\u5728\u90a3\u513f\u4e86\uff0c\u4f60\u4e0d\u7528\u518d\u9020\u8f6e\u5b50\u4e86\u3002</p>"},{"location":"python/#_9","title":"\u5728\u5217\u8868\u4e2d\u5207\u7247/\u6b65\u8fdb","text":"<p>\u4f60\u53ef\u4ee5\u6307\u5b9astart\u7684\u70b9\u548cstop\u70b9\uff0c\u5c31\u50cf\u8fd9\u6837list[start:stop:step]\u3002\u6211\u4eec\u53d6\u51fa\u5217\u8868\u4e2d\u7684\u524d5\u4e2a\u5143\u7d20\uff1a</p> <pre><code>bag = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\nfor elem in bag[:5]:\nprint(elem)\n</code></pre> <p>\u8fd9\u5c31\u662f\u5207\u7247\uff0c\u6211\u4eec\u6307\u5b9astop\u70b9\u662f5\uff0c\u518d\u505c\u6b62\u524d\u5c31\u4f1a\u4ece\u5217\u8868\u4e2d\u53d6\u51fa5\u4e2a\u5143\u7d20\u3002</p> <p>\u8981\u662f\u6700\u540e5\u4e2a\u5143\u7d20\u600e\u4e48\u505a\uff1f</p> <pre><code>bag = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\n\nfor elem in bag[-5:]:\nprint(elem)\n</code></pre> <p>\u6ca1\u770b\u660e\u767d\u5417\uff1f-5\u610f\u5473\u7740\u4ece\u5217\u8868\u7684\u7ed3\u5c3e\u53d6\u51fa5\u4e2a\u5143\u7d20\u3002</p> <p>\u5982\u679c\u4f60\u60f3\u5bf9\u5217\u8868\u4e2d\u5143\u7d20\u95f4\u9694\u64cd\u4f5c\uff0c\u4f60\u53ef\u80fd\u4f1a\u8fd9\u6837\u505a\uff1a</p> <pre><code>bag = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\n\nfor index, elem in enumerate(bag):\nif index % 2 == 0:\nprint(elem)\n</code></pre> <p>\u4f46\u662f\u4f60\u5e94\u8be5\u8fd9\u6837\u6765\u505a\uff1a</p> <pre><code>bag = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\n\nfor elem in bag[::2]:\nprint(elem)\n\n# \u6216\u8005\u7528 ranges\n\nbag = list(range(0,10,2))\nprint(bag)\n</code></pre> <p>\u8fd9\u5c31\u662f\u5217\u8868\u4e2d\u7684\u6b65\u8fdb\u3002list[::2]\u610f\u601d\u662f\u904d\u5386\u5217\u8868\u540c\u65f6\u4e24\u6b65\u53d6\u51fa\u4e00\u4e2a\u5143\u7d20\u3002</p> <p>\u4f60\u53ef\u4ee5\u7528list[::-1]\u5f88\u9177\u7684\u7ffb\u8f6c\u5217\u8868\u3002</p>"},{"location":"python/#tab","title":"tab\u952e\u8fd8\u662f\u7a7a\u683c\u952e","text":"<p>\u957f\u65f6\u95f4\u6765\u770b\uff0c\u5c06tab\u548c\u7a7a\u683c\u6df7\u5728\u4e00\u8d77\u4f1a\u9020\u6210\u707e\u96be\uff0c\u4f60\u4f1a\u770b\u5230IndentationError: unexpected indent\u3002\u4e0d\u7ba1\u4f60\u9009\u62e9tab\u952e\u8fd8\u662f\u7a7a\u683c\u952e\uff0c\u4f60\u5e94\u8be5\u5728\u4f60\u7684\u6587\u4ef6\u548c\u9879\u76ee\u4e2d\u4e00\u76f4\u4fdd\u6301\u4f7f\u7528\u3002</p> <p>\u4e00\u4e2a\u4f7f\u7528\u7a7a\u683c\u800c\u4e0d\u662ftab\u7684\u539f\u56e0\u662f\uff0ctab\u4e0d\u662f\u5728\u6240\u6709\u7f16\u8f91\u5668\u4e2d\u90fd\u4e00\u6837\u7684\u3002\u89c6\u5462\u6240\u7528\u7684\u7f16\u8f91\u5668\uff0ctab\u53ef\u80fd\u4f1a\u88ab\u5f53\u4f5c2\u52308\u4e2a\u7a7a\u683c\u3002</p> <p>\u4f60\u4e5f\u53ef\u4ee5\u5728\u5199\u4ee3\u7801\u65f6\u7528\u7a7a\u683c\u6765\u5b9a\u4e49tab\u3002\u8fd9\u6837\u4f60\u53ef\u4ee5\u81ea\u5df1\u9009\u62e9\u7528\u51e0\u4e2a\u7a7a\u683c\u6765\u5f53\u505atab\u3002\u5927\u591a\u6570Python\u7528\u6237\u662f\u75284\u4e2a\u7a7a\u683c\u3002</p>"},{"location":"python/#for1","title":"for\u6587\u51e6\u7406\u304c1\u884c\u3067\u66f8\u3051\u308b\uff01\u7d20\u6575\u306a\u30ea\u30b9\u30c8\u5185\u5305\u8868\u8a18","text":"<ul> <li>\u539f\u6587</li> </ul>"},{"location":"python/#1","title":"1\u884c\u3067\u66f8\u304f\u30ea\u30b9\u30c8\u51e6\u7406","text":"<p>\u3055\u3063\u305d\u304f\u30ea\u30b9\u30c8\u5185\u5305\u8a18\u8ff0\uff08list comprehension\uff09\u3092\u6271\u3044\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u4eca\u56de\u306f\u4ee5\u4e0b\u306e\u914d\u5217\u30c7\u30fc\u30bf\u3092\u6271\u3046\u3053\u3068\u3068\u3057\u307e\u3059\u3002</p> <pre><code>data = [1, 2, 3, 4, 5] \u3053\u306e\u914d\u5217\u306b\u3064\u3044\u3066\u3001\u5404\u8981\u7d20\u306e\u5024\u30922\u500d\u306b\u3059\u308b\u51e6\u7406\u3092\u901a\u5e38\u306efor\u6587\u3067\u8a18\u8ff0\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n</code></pre>"},{"location":"python/#data2","title":"data\u914d\u5217\u306e\u4e2d\u8eab\u30922\u500d\u306b\u3059\u308b","text":"<pre><code>newData = []\nfor d in data:\n  newData.append(d * 2)\n</code></pre> <p>\u3053\u306e3\u884c\u306e\u5b9f\u88c5\u3092\u3001\u30ea\u30b9\u30c8\u5185\u5305\u8868\u8a18\u3067\u8a18\u8ff0\u3059\u308b\u30681\u884c\u3067\u8a18\u8ff0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u7d20\u6575\uff01</p>"},{"location":"python/#data2_1","title":"data\u914d\u5217\u306e\u4e2d\u8eab\u30922\u500d\u306b\u3059\u308b","text":"<pre><code>newData = [d * 2 for d in data] \n</code></pre> <p>\u3053\u306e\u66f8\u304d\u65b9\u306f\u30b7\u30f3\u30d7\u30eb\u3060\u3057\u76f4\u611f\u7684\u306b\u7406\u89e3\u3067\u304d\u308b\u306e\u3067\u3001\u306a\u304b\u306a\u304b\u4fbf\u5229\u3067\u3059\u3002</p>"},{"location":"python/#1if","title":"1\u884c\u3067\u66f8\u304f\u30ea\u30b9\u30c8\u51e6\u7406\uff08if\u6587\u4ed8\u304d\uff09","text":"<p>\u3055\u3089\u306b\u3001\u51e6\u7406\u306e\u4e2d\u3067\u6761\u4ef6\u5f0f\uff08if\u6587\uff09\u3092\u8a18\u8ff0\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u5076\u6570\u306e\u307f\u51e6\u7406\u3057\u305f\u3044\u5834\u5408\u306b\u3001\u901a\u5e38\u306e\u66f8\u304d\u65b9\u3067\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002</p> <pre><code>newData = []\nfor d in data:\n    if d % 2 == 0:\n        newData.append(d * 2)\n</code></pre> <p>\u4e0a\u8a18\u306e\u5834\u5408\u306b\u306f4\u884c\u306e\u5b9f\u88c5\u3067\u3059\u304c\u3001\u30ea\u30b9\u30c8\u5185\u5305\u8868\u8a18\u3060\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b1\u884c\u3067\u8a18\u8ff0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <pre><code>newData = [d * 2 for d in data if d % 2 == 0]\n</code></pre> <p>\u30aa\u30e9\u30a4\u30ea\u30fc\u306e\u672c\u3084Web\u4e0a\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3067\u3082\u826f\u304f\u898b\u308b\u8a18\u8ff0\u306a\u306e\u3067\u3001\u3053\u306e\u8a18\u8ff0\u306f\u8aad\u307f\u66f8\u304d\u3067\u304d\u308b\u5fc5\u8981\u304c\u3042\u308a\u305d\u3046\u3067\u3059\u3002</p>"},{"location":"python/#filter","title":"\u30e9\u30e0\u30c0\u5f0f\uff0bfilter\u3067\u540c\u3058\u3053\u3068\u3092\u5b9f\u73fe\u3067\u304d\u308b","text":"<p>\u30e9\u30e0\u30c0\u5f0f\u3067\u3082\u30ea\u30b9\u30c8\u5185\u5305\u8868\u8a18\u3068\u540c\u3058\u3088\u3046\u306b\u30011\u884c\u3067\u51e6\u7406\u3092\u8a18\u8ff0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <pre><code>newData = []\nfor d in data:\n    if d % 2 == 0:\n        newData.append(d)\n</code></pre> <p>\u3053\u308c\u3092\u30e9\u30e0\u30c0\u5f0f\u3067\u66f8\u304f\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002</p> <pre><code>newData = filter(lambda x:x%2==0, data)\n</code></pre> <p>\u3053\u306e\u8a18\u8ff0\u3082\u306a\u304b\u306a\u304b\u826f\u3055\u305d\u3046\u3067\u3059\u306d\uff01\u305f\u3060\u30e9\u30e0\u30c0\u5f0f\u306e\u5834\u5408\u306b\u306f\u3001filter\u3057\u305f\u5f8c\u306b\u6f14\u7b97\u3092\u884c\u3046\uff08\u4f8b\uff1a\u5024\u30922\u500d\u306b\u3059\u308b\uff09\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u30ea\u30b9\u30c8\u5185\u5305\u8868\u8a18\u306e\u65b9\u304c\u3088\u308a\u67d4\u8edf\u306b\u8a18\u8ff0\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"python/#_10","title":"\u30ea\u30b9\u30c8\u5185\u5305\u8868\u8a18\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3082\u826f\u3044","text":"<p>\u901a\u5e38\u306efor\u6587\u3092\u66f8\u304f\u3088\u308a\u3082\u3001\u30ea\u30b9\u30c8\u5185\u5305\u8868\u8a18\u306e\u65b9\u304c\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u826f\u3044\u3067\u3059\u3002\u3044\u304f\u3064\u304b\u8abf\u3079\u305f\u60c5\u5831\u306b\u3088\u308b\u3068\u3001\u30ea\u30b9\u30c8\u5185\u5305\u8868\u8a18\u3067for\u51e6\u7406\u3059\u308c\u3070\u3001\u8a18\u8ff0\u3057\u305f\u6587\u6cd5\u3092C\u8a00\u8a9e\u30ec\u30d9\u30eb\u3067\u51e6\u7406\u3059\u308b\u305f\u3081\u901f\u3044\u3068\u306e\u3053\u3068\u3002\u5b9f\u969b\u306b\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002</p> <pre><code>import time\n\n# \u5229\u7528\u3059\u308b\u30c7\u30fc\u30bf\ndata = [i for i in range(1, 1000000)]\n\n# \u901a\u5e38\u306efor\u6587\ntime1 = time.clock()\nnewData = []\nfor d in data:\n    if d % 2 == 0:\n        newData.append(d)\ntime2 = time.clock()\nprint time2 - time1 #0.234422\u79d2\n\n# \u30ea\u30b9\u30c8\u5185\u5305\u8868\u8a18    \ntime1 = time.clock()\nnewData = [d for d in data if d % 2 == 0]\ntime2 = time.clock()\nprint time2 - time1 #0.185301\u79d2\n\n# filter\u3068\u30e9\u30e0\u30c0\u5f0f\ntime1 = time.clock()\nnewData = filter(lambda x:x%2==0, data)\ntime2 = time.clock()\nprint time2 - time1 #0.184838\n</code></pre> <p>\u4f55\u5ea6\u304b\u8a66\u3057\u305f\u3068\u3053\u308d\u3001\u4e0a\u8a18\u4f8b\u306e\u5834\u5408\u306b\u306f\u3001\u30ea\u30b9\u30c8\u5185\u5305\u8868\u8a18\u306f\u901a\u5e38\u306efor\u6587\u8a18\u8ff0\u3088\u308a\u308222\uff05\u9ad8\u901f\u3067\u3057\u305f\uff08\u50d5\u306eMacBookAir\u306e\u5834\u5408\uff09\u3002</p>"},{"location":"sar/","title":"sar","text":""},{"location":"sar/#sar-linux","title":"sar \u2014\u2014 Linux \u4e0a\u6700\u4e3a\u5168\u9762\u7684\u7cfb\u7edf\u6027\u80fd\u5206\u6790\u5de5\u5177\u4e4b\u4e00","text":"<p><code>sar</code></p> <p>\uff08System Activity Reporter \u7cfb\u7edf\u6d3b\u52a8\u60c5\u51b5\u62a5\u544a\uff09\u662f\u76ee\u524d Linux \u4e0a\u6700\u4e3a\u5168\u9762\u7684\u7cfb\u7edf\u6027\u80fd\u5206\u6790\u5de5\u5177\u4e4b\u4e00\uff0c\u53ef\u4ee5\u4ece\u591a\u65b9\u9762\u5bf9\u7cfb\u7edf\u7684\u6d3b\u52a8\u8fdb\u884c\u62a5\u544a\uff0c\u5305\u62ec\uff1a\u6587\u4ef6\u7684\u8bfb\u5199\u60c5\u51b5\u3001\u7cfb\u7edf\u8c03\u7528\u7684\u4f7f\u7528\u60c5\u51b5\u3001\u78c1\u76d8 I/O\u3001CPU \u6548\u7387\u3001\u5185\u5b58\u4f7f\u7528\u72b6\u51b5\u3001\u8fdb\u7a0b\u6d3b\u52a8\u53ca IPC \u6709\u5173\u7684\u6d3b\u52a8\u7b49\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528<code>sar</code>\u547d\u4ee4\u6765\u83b7\u5f97\u6574\u4e2a\u7cfb\u7edf\u6027\u80fd\u7684\u62a5\u544a\u3002\u8fd9\u6709\u52a9\u4e8e\u6211\u4eec\u5b9a\u4f4d\u7cfb\u7edf\u6027\u80fd\u7684\u74f6\u9888\uff0c\u5e76\u4e14\u6709\u52a9\u4e8e\u6211\u4eec\u627e\u51fa\u8fd9\u4e9b\u70e6\u4eba\u7684\u6027\u80fd\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6cd5\u3002</p> <p>Linux \u5185\u6838\u7ef4\u62a4\u7740\u4e00\u4e9b\u5185\u90e8\u8ba1\u6570\u5668\uff0c\u8fd9\u4e9b\u8ba1\u6570\u5668\u5305\u542b\u4e86\u6240\u6709\u7684\u8bf7\u6c42\u53ca\u5176\u5b8c\u6210\u65f6\u95f4\u548c I/O \u5757\u6570\u7b49\u4fe1\u606f\uff0c<code>sar</code>\u547d\u4ee4\u4ece\u6240\u6709\u7684\u8fd9\u4e9b\u4fe1\u606f\u4e2d\u8ba1\u7b97\u51fa\u8bf7\u6c42\u7684\u5229\u7528\u7387\u548c\u6bd4\u4f8b\uff0c\u4ee5\u4fbf\u627e\u51fa\u74f6\u9888\u6240\u5728\u3002</p> <p><code>sar</code>\u547d\u4ee4\u4e3b\u8981\u7684\u7528\u9014\u662f\u751f\u6210\u67d0\u6bb5\u65f6\u95f4\u5185\u6240\u6709\u6d3b\u52a8\u7684\u62a5\u544a\uff0c\u56e0\u6b64\u5fc5\u9700\u786e\u4fdd<code>sar</code>\u547d\u4ee4\u5728\u9002\u5f53\u7684\u65f6\u95f4\u8fdb\u884c\u6570\u636e\u91c7\u96c6\uff08\u800c\u4e0d\u662f\u5728\u5348\u9910\u65f6\u95f4\u6216\u8005\u5468\u672b\uff09</p> <p>\u539f\u6587\u5730\u5740: https://shockerli.net/post/li...</p>"},{"location":"sar/#_1","title":"\u547d\u4ee4\u53c2\u6570","text":"<pre><code>\u7528\u6cd5: sar [ \u9009\u9879 ] [ &lt;\u65f6\u95f4\u95f4\u9694&gt; [ &lt;\u6b21\u6570&gt; ] ]\n\u4e3b\u9009\u9879\u548c\u62a5\u544a\uff1a\n-b    I/O \u548c\u4f20\u8f93\u901f\u7387\u4fe1\u606f\u72b6\u51b5\n-B    \u5206\u9875\u72b6\u51b5\n-d    \u5757\u8bbe\u5907\u72b6\u51b5\n-I { &lt;\u4e2d\u65ad&gt; | SUM | ALL | XALL }\n\u4e2d\u65ad\u4fe1\u606f\u72b6\u51b5\n-m    \u7535\u6e90\u7ba1\u7406\u4fe1\u606f\u72b6\u51b5\n-n { &lt;\u5173\u952e\u8bcd&gt; [,...] | ALL }\n\u7f51\u7edc\u7edf\u8ba1\u4fe1\u606f\n\u5173\u952e\u8bcd\u53ef\u4ee5\u662f\uff1a\nDEV     \u7f51\u5361\nEDEV     \u7f51\u5361 (\u9519\u8bef)\nNFS     NFS \u5ba2\u6237\u7aef\nNFSD     NFS \u670d\u52a1\u5668\nSOCK     Sockets (\u5957\u63a5\u5b57)    (v4)\nIP    IP  \u6d41          (v4)\nEIP     IP \u6d41       (v4) (\u9519\u8bef)\nICMP     ICMP \u6d41    (v4)\nEICMP     ICMP \u6d41    (v4) (\u9519\u8bef)\nTCP     TCP \u6d41  (v4)\nETCP     TCP \u6d41  (v4) (\u9519\u8bef)\nUDP     UDP \u6d41  (v4)\nSOCK6     Sockets (\u5957\u63a5\u5b57)    (v6)\nIP6     IP \u6d41       (v6)\nEIP6     IP \u6d41       (v6) (\u9519\u8bef)\nICMP6     ICMP \u6d41 (v6)\nEICMP6 ICMP \u6d41 (v6) (\u9519\u8bef)\nUDP6    UDP \u6d41       (v6)\n-q    \u961f\u5217\u957f\u5ea6\u548c\u5e73\u5747\u8d1f\u8f7d\n-r    \u5185\u5b58\u5229\u7528\u7387\n-R    \u5185\u5b58\u72b6\u51b5\n-S    \u4ea4\u6362\u7a7a\u95f4\u5229\u7528\u7387\n-u [ ALL ]\nCPU \u5229\u7528\u7387\n-v    Kernel table \u72b6\u51b5\n-w    \u4efb\u52a1\u521b\u5efa\u4e0e\u7cfb\u7edf\u8f6c\u6362\u7edf\u8ba1\u4fe1\u606f\n-W    \u4ea4\u6362\u4fe1\u606f\n-y    TTY \u8bbe\u5907\u72b6\u51b5\n-o {&lt;\u6587\u4ef6\u8def\u5f84&gt;}\n\u5c06\u547d\u4ee4\u7ed3\u679c\u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u5b58\u653e\u5728\u6307\u5b9a\u6587\u4ef6\u4e2d\n</code></pre>"},{"location":"sar/#_2","title":"\u5e38\u7528\u547d\u4ee4","text":"<p><code>sar</code>\u547d\u4ee4\u6765\u81ea\u4e8e<code>sysstat</code>\u5de5\u5177\u5305\uff0c\u5982\u679c\u63d0\u793a<code>sar</code>\u547d\u4ee4\u4e0d\u5b58\u5728\uff0c\u9700\u5148\u5b89\u88c5<code>sysstat</code>\u3002</p>"},{"location":"sar/#_3","title":"\u7f51\u7edc\u7edf\u8ba1\u4fe1\u606f","text":"<pre><code>sar -n &lt;\u5173\u952e\u8bcd&gt; [ &lt;\u65f6\u95f4\u95f4\u9694&gt; [ &lt;\u6b21\u6570&gt; ] ]\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>sar -n DEV 1 5\n\u5e73\u5747\u65f6\u95f4:     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s\n\u5e73\u5747\u65f6\u95f4:        lo      2.21      2.21      0.18      0.18      0.00      0.00      0.00\n\u5e73\u5747\u65f6\u95f4:      eth0      4.62      3.82      0.37      1.90      0.00      0.00      0.00\n</code></pre> <p>\u547d\u4ee4\u4e2d 1 5 \u8868\u793a\u6bcf\u4e00\u79d2\u949f\u53d6 1 \u6b21\u503c\uff0c\u4e00\u5171\u53d6 5 \u6b21\u3002</p> <p>\u547d\u4ee4\u6267\u884c\u540e\u4f1a\u5217\u51fa\u6bcf\u4e2a\u7f51\u5361\u8fd9 5 \u6b21\u53d6\u503c\u7684\u5e73\u5747\u6570\u636e\uff0c\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u6765\u786e\u5b9a\u5e26\u5bbd\u8dd1\u6ee1\u7684\u7f51\u5361\u540d\u79f0\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b eth0 \u4e3a\u5185\u7f51\u7f51\u5361\uff0ceth1 \u4e3a\u5916\u7f51\u7f51\u5361\u3002</p>"},{"location":"sar/#cpu","title":"CPU \u5229\u7528\u7387","text":"<pre><code>sar -u [ &lt;\u65f6\u95f4\u95f4\u9694&gt; [ &lt;\u6b21\u6570&gt; ] ]\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>sar -u 1 3\nLinux 2.6.32-642.13.1.el6.x86_64 (upfor106) 2018\u5e7404\u670825\u65e5 _x86_64_ (1 CPU)\n10\u65f633\u520608\u79d2     CPU     %user     %nice   %system   %iowait    %steal     %idle\n10\u65f633\u520609\u79d2     all      0.00      0.00      0.00      0.00      0.00    100.00\n10\u65f633\u520610\u79d2     all      0.99      0.00      0.99      0.00      0.00     98.02\n10\u65f633\u520611\u79d2     all      0.00      0.00      0.00      0.00      0.00    100.00\n\u5e73\u5747\u65f6\u95f4:        all      0.33      0.00      0.33      0.00      0.00     99.33\n</code></pre> <p>\u547d\u4ee4\u4e2d 1 3 \u8868\u793a\u6bcf\u4e00\u79d2\u949f\u53d6 1 \u6b21\u503c\uff0c\u4e00\u5171\u53d6 3 \u6b21\u3002</p> <p>\u8f93\u51fa\u9879\u8bf4\u660e\uff1a</p> <pre><code>CPU\uff1aall \u8868\u793a\u7edf\u8ba1\u4fe1\u606f\u4e3a\u6240\u6709 CPU \u7684\u5e73\u5747\u503c\u3002\n\n%user\uff1a\u663e\u793a\u5728\u7528\u6237\u7ea7\u522b(application)\u8fd0\u884c\u4f7f\u7528 CPU \u603b\u65f6\u95f4\u7684\u767e\u5206\u6bd4\n\n%nice\uff1a\u663e\u793a\u5728\u7528\u6237\u7ea7\u522b\uff0c\u7528\u4e8enice\u64cd\u4f5c\uff0c\u6240\u5360\u7528 CPU \u603b\u65f6\u95f4\u7684\u767e\u5206\u6bd4\n\n%system\uff1a\u5728\u6838\u5fc3\u7ea7\u522b(kernel)\u8fd0\u884c\u6240\u4f7f\u7528 CPU \u603b\u65f6\u95f4\u7684\u767e\u5206\u6bd4\n\n%iowait\uff1a\u663e\u793a\u7528\u4e8e\u7b49\u5f85I/O\u64cd\u4f5c\u5360\u7528 CPU \u603b\u65f6\u95f4\u7684\u767e\u5206\u6bd4\n\n%steal\uff1a\u7ba1\u7406\u7a0b\u5e8f(hypervisor)\u4e3a\u53e6\u4e00\u4e2a\u865a\u62df\u8fdb\u7a0b\u63d0\u4f9b\u670d\u52a1\u800c\u7b49\u5f85\u865a\u62df CPU \u7684\u767e\u5206\u6bd4\n\n%idle\uff1a\u663e\u793a CPU \u7a7a\u95f2\u65f6\u95f4\u5360\u7528 CPU \u603b\u65f6\u95f4\u7684\u767e\u5206\u6bd4\n\n1. \u82e5 %iowait \u7684\u503c\u8fc7\u9ad8\uff0c\u8868\u793a\u786c\u76d8\u5b58\u5728I/O\u74f6\u9888\n\n2. \u82e5 %idle \u7684\u503c\u9ad8\u4f46\u7cfb\u7edf\u54cd\u5e94\u6162\u65f6\uff0c\u6709\u53ef\u80fd\u662f CPU \u7b49\u5f85\u5206\u914d\u5185\u5b58\uff0c\u6b64\u65f6\u5e94\u52a0\u5927\u5185\u5b58\u5bb9\u91cf\n\n3. \u82e5 %idle \u7684\u503c\u6301\u7eed\u4f4e\u4e8e1\uff0c\u5219\u7cfb\u7edf\u7684 CPU \u5904\u7406\u80fd\u529b\u76f8\u5bf9\u8f83\u4f4e\uff0c\u8868\u660e\u7cfb\u7edf\u4e2d\u6700\u9700\u8981\u89e3\u51b3\u7684\u8d44\u6e90\u662f CPU\n</code></pre>"},{"location":"sar/#_4","title":"\u7d22\u5f15\u8282\u70b9\uff0c\u6587\u4ef6\u548c\u5176\u4ed6\u5185\u6838\u8868\u7684\u72b6\u6001","text":"<pre><code>sar -v [ &lt;\u65f6\u95f4\u95f4\u9694&gt; [ &lt;\u6b21\u6570&gt; ] ]\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>sar -v 1 3\n\nLinux 2.6.32-696.13.2.el6.x86_64 (upfor163) 2018\u5e7404\u670825\u65e5 _x86_64_ (2 CPU)\n\n10\u65f650\u520629\u79d2 dentunusd   file-nr  inode-nr    pty-nr\n10\u65f650\u520630\u79d2    920045       864     13910         2\n10\u65f650\u520631\u79d2    920045       864     13910         2\n10\u65f650\u520632\u79d2    920045       896     13910         2\n\u5e73\u5747\u65f6\u95f4:       920045       875     13910         2\n</code></pre> <p>\u8f93\u51fa\u9879\u8bf4\u660e\uff1a</p> <pre><code>dentunusd\uff1a\u76ee\u5f55\u9ad8\u901f\u7f13\u5b58\u4e2d\u672a\u88ab\u4f7f\u7528\u7684\u6761\u76ee\u6570\u91cf\nfile-nr\uff1a\u6587\u4ef6\u53e5\u67c4\uff08file handle\uff09\u7684\u4f7f\u7528\u6570\u91cf\ninode-nr\uff1a\u7d22\u5f15\u8282\u70b9\u53e5\u67c4\uff08inode handle\uff09\u7684\u4f7f\u7528\u6570\u91cf\npty-nr\uff1a\u4f7f\u7528\u7684 pty \u6570\u91cf\n</code></pre>"},{"location":"sar/#_5","title":"\u5185\u5b58\u5229\u7528\u7387","text":"<pre><code>sar -r [ &lt;\u65f6\u95f4\u95f4\u9694&gt; [ &lt;\u6b21\u6570&gt; ] ]\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>sar -r 1 3\n\nLinux 2.6.32-696.13.2.el6.x86_64 (upfor163) 2018\u5e7404\u670825\u65e5 _x86_64_ (2 CPU)\n\n10\u65f653\u520600\u79d2 kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit\n10\u65f653\u520601\u79d2   2027760   2028732     50.01    145492   1243820   1163900     28.69\n10\u65f653\u520602\u79d2   2027620   2028872     50.02    145492   1243820   1163896     28.69\n10\u65f653\u520603\u79d2   2028100   2028392     50.00    145492   1243820   1163900     28.69\n\u5e73\u5747\u65f6\u95f4:      2027827   2028665     50.01    145492   1243820   1163899     28.69\n</code></pre> <p>\u8f93\u51fa\u9879\u8bf4\u660e\uff1a</p> <pre><code>kbmemfree\uff1a\u8fd9\u4e2a\u503c\u548c free \u547d\u4ee4\u4e2d\u7684 free \u503c\u57fa\u672c\u4e00\u81f4\uff0c\u6240\u4ee5\u5b83\u4e0d\u5305\u62ec buffer \u548c cache \u7684\u7a7a\u95f4\n\nkbmemused\uff1a\u8fd9\u4e2a\u503c\u548c free \u547d\u4ee4\u4e2d\u7684 used \u503c\u57fa\u672c\u4e00\u81f4,\u6240\u4ee5\u5b83\u5305\u62ec buffer \u548c cache \u7684\u7a7a\u95f4\n\n%memused\uff1a\u8fd9\u4e2a\u503c\u662f kbmemused \u548c\u5185\u5b58\u603b\u91cf(\u4e0d\u5305\u62ec swap)\u7684\u4e00\u4e2a\u767e\u5206\u6bd4\n\nkbbuffers \u548c kbcached\uff1a\u8fd9\u4e24\u4e2a\u503c\u5c31\u662f free \u547d\u4ee4\u4e2d\u7684 buffer \u548c cache\n\nkbcommit\uff1a\u4fdd\u8bc1\u5f53\u524d\u7cfb\u7edf\u6240\u9700\u8981\u7684\u5185\u5b58\uff0c\u5373\u4e3a\u4e86\u786e\u4fdd\u4e0d\u6ea2\u51fa\u800c\u9700\u8981\u7684\u5185\u5b58(RAM + swap)\n\n%commit\uff1a\u8fd9\u4e2a\u503c\u662f kbcommit \u4e0e\u5185\u5b58\u603b\u91cf(\u5305\u62ec swap)\u7684\u4e00\u4e2a\u767e\u5206\u6bd4\n</code></pre>"},{"location":"sar/#_6","title":"\u5185\u5b58\u5206\u9875\u72b6\u51b5","text":"<pre><code>sar -B [ &lt;\u65f6\u95f4\u95f4\u9694&gt; [ &lt;\u6b21\u6570&gt; ] ]\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>sar -B 1 3\nLinux 2.6.32-696.13.2.el6.x86_64 (upfor163) 2018\u5e7404\u670825\u65e5 _x86_64_ (2 CPU)\n10\u65f655\u520641\u79d2  pgpgin/s pgpgout/s   fault/s  majflt/s  pgfree/s pgscank/s pgscand/s pgsteal/s    %vmeff\n10\u65f655\u520642\u79d2      0.00      0.00   5723.76      0.00   3356.44      0.00      0.00      0.00      0.00\n10\u65f655\u520643\u79d2      0.00      0.00   1185.00      0.00    312.00      0.00      0.00      0.00      0.00\n10\u65f655\u520644\u79d2      0.00      0.00     27.00      0.00     56.00      0.00      0.00      0.00      0.00\n\u5e73\u5747\u65f6\u95f4:         0.00      0.00   2323.26      0.00   1248.50      0.00      0.00      0.00      0.00\n</code></pre> <p>\u8f93\u51fa\u9879\u8bf4\u660e\uff1a</p> <pre><code>pgpgin/s\uff1a\u8868\u793a\u6bcf\u79d2\u4ece\u78c1\u76d8\u6216SWAP\u7f6e\u6362\u5230\u5185\u5b58\u7684\u5b57\u8282\u6570(KB)\n\npgpgout/s\uff1a\u8868\u793a\u6bcf\u79d2\u4ece\u5185\u5b58\u7f6e\u6362\u5230\u78c1\u76d8\u6216SWAP\u7684\u5b57\u8282\u6570(KB)\n\nfault/s\uff1a\u6bcf\u79d2\u949f\u7cfb\u7edf\u4ea7\u751f\u7684\u7f3a\u9875\u6570\uff0c\u5373\u4e3b\u7f3a\u9875\u4e0e\u6b21\u7f3a\u9875\u4e4b\u548c(major + minor)\n\nmajflt/s\uff1a\u6bcf\u79d2\u949f\u4ea7\u751f\u7684\u4e3b\u7f3a\u9875\u6570\n\npgfree/s\uff1a\u6bcf\u79d2\u88ab\u653e\u5165\u7a7a\u95f2\u961f\u5217\u4e2d\u7684\u9875\u4e2a\u6570\n\npgscank/s\uff1a\u6bcf\u79d2\u88ab kswapd \u626b\u63cf\u7684\u9875\u4e2a\u6570\n\npgscand/s\uff1a\u6bcf\u79d2\u76f4\u63a5\u88ab\u626b\u63cf\u7684\u9875\u4e2a\u6570\n\npgsteal/s\uff1a\u6bcf\u79d2\u949f\u4ece cache \u4e2d\u88ab\u6e05\u9664\u6765\u6ee1\u8db3\u5185\u5b58\u9700\u8981\u7684\u9875\u4e2a\u6570\n\n%vmeff\uff1a\u6bcf\u79d2\u6e05\u9664\u7684\u9875(pgsteal)\u5360\u603b\u626b\u63cf\u9875(pgscank + pgscand)\u7684\u767e\u5206\u6bd4\n</code></pre>"},{"location":"sar/#io","title":"I/O \u548c\u4f20\u8f93\u901f\u7387\u4fe1\u606f\u72b6\u51b5","text":"<pre><code>sar -b [ &lt;\u65f6\u95f4\u95f4\u9694&gt; [ &lt;\u6b21\u6570&gt; ] ]\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>sar -b 1 3\n\nLinux 2.6.32-696.13.2.el6.x86_64 (upfor163) 2018\u5e7404\u670825\u65e5 _x86_64_ (2 CPU)\n\n10\u65f658\u520615\u79d2       tps      rtps      wtps   bread/s   bwrtn/s\n10\u65f658\u520616\u79d2      7.00      0.00      7.00      0.00     64.00\n10\u65f658\u520617\u79d2      4.04      0.00      4.04      0.00     80.81\n10\u65f658\u520618\u79d2      0.00      0.00      0.00      0.00      0.00\n\u5e73\u5747\u65f6\u95f4:         3.67      0.00      3.67      0.00     48.00\n</code></pre> <p>\u8f93\u51fa\u9879\u8bf4\u660e\uff1a</p> <pre><code>tps\uff1a\u6bcf\u79d2\u949f\u7269\u7406\u8bbe\u5907\u7684 I/O \u4f20\u8f93\u603b\u91cf\nrtps\uff1a\u6bcf\u79d2\u949f\u4ece\u7269\u7406\u8bbe\u5907\u8bfb\u5165\u7684\u6570\u636e\u603b\u91cf\nwtps\uff1a\u6bcf\u79d2\u949f\u5411\u7269\u7406\u8bbe\u5907\u5199\u5165\u7684\u6570\u636e\u603b\u91cf\nbread/s\uff1a\u6bcf\u79d2\u949f\u4ece\u7269\u7406\u8bbe\u5907\u8bfb\u5165\u7684\u6570\u636e\u91cf\uff0c\u5355\u4f4d\u4e3a\uff1a\u5757/s\nbwrtn/s\uff1a\u6bcf\u79d2\u949f\u5411\u7269\u7406\u8bbe\u5907\u5199\u5165\u7684\u6570\u636e\u91cf\uff0c\u5355\u4f4d\u4e3a\uff1a\u5757/s\n</code></pre>"},{"location":"sar/#_7","title":"\u961f\u5217\u957f\u5ea6\u548c\u5e73\u5747\u8d1f\u8f7d","text":"<pre><code>sar -q [ &lt;\u65f6\u95f4\u95f4\u9694&gt; [ &lt;\u6b21\u6570&gt; ] ]\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>sar -q 1 3\n\nLinux 2.6.32-696.13.2.el6.x86_64 (upfor163) 2018\u5e7404\u670825\u65e5 _x86_64_ (2 CPU)\n\n11\u65f600\u520635\u79d2   runq-sz  plist-sz   ldavg-1   ldavg-5  ldavg-15\n11\u65f600\u520636\u79d2         0       268      0.00      0.00      0.00\n11\u65f600\u520637\u79d2         0       268      0.00      0.00      0.00\n11\u65f600\u520638\u79d2         0       268      0.00      0.00      0.00\n\u5e73\u5747\u65f6\u95f4:            0       268      0.00      0.00      0.00\n</code></pre> <p>\u8f93\u51fa\u9879\u8bf4\u660e\uff1a</p> <pre><code>runq-sz\uff1a\u8fd0\u884c\u961f\u5217\u7684\u957f\u5ea6\uff08\u7b49\u5f85\u8fd0\u884c\u7684\u8fdb\u7a0b\u6570\uff09\n\nplist-sz\uff1a\u8fdb\u7a0b\u5217\u8868\u4e2d\u8fdb\u7a0b\uff08processes\uff09\u548c\u7ebf\u7a0b\uff08threads\uff09\u7684\u6570\u91cf\n\nldavg-1\uff1a\u6700\u540e1\u5206\u949f\u7684\u7cfb\u7edf\u5e73\u5747\u8d1f\u8f7d\uff08System load average\uff09\n\nldavg-5\uff1a\u8fc7\u53bb5\u5206\u949f\u7684\u7cfb\u7edf\u5e73\u5747\u8d1f\u8f7d\n\nldavg-15\uff1a\u8fc7\u53bb15\u5206\u949f\u7684\u7cfb\u7edf\u5e73\u5747\u8d1f\u8f7d\n</code></pre>"},{"location":"sar/#_8","title":"\u7cfb\u7edf\u4ea4\u6362\u4fe1\u606f","text":"<pre><code>sar -W [ &lt;\u65f6\u95f4\u95f4\u9694&gt; [ &lt;\u6b21\u6570&gt; ] ]\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>sar -W 1 3\nLinux 2.6.32-696.13.2.el6.x86_64 (upfor163) 2018\u5e7404\u670825\u65e5 _x86_64_ (2 CPU)\n11\u65f601\u520645\u79d2  pswpin/s pswpout/s\n11\u65f601\u520646\u79d2      0.00      0.00\n11\u65f601\u520647\u79d2      0.00      0.00\n11\u65f601\u520648\u79d2      0.00      0.00\n\u5e73\u5747\u65f6\u95f4:         0.00      0.00\n</code></pre> <p>\u8f93\u51fa\u9879\u8bf4\u660e\uff1a</p> <pre><code>pswpin/s\uff1a\u6bcf\u79d2\u7cfb\u7edf\u6362\u5165\u7684\u4ea4\u6362\u9875\u9762\uff08swap page\uff09\u6570\u91cf\npswpout/s\uff1a\u6bcf\u79d2\u7cfb\u7edf\u6362\u51fa\u7684\u4ea4\u6362\u9875\u9762\uff08swap page\uff09\u6570\u91cf\n</code></pre>"},{"location":"sar/#_9","title":"\u5757\u8bbe\u5907\u72b6\u51b5","text":"<pre><code>sar -d [ &lt;\u65f6\u95f4\u95f4\u9694&gt; [ &lt;\u6b21\u6570&gt; ] ]\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>sar -d 1 3\nLinux 2.6.32-696.13.2.el6.x86_64 (upfor163) 2018\u5e7404\u670825\u65e5 _x86_64_ (2 CPU)\n11\u65f602\u520646\u79d2       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util\n11\u65f602\u520647\u79d2  dev252-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n11\u65f602\u520647\u79d2       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util\n11\u65f602\u520648\u79d2  dev252-0      6.06      0.00     64.65     10.67      0.00      0.00      0.00      0.00\n11\u65f602\u520648\u79d2       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util\n11\u65f602\u520649\u79d2  dev252-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n\u5e73\u5747\u65f6\u95f4:       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util\n\u5e73\u5747\u65f6\u95f4:  dev252-0      2.00      0.00     21.33     10.67      0.00      0.00      0.00      0.00\n</code></pre> <p>\u8f93\u51fa\u9879\u8bf4\u660e\uff1a</p> <pre><code>tps: \u6bcf\u79d2\u4ece\u7269\u7406\u78c1\u76d8 I/O \u7684\u6b21\u6570\u3002\u591a\u4e2a\u903b\u8f91\u8bf7\u6c42\u4f1a\u88ab\u5408\u5e76\u4e3a\u4e00\u4e2a I/O \u78c1\u76d8\u8bf7\u6c42\uff0c\u4e00\u6b21\u4f20\u8f93\u7684\u5927\u5c0f\u662f\u4e0d\u786e\u5b9a\u7684\n\nrd_sec/s: \u6bcf\u79d2\u8bfb\u6247\u533a\u7684\u6b21\u6570\n\nwr_sec/s: \u6bcf\u79d2\u5199\u6247\u533a\u7684\u6b21\u6570\n\navgrq-sz: \u5e73\u5747\u6bcf\u6b21\u8bbe\u5907 I/O \u64cd\u4f5c\u7684\u6570\u636e\u5927\u5c0f(\u6247\u533a)\n\navgqu-sz: \u78c1\u76d8\u8bf7\u6c42\u961f\u5217\u7684\u5e73\u5747\u957f\u5ea6\n\nawait: \u4ece\u8bf7\u6c42\u78c1\u76d8\u64cd\u4f5c\u5230\u7cfb\u7edf\u5b8c\u6210\u5904\u7406\uff0c\u6bcf\u6b21\u8bf7\u6c42\u7684\u5e73\u5747\u6d88\u8017\u65f6\u95f4\uff0c\u5305\u62ec\u8bf7\u6c42\u961f\u5217\u7b49\u5f85\u65f6\u95f4\uff0c\u5355\u4f4d\u662f\u6beb\u79d2(1\u79d2=1000\u6beb\u79d2)\n\nsvctm: \u7cfb\u7edf\u5904\u7406\u6bcf\u6b21\u8bf7\u6c42\u7684\u5e73\u5747\u65f6\u95f4,\u4e0d\u5305\u62ec\u5728\u8bf7\u6c42\u961f\u5217\u4e2d\u6d88\u8017\u7684\u65f6\u95f4.\n\n%util: I/O\u8bf7\u6c42\u5360CPU\u7684\u767e\u5206\u6bd4\uff0c\u6bd4\u7387\u8d8a\u5927\uff0c\u8bf4\u660e\u8d8a\u9971\u548c\n    1. avgqu-sz \u7684\u503c\u8f83\u4f4e\u65f6\uff0c\u8bbe\u5907\u7684\u5229\u7528\u7387\u8f83\u9ad8\n    2. \u5f53%util\u7684\u503c\u63a5\u8fd1 1% \u65f6\uff0c\u8868\u793a\u8bbe\u5907\u5e26\u5bbd\u5df2\u7ecf\u5360\u6ee1\n</code></pre>"},{"location":"sar/#_10","title":"\u8f93\u51fa\u7edf\u8ba1\u7684\u6570\u636e\u4fe1\u606f","text":"<pre><code>sar -o path_file [\u9009\u9879] [ &lt;\u65f6\u95f4\u95f4\u9694&gt; [ &lt;\u6b21\u6570&gt; ] ]\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>sar -o sarfile.log -u 1 3\n</code></pre> <p>\u4e0a\u8ff0\u793a\u4f8b\u547d\u4ee4\u4f1a\u5c06<code>sar -u 1 3</code>\u91c7\u96c6\u5230\u7684\u6570\u636e\u4ee5\u4e8c\u8fdb\u5236\u7684\u683c\u5f0f\u5b58\u653e\u5230\u6587\u4ef6<code>sarfile.log</code>\u4e2d\u3002</p> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4<code>sadf -d sarfile.log</code>\u5c06\u4e8c\u8fdb\u5236\u6570\u636e\u6587\u4ef6\u8f6c\u6362\u6210\u6570\u636e\u5e93\u53ef\u8bfb\u7684\u683c\u5f0f\u3002</p> <pre><code>sadf -d sarfile.log\n\n# hostname;interval;timestamp;CPU;%user;%nice;%system;%iowait;%steal;%idle\nupfor163;1;2018-04-25 03:15:02 UTC;-1;0.00;0.00;0.50;0.50;0.00;99.00\nupfor163;1;2018-04-25 03:15:03 UTC;-1;1.01;0.00;0.00;0.00;0.00;98.99\nupfor163;1;2018-04-25 03:15:04 UTC;-1;0.00;0.00;0.00;0.00;0.00;100.00\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u6570\u636e\u5b58\u50a8\u5728\u4e00\u4e2a csv \u6587\u6863\u4e2d\uff0c\u7136\u540e\u7ed8\u5236\u6210\u56fe\u8868\u5c55\u793a\u65b9\u5f0f\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>sadf -d sarfile.log | sed 's/;/,/g' &gt; sarfile.csv\n</code></pre> <p></p>"},{"location":"sar/#_11","title":"\u4ece\u6570\u636e\u6587\u4ef6\u8bfb\u53d6\u4fe1\u606f","text":"<pre><code>sar -f &lt;\u6587\u4ef6\u8def\u5f84&gt;\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>sar -f sarfile.log\nLinux 2.6.32-696.13.2.el6.x86_64 (upfor163) 2018\u5e7404\u670825\u65e5 _x86_64_ (2 CPU)\n11\u65f615\u520601\u79d2     CPU     %user     %nice   %system   %iowait    %steal     %idle\n11\u65f615\u520602\u79d2     all      0.00      0.00      0.50      0.50      0.00     99.00\n11\u65f615\u520603\u79d2     all      1.01      0.00      0.00      0.00      0.00     98.99\n11\u65f615\u520604\u79d2     all      0.00      0.00      0.00      0.00      0.00    100.00\n\u5e73\u5747\u65f6\u95f4:     all      0.33      0.00      0.17      0.17      0.00     99.33\n</code></pre> <p>\u53c8\u5c06\u4e4b\u524d\u5b58\u50a8\u5728\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\u7684\u6570\u636e\u7ed9\u8bfb\u53d6\u5e76\u5c55\u793a\u51fa\u6765\u3002</p>"},{"location":"sar/#_12","title":"\u6027\u80fd\u95ee\u9898\u6392\u67e5\u6280\u5de7","text":"<ul> <li>\u6000\u7591 CPU \u5b58\u5728\u74f6\u9888\uff0c\u53ef\u7528<code>sar -u</code>\u548c<code>sar -q</code>\u7b49\u6765\u67e5\u770b</li> <li>\u6000\u7591\u5185\u5b58\u5b58\u5728\u74f6\u9888\uff0c\u53ef\u7528<code>sar -B</code>\u3001<code>sar -r</code>\u548c<code>sar -W</code>\u7b49\u6765\u67e5\u770b</li> <li>\u6000\u7591 I/O \u5b58\u5728\u74f6\u9888\uff0c\u53ef\u7528<code>sar -b</code>\u3001<code>sar -u</code>\u548c<code>sar -d</code>\u7b49\u6765\u67e5\u770b</li> </ul> <p>\u539f\u6587\u5730\u5740: https://shockerli.net/post/li...</p>"},{"location":"sed/","title":"\u4e09\u5341\u5206\u949f\u5b66\u4f1aSED","text":"<ul> <li>\u539f\u6587</li> </ul> <p>\u672c\u6587\u627f\u63a5\u4e4b\u524d\u5199\u7684[\u4e09\u5341\u5206\u949f\u5b66\u4f1aAWK][]\u4e00\u6587\uff0c\u5728\u5b66\u4e60\u5b8cAWK\u4e4b\u540e\uff0c\u8d81\u70ed\u6253\u94c1\u53c8\u5b66\u4e60\u4e86\u4e00\u4e0bSED\uff0c\u4e0d\u5f97\u4e0d\u8bf4\u8fd9\u4e24\u4e2a\u5de5\u5177\u771f\u7684\u582a\u79f0\u6587\u672c\u5904\u7406\u795e\u5668\uff0c\u8c01\u7528\u8c01\u77e5\u9053\uff01\u672c\u6587\u5927\u90e8\u5206\u5185\u5bb9\u4f9d\u65e7\u662f\u7ffb\u8bd1\u81eaTutorialspoint\u4e0a\u7684\u5165\u95e8\u6559\u7a0b\uff0c\u8fd9\u6b21\u662f Sed Tutorial \u4e00\u6587\uff0c\u5185\u5bb9\u505a\u4e86\u4e00\u4e9b\u5220\u51cf\u548c\u8865\u5145\uff0c\u589e\u52a0\u4e86\u4e00\u4e9b\u539f\u6587\u4e2d\u6ca1\u6709\u63d0\u53ca\u5230\u7684\u8bed\u6cd5\u548c\u547d\u4ee4\u7684\u8bb2\u89e3\uff0c\u5e76\u4e14\u5bf9\u539f\u6587\u6240\u6709\u7684\u793a\u4f8b\u90fd\u4e00\u4e00\u8fdb\u884c\u4e86\u9a8c\u8bc1\uff0c\u5e0c\u671b\u672c\u6587\u5bf9\u5927\u5bb6\u5b66\u4e60\u548c\u4e86\u89e3Sed\u6709\u6240\u5e2e\u52a9\u3002</p> <p>\u6587\u4e2d\u7528\u5230\u7684\u6d4b\u8bd5\u6587\u4ef6\u53ef\u4ee5\u5728 https://github.com/mylxsw/sed-demo\u627e\u5230\u3002</p> <p>\u672c\u6587\u5c06\u4f1a\u6301\u7eed\u4fee\u6b63\u548c\u66f4\u65b0\uff0c\u6700\u65b0\u5185\u5bb9\u8bf7\u53c2\u8003\u6211\u7684 GITHUB \u4e0a\u7684 \u7a0b\u5e8f\u733f\u6210\u957f\u8ba1\u5212 \u9879\u76ee\uff0c\u6b22\u8fce Star\u3002</p> <ul> <li>\u4e09\u5341\u5206\u949f\u5b66\u4f1aSED<ul> <li>\u6982\u8ff0<ul> <li>SED\u7684\u5178\u578b\u7528\u9014</li> </ul> </li> <li>\u5de5\u4f5c\u6d41<ul> <li>\u9700\u8981\u6ce8\u610f\u7684\u51e0\u70b9</li> <li>\u793a\u4f8b</li> </ul> </li> <li>\u57fa\u7840\u8bed\u6cd5<ul> <li>\u6807\u51c6\u9009\u9879</li> <li>GNU\u9009\u9879</li> </ul> </li> <li>\u5faa\u73af</li> <li>\u5206\u652f</li> <li>\u6a21\u5f0f\u7a7a\u95f4\u548c\u4fdd\u6301\u7a7a\u95f4<ul> <li>\u6a21\u5f0f\u7a7a\u95f4</li> <li>\u884c\u5bfb\u5740<ul> <li>\u6570\u5b57\u65b9\u5f0f\u7684\u884c\u5bfb\u5740</li> <li>\u4f7f\u7528\u6587\u672c\u6a21\u5f0f\u8fc7\u6ee4\u5668</li> </ul> </li> <li>\u4fdd\u6301\u7a7a\u95f4</li> </ul> </li> <li>\u57fa\u672c\u547d\u4ee4<ul> <li>\u5220\u9664\u547d\u4ee4  d</li> <li>\u6587\u4ef6\u5199\u5165\u547d\u4ee4 w</li> <li>\u8ffd\u52a0\u547d\u4ee4 a</li> <li>\u884c\u66ff\u6362\u547d\u4ee4 c</li> <li>\u63d2\u5165\u547d\u4ee4 i</li> <li>\u8f6c\u6362\u547d\u4ee4 y</li> <li>\u8f93\u51fa\u9690\u85cf\u5b57\u7b26\u547d\u4ee4 l</li> <li>\u9000\u51fa\u547d\u4ee4 q</li> <li>\u6587\u4ef6\u8bfb\u53d6\u547d\u4ee4 r</li> <li>\u6267\u884c\u5916\u90e8\u547d\u4ee4 e</li> <li>\u6392\u9664\u547d\u4ee4 !</li> <li>\u591a\u884c\u547d\u4ee4<ul> <li>N - \u52a0\u8f7d\u4e0b\u4e00\u884c</li> <li>D - \u5220\u9664\u591a\u884c\u4e2d\u7684\u4e00\u884c</li> <li>P - \u8f93\u51fa\u591a\u884c\u4e2d\u7684\u4e00\u884c</li> </ul> </li> <li>\u5176\u5b83\u547d\u4ee4<ul> <li>n - \u5355\u884cnext</li> <li>v - SED\u7248\u672c\u68c0\u67e5</li> </ul> </li> </ul> </li> <li>\u7279\u6b8a\u5b57\u7b26<ul> <li>=\u547d\u4ee4</li> <li>&amp;\u547d\u4ee4</li> </ul> </li> <li>\u5b57\u7b26\u4e32<ul> <li>\u66ff\u6362\u547d\u4ee4 s</li> <li>\u5339\u914d\u5b50\u5b57\u7b26\u4e32</li> </ul> </li> <li>\u7ba1\u7406\u6a21\u5f0f</li> <li>\u6b63\u5219\u8868\u8fbe\u5f0f<ul> <li>\u6807\u51c6\u6b63\u5219\u8868\u8fbe\u5f0f<ul> <li>^</li> <li>$</li> <li>.</li> <li>[]</li> <li>[\\^]</li> <li>[-]</li> <li>\\? \uff0c\\+ \uff0c*</li> <li>{n} \uff0c{n,} \uff0c{m, n}</li> <li>|</li> </ul> </li> <li>POSIX\u517c\u5bb9\u7684\u6b63\u5219</li> <li>\u5143\u5b57\u7b26<ul> <li>\\s</li> <li>\\S</li> <li>\\w \uff0c \\W</li> </ul> </li> </ul> </li> <li>\u5e38\u7528\u4ee3\u7801\u6bb5<ul> <li>Cat\u547d\u4ee4</li> <li>\u79fb\u9664\u7a7a\u884c</li> <li>\u5220\u9664\u8fde\u7eed\u7a7a\u884c</li> <li>\u5220\u9664\u5f00\u5934\u7684\u7a7a\u884c</li> <li>\u5220\u9664\u7ed3\u5c3e\u7684\u7a7a\u884c</li> <li>\u8fc7\u6ee4\u6240\u6709\u7684html\u6807\u7b7e</li> <li>\u4eceC++\u7a0b\u5e8f\u4e2d\u79fb\u9664\u6ce8\u91ca</li> <li>\u4e3a\u67d0\u4e9b\u884c\u6dfb\u52a0\u6ce8\u91ca</li> <li>\u5b9e\u73b0Wc -l\u547d\u4ee4</li> <li>\u6a21\u62df\u5b9e\u73b0head\u547d\u4ee4</li> <li>\u6a21\u62dftail -1\u547d\u4ee4</li> <li>\u6a21\u62dfDos2unix\u547d\u4ee4</li> <li>\u6a21\u62dfUnix2dos\u547d\u4ee4</li> <li>\u6a21\u62dfcat -E\u547d\u4ee4</li> <li>\u6a21\u62dfcat -ET\u547d\u4ee4</li> <li>\u6a21\u62dfnl\u547d\u4ee4</li> <li>\u6a21\u62dfcp\u547d\u4ee4</li> <li>\u6a21\u62dfexpand\u547d\u4ee4</li> <li>\u6a21\u62dftee\u547d\u4ee4</li> <li>\u6a21\u62dfcat -s\u547d\u4ee4</li> <li>\u6a21\u62dfgrep\u547d\u4ee4</li> <li>\u6a21\u62dfgrep -v\u547d\u4ee4</li> <li>\u6a21\u62dftr\u547d\u4ee4</li> </ul> </li> <li>\u5199\u5728\u6700\u540e</li> <li>\u53c2\u8003</li> </ul> </li> </ul>"},{"location":"sed/#_1","title":"\u6982\u8ff0","text":"<p>SED\u7684\u82f1\u6587\u5168\u79f0\u662f Stream EDitor\uff0c\u5b83\u662f\u4e00\u4e2a\u7b80\u5355\u800c\u5f3a\u5927\u7684\u6587\u672c\u89e3\u6790\u8f6c\u6362\u5de5\u5177\uff0c\u57281973-1974\u5e74\u671f\u95f4\u7531\u8d1d\u5c14\u5b9e\u9a8c\u5ba4\u7684Lee E. McMahon\u5f00\u53d1\uff0c\u4eca\u5929\uff0c\u5b83\u5df2\u7ecf\u8fd0\u884c\u5728\u6240\u6709\u7684\u4e3b\u6d41\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u4e86\u3002</p> <p>McMahon\u521b\u5efa\u4e86\u4e00\u4e2a\u901a\u7528\u7684\u884c\u7f16\u8f91\u5668\uff0c\u6700\u7ec8\u53d8\u6210\u4e3a\u4e86SED\u3002SED\u7684\u5f88\u591a\u8bed\u6cd5\u548c\u7279\u6027\u90fd\u501f\u9274\u4e86ed\u7f16\u8f91\u5668\u3002\u8bbe\u8ba1\u4e4b\u521d\uff0c\u5b83\u5c31\u5df2\u7ecf\u652f\u6301\u6b63\u5219\u8868\u8fbe\u5f0f\uff0cSED\u53ef\u4ee5\u4ece\u6587\u4ef6\u4e2d\u63a5\u53d7\u7c7b\u4f3c\u4e8e\u7ba1\u9053\u7684\u8f93\u5165\uff0c\u4e5f\u53ef\u4ee5\u63a5\u53d7\u6765\u81ea\u6807\u51c6\u8f93\u5165\u6d41\u7684\u8f93\u5165\u3002</p> <p>SED\u7531\u81ea\u7531\u8f6f\u4ef6\u57fa\u91d1\u7ec4\u7ec7\uff08FSF\uff09\u5f00\u53d1\u548c\u7ef4\u62a4\u5e76\u4e14\u968f\u7740GNU/Linux\u8fdb\u884c\u5206\u53d1\uff0c\u56e0\u6b64\uff0c\u901a\u5e38\u5b83\u4e5f\u79f0\u4f5c GNU SED\u3002\u5bf9\u4e8e\u65b0\u624b\u6765\u8bf4\uff0cSED\u7684\u8bed\u6cd5\u770b\u8d77\u6765\u53ef\u80fd\u6709\u4e9b\u795e\u79d8\uff0c\u4f46\u662f\uff0c\u4e00\u65e6\u638c\u63e1\u4e86\u5b83\u7684\u8bed\u6cd5\uff0c\u4f60\u5c31\u53ef\u4ee5\u53ea\u7528\u51e0\u884c\u4ee3\u7801\u53bb\u89e3\u51b3\u975e\u5e38\u590d\u6742\u7684\u4efb\u52a1\uff0c\u8fd9\u5c31\u662fSED\u7684\u9b45\u529b\u6240\u5728\u3002</p>"},{"location":"sed/#sed_1","title":"SED\u7684\u5178\u578b\u7528\u9014","text":"<p>SED\u7684\u7528\u9014\u975e\u5e38\u5e7f\u6cdb\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u6587\u672c\u66ff\u6362</li> <li>\u9009\u62e9\u6027\u7684\u8f93\u51fa\u6587\u672c\u6587\u4ef6</li> <li>\u4ece\u6587\u672c\u6587\u4ef6\u7684\u67d0\u5904\u5f00\u59cb\u7f16\u8f91</li> <li>\u65e0\u4ea4\u4e92\u5f0f\u7684\u5bf9\u6587\u672c\u6587\u4ef6\u8fdb\u884c\u7f16\u8f91\u7b49</li> </ul>"},{"location":"sed/#_2","title":"\u5de5\u4f5c\u6d41","text":"<p>\u5728\u672c\u7ae0\u4e2d\uff0c\u6211\u4eec\u5c06\u4f1a\u63a2\u7d22SED\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff0c\u8981\u60f3\u6210\u4e3a\u4e00\u4e2aSED\u4e13\u5bb6\uff0c\u4f60\u9700\u8981\u77e5\u9053\u5b83\u7684\u5185\u90e8\u5b9e\u73b0\u3002SED\u9075\u5faa\u7b80\u5355\u7684\u5de5\u4f5c\u6d41\uff1a\u8bfb\u53d6\uff0c\u6267\u884c\u548c\u663e\u793a\uff0c\u4e0b\u56fe\u63cf\u8ff0\u4e86\u8be5\u5de5\u4f5c\u6d41\uff1a</p> <ul> <li>\u8bfb\u53d6\uff1a SED\u4ece\u8f93\u5165\u6d41\uff08\u6587\u4ef6\uff0c\u7ba1\u9053\u6216\u8005\u6807\u51c6\u8f93\u5165\uff09\u4e2d\u8bfb\u53d6\u4e00\u884c\u5e76\u4e14\u5b58\u50a8\u5230\u5b83\u53eb\u505a \u6a21\u5f0f\u7a7a\u95f4\uff08pattern buffer\uff09 \u7684\u5185\u90e8\u7f13\u51b2\u533a</li> <li>\u6267\u884c\uff1a \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6240\u6709\u7684SED\u547d\u4ee4\u90fd\u5728\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u987a\u5e8f\u7684\u6267\u884c\uff0c\u9664\u975e\u6307\u5b9a\u4e86\u884c\u7684\u5730\u5740\uff0c\u5426\u5219SED\u547d\u4ee4\u5c06\u4f1a\u5728\u6240\u6709\u7684\u884c\u4e0a\u4f9d\u6b21\u6267\u884c</li> <li>\u663e\u793a\uff1a \u53d1\u9001\u4fee\u6539\u540e\u7684\u5185\u5bb9\u5230\u8f93\u51fa\u6d41\u3002\u5728\u53d1\u9001\u6570\u636e\u4e4b\u540e\uff0c\u6a21\u5f0f\u7a7a\u95f4\u5c06\u4f1a\u88ab\u6e05\u7a7a\u3002</li> <li>\u5728\u6587\u4ef6\u6240\u6709\u7684\u5185\u5bb9\u90fd\u88ab\u5904\u7406\u5b8c\u6210\u4e4b\u524d\uff0c\u4e0a\u8ff0\u8fc7\u7a0b\u5c06\u4f1a\u91cd\u590d\u6267\u884c</li> </ul>"},{"location":"sed/#_3","title":"\u9700\u8981\u6ce8\u610f\u7684\u51e0\u70b9","text":"<ul> <li>\u6a21\u5f0f\u7a7a\u95f4 \uff08pattern buffer\uff09 \u662f\u4e00\u5757\u6d3b\u8dc3\u7684\u7f13\u51b2\u533a\uff0c\u5728sed\u7f16\u8f91\u5668\u6267\u884c\u547d\u4ee4\u65f6\u5b83\u4f1a\u4fdd\u5b58\u5f85\u68c0\u67e5\u7684\u6587\u672c</li> <li>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6240\u6709\u7684SED\u547d\u4ee4\u90fd\u662f\u5728\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u6267\u884c\uff0c\u56e0\u6b64\u8f93\u5165\u6587\u4ef6\u5e76\u4e0d\u4f1a\u53d1\u751f\u6539\u53d8</li> <li>\u8fd8\u6709\u53e6\u5916\u4e00\u4e2a\u7f13\u51b2\u533a\u53eb\u505a \u4fdd\u6301\u7a7a\u95f4 \uff08hold buffer\uff09\uff0c\u5728\u5904\u7406\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u67d0\u4e9b\u884c\u65f6\uff0c\u53ef\u4ee5\u7528\u4fdd\u6301\u7a7a\u95f4\u6765\u4e34\u65f6\u4fdd\u5b58\u4e00\u4e9b\u884c\u3002\u5728\u6bcf\u4e00\u4e2a\u5faa\u73af\u7ed3\u675f\u7684\u65f6\u5019\uff0cSED\u5c06\u4f1a\u79fb\u9664\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u5185\u5bb9\uff0c\u4f46\u662f\u8be5\u7f13\u51b2\u533a\u4e2d\u7684\u5185\u5bb9\u5728\u6240\u6709\u7684\u5faa\u73af\u8fc7\u7a0b\u4e2d\u662f\u6301\u4e45\u5b58\u50a8\u7684\u3002SED\u547d\u4ee4\u65e0\u6cd5\u76f4\u63a5\u5728\u8be5\u7f13\u51b2\u533a\u4e2d\u6267\u884c\uff0c\u56e0\u6b64SED\u5141\u8bb8\u6570\u636e\u5728 \u4fdd\u6301\u7a7a\u95f4 \u548c \u6a21\u5f0f\u7a7a\u95f4\u4e4b\u95f4\u5207\u6362</li> <li>\u521d\u59cb\u60c5\u51b5\u4e0b\uff0c\u4fdd\u6301\u7a7a\u95f4 \u548c \u6a21\u5f0f\u7a7a\u95f4 \u8fd9\u4e24\u4e2a\u7f13\u51b2\u533a\u90fd\u662f\u7a7a\u7684</li> <li>\u5982\u679c\u6ca1\u6709\u63d0\u4f9b\u8f93\u5165\u6587\u4ef6\u7684\u8bdd\uff0cSED\u5c06\u4f1a\u4ece\u6807\u51c6\u8f93\u5165\u63a5\u6536\u8bf7\u6c42</li> <li>\u5982\u679c\u6ca1\u6709\u63d0\u4f9b\u5730\u5740\u8303\u56f4\u7684\u8bdd\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0bSED\u5c06\u4f1a\u5bf9\u6240\u6709\u7684\u884c\u8fdb\u884c\u64cd\u4f5c</li> </ul>"},{"location":"sed/#_4","title":"\u793a\u4f8b","text":"<p>\u8ba9\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a quote.txt \u7684\u6587\u672c\u6587\u4ef6\uff0c\u6587\u4ef6\u5185\u5bb9\u4e3a\u8457\u540d\u4f5c\u5bb6Paulo Coelho\u7684\u4e00\u6bb5\u540d\u8a00</p> <pre><code>$ vi quote.txt \nThere is only one thing that makes a dream impossible to achieve: the fear of failure. \n - Paulo Coelho, The Alchemist\n</code></pre> <p>\u4e3a\u4e86\u7406\u89e3SED\u7684\u5de5\u4f5c\u6d41\uff0c\u6211\u4eec\u9996\u5148\u4f7f\u7528SED\u663e\u793a\u51faquote.txt\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u8be5\u793a\u4f8b\u4e0e<code>cat</code>\u547d\u4ee4\u7c7b\u4f3c</p> <pre><code>$ sed '' quote.txt\nThere is only one thing that makes a dream impossible to achieve: the fear of failure.\n- Paulo Coelho, The Alchemist\n</code></pre> <p>\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0cquote.txt\u662f\u8f93\u5165\u7684\u6587\u4ef6\u540d\u79f0\uff0c\u4e24\u4e2a\u5355\u5f15\u53f7\u662f\u8981\u6267\u884c\u7684SED\u547d\u4ee4\u3002</p> <p>\u9996\u5148\uff0cSED\u5c06\u4f1a\u8bfb\u53d6quote.txt\u6587\u4ef6\u4e2d\u7684\u4e00\u884c\u5185\u5bb9\u5b58\u50a8\u5230\u5b83\u7684\u6a21\u5f0f\u7a7a\u95f4\u4e2d\uff0c\u7136\u540e\u4f1a\u5728\u8be5\u7f13\u51b2\u533a\u4e2d\u6267\u884cSED\u547d\u4ee4\u3002\u5728\u8fd9\u91cc\uff0c\u6ca1\u6709\u63d0\u4f9bSED\u547d\u4ee4\uff0c\u56e0\u6b64\u5bf9\u8be5\u7f13\u51b2\u533a\u6ca1\u6709\u8981\u6267\u884c\u7684\u64cd\u4f5c\uff0c\u6700\u540e\u5b83\u4f1a\u5220\u9664\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u5185\u5bb9\u5e76\u4e14\u6253\u5370\u8be5\u5185\u5bb9\u5230\u6807\u51c6\u8f93\u51fa\uff0c\u5f88\u7b80\u5355\u7684\u8fc7\u7a0b\uff0c\u5bf9\u5427?</p> <p>\u5728\u4e0b\u9762\u7684\u4f8b\u5b50\u4e2d\uff0cSED\u4f1a\u4ece\u6807\u51c6\u8f93\u5165\u6d41\u63a5\u53d7\u8f93\u5165</p> <pre><code>$ sed ''\n</code></pre> <p>\u5f53\u4e0a\u8ff0\u547d\u4ee4\u88ab\u6267\u884c\u7684\u65f6\u5019\uff0c\u5c06\u4f1a\u4ea7\u751f\u4e0b\u5217\u7ed3\u679c</p> <pre><code>There is only one thing that makes a dream impossible to achieve: the fear of failure. \nThere is only one thing that makes a dream impossible to achieve: the fear of failure.\n</code></pre> <p>\u5728\u8fd9\u91cc\uff0c\u7b2c\u4e00\u884c\u5185\u5bb9\u662f\u901a\u8fc7\u952e\u76d8\u8f93\u5165\u7684\u5185\u5bb9\uff0c\u7b2c\u4e8c\u884c\u662fSED\u8f93\u51fa\u7684\u5185\u5bb9\u3002</p> <p>\u4eceSED\u4f1a\u8bdd\u4e2d\u9000\u51fa\uff0c\u4f7f\u7528\u7ec4\u5408\u952e<code>ctrl-D (^D)</code></p>"},{"location":"sed/#_5","title":"\u57fa\u7840\u8bed\u6cd5","text":"<p>\u672c\u7ae0\u4e2d\u5c06\u4f1a\u4ecb\u7ecdSED\u4e2d\u7684\u57fa\u672c\u547d\u4ee4\u548c\u5b83\u7684\u547d\u4ee4\u884c\u4f7f\u7528\u65b9\u6cd5\u3002SED\u53ef\u4ee5\u7528\u4e0b\u5217\u4e24\u79cd\u65b9\u5f0f\u8c03\u7528\uff1a</p> <pre><code>sed [-n] [-e] 'command(s)' files \nsed [-n] -f scriptfile files\n</code></pre> <p>\u7b2c\u4e00\u79cd\u65b9\u5f0f\u5728\u547d\u4ee4\u884c\u4e2d\u4f7f\u7528\u5355\u5f15\u53f7\u6307\u5b9a\u8981\u6267\u884c\u7684\u547d\u4ee4\uff0c\u7b2c\u4e8c\u79cd\u65b9\u5f0f\u5219\u6307\u5b9a\u4e86\u5305\u542bSED\u547d\u4ee4\u7684\u811a\u672c\u6587\u4ef6\u3002\u5f53\u7136\uff0c\u8fd9\u4e24\u79cd\u65b9\u6cd5\u4e5f\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528\uff0cSED\u63d0\u4f9b\u4e86\u5f88\u591a\u53c2\u6570\u7528\u4e8e\u63a7\u5236\u8fd9\u79cd\u884c\u4e3a\u3002</p> <p>\u8ba9\u6211\u4eec\u770b\u770b\u5982\u4f55\u6307\u5b9a\u591a\u4e2aSED\u547d\u4ee4\u3002SED\u63d0\u4f9b\u4e86<code>delete</code>\u547d\u4ee4\u7528\u4e8e\u5220\u9664\u67d0\u4e9b\u884c\uff0c\u8fd9\u91cc\u8ba9\u6211\u4eec\u5220\u9664\u7b2c\u4e00\u884c\uff0c\u7b2c\u4e8c\u884c\u548c\u7b2c\u4e94\u884c\uff1a</p> <p>\u9996\u5148\uff0c\u4f7f\u7528<code>cat</code>\u547d\u4ee4\u663e\u793a\u6587\u4ef6\u5185\u5bb9</p> <pre><code>$ cat books.txt \n1) A Storm of Swords, George R. R. Martin, 1216 \n2) The Two Towers, J. R. R. Tolkien, 352 \n3) The Alchemist, Paulo Coelho, 197 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n5) The Pilgrimage, Paulo Coelho, 288 \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>\u73b0\u5728\uff0c\u4f7f\u7528SED\u79fb\u9664\u6307\u5b9a\u7684\u884c\uff0c\u4e3a\u4e86\u5220\u9664\u4e09\u884c\uff0c\u6211\u4eec\u4f7f\u7528<code>-e</code>\u9009\u9879\u6307\u5b9a\u4e09\u4e2a\u72ec\u7acb\u7684\u547d\u4ee4</p> <pre><code>$ sed -e '1d' -e '2d' -e '5d' books.txt\n3) The Alchemist, Paulo Coelho, 197\n4) The Fellowship of the Ring, J. R. R. Tolkien, 432\n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u5c06\u591a\u4e2aSED\u547d\u4ee4\u5199\u5728\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u5c06\u8be5\u6587\u4ef6\u4f5c\u4e3aSED\u547d\u4ee4\u7684\u53c2\u6570\uff0cSED\u53ef\u4ee5\u5bf9\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u5185\u5bb9\u6267\u884c\u6587\u4ef6\u4e2d\u7684\u6bcf\u4e00\u4e2a\u547d\u4ee4\uff0c\u4e0b\u9762\u7684\u4f8b\u5b50\u63cf\u8ff0\u4e86SED\u7684\u7b2c\u4e8c\u79cd\u7528\u6cd5</p> <p>\u9996\u5148\uff0c\u521b\u5efa\u4e00\u4e2a\u5305\u542bSED\u547d\u4ee4\u7684\u6587\u672c\u6587\u4ef6\uff0c\u4e3a\u4e86\u4fbf\u4e8e\u7406\u89e3\uff0c\u6211\u4eec\u4f7f\u7528\u4e0e\u4e4b\u524d\u76f8\u540c\u7684SED\u547d\u4ee4</p> <pre><code>$ echo -e \"1d\\n2d\\n5d\" &gt; commands.txt \n$ cat commands.txt\n1d \n2d \n5d\n</code></pre> <p>\u63a5\u4e0b\u6765\u6784\u9020\u4e00\u4e2aSED\u547d\u4ee4\u53bb\u6267\u884c\u8be5\u64cd\u4f5c</p> <pre><code>$ sed -f commands.txt books.txt\n3) The Alchemist, Paulo Coelho, 197\n4) The Fellowship of the Ring, J. R. R. Tolkien, 432\n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre>"},{"location":"sed/#_6","title":"\u6807\u51c6\u9009\u9879","text":"<p>SED\u652f\u6301\u4e0b\u5217\u6807\u51c6\u9009\u9879\uff1a</p> <ul> <li> <p>-n \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u5185\u5bb9\u5728\u5904\u7406\u5b8c\u6210\u540e\u5c06\u4f1a\u6253\u5370\u5230\u6807\u51c6\u8f93\u51fa\uff0c\u8be5\u9009\u9879\u7528\u4e8e\u963b\u6b62\u8be5\u884c\u4e3a</p> <pre><code>$ sed -n '' quote.txt\n</code></pre> </li> <li> <p>-e \u6307\u5b9a\u8981\u6267\u884c\u7684\u547d\u4ee4\uff0c\u4f7f\u7528\u8be5\u53c2\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\u547d\u4ee4\uff0c\u8ba9\u6211\u4eec\u6253\u5370\u6bcf\u4e00\u884c\u4e24\u6b21\uff1a</p> <pre><code>$ sed -e '' -e 'p' quote.txt\nThere is only one thing that makes a dream impossible to achieve: the fear of failure.\nThere is only one thing that makes a dream impossible to achieve: the fear of failure.\n - Paulo Coelho, The Alchemist\n - Paulo Coelho, The Alchemist\n</code></pre> </li> <li> <p>-f \u6307\u5b9a\u5305\u542b\u8981\u6267\u884c\u7684\u547d\u4ee4\u7684\u811a\u672c\u6587\u4ef6</p> <pre><code>$ echo \"p\" &gt; commands\n$\n$ sed -n -f commands quote.txt\nThere is only one thing that makes a dream impossible to achieve: the fear of failure.\n - Paulo Coelho, The Alchemist\n</code></pre> </li> </ul>"},{"location":"sed/#gnu","title":"GNU\u9009\u9879","text":"<p>\u8fd9\u4e9b\u9009\u9879\u662fGNU\u89c4\u8303\u5b9a\u4e49\u7684\uff0c\u53ef\u80fd\u5bf9\u4e8e\u67d0\u4e9b\u7248\u672c\u7684SED\u5e76\u4e0d\u652f\u6301\u3002</p> <ul> <li>-n\uff0c --quiet, --slient\uff1a\u4e0e\u6807\u51c6\u7684-n\u9009\u9879\u76f8\u540c</li> <li>-e script\uff0c--expression=script\uff1a\u4e0e\u6807\u51c6\u7684-e\u9009\u9879\u76f8\u540c</li> <li>-f script-file\uff0c --file=script-file\uff1a\u4e0e\u6807\u51c6\u7684-f\u9009\u9879\u76f8\u540c</li> <li>--follow-symlinks\uff1a\u5982\u679c\u63d0\u4f9b\u8be5\u9009\u9879\u7684\u8bdd\uff0c\u5728\u7f16\u8f91\u7684\u6587\u4ef6\u662f\u7b26\u53f7\u94fe\u63a5\u65f6\uff0cSED\u5c06\u4f1a\u8ddf\u968f\u94fe\u63a5</li> <li>-i[SUFFIX]\uff0c--in-place[=SUFFIX]\uff1a\u8be5\u9009\u9879\u7528\u4e8e\u5bf9\u5f53\u524d\u6587\u4ef6\u8fdb\u884c\u7f16\u8f91\uff0c\u5982\u679c\u63d0\u4f9b\u4e86SUFFIX\u7684\u8bdd\uff0c\u5c06\u4f1a\u5907\u4efd\u539f\u59cb\u6587\u4ef6\uff0c\u5426\u5219\u5c06\u4f1a\u8986\u76d6\u539f\u59cb\u6587\u4ef6</li> <li>-l N\uff0c --line-lenght=N\uff1a\u8be5\u9009\u9879\u7528\u4e8e\u8bbe\u7f6e\u884c\u7684\u957f\u5ea6\u4e3aN\u4e2a\u5b57\u7b26</li> <li>--posix\uff1a\u8be5\u9009\u9879\u7981\u7528\u6240\u6709\u7684GNU\u6269\u5c55</li> <li>-r\uff0c--regexp-extended\uff1a\u8be5\u9009\u9879\u5c06\u542f\u7528\u6269\u5c55\u7684\u6b63\u5219\u8868\u8fbe\u5f0f</li> <li>-u\uff0c --unbuffered\uff1a\u6307\u5b9a\u8be5\u9009\u9879\u7684\u65f6\u5019\uff0cSED\u5c06\u4f1a\u4ece\u8f93\u5165\u6587\u4ef6\u4e2d\u52a0\u8f7d\u6700\u5c11\u7684\u6570\u636e\uff0c\u5e76\u4e14\u66f4\u52a0\u9891\u7e41\u7684\u5237\u51fa\u5230\u8f93\u51fa\u7f13\u51b2\u533a\u3002\u5728\u7f16\u8f91<code>tail -f</code>\u547d\u4ee4\u7684\u8f93\u51fa\uff0c\u4f60\u4e0d\u5e0c\u671b\u7b49\u5f85\u8f93\u51fa\u7684\u65f6\u5019\u8be5\u9009\u9879\u662f\u975e\u5e38\u6709\u7528\u7684\u3002</li> <li>-z\uff0c--null-data\uff1a\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cSED\u5bf9\u6bcf\u4e00\u884c\u4f7f\u7528\u6362\u884c\u7b26\u5206\u5272\uff0c\u5982\u679c\u63d0\u4f9b\u4e86\u8be5\u9009\u9879\u7684\u8bdd\uff0c\u5b83\u5c06\u4f7f\u7528NULL\u5b57\u7b26\u5206\u5272\u884c</li> </ul>"},{"location":"sed/#_7","title":"\u5faa\u73af","text":"<p>\u4e0e\u5176\u5b83\u7f16\u7a0b\u8bed\u8a00\u7c7b\u4f3c\uff0cSED\u63d0\u4f9b\u4e86\u7528\u4e8e\u63a7\u5236\u6267\u884c\u6d41\u7684\u5faa\u73af\u548c\u5206\u652f\u8bed\u53e5\u3002</p> <p>SED\u4e2d\u7684\u5faa\u73af\u6709\u70b9\u7c7b\u4f3c\u4e8egoto\u8bed\u53e5\uff0cSED\u53ef\u4ee5\u6839\u636e\u6807\u7b7e\uff08label\uff09\u8df3\u8f6c\u5230\u67d0\u4e00\u884c\u7ee7\u7eed\u6267\u884c\uff0c\u5728SED\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u5982\u4e0b\u7684\u6807\u7b7e\uff1a</p> <pre><code>:label \n:start \n:end \n:up\n</code></pre> <p>\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u521b\u5efa\u4e86\u56db\u4e2a\u6807\u7b7e\u3002</p> <p>\u8981\u8df3\u8f6c\u5230\u6307\u5b9a\u7684\u6807\u7b7e\uff0c\u4f7f\u7528 b \u547d\u4ee4\u540e\u9762\u8ddf\u7740\u6807\u7b7e\u540d\uff0c\u5982\u679c\u5ffd\u7565\u6807\u7b7e\u540d\u7684\u8bdd\uff0cSED\u5c06\u4f1a\u8df3\u8f6c\u5230SED\u6587\u4ef6\u7684\u7ed3\u5c3e\u3002</p> <p>b\u6807\u7b7e\u7528\u4e8e\u65e0\u6761\u4ef6\u7684\u8df3\u8f6c\u5230\u6307\u5b9a\u7684label\u3002</p> <p>\u4e3a\u4e86\u66f4\u597d\u5730\u7406\u89e3SED\u4e2d\u7684\u5faa\u73af\u548c\u5206\u652f\uff0c\u8ba9\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u540d\u4e3abooks2.txt\u7684\u6587\u672c\u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u4e00\u4e9b\u56fe\u4e66\u7684\u6807\u9898\u548c\u4f5c\u8005\u4fe1\u606f\uff0c\u4e0b\u9762\u7684\u793a\u4f8b\u4e2d\u4f1a\u5408\u5e76\u56fe\u4e66\u7684\u6807\u9898\u548c\u4f5c\u8005\uff0c\u4f7f\u7528\u9017\u53f7\u5206\u9694\u3002\u4e4b\u540e\u641c\u7d22\u6240\u6709\u5339\u914d\u201cPaulo\u201d\u7684\u884c\uff0c\u5982\u679c\u5339\u914d\u7684\u8bdd\u5c31\u5728\u8fd9\u4e00\u884c\u7684\u5f00\u5934\u6dfb\u52a0<code>-</code>\uff0c\u5426\u5219\u8df3\u8f6c\u5230<code>Print</code>\u6807\u7b7e\uff0c\u6253\u5370\u51fa\u8be5\u884c\u5185\u5bb9\u3002</p> <pre><code>$ cat books2.txt\nA Storm of Swords\nGeorge R. R. Martin\nThe Two Towers\nJ. R. R. Tolkien\nThe Alchemist\nPaulo Coelho\nThe Fellowship of the Ring\nJ. R. R. Tolkien\nThe Pilgrimage\nPaulo Coelho\nA Game of Thrones\nGeorge R. R. Martin\n\n$ sed -n '\nh;n;H;x\ns/\\n/, /\n/Paulo/!b Print\ns/^/- /\n:Print\np' books2.txt\nA Storm of Swords , George R. R. Martin\nThe Two Towers , J. R. R. Tolkien\n- The Alchemist , Paulo Coelho\nThe Fellowship of the Ring , J. R. R. Tolkien\n- The Pilgrimage , Paulo Coelho\nA Game of Thrones , George R. R. Martin\n</code></pre> <p>\u4e4d\u770b\u6765\u4e0a\u8ff0\u7684\u4ee3\u7801\u975e\u5e38\u795e\u79d8\uff0c\u8ba9\u6211\u4eec\u9010\u6b65\u62c6\u89e3\u4e00\u4e0b</p> <ul> <li>\u7b2c\u4e00\u884c\u662f<code>h;n;H;x</code>\u8fd9\u51e0\u4e2a\u547d\u4ee4\uff0c\u8bb0\u5f97\u4e0a\u9762\u6211\u4eec\u63d0\u5230\u7684 \u4fdd\u6301\u7a7a\u95f4 \u5417\uff1f\u7b2c\u4e00\u4e2a<code>h</code>\u662f\u6307\u5c06\u5f53\u524d\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u5185\u5bb9\u8986\u76d6\u5230 \u4fdd\u6301\u7a7a\u95f4\u4e2d\uff0c<code>n</code>\u7528\u4e8e\u63d0\u524d\u8bfb\u53d6\u4e0b\u4e00\u884c\uff0c\u5e76\u4e14\u8986\u76d6\u5f53\u524d\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u8fd9\u4e00\u884c\uff0c<code>H</code>\u5c06\u5f53\u524d\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u5185\u5bb9\u8ffd\u52a0\u5230 \u4fdd\u6301\u7a7a\u95f4 \u4e2d\uff0c\u6700\u540e\u7684<code>x</code>\u7528\u4e8e\u4ea4\u6362\u6a21\u5f0f\u7a7a\u95f4\u548c\u4fdd\u6301\u7a7a\u95f4\u4e2d\u7684\u5185\u5bb9\u3002\u56e0\u6b64\u8fd9\u91cc\u5c31\u662f\u6307\u6bcf\u6b21\u8bfb\u53d6\u4e24\u884c\u653e\u5230\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u4ea4\u7ed9\u4e0b\u9762\u7684\u547d\u4ee4\u8fdb\u884c\u5904\u7406</li> <li>\u63a5\u4e0b\u6765\u662f s/\\n/, / \u7528\u4e8e\u5c06\u4e0a\u9762\u7684\u4e24\u884c\u5185\u5bb9\u4e2d\u7684\u6362\u884c\u7b26\u66ff\u6362\u4e3a\u9017\u53f7</li> <li>\u7b2c\u4e09\u4e2a\u547d\u4ee4\u5728\u4e0d\u5339\u914d\u7684\u65f6\u5019\u8df3\u8f6c\u5230Print\u6807\u7b7e\uff0c\u5426\u5219\u7ee7\u7eed\u6267\u884c\u7b2c\u56db\u4e2a\u547d\u4ee4</li> <li>:Print\u4ec5\u4ec5\u662f\u4e00\u4e2a\u6807\u7b7e\u540d\uff0c\u800c<code>p</code>\u5219\u662fprint\u547d\u4ee4</li> </ul> <p>\u4e3a\u4e86\u63d0\u9ad8\u53ef\u8bfb\u6027\uff0c\u6bcf\u4e00\u4e2a\u547d\u4ee4\u90fd\u5360\u4e86\u4e00\u884c\uff0c\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u628a\u6240\u6709\u547d\u4ee4\u653e\u5728\u4e00\u884c</p> <pre><code>$ sed -n 'h;n;H;x;s/\\n/, /;/Paulo/!b Print; s/^/- /; :Print;p' books2.txt\n</code></pre> <p>\u5173\u4e8e<code>h</code>\uff0c<code>H</code>\uff0c<code>x</code>\u547d\u4ee4\u53c2\u8003\u5b98\u65b9\u624b\u518c sed, a stream editor 3.6 Less Frequently-Used Commands\u8282</p>"},{"location":"sed/#_8","title":"\u5206\u652f","text":"<p>\u4f7f\u7528 t \u547d\u4ee4\u521b\u5efa\u5206\u652f\u3002\u53ea\u6709\u5f53\u524d\u7f6e\u6761\u4ef6\u6210\u529f\u7684\u65f6\u5019\uff0ct \u547d\u4ee4\u624d\u4f1a\u8df3\u8f6c\u5230\u8be5\u6807\u7b7e\u3002</p> <p>t\u547d\u4ee4\u53ea\u6709\u5728\u524d\u4e00\u4e2a\u66ff\u6362\uff08s\uff09\u547d\u4ee4\u6267\u884c\u6210\u529f\u7684\u65f6\u5019\u624d\u4f1a\u6267\u884c\u3002</p> <p>\u8ba9\u6211\u4eec\u770b\u4e00\u4e9b\u524d\u9762\u7ae0\u8282\u4e2d\u7684\u4f8b\u5b50\uff0c\u4e0e\u4e4b\u524d\u4e0d\u540c\u7684\u662f\uff0c\u8fd9\u6b21\u6211\u4eec\u5c06\u6253\u5370\u56db\u4e2a\u8fde\u5b57\u7b26\"-\"\uff0c\u800c\u4e4b\u524d\u662f\u4e00\u4e2a\u3002</p> <pre><code>$ sed -n '\nh;n;H;x\ns/\\n/, /\n:Loop\n/Paulo/s/^/-/\n/----/!t Loop\np' books2.txt\nA Storm of Swords , George R. R. Martin\nThe Two Towers , J. R. R. Tolkien\n----The Alchemist , Paulo Coelho\nThe Fellowship of the Ring , J. R. R. Tolkien\n----The Pilgrimage , Paulo Coelho\nA Game of Thrones , George R. R. Martin\n</code></pre> <p>\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u524d\u9762\u4e24\u884c\u4e0e\u4e0a\u4e00\u8282\u4e2d\u8bb2\u7684\u4f5c\u7528\u4e00\u81f4\uff0c\u7b2c\u4e09\u884c\u5b9a\u4e49\u4e86\u4e00\u4e2aLoop\u6807\u7b7e\uff0c\u63a5\u4e0b\u6765\u5339\u914d\u5b58\u5728\u201cPaulo\u201d\u7684\u884c\uff0c\u5982\u679c\u5b58\u5728\u5219\u5728\u6700\u524d\u9762\u6dfb\u52a0\u4e00\u4e2a-\uff0c\u63a5\u4e0b\u6765\u662f\u6211\u4eec\u8fd9\u91cc\u7684\u91cd\u70b9\uff1a</p> <p><code>/----/!t Loop</code>\u8fd9\u4e00\u884c\u9996\u5148\u68c0\u67e5\u4e0a\u9762\u6dfb\u52a0<code>-</code>\u4e4b\u540e\u662f\u5426\u6ee1\u8db3\u56db\u4e2a<code>-</code>\uff0c\u5982\u679c\u4e0d\u6ee1\u8db3\u5219\u8df3\u8f6c\u5230Loop\u7ee7\u7eed\u6267\u884c\u7b2c\u4e09\u884c\uff0c\u8fd9\u6837\u4e0d\u505c\u7684\u8ffd\u52a0<code>-</code>\uff0c\u6700\u540e\u5982\u679c\u6539\u884c\u6ee1\u8db3\u524d\u9762\u6709\u56db\u4e2a<code>-</code>\u624d\u7ee7\u7eed\u5f80\u4e0b\u6267\u884c\u3002 </p> <p>\u4e3a\u4e86\u63d0\u9ad8\u53ef\u8bfb\u6027\uff0c\u6211\u4eec\u5c06\u6bcf\u4e00\u4e2aSED\u547d\u4ee4\u72ec\u7acb\u4e00\u884c\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u540c\u4e00\u884c\u4e2d\u4f7f\u7528\uff1a</p> <pre><code> sed -n 'h;n;H;x; s/\\n/, /; :Loop;/Paulo/s/^/-/; /----/!t Loop; p' books.txt\n</code></pre>"},{"location":"sed/#_9","title":"\u6a21\u5f0f\u7a7a\u95f4\u548c\u4fdd\u6301\u7a7a\u95f4","text":""},{"location":"sed/#_10","title":"\u6a21\u5f0f\u7a7a\u95f4","text":"<p>\u5bf9\u4efb\u4f55\u6587\u4ef6\u7684\u6765\u8bf4\uff0c\u6700\u57fa\u672c\u7684\u64cd\u4f5c\u5c31\u662f\u8f93\u51fa\u5b83\u7684\u5185\u5bb9\uff0c\u4e3a\u4e86\u5b9e\u73b0\u8be5\u76ee\u7684\uff0c\u5728SED\u4e2d\u53ef\u4ee5\u4f7f\u7528print\u547d\u4ee4\u6253\u5370\u51fa\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u5185\u5bb9\u3002</p> <p>\u9996\u5148\u521b\u5efa\u4e00\u4e2a\u5305\u542b\u884c\u53f7\uff0c\u4e66\u540d\uff0c\u4f5c\u8005\u548c\u9875\u7801\u6570\u7684\u6587\u4ef6\uff0c\u5728\u672c\u6587\u4e2d\u6211\u4eec\u5c06\u4f1a\u4f7f\u7528\u8be5\u6587\u4ef6\uff0c\u4f60\u4e5f\u53ef\u4ee5\u521b\u5efa\u4efb\u4f55\u5176\u5b83\u7684\u6587\u4ef6\uff0c\u4f46\u662f\u8fd9\u91cc\u6211\u4eec\u5c31\u521b\u5efa\u4e00\u4e2a\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\u7684\u6587\u4ef6</p> <pre><code>$ vi books.txt \n1) A Storm of Swords, George R. R. Martin, 1216 \n2) The Two Towers, J. R. R. Tolkien, 352 \n3) The Alchemist, Paulo Coelho, 197 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n5) The Pilgrimage, Paulo Coelho,288 \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>\u6267\u884c<code>p</code>\u547d\u4ee4</p> <pre><code>$ sed 'p' books.txt\n1) A Storm of Swords, George R. R. Martin, 1216 \n1) A Storm of Swords, George R. R. Martin, 1216 \n2) The Two Towers, J. R. R. Tolkien, 352 \n2) The Two Towers, J. R. R. Tolkien, 352 \n3) The Alchemist, Paulo Coelho, 197 \n3) The Alchemist, Paulo Coelho, 197 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n5) The Pilgrimage, Paulo Coelho, 288 \n5) The Pilgrimage, Paulo Coelho, 288 \n6) A Game of Thrones, George R. R. Martin, 864 \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>\u4f60\u53ef\u80fd\u4f1a\u7591\u60d1\uff0c\u4e3a\u4ec0\u4e48\u6bcf\u4e00\u884c\u88ab\u663e\u793a\u4e86\u4e24\u6b21\uff1f</p> <p>\u4f60\u8fd8\u8bb0\u5f97SED\u7684\u5de5\u4f5c\u6d41\u5417\uff1f\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cSED\u5c06\u4f1a\u8f93\u51fa\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u5185\u5bb9\uff0c\u53e6\u5916\uff0c\u6211\u4eec\u7684\u547d\u4ee4\u4e2d\u5305\u542b\u4e86\u8f93\u51fa\u547d\u4ee4<code>p</code>\uff0c\u56e0\u6b64\u6bcf\u4e00\u884c\u88ab\u6253\u5370\u4e24\u6b21\u3002\u4f46\u662f\u4e0d\u8981\u62c5\u5fc3\uff0cSED\u63d0\u4f9b\u4e86-n\u53c2\u6570\u7528\u4e8e\u7981\u6b62\u81ea\u52a8\u8f93\u51fa\u6a21\u5f0f\u7a7a\u95f4\u7684\u6bcf\u4e00\u884c\u7684\u884c\u4e3a</p> <pre><code>$ sed -n 'p' books.txt \n1) A Storm of Swords, George R. R. Martin, 1216 \n2) The Two Towers, J. R. R. Tolkien, 352 \n3) The Alchemist, Paulo Coelho, 197 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n5) The Pilgrimage, Paulo Coelho, 288 \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre>"},{"location":"sed/#_11","title":"\u884c\u5bfb\u5740","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728SED\u4e2d\u4f7f\u7528\u7684\u547d\u4ee4\u4f1a\u4f5c\u7528\u4e8e\u6587\u672c\u6570\u636e\u7684\u6240\u6709\u884c\u3002\u5982\u679c\u53ea\u60f3\u5c06\u547d\u4ee4\u4f5c\u7528\u4e8e\u7279\u5b9a\u7684\u884c\u6216\u8005\u67d0\u4e9b\u884c\uff0c\u5219\u9700\u8981\u4f7f\u7528 \u884c\u5bfb\u5740 \u529f\u80fd\u3002</p> <p>\u5728SED\u4e2d\u5305\u542b\u4e24\u79cd\u5f62\u5f0f\u7684\u884c\u5bfb\u5740\uff1a</p> <ul> <li>\u4ee5\u6570\u5b57\u5f62\u5f0f\u8868\u793a\u7684\u884c\u533a\u95f4</li> <li>\u4ee5\u6587\u672c\u6a21\u5f0f\u6765\u8fc7\u6ee4\u884c</li> </ul> <p>\u4e24\u79cd\u5f62\u5f0f\u90fd\u4f7f\u7528\u76f8\u540c\u7684\u8bed\u6cd5\u683c\u5f0f</p> <pre><code>[address]command\n</code></pre>"},{"location":"sed/#_12","title":"\u6570\u5b57\u65b9\u5f0f\u7684\u884c\u5bfb\u5740","text":"<p>\u5728\u4e0b\u9762\u7684\u793a\u4f8b\u4e2dSED\u53ea\u4f1a\u5bf9\u7b2c3\u884c\u8fdb\u884c\u64cd\u4f5c</p> <pre><code>$ sed -n '3p' books.txt \n3) The Alchemist, Paulo Coelho, 197\n</code></pre> <p>\u5f53\u7136\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u8ba9SED\u8f93\u51fa\u67d0\u4e9b\u884c\u3002\u5728SED\u4e2d\u4f7f\u7528\u9017\u53f7,\u5206\u9694\u8f93\u51fa\u884c\u53f7\u7684\u8303\u56f4\uff0c\u4f8b\u5982\u4e0b\u9762\u7684\u4ee3\u7801\u4f1a\u8f93\u51fa\u51fa2-5\u884c\u7684\u5185\u5bb9</p> <pre><code>$ sed -n '2,5 p' books.txt \n2) The Two Towers, J. R. R. Tolkien, 352 \n3) The Alchemist, Paulo Coelho, 197 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n5) The Pilgrimage, Paulo Coelho, 288\n</code></pre> <p>\u7279\u6b8a\u5b57\u7b26 $ \u4ee3\u8868\u4e86\u6587\u4ef6\u7684\u6700\u540e\u4e00\u884c\uff0c\u8f93\u51fa\u6587\u4ef6\u7684\u6700\u540e\u4e00\u884c</p> <pre><code>$ sed -n '$ p' books.txt \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528 $ \u6307\u5b9a\u8f93\u51fa\u7684\u5730\u5740\u8303\u56f4\uff0c\u4e0b\u5217\u547d\u4ee4\u8f93\u51fa\u7b2c\u4e09\u884c\u5230\u6700\u540e\u4e00\u884c</p> <pre><code>$ sed -n '3,$ p' books.txt\n3) The Alchemist, Paulo Coelho, 197\n4) The Fellowship of the Ring, J. R. R. Tolkien, 432\n5) The Pilgrimage, Paulo Coelho,288\n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>SED\u8fd8\u63d0\u4f9b\u4e86\u53e6\u5916\u4e24\u79cd\u64cd\u4f5c\u7b26\u7528\u4e8e\u6307\u5b9a\u5730\u5740\u8303\u56f4\uff0c\u7b2c\u4e00\u4e2a\u662f\u52a0\u53f7\uff08+\uff09\u64cd\u4f5c\u7b26\uff0c\u5b83\u53ef\u4ee5\u4e0e\u9017\u53f7\uff08,\uff09\u64cd\u4f5c\u7b26\u4e00\u8d77\u4f7f\u7528\uff0c\u4f8b\u5982 <code>M, +n</code> \u5c06\u4f1a\u6253\u5370\u51fa\u4ece\u7b2c<code>M</code>\u884c\u5f00\u59cb\u7684\u4e0b<code>n</code>\u884c\u3002\u4e0b\u9762\u7684\u793a\u4f8b\u5c06\u4f1a\u8f93\u51fa\u7b2c\u4e8c\u884c\u5f00\u59cb\u7684\u4e0b\u9762\u56db\u884c</p> <pre><code>$ sed -n '2,+4 p' books.txt \n2) The Two Towers, J. R. R. Tolkien, 352 \n3) The Alchemist, Paulo Coelho, 197 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n5) The Pilgrimage, Paulo Coelho, 288 \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u4f7f\u7528\u6ce2\u6d6a\u7ebf\u64cd\u4f5c\u7b26\uff08~\uff09\u6307\u5b9a\u5730\u5740\u8303\u56f4\uff0c\u5b83\u4f7f\u7528<code>M~N</code>\u7684\u5f62\u5f0f\uff0c\u5b83\u544a\u8bc9SED\u5e94\u8be5\u5904\u7406<code>M</code>\u884c\u5f00\u59cb\u7684\u6bcf<code>N</code>\u884c\u3002\u4f8b\u5982\uff0c<code>50~5</code>\u5339\u914d\u884c\u53f750\uff0c55\uff0c60\uff0c65\u7b49\uff0c\u8ba9\u6211\u4eec\u53ea\u8f93\u51fa\u6587\u4ef6\u4e2d\u7684\u5947\u6570\u884c</p> <pre><code>$ sed -n '1~2 p' books.txt \n1) A Storm of Swords, George R. R. Martin, 1216 \n3) The Alchemist, Paulo Coelho, 197 \n5) The Pilgrimage, Paulo Coelho, 288\n</code></pre> <p>\u4e0b\u9762\u7684\u4ee3\u7801\u5219\u662f\u53ea\u8f93\u51fa\u6587\u4ef6\u4e2d\u7684\u5076\u6570\u884c</p> <pre><code>$ sed -n '2~2 p' books.txt \n2) The Two Towers, J. R. R. Tolkien, 352 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>\u6ce8\u610f\uff0c\u5982\u679c\u4f7f\u7528\u7684\u662fMac\u7cfb\u7edf\u81ea\u5e26\u7684sed\u547d\u4ee4\uff0c\u53ef\u80fd\u4e0d\u652f\u6301~\u548c+\u64cd\u4f5c\u7b26\u3002\u53ef\u4ee5\u4f7f\u7528<code>brew install gnu-sed --with-default-names</code>\u91cd\u65b0\u5b89\u88c5GNU-SED\u3002</p>"},{"location":"sed/#_13","title":"\u4f7f\u7528\u6587\u672c\u6a21\u5f0f\u8fc7\u6ee4\u5668","text":"<p>SED\u7f16\u8f91\u5668\u5141\u8bb8\u6307\u5b9a\u6587\u672c\u6a21\u5f0f\u6765\u8fc7\u6ee4\u51fa\u547d\u4ee4\u8981\u4f5c\u7528\u7684\u884c\u3002\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>/pattern/command\n</code></pre> <p>\u5fc5\u987b\u7528\u6b63\u659c\u7ebf\u5c06\u8981\u6307\u5b9a\u7684pattern\u5c01\u8d77\u6765\u3002sed\u7f16\u8f91\u5668\u4f1a\u5c06\u8be5\u547d\u4ee4\u4f5c\u7528\u5230\u5305\u542b\u6307\u5b9a\u6587\u672c\u6a21\u5f0f\u7684\u884c\u4e0a\u3002</p> <p>\u4e0b\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u5c06\u4f1a\u8f93\u51fa\u6240\u6709\u4f5c\u8005\u4e3aPaulo Coelho\u7684\u4e66\u7c4d\u3002</p> <pre><code>$ sed -n '/Paulo/ p' books.txt\n3) The Alchemist, Paulo Coelho, 197 \n5) The Pilgrimage, Paulo Coelho, 288\n</code></pre> <p>\u6a21\u5f0f\u5339\u914d\u4e5f\u53ef\u4ee5\u4e0e\u6570\u5b57\u5f62\u5f0f\u7684\u5bfb\u5740\u540c\u65f6\u4f7f\u7528\uff0c\u5728\u4e0b\u9762\u7684\u793a\u4f8b\u4f1a\u4ece\u7b2c\u4e00\u6b21\u5339\u914d\u5230<code>Alchemist</code>\u5f00\u59cb\u8f93\u51fa\uff0c\u76f4\u5230\u7b2c5\u884c\u4e3a\u6b62\u3002</p> <pre><code>$ sed -n '/Alchemist/, 5 p' books.txt\n3) The Alchemist, Paulo Coelho, 197 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n5) The Pilgrimage, Paulo Coelho, 288\n</code></pre> <p>\u4f7f\u7528\u9017\u53f7\uff08,\uff09\u64cd\u4f5c\u7b26\u6307\u5b9a\u5339\u914d\u591a\u4e2a\u5339\u914d\u7684\u6a21\u5f0f\u3002\u4e0b\u5217\u7684\u793a\u4f8b\u5c06\u4f1a\u8f93\u51faTwo\u548cPilgrimage\u4e4b\u95f4\u7684\u6240\u6709\u884c</p> <pre><code>$ sed -n '/Two/, /Pilgrimage/ p' books.txt \n2) The Two Towers, J. R. R. Tolkien, 352 \n3) The Alchemist, Paulo Coelho, 197 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n5) The Pilgrimage, Paulo Coelho, 288\n</code></pre> <p>\u5728\u4f7f\u7528\u6587\u672c\u6a21\u5f0f\u8fc7\u6ee4\u5668\u7684\u65f6\u5019\uff0c\u4e0e\u6570\u5b57\u65b9\u5f0f\u7684\u884c\u5bfb\u5740\u7c7b\u4f3c\uff0c\u53ef\u4ee5\u4f7f\u7528\u52a0\u53f7\u64cd\u4f5c\u7b26 +\uff0c\u5b83\u4f1a\u8f93\u51fa\u4ece\u5f53\u524d\u5339\u914d\u4f4d\u7f6e\u5f00\u59cb\u7684\u67d0\u51e0\u884c\uff0c\u4e0b\u9762\u7684\u793a\u4f8b\u4f1a\u4ece\u7b2c\u4e00\u6b21Two\u51fa\u73b0\u7684\u4f4d\u7f6e\u5f00\u59cb\u8f93\u51fa\u63a5\u4e0b\u6765\u76844\u884c</p> <pre><code>$ sed -n '/Two/, +4 p' books.txt\n2) The Two Towers, J. R. R. Tolkien, 352 \n3) The Alchemist, Paulo Coelho, 197 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n5) The Pilgrimage, Paulo Coelho, 288 \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre>"},{"location":"sed/#_14","title":"\u4fdd\u6301\u7a7a\u95f4","text":"<p>\u5728\u5904\u7406\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u67d0\u4e9b\u884c\u65f6\uff0c\u53ef\u4ee5\u7528\u4fdd\u6301\u7a7a\u95f4\u6765\u4e34\u65f6\u4fdd\u5b58\u4e00\u4e9b\u884c\u3002\u67095\u6761\u547d\u4ee4\u53ef\u7528\u6765\u64cd\u4f5c\u4fdd\u6301\u7a7a\u95f4</p> \u547d\u4ee4 \u63cf\u8ff0 h \u5c06\u6a21\u5f0f\u7a7a\u95f4\u590d\u5236\u5230\u4fdd\u6301\u7a7a\u95f4 H \u5c06\u6a21\u5f0f\u7a7a\u95f4\u9644\u52a0\u5230\u4fdd\u6301\u7a7a\u95f4 g \u5c06\u4fdd\u6301\u7a7a\u95f4\u590d\u5236\u5230\u6a21\u5f0f\u7a7a\u95f4 G \u5c06\u4fdd\u6301\u7a7a\u95f4\u9644\u52a0\u5230\u6a21\u5f0f\u7a7a\u95f4 x \u4ea4\u6362\u6a21\u5f0f\u7a7a\u95f4\u548c\u4fdd\u6301\u7a7a\u95f4\u7684\u5185\u5bb9 <p>\u5173\u4e8e\u4fdd\u6301\u7a7a\u95f4\u8fd9\u91cc\u5c31\u4e0d\u5728\u4e3e\u4f8b\u4e86\uff0c\u524d\u9762\u518d\u5faa\u73af\u90e8\u5206\u8bb2\u89e3\u4e0b\u9762\u8fd9\u4e2a\u547d\u4ee4\u7684\u65f6\u5019\u6211\u4eec\u5df2\u7ecf\u5bf9\u5b83\u7684\u4f7f\u7528\u505a\u4e86\u8bf4\u660e\u3002</p> <pre><code> $ sed -n 'h;n;H;x;s/\\n/, /;/Paulo/!b Print; s/^/- /; :Print;p' books2.txt\n</code></pre>"},{"location":"sed/#_15","title":"\u57fa\u672c\u547d\u4ee4","text":"<p>\u672c\u7ae0\u5c06\u4f1a\u8bb2\u89e3\u4e00\u4e9b\u5e38\u7528\u7684SED\u547d\u4ee4\uff0c\u4e3b\u8981\u5305\u62ec<code>DELETE</code>\uff0c<code>WRITE</code>\uff0c<code>APPEND</code>\uff0c<code>CHANGE</code>\uff0c<code>INSERT</code>\uff0c<code>TRANSLATE</code>\uff0c<code>QUIT</code>\uff0c<code>READ</code>\uff0c<code>EXECUTE</code>\u7b49\u547d\u4ee4\u3002</p>"},{"location":"sed/#d","title":"\u5220\u9664\u547d\u4ee4  d","text":"<p>\u5220\u9664\u547d\u4ee4\u683c\u5f0f\u5982\u4e0b</p> <pre><code>[address1[,address2]]d\n</code></pre> <p><code>address1</code>\u548c<code>address2</code>\u662f\u5f00\u59cb\u548c\u622a\u6b62\u5730\u5740\uff0c\u5b83\u4eec\u53ef\u4ee5\u662f\u884c\u53f7\u6216\u8005\u5b57\u7b26\u4e32\u5339\u914d\u6a21\u5f0f\uff0c\u8fd9\u4e24\u79cd\u5730\u5740\u90fd\u662f\u53ef\u9009\u7684\u3002</p> <p>\u7531\u547d\u4ee4\u7684\u540d\u79f0\u53ef\u4ee5\u77e5\u9053\uff0cdelete \u547d\u4ee4\u662f\u7528\u6765\u6267\u884c\u5220\u9664\u64cd\u4f5c\u7684\uff0c\u5e76\u4e14\u56e0\u4e3aSED\u662f\u57fa\u4e8e\u884c\u7684\u7f16\u8f91\u5668\uff0c\u56e0\u6b64\u6211\u4eec\u8bf4\u8be5\u547d\u4ee4\u662f\u7528\u6765\u5220\u9664\u884c\u7684\u3002\u6ce8\u610f\u7684\u662f\uff0c\u8be5\u547d\u4ee4\u53ea\u4f1a\u79fb\u9664\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u884c\uff0c\u8fd9\u6837\u8be5\u884c\u5c31\u4e0d\u4f1a\u88ab\u53d1\u9001\u5230\u8f93\u51fa\u6d41\uff0c\u4f46\u539f\u59cb\u5185\u5bb9\u4e0d\u4f1a\u6539\u53d8\u3002</p> <pre><code>$ sed 'd' books.txt\n</code></pre> <p>\u4e3a\u4ec0\u4e48\u6ca1\u6709\u8f93\u51fa\u4efb\u4f55\u5185\u5bb9\uff1f\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cSED\u5c06\u4f1a\u5bf9\u6bcf\u4e00\u884c\u6267\u884c\u5220\u9664\u64cd\u4f5c\uff0c\u8fd9\u5c31\u662f\u8be5\u547d\u4ee4\u4e3a\u4ec0\u4e48\u6ca1\u6709\u5728\u6807\u51c6\u8f93\u51fa\u4e2d\u8f93\u51fa\u4efb\u4f55\u5185\u5bb9\u7684\u539f\u56e0\u3002</p> <p>\u4e0b\u5217\u547d\u4ee4\u53ea\u79fb\u9664\u7b2c\u56db\u884c</p> <pre><code>[jerry]$ sed '4d' books.txt \n1) A Storm of Swords, George R. R. Martin, 1216 \n2) The Two Towers, J. R. R. Tolkien, 352 \n3) The Alchemist, Paulo Coelho, 197 \n5) The Pilgrimage, Paulo Coelho, 288 \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>SED\u4e5f\u63a5\u53d7\u4f7f\u7528\u9017\u53f7(,)\u5206\u9694\u7684\u5730\u5740\u8303\u56f4\u3002\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u5730\u5740\u8303\u56f4\u53bb\u79fb\u9664N1\u5230N2\u884c\uff0c\u4f8b\u5982\uff0c\u4e0b\u5217\u547d\u4ee4\u5c06\u5220\u96642-4\u884c</p> <pre><code>$ sed '2, 4 d' books.txt     \n1) A Storm of Swords, George R. R. Martin, 1216 \n5) The Pilgrimage, Paulo Coelho, 288 \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>SED\u7684\u5730\u5740\u8303\u56f4\u5e76\u4e0d\u4ec5\u4ec5\u9650\u4e8e\u6570\u5b57\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u6307\u5b9a\u6a21\u5f0f\u5339\u914d\u4f5c\u4e3a\u5730\u5740\uff0c\u4e0b\u9762\u7684\u793a\u4f8b\u4f1a\u79fb\u9664\u6240\u6709\u4f5c\u8005\u4e3aPaulo Coelho\u7684\u4e66\u7c4d</p> <pre><code>$ sed '/Paulo Coelho/d' books.txt \n1) A Storm of Swords, George R. R. Martin, 1216 \n2) The Two Towers, J. R. R. Tolkien, 352 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>\u6211\u79fb\u9664\u6240\u6709\u4ee5<code>Storm</code>\u548c<code>Fellowship</code>\u5f00\u5934\u7684\u884c</p> <pre><code>$ sed '/Storm/,/Fellowship/d' books.txt  \n5) The Pilgrimage, Paulo Coelho, 288 \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre>"},{"location":"sed/#w","title":"\u6587\u4ef6\u5199\u5165\u547d\u4ee4 w","text":"<p>SED\u63d0\u4f9b\u4e86 write \u547d\u4ee4\u7528\u4e8e\u5c06\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u5185\u5bb9\u5199\u5165\u5230\u6587\u4ef6\uff0c\u4e0e delete \u547d\u4ee4\u7c7b\u4f3c\uff0c\u4e0b\u9762\u662f write \u547d\u4ee4\u7684\u8bed\u6cd5</p> <pre><code>[address1[,address2]]w file\n</code></pre> <p>w \u6307\u5b9a\u662f\u5199\u547d\u4ee4\uff0c file \u6307\u7684\u662f\u5b58\u50a8\u6587\u4ef6\u5185\u5bb9\u7684\u6587\u4ef6\u540d\u3002\u4f7f\u7528 file \u64cd\u4f5c\u7b26\u7684\u65f6\u5019\u8981\u5c0f\u5fc3\uff0c\u5f53\u63d0\u4f9b\u4e86\u6587\u4ef6\u540d\u4f46\u662f\u6587\u4ef6\u4e0d\u5b58\u5728\u7684\u65f6\u5019\u5b83\u4f1a\u81ea\u52a8\u521b\u5efa\uff0c\u5982\u679c\u5df2\u7ecf\u5b58\u5728\u7684\u8bdd\u5219\u4f1a\u8986\u76d6\u539f\u6587\u4ef6\u7684\u5185\u5bb9\u3002</p> <p>\u4e0b\u9762\u7684SED\u547d\u4ee4\u4f1a\u521b\u5efa\u6587\u4ef6books.txt\u7684\u526f\u672c\uff0c\u5728 w \u548c file \u4e4b\u95f4\u53ea\u80fd\u6709\u4e00\u4e2a\u7a7a\u683c</p> <pre><code>$ sed -n 'w books.bak' books.txt\n</code></pre> <p>\u4e0a\u8ff0\u547d\u4ee4\u521b\u5efa\u4e86\u4e00\u4e2a\u540d\u4e3a books.bak \u7684\u6587\u4ef6\uff0c\u9a8c\u8bc1\u4e00\u4e0b\u4e24\u4e2a\u6587\u4ef6\u7684\u5185\u5bb9\u662f\u5426\u76f8\u540c</p> <pre><code>$ diff books.txt books.bak  \n$ echo $?\n</code></pre> <p>\u4e00\u65e6\u6267\u884c\u4e0a\u8ff0\u7684\u4ee3\u7801\uff0c\u4f60\u5c06\u4f1a\u5f97\u5230\u4e0b\u5217\u8f93\u51fa</p> <pre><code>0\n</code></pre> <p>\u806a\u660e\u7684\u4f60\u53ef\u80fd\u5df2\u7ecf\u60f3\u5230\u4e86\uff0c\u8fd9\u4e0d\u5c31\u662f cp \u547d\u4ee4\u505a\u7684\u4e8b\u60c5\u5417\uff01\u786e\u5b9e\u5982\u6b64\uff0ccp \u547d\u4ee4\u4e5f\u505a\u4e86\u540c\u4e00\u4ef6\u4e8b\u60c5\uff0c\u4f46\u662fSED\u662f\u4e00\u4e2a\u6210\u719f\u7684\u5de5\u5177\uff0c\u4f7f\u7528\u5b83\u4f60\u53ef\u4ee5\u53ea\u590d\u5236\u6587\u4ef6\u4e2d\u7684\u67d0\u4e9b\u884c\u5230\u65b0\u7684\u6587\u4ef6\u4e2d\uff0c\u5982\u4e0b\u4ee3\u7801\u4f1a\u5b58\u50a8\u6587\u4ef6\u4e2d\u7684\u5947\u6570\u884c\u5230\u53e6\u4e00\u4e2a\u6587\u4ef6</p> <pre><code>$ sed -n '2~2 w junk.txt' books.txt  \n$ cat junk.txt \n2) The Two Towers, J. R. R. Tolkien, 352 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>\u5047\u8bbe\u4f60\u5e0c\u671b\u5b58\u50a8\u6240\u6709\u72ec\u7acb\u4f5c\u8005\u7684\u4e66\u5230\u5355\u72ec\u7684\u6587\u4ef6\u3002\u5982\u679c\u4eba\u5de5\u53bb\u505a\u7684\u8bdd\uff0c\u80af\u5b9a\u662f\u975e\u5e38\u65e0\u804a\u800c\u4e14\u6ca1\u6709\u6280\u672f\u542b\u91cf\u7684\uff0c\u4f46\u662f\u4f7f\u7528SED\uff0c\u4f60\u5c31\u6709\u4e86\u66f4\u52a0\u806a\u660e\u7684\u65b9\u6cd5\u53bb\u5b9e\u73b0</p> <pre><code>$ sed -n -e '/Martin/ w Martin.txt' -e '/Paulo/ w Paulo.txt' -e '/Tolkien/ w Tolkien.txt' books.txt\n\n$ cat Martin.txt\n1) A Storm of Swords, George R. R. Martin, 1216 \n6) A Game of Thrones, George R. R. Martin, 864\n\n$ cat Paulo.txt\n3) The Alchemist, Paulo Coelho, 197 \n5) The Pilgrimage, Paulo Coelho, 288\n\n$ cat Tolkien.txt\n2) The Two Towers, J. R. R. Tolkien, 352 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432\n</code></pre>"},{"location":"sed/#a","title":"\u8ffd\u52a0\u547d\u4ee4 a","text":"<p>\u6587\u672c\u8ffd\u52a0\u547d\u4ee4\u8bed\u6cd5\uff1a</p> <pre><code>[address]a\\ \nAppend text\n</code></pre> <p>\u5728\u7b2c\u56db\u884c\u4e4b\u540e\u8ffd\u52a0\u4e00\u672c\u65b0\u4e66\uff1a</p> <pre><code>$ sed '4 a 7) Adultry, Paulo Coelho, 234' books.txt \n1) A Storm of Swords, George R. R. Martin, 1216 \n2) The Two Towers, J. R. R. Tolkien, 352 \n3) The Alchemist, Paulo Coelho, 197 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n7) Adultry, Paulo Coelho, 234 \n5) The Pilgrimage, Paulo Coelho, 288 \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>\u5728\u547d\u4ee4\u90e8\u5206\uff0c4\u6307\u7684\u662f\u884c\u53f7\uff0c<code>a</code> \u662fappend\u547d\u4ee4\uff0c\u5269\u4f59\u90e8\u5206\u4e3a\u8981\u8ffd\u52a0\u7684\u6587\u672c\u3002</p> <p>\u5728\u6587\u4ef6\u7684\u7ed3\u5c3e\u63d2\u5165\u4e00\u884c\u6587\u672c\uff0c\u4f7f\u7528 $ \u4f5c\u4e3a\u5730\u5740</p> <pre><code>$ sed '$ a 7) Adultry, Paulo Coelho, 234' books.txt\n1) A Storm of Swords, George R. R. Martin, 1216 \n2) The Two Towers, J. R. R. Tolkien, 352 \n3) The Alchemist, Paulo Coelho, 197 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n5) The Pilgrimage, Paulo Coelho, 288 \n6) A Game of Thrones, George R. R. Martin, 864 \n7) Adultry, Paulo Coelho, 234\n</code></pre> <p>\u9664\u4e86\u884c\u53f7\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528\u6587\u672c\u6a21\u5f0f\u6307\u5b9a\u5730\u5740\uff0c\u4f8b\u5982\uff0c\u5728\u5339\u914d <code>The Alchemist</code> \u7684\u884c\u4e4b\u540e\u8ffd\u52a0\u6587\u672c</p> <pre><code>$ sed '/The Alchemist/ a 7) Adultry, Paulo Coelho, 234' books.txt  \n1) A Storm of Swords, George R. R. Martin, 1216 \n2) The Two Towers, J. R. R. Tolkien, 352 \n3) The Alchemist, Paulo Coelho, 197 \n7) Adultry, Paulo Coelho, 234 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n5) The Pilgrimage, Paulo Coelho, 288 \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre>"},{"location":"sed/#c","title":"\u884c\u66ff\u6362\u547d\u4ee4 c","text":"<p>SED\u901a\u8fc7 c \u63d0\u4f9b\u4e86 change \u548c replace \u547d\u4ee4\uff0c\u8be5\u547d\u4ee4\u5e2e\u52a9\u6211\u4eec\u4f7f\u7528\u65b0\u6587\u672c\u66ff\u6362\u5df2\u7ecf\u5b58\u5728\u7684\u884c\uff0c\u5f53\u63d0\u4f9b\u884c\u7684\u5730\u5740\u8303\u56f4\u65f6\uff0c\u6240\u6709\u7684\u884c\u90fd\u88ab\u4f5c\u4e3a\u4e00\u7ec4\u88ab\u66ff\u6362\u4e3a\u5355\u884c\u6587\u672c\uff0c\u4e0b\u9762\u662f\u8be5\u547d\u4ee4\u7684\u8bed\u6cd5</p> <pre><code>[address1[,address2]]c\\ \nReplace text\n</code></pre> <p>\u6bd4\u5982\uff0c\u66ff\u6362\u6587\u672c\u4e2d\u7684\u7b2c\u4e09\u884c\u4e3a\u65b0\u7684\u5185\u5bb9</p> <pre><code>$ sed '3 c 3) Adultry, Paulo Coelho, 324' books.txt\n1) A Storm of Swords, George R. R. Martin, 1216 \n2) The Two Towers, J. R. R. Tolkien, 352 \n3) Adultry, Paulo Coelho, 324 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n5) The Pilgrimage, Paulo Coelho, 288 \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>SED\u4e5f\u63a5\u53d7\u6a21\u5f0f\u4f5c\u4e3a\u5730\u5740</p> <pre><code>$ sed '/The Alchemist/ c 3) Adultry, Paulo Coelho, 324' books.txt\n1) A Storm of Swords, George R. R. Martin, 1216 \n2) The Two Towers, J. R. R. Tolkien, 352 \n3) Adultry, Paulo Coelho, 324 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n5) The Pilgrimage, Paulo Coelho, 288 \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>\u591a\u884c\u66ff\u6362\u4e5f\u662f\u652f\u6301\u7684\uff0c\u4e0b\u9762\u7684\u547d\u4ee4\u5b9e\u73b0\u4e86\u5c06\u7b2c4-6\u884c\u5185\u5bb9\u66ff\u6362\u4e3a\u5355\u884c</p> <pre><code>$ sed '4, 6 c 4) Adultry, Paulo Coelho, 324' books.txt  \n1) A Storm of Swords, George R. R. Martin, 1216 \n2) The Two Towers, J. R. R. Tolkien, 352 \n3) The Alchemist, Paulo Coelho, 197 \n4) Adultry, Paulo Coelho, 324\n</code></pre>"},{"location":"sed/#i","title":"\u63d2\u5165\u547d\u4ee4 i","text":"<p>\u63d2\u5165\u547d\u4ee4\u4e0e\u8ffd\u52a0\u547d\u4ee4\u7c7b\u4f3c\uff0c\u552f\u4e00\u7684\u533a\u522b\u662f\u63d2\u5165\u547d\u4ee4\u662f\u5728\u5339\u914d\u7684\u4f4d\u7f6e\u524d\u63d2\u5165\u65b0\u7684\u4e00\u884c\u3002</p> <pre><code>[address]i\\ \nInsert text\n</code></pre> <p>\u4e0b\u9762\u7684\u547d\u4ee4\u4f1a\u5728\u7b2c\u56db\u884c\u524d\u63d2\u5165\u65b0\u7684\u4e00\u884c</p> <pre><code>$ sed '4 i 7) Adultry, Paulo Coelho, 324' books.txt \n1) A Storm of Swords, George R. R. Martin, 1216 \n2) The Two Towers, J. R. R. Tolkien, 352 \n3) The Alchemist, Paulo Coelho, 197 \n7) Adultry, Paulo Coelho, 324 \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n5) The Pilgrimage, Paulo Coelho, 288 \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre>"},{"location":"sed/#y","title":"\u8f6c\u6362\u547d\u4ee4 y","text":"<p>\u8f6c\u6362\uff08Translate\uff09\u547d\u4ee4 y \u662f\u552f\u4e00\u53ef\u4ee5\u5904\u7406\u5355\u4e2a\u5b57\u7b26\u7684sed\u7f16\u8f91\u5668\u547d\u4ee4\u3002\u8f6c\u6362\u547d\u4ee4\u683c\u5f0f \u5982\u4e0b</p> <pre><code>[address]y/inchars/outchars/\n</code></pre> <p>\u8f6c\u6362\u547d\u4ee4\u4f1a\u5bf9inchars\u548coutchars\u503c\u8fdb\u884c\u4e00\u5bf9\u4e00\u7684\u6620\u5c04\u3002inchars\u4e2d\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4f1a\u88ab\u8f6c\u6362\u4e3aoutchars\u4e2d\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\uff0c\u7b2c\u4e8c\u4e2a\u5b57\u7b26\u4f1a\u88ab\u8f6c\u6362\u6210outchars\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u5b57\u7b26\u3002\u8fd9\u4e2a\u6620\u5c04\u8fc7\u7a0b\u4f1a\u4e00\u76f4\u6301\u7eed\u5230\u5904\u7406\u5b8c\u6307\u5b9a\u5b57\u7b26\u3002\u5982\u679cinchars\u548coutchars\u7684\u957f\u5ea6\u4e0d\u540c\uff0c\u5219sed\u7f16\u8f91\u5668\u4f1a\u4ea7\u751f\u4e00 \u6761\u9519\u8bef\u6d88\u606f\u3002</p> <pre><code>$ echo \"1 5 15 20\" | sed 'y/151520/IVXVXX/'\nI V IV XX\n</code></pre>"},{"location":"sed/#l","title":"\u8f93\u51fa\u9690\u85cf\u5b57\u7b26\u547d\u4ee4 l","text":"<p>\u4f60\u80fd\u901a\u8fc7\u76f4\u63a5\u89c2\u5bdf\u533a\u5206\u51fa\u5355\u8bcd\u662f\u901a\u8fc7\u7a7a\u683c\u8fd8\u662ftab\u8fdb\u884c\u5206\u9694\u7684\u5417\uff1f\u663e\u7136\u662f\u4e0d\u80fd\u7684\uff0c\u4f46\u662fSED\u53ef\u4ee5\u4e3a\u4f60\u505a\u5230\u8fd9\u70b9\u3002\u4f7f\u7528<code>l</code>\u547d\u4ee4\uff08\u82f1\u6587\u5b57\u6bcdL\u7684\u5c0f\u5199\uff09\u53ef\u4ee5\u663e\u793a\u6587\u672c\u4e2d\u7684\u9690\u85cf\u5b57\u7b26\uff08\u4f8b\u5982<code>\\t</code>\u6216\u8005<code>$</code>\u5b57\u7b26\uff09\u3002</p> <pre><code>[address1[,address2]]l \n[address1[,address2]]l [len]\n</code></pre> <p>\u4e3a\u4e86\u6d4b\u8bd5\u8be5\u547d\u4ee4\uff0c\u6211\u4eec\u9996\u5148\u5c06books.txt\u4e2d\u7684\u7a7a\u683c\u66ff\u6362\u4e3atab\u3002</p> <pre><code>$ sed 's/ /\\t/g' books.txt &gt; junk.txt\n</code></pre> <p>\u63a5\u4e0b\u6765\u6267\u884c<code>l</code>\u547d\u4ee4</p> <pre><code>$ sed -n 'l' junk.txt\n1)\\tStorm\\tof\\tSwords,\\tGeorge\\tR.\\tR.\\tMartin,\\t1216\\t$\n2)\\tThe\\tTwo\\tTowers,\\tJ.\\tR.\\tR.\\tTolkien,\\t352\\t$\n3)\\tThe\\tAlchemist,\\tPaulo\\tCoelho,\\t197\\t$\n4)\\tThe\\tFellowship\\tof\\tthe\\tRing,\\tJ.\\tR.\\tR.\\tTolkien,\\t432\\t$\n5)\\tThe\\tPilgrimage,\\tPaulo\\tCoelho,\\t288\\t$\n6)\\tA\\tGame\\tof\\tThrones,\\tGeorge\\tR.\\tR.\\tMartin,\\t864$\n</code></pre> <p>\u4f7f\u7528<code>l</code>\u547d\u4ee4\u7684\u65f6\u5019\uff0c\u4e00\u4e2a\u5f88\u6709\u8da3\u7684\u7279\u6027\u662f\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u5b9e\u73b0\u6587\u672c\u6309\u7167\u6307\u5b9a\u7684\u5bbd\u5ea6\u6362\u884c\u3002</p> <pre><code>$ sed -n 'l 25' books.txt\n1) Storm of Swords, Geor\\\nge R. R. Martin, 1216 $\n2) The Two Towers, J. R.\\\n R. Tolkien, 352 $\n3) The Alchemist, Paulo \\\nCoelho, 197 $\n4) The Fellowship of the\\\n Ring, J. R. R. Tolkien,\\\n 432 $\n5) The Pilgrimage, Paulo\\\n Coelho, 288 $\n6) A Game of Thrones, Ge\\\norge R. R. Martin, 864$\n</code></pre> <p>\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\u5728<code>l</code>\u547d\u4ee4\u540e\u8ddf\u4e86\u4e00\u4e2a\u6570\u5b5725\uff0c\u5b83\u544a\u8bc9SED\u6309\u7167\u6bcf\u884c25\u4e2a\u5b57\u7b26\u8fdb\u884c\u6362\u884c\uff0c\u5982\u679c\u6307\u5b9a\u8fd9\u4e2a\u6570\u5b57\u4e3a0\u7684\u8bdd\uff0c\u5219\u53ea\u6709\u5728\u5b58\u5728\u6362\u884c\u7b26\u7684\u60c5\u51b5\u4e0b\u624d\u8fdb\u884c\u6362\u884c\u3002</p> <p><code>l</code>\u547d\u4ee4\u662fGNU-SED\u7684\u4e00\u90e8\u5206\uff0c\u5176\u5b83\u7684\u4e00\u4e9b\u53d8\u4f53\u4e2d\u53ef\u80fd\u65e0\u6cd5\u4f7f\u7528\u8be5\u547d\u4ee4\u3002</p>"},{"location":"sed/#q","title":"\u9000\u51fa\u547d\u4ee4 q","text":"<p>\u5728SED\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528<code>Quit</code>\u547d\u4ee4\u9000\u51fa\u5f53\u524d\u7684\u6267\u884c\u6d41</p> <pre><code>[address]q \n[address]q [value]\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c<code>q</code>\u547d\u4ee4\u4e0d\u652f\u6301\u5730\u5740\u8303\u56f4\uff0c\u53ea\u652f\u6301\u5355\u4e2a\u5730\u5740\u5339\u914d\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0bSED\u4f1a\u6309\u7167\u8bfb\u53d6\u3001\u6267\u884c\u3001\u91cd\u590d\u7684\u5de5\u4f5c\u6d41\u6267\u884c\uff0c\u4f46\u5f53\u5b83\u9047\u5230<code>q</code>\u547d\u4ee4\u7684\u65f6\u5019\uff0c\u5b83\u4f1a\u9000\u51fa\u5f53\u524d\u7684\u6267\u884c\u6d41\u3002</p> <pre><code>$ sed '3 q' books.txt\n1) A Storm of Swords, George R. R. Martin, 1216 \n2) The Two Towers, J. R. R. Tolkien, 352 \n3) The Alchemist, Paulo Coelho, 197\n\n$ sed '/The Alchemist/ q' books.txt \n1) A Storm of Swords, George R. R. Martin, 1216 \n2) The Two Towers, J. R. R. Tolkien, 352 \n3) The Alchemist, Paulo Coelho, 197\n</code></pre> <p><code>q</code>\u547d\u4ee4\u4e5f\u652f\u6301\u63d0\u4f9b\u4e00\u4e2avalue\uff0c\u8fd9\u4e2avalue\u5c06\u4f5c\u4e3a\u7a0b\u5e8f\u7684\u8fd4\u56de\u4ee3\u7801\u8fd4\u56de</p> <pre><code>$ sed '/The Alchemist/ q 100' books.txt\n1) A Storm of Swords, George R. R. Martin, 1216\n2) The Two Towers, J. R. R. Tolkien, 352 \n3) The Alchemist, Paulo Coelho, 197\n\n$ echo $? \n100\n</code></pre>"},{"location":"sed/#r","title":"\u6587\u4ef6\u8bfb\u53d6\u547d\u4ee4 r","text":"<p>\u5728SED\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba9SED\u4f7f\u7528Read\u547d\u4ee4\u4ece\u5916\u90e8\u6587\u4ef6\u4e2d\u8bfb\u53d6\u5185\u5bb9\u5e76\u4e14\u5728\u6ee1\u8db3\u6761\u4ef6\u7684\u65f6\u5019\u663e\u793a\u51fa\u6765\u3002</p> <pre><code>[address]r file\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c<code>r</code>\u547d\u4ee4\u548c\u6587\u4ef6\u540d\u4e4b\u95f4\u5fc5\u987b\u53ea\u6709\u4e00\u4e2a\u7a7a\u683c\u3002</p> <p>\u4e0b\u9762\u7684\u793a\u4f8b\u4f1a\u6253\u5f00junk.txt\u6587\u4ef6\uff0c\u5c06\u5176\u5185\u5bb9\u63d2\u5165\u5230books.txt\u6587\u4ef6\u7684\u7b2c\u4e09\u884c\u4e4b\u540e</p> <pre><code>$ echo \"This is junk text.\" &gt; junk.txt \n$ sed '3 r junk.txt' books.txt \n1) A Storm of Swords, George R. R. Martin, 1216 \n2) The Two Towers, J. R. R. Tolkien, 352 \n3) The Alchemist, Paulo Coelho, 197 \nThis is junk text. \n4) The Fellowship of the Ring, J. R. R. Tolkien, 432 \n5) The Pilgrimage, Paulo Coelho, 288 \n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p><code>r</code>\u547d\u4ee4\u4e5f\u652f\u6301\u5730\u5740\u8303\u56f4\uff0c\u4f8b\u59823, 5 r junk.txt\u4f1a\u5728\u7b2c\u4e09\u884c\uff0c\u7b2c\u56db\u884c\uff0c\u7b2c\u4e94\u884c\u540e\u9762\u5206\u522b\u63d2\u5165junk.txt\u7684\u5185\u5bb9</p>"},{"location":"sed/#e","title":"\u6267\u884c\u5916\u90e8\u547d\u4ee4 e","text":"<p>\u5982\u679c\u4f60\u770b\u8fc7[\u4e09\u5341\u5206\u949f\u5b66\u4f1aAWK][]\u4e00\u6587\uff0c\u4f60\u53ef\u80fd\u5df2\u7ecf\u77e5\u9053\u4e86\u5728AWK\u4e2d\u53ef\u4ee5\u6267\u884c\u5916\u90e8\u7684\u547d\u4ee4\uff0c\u90a3\u4e48\u5728SED\u4e2d\u6211\u4eec\u662f\u5426\u4e5f\u53ef\u4ee5\u8fd9\u6837\u505a\uff1f</p> <p>\u7b54\u6848\u662f\u80af\u5b9a\u7684\uff0c\u5728SED\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528<code>e</code>\u547d\u4ee4\u6267\u884c\u5916\u90e8\u547d\u4ee4</p> <pre><code>[address1[,address2]]e [command]\n</code></pre> <p>\u4e0b\u9762\u7684\u547d\u4ee4\u4f1a\u5728\u7b2c\u4e09\u884c\u4e4b\u524d\u6267\u884cdate\u547d\u4ee4</p> <pre><code>$ sed '3 e date' books.txt\n1) Storm of Swords, George R. R. Martin, 1216\n2) The Two Towers, J. R. R. Tolkien, 352\n2016\u5e7411\u670829\u65e5 \u661f\u671f\u4e8c 22\u65f646\u520614\u79d2 CST\n3) The Alchemist, Paulo Coelho, 197\n4) The Fellowship of the Ring, J. R. R. Tolkien, 432\n5) The Pilgrimage, Paulo Coelho, 288\n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>\u53e6\u4e00\u4e2a\u793a\u4f8b</p> <pre><code>$ sed '3,5 e who' books.txt\n1) Storm of Swords, George R. R. Martin, 1216\n2) The Two Towers, J. R. R. Tolkien, 352\nmylxsw   console  Nov 29 19:30\nmylxsw   ttys000  Nov 29 22:45\n3) The Alchemist, Paulo Coelho, 197\nmylxsw   console  Nov 29 19:30\nmylxsw   ttys000  Nov 29 22:45\n4) The Fellowship of the Ring, J. R. R. Tolkien, 432\nmylxsw   console  Nov 29 19:30\nmylxsw   ttys000  Nov 29 22:45\n5) The Pilgrimage, Paulo Coelho, 288\n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>\u5982\u679c\u4f60\u4ed4\u7ec6\u89c2\u5bdf<code>e</code>\u547d\u4ee4\u7684\u8bed\u6cd5\uff0c\u4f60\u4f1a\u53d1\u73b0\u5176\u5b9e\u5b83\u7684command\u53c2\u6570\u662f\u53ef\u9009\u7684\u3002\u5728\u6ca1\u6709\u63d0\u4f9b\u5916\u90e8\u547d\u4ee4\u7684\u65f6\u5019\uff0cSED\u4f1a\u5c06\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u5185\u5bb9\u4f5c\u4e3a\u8981\u6267\u884c\u7684\u547d\u4ee4\u3002</p> <pre><code>$ echo -e \"date\\ncal\\nuname\" &gt; commands.txt\n$ cat commands.txt\ndate\ncal\nuname\n$ sed 'e' commands.txt\n2016\u5e7411\u670829\u65e5 \u661f\u671f\u4e8c 22\u65f650\u520630\u79d2 CST\n    \u5341\u4e00\u6708 2016\n\u65e5 \u4e00 \u4e8c \u4e09 \u56db \u4e94 \u516d\n       1  2  3  4  5\n 6  7  8  9 10 11 12\n13 14 15 16 17 18 19\n20 21 22 23 24 25 26\n27 28 29 30\n\nDarwin\n</code></pre>"},{"location":"sed/#_16","title":"\u6392\u9664\u547d\u4ee4 !","text":"<p>\u611f\u53f9\u53f7\u547d\u4ee4\uff08!\uff09\u7528\u6765\u6392\u9664\u547d\u4ee4\uff0c\u4e5f\u5c31\u662f\u8ba9\u539f\u672c\u4f1a\u8d77\u4f5c\u7528\u7684\u547d\u4ee4\u4e0d\u8d77\u4f5c\u7528\u3002</p> <pre><code>$ sed -n '/Paulo/p' books.txt\n3) The Alchemist, Paulo Coelho, 197\n5) The Pilgrimage, Paulo Coelho, 288\n$ sed -n '/Paulo/!p' books.txt\n1) Storm of Swords, George R. R. Martin, 1216\n2) The Two Towers, J. R. R. Tolkien, 352\n4) The Fellowship of the Ring, J. R. R. Tolkien, 432\n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>\u5982\u4e0a\u4f8b\u6240\u793a\uff0c<code>p</code>\u547d\u4ee4\u539f\u5148\u662f\u53ea\u8f93\u51fa\u5339\u914dPaulo\u7684\u884c\uff0c\u6dfb\u52a0<code>!</code>\u4e4b\u540e\uff0c\u53d8\u6210\u4e86\u53ea\u8f93\u51fa\u4e0d\u5339\u914dPaulo\u7684\u884c\u3002</p> <pre><code>$ sed -n '1!G; h; $p' books.txt\n6) A Game of Thrones, George R. R. Martin, 864\n5) The Pilgrimage, Paulo Coelho, 288\n4) The Fellowship of the Ring, J. R. R. Tolkien, 432\n3) The Alchemist, Paulo Coelho, 197\n2) The Two Towers, J. R. R. Tolkien, 352\n1) Storm of Swords, George R. R. Martin, 1216\n</code></pre> <p>\u4e0a\u9762\u7684\u547d\u4ee4\u5b9e\u73b0\u4e86\u7c7b\u4f3c<code>tac</code>\u547d\u4ee4\u7c7b\u4f3c\u7684\u8f93\u51fa\uff0c\u5c06\u6587\u672c\u5185\u5bb9\u5012\u5e8f\u8f93\u51fa\u3002\u770b\u8d77\u6765\u6709\u4e9b\u6666\u6da9\u96be\u61c2\uff0c\u5206\u89e3\u4e00\u4e0b\u5374\u5341\u5206\u7b80\u5355\uff1a</p> <ol> <li>1!G \u8fd9\u53e5\u7684\u610f\u601d\u662f\u51fa\u4e86\u7b2c\u4e00\u884c\u4e4b\u5916\uff0c\u5904\u7406\u6bcf\u4e00\u884c\u7684\u65f6\u5019\u90fd\u5c06\u4fdd\u6301\u7a7a\u95f4\u4e2d\u7684\u5185\u5bb9\u8ffd\u52a0\u5230\u6a21\u5f0f\u7a7a\u95f4\uff08\u6b63\u5e8f-&gt;\u5012\u5e8f\uff09</li> <li>h \u5c06\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u5185\u5bb9\u590d\u5236\u5230\u4fdd\u6301\u7a7a\u95f4\u4ee5\u5907\u4e0b\u4e00\u884c\u5339\u914d\u7684\u65f6\u5019\u8ffd\u52a0\u5230\u4e0b\u4e00\u884c\u7684\u540e\u9762</li> <li>$p \u5982\u679c\u5339\u914d\u5230\u6700\u540e\u4e00\u884c\u7684\u8bdd\u5219\u8f93\u51fa\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u5185\u5bb9</li> <li>\u4e0a\u8ff0\u6b65\u9aa4\u4e0d\u65ad\u91cd\u590d\u76f4\u5230\u6587\u672c\u7ed3\u675f\u521a\u597d\u5c06\u6587\u4ef6\u5185\u5bb9\u7ffb\u8f6c\u4e86\u4e00\u6b21</li> </ol>"},{"location":"sed/#_17","title":"\u591a\u884c\u547d\u4ee4","text":"<p>\u5728\u4f7f\u7528sed\u7f16\u8f91\u5668\u7684\u57fa\u7840\u547d\u4ee4\u65f6\uff0c\u4f60\u53ef\u80fd\u6ce8\u610f\u5230\u4e86\u4e00\u4e2a\u5c40\u9650\u3002\u6240\u6709\u7684sed\u7f16\u8f91\u5668\u547d\u4ee4\u90fd\u662f\u9488\u5bf9\u5355\u884c\u6570\u636e\u6267\u884c\u64cd\u4f5c\u7684\u3002\u5728sed\u7f16\u8f91\u5668\u8bfb\u53d6\u6570\u636e\u6d41\u65f6\uff0c\u5b83\u4f1a\u57fa\u4e8e\u6362\u884c\u7b26\u7684\u4f4d\u7f6e\u5c06\u6570\u636e\u5206\u6210\u884c\u3002sed\u7f16\u8f91\u5668\u6839\u636e\u5b9a\u4e49\u597d\u7684\u811a\u672c\u547d\u4ee4\u4e00\u6b21\u5904\u7406\u4e00\u884c\u6570\u636e\uff0c\u7136\u540e\u79fb\u5230\u4e0b\u4e00\u884c\u91cd\u590d\u8fd9\u4e2a\u8fc7\u7a0b\u3002</p> <p>\u5e78\u8fd0\u7684\u662f\uff0csed\u7f16\u8f91\u5668\u7684\u8bbe\u8ba1\u4eba\u5458\u5df2\u7ecf\u8003\u8651\u5230\u4e86\u8fd9\u79cd\u60c5\u51b5\uff0c\u5e76\u8bbe\u8ba1\u4e86\u5bf9\u5e94\u7684\u89e3\u51b3\u65b9\u6848\u3002sed\u7f16\u8f91\u5668\u5305\u542b\u4e86\u4e09\u4e2a\u53ef\u7528\u6765\u5904\u7406\u591a\u884c\u6587\u672c\u7684\u7279\u6b8a\u547d\u4ee4\u3002</p> <ul> <li>N\uff1a\u5c06\u6570\u636e\u6d41\u4e2d\u7684\u4e0b\u4e00\u884c\u52a0\u8fdb\u6765\u521b\u5efa\u4e00\u4e2a\u591a\u884c\u7ec4\u6765\u5904\u7406</li> <li>D\uff1a\u5220\u9664\u591a\u884c\u7ec4\u4e2d\u7684\u4e00\u884c</li> <li>P\uff1a\u6253\u5370\u591a\u884c\u7ec4\u4e2d\u7684\u4e00\u884c</li> </ul>"},{"location":"sed/#n-","title":"N - \u52a0\u8f7d\u4e0b\u4e00\u884c","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cSED\u662f\u57fa\u4e8e\u5355\u884c\u8fdb\u884c\u64cd\u4f5c\u7684\uff0c\u6709\u4e9b\u60c5\u51b5\u4e0b\u6211\u4eec\u53ef\u80fd\u9700\u8981\u4f7f\u7528\u591a\u884c\u8fdb\u884c\u7f16\u8f91\uff0c\u542f\u7528\u591a\u884c\u7f16\u8f91\u4f7f\u7528<code>N</code>\u547d\u4ee4\uff0c\u4e0e<code>n</code>\u4e0d\u540c\u7684\u662f\uff0c<code>N</code>\u5e76\u4e0d\u4f1a\u6e05\u9664\u3001\u8f93\u51fa\u6a21\u5f0f\u7a7a\u95f4\u7684\u5185\u5bb9\uff0c\u800c\u662f\u91c7\u7528\u4e86\u8ffd\u52a0\u6a21\u5f0f\u3002</p> <pre><code>[address1[,address2]]N\n</code></pre> <p>\u4e0b\u9762\u7684\u793a\u4f8b\u5c06\u4f1a\u628abooks2.txt\u4e2d\u7684\u6807\u9898\u548c\u4f5c\u8005\u653e\u5230\u540c\u4e00\u884c\u5c55\u793a\uff0c\u5e76\u4e14\u4f7f\u7528\u9017\u53f7\u8fdb\u884c\u5206\u9694</p> <pre><code>$ sed 'N; s/\\n/,/g' books2.txt\nA Storm of Swords ,George R. R. Martin\nThe Two Towers ,J. R. R. Tolkien\nThe Alchemist ,Paulo Coelho\nThe Fellowship of the Ring ,J. R. R. Tolkien\nThe Pilgrimage ,Paulo Coelho\nA Game of Thrones ,George R. R. Martin\n</code></pre>"},{"location":"sed/#d-","title":"D - \u5220\u9664\u591a\u884c\u4e2d\u7684\u4e00\u884c","text":"<p>sed\u7f16\u8f91\u5668\u63d0\u4f9b\u4e86\u591a\u884c\u5220\u9664\u547d\u4ee4D\uff0c\u5b83\u53ea\u5220\u9664\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u7b2c\u4e00\u884c\u3002\u8be5\u547d\u4ee4\u4f1a\u5220\u9664\u5230\u6362\u884c\u7b26\uff08\u542b \u6362\u884c\u7b26\uff09\u4e3a\u6b62\u7684\u6240\u6709\u5b57\u7b26\u3002</p> <pre><code>$ echo '\\nThis is the header line.\\nThis is a data line.\\n\\nThis is the last line.' | sed '/^$/{N; /header/D}'\nThis is the header line.\nThis is a data line.\n\nThis is the last line.\n</code></pre>"},{"location":"sed/#p-","title":"P - \u8f93\u51fa\u591a\u884c\u4e2d\u7684\u4e00\u884c","text":"<p><code>P</code>\u547d\u4ee4\u7528\u4e8e\u8f93\u51fa<code>N</code>\u547d\u4ee4\u521b\u5efa\u7684\u591a\u884c\u6587\u672c\u7684\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u7b2c\u4e00\u884c\u3002</p> <pre><code>[address1[,address2]]P\n</code></pre> <p>\u4f8b\u5982\u4e0b\u9762\u7684\u547d\u4ee4\u53ea\u8f93\u51fa\u4e86\u56fe\u4e66\u7684\u6807\u9898</p> <pre><code>$ sed -n 'N;P' books2.txt\nA Storm of Swords\nThe Two Towers\nThe Alchemist\nThe Fellowship of the Ring\nThe Pilgrimage\nA Game of Thrones\n</code></pre>"},{"location":"sed/#_18","title":"\u5176\u5b83\u547d\u4ee4","text":""},{"location":"sed/#n-next","title":"n - \u5355\u884cnext","text":"<p>\u5c0f\u5199\u7684n\u547d\u4ee4\u4f1a\u544a\u8bc9sed\u7f16\u8f91\u5668\u79fb\u52a8\u5230\u6570\u636e\u6d41\u4e2d\u7684\u4e0b\u4e00\u6587\u672c\u884c\uff0c\u5e76\u4e14\u8986\u76d6\u5f53\u524d\u6a21\u5f0f\u7a7a\u95f4\u4e2d\u7684\u884c\u3002</p> <pre><code>$ cat data1.txt \nThis is the header line.\n\nThis is a data line.\n\nThis is the last line.\n$ sed '/header/{n ; d}' data1.txt \nThis is the header line.\nThis is a data line.\n\nThis is the last line.\n</code></pre> <p>\u4e0a\u9762\u7684\u547d\u4ee4\u4e2d\uff0c\u9996\u5148\u4f1a\u5339\u914d\u5305\u542bheader\u7684\u884c\uff0c\u4e4b\u540e\u5c06\u79fb\u52a8\u5230\u6570\u636e\u6d41\u7684\u4e0b\u4e00\u884c\uff0c\u8fd9\u91cc\u662f\u4e00\u4e2a\u7a7a\u884c\uff0c\u7136\u540e\u6267\u884c<code>d</code>\u547d\u4ee4\u5bf9\u6539\u884c\u8fdb\u884c\u5220\u9664\uff0c\u6240\u6709\u5c31\u770b\u5230\u4e86\u8fd9\u6837\u7684\u7ed3\u679c\uff1a\u7b2c\u4e00\u4e2a\u7a7a\u884c\u88ab\u5220\u9664\u6389\u4e86\u3002</p>"},{"location":"sed/#v-sed","title":"v - SED\u7248\u672c\u68c0\u67e5","text":"<p><code>v</code>\u547d\u4ee4\u7528\u4e8e\u68c0\u67e5SED\u7684\u7248\u672c\uff0c\u5982\u679c\u7248\u672c\u5927\u4e8e\u53c2\u6570\u4e2d\u7684\u7248\u672c\u5219\u6b63\u5e38\u6267\u884c\uff0c\u5426\u5219\u5931\u8d25</p> <pre><code>[address1[,address2]]v [version]\n</code></pre> <p>\u4f8b\u5982</p> <pre><code>$ sed --version\nsed (GNU sed) 4.2.2\n\n$ sed 'v 4.2.3' books.txt\nsed: -e expression #1, char 7: expected newer version of sed\n\n$ sed 'v 4.2.2' books.txt\n1) Storm of Swords, George R. R. Martin, 1216\n2) The Two Towers, J. R. R. Tolkien, 352\n3) The Alchemist, Paulo Coelho, 197\n4) The Fellowship of the Ring, J. R. R. Tolkien, 432\n5) The Pilgrimage, Paulo Coelho, 288\n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre>"},{"location":"sed/#_19","title":"\u7279\u6b8a\u5b57\u7b26","text":"<p>\u5728SED\u4e2d\u63d0\u4f9b\u4e86\u4e24\u4e2a\u53ef\u4ee5\u7528\u4f5c\u547d\u4ee4\u7684\u7279\u6b8a\u5b57\u7b26\uff1a= \u548c &amp; \u3002</p>"},{"location":"sed/#_20","title":"<code>=</code>\u547d\u4ee4","text":"<p><code>=</code>\u547d\u4ee4\u7528\u4e8e\u8f93\u51fa\u884c\u53f7\uff0c\u8bed\u6cd5\u683c\u5f0f\u4e3a</p> <pre><code>[/pattern/]= \n[address1[,address2]]=\n</code></pre> <p>\u4f8b\u5982\u4e3a\u6bcf\u4e00\u884c\u8f93\u51fa\u884c\u53f7</p> <pre><code>$ sed '=' books2.txt\n1\nA Storm of Swords\n2\nGeorge R. R. Martin\n...\n</code></pre> <p>\u53ea\u4e3a1-4\u884c\u8f93\u51fa\u884c\u53f7</p> <pre><code>$ sed '1, 4=' books2.txt\n1\nA Storm of Swords\n2\nGeorge R. R. Martin\n3\nThe Two Towers\n4\nJ. R. R. Tolkien\nThe Alchemist\nPaulo Coelho\nThe Fellowship of the Ring\nJ. R. R. Tolkien\nThe Pilgrimage\nPaulo Coelho\nA Game of Thrones\nGeorge R. R. Martin\n</code></pre> <p>\u5339\u914dPaulo\u7684\u884c\u8f93\u51fa\u884c\u53f7</p> <pre><code>$ sed '/Paulo/ =' books2.txt\nA Storm of Swords\nGeorge R. R. Martin\nThe Two Towers\nJ. R. R. Tolkien\nThe Alchemist\n6\nPaulo Coelho\nThe Fellowship of the Ring\nJ. R. R. Tolkien\nThe Pilgrimage\n10\nPaulo Coelho\nA Game of Thrones\nGeorge R. R. Martin\n</code></pre> <p>\u6700\u540e\u4e00\u884c\u8f93\u51fa\u884c\u53f7\uff0c\u8fd9\u4e2a\u547d\u4ee4\u6bd4\u8f83\u6709\u610f\u601d\u4e86\uff0c\u53ef\u4ee5\u7528\u4e8e\u8f93\u51fa\u6587\u4ef6\u603b\u5171\u6709\u591a\u5c11\u884c</p> <pre><code>$ sed -n '$ =' books2.txt\n12\n</code></pre>"},{"location":"sed/#_21","title":"<code>&amp;</code>\u547d\u4ee4","text":"<p>\u7279\u6b8a\u5b57\u7b26<code>&amp;</code>\u7528\u4e8e\u5b58\u50a8\u5339\u914d\u6a21\u5f0f\u7684\u5185\u5bb9\uff0c\u901a\u5e38\u4e0e\u66ff\u6362\u547d\u4ee4<code>s</code>\u4e00\u8d77\u4f7f\u7528\u3002</p> <pre><code>$ sed 's/[[:digit:]]/Book number &amp;/' books.txt\nBook number 1) Storm of Swords, George R. R. Martin, 1216\nBook number 2) The Two Towers, J. R. R. Tolkien, 352\nBook number 3) The Alchemist, Paulo Coelho, 197\nBook number 4) The Fellowship of the Ring, J. R. R. Tolkien, 432\nBook number 5) The Pilgrimage, Paulo Coelho, 288\nBook number 6) A Game of Thrones, George R. R. Martin, 864\n</code></pre> <p>\u4e0a\u8ff0\u547d\u4ee4\u7528\u4e8e\u5339\u914d\u6bcf\u4e00\u884c\u7b2c\u4e00\u4e2a\u6570\u5b57\uff0c\u5728\u5176\u524d\u9762\u6dfb\u52a0 Book number \u3002\u800c\u4e0b\u9762\u8fd9\u4e2a\u547d\u4ee4\u5219\u5339\u914d\u6700\u540e\u4e00\u4e2a\u6570\u5b57\uff0c\u5e76\u4fee\u6539\u4e3a<code>Pages =</code>\u3002\u5176\u4e2d<code>[[:digit:]]* *$</code>\u53ef\u80fd\u6bd4\u8f83\u8d39\u89e3\uff0c\u8fd9\u4e00\u90e8\u5206\u5176\u5b9e\u662f\uff1a\u5339\u914d0\u4e2a\u6216\u591a\u4e2a\u6570\u5b57+0\u4e2a\u6216\u591a\u4e2a\u7a7a\u683c+\u884c\u5c3e\u3002</p> <pre><code>sed 's/[[:digit:]]* *$/Pages = &amp;/' books.txt\n1) Storm of Swords, George R. R. Martin, Pages = 1216\n2) The Two Towers, J. R. R. Tolkien, Pages = 352\n3) The Alchemist, Paulo Coelho, Pages = 197\n4) The Fellowship of the Ring, J. R. R. Tolkien, Pages = 432\n5) The Pilgrimage, Paulo Coelho, Pages = 288\n6) A Game of Thrones, George R. R. Martin, Pages = 864\n</code></pre>"},{"location":"sed/#_22","title":"\u5b57\u7b26\u4e32","text":""},{"location":"sed/#s","title":"\u66ff\u6362\u547d\u4ee4 s","text":"<p>\u6587\u672c\u66ff\u6362\u547d\u4ee4\u975e\u5e38\u5e38\u89c1\uff0c\u5176\u683c\u5f0f\u5982\u4e0b</p> <pre><code>[address1[,address2]]s/pattern/replacement/[flags]\n</code></pre> <p>\u5728\u524d\u9762\u6211\u4eec\u4f7f\u7528\u7684books.txt\u6587\u4ef6\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u9017\u53f7\u201c,\u201d\u5206\u9694\u6bcf\u4e00\u5217\uff0c\u4e0b\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f1a\u4f7f\u7528\u66ff\u6362\u547d\u4ee4\u5c06\u5176\u66ff\u6362\u4e3a\u7ba1\u9053\u7b26\u201c|\u201d\uff1a</p> <pre><code>$ sed 's/,/ |/' books.txt\n1) Storm of Swords | George R. R. Martin, 1216\n2) The Two Towers | J. R. R. Tolkien, 352\n3) The Alchemist | Paulo Coelho, 197\n4) The Fellowship of the Ring | J. R. R. Tolkien, 432\n5) The Pilgrimage | Paulo Coelho, 288\n6) A Game of Thrones | George R. R. Martin, 864\n</code></pre> <p>\u662f\u4e0d\u662f\u89c9\u5f97\u54ea\u91cc\u4e0d\u5bf9\uff1f\u76f8\u4fe1\u4f60\u5df2\u7ecf\u53d1\u73b0\uff0c\u6bcf\u4e00\u884c\u7684\u7b2c\u4e8c\u4e2a\u9017\u53f7\u90fd\u6ca1\u6709\u88ab\u66ff\u6362\uff0c\u53ea\u6709\u7b2c\u4e00\u4e2a\u88ab\u66ff\u6362\u4e86\uff0c\u786e\u5b9e\u5982\u6b64\uff0c\u5728SED\u4e2d\uff0c\u4f7f\u7528\u66ff\u6362\u547d\u4ee4\u7684\u65f6\u5019\u9ed8\u8ba4\u53ea\u4f1a\u5bf9\u7b2c\u4e00\u4e2a\u5339\u914d\u7684\u4f4d\u7f6e\u8fdb\u884c\u66ff\u6362\u3002\u4f7f\u7528<code>g</code>\u9009\u9879\u544a\u8bc9SED\u5bf9\u6240\u6709\u5185\u5bb9\u8fdb\u884c\u66ff\u6362\uff1a</p> <pre><code>$ sed 's/,/ | /g' books.txt\n1) Storm of Swords |  George R. R. Martin |  1216\n2) The Two Towers |  J. R. R. Tolkien |  352\n3) The Alchemist |  Paulo Coelho |  197\n4) The Fellowship of the Ring |  J. R. R. Tolkien |  432\n5) The Pilgrimage |  Paulo Coelho |  288\n6) A Game of Thrones |  George R. R. Martin |  864\n</code></pre> <p>\u5982\u679c\u5bf9\u5339\u914d\u6a21\u5f0f\uff08\u6216\u5730\u5740\u8303\u56f4\uff09\u7684\u884c\u8fdb\u884c\u66ff\u6362\uff0c\u5219\u53ea\u9700\u8981\u5728<code>s</code>\u547d\u4ee4\u524d\u6dfb\u52a0\u5730\u5740\u5373\u53ef\u3002\u6bd4\u5982\u53ea\u66ff\u6362\u5339\u914dThe Pilgrimage\u7684\u884c\uff1a<code>sed '/The Pilgrimage/ s/,/ | /g' books.txt</code></p> <p>\u8fd8\u6709\u4e00\u4e9b\u5176\u5b83\u7684\u9009\u9879\uff0c\u8fd9\u91cc\u5c31\u7b80\u5355\u7684\u63cf\u8ff0\u4e00\u4e0b\uff0c\u4e0d\u5728\u5c55\u5f00\u8bb2\u89e3</p> <ul> <li>\u6570\u5b57n: \u53ea\u66ff\u6362\u7b2cn\u6b21\u5339\u914d\uff0c\u6bd4\u5982<code>sed 's/,/ | /2' books.txt</code>\uff0c\u53ea\u66ff\u6362\u6bcf\u884c\u4e2d\u7b2c\u4e8c\u4e2a\u9017\u53f7</li> <li>p\uff1a\u53ea\u8f93\u51fa\u6539\u53d8\u7684\u884c\uff0c\u6bd4\u5982<code>sed -n 's/Paulo Coelho/PAULO COELHO/p' books.txt</code></li> <li>w\uff1a\u5b58\u50a8\u6539\u53d8\u7684\u884c\u5230\u6587\u4ef6\uff0c\u6bd4\u5982<code>sed -n 's/Paulo Coelho/PAULO COELHO/w junk.txt' books.txt</code></li> <li>i\uff1a\u5339\u914d\u65f6\u5ffd\u7565\u5927\u5c0f\u5199\uff0c\u6bd4\u5982<code>sed  -n 's/pAuLo CoElHo/PAULO COELHO/pi' books.txt</code></li> </ul> <p>\u5728\u6267\u884c\u66ff\u6362\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u5982\u679c\u8981\u66ff\u6362\u7684\u5185\u5bb9\u4e2d\u5305\u542b<code>/</code>\uff0c\u8fd9\u4e2a\u65f6\u5019\u600e\u4e48\u529e\uff1f\u5f88\u7b80\u5355\uff0c\u6dfb\u52a0\u8f6c\u4e49\u64cd\u4f5c\u7b26\u3002</p> <pre><code>$ echo \"/bin/sed\" | sed 's/\\/bin\\/sed/\\/home\\/mylxsw\\/src\\/sed\\/sed-4.2.2\\/sed/'\n/home/mylxsw/src/sed/sed-4.2.2/sed\n</code></pre> <p>\u4e0a\u9762\u7684\u547d\u4ee4\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528<code>\\</code>\u5bf9<code>/</code>\u8fdb\u884c\u4e86\u8f6c\u4e49\uff0c\u4e0d\u8fc7\u8868\u8fbe\u5f0f\u5df2\u7ecf\u770b\u8d77\u6765\u975e\u5e38\u96be\u770b\u4e86\uff0c\u5728SED\u4e2d\u8fd8\u53ef\u4ee5\u4f7f\u7528<code>|</code>\uff0c<code>@</code>\uff0c<code>^</code>\uff0c<code>!</code>\u4f5c\u4e3a\u547d\u4ee4\u7684\u5206\u9694\u7b26\uff0c\u6240\u4ee5\uff0c\u4e0b\u9762\u7684\u51e0\u4e2a\u547d\u4ee4\u548c\u4e0a\u9762\u7684\u662f\u7b49\u4ef7\u7684</p> <pre><code>echo \"/bin/sed\" | sed 's|/bin/sed|/mylxsw/mylxsw/src/sed/sed-4.2.2/sed|'\necho \"/bin/sed\" | sed 's@/bin/sed@/home/mylxsw/src/sed/sed-4.2.2/sed@'\necho \"/bin/sed\" | sed 's^/bin/sed^/home/mylxsw/src/sed/sed-4.2.2/sed^'\necho \"/bin/sed\" | sed 's!/bin/sed!/home/mylxsw/src/sed/sed-4.2.2/sed!'\n</code></pre>"},{"location":"sed/#_23","title":"\u5339\u914d\u5b50\u5b57\u7b26\u4e32","text":"<p>\u524d\u9762\u6211\u4eec\u5b66\u4e60\u4e86\u66ff\u6362\u547d\u4ee4\u7684\u7528\u6cd5\uff0c\u73b0\u5728\u8ba9\u6211\u4eec\u770b\u770b\u5982\u4f55\u83b7\u53d6\u5339\u914d\u6587\u672c\u4e2d\u7684\u67d0\u4e2a\u5b50\u4e32\u3002</p> <p>\u5728SED\u4e2d\uff0c\u4f7f\u7528<code>\\(</code>\u548c<code>\\)</code>\u5bf9\u5339\u914d\u7684\u5185\u5bb9\u8fdb\u884c\u5206\u7ec4\uff0c\u4f7f\u7528<code>\\N</code>\u7684\u65b9\u5f0f\u8fdb\u884c\u5f15\u7528\u3002\u8bf7\u770b\u4e0b\u9762\u793a\u4f8b</p> <pre><code>$ echo \"Three One Two\" | sed 's|\\(\\w\\+\\) \\(\\w\\+\\) \\(\\w\\+\\)|\\2 \\3 \\1|'\nOne Two Three\n</code></pre> <p>\u6211\u4eec\u8f93\u51fa\u4e86Three\uff0cOne\uff0cTwo\u4e09\u4e2a\u5355\u8bcd\uff0c\u5728SED\u7684\u66ff\u6362\u89c4\u5219\u4e2d\uff0c\u4f7f\u7528\u7a7a\u683c\u5206\u9694\u4e86\u4e09\u5c0f\u6bb5\u6b63\u5219\u8868\u8fbe\u5f0f<code>\\(\\w\\+\\)</code>\u6765\u5339\u914d\u6bcf\u4e00\u4e2a\u5355\u8bcd\uff0c\u540e\u9762\u4f7f\u7528<code>\\1</code>\uff0c\uff0c<code>\\2</code>\uff0c<code>\\3</code>\u5206\u522b\u5f15\u7528\u5b83\u4eec\u7684\u503c\u3002</p>"},{"location":"sed/#_24","title":"\u7ba1\u7406\u6a21\u5f0f","text":"<p>\u524d\u9762\u5df2\u7ecf\u8bb2\u89e3\u8fc7\u6a21\u5f0f\u7a7a\u95f4\u548c\u4fdd\u6301\u7a7a\u95f4\u7684\u7528\u6cd5\uff0c\u5728\u672c\u8282\u4e2d\u6211\u4eec\u5c06\u4f1a\u7ee7\u7eed\u63a2\u7d22\u5b83\u4eec\u7684\u7528\u6cd5\u3002</p> <p>\u672c\u90e8\u5206\u5185\u5bb9\u6682\u672a\u66f4\u65b0\uff0c\u8bf7\u5173\u6ce8\u7a0b\u5e8f\u733f\u6210\u957f\u8ba1\u5212 \u9879\u76ee\uff0c\u6211\u5c06\u6700\u5148\u5728Github\u7684\u8fd9\u4e2a\u4ed3\u5e93\u4e2d\u66f4\u65b0\u6700\u65b0\u5185\u5bb9\u3002</p>"},{"location":"sed/#_25","title":"\u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p>\u8fd9\u4e00\u90e8\u5206\u5c31\u662f\u6807\u51c6\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u4e00\u4e9b\u7279\u6b8a\u5b57\u7b26\u4ee5\u5143\u5b57\u7b26\uff0c\u6bd4\u8f83\u719f\u6089\u7684\u8bf7\u7565\u8fc7\u3002</p>"},{"location":"sed/#_26","title":"\u6807\u51c6\u6b63\u5219\u8868\u8fbe\u5f0f","text":""},{"location":"sed/#_27","title":"^","text":"<p>\u5339\u914d\u884c\u7684\u5f00\u59cb\u3002</p> <pre><code>$ sed -n '/^The/ p' books2.txt\nThe Two Towers, J. R. R. Tolkien \nThe Alchemist, Paulo Coelho \nThe Fellowship of the Ring, J. R. R. Tolkien \nThe Pilgrimage, Paulo Coelho\n</code></pre>"},{"location":"sed/#_28","title":"$","text":"<p>\u5339\u914d\u884c\u7684\u7ed3\u5c3e</p> <pre><code>$ sed -n '/Coelho$/ p' books2.txt \nThe Alchemist, Paulo Coelho \nThe Pilgrimage, Paulo Coelho\n</code></pre>"},{"location":"sed/#_29","title":".","text":"<p>\u5339\u914d\u5355\u4e2a\u5b57\u7b26\uff08\u9664\u884c\u5c3e\uff09</p> <pre><code>$ echo -e \"cat\\nbat\\nrat\\nmat\\nbatting\\nrats\\nmats\" | sed -n '/^..t$/p'\ncat\nbat\nrat\nmat\n</code></pre>"},{"location":"sed/#_30","title":"[]","text":"<p>\u5339\u914d\u5b57\u7b26\u96c6</p> <pre><code>$ echo -e \"Call\\nTall\\nBall\" | sed -n '/[CT]all/ p'\nCall\nTall\n</code></pre>"},{"location":"sed/#_31","title":"[\\^]","text":"<p>\u6392\u9664\u5b57\u7b26\u96c6</p> <pre><code>$ echo -e \"Call\\nTall\\nBall\" | sed -n '/[^CT]all/ p'\nBall\n</code></pre>"},{"location":"sed/#-","title":"[-]","text":"<p>\u5b57\u7b26\u8303\u56f4\u3002</p> <pre><code>$ echo -e \"Call\\nTall\\nBall\" | sed -n '/[C-Z]all/ p' \nCall \nTall\n</code></pre>"},{"location":"sed/#_32","title":"\\? \uff0c\\+ \uff0c*","text":"<p>\u5206\u522b\u5bf9\u5e940\u6b21\u52301\u6b21\uff0c\u4e00\u6b21\u5230\u591a\u6b21\uff0c0\u6b21\u5230\u591a\u6b21\u5339\u914d\u3002</p>"},{"location":"sed/#n-n-m-n","title":"{n} \uff0c{n,} \uff0c{m, n}","text":"<p>\u7cbe\u786e\u5339\u914dN\u6b21\uff0c\u81f3\u5c11\u5339\u914dN\u6b21\uff0c\u5339\u914dM-N\u6b21</p>"},{"location":"sed/#_33","title":"|","text":"<p>\u6216\u64cd\u4f5c\u3002</p> <pre><code>$ echo -e \"str1\\nstr2\\nstr3\\nstr4\" | sed -n '/str\\(1\\|3\\)/ p' \nstr1\nstr3\n</code></pre>"},{"location":"sed/#posix","title":"POSIX\u517c\u5bb9\u7684\u6b63\u5219","text":"<p>\u4e3b\u8981\u5305\u542b<code>[:alnum:]</code>\uff0c<code>[:alpha:]</code>\uff0c<code>[:blank:]</code>\uff0c<code>[:digit:]</code>\uff0c<code>[:lower:]</code>\uff0c<code>[:upper:]</code>\uff0c<code>[:punct:]</code>\uff0c<code>[:space:]</code>\uff0c\u8fd9\u4e9b\u57fa\u672c\u90fd\u89c1\u540d\u4e4b\u610f\uff0c\u4e0d\u5728\u8d58\u8ff0\u3002</p>"},{"location":"sed/#_34","title":"\u5143\u5b57\u7b26","text":""},{"location":"sed/#s_1","title":"\\s","text":"<p>\u5339\u914d\u5355\u4e2a\u7a7a\u767d\u5185\u5bb9</p> <pre><code>$ echo -e \"Line\\t1\\nLine2\" | sed -n '/Line\\s/ p'\nLine 1\n</code></pre>"},{"location":"sed/#s_2","title":"\\S","text":"<p>\u5339\u914d\u5355\u4e2a\u975e\u7a7a\u767d\u5185\u5bb9\u3002</p>"},{"location":"sed/#w-w","title":"\\w \uff0c \\W","text":"<p>\u5355\u4e2a\u5355\u8bcd\u3001\u975e\u5355\u8bcd\u3002</p>"},{"location":"sed/#_35","title":"\u5e38\u7528\u4ee3\u7801\u6bb5","text":""},{"location":"sed/#cat","title":"Cat\u547d\u4ee4","text":"<p>\u6a21\u62df<code>cat</code>\u547d\u4ee4\u6bd4\u8f83\u7b80\u5355\uff0c\u6709\u4e0b\u9762\u4e24\u79cd\u65b9\u5f0f</p> <pre><code>$ sed '' books.txt\n1) Storm of Swords, George R. R. Martin, 1216\n2) The Two Towers, J. R. R. Tolkien, 352\n3) The Alchemist, Paulo Coelho, 197\n4) The Fellowship of the Ring, J. R. R. Tolkien, 432\n5) The Pilgrimage, Paulo Coelho, 288\n6) A Game of Thrones, George R. R. Martin, 864\n\n$ sed -n 'p' books.txt\n1) Storm of Swords, George R. R. Martin, 1216\n2) The Two Towers, J. R. R. Tolkien, 352\n3) The Alchemist, Paulo Coelho, 197\n4) The Fellowship of the Ring, J. R. R. Tolkien, 432\n5) The Pilgrimage, Paulo Coelho, 288\n6) A Game of Thrones, George R. R. Martin, 864\n</code></pre>"},{"location":"sed/#_36","title":"\u79fb\u9664\u7a7a\u884c","text":"<pre><code>$ echo -e \"Line #1\\n\\n\\nLine #2\" | sed '/^$/d'\nLine #1\nLine #2\n</code></pre>"},{"location":"sed/#_37","title":"\u5220\u9664\u8fde\u7eed\u7a7a\u884c","text":"<pre><code>$ echo -e \"Line #1\\n\\n\\nLine #2\" | sed '/./,/^$/!d'\nLine #1\n\nLine #2\n</code></pre>"},{"location":"sed/#_38","title":"\u5220\u9664\u5f00\u5934\u7684\u7a7a\u884c","text":"<pre><code>$ echo -e \"\\nLine #1\\n\\nLine #2\" | sed '/./,$!d'\nLine #1\n\nLine #2\n</code></pre>"},{"location":"sed/#_39","title":"\u5220\u9664\u7ed3\u5c3e\u7684\u7a7a\u884c","text":"<pre><code>$ echo -e \"\\nLine #1\\nLine #2\\n\\n\" | sed ':start /^\\n*$/{$d; N; b start }'\n\nLine #1\n\nLine #2\n</code></pre>"},{"location":"sed/#html","title":"\u8fc7\u6ee4\u6240\u6709\u7684html\u6807\u7b7e","text":"<pre><code>$ cat html.txt\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;This is the page title&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;p&gt; This is the &lt;b&gt;first&lt;/b&gt; line in the Web page.\n    This should provide some &lt;i&gt;useful&lt;/i&gt; information to use in our sed script.\n&lt;/body&gt;\n&lt;/html&gt;                                                                                  \n$ sed 's/&lt;[^&gt;]*&gt;//g ; /^$/d' html.txt\n    This is the page title\n     This is the first line in the Web page.\n    This should provide some useful information to use in our sed script.\n</code></pre>"},{"location":"sed/#c_1","title":"\u4eceC++\u7a0b\u5e8f\u4e2d\u79fb\u9664\u6ce8\u91ca","text":"<p>\u6709\u4e0b\u9762\u8fd9\u6837\u4e00\u4e2acpp\u6587\u4ef6</p> <pre><code>$ cat hello.cpp\n#include &lt;iostream&gt; \nusing namespace std; \nint main(void) \n{ \n   // Displays message on stdout. \n   cout &gt;&gt; \"Hello, World !!!\" &gt;&gt; endl;  \n   return 0; // Return success. \n}\n</code></pre> <p>\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u53ef\u4ee5\u79fb\u9664\u6ce8\u91ca</p> <pre><code>$ sed 's|//.*||g' hello.cpp\n#include &lt;iostream&gt;\nusing namespace std;\nint main(void)\n{\n\n   cout &gt;&gt; \"Hello, World !!!\" &gt;&gt; endl;\n   return 0;\n }\n</code></pre>"},{"location":"sed/#_40","title":"\u4e3a\u67d0\u4e9b\u884c\u6dfb\u52a0\u6ce8\u91ca","text":"<pre><code>$ sed '3,5 s/^/#/' hello.sh \n#!/bin/bash \n#pwd \n#hostname \n#uname -a \nwho \nwho -r \nlsb_release -a\n</code></pre>"},{"location":"sed/#wc-l","title":"\u5b9e\u73b0Wc -l\u547d\u4ee4","text":"<p><code>wc -l</code>\u547d\u4ee4\u7528\u4e8e\u7edf\u8ba1\u6587\u4ef6\u4e2d\u7684\u884c\u6570\uff0c\u4f7f\u7528SED\u4e5f\u53ef\u4ee5\u6a21\u62df\u8be5\u547d\u4ee4</p> <pre><code>$ wc -l hello.cpp\n       9 hello.cpp\n$ sed -n '$ =' hello.cpp\n9\n</code></pre>"},{"location":"sed/#head","title":"\u6a21\u62df\u5b9e\u73b0<code>head</code>\u547d\u4ee4","text":"<p><code>head</code>\u547d\u4ee4\u7528\u4e8e\u8f93\u51fa\u6587\u4ef6\u4e2d\u7684\u524d10\u884c\u5185\u5bb9\u3002</p> <pre><code>$ head books2.txt\nA Storm of Swords\nGeorge R. R. Martin\nThe Two Towers\nJ. R. R. Tolkien\nThe Alchemist\nPaulo Coelho\nThe Fellowship of the Ring\nJ. R. R. Tolkien\nThe Pilgrimage\nPaulo Coelho\n</code></pre> <p>\u4f7f\u7528SED\u4e2d\u7684<code>sed '10 q'</code>\u53ef\u4ee5\u6a21\u62df\u5b83\u7684\u5b9e\u73b0</p> <pre><code>$ sed '10 q' books.txt \nA Storm of Swords \nGeorge R. R. Martin \nThe Two Towers \nJ. R. R. Tolkien \nThe Alchemist \nPaulo Coelho \nThe Fellowship of the Ring \nJ. R. R. Tolkien \nThe Pilgrimage\nPaulo Coelho\n</code></pre>"},{"location":"sed/#tail-1","title":"\u6a21\u62df<code>tail -1</code>\u547d\u4ee4","text":"<p><code>tail -1</code>\u8f93\u51fa\u6587\u4ef6\u7684\u6700\u540e\u4e00\u884c\u3002</p> <pre><code>$ cat test.txt\nLine #1 \nLine #2\n\n$ tail -1 test.txt\nLine #2\n$ sed $ sed -n '$p' test.txt\nLine #2\n</code></pre>"},{"location":"sed/#dos2unix","title":"\u6a21\u62df<code>Dos2unix</code>\u547d\u4ee4","text":"<p>\u5728DOS\u73af\u5883\u4e2d\uff0c\u6362\u884c\u7b26\u662f\u4f7f\u7528CR/LF\u4e24\u4e2a\u5b57\u7b26\u4e00\u8d77\u8868\u793a\u7684\uff0c\u4e0b\u9762\u547d\u4ee4\u6a21\u62df\u4e86<code>dos2unix</code>\u547d\u4ee4\u8f6c\u6362\u8fd9\u4e9b\u6362\u884c\u7b26\u4e3aUNIX\u6362\u884c\u7b26\u3002</p> <p>\u5728GNU/Linux\u73af\u5883\u4e2d\uff0cCR/LF\u901a\u5e38\u4f7f\u7528\"\\^M\"\uff08\u4e0d\u662f\u7b80\u5355\u7684\u4e24\u4e2a\u7b26\u53f7\u7ec4\u5408\uff0c\u8bf7\u4f7f\u7528\u5feb\u6377\u952eCtrl+v,Ctrl+m\u8f93\u5165\uff09\u8fdb\u884c\u8868\u793a\u3002</p> <pre><code>$ echo -e \"Line #1\\r\\nLine #2\\r\" &gt; test.txt\n$ file test.txt\ntest.txt: ASCII text, with CRLF line terminators\n$ sed 's/^M$//' test.txt &gt; new.txt\n$ file new.txt\nnew.txt: ASCII text\n$ cat -vte new.txt\nLine #1$\nLine #2$\n</code></pre>"},{"location":"sed/#unix2dos","title":"\u6a21\u62df<code>Unix2dos</code>\u547d\u4ee4","text":"<pre><code>$ file new.txt\nnew.txt: ASCII text\n$ sed 's/$/\\r/' new.txt &gt; new2.txt\n$ file new2.txt\nnew2.txt: ASCII text, with CRLF line terminators\n\n$ cat -vte new2.txt\nLine #1^M$\nLine #2^M$\n</code></pre>"},{"location":"sed/#cat-e","title":"\u6a21\u62df<code>cat -E</code>\u547d\u4ee4","text":"<p><code>cat -E</code>\u547d\u4ee4\u4f1a\u5728\u6bcf\u4e00\u884c\u7684\u884c\u5c3e\u8f93\u51fa\u4e00\u4e2a$\u7b26\u53f7\u3002</p> <pre><code>$ echo -e \"Line #1\\nLine #2\" | cat -E\nLine #1$\nLine #2$\n$ echo -e \"Line #1\\nLine #2\" | sed 's|$|&amp;$|'\nLine #1$\nLine #2$\n</code></pre> <p>\u6ce8\u610f\uff0c\u5728Mac\u4e0b\u4e0d\u652f\u6301<code>cat -E</code>\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528sed\u4ee3\u66ff</p>"},{"location":"sed/#cat-et","title":"\u6a21\u62df<code>cat -ET</code>\u547d\u4ee4","text":"<p><code>cat -ET</code>\u547d\u4ee4\u4e0d\u4ec5\u5bf9\u6bcf\u4e00\u884c\u7684\u884c\u5c3e\u6dfb\u52a0$\uff0c\u8fd8\u4f1a\u5c06\u6bcf\u4e00\u884c\u4e2d\u7684TAB\u663e\u793a\u4e3a^I\u3002</p> <pre><code>$ echo -e \"Line #1\\tLine #2\" | cat -ET\nLine #1^ILine #2$\n$ echo -e \"Line #1\\tLine #2\" | sed -n 'l' | sed 'y/\\\\t/^I/'\nLine #1^ILine #2$\n</code></pre>"},{"location":"sed/#nl","title":"\u6a21\u62df<code>nl</code>\u547d\u4ee4","text":"<p>\u547d\u4ee4<code>nl</code>\u53ef\u4ee5\u4e3a\u8f93\u5165\u5185\u5bb9\u7684\u6bcf\u4e00\u884c\u6dfb\u52a0\u884c\u53f7\uff0c\u8bb0\u5f97\u4e4b\u524d\u4ecb\u7ecd\u7684<code>=</code>\u64cd\u4f5c\u7b26\u5427\uff0c\u5728SED\u4e2d\u6211\u4eec\u53ef\u4ee5\u7528\u5b83\u6765\u5b9e\u73b0\u4e0e<code>nl</code>\u547d\u4ee4\u7c7b\u4f3c\u7684\u529f\u80fd\u3002</p> <pre><code>$ echo -e \"Line #1\\nLine #2\" |nl\n     1  Line #1\n     2  Line #2\n$ echo -e \"Line #1\\nLine #2\" | sed = |  sed 'N;s/\\n/\\t/'\n1   Line #1\n2   Line #2\n</code></pre> <p>\u4e0a\u9762\u7684SED\u547d\u4ee4\u4f7f\u7528\u4e86\u4e24\u6b21\uff0c\u7b2c\u4e00\u6b21\u4f7f\u7528<code>=</code>\u64cd\u4f5c\u7b26\u4e3a\u6bcf\u4e00\u884c\u8f93\u51fa\u884c\u53f7\uff0c\u6ce8\u610f\u8fd9\u4e2a\u884c\u53f7\u662f\u72ec\u5360\u4e00\u884c\u7684\uff0c\u56e0\u6b64\u4f7f\u7528\u7ba1\u9053\u7b26\u8fde\u63a5\u4e86\u7b2c\u4e8c\u4e2aSED\u547d\u4ee4\uff0c\u6bcf\u6b21\u8bfb\u53d6\u4e24\u884c\uff0c\u5c06\u6362\u884c\u7b26\u66ff\u6362\u4e3aTab\uff0c\u8fd9\u6837\u5c31\u6a21\u62df\u51fa\u4e86<code>nl</code>\u547d\u4ee4\u7684\u6548\u679c\u3002</p>"},{"location":"sed/#cp","title":"\u6a21\u62df<code>cp</code>\u547d\u4ee4","text":"<pre><code>$ sed -n 'w dup.txt' data.txt\n$ diff data.txt dup.txt\n$ echo $?\n0\n</code></pre>"},{"location":"sed/#expand","title":"\u6a21\u62df<code>expand</code>\u547d\u4ee4","text":"<p><code>expand</code>\u547d\u4ee4\u4f1a\u8f6c\u6362\u8f93\u5165\u4e2d\u7684TAB\u4e3a\u7a7a\u683c\uff0c\u5728SED\u4e2d\u4e5f\u53ef\u4ee5\u6a21\u62df\u5b83</p> <pre><code>$ echo -e \"One\\tTwo\\tThree\" &gt; test.txt\n$ expand test.txt &gt; expand.txt\n$ sed 's/\\t/     /g' test.txt &gt; new.txt\n$ diff new.txt expand.txt\n$ echo $?\n0\n</code></pre>"},{"location":"sed/#tee","title":"\u6a21\u62df<code>tee</code>\u547d\u4ee4","text":"<p><code>tee</code>\u547d\u4ee4\u4f1a\u5c06\u6570\u636e\u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\u7684\u540c\u65f6\u5199\u5165\u6587\u4ef6\u3002</p> <pre><code>$ echo -e \"Line #1\\nLine #2\" | tee test.txt  \nLine #1 \nLine #2\n</code></pre> <p>\u5728SED\u4e2d\uff0c\u5b9e\u73b0\u8be5\u547d\u4ee4\u975e\u5e38\u7b80\u5355</p> <pre><code>$ sed -n 'p; w new.txt' test.txt\nOne Two Three\n</code></pre>"},{"location":"sed/#cat-s","title":"\u6a21\u62df<code>cat -s</code>\u547d\u4ee4","text":"<p><code>cat -s</code>\u547d\u4ee4\u4f1a\u5c06\u8f93\u5165\u6587\u4ef6\u4e2d\u7684\u591a\u884c\u7a7a\u884c\u5408\u5e76\u4e3a\u4e00\u884c\u3002</p> <pre><code>$ echo -e \"Line #1\\n\\n\\n\\nLine #2\\n\\n\\nLine #3\" | cat -s\nLine #1\n\nLine #2\n\nLine #3\n</code></pre> <p>\u5728SED\u4e2d\u5b9e\u73b0</p> <pre><code>$ echo -e \"Line #1\\n\\n\\n\\nLine #2\\n\\n\\nLine #3\" | sed '1s/^$//p;/./,/^$/!d'\nLine #1\n\nLine #2\n\nLine #3\n</code></pre> <p>\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f<code>/./,/^$/!d</code>\u8fd9\u4e2a\u547d\u4ee4\uff0c\u5b83\u7684\u610f\u601d\u662f\u5339\u914d\u533a\u95f4<code>/./</code>\u5230<code>/^$</code>\uff0c\u533a\u95f4\u7684\u5f00\u59cb\u4f1a\u5339\u914d\u81f3\u5c11\u5305\u542b\u4e00\u4e2a\u5b57\u7b26\u7684\u884c\uff0c\u7ed3\u675f\u4f1a\u5339\u914d\u4e00\u4e2a\u7a7a\u884c\uff0c\u5728\u8fd9\u4e2a\u533a\u95f4\u4e2d\u7684\u884c\u4e0d\u4f1a\u88ab\u5220\u9664\u3002</p>"},{"location":"sed/#grep","title":"\u6a21\u62df<code>grep</code>\u547d\u4ee4","text":"<pre><code>$ echo -e \"Line #1\\nLine #2\\nLine #3\" | grep 'Line #1'\nLine #1\n$ echo -e \"Line #1\\nLine #2\\nLine #3\" | sed -n '/Line #1/p'\nLine #1\n</code></pre>"},{"location":"sed/#grep-v","title":"\u6a21\u62df<code>grep -v</code>\u547d\u4ee4","text":"<pre><code>$ echo -e \"Line #1\\nLine #2\\nLine #3\" | grep -v 'Line #1'\nLine #2\nLine #3\n$ echo -e \"Line #1\\nLine #2\\nLine #3\" | sed -n '/Line #1/!p'\nLine #2\nLine #3\n</code></pre>"},{"location":"sed/#tr","title":"\u6a21\u62df<code>tr</code>\u547d\u4ee4","text":"<p><code>tr</code>\u547d\u4ee4\u7528\u4e8e\u5b57\u7b26\u8f6c\u6362</p> <pre><code>$ echo \"ABC\" | tr \"ABC\" \"abc\"\nabc\n$ echo \"ABC\" | sed 'y/ABC/abc/'\nabc\n</code></pre>"},{"location":"sed/#_41","title":"\u5199\u5728\u6700\u540e","text":"<p>\u770b\u5230\u8fd9\u91cc\uff0c\u4f60\u80af\u5b9a\u8981\u5410\u69fd\u4e86\uff0c\u4e0d\u662f\u8bf4\u4e86\u4e09\u5341\u5206\u949f\u5b66\u4f1a\u5417\uff1f\u4f60\u786e\u5b9a\u4f60\u80fd\u4e09\u5341\u5206\u949f\u5b66\u4f1a\uff1f\u4e0a\u6b21\u7684[\u4e09\u5341\u5206\u949f\u5b66\u4f1aAWK][]\u8bf4\u4e09\u5341\u5206\u949f\u5b66\u4f1a\u4e0d\u9760\u8c31\uff0c\u8fd9\u6b21\u53c8\u4e0d\u9760\u8c31\u4e86\u3002\u4e0d\u597d\u610f\u601d\uff0c\u8fd9\u91cc\u7684\u4e09\u5341\u5206\u949f\u5176\u5b9e\u53ea\u662f\u4e3a\u4e86\u5438\u5f15\u4f60\u7684\u6ce8\u610f\u800c\u5df2\uff0c\u53ea\u6709\u5728\u4f60\u5df2\u7ecf\u7528\u8fc7SED\u5e76\u5bf9\u5b83\u7684\u4e00\u4e9b\u7279\u6027\u6709\u6240\u4e86\u89e3\u7684\u60c5\u51b5\u4e0b\u4e09\u5341\u5206\u949f\u770b\u5b8c\u624d\u662f\u6709\u53ef\u80fd\u7684\uff0c\u6bd5\u7adf\u90a3\u4e48\u591a\u7279\u6b8a\u5b57\u7b26\uff0c\u90a3\u4e48\u591a\u547d\u4ee4\u9700\u8981\u8bb0\u4f4f\u3002\u4e0d\u8fc7\u8bdd\u8bf4\u56de\u6765\uff0c\u770b\u5b8c\u4e4b\u540e\u4f60\u6709\u6536\u83b7\u5417\uff1f\u6709\u7684\u8bdd\uff0c\u90a3\u672c\u6587\u7684\u76ee\u7684\u5c31\u8fbe\u5230\u4e86\uff0c\u4e4b\u540e\u7528\u5230SED\u7684\u65f6\u5019\u518d\u56de\u6765\u53c2\u8003\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u672c\u6587\u5c06\u4f1a\u6301\u7eed\u4fee\u6b63\u548c\u66f4\u65b0\uff0c\u6700\u65b0\u5185\u5bb9\u8bf7\u53c2\u8003\u6211\u7684 GITHUB \u4e0a\u7684 \u7a0b\u5e8f\u733f\u6210\u957f\u8ba1\u5212 \u9879\u76ee\uff0c\u6b22\u8fce Star\u3002</p>"},{"location":"sed/#_42","title":"\u53c2\u8003","text":"<ul> <li>Sed Tutorial</li> <li>Linux\u547d\u4ee4\u884c\u4e0eshell\u811a\u672c\u7f16\u7a0b\u5927\u5168\uff08\u7b2c3\u7248\uff09</li> </ul>"},{"location":"show-engine-innodb-status/","title":"innodb status\u89e3\u8bfb","text":""},{"location":"show-engine-innodb-status/#show-engine-innodb-status","title":"show engine innodb status \u89e3\u8bfb","text":"<ul> <li>https://blog.51cto.com/u_15080030/2642739</li> <li>https://www.cnblogs.com/xiaoboluo768/p/5171425.html</li> </ul> <p>InnoDB\u662fMySQL\u4f7f\u7528\u6700\u591a\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u901a\u5e38InnoDB\u72b6\u6001\u53ef\u4ee5\u901a\u8fc7show engine innodb status\\G\u67e5\u770b\u3002 \u7531\u4e8eMySQL\u4e0d\u540c\u7248\u672c\u91c7\u7528InnoDB\u5f15\u64ce\u7248\u672c\u4e0d\u540c\uff0c5.6\u540e\u5bf9show engine innodb status\u4fe1\u606f\u8fdb\u884c\u4e86\u4f18\u5316\uff0c\u672c\u6587\u73af\u5883\u4e3a5.7\u3002</p> MySQL\u7248\u672c InnoDB\u5f15\u64ce\u7248\u672c 5.1.x 1.0.x\u7248\u672c(\u5b98\u65b9\u79f0\u4e3aInnoDB Plugin) 5.5.x 5.5(1.1.x\u7248\u672c), InnoDB\u88abOracle\u6536\u56de\u540e 5.6.x 5.6(1.2.x\u7248\u672c) 5.7.x 5.7 8.0.x 8.0 <p>show engine innodb status\u7edf\u8ba1\u4fe1\u606f \u9700\u8981\u6ce8\u610f\u4e00\u70b9\uff1ashow engine innodb status\u663e\u793a\u7684\u4e0d\u662f\u5f53\u524d\u72b6\u6001\uff0c\u800c\u662f\u8fc7\u53bb\u67d0\u4e2a\u65f6\u95f4\u8303\u56f4\u5185InnoDB\u5b58\u50a8\u5f15\u64ce\u7684\u72b6\u6001\u3002</p> <pre><code>Per second averages calculated from the last 59 seconds\n</code></pre> <p>\u5728\u663e\u793a\u524d\u7aef\u53ef\u770b\u5230\u4ee5\u4e0a\u4fe1\u606f\uff0c\u4ee3\u8868\u67e5\u8be2\u7684\u4fe1\u606f\u4e3a\u8fc7\u53bb59\u79d2\u5185\u6bcf2\u79d2\u7684\u5e73\u5747\u503c\u3002 show engine innodb status\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u90e8\u5206\uff1a</p> \u9805\u76ee \u5099\u8003\u6b04 BACKGROUND THREAD \u540e\u53f0Master\u7ebf\u7a0bI SEMAPHORES \u4fe1\u53f7\u91cf\u4fe1\u606f LATEST DETECTED DEADLOCK \u6700\u8fd1\u4e00\u6b21\u6b7b\u9501\u4fe1\u606f,\u53ea\u6709\u4ea7\u751f\u8fc7\u6b7b\u9501\u624d\u4f1a\u6709 TRANSACTIONS \u4e8b\u52a1\u4fe1\u606f FILE I/O IO Thread\u4fe1\u606f INSERT BUFFER AND ADAPTIVE HASH INDEX INSERT BUFFER\u548c\u81ea\u9002\u5e94HASH\u7d22\u5f15 LOG \u65e5\u5fd7 BUFFER POOL AND MEMORY BUFFER POOL\u548c\u5185\u5b58 INDIVIDUAL BUFFER POOL INFO \u5982\u679c\u8bbe\u7f6e\u4e86\u591a\u4e2aBUFFER POOL\u5b9e\u4f8b,\u8fd9\u91cc\u663e\u793a\u6bcf\u4e2aBUFFER POOL\u4fe1\u606f,\u53ef\u4ee5\u901a\u8fc7innodb_buffer_pool_instances\u53c2\u6570\u8bbe\u7f6e ROW OPERATIONS \u884c\u64cd\u4f5c\u7edf\u8ba1\u4fe1\u606f END OF INNODB MONITOR OUTPUT \u8f93\u51fa\u7ed3\u675f\u8bed"},{"location":"show-engine-innodb-status/#background-thread","title":"BACKGROUND THREAD","text":"<p>InnoDB\u5b58\u50a8\u5f15\u64ce\u7684\u6838\u5fc3\u64cd\u4f5c\u5927\u90e8\u5206\u90fd\u96c6\u4e2d\u5728Mater Thread\u540e\u53f0\u7ebf\u7a0b\u4e2d\u3002 MySQL5.5\u7248\u672c\u4e4b\u524d\uff1a <pre><code>-----------------\nBACKGROUND THREAD\n-----------------\nsrv_master_thread loops: 846676 1_second, 846675 sleeps, 84665 10_second, 17 background, 17 flush\nsrv_master_thread log flush and writes: 854189\n</code></pre></p> <p>MySQL 5.6\u4e4b\u540e\u5bf9Master Thread\u8fdb\u884c\u4e86\u4f18\u5316\uff0c\u53bb\u9664\u4e86sleeps\u7684\u4fe1\u606f\uff0csrv_active\u4e3a\u4e4b\u524d\u7684\u6bcf\u79d2\u7684\u5faa\u73af\uff0csrv_idle\u4e3a\u6bcf10\u79d2\u7684\u7684\u5faa\u73af\uff0csrv_shutdown\u4e3a\u505c\u6b62\u7684\u5faa\u73af\uff0c\u901a\u5e38\u4e3a0\uff0c\u53ea\u5728MySQL\u5173\u95ed\u65f6\u624d\u4f1a\u589e\u52a0\u3002</p> <pre><code>-----------------\nBACKGROUND THREAD\n-----------------\nsrv_master_thread loops: 3911776 srv_active, 0 srv_shutdown, 309625 srv_idle\nsrv_master_thread log flush and writes: 4221384\n</code></pre> <p>\u4e0a\u9762\u53ef\u4ee5\u770b\u51fa\u4e3b\u5faa\u73af\u6bcf10\u79d2\u8fdb\u884c\u4e86309625\u6b21\uff0c\u6bcf\u79d2\u8fdb\u884c\u4e863911776\u6b21\uff0c\u6bcf10\u79d2\u7684\u64cd\u4f5c\u7b26\u54081:10\u3002 \u8d1f\u8f7d\u4f4e\u7684\u60c5\u51b5\u4e0b\u65e5\u5fd7\u7f13\u51b2\u5237\u76d8\u6b21\u6570\uff0c4221384 \u2248 3911776+309625\u3002 \u6839\u636e\u5faa\u73af\u6b21\u6570\u53ef\u5927\u6982\u5224\u65ad\u5f53\u524d\u6570\u636e\u5e93\u8d1f\u8f7d\u60c5\u51b5\u3002\u5982\u679c\u6bcf\u79d2\u5faa\u73af\u6b21\u6570\u5c11\uff0c\u6bcf10\u79d2\u6b21\u6570\u591a\uff0c\u8bc1\u660e\u5f53\u524d\u8d1f\u8f7d\u5f88\u4f4e\uff1b\u5982\u679c\u6bcf\u79d2\u5faa\u73af\u6b21\u6570\u591a\uff0c\u6bcf10\u79d2\u6b21\u6570\u5c11\uff0c\u8fdc\u5927\u4e8e10:1\uff0c\u8bc1\u660e\u5f53\u524d\u8d1f\u8f7d\u5f88\u9ad8\u3002</p>"},{"location":"show-engine-innodb-status/#semaphores","title":"SEMAPHORES","text":"<p>\u5f53\u524d\u7b49\u5f85\u7ebf\u7a0b\u7684\u5217\u8868\u53ca\u4e8b\u4ef6\u8ba1\u6570\u5668\uff0c\u53ef\u4ee5\u8bc4\u4f30\u5f53\u524d\u8d1f\u8f7d\u60c5\u51b5\u3002</p> <pre><code>----------\nSEMAPHORES\n----------\nOS WAIT ARRAY INFO: reservation count 58961200\nOS WAIT ARRAY INFO: signal count 125268732\nMutex spin waits 770371493, rounds 6482840874, OS waits 20699077\nRW-shared spins 0, rounds 115276716, OS waits 14655922\nRW-excl spins 0, rounds 987115172, OS waits 12384598\nRW-sx spins 40484350, rounds 419545112, OS waits 4476477\nSpin rounds per wait: 115276716.00 RW-shared, 987115172.00 RW-excl, 10.36 RW-sx\n</code></pre> \u9805\u76ee \u5099\u8003\u6b04 OS WAIT ARRAY INFO reservation count: \u8868\u793aInnoDB\u4ea7\u51fa\u4e86\u591a\u5c11\u6b21OS WAIT OS WAIT ARRAY INFO signal count: \u8868\u793a\u4eca\u65e5OS WAIT\u7684\u7ebf\u7a0b\u88ab\u5524\u9192\u6b21\u6570 Mutex(5.7\u540e\u53bb\u9664) spins: \u7a7a\u8f6c\u6b21\u6570,\u901a\u8fc7innodb_sync_spin_loops\u63a7\u5236,\u8d85\u8fc7\u5219\u8f6c\u5230OS Waits Mutex(5.7\u540e\u53bb\u9664) spin waits:  spin\u7ebf\u7a0b\u65e0\u6cd5\u83b7\u53d6\u9501\u800c\u8fdb\u5165Spin wait Mutex(5.7\u540e\u53bb\u9664) rounds: spin wait\u8fdb\u884c\u8f6e\u8be2\u67e5mutexes\u7684\u6b21\u6570 Mutex(5.7\u540e\u53bb\u9664) OS waits: \u7ebf\u7a0b\u653e\u5f03spin wait\u8fdb\u5165\u6302\u8d77\u72b6\u6001 RW-shared RW-shared \u5171\u4eab\u9501 RW-excl RW-excl \u6392\u5b83\u9501 RW-sx 5.7\u540e\u65b0\u589e, RW-sx \u5171\u4eab\u6392\u5b83\u9501 Spin rounds per wait rounds / spins = \u503c <p>\u8981\u660e\u767dInnoDB\u5982\u4f55\u5904\u7406\u4e92\u65a5\u91cf(Mutexes)\uff0c\u4ee5\u53ca\u4ec0\u4e48\u662f\u4e24\u6b65\u83b7\u5f97\u9501(two-step approach)\u3002</p> <ol> <li>\u9996\u5148\u8fdb\u7a0b\u8bd5\u56fe\u83b7\u5f97\u4e00\u4e2a\u9501\uff0c\u5982\u679c\u6b64\u9501\u88ab\u5b83\u4eba\u5360\u7528\u3002\u5b83\u5c31\u4f1a\u6267\u884c\u6240\u8c13\u7684spin wait\uff0c\u5373\u6240\u8c13\u5faa\u73af\u7684\u67e5\u8be2\u201c\u9501\u88ab\u91ca\u653e\u4e86\u5417\uff1f\u201d\u3002</li> <li>\u5982\u679c\u5728\u5faa\u73af\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u76f4\u672a\u5f97\u5230\u9501\u91ca\u653e\u7684\u4fe1\u606f\uff0c\u5219\u5176\u8f6c\u5165OS WAIT\uff0c\u5373\u6240\u8c13\u7ebf\u7a0b\u8fdb\u5165\u6302\u8d77(suspended)\u72b6\u6001\u3002</li> <li>\u76f4\u5230\u9501\u88ab\u91ca\u653e\u540e\uff0c\u901a\u8fc7\u4fe1\u53f7(singal)\u5524\u9192\u7ebf\u7a0b\u3002     Spin wait\u7684\u6d88\u8017\u8fdc\u5c0f\u4e8eOSwaits\u3002Spin wait\u5229\u7528cpu\u7684\u7a7a\u95f2\u65f6\u95f4\uff0c\u68c0\u67e5\u9501\u7684\u72b6\u6001\uff0cOS Wait\u4f1a\u6709\u6240\u8c13content switch\uff0c\u4eceCPU\u5185\u6838\u4e2d\u6362\u51fa\u5f53\u524d\u6267\u884c\u7ebf\u7a0b\u4ee5\u4f9b\u5176\u5b83\u7ebf\u7a0b\u4f7f\u7528\u3002\u6240\u4ee5\u5e94\u5c3d\u91cf\u51cf\u5c11OS waits\uff0c\u53ef\u4ee5\u901a\u8fc7innodb_sync_spin_loops\u53c2\u6570\u6765\u5e73\u8861spin wait\u548cos wait\u3002Mutex\u4fe1\u606f\u53ef\u901a\u8fc7show engine innodb mutex\u67e5\u770b\u3002</li> </ol>"},{"location":"show-engine-innodb-status/#latest-detected-deadlock","title":"LATEST DETECTED DEADLOCK","text":"<p>\u8bb0\u5f55\u6700\u8fd1\u4e00\u6b21\u6b7b\u9501\u4fe1\u606f\uff0c\u53ea\u6709\u4ea7\u751f\u8fc7\u6b7b\u9501\u624d\u4f1a\u6709\u8bb0\u5f55\u3002</p> <pre><code>------------------------\nLATEST DETECTED DEADLOCK\n------------------------\n190425 18:00:13\n*** (1) TRANSACTION:\nTRANSACTION 231E7C5DF, ACTIVE 0 sec starting index read\nmysql tables in use 1, locked 1\nLOCK WAIT 4 lock struct(s), heap size 1248, 3 row lock(s)\nMySQL thread id 1346996, OS thread handle 0x7fd968454700, query id 760545285 10.10.x.x app_user updating\nDELETE \n    FROM db_0.table_0\n    WHERE ORDER_ID IN (  456787464 , 456787465 )\n*** (1) WAITING FOR THIS LOCK TO BE GRANTED:\nRECORD LOCKS space id 5 page no 6064 n bits 824 index `orderId_index` of table `db_0`.`table_0` trx id 231E7C5DF lock_mode X waiting\nRecord lock, heap no 180 PHYSICAL RECORD: n_fields 2; compact format; info bits 32\n 0: len 8; hex 80000015eb6a1041; asc      j A;;\n 1: len 8; hex 800000002018fce2; asc         ;\n*** (2) TRANSACTION:\nTRANSACTION 231E7C5DD, ACTIVE 0 sec starting index read, thread declared inside InnoDB 1\nmysql tables in use 1, locked 1\n5 lock struct(s), heap size 1248, 4 row lock(s)\nMySQL thread id 1348165, OS thread handle 0x7fd96669f700, query id 760545283 10.10.x.x app_user updating\nDELETE \n    FROM db_0.table_0\n    WHERE ORDER_ID IN (  456787464 , 456787465 )\n*** (2) HOLDS THE LOCK(S):\nRECORD LOCKS space id 5 page no 6064 n bits 824 index `orderId_index` of table `db_0`.`table_0` trx id 231E7C5DD lock_mode X locks rec but not gap\nRecord lock, heap no 180 PHYSICAL RECORD: n_fields 2; compact format; info bits 32\n 0: len 8; hex 80000015eb6a1041; asc      j A;;\n 1: len 8; hex 800000002018fce2; asc         ;;\n*** (2) WAITING FOR THIS LOCK TO BE GRANTED:\nRECORD LOCKS space id 5 page no 6064 n bits 824 index `orderId_index` of table `db_0`.`table_0` trx id 231E7C5DD lock_mode X waiting\nRecord lock, heap no 180 PHYSICAL RECORD: n_fields 2; compact format; info bits 32\n 0: len 8; hex 80000015eb6a1041; asc      j A;;\n 1: len 8; hex 800000002018fce2; asc         ;;\n\n*** WE ROLL BACK TRANSACTION (1)\n</code></pre> <p>\u6b7b\u9501\u662f\u6307\u4e24\u4e2a\u6216\u4e24\u4e2a\u4ee5\u4e0a\u7684\u8fdb\u7a0b\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u56e0\u4e89\u593a\u8d44\u6e90\u800c\u9020\u6210\u7684\u4e00\u79cd\u4e92\u76f8\u7b49\u5f85\u7684\u73b0\u8c61\u3002\u6b63\u5e38\u6b7b\u9501\u4f1a\u81ea\u52a8\u91ca\u653e\uff0cinnodb\u6709\u4e00\u4e2a\u5185\u5728\u7684\u6b7b\u9501\u68c0\u6d4b\u5de5\u5177\uff0c\u5f53\u6b7b\u9501\u8d85\u8fc7\u4e00\u5b9a\u65f6\u95f4\u540e\uff0c\u4f1a\u56de\u6eda\u5176\u4e2d\u4e00\u4e2a\u4e8b\u52a1\uff0cinnodb_lock_wait_timeout\u53ef\u914d\u7f6e\u6b7b\u9501\u7b49\u5f85\u8d85\u65f6\u65f6\u95f4\u3002 \u6b7b\u9501\u5728\u4e24\u60c5\u51b5\u4e0b\u6700\u5bb9\u6613\u4ea7\u751f\uff1a</p> <ul> <li>\u9ad8\u5e76\u53d1\u540c\u65f6\u64cd\u4f5c\u540c\u4e00\u6761\u6570\u636e</li> <li>\u5b58\u5728\u4e3b\u952e\u548c\u8f85\u52a9\u7d22\u5f15\uff0c\u52a0\u9501\u987a\u5e8f\u76f8\u53cd   \u907f\u514d\u6b7b\u9501\u65b9\u6cd5\u5373\u964d\u4f4e\u5e76\u53d1\uff0c\u64cd\u4f5c\u6570\u636e\u65f6\u4f7f\u52a0\u9501\u987a\u5e8f\u76f8\u540c\u3002</li> </ul>"},{"location":"show-engine-innodb-status/#transactions","title":"TRANSACTIONS","text":"<p>\u5305\u542b\u4e86InnoDB\u4e8b\u52a1(transaction)\u7684\u7edf\u8ba1\u4fe1\u606f\u3002</p> <pre><code>------------\nTRANSACTIONS\n------------\nTrx id counter 2409176\nPurge done for trx's n:o &lt; 2409171 undo n:o &lt; 0 state: running but idle\nHistory list length 31\nLIST OF TRANSACTIONS FOR EACH SESSION:\n---TRANSACTION 421224214038352, not started\n0 lock struct(s), heap size 1136, 0 row lock(s)\n---TRANSACTION 421224214044736, not started\n0 lock struct(s), heap size 1136, 0 row lock(s)\n---TRANSACTION 421224214039264, not started\n0 lock struct(s), heap size 1136, 0 row lock(s)\n---TRANSACTION 2409171, ACTIVE 1549 sec fetching rows, thread declared inside InnoDB 3871\nmysql tables in use 1, locked 0\n0 lock struct(s), heap size 1136, 0 row lock(s)\nMySQL thread id 653597, OS thread handle 140289889908480, query id 2528936 127.0.0.1 root Sending data\nSELECT /*!40001 SQL_NO_CACHE */ * FROM `table`\n</code></pre> \u9805\u76ee \u5099\u8003\u6b04 Trx id counter \u5f53\u524d\u4e8b\u52a1ID Purge done for trx's \u6b63\u5728\u6e05\u7406\u6389\u7684 transaction IDignal count: \u8868\u793a\u4eca\u65e5OS WAIT\u7684\u7ebf\u7a0b\u88ab\u5524\u9192\u6b21\u6570 History list length \u8bb0\u5f55\u4e86undo spaces\u5185\u672a\u6e05\u7406\u6389\u7684\u4e8b\u52a1\u4e2a\u6570,Purge\u7684\u539f\u5219\u662f\u8bb0\u5f55\u6ca1\u6709\u88ab\u5176\u4ed6\u4e8b\u52a1\u7ee7\u7eed\u4f7f\u7528 LIST OF TRANSACTION FOR EACH SESSION \u6bcf\u4e2asession\u7684\u4e8b\u52a1\u72b6\u6001 <p>\u5f53\u524d\u6d3b\u8dc3\u7684\u4e8b\u7269\u72b6\u6001\u4e3aACTIVE\uff0c\u4e8b\u7269\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5305\u62ec\u7ebf\u7a0bID\u3001\u6267\u884c\u65f6\u95f4\u3001\u7528\u6237\u3001SQL\u7b49\u3002\u6b63\u5728\u4f7f\u75281\u4e2a\u8868\uff0c\u6d89\u53ca\u9501\u7684\u88680\u4e2a\u3002</p>"},{"location":"show-engine-innodb-status/#file-io","title":"FILE I/O","text":"<p>\u5728InnoDB\u4e2d\u5927\u91cf\u4f7f\u7528\u4e86AIO\uff08Async IO\uff09\u6765\u5904\u7406IO \u8bf7\u6c42\uff0cIO Thread\u4e3b\u8981\u662f\u8d1f\u8d23\u8fd9\u4e9bIO\u8bf7\u6c42\u7684\u56de\u8c03\u5904\u7406\uff0c\u901a\u8fc7\u8c03\u7528fsync()\u51fd\u6570\u534f\u8c03\u5185\u5b58\u4e0e\u78c1\u76d8\u4e4b\u95f4\u7684\u6570\u636e\u3002</p> <pre><code>--------\nFILE I/O\n--------\nI/O thread 0 state: waiting for completed aio requests (insert buffer thread)\nI/O thread 1 state: waiting for completed aio requests (log thread)\nI/O thread 2 state: waiting for completed aio requests (read thread)\nI/O thread 3 state: waiting for completed aio requests (read thread)\nI/O thread 4 state: waiting for completed aio requests (read thread)\nI/O thread 5 state: waiting for completed aio requests (read thread)\nI/O thread 6 state: waiting for completed aio requests (read thread)\nI/O thread 7 state: waiting for completed aio requests (read thread)\nI/O thread 8 state: waiting for completed aio requests (read thread)\nI/O thread 9 state: waiting for completed aio requests (read thread)\nI/O thread 10 state: waiting for completed aio requests (write thread)\nI/O thread 11 state: waiting for completed aio requests (write thread)\nI/O thread 12 state: waiting for completed aio requests (write thread)\nI/O thread 13 state: waiting for completed aio requests (write thread)\nI/O thread 14 state: waiting for completed aio requests (write thread)\nI/O thread 15 state: waiting for completed aio requests (write thread)\nI/O thread 16 state: waiting for completed aio requests (write thread)\nI/O thread 17 state: waiting for completed aio requests (write thread)\nPending normal aio reads: [0, 0, 0, 0, 0, 0, 0, 0] , aio writes: [0, 0, 0, 0, 0, 0, 0, 0] ,\nibuf aio reads:, log i/o's:, sync i/o's:\nPending flushes (fsync) log: 0; buffer pool: 0\n15234061 OS file reads, 304461183 OS file writes, 73899457 OS fsyncs\n0.00 reads/s, 0 avg bytes/read, 0.24 writes/s, 0.17 fsyncs/s\n</code></pre> <p>InnoDB 1.0\u7248\u672c\u4e4b\u524d\u67094\u4e2aIO\u7ebf\u7a0b\uff0c1.1\u540e\u505a\u4e86\u4f18\u5316\uff0cPurge Thread\u4eceMaster Thread\u72ec\u7acb\u51fa\u6765\uff0c Purge Cleaner Thread\u4eceInnoDB 1.2\u7248\u672c\u5f15\u5165\uff0c\u90fd\u662f\u4e3a\u4e86\u51cf\u8f7bMaster Thread\u7684\u5de5\u4f5c\uff0c\u63d0\u9ad8CPU\u5229\u7528\u7387\u3002</p> \u9805\u76ee \u5099\u8003\u6b04 insert buffer thread \u5408\u5e76\u63d2\u5165\u7f13\u5b58, insert buffer\u7ef4\u62a4\u975e\u552f\u4e00\u8f85\u52a9\u7d22\u5f15 log thread \u8d1f\u8d23\u5f02\u6b65\u5237\u65b0\u4e8b\u52a1\u65e5\u5fd7 read thread \u9884\u8bfb, innodb_read_io_threads \u9ed8\u8ba44 write thread \u5237\u65b0\u810f\u9875\u7f13\u5b58, innodb_write_id_threads \u9ed8\u8ba44 purge thread \u56de\u6536\u5df2\u7ecf\u4f7f\u7528\u5e76\u5206\u914d\u7684undo\u9875,\u53ef\u8bbe\u7f6e\u591a\u4e2a purge cleaner thread \u5237\u65b0\u810f\u9875 <p>\u663e\u793a\u5404\u4e2aI/O thread\u7684pending operations,pending\u7684log\u548cbuffer pool thread\u7684fsync()\u8c03\u7528\uff1b aio\uff1a\u4ee3\u8868\u7684\u662f\u5f02\u6b65IO(asynchronous I/O)\uff1b OS file\uff1a\u663e\u793a\u4e86reads writes fsync() \u8c03\u7528\u6b21\u6570\u3002</p>"},{"location":"show-engine-innodb-status/#insert-buffer-and-adaptive-hash-index","title":"INSERT BUFFER AND ADAPTIVE HASH INDEX","text":"<p>INSERT BUFFER\u5373\u5408\u5e76\u63d2\u5165\u7f13\u5b58\uff0c\u4eceinnodb 1.0.x\u7248\u672c\u5f00\u59cb\u5f15\u5165Change Buffer\uff0c \u662fINSERT BUFFER\u5347\u7ea7\u7248\uff0c\u5373MySQL 5.1.x\u4ee5\u4e0a\u7248\u672c\u90fd\u652f\u6301\uff0c\u4e0d\u4ec5\u5305\u62ecINSERT BUFFER\uff0c\u8fd8\u5305\u62ecUPDATE BUFFER\u3001DELETE BUFFER\u3001PURGE BUFFER\u3002</p> <pre><code>-------------------------------------\nINSERT BUFFER AND ADAPTIVE HASH INDEX\n-------------------------------------\nIbuf: size 1356, free list len 149402, seg size 149404, 2004231 merges\nmerged operations:\n insert 1373793, delete mark 316276978, delete 5341003\ndiscarded operations:\n insert 0, delete mark 0, delete 0\nHash table size 298897, node heap has 1 buffer(s)\nHash table size 298897, node heap has 1 buffer(s)\nHash table size 298897, node heap has 0 buffer(s)\nHash table size 298897, node heap has 1 buffer(s)\nHash table size 298897, node heap has 1 buffer(s)\nHash table size 298897, node heap has 1 buffer(s)\nHash table size 298897, node heap has 2 buffer(s)\nHash table size 298897, node heap has 0 buffer(s)\nHash table size 298897, node heap has 1 buffer(s)\nHash table size 298897, node heap has 0 buffer(s)\nHash table size 298897, node heap has 0 buffer(s)\nHash table size 298897, node heap has 1 buffer(s)\nHash table size 298897, node heap has 1 buffer(s)\n193.03 hash searches/s, 713.40 non-hash searches/s\n</code></pre> \u9805\u76ee \u5099\u8003\u6b04 Ibud: size \u5df2\u7ecf\u5408\u5e76\u9875\u7684\u6570\u91cf free list len \u7a7a\u95f2\u5217\u8868\u957f\u5ea6 seg size Insert Buffer\u5927\u5c0f merges \u5408\u5e76\u6b21\u6570 merged operations Change Buffer\u4e2d\u6bcf\u4e2a\u64cd\u4f5c\u6b21\u6570; insert\u4ee3\u8868Insert Buffer; delete mark\u4ee3\u8868Delete Buffer; delete\u4ee3\u8868Purge Buffer discarded operations Change Buffer\u4e2d\u65e0\u9700\u5408\u5e76\u7684\u6b21\u6570 hash searches/s \u901a\u8fc7hash\u7d22\u5f15\u67e5\u8be2 non-hash searches/s \u4e0d\u80fd\u901a\u8fc7hash\u7d22\u5f15\u67e5\u8be2 <p>\u53ef\u4ee5\u770b\u5230\u81ea\u9002\u5e94\u54c8\u5e0c\u7d22\u5f15\u5927\u5c0f\u3001\u4f7f\u7528\u60c5\u51b5\u3001\u6bcf\u79d2\u4f7f\u7528\u81ea\u9002\u5e94\u54c8\u5e0c\u7d22\u5f15\u641c\u7d22\u60c5\u51b5\u3002\u81ea\u9002\u5e94HASH\u7d22\u5f15\uff0c\u7531INNODB\u5b58\u50a8\u5f15\u64ce\u63a7\u5236\uff0c\u53ea\u9002\u5408\u7b49\u503c\u67e5\u8be2\uff0c\u4e0d\u9002\u5408\u8303\u56f4\u67e5\u8be2\u3002\u53ef\u901a\u8fc7innodb_adaptive_hash_index\u6765\u7981\u7528\u6216\u542f\u52a8\u3002</p>"},{"location":"show-engine-innodb-status/#log","title":"LOG","text":"<p>\u4e8b\u7269\u65e5\u5fd7\u7684\u4fe1\u606f <pre><code>---\nLOG\n---\nLog sequence number 33859450169594\nLog flushed up to   33859450169564\nPages flushed up to 33859450169210\nLast checkpoint at  33859450169201\n0 pending log flushes, 0 pending chkp writes\n15044267 log i/o's done, 0.10 log i/o's/second\n</code></pre> InnoDB\u4e8b\u7269\u91c7\u7528Write-Ahead log\u7b56\u7565\uff0c\u5373\u4e8b\u7269\u5728\u63d0\u4ea4\u65f6\uff0c\u5148\u5199\u91cd\u505a\u65e5\u5fd7\uff0c\u5728\u4fee\u6539\u9875\u3002 Write-Ahead Log\uff1a\u5982\u679c\u4e00\u4e2a\u9875\u5728\u5199\u5165\u78c1\u76d8\u65f6\uff0c\u5fc5\u987b\u5148\u5c06\u5185\u5b58\u4e2d\u5c0f\u4e8e\u8be5\u9875LSN\u7684\u65e5\u5fd7\u5148\u5199\u5165\u5230\u78c1\u76d8\u4e2d\u3002 \u91cd\u505a\u65e5\u5fd7\u6709LSN\u3001\u6bcf\u4e2a\u9875\u6709LSN\u3001Checkpoint\u4e5f\u6709LSN\u3002</p> \u9805\u76ee \u5099\u8003\u6b04 Log sequence number \u6700\u65b0\u4ea7\u751f\u7684\u65e5\u5fd7\u5e8f\u5217\u53f7 Log flushed up to \u5df2\u5237\u5230\u786c\u76d8\u7684\u91cd\u505a\u65e5\u5fd7\u7684\u65e5\u5fd7\u53f7 Pages flushed up to \u5df2\u5237\u5230\u786c\u76d8\u7684\u9875\u7684\u65e5\u5fd7\u53f7 Last checkpoint at \u6700\u540e\u4e00\u6b21\u68c0\u67e5\u70b9\u4f4d\u7f6e,\u6570\u636e\u548c\u65e5\u5fd7\u4e00\u81f4\u7684\u72b6\u6001 pending \u5f53\u524d\u6302\u8d77\u7684\u65e5\u5fd7\u8bfb\u5199\u64cd\u4f5c <p>LSN\u8bb0\u5f55\u7684\u662f\u91cd\u505a\u65e5\u5fd7\u7684\u603b\u91cf\uff0c\u5355\u4f4d\u662f\u5b57\u8282\u3002\u4ee5\u4e0b\u4e09\u79cd\u60c5\u51b5\u4f1a\u5c06\u91cd\u505a\u65e5\u5fd7\u7f13\u5b58\u5237\u5230\u91cd\u505a\u65e5\u5fd7\u6587\u4ef6\uff1a</p> <ol> <li>Master Thread \u6bcf\u79d2\u5237\u91cd\u505a\u65e5\u5fd7\u7f13\u5b58\u5230\u91cd\u505a\u65e5\u5fd7\u6587\u4ef6</li> <li>innodb_flush_log_at_trx_commit=1\u65f6\uff0c\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u5237\u91cd\u505a\u65e5\u5fd7\u7f13\u5b58\u5230\u91cd\u505a\u65e5\u5fd7\u6587\u4ef6</li> <li>\u91cd\u505a\u65e5\u5fd7\u7f13\u51b2\u6c60\u5269\u4f59\u7a7a\u95f4\u5c0f\u4e8e1/2\u65f6\uff0c\u5237\u91cd\u505a\u65e5\u5fd7\u7f13\u5b58\u5230\u91cd\u505a\u65e5\u5fd7\u6587\u4ef6</li> </ol>"},{"location":"show-engine-innodb-status/#buffer-pool-and-memory","title":"BUFFER POOL AND MEMORY","text":"<p>innodb_buffer_pool\u5305\u542b\u6570\u636e\u9875\u3001\u7d22\u5f15\u9875\u3001undo\u9875\u3001insert buffer\u3001\u6570\u636e\u5b57\u5178\u3001\u81ea\u9002\u5e94\u54c8\u5e0c\u7d22\u5f15\u3001\u9501\u4fe1\u606f\u7b49\u3002\u6570\u636e\u5e93\u7f13\u51b2\u6c60\u662f\u901a\u8fc7LRU\u5217\u8868\u7ba1\u7406\u7684\u3002</p> <pre><code>----------------------\nBUFFER POOL AND MEMORY\n----------------------\nTotal large memory allocated 19789774848\nDictionary memory allocated 3944999\nBuffer pool size   1179504\nFree buffers       8192\nDatabase pages     1116347\nOld database pages 411925\nModified db pages  3\nPending reads      0\nPending writes: LRU 0, flush list 0, single page 0\nPages made young 74514305, not young 649973267\n0.21 youngs/s, 0.17 non-youngs/s\nPages read 15233915, created 7356668, written 264739684\n0.00 reads/s, 0.00 creates/s, 0.10 writes/s\nBuffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000\nPages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s\nLRU len: 1116347, unzip_LRU len: 0\nI/O sum[48]:cur[0], unzip sum[0]:cur[0]\n</code></pre> \u9805\u76ee \u5099\u8003\u6b04 Total large memory allocated \u4e3aInnoDB\u5206\u914d\u7684\u603b\u5185\u5b58\u6570(byte) Dictionary memory allocated \u4e3aInnoDB\u6570\u636e\u5b57\u5178\u5206\u914d\u7684\u5185\u5b58\u6570(byte) Buffer pool size innode_buffer_pool\u7684\u9875\u6570\u91cf Free buffers lru\u5217\u8868\u4e2d\u7684\u7a7a\u95f2\u9875\u6570\u91cf Database pages lru\u5217\u8868\u4e2d\u7684\u975e\u7a7a\u95f2\u9875\u6570\u91cf Old database pages old\u5b50\u5217\u8868\u7684\u9875\u6570\u91cf Modified db pages \u810f\u9875\u7684\u6570\u91cf Pending reads \u6302\u8d77\u8bfb\u7684\u6570\u91cf <p>\u53ef\u4ee5\u770b\u5230\u5f53\u524d<code>Buffer Pool Size</code>\u5171\u6709<code>1179504</code>\u9875\uff0c\u5373<code>1179504*16K</code>\u3002 \u65b0\u8bfb\u53d6\u5230\u7684\u9875\u9ed8\u8ba4\u63d2\u5165LRU\u5217\u8868\u7684<code>5/8</code>\u7684\u4f4d\u7f6e\u3002 \u6b64\u503c\u7531<code>innodb_old_blocks_pct</code>\u63a7\u5236\uff0c\u5373\u524d<code>5/8</code>\u79f0\u4e3a<code>new list</code>\uff0c\u540e\u9762<code>3/</code>8\u7684\u79f0\u4e3a<code>old list</code>\u3002 <code>Pages made young</code> \u663e\u793aLRU\u5217\u8868\u4e2d<code>old list</code>\u79fb\u5230<code>new list</code>\u7684\u6b21\u6570\uff0c<code>not young</code>\u663e\u793a\u4ecd\u5728<code>old list</code>\u7684\u6b21\u6570\u3002 \u8fd9\u4e24\u4e2a\u503c\u53d7<code>innodb_old_blocks_time</code>\u5f71\u54cd\uff0c\u6b64\u503c\u4e3a\u5fae\u79d2\u3002\u5982\u679c<code>old list</code>\u4e2d\u8d85\u8fc730\u5fae\u79d2\u4e0d\u518d\u8bfb\u53d6\uff0c\u5219\u8bb0\u5f55<code>not young</code>\uff0c\u53cd\u4e4b\u8bb0\u5f55\u4e3a<code>Pages made young</code>\u3002</p> <pre><code>&gt;&gt;show global variables like '%blocks%';\n+------------------------+-------+\n| Variable_name          | Value |\n+------------------------+-------+\n| innodb_old_blocks_pct  | 37    |\n| innodb_old_blocks_time | 30    |\n+------------------------+-------+\n</code></pre> <ul> <li>youngs/s,non-youngs/s\uff0c\u8868\u793a\u6bcf\u79d2\u8fd9\u4e24\u7c7b\u64cd\u4f5c\u7684\u6b21\u6570\u3002</li> <li>Pages read,created,written\uff0c\u8868\u793ainnodb\u88ab\u8bfb\u53d6\uff0c\u521b\u5efa\uff0c\u5199\u5165\u4e86\u591a\u5c11\u9875\u53ca\u6bcf\u79d2\u7684\u6b21\u6570\u3002</li> <li>Buffer pool hit rate\uff0c\u8868\u793a\u7f13\u51b2\u6c60\u547d\u4e2d\u7387\uff0c\u5982\u679c\u4f4e\u4e8e95%\u9700\u8981\u5177\u4f53\u6392\u67e5\u3002</li> <li>Pages read ahead\uff0c\u8868\u793a\u9875\u9762\u9884\u8bfb\uff0c\u968f\u673a\u9884\u8bfb\u7684\u6bcf\u79d2\u9875\u6570\u3002</li> <li>LRU\u4e2d\u5305\u542bunzip_LRU\uff0cunzip_LRU\u662f\u7ba1\u7406\u975e16KB\u7684\u538b\u7f29\u8868\u3002</li> </ul>"},{"location":"show-engine-innodb-status/#individual-buffer-pool-info","title":"INDIVIDUAL BUFFER POOL INFO","text":"<p>\u53ef\u901a\u8fc7<code>innodb_buffer_pool_instances</code> \u6765\u914d\u7f6e\u591a\u4e2a\u7f13\u51b2\u6c60\u5b9e\u4f8b\uff0c\u9ed8\u8ba4\u4e3a1\u3002 \u53ef\u51cf\u5c11\u6570\u636e\u5e93\u5185\u90e8\u8d44\u6e90\u7ade\u4e89\uff0c\u589e\u52a0\u5e76\u53d1\u5904\u7406\u80fd\u529b\u3002\u5982\u679c\u5206\u914d\u591a\u4e2a\u7f13\u51b2\u6c60\u5b9e\u4f8b\uff0c\u6bcf\u4e2a\u7f13\u51b2\u6c60\u5927\u5c0f\u4e3a <code>innodb_buffer_pool_size / innodb_buffer_pool_instances</code>\u3002</p> <pre><code>----------------------\nINDIVIDUAL BUFFER POOL INFO\n----------------------\n---BUFFER POOL 0\nBuffer pool size   147438\nFree buffers       1024\nDatabase pages     139530\nOld database pages 51486\nModified db pages  0\nPending reads      0\nPending writes: LRU 0, flush list 0, single page 0\nPages made young 8790743, not young 77467460\n0.00 youngs/s, 0.00 non-youngs/s\nPages read 1856892, created 916430, written 30727167\n0.00 reads/s, 0.00 creates/s, 0.00 writes/s\nNo buffer pool page gets since the last printout\nPages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s\nLRU len: 139530, unzip_LRU len: 0\nI/O sum[6]:cur[0], unzip sum[0]:cur[0]\n---BUFFER POOL 1\n---BUFFER POOL 2\n---BUFFER POOL 3\n</code></pre> <p>\u53ef\u4ee5\u901a\u8fc7<code>information_schema.INNODB_BUFFER_POOL_STATS</code>\u89c6\u56fe\u67e5\u770b\u6bcf\u4e2abuffer_pool\u5b9e\u4f8b\u7684\u4fe1\u606f\uff0c MySQL\u9ed8\u8ba4\u4e00\u4e2apage\u5927\u5c0f\u4e3a16K\uff0c\u53ef\u4ee5\u5f97\u51fa<code>POOL_SIZE * innodb_buffer_pool_instances * 16K = innodb_buffer_pool_size</code>\u3002</p> <pre><code>&gt;&gt;select POOL_ID,POOL_SIZE,FREE_BUFFERS,DATABASE_PAGES,OLD_DATABASE_PAGES,MODIFIED_DATABASE_PAGES,PAGES_MADE_YOUNG,PAGES_NOT_MADE_YOUNG from information_schema.INNODB_BUFFER_POOL_STATS;\n+---------+-----------+--------------+----------------+--------------------+-------------------------+------------------+----------------------+\n| POOL_ID | POOL_SIZE | FREE_BUFFERS | DATABASE_PAGES | OLD_DATABASE_PAGES | MODIFIED_DATABASE_PAGES | PAGES_MADE_YOUNG | PAGES_NOT_MADE_YOUNG |\n+---------+-----------+--------------+----------------+--------------------+-------------------------+------------------+----------------------+\n|       0 |     90112 |            0 |          90109 |              33279 |                       0 |            18064 |            132278807 |\n|       1 |     90112 |            0 |          90109 |              33282 |                       0 |            18342 |            132086061 |\n|       2 |     90112 |            0 |          90110 |              33282 |                       0 |            17631 |            132149779 |\n+---------+-----------+--------------+----------------+--------------------+-------------------------+------------------+----------------------+\n</code></pre> <p>\u8be6\u7ec6\u8bf4\u660e\u540c\u4e0a\u3002</p>"},{"location":"show-engine-innodb-status/#row-operations","title":"ROW OPERATIONS","text":"<p>\u663e\u793a\u4e86row \u64cd\u4f5c\u53ca\u5176\u4ed6\u4e00\u4e9b\u7edf\u8ba1\u4fe1\u606f\u3002</p> <pre><code>--------------\nROW OPERATIONS\n--------------\n0 queries inside InnoDB, 0 queries in queue\n0 read views open inside InnoDB\nProcess ID=444943, Main thread ID=139899621590784, state: sleeping\nNumber of rows inserted 172887566, updated 227534242, deleted 56676133, read 709667077\n8.77 inserts/s, 8.04 updates/s, 0.00 deletes/s, 10.92 reads/s\n</code></pre> <ul> <li>queries\uff0c\u8868\u793ainnodb\u5185\u6838\u4e2d\u6709\u591a\u5c11\u4e2a\u7ebf\u7a0b\uff0c\u961f\u5217\u4e2d\u6709\u591a\u5c11\u4e2a\u7ebf\u7a0b\u3002</li> <li>read views open inside InnoDB\uff0c\u8868\u793a\u6709\u591a\u5c11\u4e2aread view \u88ab\u6253\u5f00\uff0c\u4e00\u4e2aread view \u5305\u542b\u4e8b\u7269\u5f00\u59cb\u70b9\u6570\u636e\u5e93\u5185\u5bb9\u7684MVCC\u5feb\u7167\u3002</li> <li>Process ID=444943\uff0c\u8868\u793a\u5185\u6838\u7684\u4e3b\u7ebf\u7a0b\u72b6\u6001\u3002</li> <li>Number of rows inserted\u3001updated\u3001deleted\u3001read\uff0c\u8868\u793a\u591a\u5c11\u884c\u88ab\u63d2\u5165\uff0c\u66f4\u65b0\u548c\u5220\u9664\uff0c\u8bfb\u53d6\u53ca\u6bcf\u79d2\u4fe1\u606f\uff0c\u53ef\u7528\u4e8e\u76d1\u63a7\u3002</li> </ul> <p>\u53ef\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\uff1a</p> <pre><code>(root@localhost) [(none)] &gt;show global status like 'Innodb_rows_%';\n+----------------------+-----------+\n| Variable_name        | Value     |\n+----------------------+-----------+\n| Innodb_rows_deleted  | 56676133  |\n| Innodb_rows_inserted | 172887566 |\n| Innodb_rows_read     | 709667077 |\n| Innodb_rows_updated  | 227534242 |\n+----------------------+-----------+\n(root@localhost) [(none)] &gt;show global status like 'Uptime';\n+---------------+---------+\n| Variable_name | Value   |\n+---------------+---------+\n| Uptime        | 1757270 |\n+---------------+---------+\n</code></pre>"},{"location":"show-engine-innodb-status/#end-of-innodb-monitor-output","title":"END OF INNODB MONITOR OUTPUT","text":"<p>InnoDB\u4fe1\u606f\u7ed3\u675f\u8bed\u3002</p> <pre><code>----------------------------\nEND OF INNODB MONITOR OUTPUT\n============================\n\u5982\u679c\u770b\u4e0d\u5230\u8fd9\u884c\u8f93\u51fa\uff0c\u53ef\u80fd\u662f\u6709\u5927\u91cf\u4e8b\u52a1\u6216\u8005\u6709\u4e00\u4e2a\u5927\u7684\u6b7b\u9501\u622a\u65ad\u4e86\u8f93\u51fa\u4fe1\u606f\u3002\n</code></pre>"},{"location":"swap-find/","title":"Swap\u3092\u4f7f\u3063\u3066\u308b\u30d7\u30ed\u30bb\u30b9\u3092\u63a2\u3059","text":"<ul> <li>Linux \u4e0bswap\u5de5\u4f5c\u539f\u7406</li> <li>https://qiita.com/rmanzoku/items/be8c4f403ec6b37a7beb</li> <li>https://qiita.com/white_aspara25/items/cfc835006ae356189df3</li> <li>https://stackoverflow.com/questions/131303/how-to-measure-actual-memory-usage-of-an-application-or-process</li> </ul> <p>\u30e1\u30e2\u30ea\u3092\u98df\u3044\u3064\u3076\u3057\u3066\u305f\u30d7\u30ed\u30bb\u30b9\u304c\u3044\u305f\u306e\u3067\u305d\u308c\u3092\u8abf\u3079\u308b\u3068\u304d\u306b\u5229\u7528\u3057\u305f\u30b3\u30de\u30f3\u30c9\u3002</p> <p>\u3053\u308c\u3067\u30ba\u30e9\u3063\u3068\u3067\u307e\u3059\u3002</p> Info <pre><code>$ ps alx  | awk '{printf (\"%d\\t%s\\n\", $8,$13)}'\n</code></pre> <p>\u3057\u304b\u3057\u3001\u3053\u306e\u30b3\u30de\u30f3\u30c9\u306e\u7d50\u679c\u304c\u898b\u3065\u3089\u3044\u3002\u306a\u306e\u3067\u4f7f\u7528\u91cf\u306e\u591a\u3044\u9806\u306b\u30bd\u30fc\u30c8\u3057\u3066\u30c8\u30c3\u30d710\u3092\u51fa\u3057\u3066\u307f\u308b\u3068\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30b3\u30de\u30f3\u30c9\u306b\u306a\u308a\u307e\u3059\u3002</p> Info <pre><code>$ ps alx  | awk '{printf (\"%d\\t%s\\n\", $8,$13)}' | sort -nr | head -10\n</code></pre>"},{"location":"swap-find/#_1","title":"\u30e1\u30e2\u30ea\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2","text":"<ul> <li>https://futuremix.org/2009/09/clear-linux-memory-cach</li> <li>https://www.softel.co.jp/blogs/tech/archives/3244</li> </ul> Info <pre><code># echo 1 &gt; /proc/sys/vm/drop_caches\n</code></pre> <p>proc/sys/vm/drop_caches \u306b1\uff5e3\u306e\u5024\u3092\u66f8\u304d\u8fbc\u3080\u3002</p> <p>\u5024\u306b\u3088\u3063\u3066\u89e3\u653e\u3055\u308c\u308b\u30e1\u30e2\u30ea\u304c\u7570\u306a\u308b\u3002</p> \u5024 \u5bfe\u8c61 1 \u30da\u30fc\u30b8\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u89e3\u653e\u3059\u308b 2 dentry\u3001inode \u3092\u89e3\u653e\u3059\u308b 3 \u30da\u30fc\u30b8\u30ad\u30e3\u30c3\u30b7\u30e5\u3001dentry\u3001inode \u3092\u89e3\u653e\u3059\u308b <ul> <li>\u3053\u306e\u64cd\u4f5c\u306f\u975e\u7834\u58ca\u7684\u306a\u64cd\u4f5c\u3067\u3001\u30c0\u30fc\u30c6\u30a3\u306a (dirty) \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f \u89e3\u653e\u3055\u308c\u306a\u3044\u306e\u3067\u3001\u3053\u306e\u64cd\u4f5c\u3092\u884c\u3046\u969b\u306f\u6700\u521d\u306b sync(8) \u3092\u5b9f\u884c\u3057\u3066\u304a\u304f\u3079\u304d\u3067\u3042\u308b\u3002</li> <li>\uff08dentry\u3068\u306f\u3001\u30d5\u30a1\u30a4\u30eb\u540d\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u968e\u5c64\u69cb\u9020\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u7ba1\u7406\u306a\u3069\u3092\u304a\u3053\u306a\u3063\u3066\u3044\u308b\u30c7\u30fc\u30bf\u3002\uff09</li> <li>cached\u3084buffers\u306fLinux\u304c\u52b9\u7387\u7684\u306b\u52d5\u4f5c\u3059\u308b\u305f\u3081\u306b\u7a7a\u3044\u3066\u3044\u308b\u9818\u57df\u3092\u4f7f\u3063\u3066\u3044\u308b\u3060\u3051\u3067\u3001\u901a\u5e38\u306f\u7a7a\u304d\u30e1\u30e2\u30ea\u3068\u8003\u3048\u3066\u3088\u3044\u3002</li> </ul> \u540d\u79f0 \u610f\u5473 VSZ (virtual set size) \u4eee\u60f3\u30e1\u30e2\u30ea RSS (Resident set size) \u7269\u7406\u30e1\u30e2\u30ea\u306e\u6d88\u8cbb\u91cf PSS (proportional set size) \u30d7\u30ed\u30bb\u30b9\u304c\u5b9f\u8cea\u7684\u306b\u6240\u6709\u3057\u3066\u3044\u308b\u30e1\u30e2\u30ea USS (unique set size) \u3072\u3068\u3064\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u5360\u6709\u3057\u3066\u3044\u308b\u30e1\u30e2\u30ea"},{"location":"swap-find/#swap_1","title":"Swap\u3092\u4f7f\u3063\u3066\u3044\u308b\u30d7\u30ed\u30bb\u30b9\u3068\u4f7f\u7528\u91cf\u3092\u4f7f\u3063\u3066\u308b\u9806\u306b\u8868\u793a","text":"Info <pre><code>$ grep VmSwap /proc/*/status | sort -k 2 -nr\n$ for file in /proc/*/status ; do awk '/VmSwap|Name|^Pid/{printf $2 \" \" $3}END{ print \"\"}' $file; done | sort -k 3 -n -r | head\n</code></pre>"},{"location":"swap-find/#swapps","title":"Swap\u3092\u4f7f\u3063\u3066\u3044\u308b\u30d7\u30ed\u30bb\u30b9\u3092ps\u3067\u8abf\u3079\u308b\u30ef\u30f3\u30e9\u30a4\u30ca\u30fc","text":"Info <pre><code>$ grep VmSwap /proc/*/status | sort -k 2 -nr | cut -d\"/\" -f3 | grep -e '^[0-9]*$' | xargs -I{} ps u -p{} --no-headers\n$ grep VmSwap /proc/*/status | sort -k 2 -nr |head -2| cut -d\"/\" -f3 | grep -e '^[0-9]*$' | xargs -I{} ps u -p{} --no-headers\n</code></pre> <p>\u73fe\u5b9f\u7684\u306b\u306f\u4e0a\u306e\u5e7e\u3064\u304b\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u518d\u8d77\u52d5\u306a\u308a\u3057\u3066\u3042\u3052\u308b\u3068Swap\u304c\u958b\u653e\u3055\u308c\u308b\u3067\u3057\u3087\u3046\u3002</p>"},{"location":"swap-find/#top","title":"top\u30b3\u30de\u30f3\u30c9\u306e\u4f7f\u3044\u65b9","text":"<ul> <li>https://qiita.com/k0kubun/items/7368c323d90f24a00c2f</li> </ul> PR NI VIRT RES SHR S %CPU %MEM TIME+ \u512a\u5148\u5ea6 \u76f8\u5bfe\u512a\u5148\u5ea6 \u4eee\u60f3\u30e1\u30e2\u30ea \u7269\u7406\u30e1\u30e2\u30ea \u5171\u6709\u30e1\u30e2\u30ea \u72b6\u614b CPU\u4f7f\u7528\u7387 \u30e1\u30e2\u30ea\u4f7f\u7528\u7387 \u5b9f\u884c\u6642\u9593 <ul> <li>NI: Nice value\u3002\u76f8\u5bfe\u512a\u5148\u5ea6\u30020\u304c\u57fa\u6e96\u3067\u3001\u8ca0\u3060\u3068\u512a\u5148\u5ea6\u304c\u9ad8\u304f\u3001\u6b63\u3060\u3068\u512a\u5148\u5ea6\u304c\u4f4e\u3044\u3002</li> <li>VIRT: Virtual Image\u3002\u78ba\u4fdd\u3055\u308c\u305f\u4eee\u60f3\u30e1\u30e2\u30ea\u5168\u3066\u3002\u30b9\u30ef\u30c3\u30d7\u3057\u305f\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u3092\u542b\u3080\u3002</li> <li>RES: Resident size\u3002 \u30b9\u30ef\u30c3\u30d7\u3057\u3066\u3044\u306a\u3044\u3001\u4f7f\u7528\u3057\u305f\u7269\u7406\u30e1\u30e2\u30ea\u306e\u30b5\u30a4\u30ba\u3002</li> <li>SHR: Shared Mem size\u3002 \u4ed6\u306e\u30d7\u30ed\u30bb\u30b9\u3068\u5171\u6709\u3055\u308c\u308b\u53ef\u80fd\u6027\u306e\u3042\u308b\u30e1\u30e2\u30ea\u306e\u30b5\u30a4\u30ba\u3002</li> <li>S: Process Status\u3002 \u4ee5\u4e0b\u306e\u3044\u305a\u308c\u306e\u72b6\u614b\u3067\u3042\u308b\u304b\u3092\u793a\u3057\u3066\u3044\u308b\u3002<ul> <li>D: \u5272\u308a\u8fbc\u307f\u4e0d\u80fd</li> <li>R: \u5b9f\u884c\u4e2d</li> <li>S: \u30b9\u30ea\u30fc\u30d7\u72b6\u614b</li> <li>T: \u505c\u6b62\u4e2d</li> <li>Z: \u30be\u30f3\u30d3\u30d7\u30ed\u30bb\u30b9</li> </ul> </li> </ul>"},{"location":"swap-find/#1-ps","title":"\u65b9\u6cd51. ps","text":"<p>\u57fa\u672c\u4e2d\u306e\u57fa\u672c\u3002\u30d7\u30ed\u30bb\u30b9\u3092\u8abf\u3079\u308b\u30b3\u30de\u30f3\u30c9\u5185\u306b\u30e1\u30e2\u30ea\u6d88\u8cbb\u91cf\u304c\u8868\u793a\u3055\u308c\u3066\u307e\u3059\u3002</p> Info <pre><code># ps aux | grep unicor[n]\nUSER  PID %CPU %MEM VSZ    RSS    TTY STAT START  TIME  COMMAND\nuser  1111 0.0 10.4 479180 177440   ?  Sl  Aug16  0:38  unicorn worker[0] -D -E production -c /RAILS_ROOT/config/unicorn.rb\nuser  2222 0.0 10.5 547060 178604   ?  Sl  Aug16  0:39  unicorn worker[1] -D -E production -c /RAILS_ROOT/config/unicorn.rb\nuser  3333 0.0 10.5 479180 178764   ?  Sl  Aug16  0:26  unicorn worker[2] -D -E production -c /RAILS_ROOT/config/unicorn.rbe\nuser  4444 0.0 10.3 479324 175128   ?  Sl  Aug16  0:19  unicorn worker[3] -D -E production -c /RAILS_ROOT/config/unicorn.rb\nuser  5555 0.0 10.7 552648 182308   ?  Sl  Aug16  0:50  unicorn worker[4] -D -E production -c /RAILS_ROOT/config/unicorn.rb\nuser  6666 0.0 9.3 402900  158168   ?  Sl  Aug16  0:16  unicorn master -D -E production -c /RAILS_ROOT/config/unicorn.rb\n</code></pre> <p>%MEM\u306e\u884c\u306b\u30e1\u30e2\u30ea\u306e\u6d88\u8cbb\u91cf(\uff05)\u3001RSS\u306e\u884c\u306b\u5b9f\u969b\u306eRSS\u5024(kB)\u304c\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002 \u3053\u306e\u4f8b\u3060\u3068\u3001\u5404 unicorn \u306e worker \u304c 180MB \u7a0b\u4f7f\u3063\u3066\u308b\u4e8b\u304c\u308f\u304b\u308a\u307e\u3059\u3002 RSS\u5024\u3092\u8db3\u3057\u4e0a\u3052\u308c\u3070\u3001\u30c8\u30fc\u30bf\u30eb\u306e\u6d88\u8cbb\u91cf\u304c\u8a08\u7b97\u3067\u304d\u307e\u3059\u3002</p> <p><pre><code># ps aux | grep unicor[n] | awk '{sum += $6}END{print sum}'\n=&gt; 1050436\n</code></pre> 1.05GB.. \u7d50\u69cb\u4f7f\u3063\u3066\u308b\u3002\u3002</p>"},{"location":"swap-find/#2-pmap-x-pid","title":"\u65b9\u6cd52. pmap -x [PID]","text":"<p>pmap \u306f\u30d7\u30ed\u30bb\u30b9\u306e\u30a2\u30c9\u30ec\u30b9\u7a7a\u9593\u30de\u30c3\u30d4\u30f3\u30b0\u60c5\u5831\u3092\u95b2\u89a7\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3067\u3059\u304c\u3001-x \u3092\u3064\u3051\u308b\u4e8b\u3067\u30e1\u30e2\u30ea\u5272\u308a\u5f53\u3066\u306e\u91cf\u3082\u8868\u793a\u3067\u304d\u307e\u3059\u3002</p> Info <pre><code># pmap -x 1111\nAddress           Kbytes     RSS   Dirty Mode   Mapping\n0000000000400000       0       4       0 r-x--  ruby\n0000000000600000       0       4       4 r----  ruby\n...\uff08\u4e2d\u7565\uff09...\nffffffffff600000       0       0       0 r-x--    [ anon ]\n----------------  ------  ------  ------\ntotal kB          479180  177448  172868\n</code></pre> <p>\u6700\u7d42\u884c\u306b\u3001RSS\u5024\u306e\u5408\u8a08\u304c\u8868\u793a\u3055\u308c\u307e\u3059(kB)\u3002</p> <pre><code>$ cat /tmp/unicorn.pid | xargs pmap -x | tail -n1 | tr -s ' ' | cut -d ' ' -f 4 =&gt; 177448\n</code></pre>"},{"location":"swap-find/#3-cat-procpidsmaps","title":"\u65b9\u6cd53. cat /proc/[PID]/smaps","text":"<p>\u3053\u3061\u3089\u3082PID\u304c\u308f\u304b\u308c\u3070\u3001RSS\u5024\u3068PSS\u5024\u304c\u308f\u304b\u308a\u307e\u3059\u3002</p> <p><code>/proc/[PID]/smaps</code> \u3067\u306f\u4eee\u60f3\u30e1\u30e2\u30ea\u7a7a\u9593\u306e\u5404\u30a2\u30c9\u30ec\u30b9\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3055\u308c\u305f\u9818\u57df\u306e\u72b6\u614b\u3092\u4e00\u89a7\u3067\u53c2\u7167\u3067\u304d\u307e\u3059\u3002</p> <pre><code># cat /proc/1111/smaps | less\n00400000-00401000 r-xp 00000000 ca:01 35818  /RUBY_PATH/bin/ruby\nSize:                  4 kB\nRss:                   4 kB\nPss:                   0 kB\nShared_Clean:          4 kB\nShared_Dirty:          0 kB\nPrivate_Clean:         0 kB\nPrivate_Dirty:         0 kB\nReferenced:            4 kB\nAnonymous:             0 kB\nAnonHugePages:         0 kB\nSwap:                  0 kB\nKernelPageSize:        4 kB\nMMUPageSize:           4 kB\nLocked:                0 kB\n00600000-00601000 r--p 00000000 ca:01 35818  /RUBY_PATH/bin/ruby\nSize:                  4 kB\nRss:                   4 kB\nPss:                   0 kB\nShared_Clean:          0 kB\n...\uff08\u5f8c\u7565\uff09...\n</code></pre> <p>\u3053\u3061\u3089\u306eRss\u3092\u8db3\u3057\u4e0a\u3052\u308c\u3070\u3001\u5b9f\u969b\u306e\u5024\u3002</p> <pre><code>Rss\n# cat /proc/1111/smaps | awk '/^Rss/{sum += $2}END{print sum}'\n=&gt; 177448(kB)\nPss\n# cat /proc/1111/smaps | awk '/^Pss/{sum += $2}END{print sum}'\n=&gt; 107824(kB)\nunicorn \u306eRss\u5024\u5408\u8a08\n# ps aux | grep unicor[n] | awk '{print $2}' | xargs -i% cat /proc/%/smaps | awk '/^Rss/{sum += $2}END{print sum}'\n</code></pre>"},{"location":"swap-linux/","title":"Linux\u5185\u5b58\u56de\u6536\u4e0eswap","text":"<ul> <li>https://blog.csdn.net/ketaobaobao/article/details/99983405</li> </ul>"},{"location":"swap-schema/","title":"Linux\u5185\u5b58\u56de\u6536--Swap\u673a\u5236","text":"<ul> <li>https://blog.csdn.net/Mr_SCX/article/details/103271451</li> </ul>"},{"location":"taged-VLAN%E3%81%A8untagedVLAN%E3%81%AE%E9%81%95%E3%81%84/","title":"\u30bf\u30b0VLAN \u3068\u306f","text":"<p>\u30bf\u30b0VLAN (Tag VLAN) \u3068\u306f\u3001\u8907\u6570\u306eVLAN\u30921\u672c\u306eLAN\u63a5\u7d9a\u3060\u3051\u3067\u8907\u6570\u30b9\u30a4\u30c3\u30c1\u9593\u3067\u5171\u6709\u3067\u304d\u308b\u6280\u8853\u3067\u3059\u3002</p> <p><code>IEEE802.1q</code> \u3068\u3044\u3046\u898f\u683c\u3067\u898f\u5b9a\u3055\u308c\u3066\u304a\u308a\u3001VLAN ID \u306f <code>1\uff5e4094</code> \u304c\u4f7f\u3048\u307e\u3059\u3002</p> <p>\u5177\u4f53\u7684\u306a\u4f8b\u3068\u3057\u3066\u3001\u30b9\u30a4\u30c3\u30c1\u540c\u58eb\u3092\u63a5\u7d9a\u3059\u308b\u30dd\u30fc\u30c8\u306b <code>trunk port</code> (\u30c8\u30e9\u30f3\u30af\u30dd\u30fc\u30c8\u3002 <code>tag port</code> \u3068\u547c\u3070\u308c\u305f\u308a\u3057\u307e\u3059) \u306e\u8a2d\u5b9a\u3092\u5165\u308c\u3066\u63a5\u7d9a\u3057\u307e\u3059\u3002</p> <p>\u3059\u308b\u3068\u305d\u306e\u30ea\u30f3\u30af(\u30c8\u30e9\u30f3\u30af\u30ea\u30f3\u30af)\u306f VLAN ID \u60c5\u5831\u3092\u542b\u3080 Tag \u3092\u4ed8\u3051\u3066\u901a\u4fe1\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002</p> <p></p> <p>\u4f8b\u3067\u306f VLAN \u304c 3 \u3064\u3060\u3051\u3067\u3059\u306e\u3067\u3001\u5404VLAN 1\u672c\u305a\u3064\u3001 \u7cfb3\u672c\u306e\u30b1\u30fc\u30d6\u30eb\u3092\u30b9\u30a4\u30c3\u30c1\u9593\u3067\u63a5\u7d9a\u3059\u308b\u69cb\u6210\u3082\u53ef\u80fd\u3067\u3059\u304c\u3053\u308c\u306f\u975e\u52b9\u7387\u3067\u3059\u3002 \u4f8b\u3048\u3070\u3053\u308c\u304c\u3001VLAN \u304c20\u500b\u3042\u3063\u305f\u3068\u3057\u305f\u3089\u305d\u308c\u3060\u3051\u3067\u30b1\u30fc\u30d6\u30eb\u3068\u30dd\u30fc\u30c8\u309220\u30dd\u30fc\u30c8\u3082\u6d88\u8cbb\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002</p> <p>\u3053\u306e\u3088\u3046\u306a\u30b1\u30fc\u30b9\u3067\u3082\u3001\u30bf\u30b0 VLAN \u3092\u4f7f\u3048\u3070 1 \u30dd\u30fc\u30c8\u3060\u3051\u3067 20 \u500b\u306e VLAN \u3092\u5171\u6709\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"taged-VLAN%E3%81%A8untagedVLAN%E3%81%AE%E9%81%95%E3%81%84/#native-vlan-pvid","title":"Native VLAN (PVID) \u3068\u306f","text":"<p>Native VLAN \u3068\u306f\u3001\u30c8\u30e9\u30f3\u30af\u30dd\u30fc\u30c8\u306e\u4e2d\u3067\u3001\u30bf\u30b0\u3092\u4ed8\u3051\u306a\u3044 VLAN ID \u306e\u3053\u3068\u3092\u6307\u3057\u307e\u3059\u3002 <code>\u30c7\u30d5\u30a9\u30eb\u30c8VLAN</code> \u3084 <code>PVID (Port VLAN ID)</code> \u3082\u540c\u3058\u610f\u5473\u3067\u3059\u3002</p> <p>\u3053\u306e Native VLAN \u3082 IEEE802.1q \u306e\u898f\u683c\u3067\u6c7a\u307e\u3063\u3066\u304a\u308a\u3001 \u5404\u30c8\u30e9\u30f3\u30af\u30dd\u30fc\u30c8\u30671\u3064\u3060\u3051\u3001\u3053\u306e Native VLAN \u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059 \uff08\u6a5f\u5668\u5358\u4f4d\u3067\u306f\u306a\u304f\u30dd\u30fc\u30c8\u5358\u4f4d\u3067\u6307\u5b9a\u3067\u304d\u308b\u3082\u306e\u304c\u591a\u3044\u3067\u3059\uff09\u3002  </p> <p>\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u5168\u30dd\u30fc\u30c8 <code>VLAN ID=1</code> \u304c <code>Native VLAN</code> \u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"taged-VLAN%E3%81%A8untagedVLAN%E3%81%AE%E9%81%95%E3%81%84/#native-vlan","title":"Native VLAN \u306e\u4e0d\u4e00\u81f4","text":"<p>\u4e0a\u56f3\u5de6\u5074\u306e\u4f8b\u306b\u793a\u3057\u305f\u901a\u308a\u3001Native VLAN \u306f\u30c8\u30e9\u30f3\u30af\u30ea\u30f3\u30af\u306e\u4e21\u7aef\u3067\u63c3\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059 \uff08\u30b9\u30a4\u30c3\u30c1\u306e\u5168\u30c8\u30e9\u30f3\u30af\u30dd\u30fc\u30c8\u3067\u305d\u308d\u3048\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\uff09\u3002</p> <p>\u3082\u3057\u63c3\u3048\u306a\u3044\u3068\u3001\u4f8b\u306e\u53f3\u5074\u306e\u300c\u60aa\u3044\u4f8b\u300d\u306e\u3088\u3046\u306b\u3001VLAN 1 \u306e\u901a\u4fe1\u304c VLAN 2 \u306b\u6df7\u5165\u3057\u305f\u308a\u3068\u3001 \u8ad6\u7406\u69cb\u6210\u306b\u637b\u3058\u308c\u304c\u767a\u751f\u3057\u305f\u308a\u3057\u307e\u3059\u3002</p> <p>Native VLAN \u306e\u4e0d\u4e00\u81f4\u306f\u3001\u7279\u306b PVSTP\u3067\u306f\u30eb\u30fc\u30d7\u306e\u691c\u77e5\u304c\u51fa\u6765\u306a\u304f\u306a\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u305f\u3081\u3001 \u30a8\u30e9\u30fc\u306b\u3082\u51fa\u529b\u3055\u308c\u307e\u3059\u3002</p> <p>\u306a\u304a\u3001<code>CDP (Cisco Discovery Protocol)</code> \u306b\u306f Native VLAN \u60c5\u5831\u3082\u4e57\u3063\u3066\u304a\u308a\u3001\u4e0d\u4e00\u81f4\u304c\u3042\u308b\u3068 <code>\"%CDP-4-NATIVE_VLAN_MISMATCH: Native VLAN mismatch discovered on \"</code> \u3068\u3044\u3063\u305f\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"taged-VLAN%E3%81%A8untagedVLAN%E3%81%AE%E9%81%95%E3%81%84/#vlan_1","title":"\u3069\u3046\u3044\u3046\u6642\u306b\u30cd\u30a4\u30c6\u30a3\u30d6VLAN\u3092\u5909\u66f4\u3059\u308b\uff1f","text":"<p>\u5909\u66f4\u3059\u308b\u7406\u7531\u306f\u57fa\u672c\u7684\u306b\u306f\u7121\u3044\u306f\u305a\u3067\u3059\u304c\u3001\u30b1\u30fc\u30b9\u3068\u3057\u30662\u3064\u4f8b\u3092\u6319\u3052\u307e\u3059\u3002</p> <ul> <li>1\u3064\u76ee\u306f\u3001\u4f8b\u3048\u3070\u30cd\u30a4\u30c6\u30a3\u30d6 VLAN \u3092 10 \u306b\u3059\u308b\u3068\u3001 \u305d\u306e\u30dd\u30fc\u30c8\u306b PC \u3084 VLAN \u975e\u5bfe\u5fdc\u306e\u30b9\u30a4\u30c3\u30c1\u30f3\u30b0\u30cf\u30d6\u3092\u63a5\u7d9a\u3059\u308b\u3068\u3001 VLAN 10 \u3067\u901a\u4fe1\u3067\u304d\u307e\u3059\u3002\u3053\u306e\u3042\u305f\u308a\u306f\u4e0b\u8a18\u8a18\u4e8b\u306b\u3082\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\u3002</li> </ul> <p>\u30c8\u30e9\u30f3\u30af\u30dd\u30fc\u30c8\u3068\u30a2\u30af\u30bb\u30b9\u30dd\u30fc\u30c8\u306e\u9055\u3044\u3001trunk port \u306b access port \u3084 PC \u3092\u63a5\u7d9a\u3059\u308b\u3068\u3069\u3046\u306a\u308b\u304b</p> <ul> <li>2\u3064\u76ee\u306f\u30011\u3064\u76ee\u306b\u95a2\u9023\u3059\u308b\u306e\u3067\u3059\u304c\u3001\u30c7\u30d5\u30a9\u30eb\u30c8 VLAN \u3067\u3042\u308b VLAN 1 \u306f\u3001 telnet \u63a5\u7d9a\u7528\u7b49\u306e\u7ba1\u7406\u7528\u3068\u3057\u3066\u4f7f\u308f\u308c\u308b\u3053\u3068\u3082\u591a\u3044\u3067\u3059\u3002 \u30c8\u30e9\u30f3\u30af\u30dd\u30fc\u30c8\u3092\u4e00\u822c\u30e6\u30fc\u30b6\u304c\u7269\u7406\u7684\u306b\u3044\u3058\u308c\u308b\u4f4d\u7f6e\u306b\u3042\u308b\u3068\u3001 \u305d\u306e\u30dd\u30fc\u30c8\u3092\u5f15\u3063\u3053\u629c\u3044\u3066 PC \u306b\u63a5\u7d9a\u3059\u308b\u3068 VLAN 1 \u3078\u30a2\u30af\u30bb\u30b9\u3067\u304d\u3066\u3057\u307e\u3044\u307e\u3059\u3002</li> </ul> <p>\u305d\u306e\u3088\u3046\u306a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u7406\u7531\u3067\u3001\u9069\u5f53\u306a VLAN \u306b\u5909\u66f4\u3059\u308b\u30b1\u30fc\u30b9\u304c\u8003\u3048\u3089\u308c\u307e\u3059\u3002</p>"},{"location":"taged-VLAN%E3%81%A8untagedVLAN%E3%81%AE%E9%81%95%E3%81%84/#accesstrunktagged-untagged","title":"access\u30dd\u30fc\u30c8\u3001trunk\u30dd\u30fc\u30c8\u3068tagged, untagged\u306b\u3064\u3044\u3066","text":"<p>\u30e1\u30fc\u30ab\u306b\u3088\u3063\u3066\u306f\u3001<code>access \u30dd\u30fc\u30c8</code>\u3001<code>trunk \u30dd\u30fc\u30c8</code>\u3068\u3044\u3046\u62ec\u308a\u304c\u306a\u304f\u3001 \u5358\u7d14\u306b\u30dd\u30fc\u30c8\u5358\u4f4d\u3067 <code>tagged</code>\u3001<code>untagged</code> \u306eVLAN ID \u3092\u6307\u5b9a\u3059\u308b\u30b9\u30a4\u30c3\u30c1\u3082\u3042\u308a\u307e\u3059\u3002</p> <p>\u4f8b\u3048\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5bfe\u5fdc\u306b\u306a\u308a\u307e\u3059\u3002</p> access, trunk tagged, untagged access vlan=10 untagged=10 trunk vlan=10,20 tagged=10,20 trunk vlan=20(native vlan), 30,40 untagged=20, tagged=30,40 <p>\u5404\u30dd\u30fc\u30c8\u3067 untagged \u306e VLAN \u306f 0\uff5e1\u500b\u3001tagged \u306e VLAN \u306f0\u500b\u4ee5\u4e0a\u3067\u3059\u3002</p> <p>\u4e21\u65b9\u3068\u3082 0 \u500b\u306b\u306a\u308b\u3053\u3068\u306f\u306a\u304f\u3001untagged \u304c 1 \u500b\u3060\u3051\u306a\u3089\u305d\u306e\u30dd\u30fc\u30c8\u306f\u30a2\u30af\u30bb\u30b9\u30dd\u30fc\u30c8\u3001 \u305d\u3053\u306b tagged \u30821\u500b\u4ee5\u4e0a\u4e57\u308b\u306a\u3089\u305d\u308c\u306f\u30c8\u30e9\u30f3\u30af\u30dd\u30fc\u30c8(untagged \u306f native VLAN)\u306b\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"taged-VLAN%E3%81%A8untagedVLAN%E3%81%AE%E9%81%95%E3%81%84/#native-vlan_1","title":"Native VLAN \u3092\u30bf\u30b0\u4ed8\u304d\u3067\u53d7\u4fe1\u3057\u305f\u5834\u5408\u306e\u6319\u52d5","text":"<p>Native VLAN \u3084 untagged \u306b\u6307\u5b9a\u3057\u305fVLAN \u3092\u3001\u30bf\u30b0\u4ed8\u304d\u3067\u53d7\u4fe1\u3057\u305f\u5834\u5408\u306e\u6319\u52d5\u306f\u3001\u30e1\u30fc\u30ab\u306b\u3088\u3063\u3066\u7570\u306a\u308a\u307e\u3059\u3002</p> <p>\u4f8b\u3048\u3070\u3001Native VLAN=10 \u306b\u8a2d\u5b9a\u3057\u305f\u30dd\u30fc\u30c8\u3067\u3001\u30bf\u30b0\u4ed8\u304d\u306e VLAN 10 \u3092\u53d7\u4fe1\u3057\u305f\u5834\u5408\u3001 \u901a\u5e38\u306e VLAN=10 \u3068\u3057\u3066\u8a31\u53ef\u3059\u308b\u5834\u5408\u3082\u3042\u308a\u307e\u3059\u3057\u3001\u7834\u68c4\u3055\u308c\u3066\u3057\u307e\u3046\u5834\u5408\u3082\u3042\u308a\u307e\u3059\u306e\u3067\u3001 \u3082\u3057\u305d\u306e\u3088\u3046\u306a\u69cb\u6210\u3092\u3059\u308b\u5834\u5408\u306f\u4e8b\u524d\u306b\u78ba\u8a8d\u304c\u5fc5\u8981\u3067\u3059\u3002</p>"},{"location":"taged-VLAN%E3%81%A8untagedVLAN%E3%81%AE%E9%81%95%E3%81%84/#voice-vlan","title":"voice vlan \u3067\u30bf\u30b0\u3092\u4ed8\u3051\u308b\u7406\u7531","text":"<p><code>voice vlan</code> \u306f\u30bf\u30b0\u3092\u4ed8\u3051\u308b\u306e\u304c <code>cisco</code> \u306e\u63a8\u5968\u3067\u3059\u3002 2 byte \u3068\u306f\u3044\u3048\u3001\u901f\u5ea6\u306b\u30b7\u30d3\u30a2\u306a\u97f3\u58f0\u30d1\u30b1\u30c3\u30c8\u306b\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u3068\u3082\u306a\u308b\u30bf\u30b0\u3092\u4ed8\u3051\u308b\u306e\u306f\u4f55\u6545\u3067\u3057\u3087\u3046\u304b\uff1f</p> <p>\u3053\u308c\u306f\u3001<code>tag vlan</code> \u306b\u306f <code>IEEE802.1p</code> \u3068\u3044\u3046 <code>QoS</code> \u3067\u5229\u7528\u3067\u304d\u308b\u30d5\u30a3\u30fc\u30eb\u30c9 (\u901a\u79f0 cos) \u304c\u3042\u308b\u304b\u3089\u3067\u3059\u3002 \u97f3\u58f0\u30d1\u30b1\u30c3\u30c8\u306f\u3053\u306e <code>cos</code> \u5024\u3092 <code>5</code> \u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001\u30b9\u30a4\u30c3\u30c1\u306b\u300e\u3053\u306e\u30d1\u30b1\u30c3\u30c8\u306f\u512a\u5148\u3067\u901a\u904e\u3055\u305b\u3066\u306d\u300f\u3068\u4f1d\u3048\u308b\u306e\u3067\u3059\u3002</p> <p>\u306a\u304a\u3001\u5358\u306b <code>cos</code> \u5024\u3092 <code>5</code> \u306b\u30bb\u30c3\u30c8\u3059\u308b\u3060\u3051\u3067\u306f <code>QoS</code> \u306f\u52d5\u4f5c\u3057\u307e\u305b\u3093\u3002 \u7d4c\u7531\u3059\u308b\u5404\u30b9\u30a4\u30c3\u30c1\u3067\u300ecos \u5024 = 5 \u306e\u30d1\u30b1\u30c3\u30c8\u3092\u512a\u5148\u3067\u51fa\u529b\u3059\u308b\u300f\u3068\u3044\u3046\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u3002</p>"},{"location":"terminal-shortcut/","title":"\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u4f7f\u3046\u305f\u3081\u306e\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u96c6","text":"<ul> <li>https://qiita.com/akito/items/d09a2d5b36d4cf7bac6d</li> </ul>"},{"location":"terminal-shortcut/#_2","title":"\u30ab\u30fc\u30bd\u30eb\u306e\u79fb\u52d5","text":"\u30b3\u30de\u30f3\u30c9 \u610f\u5473 Ctrl + b \u5f8c\u9000 Ctrl + f \u524d\u9032 Ctrl + a \u884c\u982d\u3078\u79fb\u52d5 Ctrl + e \u884c\u672b\u3078\u79fb\u52d5 Esc + b \u4e00\u8a9e\u5f8c\u9000 Esc + f \u4e00\u8a9e\u524d\u9032 <p>\u77e2\u5370\u30ad\u30fc\u3067\u3082\u3067\u304d\u307e\u3059\u304c\u3001\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u305f\u65b9\u304c\u30db\u30fc\u30e0\u30dd\u30b8\u30b7\u30e7\u30f3\u3092\u305a\u3089\u3055\u305a\u306b\u64cd\u4f5c\u3067\u304d\u308b\u306e\u3067\u30aa\u30b9\u30b9\u30e1\u3067\u3059\u3002</p>"},{"location":"terminal-shortcut/#_3","title":"\u524a\u9664","text":"\u30b3\u30de\u30f3\u30c9 \u610f\u5473 Ctrl + h (BackSpace) \u30ab\u30fc\u30bd\u30eb\u306e\u5f8c\u65b9\u30921\u6587\u5b57\u524a\u9664 Ctrl + d (Delete) \u30ab\u30fc\u30bd\u30eb\u4e0a\u306e1\u6587\u5b57\u524a\u9664 Ctrl + w \u5358\u8a9e1\u500b\u6587\u524a\u9664 <p>Ctrl + d \u306f\u4f55\u3082\u5165\u529b\u3057\u3066\u3044\u306a\u3044\u72b6\u614b\u3067\u5165\u529b\u3059\u308b\u3068\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3002</p>"},{"location":"terminal-shortcut/#_4","title":"\u30ab\u30c3\u30c8,\u30e4\u30f3\u30af","text":"\u30b3\u30de\u30f3\u30c9 \u610f\u5473 Ctrl + k \u884c\u672b\u307e\u3067\u524a\u9664 Ctrl + u \u884c\u982d\u307e\u3067\u524a\u9664 Ctrl + y \u6700\u5f8c\u306b\u524a\u9664\u3057\u305f\u5185\u5bb9\u3092\u633f\u5165 <p>\u30ab\u30c3\u30c8\u304c\u5207\u308a\u53d6\u308a\u3067\u3001\u30e4\u30f3\u30af\u304c\u8cbc\u308a\u4ed8\u3051\u3068\u899a\u3048\u3066\u304a\u3051\u3070\u5927\u4e08\u592b\u3067\u3059\u3002</p>"},{"location":"terminal-shortcut/#_5","title":"\u5c65\u6b74","text":"\u30b3\u30de\u30f3\u30c9 \u610f\u5473 Ctrl + p \u4e00\u3064\u524d\u306e\u30b3\u30de\u30f3\u30c9\u5c65\u6b74 Ctrl + n \u6b21\u306e\u30b3\u30de\u30f3\u30c9\u5c65\u6b74 Ctrl + r \u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30bf\u30eb\u691c\u7d22 <p>\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30bf\u30eb\u691c\u7d22\u306f\u904e\u53bb\u306b\u4f7f\u7528\u3057\u305f\u30b3\u30de\u30f3\u30c9\u3092\u691c\u7d22\u3059\u308b\u6a5f\u80fd\u3067\u3059\u3002</p>"},{"location":"terminal-shortcut/#_6","title":"\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30bf\u30eb\u691c\u7d22\u306e\u64cd\u4f5c","text":"\u30b3\u30de\u30f3\u30c9 \u610f\u5473 Ctrl + r \u4e00\u3064\u524d\u306e\u5c65\u6b74 Ctrl + g \u7834\u68c4 Enter \u5b9f\u884c ESC \u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u306b\u623b\u308b"},{"location":"terminal-shortcut/#_7","title":"\u305d\u306e\u4ed6","text":"\u30b3\u30de\u30f3\u30c9 \u610f\u5473 Ctrl + c \u5b9f\u884c\u4e2d\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5f37\u5236\u7d42\u4e86 Ctrl + l \u753b\u9762\u3092\u30af\u30ea\u30a2\u3059\u308b Ctrl + t \u4e00\u3064\u524d\u3068\u30ab\u30fc\u30bd\u30eb\u306e\u6587\u5b57\u3092\u5165\u308c\u66ff\u3048\u308b Ctrl + d \u7d42\u4e86 Ctrl + m Enter Ctrl + j Enter Ctrl + o Enter"},{"location":"teslak20c/","title":"Tesla K20c \u3092\u30b2\u30fc\u30e0\u7528\u306b\u6539\u9020\u3057\u3066\u307f\u305f","text":""},{"location":"teslak20c/#_1","title":"\u80cc\u666f","text":"<p>\u6700\u8fd1Switch\u30a8\u30df\u30e5\u306b\u306f\u307e\u3063\u3066\u3001\u65e2\u5b58\u306eGTX660Ti\u3067\u306f\u529b\u4e0d\u8db3\u3067\u3057\u3066\u3001 \u9577\u5e74\u306b\u308f\u305f\u308a\u4f7f\u3063\u3066\u3044\u305f\u30b0\u30e9\u30dc\u3092\u65b0\u898f\u8abf\u9054\u3057\u3088\u3046\u3068\u601d\u3044\u307e\u3057\u305f\u304c\u3001\u8abf\u3079\u305f\u3068\u3053\u308d\u4e2d\u53e4GTX1080\u3082\uff11\u4e07\uff18\u5343\u5186\u524d\u5f8c\u3067\u3057\u305f\u3002 \u305f\u307e\u305f\u307e\u30bb\u30fc\u30eb\u306e\u4e2d\u53e4\u54c1Tesla K20c \u304c\u898b\u304b\u3051\u3066\u3001\u3069\u3046\u3044\u3046\u3082\u306e\u304b\u3092\u8abf\u3079\u305f\u3068\u3053\u308d\u3001GTX780\u3068\u540c\u3058\u30ec\u30d9\u30eb\u3067\u3057\u305f\u3002 \u6fc0\u5b89\u306e\u305f\u3081\u3001\u8cfc\u5165\u3057\u307e\u3057\u305f\u3002</p> <p>teslak20c\u306f\u4ee5\u4e0b\u30c7\u30e1\u30ea\u30c3\u30c8\u304c\u3042\u308a\u307e\u3059\u3002 - \u51fa\u529b\u7aef\u5b50\u304c\u306a\u304f\u3066\u3001\u304a\u4f7f\u3044PC\u306eCPU\u306f\u30b0\u30e9\u30dc\u5185\u8535\u304c\u524d\u63d0\u6761\u4ef6\u3067\u3059\u3002 - \u3082\u3068\u3082\u3068\u8a08\u7b97\u7528GPU\u306e\u305f\u3081\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306eBIOS\u3067\u306f\u30b2\u30fc\u30e0\u3067\u304d\u306a\u3044 - \u30b2\u30fc\u30e0\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3001BIOS\u306e\u66f8\u304d\u63db\u3048\u304c\u5fc5\u8981\u3067\u3059\u3002</p> <p>\u30cd\u30c3\u30c8\u306b\u305f\u304f\u3055\u3093\u60c5\u5831\u3042\u308a\u307e\u3059\u304c\u3001\u3069\u308c\u3082\u3046\u307e\u304f\u3044\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002</p> <p>\u3055\u3089\u306bBIOS\u3092\u8abf\u67fb\u3057\u305f\u3068\u3053\u308d\u6539\u9020\u6e08\u304b\u3064overclock\u6e08\u306eBIOS\u304c\u3042\u308a\u307e\u3057\u305f\u3002 \u8a66\u3057\u306b\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u304c\u3001\u3059\u3093\u306a\u308a\u3044\u3051\u307e\u3057\u305f\u3002</p> <p>\u624b\u9806\u3068\u3057\u3066\u8a18\u8f09\u3057\u307e\u3057\u305f\u3002</p>"},{"location":"teslak20c/#vbios","title":"VBIOS\u66f4\u65b0\u7528\u30c4\u30fc\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9","text":"<ul> <li>nvflash_5.165<ul> <li>https://us3-dl.techpowerup.com/files/KZuE8M2-AmRn0PFtSfEMSg/1708622385/nvflash_windows_5.165.zip</li> </ul> </li> </ul>"},{"location":"teslak20c/#vbios_1","title":"\u66f4\u65b0\u7528VBIOS\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9","text":"<ul> <li>PNY Tesla K20c 5 GB BIOS<ul> <li>https://www.techpowerup.com/vgabios/241461/241461</li> <li>PNY, K20C modded for WDDM, NVIDIA Tesla K20c, Light overclocked (954 / 1450)</li> </ul> </li> </ul>"},{"location":"teslak20c/#vbios_2","title":"VBIOS\u66f4\u65b0\u524d\u306e\u78ba\u8a8d","text":"version check <pre><code>## version check\nPS D:\\teslak20c\\nvflash_5.821&gt; .\\nvflash64.exe --version\nNVIDIA Firmware Update Utility (Version 5.821.0)\nCopyright (C) 1993-2023, NVIDIA Corporation. All rights reserved.\n\nReading EEPROM (this operation may take up to 30 seconds)\nRedundant Firmware    : Not Present\nSign-On Message       : GK110 P2081 SKU 0204 VGA BIOS (HWDIAG)\nBuild GUID            : Blank\nBuild Number          : 14126909\nIFR Subsystem ID      : 10DE-0982\nSubsystem Vendor ID   : 0x10DE\nSubsystem ID          : 0x0982\nVersion               : 80.10.14.00.02\nImage Hash            : 71FAA0E10FCFAE1803B1BFBB45280763\nProduct Name          : GK110 Board - 20810204\nDevice Name(s)        : Tesla K20c\nBoard ID              : 0xE208\nVendor ID             : 0x10DE\nDevice ID             : 0x1022\nHierarchy ID          : Normal Board\nChip SKU              : 885-0\nProject               : 2081-0204\nBuild Date            : 10/16/12\nModification Date     : 10/23/12\nUEFI Version          : No Version Found or Out-dated (  )\nUEFI Variant ID       : No Variant ID Found ( No Variant ID Found )\nUEFI Signer(s)        : Unknown signer\nXUSB-FW Version ID    : N/A\nXUSB-FW Build Time    : N/A\nInfoROM Version       : 2081.0204.00.07\nInfoROM Backup        : Present\nLicense Placeholder   : Not Present\nGPU Mode              : N/A\nCEC OTA-signed Blob   : Not Present\n</code></pre>"},{"location":"teslak20c/#vbios_3","title":"VBIOS\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7","text":"backup VBIOS <pre><code># backup VBIOS\nPS D:\\teslak20c\\nvflash_5.821&gt; .\\nvflash64.exe --save k20c.origin.vbios.bin\nNVIDIA Firmware Update Utility (Version 5.821.0)\nCopyright (C) 1993-2023, NVIDIA Corporation. All rights reserved.\n\nReading EEPROM (this operation may take up to 30 seconds)\nBuild GUID            : Blank\nBuild Number          : 14126909\nIFR Subsystem ID      : 10DE-0982\nSubsystem Vendor ID   : 0x10DE\nSubsystem ID          : 0x0982\nVersion               : 80.10.14.00.02\nImage Hash            : 71FAA0E10FCFAE1803B1BFBB45280763\nHierarchy ID          : Normal Board\nBuild Date            : 10/16/12\nModification Date     : 10/23/12\nUEFI Version          : No Version Found or Out-dated (  )\nUEFI Variant ID       : No Variant ID Found ( No Variant ID Found )\nUEFI Signer(s)        : Unknown signer\nXUSB-FW Version ID    : N/A\nXUSB-FW Build Time    : N/A\nInfoROM Version       : 2081.0204.00.07\nInfoROM Backup        : Present\nLicense Placeholder   : Not Present\nGPU Mode              : N/A\nCEC OTA-signed Blob   : Not Present\n</code></pre>"},{"location":"teslak20c/#vbios_4","title":"\u5bfe\u8c61VBIOS\u306b\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9","text":"<ul> <li>VBIOS\u306e\u66f4\u65b0\u306f\u53e4\u3044nvflash\u3057\u304b\u3060\u3081\u306e\u3088\u3046\u3067\u3059\u3001\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u691c\u8a3c\u672a\u5b9f\u65bd\u3067\u3059\u3002</li> </ul> \u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9 <pre><code># update vbios\nPS D:\\teslak20c\\nvflash_5.165&gt; .\\nvflash.exe -4 -5 -6 .\\PNY_Tesla_K20c_5GB_BIOS.rom\n\nNVIDIA Firmware Update Utility (Version 5.165)\nChecking for matches between display adapter(s) and image(s)...\n\nAdapter: Tesla K20c           (10DE,1022,10DE,1015) H:--:NRM B:01,PCI,D:00,F:00\n\nWARNING: None of the firmware image compatible PCI Device ID's\nmatch the PCI Device ID of the adapter.\nAdapter PCI Device ID:        1022\nFirmware image PCI Device ID: 1023\nWARNING: Firmware image PCI Subsystem ID (10DE.097E)\n  does not match adapter PCI Subsystem ID (10DE.1015).\nWARNING: Firmware image Board ID (E606) does not match adapter Board ID (E209).\nPCI Device ID override detected.\n(This is usually only needed for very special circumstances.)\nAre you sure you want to continue?\nType \"YES\" to confirm (all caps):\nYES\nOverriding GPU mismatch\nPlease press 'y' to confirm override of PCI Subsystem ID's:\nOverriding PCI subsystem ID mismatch\n\n*** WARNING: Overriding the Board ID can be very dangerous. ***\nUpgrading to an image with the wrong Board ID can render the video card\nunusable.\nOverriding the Board ID is only needed for extreme circumstances.\nA mismatched Board ID almost always means the wrong firmware image is being\nused for the specific video card.\nAre you sure you want to continue?\nType \"YES\" to confirm (all caps):\nYES\n\nOverrding Board ID mismatch\nCurrent      - Version:80.10.11.00.0B ID:10DE:1028:10DE:1015\n               GK110 Board - 20810208 (Normal Board)\nReplace with - Version:80.80.65.00.0A ID:10DE:1023:10DE:097E\n               GK110B Board - 20810202 (Normal Board)\nUpdate display adapter firmware?\nPress 'y' to confirm (any other key to abort):\nThe display may go *BLANK* on and off for up to 10 seconds or more during the update process depending on your display adapter and output device.\n\nIdentifying EEPROM...\nEEPROM ID (C8,4012) : GD GD25Q20 2.7-3.6V 2048Kx1S, page\nClearing original firmware image...\n.\nStoring updated firmware image...\n.........\nVerifying update...\nUpdate successful.\n\nPS D:\\teslak20c\\nvflash_5.165&gt;\n</code></pre>"},{"location":"teslak20c/#vbios_5","title":"VBIOS\u66f4\u65b0\u5f8c\u306e\u78ba\u8a8d","text":"nvflash_5.165\u3067\u306e\u78ba\u8a8d <pre><code># nvflash_5.165\u3067\u306e\u78ba\u8a8d\nPS D:\\teslak20c\\nvflash_5.165&gt; .\\nvflash.exe --version\n\nNVIDIA Firmware Update Utility (Version 5.165)\nAdapter: Tesla K20c           (10DE,1022,10DE,097E) H:--:NRM B:01,PCI,D:00,F:00\n\nThe display may go *BLANK* on and off for up to 10 seconds during access to the EEPROM depending on your display adapter and output device.\n\nIdentifying EEPROM...\nEEPROM ID (C8,4012) : GD GD25Q20 2.7-3.6V 2048Kx1S, page\nReading adapter firmware image...\nIFR Data Size         : 1336 bytes\nIFR CRC32             : 32DE7F88\nIFR Image Size        : 1536 bytes\nIFR Image CRC32       : F53E2AAC\nIFR Subsystem ID      : 10DE-097E\nImage Size            : 224256 bytes\nVersion               : 80.80.65.00.0A\nRC32                : 9BF14895\nOEM String            : NVIDIA\nVendor Name           : NVIDIA Corporation\nProduct Name          : GK110B Board - 20810202\nProduct Revision      : Chip Rev\nDevice Name(s)        : Tesla K40m\nBoard ID              : E606\nPCI ID                : 10DE-1023\nSubsystem ID          : 10DE-097E\nHierarchy ID          : Normal Board\nChip SKU              : 897-0\nProject               : 2081-0202\nCDP                   : N/A\nBuild Date            : 04/08/15\nModification Date     : 07/10/16\nUEFI Support          : Yes\nUEFI Version          : 0x10031 (Jan  7 2015 @ 19206708 )\nUEFI Variant Id       : 0x0000000000000004\nUEFI Signer(s)        : Microsoft Corporation UEFI CA 2011\nSign-On Message       : GK110B P2081 SKU 0202 VGA BIOS\n\nPS D:\\teslak20c\\nvflash_5.165&gt;\n</code></pre> nvflash_5.821\u3067\u306e\u78ba\u8a8d <pre><code>PS D:\\teslak20c\\nvflash_5.821&gt; .\\nvflash64.exe --version\nNVIDIA Firmware Update Utility (Version 5.821.0)\nCopyright (C) 1993-2023, NVIDIA Corporation. All rights reserved.\n\nReading EEPROM (this operation may take up to 30 seconds)\nRedundant Firmware    : Not Present\nSign-On Message       : GK110B P2081 SKU 0202 VGA BIOS\nBuild GUID            : Blank\nBuild Number          : 19469039\nIFR Subsystem ID      : 10DE-097E\nSubsystem Vendor ID   : 0x10DE\nSubsystem ID          : 0x097E\nVersion               : 80.80.65.00.0A\nImage Hash            : F3DF0AD7DE190246945C43491A71AEE5\nProduct Name          : GK110B Board - 20810202\nDevice Name(s)        : Tesla K40m\nBoard ID              : 0xE606\nVendor ID             : 0x10DE\nDevice ID             : 0x1023\nHierarchy ID          : Normal Board\nChip SKU              : 897-0\nProject               : 2081-0202\nBuild Date            : 04/08/15\nModification Date     : 07/10/16\nUEFI Version          : 0x10031 ( x64 )\nUEFI Variant ID       : 0x0000000000000004 ( GK1xx )\nUEFI Signer(s)        : Microsoft Corporation UEFI CA 2011\nXUSB-FW Version ID    : N/A\nXUSB-FW Build Time    : N/A\nInfoROM Version       : 2081.0208.01.07\nInfoROM Backup        : Present\nLicense Placeholder   : Not Present\nGPU Mode              : N/A\nCEC OTA-signed Blob   : Not Present\n\nPS D:\\teslak20c\\nvflash_5.821&gt;\n</code></pre>"},{"location":"teslak20c/#wddm","title":"WDDM\u306e\u78ba\u8a8d","text":"WDDM\u306e\u78ba\u8a8d <pre><code># VBIOS\u66f4\u65b0\u524d\nPS C:\\Program Files\\NVIDIA Corporation\\NVSMI&gt; .\\nvidia-smi.exe\nWed Feb 21 14:53:56 2024\n+-----------------------------------------------------------------------------+\n| NVIDIA-SMI 442.50       Driver Version: 442.50       CUDA Version: 10.2     |\n|-------------------------------+----------------------+----------------------+\n| GPU  Name            TCC/WDDM | Bus-Id        Disp.A | Volatile Uncorr. ECC |\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n|===============================+======================+======================|\n|   0  Tesla K40st         TCC  | 00000000:01:00.0 N/A |                  N/A |\n| 30%   37C    P8    N/A /  N/A |      9MiB /  5056MiB |     N/A      Default |\n+-------------------------------+----------------------+----------------------+\n\n+-----------------------------------------------------------------------------+\n| Processes:                                                       GPU Memory |\n|  GPU       PID   Type   Process name                             Usage      |\n|=============================================================================|\n|    0                    Not Supported                                       |\n+-----------------------------------------------------------------------------+\nPS C:\\Program Files\\NVIDIA Corporation\\NVSMI&gt;\n\n# VBIOS\u66f4\u65b0\u5f8c\nPS C:\\Program Files\\NVIDIA Corporation\\NVSMI&gt; .\\nvidia-smi.exe\nWed Feb 21 16:04:20 2024\n+-----------------------------------------------------------------------------+\n| NVIDIA-SMI 442.50       Driver Version: 442.50       CUDA Version: 10.2     |\n|-------------------------------+----------------------+----------------------+\n| GPU  Name            TCC/WDDM | Bus-Id        Disp.A | Volatile Uncorr. ECC |\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n|===============================+======================+======================|\n|   0  Tesla K20c         WDDM  | 00000000:01:00.0 Off |                  Off |\n| N/A   39C    P0    70W / 235W |    409MiB /  5120MiB |     31%      Default |\n+-------------------------------+----------------------+----------------------+\n\n+-----------------------------------------------------------------------------+\n| Processes:                                                       GPU Memory |\n|  GPU       PID   Type   Process name                             Usage      |\n|=============================================================================|\n|    0      1940    C+G   E:\\game\\yuzu-windows-msvc\\yuzu.exe         N/A      |\n|    0      2584    C+G   ...ration\\Control Panel Client\\nvcplui.exe N/A      |\n+-----------------------------------------------------------------------------+\nPS C:\\Program Files\\NVIDIA Corporation\\NVSMI&gt;\n</code></pre>"},{"location":"teslak20c/#_2","title":"\u30ec\u30b8\u30b9\u30c8\u30ea\u306e\u5909\u66f4","text":"<pre><code>\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u30fc/HKEY_LOCAL_MACHINE/SYSTEM/ControlSet/Class/{4d36e968-e325-11ce-bfc1-08003be10318}/0004\n- \u4eba\u306b\u3088\u3063\u30660001\u306b\u306a\u308b\u304b\u3082\n\n\u4e0b\u8a18\u3092\u5909\u66f4\n- AdapterType -&gt; 0 (\u524a\u9664)\n- EnableMsHybrid(DWORD) -&gt; 1\n</code></pre>"},{"location":"teslak20c/#pc","title":"PC\u518d\u8d77\u52d5","text":""},{"location":"teslak20c/#_3","title":"\u304a\u307e\u3051","text":"<p>VBIOS\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u306f\u4e0b\u8a18\u306e\u30c4\u30fc\u30eb\u3067\u6211\u6d41\u306b\u5909\u66f4\u3067\u304d\u308b\u3002 \u3042\u307e\u308a\u8a73\u3057\u304f\u306a\u3044\u305f\u3081\u3001\u5f04\u3063\u3066\u306a\u304b\u3063\u305f\u3002</p> <ul> <li>Kepler BIOS<ul> <li>https://www.techpowerup.com/download/kepler-bios-tweaker/</li> </ul> </li> </ul>"},{"location":"teslak20c/#nvidia","title":"NVIDIA\u30c9\u30e9\u30a4\u30d0\u30fc\u66f4\u65b0\u3059\u308b\u5834\u5408","text":"<p>\u30c9\u30e9\u30a4\u30d0\u30fc\u66f4\u65b0\u3059\u308b\u3068\u30b0\u30e9\u30dc\u306f\u5143\u901a\u308a\u306b\u623b\u3063\u3066\u3057\u307e\u3046\u305f\u3081\u3001 \u4e0a\u8a18\u306e\u624b\u9806\u66f8\u901a\u308a\u3082\u3046\u4e00\u5ea6\u5b9f\u65bd\u3059\u308b\u5fc5\u8981\u3067\u3059\u3002</p>"},{"location":"ubnt/","title":"ubnt","text":"<ul> <li>Edgerouter Lite-3\u3067DS-Lite</li> </ul>"},{"location":"ubnt/#add-nat","title":"Add nat","text":"<ul> <li>EdgeRouter - Port Forwarding</li> </ul> <pre><code>    set firewall name WAN_IN rule 22 action accept\n    set firewall name WAN_IN rule 22 destination address 192.168.1.100\n    set firewall name WAN_IN rule 22 destination port 22\n    set firewall name WAN_IN rule 22 protocol tcp\n\n    set service nat rule 22 description \"port forward to Server (ssh)\"\n    set service nat rule 22 destination port 22\n    set service nat rule 22 inbound-interface pppoe0\n    set service nat rule 22 inside-address address 192.168.1.100\n    set service nat rule 22 inside-address port 22\n    set service nat rule 22 protocol tcp\n    set service nat rule 22 type destination\n    commit\n    save\n</code></pre>"},{"location":"ubnt/#add-dynamic-dns","title":"Add dynamic DNS","text":"\u8a2d\u5b9a\u5024 Duck DNS domain return-0.duckdns.org Interface pppoe0 Service custom-duckdns Hostname return-0 Login nouser Password Duck DNS \u306e\u30b5\u30a4\u30c8\u306b\u8868\u793a\u3055\u308c\u308b<code>token</code> Protocol dyndns2 Server www.duckdns.org <ul> <li>duckdns</li> <li>EdgeRouter X - 5. \u30c0\u30a4\u30ca\u30df\u30c3\u30af DNS \u306e\u8a2d\u5b9a ( DDNS )</li> </ul> <pre><code>root@ubnt:/home/ubnt# configure\n[edit]\nroot@ubnt# set service dns dynamic interface pppoe0  service custom-duckdns host-name return-0\n[edit]\nroot@ubnt# set service dns dynamic interface pppoe0  service custom-duckdns login nosuer\n[edit]\nroot@ubnt# set service dns dynamic interface pppoe0  service custom-duckdns password xxxtokenxxxx\n[edit]\nroot@ubnt# set service dns dynamic interface pppoe0  service custom-duckdns protocol dyndns2\n[edit]\nroot@ubnt# set service dns dynamic interface pppoe0  service custom-duckdns server www.duckdns.org\n[edit]\nroot@ubnt# commit\n[edit]\nroot@ubnt# save\nSaving configuration to '/config/config.boot'...\nDone\n[edit]\nroot@ubnt#\nroot@ubnt:/home/ubnt# show dns dynamic status\n# ddns\ninterface    : pppoe0\nip address   : &lt;PublicIP&gt;\nhost-name    : &lt;hostname&gt; (xxx.ddns.net)\nlast update  : Wed Apr 25 10:28:27 2018\nupdate-status: good\n# duckdns\ninterface    : pppoe0\nip address   : &lt;PublicIP&gt;\nhost-name    : &lt;hostname&gt; (xxx)\nlast update  : Wed Apr 25 10:28:27 2018\nupdate-status: good\nroot@ubnt:/home/ubnt#\n</code></pre>"},{"location":"ubnt/#create-vpn-l2tp","title":"create VPN L2TP","text":"<pre><code>SSH \u3067\u30eb\u30fc\u30bf\u30fc\u306b\u30a2\u30af\u30bb\u30b9\n## \u8a2d\u5b9a\u30e2\u30fc\u30c9\u306b\u5165\u308b\nconfigure\n</code></pre>"},{"location":"ubnt/#add-firewall-rules-for-the-l2tp-traffic-to-the-local-firewall-policy","title":"Add firewall rules for the L2TP traffic to the local firewall policy.","text":"<pre><code>    set firewall name WAN_LOCAL rule 30 action accept\n    set firewall name WAN_LOCAL rule 30 description ike\n    set firewall name WAN_LOCAL rule 30 destination port 500\n    set firewall name WAN_LOCAL rule 30 log disable\n    set firewall name WAN_LOCAL rule 30 protocol udp\n\n    set firewall name WAN_LOCAL rule 40 action accept\n    set firewall name WAN_LOCAL rule 40 description esp\n    set firewall name WAN_LOCAL rule 40 log disable\n    set firewall name WAN_LOCAL rule 40 protocol esp\n\n    set firewall name WAN_LOCAL rule 50 action accept\n    set firewall name WAN_LOCAL rule 50 description nat-t\n    set firewall name WAN_LOCAL rule 50 destination port 4500\n    set firewall name WAN_LOCAL rule 50 log disable\n    set firewall name WAN_LOCAL rule 50 protocol udp\n\n    set firewall name WAN_LOCAL rule 60 action accept\n    set firewall name WAN_LOCAL rule 60 description l2tp\n    set firewall name WAN_LOCAL rule 60 destination port 1701\n    set firewall name WAN_LOCAL rule 60 ipsec match-ipsec\n    set firewall name WAN_LOCAL rule 60 log disable\n    set firewall name WAN_LOCAL rule 60 protocol udp\n</code></pre>"},{"location":"ubnt/#ipsec","title":"\u57fa\u672c\u7684\u306a IPsec \u306e\u8a2d\u5b9a","text":"<pre><code>  set vpn ipsec ipsec-interfaces interface pppoe0\n  set vpn ipsec nat-networks allowed-network 0.0.0.0/0\n  set vpn ipsec nat-traversal enable\n</code></pre>"},{"location":"ubnt/#wan-ip-pppoe0","title":"WAN \u5074 IP \u30a2\u30c9\u30ec\u30b9\u304c pppoe0 \u7d4c\u7531\u3067\u5272\u308a\u5f53\u3066\u306e\u5834\u5408\u3053\u308c\u3092\u6307\u5b9a","text":"<pre><code>  set vpn l2tp remote-access outside-address 0.0.0.0\n</code></pre>"},{"location":"ubnt/#l2tp-ip","title":"L2TP \u3067\u30a2\u30af\u30bb\u30b9\u3057\u3066\u304d\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u5272\u308a\u5f53\u3066\u308b IP \u30a2\u30c9\u30ec\u30b9\u306e\u7bc4\u56f2\u3092\u6307\u5b9a","text":"<pre><code>  set vpn l2tp remote-access client-ip-pool start 192.168.1.121\n  set vpn l2tp remote-access client-ip-pool stop 192.168.1.140\n</code></pre>"},{"location":"ubnt/#l2tp","title":"L2TP \u306e\u300c\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u300d\u3092\u8a2d\u5b9a","text":"<ul> <li><code>PASSWORD</code> \u306e\u90e8\u5206\u3092\u4efb\u610f\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306b\u5909\u66f4\u3057\u3066\u5165\u529b</li> </ul> <pre><code>  set vpn l2tp remote-access ipsec-settings authentication mode pre-shared-secret\n  set vpn l2tp remote-access ipsec-settings authentication pre-shared-secret PASSWORD\n  set vpn l2tp remote-access ipsec-settings ike-lifetime 3600\n</code></pre>"},{"location":"ubnt/#l2tp_1","title":"L2TP \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u8a8d\u8a3c\u65b9\u6cd5\u3092\u30ed\u30fc\u30ab\u30eb\u306b\u8a2d\u5b9a","text":"<pre><code>  set vpn l2tp remote-access authentication mode local\n</code></pre>"},{"location":"ubnt/#l2tp_2","title":"L2TP \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u30e6\u30fc\u30b6\u30fc\u540d\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a","text":"<ul> <li><code>USER</code> \u3068 <code>PASSWORD</code> \u306e\u90e8\u5206\u3092\u5909\u66f4\u3057\u3066\u5165\u529b</li> </ul> <pre><code>  set vpn l2tp remote-access authentication local-users username USER password PASSWORD\n</code></pre>"},{"location":"ubnt/#l2tp-mtu","title":"L2TP \u306e MTU \u3092\u4fdd\u5b88\u7684\u306b\u8a2d\u5b9a","text":"<pre><code>  set vpn l2tp remote-access mtu 1280\n</code></pre>"},{"location":"ubnt/#l2tp-dns-google-dns","title":"L2TP \u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u4f7f\u3046 DNS \u3092\u30eb\u30fc\u30bf\u30fc\u81ea\u8eab\u3068 Google DNS \u306b\u8a2d\u5b9a","text":"<pre><code>  set vpn l2tp remote-access dns-servers server-1 192.168.1.1\n  set vpn l2tp remote-access dns-servers server-2 8.8.8.8\n</code></pre>"},{"location":"ubnt/#dns-l2tp-dns-frowarding","title":"\u30eb\u30fc\u30bf\u30fc\u306e DNS \u304c L2TP \u304b\u3089\u4f7f\u3048\u308b\u3088\u3046 DNS Frowarding \u3092\u30eb\u30fc\u30bf\u30fc\u81ea\u8eab\u306b\u8a2d\u5b9a","text":"<pre><code>   set service dns forwarding listen-on lo\n</code></pre>"},{"location":"ubnt/#_1","title":"\u8a2d\u5b9a\u4fdd\u5b58","text":"<pre><code>  commit\n  save\n</code></pre>"},{"location":"ubnt/#my-mac","title":"\u300c\u3069\u3053\u3067\u3082 My Mac\u300d\u3068\u306e\u7af6\u5408\u5bfe\u7b56","text":"<pre><code>UDP \u30dd\u30fc\u30c8 4500\u306f\u3001\u300c\u3069\u3053\u3067\u3082 My Mac\u300d\u3067\u3082\u4f7f\u7528\u3057\u3066\u3044\u308b\u305f\u3081\u3001\nMac\u5074\u3067\u300c\u3069\u3053\u3067\u3082 My Mac\u300d\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u308b\u3068\u3001L2TP/IPSec\u3068\u7af6\u5408\u3057\u3066\u30a2\u30af\u30bb\u30b9\u4e0d\u80fd\u306b\u9665\u308a\u307e\u3059\u3002\n\u3000\u30fb\u3000\u56de\u907f\u65b9\u6cd5\n\u3000\u3000\u305d\u306e1\uff09 \u30ed\u30fc\u30ab\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5185\u306b\u3042\u308b\u3059\u3079\u3066\u306eMac\u3067\u300c\u3069\u3053\u3067\u3082 My Mac\u300d\u3092\u7121\u52b9\u306b\u3059\u308b\n\u3000\u3000\u305d\u306e2\uff09 Edgerouter\u306eUPnP2\u3092\u7121\u52b9\u306b\u3059\u308b\u3000\u203b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u7684\u306b\u306fUPnP\u3092\u7121\u52b9\u306b\u3059\u308b\u306e\u304c\u5409\n\u3000\u3000\u305d\u306e3\uff09 UPnP\u304c\u5fc5\u8981\u306a\u5834\u5408\u3001UPnP2\u3067UDP \u30dd\u30fc\u30c8 4500\u3067\u306e\u8ee2\u9001\u3092\u6b62\u3081\u308b\n</code></pre>"},{"location":"ubnt/#3","title":"\u305d\u306e3\uff09\u3092\u30b3\u30de\u30f3\u30c9\u3067\u8a2d\u5b9a\u3059\u308b\u5834\u5408","text":""},{"location":"ubnt/#_2","title":"\u5bfe\u7b56 \u8a2d\u5b9a\u30e2\u30fc\u30c9\u306e\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u8a2d\u5b9a","text":"<pre><code>  configure\n  set service upnp2 acl rule 10 action deny\n  set service upnp2 acl rule 10 description \"Block Port 4500\"\n  set service upnp2 acl rule 10 external-port 4500\n  set service upnp2 acl rule 10 local-port 4500\n  set service upnp2 acl rule 10 subnet 192.168.1.0/24\n  set service upnp2 listen-on pppoe0\n  set service upnp2 wan pppoe0\n</code></pre>"},{"location":"ubnt/#_3","title":"\u8a2d\u5b9a\u3092\u53cd\u6620\u3057\u3066\u4fdd\u5b58\u3001\u8a2d\u5b9a\u30e2\u30fc\u30c9\u7d42\u4e86","text":"<pre><code>  commit\n  save\n  exit\n</code></pre>"},{"location":"ubnt/#_4","title":"\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8","text":"<pre><code>  root@ubnt:/home/ubnt# df -h\n  Filesystem                Size      Used Available Use% Mounted on\n  ubi0_0                  214.9M    155.8M     54.4M  74% /root.dev\n  aufs                    214.9M    155.8M     54.4M  74% /\n  devtmpfs                124.3M         0    124.3M   0% /dev\n  tmpfs                   124.4M    220.0K    124.2M   0% /run\n  tmpfs                   124.4M    220.0K    124.2M   0% /run\n  tmpfs                   124.4M     18.7M    105.8M  15% /var/log\n  tmpfs                   124.4M     12.0K    124.4M   0% /tmp\n  none                    124.4M    756.0K    123.7M   1% /opt/vyatta/config\n  root@ubnt:/home/ubnt# \n\n  root@ubnt:/home/ubnt# show system image\n  The system currently has the following image(s) installed:\n\n  v1.10.5.5098943.180622.1555    (running image) (default boot)\n  v1.9.0.4901118.160804.1131\n\n  root@ubnt:/home/ubnt# show system image storage\n  Image name                        Read-Only   Read-Write        Total\n  ------------------------------ ------------ ------------ ------------\n  v1.10.5.5098943.180622.1555           77760          940        78700\n  v1.9.0.4901118.160804.1131            76760        14152        90912\n  root@ubnt:/home/ubnt# delete system image\n  Possible completions:\n    &lt;Enter&gt;       Execute the current command\n\n  root@ubnt:/home/ubnt# delete system image\n  The system currently has the following image(s) installed:\n\n  v1.10.5.5098943.180622.1555    (running image) (default boot)\n  v1.9.0.4901118.160804.1131\n\n  You are about to delete image [v1.9.0.4901118.160804.1131]\n  Are you sure you want to delete ? (Yes/No) [Yes]: Yes\n  Removing old image... Done\n  root@ubnt:/home/ubnt#\n  root@ubnt:/home/ubnt# df -h\n  Filesystem                Size      Used Available Use% Mounted on\n  ubi0_0                  214.9M     74.1M    136.1M  35% /root.dev\n  aufs                    214.9M     74.1M    136.1M  35% /\n  devtmpfs                124.3M         0    124.3M   0% /dev\n  tmpfs                   124.4M    220.0K    124.2M   0% /run\n  tmpfs                   124.4M    220.0K    124.2M   0% /run\n  tmpfs                   124.4M     18.7M    105.7M  15% /var/log\n  tmpfs                   124.4M     12.0K    124.4M   0% /tmp\n  none                    124.4M    756.0K    123.7M   1% /opt/vyatta/config\n  root@ubnt:/home/ubnt# \n\n  root@ubnt:/home/ubnt# ls\n  ER-e50.v1.10.7.5127989.tar\n  root@ubnt:/home/ubnt# add system image ^C\n  root@ubnt:/home/ubnt# show version\n  Version:      v1.10.5\n  Build ID:     5098943\n  Build on:     06/22/18 15:55\n  Copyright:    2012-2018 Ubiquiti Networks, Inc.\n  HW model:     EdgeRouter X 5-Port\n  HW S/N:       F09FC2087E8A\n  Uptime:       12:45:43 up 85 days, 13:33,  1 user,  load average: 1.26, 1.24, 1.19\n  root@ubnt:/home/ubnt# add system image  ER-e50.v1.10.7.5127989.tar\n  Checking upgrade image...Done\n  Preparing to upgrade...Done\n  Clearing directory /var/cache/apt (356.0K)...Done\n  Copying upgrade image...Not enough disk space for root file system\n  Do you want to delete old version first? (Yes/No) [Yes]: Yes\n  Removing old image...Done\n  Still not enough disk space for root file system\n  Canceling upgrade\n  /home/ubnt\n  root@ubnt:/home/ubnt#\n  root@ubnt:/home/ubnt# df -h\n  Filesystem                Size      Used Available Use% Mounted on\n  ubi0_0                  214.9M    149.9M     60.3M  71% /root.dev\n  aufs                    214.9M    149.9M     60.3M  71% /\n  devtmpfs                124.3M         0    124.3M   0% /dev\n  tmpfs                   124.4M    220.0K    124.2M   0% /run\n  tmpfs                   124.4M    220.0K    124.2M   0% /run\n  tmpfs                   124.4M     18.7M    105.7M  15% /var/log\n  tmpfs                   124.4M     12.0K    124.4M   0% /tmp\n  none                    124.4M    756.0K    123.7M   1% /opt/vyatta/config\n  root@ubnt:/home/ubnt# ls -lath ER-e50.v1.10.7.5127989.tar\n  -rw-r--r--    1 ubnt     users      78.3M Nov  1 12:44 ER-e50.v1.10.7.5127989.tar\n  root@ubnt:/home/ubnt#\n\n  root@ubnt:/home/ubnt# add system image https://dl.ubnt.com/firmwares/edgemax/v1.10.x/ER-e50.v1.10.7.5127989.tar\n  Trying to get upgrade file from https://dl.ubnt.com/firmwares/edgemax/v1.10.x/ER-e50.v1.10.7.5127989.tar\n    % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                   Dload  Upload   Total   Spent    Left  Speed\n  100 78.3M  100 78.3M    0     0  3586k      0  0:00:22  0:00:22 --:--:-- 4926k\n  Download succeeded\n  Checking upgrade image...Done\n  Preparing to upgrade...Done\n  Clearing directory /var/cache/apt (356.0K)...Done\n  Copying upgrade image...Done\n  Removing old image...Done\n  Checking upgrade image...Done\n  Copying config data...Done\n  Finishing upgrade...Done\n  Upgrade completed\n  root@ubnt:/home/ubnt#\n\n  root@ubnt:/home/ubnt# show system image\n  The system currently has the following image(s) installed:\n\n  v1.10.7.5127989.181001.1227    (default boot)\n  v1.10.5.5098943.180622.1555    (running image)\n\n  A reboot is needed to boot default image\n  root@ubnt:/home/ubnt# show system image storage\n  Image name                        Read-Only   Read-Write        Total\n  ------------------------------ ------------ ------------ ------------\n  v1.10.7.5127989.181001.1227           78500           88        78588\n  v1.10.5.5098943.180622.1555           77760          588        78348\n  root@ubnt:/home/ubnt#\n\n  root@ubnt:/home/ubnt# show system image\n  The system currently has the following image(s) installed:\n\n  v1.10.7.5127989.181001.1227    (default boot)\n  v1.10.5.5098943.180622.1555    (running image)\n\n  A reboot is needed to boot default image\n  root@ubnt:/home/ubnt# set system image default-boot\n  The system currently has the following image(s) installed:\n\n  v1.10.7.5127989.181001.1227    (default boot)\n  v1.10.5.5098943.180622.1555    (running image)\n\n  A reboot is needed to boot default image\n  Are you sure you want to switch images? (Yes/No) [Yes]:\n  Moving images...\n  Done\n  Switched from\n    Version:      v1.10.7.5127989.181001.1227\n  to\n    Version:      v1.10.5.5098943.180622.1555\n  root@ubnt:/home/ubnt#\n  root@ubnt:/home/ubnt# show system image\n  The system currently has the following image(s) installed:\n\n  v1.10.5.5098943.180622.1555    (running image) (default boot)\n  v1.10.7.5127989.181001.1227\n\n  root@ubnt:/home/ubnt# set system image default-boot\n  The system currently has the following image(s) installed:\n\n  v1.10.5.5098943.180622.1555    (running image) (default boot)\n  v1.10.7.5127989.181001.1227\n\n  Are you sure you want to switch images? (Yes/No) [Yes]:\n  Moving images...\n  Done\n  Switched from\n    Version:      v1.10.5.5098943.180622.1555\n  to\n    Version:      v1.10.7.5127989.181001.1227\n  root@ubnt:/home/ubnt# show system image\n  The system currently has the following image(s) installed:\n\n  v1.10.7.5127989.181001.1227    (default boot)\n  v1.10.5.5098943.180622.1555    (running image)\n\n  A reboot is needed to boot default image\n  root@ubnt:/home/ubnt#\n  root@ubnt:/home/ubnt# reboot\n</code></pre>"},{"location":"undo-log/","title":"undo log","text":""},{"location":"undo-log/#ibdata1","title":"ibdata1","text":"<ul> <li>https://www.cnblogs.com/edda/p/13065394.html</li> <li>https://blog.csdn.net/a5nan/article/details/72896131</li> <li>https://www.cnblogs.com/fpcbk/p/14259446.html</li> <li>https://fromdual.com/undo-logs-in-innodb-system-tablespace-ibdata1</li> <li>https://dev.mysql.com/doc/refman/8.0/ja/innochecksum.html</li> <li>https://dev.mysql.com/doc/refman/8.0/ja/innodb-undo-tablespaces.html#truncate-undo-tablespace</li> </ul>"},{"location":"undo-log/#ibdata1ibdata","title":"ibdata1\u6587\u4ef6\u975e\u5e38\u5927\u5982\u4f55\u89e3\u51b3,ibdata\u5355\u72ec\u5b58\u50a8","text":"<p>\u5728MySQL 5.6.6\u7248\u672c\u4ee5\u524d\uff0cMySQL\u9ed8\u8ba4\u4f1a\u628a\u6240\u6709\u7684innodb\u7684\u8868\u90fd\u653e\u5728\u540c\u4e00\u4e2a\u6587\u4ef6\u4e2d(ibdata1)\uff0c\u5f53\u8be5\u6587\u4ef6\u8fc7\u5927\u7684\u65f6\u5019\uff0cMySQL\u5bb9\u6613\u51fa\u9519\uff0c\u7ef4\u62a4\u6027\u80fd\u5dee\u3002</p> <ol> <li> <p>\u7b80\u4ecb</p> <p>Innodb\u5b58\u50a8\u5f15\u64ce\u53ef\u5c06\u6240\u6709\u6570\u636e\u5b58\u653e\u4e8eibdata1 \u7684\u5171\u4eab\u8868\u7a7a\u95f4\uff0c\u4e5f\u53ef\u5c06\u6bcf\u5f20\u8868\u5b58\u653e\u4e8e\u72ec\u7acb\u7684.ibd\u6587\u4ef6\u7684\u72ec\u7acb\u8868\u7a7a\u95f4\u3002 \u5171\u4eab\u8868\u7a7a\u95f4\u4ee5\u53ca\u72ec\u7acb\u8868\u7a7a\u95f4\u90fd\u662f\u9488\u5bf9\u6570\u636e\u7684\u5b58\u50a8\u65b9\u5f0f\u800c\u8a00\u7684\u3002</p> <ul> <li>\u5171\u4eab\u8868\u7a7a\u95f4:  \u67d0\u4e00\u4e2a\u6570\u636e\u5e93\u7684\u6240\u6709\u7684\u8868\u6570\u636e\uff0c\u7d22\u5f15\u6587\u4ef6\u5168\u90e8\u653e\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u9ed8\u8ba4\u8fd9\u4e2a\u5171\u4eab\u8868\u7a7a\u95f4\u7684\u6587\u4ef6\u8def\u5f84\u5728data\u76ee\u5f55\u4e0b\u3002 \u9ed8\u8ba4\u7684\u6587\u4ef6\u540d\u4e3a:ibdata1  \u521d\u59cb\u5316\u4e3a10M\u3002</li> <li>\u72ec\u7acb\u8868\u7a7a\u95f4:  \u6bcf\u4e00\u4e2a\u8868\u90fd\u5c06\u4f1a\u751f\u6210\u4ee5\u72ec\u7acb\u7684\u6587\u4ef6\u65b9\u5f0f\u6765\u8fdb\u884c\u5b58\u50a8\uff0c\u6bcf\u4e00\u4e2a\u8868\u90fd\u6709\u4e00\u4e2a.frm\u8868\u63cf\u8ff0\u6587\u4ef6\uff0c\u8fd8\u6709\u4e00\u4e2a.ibd\u6587\u4ef6\u3002 \u5176\u4e2d\u8fd9\u4e2a\u6587\u4ef6\u5305\u62ec\u4e86\u5355\u72ec\u4e00\u4e2a\u8868\u7684\u6570\u636e\u5185\u5bb9\u4ee5\u53ca\u7d22\u5f15\u5185\u5bb9\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5b83\u7684\u5b58\u50a8\u4f4d\u7f6e\u4e5f\u662f\u5728\u8868\u7684\u4f4d\u7f6e\u4e4b\u4e2d\u3002</li> </ul> </li> <li> <p>\u4e8c\u8005\u4f18\u7f3a\u70b9</p> <ol> <li> <p>\u5171\u4eab\u8868\u7a7a\u95f4\uff1a</p> <ul> <li>\u4f18\u70b9\uff1a<ul> <li>\u53ef\u4ee5\u5c06\u8868\u7a7a\u95f4\u5206\u6210\u591a\u4e2a\u6587\u4ef6\u5b58\u653e\u5230\u5404\u4e2a\u78c1\u76d8\u4e0a\uff08\u8868\u7a7a\u95f4\u6587\u4ef6\u5927\u5c0f\u4e0d\u53d7\u8868\u5927\u5c0f\u7684\u9650\u5236\uff0c\u5982\u4e00\u4e2a\u8868\u53ef\u4ee5\u5206\u5e03\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u4e0a\uff09\u3002\u6570\u636e\u548c\u6587\u4ef6\u653e\u5728\u4e00\u8d77\u65b9\u4fbf\u7ba1\u7406\u3002</li> </ul> </li> <li>\u7f3a\u70b9\uff1a<ul> <li>\u6240\u6709\u7684\u6570\u636e\u548c\u7d22\u5f15\u5b58\u653e\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u867d\u7136\u53ef\u4ee5\u628a\u4e00\u4e2a\u5927\u6587\u4ef6\u5206\u6210\u591a\u4e2a\u5c0f\u6587\u4ef6\uff0c\u4f46\u662f\u591a\u4e2a\u8868\u53ca\u7d22\u5f15\u5728\u8868\u7a7a\u95f4\u4e2d\u6df7\u5408\u5b58\u50a8\uff0c\u8fd9\u6837\u5bf9\u4e8e\u4e00\u4e2a\u8868\u505a\u4e86\u5927\u91cf\u5220\u9664\u64cd\u4f5c\u540e\u8868\u7a7a\u95f4\u4e2d\u5c06\u4f1a\u6709\u5927\u91cf\u7684\u7a7a\u9699\uff0c\u7279\u522b\u662f\u5bf9\u4e8e\u7edf\u8ba1\u5206\u6790\uff0c\u65e5\u503c\u7cfb\u7edf\u8fd9\u7c7b\u5e94\u7528\u6700\u4e0d\u9002\u5408\u7528\u5171\u4eab\u8868\u7a7a\u95f4\u3002</li> </ul> </li> </ul> </li> <li> <p>\u72ec\u7acb\u8868\u7a7a\u95f4\uff1a</p> <p>\u5728\u914d\u7f6e\u6587\u4ef6\uff08my.cnf\uff09\u4e2d\u8bbe\u7f6e\uff1a innodb_file_per_table</p> <ul> <li>\u4f18\u70b9\uff1a<ol> <li>\u6bcf\u4e2a\u8868\u90fd\u6709\u81ea\u5df2\u72ec\u7acb\u7684\u8868\u7a7a\u95f4\u3002</li> <li>\u6bcf\u4e2a\u8868\u7684\u6570\u636e\u548c\u7d22\u5f15\u90fd\u4f1a\u5b58\u5728\u81ea\u5df2\u7684\u8868\u7a7a\u95f4\u4e2d\u3002</li> <li>\u53ef\u4ee5\u5b9e\u73b0\u5355\u8868\u5728\u4e0d\u540c\u7684\u6570\u636e\u5e93\u4e2d\u79fb\u52a8\u3002</li> <li>\u7a7a\u95f4\u53ef\u4ee5\u56de\u6536\uff08\u9664drop table\u64cd\u4f5c\u5904\uff0c\u8868\u7a7a\u4e0d\u80fd\u81ea\u5df2\u56de\u6536\uff09<ul> <li>Drop table\u64cd\u4f5c\u81ea\u52a8\u56de\u6536\u8868\u7a7a\u95f4\uff0c\u5982\u679c\u5bf9\u4e8e\u7edf\u8ba1\u5206\u6790\u6216\u662f\u65e5\u503c\u8868\uff0c\u5220\u9664\u5927\u91cf\u6570\u636e\u540e\u53ef\u4ee5\u901a\u8fc7:alter table TableName engine=innodb;\u56de\u7f29\u4e0d\u7528\u7684\u7a7a\u95f4\u3002</li> <li>\u5bf9\u4e8e\u4f7finnodb-plugin\u7684Innodb\u4f7f\u7528turncate table\u4e5f\u4f1a\u4f7f\u7a7a\u95f4\u6536\u7f29\u3002</li> <li>\u5bf9\u4e8e\u4f7f\u7528\u72ec\u7acb\u8868\u7a7a\u95f4\u7684\u8868\uff0c\u4e0d\u7ba1\u600e\u4e48\u5220\u9664\uff0c\u8868\u7a7a\u95f4\u7684\u788e\u7247\u4e0d\u4f1a\u592a\u4e25\u91cd\u7684\u5f71\u54cd\u6027\u80fd\uff0c\u800c\u4e14\u8fd8\u6709\u673a\u4f1a\u5904\u7406\u3002</li> </ul> </li> </ol> </li> <li>\u7f3a\u70b9\uff1a<ul> <li>\u5355\u8868\u589e\u52a0\u8fc7\u5927\uff0c\u5982\u8d85\u8fc7100\u4e2aG\u3002</li> <li>\u76f8\u6bd4\u8f83\u4e4b\u4e0b\uff0c\u4f7f\u7528\u72ec\u5360\u8868\u7a7a\u95f4\u7684\u6548\u7387\u4ee5\u53ca\u6027\u80fd\u4f1a\u66f4\u9ad8\u4e00\u70b9\u3002</li> </ul> </li> </ul> </li> </ol> </li> <li> <p>\u72ec\u7acb\u8868\u7a7a\u95f4\u53c2\u6570innodb_file_per_table\u8be6\u89e3</p> <ol> <li> <p>\u53c2\u6570\u5217\u8868\uff1a</p> Command-Line Format &gt; <code>--innodb_file_per_table</code> <code>System Variable</code> Name <code>innodb_file_per_table</code> ^ Variable Scope Global ^ Dynamic Variable Yes <code>Permitted Values (&lt;= 5.6.5)</code> Type boolean ^ Default OFF <code>Permitted Values (&gt;= 5.6.6)</code> Type boolean ^ Default ON </li> <li> <p>\u53c2\u6570\u529f\u80fd\uff1a</p> <ul> <li>\u8be5\u53c2\u6570\u5728mysql5.6.6\u53ca\u5176\u540e\u7eed\u7248\u672c\u9ed8\u8ba4\u5f00\u542f\uff0c\u5f00\u542f\u8be5\u53c2\u6570\u7684\u65f6\u5019\uff0cInnodb\u5c06\u6bcf\u4e2a\u65b0\u521b\u5efa\u7684\u8868\u7684\u6570\u636e\u53ca\u7d22\u5f15\u5b58\u50a8\u5728\u4e00\u4e2a\u72ec\u7acb\u7684.ibd\u6587\u4ef6\u91cc\uff0c\u800c\u4e0d\u662f\u7cfb\u7edf\u7684\u8868\u7a7a\u95f4\u3002\u5f53\u8fd9\u4e9binnodb\u8868\u88ab\u5220\u9664\u6216\u6e05\u7a7a\u7684\u65f6\u5019\uff0c\u5b58\u50a8\u7a7a\u95f4\u4f1a\u88ab\u56de\u6536\u3002</li> <li>\u5f00\u542finnodb_file_per_table\uff0c\u5728ALTER TABLE\u64cd\u4f5c\u91cd\u5efa\u8868\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u5c06innodb\u8868\u4ece\u7cfb\u7edf\u5171\u4eab\u8868\u7a7a\u95f4\u79fb\u52a8\u5230\u72ec\u7acb\u7684.ibd\u6587\u4ef6\u3002</li> <li>\u4e0d\u5f00\u542finnodb_file_per_table\uff0cinnodb\u4f1a\u5c06\u6240\u6709\u8868\u53ca\u7d22\u5f15\u7684\u6570\u636e\u5b58\u50a8\u5728\u6784\u6210\u7cfb\u7edf\u8868\u7a7a\u95f4\u7684ibdata\u6587\u4ef6\u3002\u8fd9\u6837\u4f1a\u964d\u4f4e\u6587\u4ef6\u7cfb\u7edf\u64cd\u4f5c\u7684\u6027\u80fd\u5f00\u9500\uff0c\u4f8b\u5982DROP TABLE \u6216 TRUNCATE TABLE\u3002\u5b83\u6700\u9002\u5408\u4e8e\u5c06\u6574\u5408\u78c1\u76d8\u90fd\u7528\u4e8e\u5b58\u50a8mysql\u6570\u636e\u7684\u60c5\u51b5\uff0c\u56e0\u4e3a\u7cfb\u7edf\u8868\u7a7a\u95f4\u4e0d\u4f1a\u6536\u7f29\uff0c\u6240\u6709\u7684\u6570\u636e\u5e93\u90fd\u5728\u4e00\u4e2a\u7a7a\u95f4\u5b9e\u4f8b\u91cc\u9762\u3002\u5f53innodb_file_per_table=OFF\u7684\u65f6\u5019\uff0c\u5e94\u907f\u514d\u5728\u7a7a\u95f4\u53d7\u9650\u7684\u7cfb\u7edf\u8868\u7a7a\u95f4\u91cc\u5bfc\u5165\u5927\u91cf\u4e34\u65f6\u6570\u636e\u3002</li> <li> <p>innodb_file_per_table \u53ef\u901a\u8fc7SET GLOBAL\u52a8\u6001\u7684\u4fee\u6539\u4e3aON\u6216OFF\uff0c\u4e5f\u53ef\u4ee5\u5728my.cnf\u4e2d\u505a\u6c38\u4e45\u6027\u4fee\u6539\uff0c\u5728my.cnf\u4e2d\u4fee\u6539\u540e\u751f\u6548\u7684\u8bdd\u9700\u8981\u91cd\u542fmysqld\u670d\u52a1\u3002</p> <ul> <li><code>set global innodb_file_per_table =ON;</code></li> </ul> </li> <li> <p>\u6ce8\uff1a\u52a8\u6001\u4fee\u6539\u540e\u4ec5\u5bf9\u540e\u7eed\u64cd\u4f5c\u751f\u6548\uff0c\u5982\u539f\u6765\u4e3a\u5171\u4eab\u8868\u7a7a\u95f4\uff0c\u52a8\u6001\u4fee\u6539\u4e3a\u72ec\u7acb\u8868\u7a7a\u95f4\u540e\u4ec5\u65b0\u5efa\u7684\u8868\u4e3a\u72ec\u7acb\u8868\u7a7a\u95f4\u3002</p> </li> </ul> </li> </ol> </li> </ol>"},{"location":"undo-log/#bdata1","title":"bdata1\u6587\u4ef6\u662f\u4ec0\u4e48\uff1f","text":"<p>ibdata1\u662f\u4e00\u4e2a\u7528\u6765\u6784\u5efainnodb\u7cfb\u7edf\u8868\u7a7a\u95f4\u7684\u6587\u4ef6\uff0c\u8fd9\u4e2a\u6587\u4ef6\u5305\u542b\u4e86innodb\u8868\u7684\u5143\u6570\u636e\u3001\u64a4\u9500\u8bb0\u5f55\u3001\u4fee\u6539buffer\u548c\u53cc\u5199buffer\u3002\u5982\u679cfile-per-table\u9009\u9879\u6253\u5f00\u7684\u8bdd\uff0c\u8be5\u6587\u4ef6\u5219\u4e0d\u4e00\u5b9a\u5305\u542b\u6240\u6709\u8868\u7684\u6570\u636e\u3002\u5f53innodb_file_per_table\u9009\u9879\u6253\u5f00\u7684\u8bdd\uff0c\u65b0\u521b\u5efa\u8868\u7684\u6570\u636e\u548c\u7d22\u5f15\u5219\u4e0d\u4f1a\u5b58\u5728\u7cfb\u7edf\u8868\u7a7a\u95f4\u4e2d\uff0c\u800c\u662f\u5b58\u653e\u5728\u5404\u81ea\u8868\u7684.ibd\u6587\u4ef6\u4e2d.\u663e\u7136\u8fd9\u4e2a\u6587\u4ef6\u4f1a\u8d8a\u6765\u8d8a\u5927\uff0cinnodb_autoextend_increment\u9009\u9879\u5219\u6307\u5b9a\u4e86\u8be5\u6587\u4ef6\u6bcf\u6b21\u81ea\u52a8\u589e\u957f\u7684\u6b65\u8fdb\uff0c\u9ed8\u8ba4\u662f8M.</p>"},{"location":"undo-log/#ibdata1_1","title":"\u662f\u4ec0\u4e48\u539f\u56e0\u5bfc\u81f4ibdata1\u6587\u4ef6\u4f1a\u8d8a\u6765\u8d8a\u5927\uff1f","text":"<p>ibdata1\u5b58\u653e\u6570\u636e\uff0c\u7d22\u5f15\u548c\u7f13\u5b58\u7b49\uff0c\u662fMYSQL\u7684\u6700\u4e3b\u8981\u7684\u6570\u636e\u3002\u6240\u4ee5\u968f\u7740\u6570\u636e\u5e93\u8d8a\u6765\u8d8a\u5927\uff0c\u8868\u4e5f\u4f1a\u8d8a\u5927\uff0c\u8fd9\u4e2a\u65e0\u6cd5\u907f\u514d\u7684\u3002\u5982\u679c\u65f6\u95f4\u957f\u4e86\uff0c\u8d8a\u6765\u8d8a\u5927\uff0c\u6211\u4eec\u5728\u5904\u7406\u65e5\u5fd7\u548c\u7a7a\u95f4\u7684\u65f6\u5019\u5c31\u4e0d\u662f\u90a3\u4e48\u65b9\u4fbf\u4e86\uff0c\u5c31\u4e0d\u77e5\u4ece\u4f55\u5165\u624b\u4e86\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u8981\u5904\u7406\u4e0b\u8fd9\u6837\u7684\u60c5\u51b5\uff0c\u5206\u5e93\u5b58\u50a8\u6570\u636e\u3002</p>"},{"location":"undo-log/#_1","title":"\u8be5\u5982\u4f55\u5904\u7406\u5462\uff1f","text":"<p>\u9996\u5148\u6211\u4eec\u628a\u6570\u636e\u5e93\u6587\u4ef6\u5907\u4efd\u4e0b\u6765\uff0c\u7136\u540e\u76f4\u63a5\u5220\u9664ibdata\u6587\u4ef6\uff08\u4e3a\u4e86\u4fdd\u9669\u8d77\u89c1\u6700\u597d\u5148\u5168\u5907\u4e00\u6b21\uff0c\u505a\u5230\u6570\u636e\u5b89\u5168\u548c\u5b8c\u6574\uff09\uff0c\u7136\u540e\u518d\u91cd\u65b0\u5bfc\u5165\u6570\u636e\u5e93\u6587\u4ef6\u5373\u53ef\uff01</p>"},{"location":"undo-log/#_2","title":"\u5177\u4f53\u64cd\u4f5c\u6b65\u9aa4\u5982\u4e0b(\u622a\u56fe\u5e76\u4e0d\u5b8c\u6574\uff0c\u4f46\u662f\u9996\u5148\u8981\u5f04\u61c2\u5927\u6982\u60c5\u51b5\u548c\u539f\u7406)\uff1a","text":"<ul> <li> \u64cd\u4f5c\u6b65\u9aa4 <pre><code>1\u3001\u505c\u6b62\u4e1a\u52a1\uff0c\u5907\u4efd\u4e00\u6b21\u5168\u5e93\n\nmysqldump -uroot -ppassword --all-databases --add-dorp-table &gt; /root/all_mysql.sql\n\n2\u3001\u5907\u4efd\u5b8c\u6210\uff0c\u505c\u6b62\u6570\u636e\u5e93\n\nsystemctl stop mariadb \u6216\u8005 service mysqld stop\n\n3\u3001\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\n\n\u5728[mysqld]\u4e0b\u589e\u52a0\u4e0b\u9762\u914d\u7f6e innodb_file_per_table=1 \u9a8c\u8bc1\u914d\u7f6e\u662f\u5426\u751f\u6548\uff0c\u53ef\u4ee5\u91cd\u542fmysql\u540e,\u6267\u884c #service mysqld restart\n4\u3001\u9a8c\u8bc1\n\nmysql -uroot -ppassword\nshow variables like '%per_table%';\n5\u3001\u5220\u9664ibdata1\u6587\u4ef6\u548c\u65e5\u5fd7\n\nrm -rf ibdata1\nrm -rf ib_logfile*\n\n6\u3001\u8fd8\u539f\u6570\u636e\u5e93\n\nmysql -uuser -ppassword\nsource /root/all_mysql.sql\n</code></pre> </li> </ul> <p>\u6570\u636e\u6587\u4ef6\u5355\u72ec\u5b58\u653e(\u5171\u4eab\u8868\u7a7a\u95f4\u6539\u4e3a\u6bcf\u4e2a\u8868\u72ec\u7acb\u7684\u8868\u7a7a\u95f4\u6587\u4ef6)\u3002</p> <ul> <li> <p>\u60f3\u8981\u5c06\u5171\u4eab\u8868\u7a7a\u95f4\u8f6c\u5316\u4e3a\u72ec\u7acb\u8868\u7a7a\u95f4\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a</p> <ul> <li>\u5148\u903b\u8f91\u5907\u4efd\uff0c\u4e4b\u540e\u5220\u9664\u6240\u6709\u6570\u636e\u5e93\u5173\u95edmysql\u670d\u52a1\uff0c\u5220\u9664idbdata1\u53caid_logfile0\u8ddfid_logfile1\u6587\u4ef6\uff0c\u7136\u540e\u4fee\u6539\u914d\u7f6e\u6587\u4ef6my.cnf\u4e2d\u7684\u53c2\u6570innodb_file_per_table\u53c2\u6570\u4e3a1\uff0c\u91cd\u542f\u670d\u52a1\u540e\u5c06\u903b\u8f91\u5907\u4efd\u5bfc\u5165\u5373\u53ef\u3002</li> <li>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6my.cnf\u4e2d\u7684\u53c2\u6570innodb_file_per_table\u53c2\u6570\u4e3a1\uff0c\u91cd\u542f\u670d\u52a1\u540e\u5c06\u9700\u8981\u4fee\u6539\u7684\u6240\u6709innodb\u8868\u90fd\u6267\u884c\u4e00\u904d\uff1aalter table table_name engine=innodb;</li> </ul> <p>\u4f7f\u7528\u7b2c\u4e8c\u79cd\u65b9\u5f0f\u4fee\u6539\u540e\uff0c\u539f\u6765\u5e93\u4e2d\u7684\u8868\u4e2d\u7684\u6570\u636e\u4f1a\u7ee7\u7eed\u5b58\u653e\u4e8eibdata1\u4e2d\uff0c\u65b0\u5efa\u7684\u8868\u624d\u4f1a\u4f7f\u7528\u72ec\u7acb\u8868\u7a7a\u95f4 \u53c2\u8003\uff1ahttps://www.cnblogs.com/mikeguan/p/8018531.html</p> </li> </ul>"},{"location":"undo-log/#mysql-ibdata1-innodb_undo_tablespaces","title":"MYSQL ibdata1 \u548c innodb_undo_tablespaces","text":"<ul> <li>https://www.dazhuanlan.com/driving365/topics/1494848</li> <li>https://blog.51cto.com/u_14286115/3323550?b=totalstatistic</li> </ul>"},{"location":"undo-log/#ibdata1_2","title":"ibdata1 \u662f\u4ec0\u4e48","text":"<p>\u770b\u4e0b\u5b98\u65b9\u89e3\u91ca\uff1a https://dev.mysql.com/doc/refman/5.7/en/innodb-system-tablespace.html</p> <pre><code>The system tablespace is the storage area for the InnoDB data dictionary, the doublewrite buffer, the change buffer, and undo logs. It may also contain table and index data if tables are created in the system tablespace rather than file-per-table or general tablespaces.\n</code></pre> <p>\u7cfb\u7edf\u8868\u7a7a\u95f4\u662f\u5b58\u50a8 innodb \u6570\u636e\u5b57\u5178\uff0c\u53cc\u5199\u7f13\u51b2\u533a\uff0c\u53d8\u66f4\u7f13\u51b2\u533a\uff0c\u64a4\u9500\u65e5\u5fd7\u7684\u5730\u65b9\u3002 \u5982\u679c\u662f\u5728\u7cfb\u7edf\u8868\u7a7a\u95f4\u521b\u5efa\u7684 table\uff0c\u90a3\u4e48 ta \u7684\u8868\u6570\u636e\uff0c\u7d22\u5f15\u6570\u636e\u4e5f\u4f1a\u5728\u8fd9\u4e2a\u5730\u65b9.</p> <pre><code>The system tablespace can have one or more data files. By default, a single system tablespace data file, named ibdata1, is created in the data directory.\n</code></pre> <p>\u7cfb\u7edf\u8868\u7a7a\u95f4\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u6570\u636e\u6587\u4ef6\uff0c\u9ed8\u8ba4\u53ea\u6709\u4e00\u4e2a\u6570\u636e\u6587\u4ef6ibdata1. \u5728\u6570\u636e\u76ee\u5f55\u4e0b</p> <p>MYSQL \u63d0\u4f9b\u4e86\u5de5\u5177 innochecksum \u53ef\u4ee5\u67e5\u770b ibdata1 \u6587\u4ef6\u7684\u5185\u5bb9\u3002</p> <pre><code>innochecksum -S ibdata1\n</code></pre> <ul> <li> \u8f93\u51fa\u4e3a \u53ef\u4ee5\u770b\u51fa undo log page \u5360\u4e86\u7edd\u5927\u90e8\u5206\u3002 <pre><code>File::ibdata1\n================PAGE TYPE SUMMARY==============\n#PAGE_COUNT PAGE_TYPE\n===============================================\n88    Index page\n  104221    Undo log page\n      12    Inode page\n       0    Insert buffer free list page\n    2808    Freshly allocated page\n      14    Insert buffer bitmap\n      98    System page\n       1    Transaction system page\n       8    File Space Header\n       6    Extent descriptor page\n       8    BLOB page\n       0    Compressed BLOB page\n       0    Other type of page\n===============================================\nAdditional information:\nUndo page type: 104171 insert, 50 update, 0 other\nUndo page state: 0 active, 157 cached, 2 to_free, 0 to_purge, 0 prepared, 104062 other\n</code></pre> </li> </ul>"},{"location":"undo-log/#ibdata1-undo-log","title":"ibdata1 \u4e2d undo log \u4e3a\u4ec0\u4e48\u4f1a\u6709\u5982\u6b64\u591a\u5462 ?","text":"<p>indo log \u7684\u4f5c\u7528\u662f \u56de\u6eda \u4ee5\u53ca\u652f\u6301 MMVC\uff08mluti-version concurrency control\uff09\u5373\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\u3002</p> <p>\u7b80\u5355\u6765\u8bf4\u5c31\u662f: \u4e24\u4e2a\u4e8b\u52a1 \u4e00\u4e2a\u5728\u66f4\u65b0\uff0c\u4e00\u4e2a\u5728\u67e5\u8be2\u3002 \u4e3a\u4e86\u9632\u6b62\u67e5\u8be2\u7684\u4e8b\u52a1\u8bfb\u5230\u810f\u6570\u636e\u6216\u8005\u66f4\u65b0\u4e00\u822c\u7684\u6570\u636e\uff0c\u66f4\u65b0\u7684\u64cd\u4f5c\u4f1a\u5728\u6570\u636e\u4e0a\u6392\u5b83\u9501\uff0c\u5728\u66f4\u65b0\u4e8b\u52a1\u672a\u5b8c\u6210\u524d\u5bf9\u5176\u4ed6\u4e8b\u52a1\u4e0d\u53ef\u89c1\u3002 \u8fd9\u65f6\u5019\u67e5\u8be2\u4e8b\u52a1\u8bfb\u5230\u7684\u6570\u636e \u5176\u5b9e\u662f\u6570\u636e\u7684\u4e00\u4e2a\u5feb\u7167 (\u901a\u8fc7 undo \u8bfb\u53d6\u67d0\u4e2a\u7248\u672c)\u3002MVVC \u5c31\u662f\u540c\u4e00\u4efd\u6570\u636e\u4e34\u65f6\u4fdd\u7559\u591a\u7248\u672c\u7684\u4e00\u79cd\u65b9\u5f0f\uff0c\u8fdb\u800c\u5b9e\u73b0\u5e76\u53d1\u63a7\u5236</p> <p>\u5728\u8fd9\u6837\u7684\u80cc\u666f\u4e0b\uff0c\u5982\u679c\u4e00\u4e2a\u67e5\u8be2\u64cd\u4f5c\u6267\u884c\u4e86\u5f88\u957f\u7684\u65f6\u95f4\uff0c\u90a3\u4e48\u6570\u636e\u5e93\u9700\u8981\u7ef4\u62a4\u957f\u65f6\u95f4\u7684 undo log.</p> <p>\u901a\u8fc7\u4e0b\u9762\u7684 MYSQL \u547d\u4ee4\u67e5\u627e\u6570\u636e\u5e93\u7684\u72b6\u6001</p> <pre><code>SHOW ENGINE INNODB STATUS/G;\n\n---TRANSACTION 36E, ACTIVE 1256288 sec\nMySQL thread id 42, OS thread handle 0x7f8baaccc700, query id 7900290 localhost root\nshow engine innodb status\nTrx read view will not see trx with id &gt;= 36F, sees &lt; 36F\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u8fd9\u6761 query \u6267\u884c\u4e86 14 \u5929\u8fd8\u6ca1\u6709\u7ed3\u675f\u3002\u9700\u8981\u5728 undo log \u4e2d\u7ef4\u62a4\u65e7\u6570\u636e\u9875\u4ee5\u4fdd\u969c\u6570\u636e\u4e00\u81f4\u6027\u89c6\u56fe\u3002\u5982\u679c\u5728\u8fd9\u6bb5\u65f6\u95f4\u6570\u636e\u5e93\u6709\u5927\u91cf\u5199\u5165\u4efb\u52a1\uff0c\u5c31\u610f\u5473\u7740\u5b58\u50a8\u4e86\u5927\u91cf\u7684 undo log</p> <p>\u5728\u95ee\u9898\u53d1\u751f\u65f6\uff0c\u6211\u4eec\u4e5f\u662f\u901a\u8fc7</p> <pre><code>use information_schema;\nselect * from INNODB_TRXG;\n</code></pre> <p>\u627e\u5230\u4e8b\u52a1\u7684 trx_mysql_thread_id \u5e76</p> <pre><code>kill &lt;trx_mysql_thread_id&gt;\n</code></pre> <p>\u6765\u6740\u6389\u957f\u67e5\u8be2\u6765\u505c\u6b62 ibdata1 \u4e0d\u65ad\u589e\u957f\u7684\u3002</p>"},{"location":"undo-log/#_3","title":"\u5982\u4f55\u89e3\u51b3","text":"<ol> <li> <p>\u5982\u4f55\u963b\u6b62 ibdata1 \u4e0d\u65ad\u589e\u957f \u6740\u6389\u957f\u65f6\u95f4\u672a\u7ed3\u675f\u7684\u4e8b\u52a1,\u6765\u963b\u6b62 ibdata1 \u7684\u4e0d\u65ad\u53d8\u5927. \u4f46\u8fd9\u5e76\u4e0d\u80fd\u51cf\u5c0f ibdata1 \u7684\u5927\u5c0f. MYSQL innoDB \u8868\u7a7a\u95f4\u4ece\u4e0d\u6536\u7f29(\u53c2\u8003 MYSQL ibdata1), \u5373\u4fbf\u4f60\u5220\u9664\u6570\u636e, ibdata1 \u4e2d undo log \u9875\u4e5f\u53ea\u662f\u6807\u8bb0\u4e3a\u5df2\u5220\u9664\u7a0d\u5fae\u91cd\u7528. \u4f46\u4e0d\u4f1a\u91ca\u653e\u8fd9\u4e9b\u7a7a\u95f4\u7ed9\u64cd\u4f5c\u7cfb\u7edf.</p> </li> <li> <p>\u5982\u4f55\u56de\u6536\u8868\u7a7a\u95f4 \u5982\u4e0a\u6240\u8ff0, MYSQL \u8868\u7a7a\u95f4\u4ece\u4e0d\u6536\u7f29, \u9664\u975e\u7528\u65b0\u7684 ibdata1 \u542f\u52a8\u6570\u636e\u5e93. \u4e5f\u5c31\u662f\u8bf4\u8981 mysqldump \u505a\u4e00\u4e2a\u903b\u8f91\u5168\u5907\u4efd, \u7136\u540e\u505c\u6b62 MYSQL, \u5220\u9664\u6240\u6709\u6570\u636e\u5e93, ib_logfile ibdata1 \u7b49\u6587\u4ef6. \u5f53\u4f60\u91cd\u65b0\u542f\u52a8\u6570\u636e\u5e93\u65f6\u4f1a\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684 ibdata1. \u7136\u540e\u6062\u590d\u903b\u8f91\u5907\u4efd.</p> </li> <li> <p>\u5982\u4f55\u907f\u514d\u540e\u7eed\u518d\u53d1\u751f\u6b64\u7c7b\u4e8b\u4ef6\u5417 \u5982\u679c\u5df2\u7ecf\u53d1\u751f ibdata1 \u56e0\u4e3a undo log \u8fc7\u5927\u7684\u95ee\u9898,\u90a3\u4e48\u9664\u4e86\u5220\u9664\u6570\u636e\u6587\u4ef6\u91cd\u65b0\u542f\u52a8\u6ca1\u6709\u66f4\u597d\u7684\u529e\u6cd5,</p> </li> </ol> <p>\u4f46\u662f\u4ece MYSQL5.6 \u7248\u672c\u540e \u53ef\u4ee5\u901a\u8fc7 \u521b\u5efa\u5916\u90e8 undo log \u8868\u7a7a\u95f4 \u4ece\u800c\u5176\u4ece ibdata1 \u4e2d\u5206\u79bb\u5904\u6765, \u5e76\u8bbe\u7f6e\u76f8\u5e94\u53c2\u6570\u6765\u89c4\u5b9a undo log \u7684\u6700\u5927 size \u7b49\u624b\u6bb5\u6765\u8fbe\u5230\u5728\u7ebf\u6e05\u9664 undo \u8868\u7a7a\u95f4</p> <ul> <li>innodb_undo_directory \u6307\u5b9a\u5355\u72ec\u5b58\u653e undo \u8868\u7a7a\u95f4\u7684\u76ee\u5f55</li> <li>innodb_undo_tablespaces \u6307\u5b9a\u5355\u72ec\u5b58\u653e undo \u8868\u7a7a\u95f4\u7684\u4e2a\u6570. \u5982\u679c\u8bbe\u7f6e\u4e3a 3\uff0c\u5219 undo \u8868\u7a7a\u95f4\u4e3a undo001\u3001undo002\u3001undo003</li> <li>innodb_undo_logs \u6307\u5b9a\u56de\u6eda\u6bb5\u7684\u4e2a\u6570\uff08\u65e9\u671f\u7248\u672c\u8be5\u53c2\u6570\u540d\u5b57\u662f innodb_rollback_segments\uff09\uff0c\u9ed8\u8ba4 128 \u4e2a\u3002\u6bcf\u4e2a\u56de\u6eda\u6bb5\u53ef\u540c\u65f6\u652f\u6301 1024 \u4e2a\u5728\u7ebf\u4e8b\u52a1\u3002\u8fd9\u4e9b\u56de\u6eda\u6bb5\u4f1a\u5e73\u5747\u5206\u5e03\u5230\u5404\u4e2a undo \u8868\u7a7a\u95f4\u4e2d\u3002\u8be5\u53d8\u91cf\u53ef\u4ee5\u52a8\u6001\u8c03\u6574\uff0c\u4f46\u662f\u7269\u7406\u4e0a\u7684\u56de\u6eda\u6bb5\u4e0d\u4f1a\u51cf\u5c11\uff0c\u53ea\u662f\u4f1a\u63a7\u5236\u7528\u5230\u7684\u56de\u6eda\u6bb5\u7684\u4e2a\u6570\u3002</li> <li>innodb_max_undo_log_size\uff0cundo \u8868\u7a7a\u95f4\u6587\u4ef6\u8d85\u8fc7\u6b64\u503c\u5373\u6807\u8bb0\u4e3a\u53ef\u6536\u7f29\uff0c\u9ed8\u8ba4 1G\uff0c\u53ef\u5728\u7ebf\u4fee\u6539\uff1b</li> <li>innodb_purge_rseg_truncate_frequency,\u6307\u5b9a purge \u64cd\u4f5c\u88ab\u5524\u8d77\u591a\u5c11\u6b21\u4e4b\u540e\u624d\u91ca\u653e rollback segments\u3002\u5f53 undo \u8868\u7a7a\u95f4\u91cc\u9762\u7684 rollback segments \u88ab\u91ca\u653e\u65f6\uff0cundo \u8868\u7a7a\u95f4\u624d\u4f1a\u88ab truncate\u3002\u7531\u6b64\u53ef\u89c1\uff0c\u8be5\u53c2\u6570\u8d8a\u5c0f\uff0cundo \u8868\u7a7a\u95f4\u88ab\u5c1d\u8bd5 truncate \u7684\u9891\u7387\u8d8a\u9ad8\u3002</li> </ul> <p>\u540e\u8bb0: \u8fd9\u4e2a\u95ee\u9898\u6700\u540e\u7684\u89e3\u51b3\u529e\u6cd5 \u6b63\u662f</p> <ul> <li>\u5148\u6740\u6389\u8017\u65f6\u957f\u7684\u4e8b\u52a1</li> <li>\u5907\u4efd\u6570\u636e, \u5220\u9664\u6570\u636e\u5e93\u6587\u4ef6</li> <li>\u589e\u52a0 innodb_undo_tablespaces \u7b49\u53c2\u6570\u5230\u6570\u636e\u5e93\u914d\u7f6e\u6587\u4ef6\u4e2d. \u91cd\u542f\u6570\u636e\u5e93. \u5bfc\u5165\u6570\u636e.</li> </ul>"},{"location":"undo-log/#undo-log_1","title":"undo log\u5728\u7ebf\u6536\u7f29\u65b0\u7279\u6027","text":"<ul> <li>https://blog.51cto.com/u_14286115/3323550?b=totalstatistic</li> </ul>"},{"location":"undo-log/#part1","title":"Part1:\u5199\u5728\u6700\u524d","text":"<p>\u5728MysQL5.6\u7248\u672c\u4e2d\uff0c\u53ef\u4ee5\u628aundo log \u56de\u6eda\u65e5\u5fd7\u5206\u79bb\u5230\u4e00\u4e2a\u5355\u72ec\u7684\u8868\u7a7a\u95f4\u91cc\uff1b\u5176\u7f3a\u70b9\u662f\u4e0d\u80fd\u56de\u6536\u7a7a\u95f4\u5927\u5c0f\uff0cuntil MysQL5.7\uff0cbut MariadDB10.1\u6682\u4e0d\u652f\u6301\u3002</p> <p>\u672c\u6587\u4ecb\u7ecd\u5e76\u6f14\u793aMysQL5.7\u662f\u5982\u4f55\u5728\u7ebf\u6536\u7f29undo log\u7684\u3002</p> <p>\u2460\u9996\u5148\u6211\u4eec\u9700\u8981\u8c03\u6574my.cnf\u53c2\u6570</p> <pre><code>innodb_undo_directory=/data/undolog\ninnodb_undo_tablespaces=4\ninnodb_undo_logs=128\ninnodb_max_undo_log_size=1G\ninnodb_purge_rseg_truncate_frequency\ninnodb_undo_log_truncate=1\n</code></pre> <p>Warning:\u8b66\u544a</p> <p>\u5176\u4e2dinnodb_undo_directory\u53c2\u6570\u8981\u5728\u6570\u636e\u5e93\u521d\u59cb\u5316\u65f6\u5c31\u9700\u8981\u5199\u5165my.cnf\uff0c\u5426\u5219\u4f1a\u62a5\u5982\u4e0b\u9519\u8bef\uff1a</p> Warning <p>Expected to open 4 undo tablespaces but was able to find only 0 undo tablespaces. Set the innodb_undo_tablespaces parameter to the correct value and retry. Suggested value is 0</p>"},{"location":"undo-log/#part2mysql57undolog","title":"Part2:MySQL5.7\u5728\u7ebf\u56de\u6536undolog","text":"<p>\u2460\u9996\u5148\u5bf9\u4e00\u5f20100\u4e07\u884c\u7684\u8868\u8fdb\u884c\u6574\u8868\u66f4\u65b0</p> <pre><code>mysql&gt;\u00a0show\u00a0variables\u00a0like\u00a0'innodb_undo%';\n+--------------------------+---------------+\n|\u00a0Variable_name\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\u00a0Value\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n+--------------------------+---------------+\n|\u00a0innodb_undo_directory\u00a0\u00a0\u00a0\u00a0|\u00a0/data/undolog\u00a0|\n|\u00a0innodb_undo_log_truncate\u00a0|\u00a0ON\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n|\u00a0innodb_undo_logs\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\u00a0128\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n|\u00a0innodb_undo_tablespaces\u00a0\u00a0|\u00a04\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0|\n+--------------------------+---------------+\n4\u00a0rows\u00a0in\u00a0set\u00a0(0.00\u00a0sec)\nmysql&gt;\u00a0update\u00a0helei\u00a0set\u00a0c1=1;\nQuery\u00a0OK,\u00a01000000\u00a0rows\u00a0affected\u00a0(45.48\u00a0sec)\nRows\u00a0matched:\u00a01000000\u00a0\u00a0Changed:\u00a01000000\u00a0\u00a0Warnings:\u00a00\nmysql&gt;\u00a0update\u00a0helei\u00a0set\u00a0c2=222;\nQuery\u00a0OK,\u00a01000000\u00a0rows\u00a0affected\u00a0(43.25\u00a0sec)\nRows\u00a0matched:\u00a01000000\u00a0\u00a0Changed:\u00a01000000\u00a0\u00a0Warnings:\u00a00\nmysql&gt;\u00a0update\u00a0helei\u00a0set\u00a0c4='heleiheleiheleiheleihel';\nQuery\u00a0OK,\u00a01000000\u00a0rows\u00a0affected\u00a0(10.28\u00a0sec)\nRows\u00a0matched:\u00a01000000\u00a0\u00a0Changed:\u00a01000000\u00a0\u00a0Warnings:\u00a00\n</code></pre> <p>\u2461\u6ce8\u610fundolog\u7684\u65e5\u5fd7\u5927\u5c0f</p> <pre><code>[root@HE3 undolog]# ls -lshrt\ntotal 412M\n128M -rw-r----- 1 mysql mysql 128M Sep 26 16:56 undo004\n\u00a076M -rw-r----- 1 mysql mysql \u00a076M Sep 26 16:56 undo003\n136M -rw-r----- 1 mysql mysql 136M Sep 26 16:56 undo001\n\u00a072M -rw-r----- 1 mysql mysql \u00a072M Sep 26 16:56 undo002\n</code></pre> <p>\u2462error.log\u65e5\u5fd7</p> <pre><code>2016-09-26T23:51:06.062828Z\u00a00\u00a0[Note]\u00a0InnoDB:\u00a0Truncating\u00a0UNDO\u00a0tablespace\u00a0with\u00a0space\u00a0identifier\u00a01\n2016-09-26T23:51:06.159077Z\u00a00\u00a0[Note]\u00a0InnoDB:\u00a0Completed\u00a0truncate\u00a0of\u00a0UNDO\u00a0tablespace\u00a0with\u00a0space\u00a0identifier\u00a01\n2016-09-26T23:51:06.159101Z\u00a00\u00a0[Note]\u00a0InnoDB:\u00a0Truncating\u00a0UNDO\u00a0tablespace\u00a0with\u00a0space\u00a0identifier\u00a02\n2016-09-26T23:51:06.242355Z\u00a00\u00a0[Note]\u00a0InnoDB:\u00a0Completed\u00a0truncate\u00a0of\u00a0UNDO\u00a0tablespace\u00a0with\u00a0space\u00a0identifier\u00a02\n2016-09-26T23:51:06.242378Z\u00a00\u00a0[Note]\u00a0InnoDB:\u00a0Truncating\u00a0UNDO\u00a0tablespace\u00a0with\u00a0space\u00a0identifier\u00a03\n2016-09-26T23:51:06.313036Z\u00a00\u00a0[Note]\u00a0InnoDB:\u00a0Completed\u00a0truncate\u00a0of\u00a0UNDO\u00a0tablespace\u00a0with\u00a0space\u00a0identifier\u00a03\n2016-09-26T23:51:06.313060Z\u00a00\u00a0[Note]\u00a0InnoDB:\u00a0Truncating\u00a0UNDO\u00a0tablespace\u00a0with\u00a0space\u00a0identifier\u00a04\n2016-09-26T23:51:06.403003Z\u00a00\u00a0[Note]\u00a0InnoDB:\u00a0Completed\u00a0truncate\u00a0of\u00a0UNDO\u00a0tablespace\u00a0with\u00a0space\u00a0identifier\u00a04\n</code></pre> <p>\u2463\u89c2\u5bdf\u7269\u7406\u6587\u4ef6</p> <pre><code>[root@HE3 undolog]# ls -lshrt\ntotal 168M\n76M -rw-r----- 1 mysql mysql 76M Sep 26 16:56 undo003\n10M -rw-r----- 1 mysql mysql 10M Sep 26 16:56 undo001\n10M -rw-r----- 1 mysql mysql 10M Sep 26 16:56 undo004\n72M -rw-r----- 1 mysql mysql 72M Sep 26 16:56 undo002\n\u53ef\u4ee5\u770b\u5230\u8d85\u8fc7100M\u8bbe\u5b9a\u503c\u7684undo\u65e5\u5fd7\u5df2\u7ecf\u56de\u6536\uff0c\u9ed8\u8ba4\u4e3a10M\uff0cundo log\u7a7a\u95f4\u5f97\u4ee5\u91ca\u653e\n</code></pre>"},{"location":"undo-log/#part3","title":"Part3:\u610f\u4e49","text":"<p>\u8be5\u529f\u80fd\u964d\u4f4e\u4e86\u78c1\u76d8\u7684\u4f7f\u7528\u7387\uff0c\u5e76\u4e14\u53ef\u4ee5\u63d0\u9ad8\u8bf8\u5982Xtrabackup\u8fd9\u7c7b\u7269\u7406\u5907\u4efd\u8f6f\u4ef6\u7684\u5907\u4efd\u901f\u5ea6\u3002</p>"},{"location":"undo-log/#innodb_undo_logs","title":"innodb_undo_logs","text":"<ul> <li>https://dev.mysql.com/doc/refman/5.6/ja/innodb-undo-tablespace.html (\u65e5\u672c\u8a9e)</li> <li>https://dev.mysql.com/doc/refman/5.7/en/innodb-undo-tablespaces.html</li> <li>https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_undo_directory</li> <li>https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_undo_tablespaces</li> </ul>"},{"location":"undo-log/#_4","title":"\u8a2d\u5b9a","text":"<pre><code>innodb_undo_tablespaces=2\ninnodb_rollback_segments=128\ninnodb_max_undo_log_size=512M\ninnodb_undo_log_truncate=1\n</code></pre> <ul> <li>innodb_purge_rseg_truncate_frequency\u306f\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u8abf\u6574\u3059\u308b\u3002<ul> <li>\u6570\u5b57\u5c0f\u3055\u3044\u307b\u3069undo_log\u56de\u53ce\u983b\u5ea6\u304c\u9ad8\u304f\u3001IO\u8ca0\u8377\u9ad8\u3044\u3002</li> <li>https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_purge_rseg_truncate_frequency</li> </ul> </li> <li>innodb_undo_tablespaces\u306fmysql8\u3067\u5c06\u6765\u524a\u9664\u4e88\u5b9a\u3067\u3059\u3002undo_tables\u3092\uff12\u306b\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002MS\u3067\u3042\u308c\u3070\uff12\u3064\u3067\u5341\u5206\u3068\u8003\u3048\u3089\u308c\u307e\u3059\u3002<ul> <li>https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_undo_tablespaces</li> <li>https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_undo_tablespaces</li> </ul> </li> <li>innodb_rollback_segments\u3000innodb_undo_logs \u306f\u524a\u9664\u4e88\u5b9a\u306e\u305f\u3081\u975e\u63a8\u5968\u3068\u8a18\u8f09\u304c\u3042\u308a\u30015.7\u3067\u306f innodb_rollback_segments \u306e\u4f7f\u7528\u3059\u308b\u3088\u3046\u6307\u5b9a\u304c\u3042\u308a\u307e\u3059\u3002<ul> <li>innodb_undo_logs \u3092\u524a\u9664\u3057\u307e\u3059\u3002innodb_rollback_segments\u3092\u5909\u308f\u308a\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002<ul> <li>https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_undo_logs</li> </ul> </li> <li>\u4eca\u5f8c\u306e\u30de\u30a4\u30ca\u30fc\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u6642\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306e128\u304c\u5909\u66f4\u3059\u308b\u53ef\u80fd\u6027\u3042\u308b\u306e\u3067\u3001\u660e\u793a\u7684\u306b128\u3092\u6307\u5b9a\u3059\u308b\u3002</li> </ul> </li> </ul>"},{"location":"undo-log/#_5","title":"\u691c\u8a3c\u7528\u30c6\u30fc\u30d6\u30eb\u306e\u4f5c\u6210","text":"create table <pre><code>-- \u30c6\u30fc\u30d6\u30eb\u306e\u4f5c\u6210\ncreate table usertb(\nid serial,\nuname varchar(20),\nucreatetime datetime,\nage int(11))\nengine=innodb\ndefault character set=utf8mb4\nauto_increment=1\nrow_format=compact;\n-- procedure\u3092\u4f5c\u6210\ndelimiter $$\nset autocommit = 0$$\ncreate procedure test1()\nbegin\ndeclare v_cnt decimal(10) default 0;\ndd:loop\ninsert into usertb values\n(null, '\u30e6\u30fc\u30b61','2022-11-20 00:00:00', 20),\n(null, '\u30e6\u30fc\u30b62','2022-11-20 00:00:00', 20),\n(null, '\u30e6\u30fc\u30b63','2022-11-20 00:00:00', 20),\n(null, '\u30e6\u30fc\u30b64','2022-11-20 00:00:00', 20),\n(null, '\u30e6\u30fc\u30b65','2022-11-20 00:00:00', 20),\n(null, '\u30e6\u30fc\u30b66','2022-11-22 00:00:00', 20),\n(null, '\u30e6\u30fc\u30b67','2022-11-22 00:00:00', 20),\n(null, '\u30e6\u30fc\u30b68','2022-11-22 00:00:00', 20),\n(null, '\u30e6\u30fc\u30b69','2022-11-22 00:00:00', 20),\n(null, '\u30e6\u30fc\u30b60','2022-11-22 00:00:00', 20);\ncommit;\nset v_cnt = v_cnt+10;\nif v_cnt = 10000000 then leave dd;\nend if;\nend loop dd;\nend;$$\ndelimiter ;\n-- procedure\u3092\u5b9f\u884c\ncall test1;\n-- \u30c6\u30fc\u30d6\u30eb\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u5909\u66f4\nuse sbtest;\nupdate usertb set age=99;\n-- engine\u3092\u5909\u66f4\u3057\u305f\u3044\u5834\u5408\nalter table usertb engine=myisam\n</code></pre>"},{"location":"undo-log/#undo_log","title":"undo_log\u306e\u5909\u5316","text":"undo_log\u306e\u5909\u5316 <pre><code>[root@ backup]# while true; do echo '###############################################';  date;  ll /home/mysql/undo00*; mysql -e \"SELECT TABLESPACE_NAME,FILE_NAME,FREE_EXTENTS,TOTAL_EXTENTS,AUTOEXTEND_SIZE,DATA_FREE FROM INFORMATION_SCHEMA.FILES WHERE FILE_TYPE LIKE 'UNDO LOG';\"; sleep 2; done\nTue Nov 22 15:07:11 JST 2022\n-rw-r----- 1 mysql mysql 780M Nov 22 15:01 /home/mysql/undo001\n-rw-r----- 1 mysql mysql  10M Nov 22 14:55 /home/mysql/undo002\n+-----------------+------------+--------------+---------------+-----------------+-----------+\n| TABLESPACE_NAME | FILE_NAME  | FREE_EXTENTS | TOTAL_EXTENTS | AUTOEXTEND_SIZE | DATA_FREE |\n+-----------------+------------+--------------+---------------+-----------------+-----------+\n| innodb_undo001  | .//undo001 |            0 |           780 |         4194304 |         0 |\n| innodb_undo002  | .//undo002 |            3 |            10 |         1048576 |   5242880 |\n+-----------------+------------+--------------+---------------+-----------------+-----------+\n###############################################\nTue Nov 22 15:07:13 JST 2022\n-rw-r----- 1 mysql mysql 780M Nov 22 15:07 /home/mysql/undo001\n-rw-r----- 1 mysql mysql  10M Nov 22 14:55 /home/mysql/undo002\n+-----------------+------------+--------------+---------------+-----------------+-----------+\n| TABLESPACE_NAME | FILE_NAME  | FREE_EXTENTS | TOTAL_EXTENTS | AUTOEXTEND_SIZE | DATA_FREE |\n+-----------------+------------+--------------+---------------+-----------------+-----------+\n| innodb_undo001  | .//undo001 |           13 |           780 |         4194304 |  11534336 |\n| innodb_undo002  | .//undo002 |            3 |            10 |         1048576 |   5242880 |\n+-----------------+------------+--------------+---------------+-----------------+-----------+\n###############################################\n</code></pre>"},{"location":"undo-log/#_6","title":"\u3057\u3070\u3089\u304f\u6642\u9593\u7d4c\u904e\u3059\u308b\u3068","text":"\u3057\u3070\u3089\u304f\u6642\u9593\u7d4c\u904e\u3059\u308b <pre><code>[root@ backup]# while true; do echo '###############################################';  date;  ll /home/mysql/undo00*; mysql -e \"SELECT TABLESPACE_NAME, FILE_NAME,FREE_EXTENT\nS,TOTAL_EXTENTS,AUTOEXTEND_SIZE,DATA_FREE FROM INFORMATION_SCHEMA.FILES WHERE FILE_TYPE LIKE 'UNDO LOG';\"; sleep 2; done\n###############################################\nTue Nov 22 15:10:26 JST 2022\n-rw-r----- 1 mysql mysql 10M Nov 22 15:10 /home/mysql/undo001\n-rw-r----- 1 mysql mysql 10M Nov 22 14:55 /home/mysql/undo002\n+-----------------+------------+--------------+---------------+-----------------+-----------+\n| TABLESPACE_NAME | FILE_NAME  | FREE_EXTENTS | TOTAL_EXTENTS | AUTOEXTEND_SIZE | DATA_FREE |\n+-----------------+------------+--------------+---------------+-----------------+-----------+\n| innodb_undo001  | .//undo001 |            4 |            10 |         1048576 |   6291456 |\n| innodb_undo002  | .//undo002 |            3 |            10 |         1048576 |   5242880 |\n+-----------------+------------+--------------+---------------+-----------------+-----------+\n###############################################\nTue Nov 22 15:10:28 JST 2022\n-rw-r----- 1 mysql mysql 10M Nov 22 15:10 /home/mysql/undo001\n-rw-r----- 1 mysql mysql 10M Nov 22 14:55 /home/mysql/undo002\n+-----------------+------------+--------------+---------------+-----------------+-----------+\n| TABLESPACE_NAME | FILE_NAME  | FREE_EXTENTS | TOTAL_EXTENTS | AUTOEXTEND_SIZE | DATA_FREE |\n+-----------------+------------+--------------+---------------+-----------------+-----------+\n| innodb_undo001  | .//undo001 |            4 |            10 |         1048576 |   6291456 |\n| innodb_undo002  | .//undo002 |            3 |            10 |         1048576 |   5242880 |\n+-----------------+------------+--------------+---------------+-----------------+-----------+\n###############################################\nTue Nov 22 15:10:30 JST 2022\n-rw-r----- 1 mysql mysql 10M Nov 22 15:10 /home/mysql/undo001\n-rw-r----- 1 mysql mysql 10M Nov 22 14:55 /home/mysql/undo002\n+-----------------+------------+--------------+---------------+-----------------+-----------+\n| TABLESPACE_NAME | FILE_NAME  | FREE_EXTENTS | TOTAL_EXTENTS | AUTOEXTEND_SIZE | DATA_FREE |\n+-----------------+------------+--------------+---------------+-----------------+-----------+\n| innodb_undo001  | .//undo001 |            4 |            10 |         1048576 |   6291456 |\n| innodb_undo002  | .//undo002 |            3 |            10 |         1048576 |   5242880 |\n+-----------------+------------+--------------+---------------+-----------------+-----------+\n</code></pre>"},{"location":"vim/","title":"VIM","text":""},{"location":"vim/#build-vim","title":"build vim\u76ee\u6b21","text":"<pre><code>$ ./configure --prefix=$HOME/myetc \\\n--with-features=huge \\\n--enable-gui=gnome2 \\\n--enable-perlinterp \\\n--enable-pythoninterp \\\n--enable-python3interp \\\n--enable-fail-if-missing \\\n--disable-selinux \\\n--enable-pythoninterp=dynamic \\\n--with-python-config-dir=/home/user/.pyenv/versions/2.7.14/lib/python2.7/config \\\n--enable-python3interp=dynamic \\\n--with-python3-config-dir=/home/user/.pyenv/versions/3.6.5/lib/python3.6/config-3.6m \\\n--enable-rubyinterp=dynamic \\\n--enable-cscope \\\n--enable-fontset \\\n--enable-multibyte \\\nvi_cv_path_python3=/home/uers/.pyenv/versions/3.6.5/bin/python3.6\n\nmake\nmake install\nvim ~/.zshrc\nalias vi='~/myetc/bin/vim'\nalias vim='~/myetc/bin/vim'\n</code></pre> \u30ad\u30fc\u5165\u529b \u52d5\u4f5c vi \u30d5\u30a1\u30a4\u30eb\u540d \u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304f\uff08\u8907\u6570\u30d5\u30a1\u30a4\u30eb\u53ef\uff09 vi +n \u30d5\u30a1\u30a4\u30eb\u540d n \u884c\u76ee\u304b\u3089\u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304f vi -r \u30d5\u30a1\u30a4\u30eb\u540d \u58ca\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30ea\u30ab\u30d0\u30ea i \u30ab\u30fc\u30bd\u30eb\u306e\u5de6\u304b\u3089\u5165\u529b\u958b\u59cb I \u884c\u982d\u304b\u3089\u5165\u529b\u958b\u59cb a \u30ab\u30fc\u30bd\u30eb\u306e\u53f3\u304b\u3089\u5165\u529b\u958b\u59cb A \u884c\u672b\u304b\u3089\u5165\u529b\u958b\u59cb ZZ vi \u3092\u7d42\u4e86\uff08\u5185\u5bb9\u304c\u5909\u66f4\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306f\u4fdd\u5b58\uff09 :wq \u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u5b58\u3001vi \u3092\u7d42\u4e86 :#,# w #\u884c\u76ee\u304b\u3089#\u884c\u76ee\u307e\u3067\u3092\u4fdd\u5b58 :q vi \u3092\u7d42\u4e86\uff08\u5185\u5bb9\u304c\u5909\u66f4\u3055\u308c\u3044\u308b\u5834\u5408\u306f\u8b66\u544a\uff09 :q! vi \u3092\u5f37\u5236\u7d42\u4e86\uff08\u5185\u5bb9\u304c\u5909\u66f4\u3055\u308c\u3066\u3044\u3066\u3082\u4fdd\u5b58\u3057\u306a\u3044\uff09 :ls \u30d0\u30c3\u30d5\u30a1\u30ea\u30b9\u30c8\u306e\u8868\u793a :b \u30d0\u30c3\u30d5\u30a1 \u30d0\u30c3\u30d5\u30a1\u3092\u8868\u793a :bn \u6b21\u306e\u30d0\u30c3\u30d5\u30a1\u3092\u8868\u793a :bp \u524d\u306e\u30d0\u30c3\u30d5\u30a1\u3092\u8868\u793a [n] x \u30ab\u30fc\u30bd\u30eb\u4e0a\u306e1\u6587\u5b57\u524a\u9664 [n] X \u30ab\u30fc\u30bd\u30eb\u306e\u5de6\u306e\u6587\u5b57\u30921\u6587\u5b57\u524a\u9664 p \u30d0\u30c3\u30d5\u30a1\u5185\u306e\u30c6\u30ad\u30b9\u30c8\u3092\u633f\u5165\uff08\u6587\u5b57\u306f\u30ab\u30fc\u30bd\u30eb\u306e\u53f3\u3001\u884c\u306f\u30ab\u30fc\u30bd\u30eb\u306e\u4e0b\u306b\u633f\u5165\uff09 P \u30d0\u30c3\u30d5\u30a1\u5185\u306e\u30c6\u30ad\u30b9\u30c8\u3092\u633f\u5165\uff08\u6587\u5b57\u306f\u30ab\u30fc\u30bd\u30eb\u306e\u5de6\u3001\u884c\u306f\u30ab\u30fc\u30bd\u30eb\u306e\u4e0a\u306b\u633f\u5165\uff09 :r [\u30d5\u30a1\u30a4\u30eb\u540d] \u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u3092\u633f\u5165\u3059\u308b [n] d  \u76ee\u7684\u8a9e \\ d [n] \u76ee\u7684\u8a9e \u76ee\u7684\u8a9e\u4e00\u89a7: ::: w - \u30ab\u30fc\u30bd\u30eb\u4f4d\u7f6e\u304b\u3089\u7a7a\u767d\u3092\u542b\u3080\u5358\u8a9e\u306e\u672b\u5c3e\u307e\u3067\u524a\u9664 ::: e - \u30ab\u30fc\u30bd\u30eb\u4f4d\u7f6e\u304b\u3089\u7a7a\u767d\u3092\u542b\u307e\u306a\u3044\u5358\u8a9e\u306e\u672b\u5c3e\u307e\u3067\u524a\u9664 ::: $ - \u30ab\u30fc\u30bd\u30eb\u4f4d\u7f6e\u304b\u3089\u884c\u672b\u307e\u3067\u524a\u9664 ::: d - 1\u884c\u524a\u9664\u5207\u308a\u53d6\u308a\uff08\u30ab\u30c3\u30c8\uff09 /&lt;\u6587\u5b57\u5217&gt; \u6587\u5b57\u5217 \u3092\u691c\u7d22\u3059\u308b\uff08\u9806\u65b9\u5411\uff09 ?&lt;\u6587\u5b57\u5217&gt; \u6587\u5b57\u5217\u3092\u691c\u7d22\u3059\u308b\uff08\u9006\u65b9\u5411\uff09 n \u9806\u65b9\u5411\u3078\u691c\u7d22\u3059\u308b N \u9006\u65b9\u5411\u3078\u691c\u7d22\u3059\u308b % (,[\u306b\u5bfe\u3057\u3066\u5bfe\u5fdc\u3059\u308b ),] \u3084 } \u3092\u691c\u7d22 r \u30ab\u30fc\u30bd\u30eb\u306e\u4e0b\u306e\u6587\u5b57\u3092\u7f6e\u304d\u63db\u3048\u308b [n] c \u76ee\u7684\u8a9e \\ c [n] \u76ee\u7684\u8a9e \u76ee\u7684\u8a9e\u4e00\u89a7: ::: w - \u5358\u8a9e\u306e\u4e00\u90e8\u3092\u5909\u66f4\u3059\u308b ::: $ - \u884c\u306e\u4e00\u90e8\u3092\u5909\u66f4\u3059\u308b :s/[old]/[new] [old]\u3092[new]\u306b\u7f6e\u63db\u3059\u308b ::: \u73fe\u5728\u884c\u306e\u6700\u521d\u306e old \u3092 new \u306b\u7f6e\u63db\u3059\u308b :s/old/new ::: \u73fe\u5728\u884c\u306e\u5168\u3066\u306e old \u3092 new \u306b\u7f6e\u63db\u3059\u308b :s/old/new/g ::: 2\u3064\u306e # \u9593\u3067\u8a9e\u53e5\u3092\u7f6e\u63db\u3059\u308b :#,#s/old/new/g ::: \u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u306e\u5168\u3066\u306e\u691c\u7d22\u8a9e\u53e5\u3092\u7f6e\u63db\u3059\u308b: :%s/old/new/g ::: 'c' \u3092\u52a0\u3048\u308b\u3068\u7f6e\u63db\u306e\u5ea6\u306b\u78ba\u8a8d\u3092\u6c42\u3081\u308b :%s/old/new/gc CTRL-g \u30d5\u30a1\u30a4\u30eb\u5185\u3067\u306e\u4f4d\u7f6e\u3068\u30d5\u30a1\u30a4\u30eb\u306e\u72b6\u614b\u3092\u8868\u793a [n] Shift-g \u30d5\u30a1\u30a4\u30eb\u5185\u306en\u884c\u306b\u79fb\u52d5\uff08n\u304c\u7121\u3051\u308c\u3070\u30d5\u30a1\u30a4\u30eb\u672b\u306b\u79fb\u52d5\uff09 :sp [\u30d5\u30a1\u30a4\u30eb] \u30a6\u30a4\u30f3\u30c9\u30a6\u3092\u6a2a\u306b\u5206\u5272 :vs [\u30d5\u30a1\u30a4\u30eb] \u30a6\u30a4\u30f3\u30c9\u30a6\u3092\u7e26\u306b\u5206\u5272 : q , :only \u30ab\u30fc\u30bd\u30eb\u306e\u3042\u308b\u30a6\u30a3\u30f3\u30c9\u30a6\u4ee5\u5916\u3092\u5168\u90e8\u9589\u3058\u308b :new \u7a7a\u306e\u6a2a\u30a6\u30a4\u30f3\u30c9\u30a6\u3092\u958b\u304f :vnew \u7a7a\u306e\u7e26\u30a6\u30a4\u30f3\u30c9\u30a6\u3092\u958b\u304f Ctrl-w w \u6b21\u306e\u30a6\u30a4\u30f3\u30c9\u30a6\u306b\u79fb\u52d5 Ctrl-w p \u524d\u306e\u30a6\u30a4\u30f3\u30c9\u30a6\u306b\u79fb\u52d5 Ctrl-w o \u73fe\u5728\u306e\u30a6\u30a4\u30f3\u30c9\u30a6\u4ee5\u5916\u3092\u9589\u3058\u308b u \u76f4\u524d\u306e\u64cd\u4f5c\u3092\u53d6\u308a\u3084\u3081\u308b U \u884c\u5168\u4f53\u306e\u64cd\u4f5c\u3092\u53d6\u308a\u3084\u3081\u308b Ctrl-R \u53d6\u308a\u6d88\u3057\u306e\u53d6\u308a\u6d88\u3057 . \u76f4\u524d\u306e\u64cd\u4f5c\u306e\u7e70\u308a\u8fd4\u3057 :! [\u5916\u90e8\u30b3\u30de\u30f3\u30c9] \u5916\u90e8\u30b7\u30a7\u30eb\u30b3\u30de\u30f3\u30c9\u304c\u5b9f\u884c U \u884c\u5168\u4f53\u306e\u64cd\u4f5c\u3092\u53d6\u308a\u3084\u3081\u308b :set number\u3001 :set nu \u884c\u756a\u53f7\u3092\u8868\u793a :set no number\u3001 :set nonu \u884c\u756a\u53f7\u306e\u8868\u793a\u3092\u3084\u3081\u308b :set showmode \u73fe\u5728\u306e\u30e2\u30fc\u30c9\u3092\u8868\u793a :set showmatch () \u3084 {} \u306e\u5bfe\u5fdc\u3092\u5831\u544a :set ignorecase \u5927\u6587\u5b57/\u5c0f\u6587\u5b57\u306e\u533a\u5225\u306a\u304f\u691c\u7d22 :set autoindent \u81ea\u52d5\u30a4\u30f3\u30c7\u30f3\u30c8\u30e2\u30fc\u30c9 :set noautoindent \u81ea\u52d5\u30a4\u30f3\u30c7\u30f3\u30c8\u30e2\u30fc\u30c9\u3092\u3084\u3081\u308b :set all \u3059\u3079\u3066\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8868\u793a :e [\u30d5\u30a1\u30a4\u30eb] \u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304f :syntax on \u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u30cf\u30a4\u30e9\u30a4\u30c8\u8868\u793a\u3059\u308b :vert diffsplit [\u30d5\u30a1\u30a4\u30eb] \u4eca\u306e\u30d5\u30a1\u30a4\u30eb\u3068\u3001\u4ed6\u306e\u30d5\u30a1\u30a4\u30eb\u3068\u306e\u5dee\u5206\u3092\u53d6\u308b\u30b3\u30de\u30f3\u30c9 :Tutorial 30\u5206\u7a0b\u5ea6\u306eVi\u5229\u7528\u65b9\u6cd5\u306e\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb <p> Vim\u306e\u4f7f\u3044\u65b9 \u57fa\u672c\u64cd\u4f5c\u307e\u3068\u3081 <p>Vim\u306e\u4f7f\u3044\u65b9, \u7279\u306b\u81ea\u5206\u304c\u3088\u304f\u4f7f\u3046\u57fa\u672c\u64cd\u4f5c\u3092\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f.</p> <ul> <li>\u7de8\u96c6, \u4fdd\u5b58, \u7d42\u4e86</li> <li>\u79fb\u52d5\u7cfb</li> <li>\u30e2\u30fc\u30c9\u5909\u66f4</li> <li>\u524a\u9664, \u30b3\u30d4\u30fc</li> <li>\u691c\u7d22</li> <li>Undo, Redo, \u7e70\u308a\u8fd4\u3057</li> <li>\u30a4\u30f3\u30c7\u30f3\u30c8</li> <li>\u7f6e\u63db</li> <li>\u30a6\u30a3\u30f3\u30c9\u30a6\u64cd\u4f5c</li> <li>\u30bf\u30d6</li> <li>\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8, \u30c7\u30af\u30ea\u30e1\u30f3\u30c8</li> <li>\u6ce8\u610f</li> </ul> <p></p>"},{"location":"vim/#edit","title":"\u7de8\u96c6, \u4fdd\u5b58, \u7d42\u4e86","text":"\u30b3\u30de\u30f3\u30c9 \u52d5\u4f5c :e [file] file\u3092\u958b\u304f :e. \u30a8\u30af\u30b9\u30d7\u30ed\u30fc\u30e9\u30fc\u3092\u958b\u304f :w \u4fdd\u5b58 :q \u7d42\u4e86 :q! \u4fdd\u5b58\u305b\u305a\u7d42\u4e86 ZZ \u4fdd\u5b58\u3057\u3066\u7d42\u4e86 ZQ \u4fdd\u5b58\u305b\u305a\u306b\u7d42\u4e86"},{"location":"vim/#move","title":"\u79fb\u52d5\u7cfb","text":"\u30b3\u30de\u30f3\u30c9 \u52d5\u4f5c h, j, k, l \u5de6, \u4e0b, \u4e0a, \u53f3 gj, gk \u4e0b, \u4e0a\u306b1\u884c\u79fb\u52d5. (\u30a8\u30c7\u30a3\u30bf\u3067\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u884c\u4e0a\u3067\u79fb\u52d5, \u3064\u307e\u308a, \u30a8\u30c7\u30a3\u30bf\u306e\u6a2a\u5e45\u306e\u5236\u7d04\u306b\u3088\u3063\u3066\u884c\u304c\u6298\u308a\u8fd4\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3067\u3082, \u79fb\u52d5\u53ef\u80fd) w 1\u5358\u8a9e\u5206\u9032\u3080 W 1\u5358\u8a9e\u5206\u9032\u3080(\u8a18\u53f7\u3067\u306f\u533a\u5207\u3089\u308c\u306a\u3044\u306e\u3067, \u6b21\u306e\u30b9\u30da\u30fc\u30b9\u3084, \u6539\u884c\u6587\u5b57\u307e\u3067\u98db\u3076) b 1\u5358\u8a9e\u5206\u623b\u308b B 1\u5358\u8a9e\u5206\u623b\u308b(\u8a18\u53f7\u3067\u306f\u533a\u5207\u3089\u308c\u306a\u3044\u306e\u3067, \u524d\u306e\u30b9\u30da\u30fc\u30b9\u3084, \u6539\u884c\u6587\u5b57\u307e\u3067\u98db\u3076) f[\u6587\u5b57] \u6b21\u306e[\u6587\u5b57]\u307e\u3067\u98db\u3076 F[\u6587\u5b57] \u524d\u306e[\u6587\u5b57]\u307e\u3067\u98db\u3076 t[\u6587\u5b57] \u6b21\u306e[\u6587\u5b57]\u306e\u624b\u524d\u307e\u3067\u98db\u3076 T[\u6587\u5b57] \u524d\u306e[\u6587\u5b57]\u306e\u6b21\u307e\u3067\u98db\u3076 ; f, F, t, T\u3067\u691c\u7d22\u3057\u305f\u6587\u5b57\u3092\u540c\u65b9\u5411\u306b\u7e70\u308a\u8fd4\u3057\u691c\u7d22\u3059\u308b , f, F, t, T\u3067\u691c\u7d22\u3057\u305f\u6587\u5b57\u3092\u9006\u65b9\u5411\u306b\u7e70\u308a\u8fd4\u3057\u691c\u7d22\u3059\u308b g; \u76f4\u524d\u306b\u5909\u66f4\u3057\u305f\u4f4d\u7f6e\u306b\u30ab\u30fc\u30bd\u30eb\u3092\u79fb\u52d5(\u7e70\u308a\u8fd4\u3057\u5165\u529b\u3059\u308b\u3053\u3068\u3067, \u5909\u66f4\u30ea\u30b9\u30c8\u3092\u9061\u308b) g, g#\u3092\u4f7f\u7528\u3057\u3066\u9061\u3063\u305f\u5909\u66f4\u30ea\u30b9\u30c8\u3092\u9006\u9806\u306b\u9032\u3081, \u30ab\u30fc\u30bd\u30eb\u3092\u79fb\u52d5\u3059\u308b. gg \u30d5\u30a1\u30a4\u30eb\u306e\u5148\u982d\u306b\u79fb\u52d5 G \u30d5\u30a1\u30a4\u30eb\u306e\u6700\u5f8c\u306b\u79fb\u52d5 [\u6570\u5024]gg, [\u6570\u5024]G, :[\u6570\u5024] [\u6570\u5024]\u884c\u306b\u79fb\u52d5 H, M, L \u753b\u9762\u306b\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u884c\u306b\u3064\u3044\u3066, \u6700\u521d\u306e\u884c(H), \u771f\u3093\u4e2d\u306e\u884c(M), \u6700\u5f8c\u306e\u884c(L)\u306b\u79fb\u52d5 0 \u884c\u306e\u5148\u982d\u306b\u79fb\u52d5 ^ \u884c\u306e\u30c6\u30ad\u30b9\u30c8\u90e8\u5206\u306e\u5148\u982d\u306b\u79fb\u52d5 $ \u884c\u306e\u6700\u5f8c\u306b\u79fb\u52d5 % \u5bfe\u5fdc\u3059\u308b\u62ec\u5f27\u306b\u79fb\u52d5 ( \u6587\u5358\u4f4d\u3067\u306e\u79fb\u52d5. \u524d\u306e\u6587\u306e\u5148\u982d\u306b\u79fb\u52d5 ) \u6587\u5358\u4f4d\u3067\u306e\u79fb\u52d5. \u5f8c\u308d\u306e\u6587\u306e\u5148\u982d\u306b\u79fb\u52d5 { \u6bb5\u843d\u5358\u4f4d\u3067\u306e\u79fb\u52d5. \u524d\u306e\u6bb5\u843d\u306e\u5148\u982d\u306b\u79fb\u52d5 } \u6bb5\u843d\u5358\u4f4d\u3067\u306e\u79fb\u52d5. \u5f8c\u308d\u306e\u6bb5\u843d\u306e\u5148\u982d\u306b\u79fb\u52d5 Ctrl-u \u534a\u753b\u9762\u5206\u623b\u308b Ctrl-d \u534a\u753b\u9762\u5206\u9032\u3080 Ctrl-b 1\u753b\u9762\u5206\u623b\u308b Ctrl-f 1\u753b\u9762\u5206\u9032\u3080 Ctrl-o \u30b8\u30e3\u30f3\u30d7\u30ea\u30b9\u30c8\u3092\u9061\u3063\u3066\u30ab\u30fc\u30bd\u30eb\u3092\u79fb\u52d5\u3059\u308b(\u691c\u7d22\u3084\u884c\u6570\u6307\u5b9a\u79fb\u52d5\u306a\u3069\u304c\u30b8\u30e3\u30f3\u30d7\u30ea\u30b9\u30c8\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b) Ctrl-i \u30b8\u30e3\u30f3\u30d7\u30ea\u30b9\u30c8\u3092\u9032\u3081\u3066\u30ab\u30fc\u30bd\u30eb\u3092\u79fb\u52d5\u3059\u308b(\u691c\u7d22\u3084\u884c\u6570\u6307\u5b9a\u79fb\u52d5\u306a\u3069\u304c\u30b8\u30e3\u30f3\u30d7\u30ea\u30b9\u30c8\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b)"},{"location":"vim/#mode","title":"\u30e2\u30fc\u30c9\u5909\u66f4","text":"\u30b3\u30de\u30f3\u30c9 \u52d5\u4f5c esc \u30ce\u30fc\u30de\u30eb\u30e2\u30fc\u30c9\u306b\u623b\u308b Ctrl-[ \u30ce\u30fc\u30de\u30eb\u30e2\u30fc\u30c9\u306b\u623b\u308b i \u30ab\u30fc\u30bd\u30eb\u4f4d\u7f6e\u304b\u3089\u30a4\u30f3\u30b5\u30fc\u30c8\u30e2\u30fc\u30c9\u306b\u5165\u308b a \u30ab\u30fc\u30bd\u30eb\u306e\u76f4\u5f8c\u304b\u3089\u30a4\u30f3\u30b5\u30fc\u30c8\u30e2\u30fc\u30c9\u306b\u5165\u308b I \u884c\u982d\u304b\u3089\u30a4\u30f3\u30b5\u30fc\u30c8\u30e2\u30fc\u30c9\u306b\u5165\u308b A \u884c\u672b\u304b\u3089\u30a4\u30f3\u30b5\u30fc\u30c8\u30e2\u30fc\u30c9\u306b\u5165\u308b Ctrl-o(\u30a4\u30f3\u30b5\u30fc\u30c8\u30e2\u30fc\u30c9\u4e2d\u306b) \u30a4\u30f3\u30b5\u30fc\u30c8\u30ce\u30fc\u30de\u30eb\u30e2\u30fc\u30c9\u306b\u5165\u308b(\u30a4\u30f3\u30b5\u30fc\u30c8\u30e2\u30fc\u30c9\u4e2d\u306b1\u30b3\u30de\u30f3\u30c9\u306e\u307f\u30ce\u30fc\u30de\u30eb\u30e2\u30fc\u30c9\u306e\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3067\u304d\u308b) v \u30d3\u30b8\u30e5\u30a2\u30eb\u30e2\u30fc\u30c9\u306b\u5165\u308b V \u884c\u5358\u4f4d\u306e\u9078\u629e\u3092\u3059\u308b\u30d3\u30b8\u30e5\u30a2\u30eb\u30e2\u30fc\u30c9\u306b\u5165\u308b Ctrl-v \u77e9\u5f62\u9078\u629e\u3092\u3059\u308b\u30d3\u30b8\u30e5\u30a2\u30eb\u30e2\u30fc\u30c9\u306b\u5165\u308b gv \u524d\u56de\u9078\u629e\u3057\u305f\u7bc4\u56f2\u304c\u518d\u9078\u629e\u3055\u308c\u305f\u72b6\u614b\u3067\u30d3\u30b8\u30e5\u30a2\u30eb\u30e2\u30fc\u30c9\u306b\u5165\u308b : \u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30e2\u30fc\u30c9\u306b\u5165\u308b(\u7d9a\u3051\u3066\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3061, Enter\u3067\u5b9f\u884c) <p>\u77e9\u5f62\u9078\u629e\u306e\u4f7f\u3044\u65b9\u306b\u3064\u3044\u3066\u306f, \uff62\u77e9\u5f62\u9078\u629e\u30e2\u30fc\u30c9\u306e\u4f7f\u3044\u65b9\uff63\u3067\u3082\u89e3\u8aac\u3057\u3066\u3044\u307e\u3059\u306e\u3067, \u3088\u308d\u3057\u3051\u308c\u3070\u53c2\u8003\u306b\u306a\u3055\u3063\u3066\u304f\u3060\u3055\u3044.</p>"},{"location":"vim/#del","title":"\u524a\u9664, \u30b3\u30d4\u30fc","text":"\u30b3\u30de\u30f3\u30c9 \u52d5\u4f5c x \u30ab\u30fc\u30bd\u30eb\u4e0a\u306e\u6587\u5b57\u3092\u6d88\u3059 s \u30ab\u30fc\u30bd\u30eb\u4e0a\u306e\u6587\u5b57\u3092\u6d88\u3057\u3066, \u30a4\u30f3\u30b5\u30fc\u30c8\u30e2\u30fc\u30c9\u306b\u5165\u308b dd \u30ab\u30fc\u30bd\u30eb\u304c\u3042\u308b\u884c\u3092\u6d88\u3059 dw \u30ab\u30fc\u30bd\u30eb\u4f4d\u7f6e\u304b\u30891\u5358\u8a9e\u5206\u524a\u9664\u3059\u308b diw \u30ab\u30fc\u30bd\u30eb\u4f4d\u7f6e\u306b\u3042\u308b\u5358\u8a9e\u30921\u3064\u524a\u9664\u3059\u308b dt( \u30ab\u30fc\u30bd\u30eb\u4f4d\u7f6e\u304b\u3089, \u6b21\u306b\u6700\u521d\u306b\u51fa\u73fe\u3059\u308b(\u307e\u3067\u3092\u524a\u9664\u3059\u308b cc \u30ab\u30fc\u30bd\u30eb\u304c\u3042\u308b\u884c\u3092\u6d88\u3057\u3066, \u30a4\u30f3\u30b5\u30fc\u30c8\u30e2\u30fc\u30c9\u306b\u5165\u308b cw \u30ab\u30fc\u30bd\u30eb\u4f4d\u7f6e\u304b\u30891\u5358\u8a9e\u5206\u524a\u9664\u3057\u3066, \u30a4\u30f3\u30b5\u30fc\u30c8\u30e2\u30fc\u30c9\u306b\u5165\u308b ciw \u30ab\u30fc\u30bd\u30eb\u4f4d\u7f6e\u306b\u3042\u308b\u5358\u8a9e\u30921\u3064\u524a\u9664\u3057\u3066, \u30a4\u30f3\u30b5\u30fc\u30c8\u30e2\u30fc\u30c9\u306b\u5165\u308b ct( \u30ab\u30fc\u30bd\u30eb\u4f4d\u7f6e\u304b\u3089, \u6b21\u306b\u6700\u521d\u306b\u51fa\u73fe\u3059\u308b(\u307e\u3067\u3092\u524a\u9664\u3057\u3066, \u30a4\u30f3\u30b5\u30fc\u30c8\u30e2\u30fc\u30c9\u306b\u5165\u308b D \u30ab\u30fc\u30bd\u30eb\u4f4d\u7f6e\u304b\u3089\u884c\u672b\u307e\u3067\u524a\u9664 C \u30ab\u30fc\u30bd\u30eb\u4f4d\u7f6e\u304b\u3089\u884c\u672b\u307e\u3067\u524a\u9664\u3057\u3066, \u30a4\u30f3\u30b5\u30fc\u30c8\u30e2\u30fc\u30c9\u306b\u5165\u308b yy \u30ab\u30fc\u30bd\u30eb\u304c\u3042\u308b\u884c\u3092\u30b3\u30d4\u30fc y \u30d3\u30b8\u30e5\u30a2\u30eb\u30e2\u30fc\u30c9\u3067\u9078\u629e\u3055\u308c\u3066\u3044\u308b\u90e8\u5206\u3092\u30b3\u30d4\u30fc p \u30ab\u30fc\u30bd\u30eb\u884c\u306e\u4e0b\u306e\u884c\u306b\u30da\u30fc\u30b9\u30c8 P \u30ab\u30fc\u30bd\u30eb\u884c\u306e\u4e0a\u306e\u884c\u306b\u30da\u30fc\u30b9\u30c8 Ctrl-r 0(\u30bc\u30ed)(\u30a4\u30f3\u30b5\u30fc\u30c8\u30e2\u30fc\u30c9\u4e2d\u306b) \u30ec\u30b8\u30b9\u30bf0\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u6587\u5b57\u5217\u3092\u8cbc\u308a\u4ed8\u3051\u308b. \u901a\u5e38, y\u3092\u4f7f\u7528\u3057\u3066\u30b3\u30d4\u30fc\u3057\u305f\u6587\u5b57\u5217\u306f, \u30ec\u30b8\u30b9\u30bf0\u306b\u4fdd\u5b58\u3055\u308c\u308b."},{"location":"vim/#search","title":"\u691c\u7d22","text":"\u30b3\u30de\u30f3\u30c9 \u52d5\u4f5c / \u7d9a\u3051\u3066\u6587\u5b57\u3092\u6253\u3061, Enter\u3067\u6587\u5b57\u5217\u3092\u78ba\u5b9a\u3057, \u5f8c\u65b9\u691c\u7d22\u3092\u304b\u3051\u308b ? \u7d9a\u3051\u3066\u6587\u5b57\u3092\u6253\u3061, Enter\u3067\u6587\u5b57\u5217\u3092\u78ba\u5b9a\u3057, \u524d\u65b9\u691c\u7d22\u3092\u304b\u3051\u308b * \u30ab\u30fc\u30bd\u30eb\u4e0b\u306e\u5358\u8a9e\u3092, \u5f8c\u65b9\u691c\u7d22\u3059\u308b # \u30ab\u30fc\u30bd\u30eb\u4e0b\u306e\u5358\u8a9e\u3092, \u524d\u65b9\u691c\u7d22\u3059\u308b g* \u30ab\u30fc\u30bd\u30eb\u4e0b\u306e\u5358\u8a9e\u3092\u542b\u3080\u6587\u5b57\u5217\u3092, \u5f8c\u65b9\u691c\u7d22\u3059\u308b g# \u30ab\u30fc\u30bd\u30eb\u4e0b\u306e\u5358\u8a9e\u3092\u542b\u3080\u6587\u5b57\u5217\u3092, \u524d\u65b9\u691c\u7d22\u3059\u308b n \u6b21\u306e\u5358\u8a9e\u306b\u79fb\u308b N \u524d\u306e\u5358\u8a9e\u306b\u79fb\u308b"},{"location":"vim/#undo","title":"Undo, Redo, \u7e70\u308a\u8fd4\u3057","text":"\u30b3\u30de\u30f3\u30c9 \u52d5\u4f5c u Undo Ctrl-r Redo . \u76f4\u524d\u306e\u64cd\u4f5c\u306e\u7e70\u308a\u8fd4\u3057 <p>Vim\u3067\u30b3\u30de\u30f3\u30c9\u3092\u7e70\u308a\u8fd4\u3057\u305f\u3044\u3068\u304d\u306b\u975e\u5e38\u306b\u4fbf\u5229\u306a\u6a5f\u80fd\u3068\u3057\u3066, \u30de\u30af\u30ed\u304c\u3042\u308a\u307e\u3059. \u4efb\u610f\u306e\u30b3\u30de\u30f3\u30c9\u3092\u8a18\u61b6\u3055\u305b\u3066, \u305d\u308c\u3092\u3044\u3064\u3067\u3082\u7e70\u308a\u8fd4\u305b\u308b\u3088\u3046\u306b\u3067\u304d\u308b\u3068\u3044\u3046\u3082\u306e\u3067\u3059. \u4f7f\u3044\u65b9\u3092\uff62Vim\u306e\u30de\u30af\u30ed\u306e\u4f7f\u3044\u65b9\uff63, \u30de\u30af\u30ed\u3092\u4f7f\u3063\u305f\u4fbf\u5229\u64cd\u4f5c\u306e\u4e00\u4f8b\u3092\uff62Vim\u3067\u30de\u30af\u30ed\u3092\u4f7f\u3063\u3066\u9023\u756a\u306e\u6587\u3092\u7c21\u5358\u306b\u5165\u529b\u3059\u308b\u65b9\u6cd5\uff63\u3067\u89e3\u8aac\u3057\u3066\u304a\u308a\u307e\u3059\u306e\u3067, \u3088\u308d\u3057\u3051\u308c\u3070\u53c2\u8003\u306b\u306a\u3055\u3063\u3066\u4e0b\u3055\u3044.</p>"},{"location":"vim/#indent","title":"\u30a4\u30f3\u30c7\u30f3\u30c8","text":"\u30b3\u30de\u30f3\u30c9 \u52d5\u4f5c = \u30ab\u30fc\u30bd\u30eb\u304c\u3042\u308b\u884c\u3092\u30a4\u30f3\u30c7\u30f3\u30c8. \u30d3\u30b8\u30e5\u30a2\u30eb\u30e2\u30fc\u30c9\u3067\u7bc4\u56f2\u3092\u9078\u629e\u3057\u3066\u3044\u308c\u3070, \u305d\u306e\u7bc4\u56f2\u3092\u30a4\u30f3\u30c7\u30f3\u30c8 &gt;&gt; \u30a4\u30f3\u30c7\u30f3\u30c8\u3092\u8ffd\u52a0 &lt;&lt; \u30a4\u30f3\u30c7\u30f3\u30c8\u3092\u524a\u9664"},{"location":"vim/#substitution","title":"\u7f6e\u63db","text":"\u30b3\u30de\u30f3\u30c9 \u52d5\u4f5c r[\u6587\u5b57] \u30ab\u30fc\u30bd\u30eb\u4e0a\u306e\u6587\u5b57\u3092[\u6587\u5b57]\u306b\u7f6e\u63db :%s/before/after/g \u30d5\u30a1\u30a4\u30eb\u4e0a\u306e\u5168\u3066\u306e\"before\"\u3092\"after\"\u306b\u7f6e\u63db :s/before/after/g \u30ab\u30fc\u30bd\u30eb\u306e\u884c\u306e\u5168\u3066\u306e\"before\"\u3092\"after\"\u306b\u7f6e\u63db :10,20s/before/after/g 10~20\u884c\u76ee\u306e\u5168\u3066\u306e\"before\"\u3092\"after\"\u306b\u7f6e\u63db :'&lt;,'&gt;s/before/after/g \u30d3\u30b8\u30e5\u30a2\u30eb\u30e2\u30fc\u30c9\u3067\u9078\u629e\u4e2d\u306e\u7bc4\u56f2\u306e\u5168\u3066\u306e\"before\"\u3092\"after\"\u306b\u7f6e\u63db. \" '&lt;,'&gt; \"\u306e\u90e8\u5206\u306f, \u7bc4\u56f2\u3092\u9078\u629e\u4e2d\u306b\":\"\u3092\u62bc\u3059\u3068\u81ea\u52d5\u7684\u306b\u51fa\u307e\u3059. <p>\u7f6e\u63db\u306b\u3064\u3044\u3066\u306f, \uff62Vim\u306e\u7f6e\u63db\u30b3\u30de\u30f3\u30c9\u306e\u4f7f\u3044\u65b9\uff63\u3067\u3082\u89e3\u8aac\u3057\u3066\u3044\u307e\u3059\u306e\u3067, \u3088\u308d\u3057\u3051\u308c\u3070\u53c2\u8003\u306b\u306a\u3055\u3063\u3066\u304f\u3060\u3055\u3044.</p>"},{"location":"vim/#window","title":"\u30a6\u30a3\u30f3\u30c9\u30a6\u64cd\u4f5c","text":"\u30b3\u30de\u30f3\u30c9 \u52d5\u4f5c :sp [file] \u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u6a2a\u306b\u5206\u5272\u3057, file\u3092\u958b\u304f(file\u540d\u306f\u306a\u304f\u3066\u3082\u826f\u3044) :vs [file] \u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u7e26\u306b\u5206\u5272\u3057, file\u3092\u958b\u304f(file\u540d\u306f\u306a\u304f\u3066\u3082\u826f\u3044) Ctrl-w s \u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u6a2a\u306b\u5206\u5272\u3059\u308b Ctrl-w v \u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u7e26\u306b\u5206\u5272\u3059\u308b :only \u30ab\u30fc\u30bd\u30eb\u306e\u3042\u308b\u30a6\u30a3\u30f3\u30c9\u30a6\u4ee5\u5916\u9589\u3058\u308b Ctrl-w o \u30ab\u30fc\u30bd\u30eb\u306e\u3042\u308b\u30a6\u30a3\u30f3\u30c9\u30a6\u4ee5\u5916\u9589\u3058\u308b Ctrl-w w \u6b21\u306e\u30a6\u30a3\u30f3\u30c9\u30a6\u306b\u79fb\u52d5 Ctrl-w p \u524d\u306e\u30a6\u30a3\u30f3\u30c9\u30a6\u306b\u79fb\u52d5 Ctrl-w h, j, k, l \u5de6, \u4e0b, \u4e0a, \u53f3\u306e\u30a6\u30a3\u30f3\u30c9\u30a6\u306b\u79fb\u52d5\u3059\u308b Ctrl-w H, J, K, L \u30ab\u30fc\u30bd\u30eb\u304c\u3042\u308b\u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u5de6, \u4e0b, \u4e0a, \u53f3\u65b9\u5411\u306b\u79fb\u52d5\u3059\u308b"},{"location":"vim/#tab","title":"\u30bf\u30d6","text":"\u30b3\u30de\u30f3\u30c9 \u52d5\u4f5c :tabnew [file] \u65b0\u3057\u3044\u30bf\u30d6\u3092\u958b\u304f. \u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5165\u529b\u3057\u305f\u5834\u5408\u306f, \u305d\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304f :tabclose \u30bf\u30d6\u3092\u9589\u3058\u308b(:q\u306a\u3069\u3067\u3082\u9589\u3058\u3089\u308c\u307e\u3059) :tabnext \u6b21\u306e\u30bf\u30d6\u306b\u79fb\u52d5\u3059\u308b :tabprevious \u524d\u306e\u30bf\u30d6\u306b\u79fb\u52d5\u3059\u308b :tabfirst 1\u756a\u76ee\u306e\u30bf\u30d6\u306b\u79fb\u52d5\u3059\u308b :tablast \u6700\u5f8c\u306e\u30bf\u30d6\u306b\u79fb\u52d5\u3059\u308b :tabonly \u73fe\u5728\u306e\u30bf\u30d6\u4ee5\u5916\u5168\u3066\u306e\u30bf\u30d6\u3092\u9589\u3058\u308b gt \u6b21\u306e\u30bf\u30d6\u306b\u79fb\u52d5\u3059\u308b. gt\u306e\u76f4\u524d\u306b\u6570\u5b57\u3092\u3064\u3051\u308b\u3068, \u6570\u5b57\u756a\u76ee\u306e\u30bf\u30d6\u306b\u79fb\u52d5\u3059\u308b gT \u4e00\u3064\u524d\u306e\u30bf\u30d6\u306b\u79fb\u52d5\u3059\u308b"},{"location":"vim/#increment","title":"\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8, \u30c7\u30af\u30ea\u30e1\u30f3\u30c8","text":"\u30b3\u30de\u30f3\u30c9 \u52d5\u4f5c Ctrl-a \u30ab\u30fc\u30bd\u30eb\u884c\u4e0a\u3067, \u30ab\u30fc\u30bd\u30eb\u4ee5\u964d\u306e\u6700\u521d\u306b\u51fa\u73fe\u3057\u305f\u6570\u5b57\u3092\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8 Ctrl-x \u30ab\u30fc\u30bd\u30eb\u884c\u4e0a\u3067, \u30ab\u30fc\u30bd\u30eb\u4ee5\u964d\u306e\u6700\u521d\u306b\u51fa\u73fe\u3057\u305f\u6570\u5b57\u3092\u30c7\u30af\u30ea\u30e1\u30f3\u30c8 <p>\u30ab\u30fc\u30bd\u30eb\u4e0b\u306b\u6570\u5b57\u304c\u306a\u304f\u3066\u3082\u4f7f\u7528\u3067\u304d\u308b\u305f\u3081, \u79fb\u52d5\u306b\u3082\u4f7f\u3048\u307e\u3059.</p>"},{"location":"vim/#attention","title":"\u6ce8\u610f","text":"<p>\u4e3b\u306b\u3044\u3064\u3082\u4f7f\u3063\u3066\u3044\u308b\u30b3\u30de\u30f3\u30c9\u3092\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f. \u591a\u304f\u306e\u30b3\u30de\u30f3\u30c9\u306f, \u76f4\u524d\u306b\u6570\u5b57\u306a\u3069\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059. \u4f8b\u3048\u3070, 3dd\u3068\u3059\u308c\u30703\u884c\u524a\u9664\u3067\u304d\u307e\u3059. 10i\u3067\u30a4\u30f3\u30b5\u30fc\u30c8\u30e2\u30fc\u30c9\u306b\u5165\u3063\u3066, \u6587\u5b57\u3092\u5165\u529b\u3057\u305f\u5f8c\u306b\u30ce\u30fc\u30de\u30eb\u30e2\u30fc\u30c9\u306b\u3082\u3069\u308c\u306f, \u5165\u529b\u3057\u305f\u6587\u5b57\u304c10\u500b\u5206\u5165\u529b\u3055\u308c\u307e\u3059. \u3042\u3068, \u3053\u3053\u306b\u66f8\u3044\u3066\u3042\u308b\u4ee5\u5916\u306b\u3082\u305f\u304f\u3055\u3093\u30b3\u30de\u30f3\u30c9\u306f\u3042\u308a\u307e\u3059\u306e\u3067, \u3042\u3057\u304b\u3089\u305a.</p>"},{"location":"zabbix6/","title":"\u516c\u5f0f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u66f8(apache\u30d0\u30fc\u30b8\u30e7\u30f3)","text":"<ul> <li>https://www.zabbix.com/download?zabbix=6.0&amp;os_distribution=ubuntu&amp;os_version=20.04_focal&amp;db=mysql&amp;ws=apache</li> </ul>"},{"location":"zabbix6/#url","title":"\u53c2\u8003URL","text":"<ul> <li>https://densan-hoshigumi.com/server/zabbix60-ha-installation</li> </ul>"},{"location":"zabbix6/#idpw","title":"\u30c7\u30d5\u30a9\u30eb\u30c8ID/PW","text":"<ul> <li>ID:Admin</li> <li>PW:zabbix</li> </ul>"},{"location":"zabbix6/#_1","title":"\u691c\u8a3c\u30b5\u30fc\u30d0","text":"<ul> <li>http://192.168.1.1/zabbix/zabbix.php?action=dashboard.view</li> <li>http://192.168.1.2/zabbix/zabbix.php?action=dashboard.view</li> </ul>"},{"location":"zabbix6/#centos7-zabbix-agent2-install","title":"CentOS7 zabbix-agent2 install","text":"<ul> <li>ca-certificates update<ul> <li> ca-certificates update <pre><code>[root@node1 ]# yum install ca-certificates -y\nzabbix-agent2-6.0.5-1.el7.x86_64.rpm download&amp;install\n</code></pre> </li> </ul> </li> <li> <p>download</p> <ul> <li> download <pre><code>[root@node1 ]# wget https://repo.zabbix.com/zabbix/6.0/rhel/7/x86_64/zabbix-agent2-6.0.5-1.el7.x86_64.rpm\n</code></pre> </li> </ul> </li> <li> <p>install</p> <ul> <li> install <pre><code>#\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u524d\n[root@node1 ]# rpm -aq | grep zabbix\nzabbix-release-3.0-1.el7.noarch\nzabbix-agent-3.0.3-1.el7.x86_64\n\n#\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\n[root@node1 ]# rpm -aq | grep zabbix\nzabbix-release-3.0-1.el7.noarch\nzabbix-agent-3.0.3-1.el7.x86_64\nzabbix-agent2-6.0.5-1.el7.x86_64\n\nroot@node1 ]# ll\ntotal 5.4M\ndrwxr-xr-x 2 root root 4.0K Jun 22 14:59 .\ndrwxr-xr-x 7 root root 4.0K Jun 20 12:32 ..\n-rw-r--r-- 1 root root 2.4K Jun 20 12:32 userparameter_mysql.conf\n-rw-r--r-- 1 root root 5.4M May 30 20:39 zabbix-agent2-6.0.5-1.el7.x86_64.rpm\n\n[root@node1 ]# rpm -aq | grep zabbix\nzabbix-agent-3.0.3-1.el7.x86_64\nzabbix-release-3.0-1.el7.noarch\n[root@mysql1000 mysql_agent]# yum install zabbix-agent2-6.0.5-1.el7.x86_64.rpm\nLoaded plugins: fastestmirror\nExamining zabbix-agent2-6.0.5-1.el7.x86_64.rpm: zabbix-agent2-6.0.5-1.el7.x86_64\nMarking zabbix-agent2-6.0.5-1.el7.x86_64.rpm to be installed\nResolving Dependencies\n--&gt; Running transaction check\n---&gt; Package zabbix-agent2.x86_64 0:6.0.5-1.el7 will be installed\n--&gt; Processing Dependency: libpcre2-8.so.0()(64bit) for package: zabbix-agent2-6.0.5-1.el7.x86_64\nLoading mirror speeds from cached hostfile\n * elrepo: ftp.ne.jp\n * epel: ftp.iij.ad.jp\n--&gt; Running transaction check\n---&gt; Package pcre2.x86_64 0:10.23-2.el7 will be installed\n--&gt; Finished Dependency Resolution\n\nDependencies Resolved\n=========================================================================================================================================================================================\nPackage                                  Arch                              Version                                   Repository                                                    Size\n=========================================================================================================================================================================================\nInstalling:\n zabbix-agent2                            x86_64                            6.0.5-1.el7                               /zabbix-agent2-6.0.5-1.el7.x86_64                             17 M\nInstalling for dependencies:\n pcre2                                    x86_64                            10.23-2.el7                               base                                                         201 k\n\nTransaction Summary\n=========================================================================================================================================================================================\nInstall  1 Package (+1 Dependent package)\nTotal size: 18 M\nTotal download size: 201 k\nInstalled size: 18 M\nIs this ok [y/d/N]: y\n\n[root@node1 ]# rpm -aq | grep zabbix\nzabbix-agent-3.0.3-1.el7.x86_64\nzabbix-release-3.0-1.el7.noarch\nzabbix-agent2-6.0.5-1.el7.x86_64\n</code></pre> </li> </ul> </li> <li> <p>agent2.conf</p> <ul> <li> agent2.conf <pre><code>[root@node1 ]# grep -v ^\\# /etc/zabbix/zabbix_agent2.conf  | grep -v ^\\$\nPidFile=/var/run/zabbix/zabbix_agent2.pid\nLogFile=/var/log/zabbix/zabbix_agent2.log\nLogFileSize=0\nServer=192.168.1.1,192.168.1.2\nListenPort=10059               &lt;&lt;-- agent1\uff0810050\uff09\u3068\u88ab\u3089\u306a\u3044\u3088\u3046\u306bPort\u3092\u5909\u66f4\u3059\u308b\u3002\nServerActive=192.168.1.1,192.168.1.2\nHostname=node1\nHostnameItem=system.hostname\nInclude=/etc/zabbix/zabbix_agent2.d/*.conf\nControlSocket=/tmp/agent.sock\nInclude=./zabbix_agent2.d/plugins.d/*.conf\n\n[root@node1 ]# systemctl enable zabbix-agent2.service\n[root@node1 ]# systemctl restart zabbix-agent2.service\n# \u5bfe\u8c61IP\u306e\u8a31\u53ef\u3092\u8ffd\u52a0\n[root@node1 ]# vi /root/bin/iptables.sh\niptables -A INPUT -s 192.168.1.0/24 -j ACCEPT\n\n[root@node1 ]# netstat -nlpt\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name\ntcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1017/master\ntcp        0      0 0.0.0.0:10050           0.0.0.0:*               LISTEN      31319/zabbix_agentd\ntcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      6041/mysqld\ntcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      851/sshd\ntcp6       0      0 ::1:25                  :::*                    LISTEN      1017/master\ntcp6       0      0 :::10050                :::*                    LISTEN      31319/zabbix_agentd\ntcp6       0      0 :::10059                :::*                    LISTEN      8723/zabbix_agent2      &lt;&lt;--  10059\u3067agent2\u304c\u5229\u7528\u4e2d\ntcp6       0      0 :::9104                 :::*                    LISTEN      19474/./mysqld_expo\ntcp6       0      0 :::22                   :::*                    LISTEN      851/sshd\n[root@node1 ]#\n</code></pre> </li> </ul> </li> <li> <p>MySQL\u76e3\u8996\u7528\u30a2\u30ab\u30a6\u30f3\u30c8\u8ffd\u52a0</p> <ul> <li> MySQL\u76e3\u8996\u7528\u30a2\u30ab\u30a6\u30f3\u30c8\u8ffd\u52a0 <pre><code># MySQL\u3092\u76e3\u8996\u7528\u30e6\u30fc\u30b6\nCREATE USER 'zbx_monitor'@'%' IDENTIFIED BY 'password';\nGRANT REPLICATION CLIENT,PROCESS,SHOW DATABASES,SHOW VIEW ON *.* TO 'zbx_monitor'@'%';\n</code></pre> </li> </ul> </li> </ul>"},{"location":"zabbix6/#ubuntu-zabbix","title":"Ubuntu zabbix\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb","text":"<ul> <li> <p>\u30d1\u30c3\u30b1\u30fc\u30b8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u524d\u306bca-certificates\u3092\u66f4\u65b0</p> <ul> <li> ca-certificates\u3092\u66f4\u65b0 <pre><code>apt update &amp;&amp; apt install -y ca-certificates\n</code></pre> </li> </ul> </li> <li> <p>Install Zabbix repository</p> <ul> <li> Install <pre><code># wget https://repo.zabbix.com/zabbix/6.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_6.0-1+ubuntu20.04_all.deb\n# dpkg -i zabbix-release_6.0-1+ubuntu20.04_all.deb\n# apt update\n</code></pre> </li> </ul> </li> <li> <p>apt update\u30a8\u30e9\u30fc\u6642</p> <ul> <li> update\u30a8\u30e9\u30fc\u6642 <pre><code># \"Ubuntu 20.04.4 LTS\"\u306e\u5834\u5408\u3001apt update\u6642\u30a8\u30e9\u30fc\u767a\u751f\u3059\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002\nroot@zbx-test02:~/work# apt update\nHit:1 http://ftp.tsukuba.wide.ad.jp/Linux/ubuntu focal InRelease\nHit:2 http://ftp.tsukuba.wide.ad.jp/Linux/ubuntu focal-updates InRelease\nHit:3 https://repo.zabbix.com/zabbix/6.0/ubuntu focal InRelease\nHit:4 http://archive.ubuntu.com/ubuntu focal InRelease\nGet:5 http://archive.ubuntu.com/ubuntu focal-updates InRelease [114 kB]\nGet:6 http://archive.ubuntu.com/ubuntu focal-backports InRelease [108 kB]\nGet:7 http://archive.ubuntu.com/ubuntu focal-security InRelease [114 kB]\nFetched 336 kB in 2s (135 kB/s)\nReading package lists... Done\nBuilding dependency tree\nReading state information... Done\nAll packages are up to date.\nN: Skipping acquire of configured file 'main/binary-i386/Packages' as repository 'https://repo.zabbix.com/zabbix/6.0/ubuntu focal InRelease' doesn't support architecture 'i386'\nroot@zbx-test02:~/work# l\n\n# \u5bfe\u7b56\n-- \u30c7\u30d5\u30a9\u30eb\u30c8\n# cat /etc/apt/sources.list.d/zabbix.list\ndeb https://repo.zabbix.com/zabbix/6.0/ubuntu focal main\ndeb-src https://repo.zabbix.com/zabbix/6.0/ubuntu focal main\n\n-- \u5909\u66f4\u5f8c\nroot@zbx-test02:~/work# cat /etc/apt/sources.list.d/zabbix.list\ndeb  [arch=amd64] https://repo.zabbix.com/zabbix/6.0/ubuntu focal main\ndeb-src  [arch=amd64] https://repo.zabbix.com/zabbix/6.0/ubuntu focal main\nroot@zbx-test02:~/work#\n</code></pre> </li> </ul> </li> <li> <p>Install Zabbix server, frontend, agent</p> <ul> <li> Install Zabbix server, frontend, agent <pre><code># apt install zabbix-server-mysql zabbix-frontend-php zabbix-apache-conf zabbix-sql-scripts zabbix-agent\n# apt install language-pack-ja-base language-pack-ja\n</code></pre> </li> </ul> </li> <li> <p>Create initial database</p> <ul> <li> initial database <pre><code># mysql -uroot -p\npassword\nmysql&gt; set global validate_password.policy = \"LOW\";\nmysql&gt; create database zabbix character set utf8mb4 collate utf8mb4_bin;\nmysql&gt; create user zabbix@localhost identified by 'password';\nmysql&gt; grant all privileges on zabbix.* to zabbix@localhost;\n# \u76e3\u8996\u7528\u30e6\u30fc\u30b6\u8ffd\u52a0\n## MySQL\uff15\uff0e\uff11,MySQL\uff15\uff0e5,MySQL\uff15\uff0e7\nmysql&gt; CREATE USER 'zbx_monitor'@'%' IDENTIFIED BY 'password';\nmysql&gt; GRANT REPLICATION CLIENT,PROCESS,SHOW DATABASES,SHOW VIEW ON *.* TO 'zbx_monitor'@'%';\nmysql&gt; quit;\n# MySQL4.0\u306e\u5834\u5408\n09:14:16 root@localhost[(none)]&gt; GRANT REPLICATION CLIENT,PROCESS,SHOW DATABASES ON *.* TO `zbx_monitor`@'%'  IDENTIFIED BY 'password';\n</code></pre> </li> </ul> </li> <li> <p>\u521d\u671f\u30c7\u30fc\u30bf\u306e\u6295\u5165</p> <ul> <li>On Zabbix server host import initial schema and data. You will be prompted to enter your newly created password.</li> <li> \u521d\u671f\u30c7\u30fc\u30bf\u306e\u6295\u5165 <pre><code># zcat /usr/share/doc/zabbix-sql-scripts/mysql/server.sql.gz | mysql -uzabbix -ppassword zabbix\n# NOT WORK\n# OK\nroot@zbx-test:~# cp /usr/share/doc/zabbix-sql-scripts/mysql/server.sql.gz /root/work/\nroot@zbx-test:~/work# gzip  -d server.sql.gz\nroot@zbx-test:~/work# mysql zabbix &lt; server.sql\n</code></pre> </li> </ul> </li> <li> <p>Configure the database for Zabbix server</p> <ul> <li> Configure the database for Zabbix server <pre><code>Edit file /etc/zabbix/zabbix_server.conf\n\nDBPassword=password\n</code></pre> </li> </ul> </li> <li> <p>Start Zabbix server and agent processes</p> <ul> <li> Start Zabbix server and agent processes <pre><code># systemctl restart zabbix-server zabbix-agent apache2\n# systemctl enable zabbix-server zabbix-agent apache2\n</code></pre> </li> </ul> </li> <li> <p>Font\u554f\u984c</p> <ul> <li>https://ray-channel.hateblo.jp/entry/2022/04/12/001451#Zabbix6%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB</li> <li> Font\u554f\u984c <pre><code>root@zbx-test:~/work# apt install fonts-ipafont fonts-ipafont-gothic fonts-ipafont-mincho\nroot@zbx-test:~/work# cp /usr/share/fonts/truetype/fonts-japanese-gothic.ttf /usr/share/zabbix/fonts/\u3000\u3000&lt;--\u5fc5\u8981\u306a\u3044\u304b\u3082\nroot@zbx-test:~/work# ln -sf /usr/share/fonts/opentype/ipafont-gothic/ipag.ttf /etc/alternatives/zabbix-frontend-font\n</code></pre> </li> </ul> </li> <li> <p>zabbix-agent2\u306eCentOS\uff17\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb</p> <ul> <li> zabbix-agent2\u306eCentOS\uff17\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb <pre><code>[root@node1 work]# wget https://repo.zabbix.com/zabbix/6.0/rhel/7/x86_64/zabbix-agent2-6.0.5-1.el7.x86_64.rpm --no-check-certificate\n[root@node1 work]# yum install zabbix-agent2\n</code></pre> </li> </ul> </li> <li> <p>zabbix-agent\u306eHOME\u554f\u984c(\u5fc5\u8981\u306a\u3044\u304b\u3082)</p> <ul> <li> zabbix-agent\u306eHOME\u554f\u984c <pre><code>root@zbx-test:~/work# apt install php-gd php-bcmath php-mbstring php-xml php-ldap php-json\n\n[root@node1 work]# mkdir /var/lib/zabbix\n[root@node1 work]# chown zabbix:zabbix /var/lib/zabbix\n[root@node1 work]# cp /etc/zabbix/mysql/my.cnf /var/lib/zabbix/\n[root@node1 work]#\n</code></pre> </li> </ul> </li> <li> <p>zabbix_server log level</p> <ul> <li>https://unam.hatenadiary.jp/entry/2018/03/21/143227</li> <li> zabbix_server log level <pre><code>poller\u306e\u30ec\u30d9\u30eb\u30923\u304b\u30894\u306b\u4e0a\u3052\u308b\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5165\u529b\u3057\u307e\u3059\u3002\nsudo zabbix_server -R log_level_increase=poller\n\n\u5143\u306b\u623b\u3059\u5834\u5408\nsudo zabbix_server -R log_level_decrease=poller\n</code></pre> </li> </ul> </li> <li> <p>zabbix_server db.size</p> <ul> <li> zabbix_server db.size <pre><code>root@zbx-test:~# /usr/bin/zabbix_get -s node1 -k  mysql.db.size[\"localhost\",\"zbx_monitor\",\"password\",\"information_schema\"]\n163840\nroot@zbx-test:~#\nroot@zbx-test:~# /usr/bin/zabbix_get -s node1 -k  mysql.version[\"localhost\",\"zbx_monitor\",\"password\"]\n5.7.28-log\nroot@zbx-test:~#\n</code></pre> </li> </ul> </li> <li> <p>zabbix_agent2</p> <ul> <li>agent2\u3092\u4f7f\u3046\u5834\u5408</li> <li> \u8a2d\u5b9a-&gt;\u30db\u30b9\u30c8-&gt;mysqlxxx-&gt;\u30de\u30af\u30ed <pre><code>{$MYSQL.DSN} =&gt; tcp://localhost:3306\n{$MYSQL.PASSWORD} =&gt; password\n{$MYSQL.USER} =&gt; zbx_monitor\n</code></pre> </li> <li> zabbix_agent2.conf\u306e\u8a2d\u5b9a <pre><code>[root@node1 work]# grep -v ^\\# /etc/zabbix/zabbix_agent2.d/plugins.d/mysql.conf  | grep -v ^\\$\nPlugins.Mysql.Sessions.Prod.User=zbx_monitor\nPlugins.Mysql.Sessions.Prod.Password=password\n[root@node1 work]#\n[root@node1 work]# grep -v ^\\# /etc/zabbix/zabbix_agent2.conf  | grep -v ^\\$\nPidFile=/var/run/zabbix/zabbix_agent2.pid\nHostnameItem=system.hostname\nRefreshActiveChecks=300\nBufferSize=300\nTimeout=30\nLogFile=/var/log/zabbix/zabbix_agent2.log\nLogFileSize=0\nServer=192.168.1.1\nServerActive=192.168.1.1\nHostname=Zabbix server\nInclude=/etc/zabbix/zabbix_agent2.d/*.conf\nControlSocket=/tmp/agent.sock\nInclude=./zabbix_agent2.d/plugins.d/*.conf\n[root@node1 work]#\n</code></pre> </li> <li>root\u3067zabbix_agent2\u3092\u5b9f\u884c\u3057\u305f\u3044\u5834\u5408<ul> <li>https://www.zabbix.com/documentation/current/en/manual/appendix/install/run_agent_as_root</li> <li> root\u3067zabbix_agent2\u3092\u5b9f\u884c\u3057\u305f\u3044\u5834\u5408 <pre><code>[root@node1 work]# cat /usr/lib/systemd/system/zabbix-agent2.service\n[Unit]\nDescription=Zabbix Agent 2\nAfter=syslog.target\nAfter=network.target\n\n[Service]\nEnvironment=\"CONFFILE=/etc/zabbix/zabbix_agent2.conf\"\nEnvironmentFile=-/etc/sysconfig/zabbix-agent2\nType=simple\nRestart=on-failure\nPIDFile=/run/zabbix/zabbix_agent2.pid\nKillMode=control-group\nExecStart=/usr/sbin/zabbix_agent2 -c $CONFFILE\nExecStop=/bin/kill -SIGTERM $MAINPID\nRestartSec=10s\nUser=zabbix       &lt;&lt;-- \u3053\u3053\u3092root\u306b\u5909\u66f4\nGroup=zabbix      &lt;&lt;-- \u3053\u3053\u3092root\u306b\u5909\u66f4\n\n[Install]\nWantedBy=multi-user.target\n[root@node1 work]#\n[root@node1 work]# systemctl daemon-reload\n</code></pre> </li> </ul> </li> </ul> </li> </ul>"},{"location":"zabbix6/#_2","title":"\u8b66\u544a","text":"<ul> <li> <p>MySQL: Buffer pool utilization is too low</p> <ul> <li>[ MySQL: Buffer pool utilization is too low (less than 50% for 5m)]</li> <li>MYSQL.BUFF_UTIL.MIN.WARN \u306e\u5024\u309230\u306b\u5909\u66f4\u3057\u3066\u308250\u3068\u8868\u793a\u3055\u308c\u308b\u3001\u539f\u56e0\u4e0d\u660e\u3002</li> </ul> </li> <li> <p>MySQL: Buffer pool utilization is too low (less than {$MYSQL.BUFF_UTIL.MIN.WARN}% for 5m)</p> <ul> <li>buffer pool \u306e\u4f7f\u7528\u7387\u306f30%\u4ee5\u4e0b\u306e\u305f\u3081\u3001\u8b66\u544a\u767a\u751f</li> <li>\u691c\u8a3c\u6a5f\u306e\u305f\u3081\u3001buffer pool \u306e\u4f7f\u7528\u7387\u306f\u4f4e\u3044\u306e\u3067\u3001\u8b66\u544a\u3092\u7121\u8996\u3059\u308b\u3002</li> </ul> </li> <li> <p>\u8a2d\u5b9a-&gt;\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8-&gt;MySQL by Zabbix agent 2</p> <ul> <li>{$MYSQL.BUFF_UTIL.MIN.WARN} \u3092 50 \u304b\u3089 30\u306b\u5909\u66f4\u3059\u308b\u3002</li> </ul> </li> <li> <p>MySQL: Connection errors accept per second \u306a\u3069\u306e\u53d6\u5f97\u3067\u304d\u306a\u3044\u30a2\u30a4\u30c6\u30e0</p> <ul> <li>https://dev.mysql.com/doc/refman/5.6/ja/server-status-variables.html#statvar_Connection_errors_accept</li> <li>https://cedarvalley.info/zabbix-mysql-connection_errors/ <pre><code>Connection_errors_xxx\n\n\u3053\u308c\u3089\u306e\u5909\u6570\u306f\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u63a5\u7d9a\u30d7\u30ed\u30bb\u30b9\u4e2d\u306b\u767a\u751f\u3057\u305f\u30a8\u30e9\u30fc\u306b\u3064\u3044\u3066\u306e\u60c5\u5831\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\u3053\u308c\u3089\u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u5c02\u7528\u3067\u3001\u3059\u3079\u3066\u306e\u30db\u30b9\u30c8\u304b\u3089\u306e\u63a5\u7d9a\u5168\u4f53\u3067\u96c6\u8a08\u3057\u305f\u30a8\u30e9\u30fc\u6570\u3092\u8868\u3057\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u5909\u6570\u306f\u3001\u30db\u30b9\u30c8\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u3088\u3063\u3066\u8aac\u660e\u3055\u308c\u306a\u3044\u30a8\u30e9\u30fc\u3092\u8ffd\u8de1\u3057 (\u30bb\u30af\u30b7\u30e7\u30f38.11.5.2\u300cDNS \u30eb\u30c3\u30af\u30a2\u30c3\u30d7\u306e\u6700\u9069\u5316\u3068\u30db\u30b9\u30c8\u30ad\u30e3\u30c3\u30b7\u30e5\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044)\u3001\u305f\u3068\u3048\u3070\u3001TCP \u63a5\u7d9a\u306b\u95a2\u9023\u4ed8\u3051\u3089\u308c\u306a\u3044\u30a8\u30e9\u30fc\u3084\u3001\u63a5\u7d9a\u30d7\u30ed\u30bb\u30b9\u306e\u304d\u308f\u3081\u3066\u65e9\u671f\u306b (IP \u30a2\u30c9\u30ec\u30b9\u304c\u65e2\u77e5\u3068\u306a\u308b\u524d\u3082\u542b\u3081\u3066) \u767a\u751f\u3059\u308b\u30a8\u30e9\u30fc\u3001\u307e\u305f\u306f\u7279\u5b9a\u306e IP \u30a2\u30c9\u30ec\u30b9\u306b\u56fa\u6709\u3067\u306a\u3044 (\u30e1\u30e2\u30ea\u30fc\u4e0d\u8db3\u306e\u72b6\u6cc1\u306a\u3069\u306e) \u30a8\u30e9\u30fc\u306a\u3069\u3067\u3059\u3002\u3053\u308c\u3089\u306e\u5909\u6570\u306f MySQL 5.6.5 \u3067\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002\n</code></pre></li> </ul> </li> <li> <p>\u4e0a\u8a18MySQL5.5\u3067\u53d6\u5f97\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u8907\u88fd\u3057\u3001\u5225\u540d\u306b\u4fdd\u5b58\u3057\u307e\u3057\u305f\u3002</p> <ul> <li>\u53d6\u5f97\u3067\u304d\u306a\u3044\u30a2\u30a4\u30c6\u30e0\u3092\u524a\u9664\u3059\u308b\u3002</li> <li>MySQL5.5 by Zabbix agent 2 <pre><code>MySQL: Innodb number open files\nMySQL: Connection errors accept per second\nMySQL: Connection errors internal per second\nMySQL: Connection errors max connections per second\nMySQL: Connection errors peer address per second\nMySQL: Connection errors select per second\nMySQL: Connection errors tcpwrap per second\n</code></pre></li> </ul> </li> </ul>"},{"location":"zabbix6/#mysql8","title":"MySQL8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb","text":"<ul> <li>https://www.server-world.info/query?os=Ubuntu_20.04&amp;p=mysql8&amp;f=1</li> <li>install<ul> <li> install <pre><code>apt -y install mysql-server-8.0\n</code></pre> </li> </ul> </li> <li>root \u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a<ul> <li> install <pre><code>ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password by 'password';\n</code></pre> </li> </ul> </li> <li>mysql \u521d\u671f\u5316<ul> <li> \u521d\u671f\u5316 <pre><code>root@zbx-test:~/work# mysql_secure_installation\n\nSecuring the MySQL server deployment.\n\nEnter password for user root:\n\nVALIDATE PASSWORD COMPONENT can be used to test passwords\nand improve security. It checks the strength of password\nand allows the users to set only those passwords which are\nsecure enough. Would you like to setup VALIDATE PASSWORD component?\n\nPress y|Y for Yes, any other key for No: y\n\nThere are three levels of password validation policy:\n\nLOW    Length &gt;= 8\nMEDIUM Length &gt;= 8, numeric, mixed case, and special characters\nSTRONG Length &gt;= 8, numeric, mixed case, special characters and dictionary                  file\n\nPlease enter 0 = LOW, 1 = MEDIUM and 2 = STRONG: 0\nUsing existing password for root.\n\nEstimated strength of the password: 50\nChange the password for root ? ((Press y|Y for Yes, any other key for No) : n\n\n... skipping.\nBy default, a MySQL installation has an anonymous user,\nallowing anyone to log into MySQL without having to have\na user account created for them. This is intended only for\ntesting, and to make the installation go a bit smoother.\nYou should remove them before moving into a production\nenvironment.\n\nRemove anonymous users? (Press y|Y for Yes, any other key for No) : y\nSuccess.\n\nNormally, root should only be allowed to connect from\n'localhost'. This ensures that someone cannot guess at\nthe root password from the network.\n\nDisallow root login remotely? (Press y|Y for Yes, any other key for No) : n\n\n... skipping.\nBy default, MySQL comes with a database named 'test' that\nanyone can access. This is also intended only for testing,\nand should be removed before moving into a production\nenvironment.\n\nRemove test database and access to it? (Press y|Y for Yes, any other key for No) : y\n - Dropping test database...\nSuccess.\n\n- Removing privileges on test database...\nSuccess.\n\nReloading the privilege tables will ensure that all changes\nmade so far will take effect immediately.\n\nReload privilege tables now? (Press y|Y for Yes, any other key for No) : y\nSuccess.\n\nAll done!\nroot@zbx-test:~/work#\n</code></pre> </li> </ul> </li> </ul>"},{"location":"zabbix6/#zabbix-ha","title":"Zabbix HA","text":"<ul> <li> <p>https://densan-hoshigumi.com/server/zabbix60-ha-installation#Keepalivedzbx01zbx02</p> <ul> <li> zabbix conf <pre><code>@ zabbix_server.conf\n### active                                                                                   ### standby\nroot@zbx-test:~/work# grep -v ^\\# /etc/zabbix/zabbix_server.conf  | grep -v ^\\$             \u2502root@zbx-test02:~/work# grep -v ^\\# /etc/zabbix/zabbix_server.conf  | grep -v ^\\$\nLogFile=/var/log/zabbix/zabbix_server.log                                                   \u2502LogFile=/var/log/zabbix/zabbix_server.log\nLogFileSize=0                                                                               \u2502LogFileSize=0\nPidFile=/run/zabbix/zabbix_server.pid                                                       \u2502PidFile=/run/zabbix/zabbix_server.pid\nSocketDir=/run/zabbix                                                                       \u2502SocketDir=/run/zabbix\nDBName=zabbix                                                                               \u2502DBName=zabbix\nDBUser=zabbix                                                                               \u2502DBUser=zabbix\nDBPassword=password                                                                         \u2502DBPassword=password\nDBSocket=/var/run/mysqld/mysqld.sock                                                        \u2502DBHost=192.168.1.2\nSNMPTrapperFile=/var/log/snmptrap/snmptrap.log                                              \u2502SNMPTrapperFile=/var/log/snmptrap/snmptrap.log\nTimeout=4                                                                                   \u2502Timeout=4\nFpingLocation=/usr/bin/fping                                                                \u2502FpingLocation=/usr/bin/fping\nFping6Location=/usr/bin/fping6                                                              \u2502Fping6Location=/usr/bin/fping6\nLogSlowQueries=3000                                                                         \u2502LogSlowQueries=3000\nAllowRoot=1                                                                                 \u2502AllowRoot=1\nUser=root                                                                                   \u2502User=root\nStatsAllowedIP=127.0.0.1                                                                    \u2502StatsAllowedIP=127.0.0.1\nHANodeName=zbx01                                                                            \u2502HANodeName=zbx02\nNodeAddress=192.168.1.1:10051                                                               \u2502NodeAddress=192.168.1.2:10051\nroot@zbx-test:~/work#                                                                       \u2502root@zbx-test02:~/work#\n\n@zabbix_agent2.conf\n### active                                                                                   ### standby\nroot@zbx-test:~/work# grep -v ^\\# /etc/zabbix/zabbix_agent2.conf  | grep -v ^\\$             \u2502root@zbx-test02:~/work# grep -v ^\\# /etc/zabbix/zabbix_agent2.conf  | grep -v ^\\$\nPidFile=/var/run/zabbix/zabbix_agent2.pid                                                   \u2502PidFile=/var/run/zabbix/zabbix_agent2.pid\nLogFile=/var/log/zabbix/zabbix_agent2.log                                                   \u2502LogFile=/var/log/zabbix/zabbix_agent2.log\nLogFileSize=0                                                                               \u2502LogFileSize=0\nServer=127.0.0.1,192.168.1.1,192.168.1.2                                                    \u2502Server=127.0.0.1,192.168.1.1,192.168.1.2\nServerActive=127.0.0.1,192.168.1.1,192.168.1.2                                              \u2502ServerActive=127.0.0.1,192.168.1.1,192.168.1.2\nHostname=Zabbix server                                                                      \u2502Hostname=Zabbix server\nInclude=/etc/zabbix/zabbix_agent2.d/*.conf                                                  \u2502Include=/etc/zabbix/zabbix_agent2.d/*.conf\nControlSocket=/tmp/agent.sock                                                               \u2502ControlSocket=/tmp/agent.sock\nInclude=./zabbix_agent2.d/plugins.d/*.conf                                                  \u2502Include=./zabbix_agent2.d/plugins.d/*.conf\nroot@zbx-test:~/work#                                                                       \u2502root@zbx-test02:~/work#\n</code></pre> </li> </ul> </li> <li> <p>status\u306e\u78ba\u8a8d</p> <ul> <li> status <pre><code># Active Server\nroot@zbx-test01:~/work# zabbix_server -R ha_status\nFailover delay: 60 seconds\nCluster status:\n   #  ID                        Name                      Address                        Status      Last Access\n1. cl4nhimlf00019oodk3coe857 zbx01                     192.168.1.1:10051              active      5s\n   2. cl4nlsqlk0001b9r5amp9jryp zbx02                     192.168.1.2:10051              standby     2s\nroot@zbx-test01:~/work#\n\n# Standby Server\nroot@zbx-test02:~/work# zabbix_server -R ha_status\nRuntime commands can be executed only in active mode\nroot@zbx-test02:~/work#\n</code></pre> </li> </ul> </li> <li> <p>\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u8a66\u9a13\uff08HA\u306e\u5207\u308a\u66ff\u3048\u691c\u8a3c\uff09</p> <ul> <li> Active\u3092\u505c\u6b62 <pre><code>@ \u5207\u308a\u66ff\u3048\u524d\nroot@zbx-test01:~/work# systemctl status zabbix-server.service\n\u25cf zabbix-server.service - Zabbix Server\n     Loaded: loaded (/lib/systemd/system/zabbix-server.service; enabled; vendor preset: enabled)\nActive: active (running) since Tue 2022-06-21 10:25:20 JST; 3h 2min ago\n   Main PID: 101435 (zabbix_server)\nTasks: 48 (limit: 19174)\nMemory: 57.0M\n     CGroup: /system.slice/zabbix-server.service\n             \u251c\u2500101435 /usr/sbin/zabbix_server -c /etc/zabbix/zabbix_server.conf\n             \u251c\u2500101436 /usr/sbin/zabbix_server: ha manager\n\nroot@zbx-test01:~/work# zabbix_server -R ha_status\nFailover delay: 60 seconds\nCluster status:\n   #  ID                        Name                      Address                        Status      Last Access\n1. cl4nhimlf00019oodk3coe857 zbx01                     192.168.1.1:10051              active      4s\n   2. cl4nlsqlk0001b9r5amp9jryp zbx02                     192.168.1.2:10051              standby     1s\nroot@zbx-test01:~/work#\n\nroot@zbx-test01:~/work# systemctl stop zabbix-server.service\nroot@zbx-test01:~/work# zabbix_server -R ha_status\nzabbix_server [105596]: Cannot perform runtime control command: Cannot connect to service \"rtc\": [111] Connection refused.\nroot@zbx-test01:~/work# zabbix_server -R ha_status\nzabbix_server [105598]: Cannot perform runtime control command: Cannot connect to service \"rtc\": [111] Connection refused.\nroot@zbx-test01:~/work# systemctl status zabbix-server.service\n\u25cf zabbix-server.service - Zabbix Server\n     Loaded: loaded (/lib/systemd/system/zabbix-server.service; enabled; vendor preset: enabled)\nActive: inactive (dead) since Tue 2022-06-21 13:28:51 JST; 30s ago\n    Process: 105563 ExecStop=/bin/sh -c [ -n \"$1\" ] &amp;&amp; kill -s TERM \"$1\" -- $MAINPID (code=exited, status=0/SUCCESS)\nMain PID: 101435 (code=exited, status=0/SUCCESS)\nJun 21 10:25:19 zbx-test systemd[1]: Starting Zabbix Server...\nJun 21 10:25:20 zbx-test systemd[1]: Started Zabbix Server.\nJun 21 13:28:49 zbx-test01 systemd[1]: Stopping Zabbix Server...\nJun 21 13:28:51 zbx-test01 systemd[1]: zabbix-server.service: Succeeded.\nJun 21 13:28:51 zbx-test01 systemd[1]: Stopped Zabbix Server.\nroot@zbx-test01:~/work#\n\n@ \u30ed\u30b0\u306e\u78ba\u8a8d\nroot@zbx-test01:~/work# tail -n 15  /var/log/zabbix/zabbix_server.log\n1. Failed: cannot extract value from json by path \"$.[?(@.id==\"cl4i2tw6c0001e9odvm47jvrq\")].address.first()\": no data matches the specified path\n101435:20220621:132828.196 failover delay: 60 seconds\n101435:20220621:132828.196 cluster status:\n101435:20220621:132828.196    #  ID                        Name                      Address                        Status      Last Access\n101435:20220621:132828.196    1. cl4nhimlf00019oodk3coe857 zbx01                     192.168.1.1:10051              active      4s\n101435:20220621:132828.196    2. cl4nlsqlk0001b9r5amp9jryp zbx02                     192.168.1.2:10051              standby     1s\n101435:20220621:132849.020 Got signal [signal:15(SIGTERM),sender_pid:105563,sender_uid:0,reason:0]. Exiting ...\n101436:20220621:132849.984 HA manager has been paused\n101455:20220621:132849.984 syncing history data in progress...\n101457:20220621:132850.002 syncing history data... 100.000000%\n101457:20220621:132850.002 syncing history data done\n101435:20220621:132851.002 syncing trend data...\n101435:20220621:132851.045 syncing trend data done\n101436:20220621:132851.069 HA manager has been stopped\n101435:20220621:132851.074 Zabbix Server stopped. Zabbix 6.0.5 (revision 8da3e1f8419).\nroot@zbx-test01:~/work#\n</code></pre> </li> <li> StandBy\u306e\u78ba\u8a8d <pre><code># \u5207\u308a\u66ff\u3048\u524d\nroot@zbx-test02:~/work# zabbix_server -R ha_status\nRuntime commands can be executed only in active mode\n\nroot@zbx-test02:~/work# tail -f  /var/log/zabbix/zabbix_server.log\n 14862:20220621:122723.236 IPv6 support:              YES\n 14862:20220621:122723.236 TLS support:               YES\n 14862:20220621:122723.236 ******************************\n 14862:20220621:122723.236 using configuration file: /etc/zabbix/zabbix_server.conf\n 14862:20220621:122723.293 current database version (mandatory/optional): 06000000/06000002\n 14862:20220621:122723.293 required mandatory version: 06000000\n14868:20220621:122723.324 starting HA manager\n 14868:20220621:122723.348 HA manager started in standby mode\n 14862:20220621:122723.348 \"zbx02\" node started in \"standby\" mode\n 14862:20220621:132723.338 \"zbx02\" node is working in \"standby\" mode\n\n# \u5207\u308a\u66ff\u3048\u5f8c\nroot@zbx-test02:~/work# tail -f  /var/log/zabbix/zabbix_server.log\n 14862:20220621:122723.236 IPv6 support:              YES\n 14862:20220621:122723.236 TLS support:               YES\n 14862:20220621:122723.236 ******************************\n 14862:20220621:122723.236 using configuration file: /etc/zabbix/zabbix_server.conf\n 14862:20220621:122723.293 current database version (mandatory/optional): 06000000/06000002\n 14862:20220621:122723.293 required mandatory version: 06000000\n14868:20220621:122723.324 starting HA manager\n 14868:20220621:122723.348 HA manager started in standby mode\n 14862:20220621:122723.348 \"zbx02\" node started in \"standby\" mode\n 14862:20220621:132723.338 \"zbx02\" node is working in \"standby\" mode\n\n\u2193\u2193\u2193\u3053\u3053\u304b\u3089\u5207\u308a\u66ff\u3048\u767a\u751f\n 14862:20220621:132852.342 \"zbx02\" node switched to \"active\" mode\n 14862:20220621:132852.343 server #0 started [main process]\n15461:20220621:132852.344 server #1 started [service manager #1]\n15462:20220621:132852.345 server #2 started [configuration syncer #1]\n15466:20220621:132852.630 server #3 started [alert manager #1]\n15467:20220621:132852.630 server #4 started [alerter #1]\n15468:20220621:132852.631 server #5 started [alerter #2]\n# status\u306e\u78ba\u8a8d\nroot@zbx-test02:~/work# zabbix_server -R ha_status\nFailover delay: 60 seconds\nCluster status:\n   #  ID                        Name                      Address                        Status      Last Access\n1. cl4nhimlf00019oodk3coe857 zbx01                     192.168.1.1:10051              stopped     42s\n   2. cl4nlsqlk0001b9r5amp9jryp zbx02                     192.168.1.2:10051              active      1s               &lt;- Active\u306b\u306a\u3063\u305f\u3002\nroot@zbx-test02:~/work#\n</code></pre> </li> </ul> </li> <li> <p>\u5143\u306b\u623b\u3059\u691c\u8a3c</p> <ul> <li> test02\u30b5\u30fc\u30d0\u3092\u505c\u6b62 <pre><code>root@zbx-test02:~/work# systemctl stop zabbix-server.service\nroot@zbx-test02:~/work# zabbix_server -R ha_status\nzabbix_server [15785]: Cannot perform runtime control command: Cannot connect to service \"rtc\": [111] Connection refused.\nroot@zbx-test02:~/work#\n</code></pre> </li> <li> test01\u306e\u78ba\u8a8d <pre><code>root@zbx-test01:~/work# tail -f  /var/log/zabbix/zabbix_server.log\n105884:20220621:135102.065 server #38 started [alert syncer #1]\n105885:20220621:135102.065 server #39 started [history poller #1]\n105882:20220621:135102.065 server #37 started [icmp pinger #1]\n105888:20220621:135102.066 server #40 started [history poller #2]\n105889:20220621:135102.067 server #41 started [history poller #3]\n105892:20220621:135102.068 server #42 started [history poller #4]\n105895:20220621:135102.069 server #44 started [availability manager #1]\n105898:20220621:135102.069 server #45 started [trigger housekeeper #1]\n105893:20220621:135102.070 server #43 started [history poller #5]\n105901:20220621:135102.073 server #46 started [odbc poller #1]\n^C\nroot@zbx-test01:~/work# zabbix_server -R ha_status\nFailover delay: 60 seconds\nCluster status:\n   #  ID                        Name                      Address                        Status      Last Access\n1. cl4nhimlf00019oodk3coe857 zbx01                     192.168.1.1:10051              active      3s\n   2. cl4nlsqlk0001b9r5amp9jryp zbx02                     192.168.1.2:10051              stopped     22s\nroot@zbx-test01:~/work#\n</code></pre> </li> <li> test02\u306ezabbix_server\u3092\u8d77\u52d5\u3059\u308b\u5f8c\u306e\u78ba\u8a8d <pre><code>root@zbx-test02:~/work# systemctl stop zabbix-server.service\nroot@zbx-test02:~/work# zabbix_server -R ha_status\nzabbix_server [15785]: Cannot perform runtime control command: Cannot connect to service \"rtc\": [111] Connection refused.\nroot@zbx-test02:~/work# systemctl start zabbix-server.service\nroot@zbx-test02:~/work# zabbix_server -R ha_status\nRuntime commands can be executed only in active mode\nroot@zbx-test02:~/work#\n\nroot@zbx-test01:~/work# zabbix_server -R ha_status\nFailover delay: 60 seconds\nCluster status:\n   #  ID                        Name                      Address                        Status      Last Access\n1. cl4nhimlf00019oodk3coe857 zbx01                     192.168.1.1:10051              active      4s\n   2. cl4nlsqlk0001b9r5amp9jryp zbx02                     192.168.1.2:10051              standby     5s\nroot@zbx-test01:~/work#\n</code></pre> </li> </ul> </li> </ul>"},{"location":"zabbix6/#_3","title":"\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u3064\u3044\u3066","text":"<ul> <li>zabbix-agent2-6.0.5</li> <li>https://git.zabbix.com/projects/ZBX/repos/zabbix/browse/templates/db/mysql_agent2?at=release%2F6.0</li> </ul> <p>\u516c\u5f0f\u3067\u306f\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3000MySQL by Zabbix agent 2\u3000\u304c\u30b5\u30dd\u30fc\u30c8\u306e\u306fMySQL, version 5.7, 8.0\u3060\u3051\u3067\u3059\u3002</p> <p>\u691c\u8a3c\u3057\u305f\u3068\u3053\u308d\u3001</p> <ul> <li>MySQL5.7\u30018.0\u304c\u30d5\u30eb\u5bfe\u5fdc\u3002</li> <li>MySQL5.5\u306f\u307b\u307c\u5168\u90e8\u5bfe\u5fdc\u3057\u3066\u304a\u308a\u307e\u3059\u3001\u4e00\u90e8\u5bfe\u5fdc\u3057\u3066\u306a\u3044\u3002</li> <li>MySQL5.1\u306fInnoDB\u304c\u672a\u63d0\u4f9b\u306e\u305f\u3081\u3001InnoDB\u7cfb\u306e\u30a2\u30a4\u30c6\u30e0\u5024\u304c\u5168\u90e8\u53d6\u308c\u306a\u3044\u3002</li> <li>MySQL4.0\u306e\u5834\u5408\u3001Angent\u304cmysql\u306b\u63a5\u7d9a\u3059\u3089\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u5168\u90e8\u30a2\u30a4\u30c6\u30e0\u5024\u53d6\u308c\u306a\u3044\u3002</li> </ul>"},{"location":"zabbix6/#zabbix_server","title":"zabbix_server\u304b\u3089\u53d6\u5f97\u3057\u305f\u60c5\u5831","text":"<ul> <li>\u53d6\u5f97\u3057\u305f\u60c5\u5831<ul> <li> \u53d6\u5f97\u3057\u305f\u60c5\u5831 <pre><code># mysql5.1\n/usr/bin/zabbix_get -s mysql5.1-node1 -p 10059 -k  mysql.get_status_variables[\"tcp://localhost:3306\",\"zbx_monitor\",\"password\"]   | jq .\n\n\"Compression\": \"OFF\",\n  \"Connections\": \"5407307\",\n  \"Created_tmp_disk_tables\": \"276515\",\n  \"Created_tmp_files\": \"0\",\n  \"Created_tmp_tables\": \"4895334\",\n  \"Delayed_errors\": \"0\",\n  \"Delayed_insert_threads\": \"0\",\n  \"Delayed_writes\": \"0\",\n  \"Flush_commands\": \"121\",\n  \"Handler_commit\": \"0\",\n  \"Handler_delete\": \"3\",\n\n# mysql5.5\n/usr/bin/zabbix_get -s mysql5.5-node2 -p 10059 -k  mysql.get_status_variables[\"tcp://localhost:3306\",\"zbx_monitor\",\"password\"]   | jq .\n\n\"Compression\": \"OFF\",\n  \"Connections\": \"2259865\",\n  \"Created_tmp_disk_tables\": \"116820\",\n\n# mysql5.7\n/usr/bin/zabbix_get -s mysql5.7.node3 -p 10059 -k  mysql.get_status_variables[\"tcp://localhost:3306\",\"zbx_monitor\",\"password\"]   | jq .\n\n\"Compression\": \"OFF\",\n  \"Connection_errors_accept\": \"0\",\n  \"Connection_errors_internal\": \"0\",\n  \"Connection_errors_max_connections\": \"0\",\n  \"Connection_errors_peer_address\": \"0\",\n  \"Connection_errors_select\": \"0\",\n  \"Connection_errors_tcpwrap\": \"0\",\n  \"Connections\": \"280335\",\n  \"Innodb_log_waits\": \"0\",\n  \"Innodb_log_write_requests\": \"27025149\",\n  \"Innodb_log_writes\": \"30731\",\n  \"Innodb_num_open_files\": \"89\",\n  \"Innodb_os_log_fsyncs\": \"33722\",\n  \"Innodb_os_log_pending_fsyncs\": \"0\",\n  \"Innodb_os_log_pending_writes\": \"0\",\n</code></pre> </li> </ul> </li> </ul>"},{"location":"zabbix6/#zabbix","title":"zabbix \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u4e0a\u5bfe\u5fdc\u3057\u3066\u306a\u3044\u30a2\u30a4\u30c6\u30e0","text":"<ul> <li> \u5bfe\u5fdc\u3057\u3066\u306a\u3044\u30a2\u30a4\u30c6\u30e0 <pre><code># MySQL5.5\nMySQL\uff15\uff0e\uff15\u306f\u4e0b\u8a18\u306e\u60c5\u5831\u304c\u6700\u521d\u304b\u3089\u306a\u3044\u305f\u3081\u3001\u53d6\u5f97\u4e0d\u53ef\n\nMySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: Connection errors accept per second              mysql.connection_errors_accept.rate               7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: connections MySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: Connection errors internal per second            mysql.connection_errors_internal.rate             7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: connections MySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: Connection errors max connections per second     mysql.connection_errors_max_connections.rate      7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: connections MySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: Connection errors peer address per second        mysql.connection_errors_peer_address.rate         7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: connections MySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: Connection errors select per second              mysql.connection_errors_select.rate               7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: connections MySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: Connection errors tcpwrap per second             mysql.connection_errors_tcpwrap.rate              7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: connections\nMySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: Innodb number open files                         mysql.innodb_num_open_files                       7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: innodbcomponent: system\n\n# MySQL5.1\nMySQL\uff15\uff0e\uff11\u306fInnoDB\u7cfb\u60c5\u5831\u304c\u6700\u521d\u304b\u3089\u306a\u3044\u305f\u3081\u3001\u53d6\u5f97\u4e0d\u53ef\n\nMySQL by Zabbix agent 2: MySQL: Buffer pool efficiency                                                        mysql.buffer_pool_efficiency                 1m   7d 365d    \u8a08\u7b97          \u53d6\u5f97\u4e0d\u53ef    component: memory\nMySQL by Zabbix agent 2: MySQL: Buffer pool utilization                                                       mysql.buffer_pool_utilization                1m   7d 365d    \u8a08\u7b97          \u53d6\u5f97\u4e0d\u53ef    component: memory\nMySQL by Zabbix agent 2: MySQL: Calculated value of innodb_log_file_size                                      mysql.innodb_log_file_size                   1m   7d 365d    \u8a08\u7b97          \u53d6\u5f97\u4e0d\u53ef    component: system\nMySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: InnoDB buffer pool pages free                    mysql.innodb_buffer_pool_pages_free               7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: innodbcomponent: memory MySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: InnoDB buffer pool pages total                   mysql.innodb_buffer_pool_pages_total              7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: innodbcomponent: memory MySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: InnoDB buffer pool read requests                 mysql.innodb_buffer_pool_read_requests            7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: innodbcomponent: memory MySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: InnoDB buffer pool read requests per second      mysql.innodb_buffer_pool_read_requests.rate       7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: innodbcomponent: memory MySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: InnoDB buffer pool reads                         mysql.innodb_buffer_pool_reads                    7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: innodbcomponent: memory MySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: InnoDB buffer pool reads per second              mysql.innodb_buffer_pool_reads.rate               7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: innodbcomponent: memory MySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: Innodb buffer pool wait free                     mysql.innodb_buffer_pool_wait_free                7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: innodbcomponent: memory MySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: Innodb log written                               mysql.innodb_os_log_written                       7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: system  MySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: Innodb number open files                         mysql.innodb_num_open_files                       7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: innodbcomponent: system MySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: InnoDB row lock time                             mysql.innodb_row_lock_time                        7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: innodbcomponent: tables MySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: InnoDB row lock time max                         mysql.innodb_row_lock_time_max                    7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: innodbcomponent: tables MySQL by Zabbix agent 2: MySQL: Get status variables: MySQL: InnoDB row lock waits                            mysql.innodb_row_lock_waits                       7d 365d    \u4f9d\u5b58\u30a2\u30a4\u30c6\u30e0  \u53d6\u5f97\u4e0d\u53ef    component: innodbcomponent: tables </code></pre> </li> </ul>"},{"location":"zabbix6/#mysql40","title":"MySQL4.0\u306e\u7279\u5225\u5bfe\u5fdc","text":"<p>zabbix-agent2\u304cmysql4.0\u5bfe\u5fdc\u3057\u3066\u306a\u3044\u305f\u3081\u3001MySQL\u60c5\u5831\u53d6\u5f97\u65b9\u6cd5\u3092\u5909\u66f4\u3059\u308b\u3002</p> <ul> <li>\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u65b0\u305f\u306b\u4f5c\u6210\u3059\u308b\u3002<ul> <li><code>MySQL_40_by_Zabbix_agent_2</code></li> </ul> </li> <li>MySQL: Get status variables \u306e\u30a2\u30a4\u30c6\u30e0\u3092\u60c5\u5831\u53d6\u5f97\u3059\u308b\u305f\u3081\u3001\u30ad\u30fc\u3092\u5909\u66f4\u3059\u308b\u3002<ul> <li><code>mysql4.get_status_variables</code></li> </ul> </li> <li>MySQL: Status \u306e\u30a2\u30a4\u30c6\u30e0\u3092\u60c5\u5831\u53d6\u5f97\u3059\u308b\u305f\u3081\u3001\u30ad\u30fc\u3092\u5909\u66f4\u3059\u308b\u3002<ul> <li><code>mysql4.ping</code></li> </ul> </li> <li>MySQL: Version \u306e\u30a2\u30a4\u30c6\u30e0\u3092\u60c5\u5831\u53d6\u5f97\u3059\u308b\u305f\u3081\u3001\u30ad\u30fc\u3092\u5909\u66f4\u3059\u308b\u3002<ul> <li><code>mysql4.version</code></li> </ul> </li> </ul>"},{"location":"zabbix6/#agentconf","title":"agent\u5074\u306econf\u8a2d\u5b9a","text":"<ul> <li> agent\u5074\u306econf\u8a2d\u5b9a <pre><code>[root@mysql4.0-node ~]# cat /etc/zabbix/zabbix_agent2.d/userparametart_mysql.conf  | grep -v ^# | grep -v ^$\nUserParameter=mysql4.get_status_variables, /usr/bin/mysql  -sNX -e \"show status;\"| /usr/local/bin/jc --xml  | /usr/bin/jq -r '.resultset.row'  | /usr/bin/jq 'reduce .[] as $p ({}; .[$p.Variable_name] = $p.Value)' | /usr/bin/jq -r '@json'\nUserParameter=mysql4.version[*], /usr/bin/mysqladmin --defaults-extra-file=/root/.my.cnf version\nUserParameter=mysql4.ping,/usr/bin/mysqladmin --defaults-extra-file=/root/.my.cnf ping | grep -c alive\nUserParameter=mysql4.status[*],/usr/bin/mysql --defaults-extra-file=/root/.my.cnf -BNe \"show status like '$1';\" | awk '{print $$2}'\nUserParameter=mysql4.variables[*],/usr/bin/mysql --defaults-extra-file=/root/.my.cnf -BNe \"show variables like '$1';\" | awk '{print $$2}'\n[root@mysql4.0-node ~]#\n</code></pre> </li> </ul>"},{"location":"%E4%B8%80%E8%A1%8C-Python-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%B9%B6%E8%A1%8C/","title":"\u4e00\u884c Python \u4ee3\u7801\u5b9e\u73b0\u5e76\u884c","text":"<ul> <li>\u539f\u6587</li> </ul> <p>Python \u5728\u7a0b\u5e8f\u5e76\u884c\u5316\u65b9\u9762\u591a\u5c11\u6709\u4e9b\u58f0\u540d\u72fc\u85c9\u3002\u6487\u5f00\u6280\u672f\u4e0a\u7684\u95ee\u9898\uff0c\u4f8b\u5982\u7ebf\u7a0b\u7684\u5b9e\u73b0\u548c GIL1\uff0c\u6211\u89c9\u5f97\u9519\u8bef\u7684\u6559\u5b66\u6307\u5bfc\u624d\u662f\u4e3b\u8981\u95ee\u9898\u3002 \u5e38\u89c1\u7684\u7ecf\u5178 Python \u591a\u7ebf\u7a0b\u3001\u591a\u8fdb\u7a0b\u6559\u7a0b\u591a\u663e\u5f97\u504f\u201c\u91cd\u201d\u3002\u800c\u4e14\u5f80\u5f80\u9694\u9774\u6414\u75d2\uff0c\u6ca1\u6709\u6df1\u5165\u63a2\u8ba8\u65e5\u5e38\u5de5\u4f5c\u4e2d\u6700\u6709\u7528\u7684\u5185\u5bb9\u3002</p>"},{"location":"%E4%B8%80%E8%A1%8C-Python-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%B9%B6%E8%A1%8C/#_1","title":"\u4f20\u7edf\u7684\u4f8b\u5b50","text":"<p>\u7b80\u5355\u641c\u7d22\u4e0b\u201cPython \u591a\u7ebf\u7a0b\u6559\u7a0b\u201d\uff0c\u4e0d\u96be\u53d1\u73b0\u51e0\u4e4e\u6240\u6709\u7684\u6559\u7a0b\u90fd\u7ed9\u51fa\u6d89\u53ca\u7c7b\u548c\u961f\u5217\u7684\u4f8b\u5b50\uff1a</p> <pre><code>#Example.py\n'''\nStandard Producer/Consumer Threading Pattern\n'''\nimport time \nimport threading \nimport Queue \nclass Consumer(threading.Thread): \ndef __init__(self, queue): \nthreading.Thread.__init__(self)\nself._queue = queue \ndef run(self):\nwhile True: \n# queue.get() blocks the current thread until \n# an item is retrieved. \nmsg = self._queue.get() \n# Checks if the current message is \n# the \"Poison Pill\"\nif isinstance(msg, str) and msg == 'quit':\n# if so, exists the loop\nbreak\n# \"Processes\" (or in our case, prints) the queue item    \nprint \"I'm a thread, and I received %s!!\" % msg\n# Always be friendly! \nprint 'Bye byes!'\ndef Producer():\n# Queue is used to share items between\n# the threads.\nqueue = Queue.Queue()\n# Create an instance of the worker\nworker = Consumer(queue)\n# start calls the internal run() method to \n# kick off the thread\nworker.start() \n# variable to keep track of when we started\nstart_time = time.time() \n# While under 5 seconds.. \nwhile time.time() - start_time &lt; 5: \n# \"Produce\" a piece of work and stick it in \n# the queue for the Consumer to process\nqueue.put('something at %s' % time.time())\n# Sleep a bit just to avoid an absurd number of messages\ntime.sleep(1)\n# This the \"poison pill\" method of killing a thread. \nqueue.put('quit')\n# wait for the thread to close down\nworker.join()\nif __name__ == '__main__':\nProducer()\n</code></pre> <p>\u54c8\uff0c\u770b\u8d77\u6765\u6709\u4e9b\u50cf Java \u4e0d\u662f\u5417\uff1f</p> <p>\u6211\u5e76\u4e0d\u662f\u8bf4\u4f7f\u7528\u751f\u4ea7\u8005/\u6d88\u8d39\u8005\u6a21\u578b\u5904\u7406\u591a\u7ebf\u7a0b/\u591a\u8fdb\u7a0b\u4efb\u52a1\u662f\u9519\u8bef\u7684\uff08\u4e8b\u5b9e\u4e0a\uff0c\u8fd9\u4e00\u6a21\u578b\u81ea\u6709\u5176\u7528\u6b66\u4e4b\u5730\uff09\u3002\u53ea\u662f\uff0c\u5904\u7406\u65e5\u5e38\u811a\u672c\u4efb\u52a1\u65f6\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u66f4\u6709\u6548\u7387\u7684\u6a21\u578b\u3002</p>"},{"location":"%E4%B8%80%E8%A1%8C-Python-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%B9%B6%E8%A1%8C/#_2","title":"\u95ee\u9898\u5728\u4e8e\u2026","text":"<p>\u9996\u5148\uff0c\u4f60\u9700\u8981\u4e00\u4e2a\u6837\u677f\u7c7b\uff1b \u5176\u6b21\uff0c\u4f60\u9700\u8981\u4e00\u4e2a\u961f\u5217\u6765\u4f20\u9012\u5bf9\u8c61\uff1b \u800c\u4e14\uff0c\u4f60\u8fd8\u9700\u8981\u5728\u901a\u9053\u4e24\u7aef\u90fd\u6784\u5efa\u76f8\u5e94\u7684\u65b9\u6cd5\u6765\u534f\u52a9\u5176\u5de5\u4f5c\uff08\u5982\u679c\u9700\u60f3\u8981\u8fdb\u884c\u53cc\u5411\u901a\u4fe1\u6216\u662f\u4fdd\u5b58\u7ed3\u679c\u8fd8\u9700\u8981\u518d\u5f15\u5165\u4e00\u4e2a\u961f\u5217\uff09\u3002</p>"},{"location":"%E4%B8%80%E8%A1%8C-Python-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%B9%B6%E8%A1%8C/#worker","title":"worker \u8d8a\u591a\uff0c\u95ee\u9898\u8d8a\u591a","text":"<p>\u6309\u7167\u8fd9\u4e00\u601d\u8def\uff0c\u4f60\u73b0\u5728\u9700\u8981\u4e00\u4e2a worker \u7ebf\u7a0b\u7684\u7ebf\u7a0b\u6c60\u3002\u4e0b\u9762\u662f\u4e00\u7bc7 IBM \u7ecf\u5178\u6559\u7a0b \u4e2d\u7684\u4f8b\u5b50\u2014\u2014\u5728\u8fdb\u884c\u7f51\u9875\u68c0\u7d22\u65f6\u901a\u8fc7\u591a\u7ebf\u7a0b\u8fdb\u884c\u52a0\u901f\u3002 <pre><code>#Example2.py\n'''\nA more realistic thread pool example \n'''\nimport time \nimport threading \nimport Queue \nimport urllib2 \nclass Consumer(threading.Thread): \ndef __init__(self, queue): \nthreading.Thread.__init__(self)\nself._queue = queue \ndef run(self):\nwhile True: \ncontent = self._queue.get() \nif isinstance(content, str) and content == 'quit':\nbreak\nresponse = urllib2.urlopen(content)\nprint 'Bye byes!'\ndef Producer():\nurls = [\n'http://www.python.org', 'http://www.yahoo.com'\n'http://www.scala.org', 'http://www.google.com'\n# etc.. \n]\nqueue = Queue.Queue()\nworker_threads = build_worker_pool(queue, 4)\nstart_time = time.time()\n# Add the urls to process\nfor url in urls: \nqueue.put(url)  \n# Add the poison pillv\nfor worker in worker_threads:\nqueue.put('quit')\nfor worker in worker_threads:\nworker.join()\nprint 'Done! Time taken: {}'.format(time.time() - start_time)\ndef build_worker_pool(queue, size):\nworkers = []\nfor _ in range(size):\nworker = Consumer(queue)\nworker.start() \nworkers.append(worker)\nreturn workers\nif __name__ == '__main__':\nProducer()\n</code></pre></p> <p>\u8fd9\u6bb5\u4ee3\u7801\u80fd\u6b63\u786e\u7684\u8fd0\u884c\uff0c\u4f46\u4ed4\u7ec6\u770b\u770b\u6211\u4eec\u9700\u8981\u505a\u4e9b\u4ec0\u4e48\uff1a\u6784\u9020\u4e0d\u540c\u7684\u65b9\u6cd5\u3001\u8ffd\u8e2a\u4e00\u7cfb\u5217\u7684\u7ebf\u7a0b\uff0c\u8fd8\u6709\u4e3a\u4e86\u89e3\u51b3\u607c\u4eba\u7684\u6b7b\u9501\u95ee\u9898\uff0c\u6211\u4eec\u9700\u8981\u8fdb\u884c\u4e00\u7cfb\u5217\u7684 join \u64cd\u4f5c\u3002\u8fd9\u8fd8\u53ea\u662f\u5f00\u59cb\u2026\u2026</p> <p>\u81f3\u6b64\u6211\u4eec\u56de\u987e\u4e86\u7ecf\u5178\u7684\u591a\u7ebf\u7a0b\u6559\u7a0b\uff0c\u591a\u5c11\u6709\u4e9b\u7a7a\u6d1e\u4e0d\u662f\u5417\uff1f\u6837\u677f\u5316\u800c\u4e14\u6613\u51fa\u9519\uff0c\u8fd9\u6837\u4e8b\u500d\u529f\u534a\u7684\u98ce\u683c\u663e\u7136\u4e0d\u90a3\u4e48\u9002\u5408\u65e5\u5e38\u4f7f\u7528\uff0c\u597d\u5728\u6211\u4eec\u8fd8\u6709\u66f4\u597d\u7684\u65b9\u6cd5\u3002</p>"},{"location":"%E4%B8%80%E8%A1%8C-Python-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%B9%B6%E8%A1%8C/#map","title":"\u4f55\u4e0d\u8bd5\u8bd5 map","text":"<p>map \u8fd9\u4e00\u5c0f\u5de7\u7cbe\u81f4\u7684\u51fd\u6570\u662f\u7b80\u6377\u5b9e\u73b0 Python \u7a0b\u5e8f\u5e76\u884c\u5316\u7684\u5173\u952e\u3002map \u6e90\u4e8e Lisp \u8fd9\u7c7b\u51fd\u6570\u5f0f\u7f16\u7a0b\u8bed\u8a00\u3002\u5b83\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u5e8f\u5217\u5b9e\u73b0\u4e24\u4e2a\u51fd\u6570\u4e4b\u95f4\u7684\u6620\u5c04\u3002</p> <pre><code>    urls = ['http://www.yahoo.com', 'http://www.reddit.com']\n    results = map(urllib2.urlopen, urls)\n</code></pre> <p>\u4e0a\u9762\u7684\u8fd9\u4e24\u884c\u4ee3\u7801\u5c06 urls \u8fd9\u4e00\u5e8f\u5217\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u5230 urlopen \u65b9\u6cd5\u4e2d\uff0c\u5e76\u5c06\u6240\u6709\u7ed3\u679c\u4fdd\u5b58\u5230 results \u8fd9\u4e00\u5217\u8868\u4e2d\u3002\u5176\u7ed3\u679c\u5927\u81f4\u76f8\u5f53\u4e8e\uff1a</p> <pre><code>results = []\nfor url in urls: \n    results.append(urllib2.urlopen(url))\n</code></pre> <p>map \u51fd\u6570\u4e00\u624b\u5305\u529e\u4e86\u5e8f\u5217\u64cd\u4f5c\u3001\u53c2\u6570\u4f20\u9012\u548c\u7ed3\u679c\u4fdd\u5b58\u7b49\u4e00\u7cfb\u5217\u7684\u64cd\u4f5c\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8fd9\u5f88\u91cd\u8981\u5462\uff1f\u8fd9\u662f\u56e0\u4e3a\u501f\u52a9\u6b63\u786e\u7684\u5e93\uff0cmap \u53ef\u4ee5\u8f7b\u677e\u5b9e\u73b0\u5e76\u884c\u5316\u64cd\u4f5c\u3002</p> <p></p> <p>\u5728 Python \u4e2d\u6709\u4e2a\u4e24\u4e2a\u5e93\u5305\u542b\u4e86 map \u51fd\u6570\uff1a multiprocessing \u548c\u5b83\u9c9c\u4e3a\u4eba\u77e5\u7684\u5b50\u5e93 multiprocessing.dummy.</p> <p>\u8fd9\u91cc\u591a\u626f\u4e24\u53e5\uff1a multiprocessing.dummy\uff1f mltiprocessing \u5e93\u7684\u7ebf\u7a0b\u7248\u514b\u9686\uff1f\u8fd9\u662f\u867e\u7c73\uff1f\u5373\u4fbf\u5728 multiprocessing \u5e93\u7684\u5b98\u65b9\u6587\u6863\u91cc\u5173\u4e8e\u8fd9\u4e00\u5b50\u5e93\u4e5f\u53ea\u6709\u4e00\u53e5\u76f8\u5173\u63cf\u8ff0\u3002\u800c\u8fd9\u53e5\u63cf\u8ff0\u8bd1\u6210\u4eba\u8bdd\u57fa\u672c\u5c31\u662f\u8bf4:\"\u561b\uff0c\u6709\u8fd9\u4e48\u4e2a\u4e1c\u897f\uff0c\u4f60\u77e5\u9053\u5c31\u6210.\"\u76f8\u4fe1\u6211\uff0c\u8fd9\u4e2a\u5e93\u88ab\u4e25\u91cd\u4f4e\u4f30\u4e86\uff01</p> <p>dummy \u662f multiprocessing \u6a21\u5757\u7684\u5b8c\u6574\u514b\u9686\uff0c\u552f\u4e00\u7684\u4e0d\u540c\u5728\u4e8e multiprocessing \u4f5c\u7528\u4e8e\u8fdb\u7a0b\uff0c\u800c dummy \u6a21\u5757\u4f5c\u7528\u4e8e\u7ebf\u7a0b\uff08\u56e0\u6b64\u4e5f\u5305\u62ec\u4e86 Python \u6240\u6709\u5e38\u89c1\u7684\u591a\u7ebf\u7a0b\u9650\u5236\uff09\u3002 \u6240\u4ee5\u66ff\u6362\u4f7f\u7528\u8fd9\u4e24\u4e2a\u5e93\u5f02\u5e38\u5bb9\u6613\u3002\u4f60\u53ef\u4ee5\u9488\u5bf9 IO \u5bc6\u96c6\u578b\u4efb\u52a1\u548c CPU \u5bc6\u96c6\u578b\u4efb\u52a1\u6765\u9009\u62e9\u4e0d\u540c\u7684\u5e93\u3002</p>"},{"location":"%E4%B8%80%E8%A1%8C-Python-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%B9%B6%E8%A1%8C/#_3","title":"\u52a8\u624b\u5c1d\u8bd5","text":"<p>\u4f7f\u7528\u4e0b\u9762\u7684\u4e24\u884c\u4ee3\u7801\u6765\u5f15\u7528\u5305\u542b\u5e76\u884c\u5316 map \u51fd\u6570\u7684\u5e93\uff1a</p> <pre><code>from multiprocessing import Pool\nfrom multiprocessing.dummy import Pool as ThreadPool\n</code></pre> <p>\u5b9e\u4f8b\u5316 Pool \u5bf9\u8c61\uff1a</p> <pre><code>pool = ThreadPool()\n</code></pre> <p>\u8fd9\u6761\u7b80\u5355\u7684\u8bed\u53e5\u66ff\u4ee3\u4e86 example2.py \u4e2d build_worker_pool \u51fd\u6570 7 \u884c\u4ee3\u7801\u7684\u5de5\u4f5c\u3002\u5b83\u751f\u6210\u4e86\u4e00\u7cfb\u5217\u7684 worker \u7ebf\u7a0b\u5e76\u5b8c\u6210\u521d\u59cb\u5316\u5de5\u4f5c\u3001\u5c06\u5b83\u4eec\u50a8\u5b58\u5728\u53d8\u91cf\u4e2d\u4ee5\u65b9\u4fbf\u8bbf\u95ee\u3002</p> <p>Pool \u5bf9\u8c61\u6709\u4e00\u4e9b\u53c2\u6570\uff0c\u8fd9\u91cc\u6211\u6240\u9700\u8981\u5173\u6ce8\u7684\u53ea\u662f\u5b83\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\uff1aprocesses. \u8fd9\u4e00\u53c2\u6570\u7528\u4e8e\u8bbe\u5b9a\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u6570\u3002\u5176\u9ed8\u8ba4\u503c\u4e3a\u5f53\u524d\u673a\u5668 CPU \u7684\u6838\u6570\u3002</p> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u6267\u884c CPU \u5bc6\u96c6\u578b\u4efb\u52a1\u65f6\uff0c\u8c03\u7528\u8d8a\u591a\u7684\u6838\u901f\u5ea6\u5c31\u8d8a\u5feb\u3002\u4f46\u662f\u5f53\u5904\u7406\u7f51\u7edc\u5bc6\u96c6\u578b\u4efb\u52a1\u65f6\uff0c\u4e8b\u60c5\u6709\u6709\u4e9b\u96be\u4ee5\u9884\u8ba1\u4e86\uff0c\u901a\u8fc7\u5b9e\u9a8c\u6765\u786e\u5b9a\u7ebf\u7a0b\u6c60\u7684\u5927\u5c0f\u624d\u662f\u660e\u667a\u7684\u3002</p> <pre><code>pool = ThreadPool(4) # Sets the pool size to 4\n</code></pre> <p>\u7ebf\u7a0b\u6570\u8fc7\u591a\u65f6\uff0c\u5207\u6362\u7ebf\u7a0b\u6240\u6d88\u8017\u7684\u65f6\u95f4\u751a\u81f3\u4f1a\u8d85\u8fc7\u5b9e\u9645\u5de5\u4f5c\u65f6\u95f4\u3002\u5bf9\u4e8e\u4e0d\u540c\u7684\u5de5\u4f5c\uff0c\u901a\u8fc7\u5c1d\u8bd5\u6765\u627e\u5230\u7ebf\u7a0b\u6c60\u5927\u5c0f\u7684\u6700\u4f18\u503c\u662f\u4e2a\u4e0d\u9519\u7684\u4e3b\u610f\u3002</p> <p>\u521b\u5efa\u597d Pool \u5bf9\u8c61\u540e\uff0c\u5e76\u884c\u5316\u7684\u7a0b\u5e8f\u4fbf\u547c\u4e4b\u6b32\u51fa\u4e86\u3002\u6211\u4eec\u6765\u770b\u770b\u6539\u5199\u540e\u7684 example2.py</p> <pre><code>import urllib2 \nfrom multiprocessing.dummy import Pool as ThreadPool \nurls = [\n'http://www.python.org', \n'http://www.python.org/about/',\n'http://www.onlamp.com/pub/a/python/2003/04/17/metaclasses.html',\n'http://www.python.org/doc/',\n'http://www.python.org/download/',\n'http://www.python.org/getit/',\n'http://www.python.org/community/',\n'https://wiki.python.org/moin/',\n'http://planet.python.org/',\n'https://wiki.python.org/moin/LocalUserGroups',\n'http://www.python.org/psf/',\n'http://docs.python.org/devguide/',\n'http://www.python.org/community/awards/'\n# etc.. \n]\n# Make the Pool of workers\npool = ThreadPool(4) \n# Open the urls in their own threads\n# and return the results\nresults = pool.map(urllib2.urlopen, urls)\n#close the pool and wait for the work to finish \npool.close() \npool.join() \n</code></pre> <p>\u5b9e\u9645\u8d77\u4f5c\u7528\u7684\u4ee3\u7801\u53ea\u6709 4 \u884c\uff0c\u5176\u4e2d\u53ea\u6709\u4e00\u884c\u662f\u5173\u952e\u7684\u3002map \u51fd\u6570\u8f7b\u800c\u6613\u4e3e\u7684\u53d6\u4ee3\u4e86\u524d\u6587\u4e2d\u8d85\u8fc7 40 \u884c\u7684\u4f8b\u5b50\u3002\u4e3a\u4e86\u66f4\u6709\u8da3\u4e00\u4e9b\uff0c\u6211\u7edf\u8ba1\u4e86\u4e0d\u540c\u65b9\u6cd5\u3001\u4e0d\u540c\u7ebf\u7a0b\u6c60\u5927\u5c0f\u7684\u8017\u65f6\u60c5\u51b5\u3002</p> <pre><code># results = [] \n# for url in urls:\n#   result = urllib2.urlopen(url)\n#   results.append(result)\n\n# # ------- VERSUS ------- # \n\n# # ------- 4 Pool ------- # \n# pool = ThreadPool(4) \n# results = pool.map(urllib2.urlopen, urls)\n\n# # ------- 8 Pool ------- # \n\n# pool = ThreadPool(8) \n# results = pool.map(urllib2.urlopen, urls)\n\n# # ------- 13 Pool ------- # \n\n# pool = ThreadPool(13) \n# results = pool.map(urllib2.urlopen, urls)\n</code></pre> <p>\u7ed3\u679c\uff1a</p> <pre><code>#        Single thread:  14.4 Seconds \n#               4 Pool:   3.1 Seconds\n#               8 Pool:   1.4 Seconds\n#              13 Pool:   1.3 Seconds\n</code></pre> <p>\u5f88\u68d2\u7684\u7ed3\u679c\u4e0d\u662f\u5417\uff1f\u8fd9\u4e00\u7ed3\u679c\u4e5f\u8bf4\u660e\u4e86\u4e3a\u4ec0\u4e48\u8981\u901a\u8fc7\u5b9e\u9a8c\u6765\u786e\u5b9a\u7ebf\u7a0b\u6c60\u7684\u5927\u5c0f\u3002\u5728\u6211\u7684\u673a\u5668\u4e0a\u5f53\u7ebf\u7a0b\u6c60\u5927\u5c0f\u5927\u4e8e 9 \u5e26\u6765\u7684\u6536\u76ca\u5c31\u5341\u5206\u6709\u9650\u4e86\u3002</p>"},{"location":"%E4%B8%80%E8%A1%8C-Python-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%B9%B6%E8%A1%8C/#_4","title":"\u53e6\u4e00\u4e2a\u771f\u5b9e\u7684\u4f8b\u5b50","text":"<p>\u751f\u6210\u4e0a\u5343\u5f20\u56fe\u7247\u7684\u7f29\u7565\u56fe \u8fd9\u662f\u4e00\u4e2a CPU \u5bc6\u96c6\u578b\u7684\u4efb\u52a1\uff0c\u5e76\u4e14\u5341\u5206\u9002\u5408\u8fdb\u884c\u5e76\u884c\u5316\u3002</p>"},{"location":"%E4%B8%80%E8%A1%8C-Python-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%B9%B6%E8%A1%8C/#_5","title":"\u57fa\u7840\u5355\u8fdb\u7a0b\u7248\u672c","text":"<pre><code>import os \nimport PIL \nfrom multiprocessing import Pool \nfrom PIL import Image\nSIZE = (75,75)\nSAVE_DIRECTORY = 'thumbs'\ndef get_image_paths(folder):\nreturn (os.path.join(folder, f) \nfor f in os.listdir(folder) \nif 'jpeg' in f)\ndef create_thumbnail(filename): \nim = Image.open(filename)\nim.thumbnail(SIZE, Image.ANTIALIAS)\nbase, fname = os.path.split(filename) \nsave_path = os.path.join(base, SAVE_DIRECTORY, fname)\nim.save(save_path)\nif __name__ == '__main__':\nfolder = os.path.abspath(\n'11_18_2013_R000_IQM_Big_Sur_Mon__e10d1958e7b766c3e840')\nos.mkdir(os.path.join(folder, SAVE_DIRECTORY))\nimages = get_image_paths(folder)\nfor image in images:\ncreate_thumbnail(Image)\n</code></pre> <p>\u4e0a\u8fb9\u8fd9\u6bb5\u4ee3\u7801\u7684\u4e3b\u8981\u5de5\u4f5c\u5c31\u662f\u5c06\u904d\u5386\u4f20\u5165\u7684\u6587\u4ef6\u5939\u4e2d\u7684\u56fe\u7247\u6587\u4ef6\uff0c\u4e00\u4e00\u751f\u6210\u7f29\u7565\u56fe\uff0c\u5e76\u5c06\u8fd9\u4e9b\u7f29\u7565\u56fe\u4fdd\u5b58\u5230\u7279\u5b9a\u6587\u4ef6\u5939\u4e2d\u3002</p> <p>\u8fd9\u6211\u7684\u673a\u5668\u4e0a\uff0c\u7528\u8fd9\u4e00\u7a0b\u5e8f\u5904\u7406 6000 \u5f20\u56fe\u7247\u9700\u8981\u82b1\u8d39 27.9 \u79d2\u3002</p> <p>\u5982\u679c\u6211\u4eec\u4f7f\u7528 map \u51fd\u6570\u6765\u4ee3\u66ff for \u5faa\u73af\uff1a</p> <pre><code>import os \nimport PIL \nfrom multiprocessing import Pool \nfrom PIL import Image\nSIZE = (75,75)\nSAVE_DIRECTORY = 'thumbs'\ndef get_image_paths(folder):\nreturn (os.path.join(folder, f) \nfor f in os.listdir(folder) \nif 'jpeg' in f)\ndef create_thumbnail(filename): \nim = Image.open(filename)\nim.thumbnail(SIZE, Image.ANTIALIAS)\nbase, fname = os.path.split(filename) \nsave_path = os.path.join(base, SAVE_DIRECTORY, fname)\nim.save(save_path)\nif __name__ == '__main__':\nfolder = os.path.abspath(\n'11_18_2013_R000_IQM_Big_Sur_Mon__e10d1958e7b766c3e840')\nos.mkdir(os.path.join(folder, SAVE_DIRECTORY))\nimages = get_image_paths(folder)\npool = Pool()\npool.map(creat_thumbnail, images)\npool.close()\npool.join()\n</code></pre>"},{"location":"%E4%B8%80%E8%A1%8C-Python-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%B9%B6%E8%A1%8C/#56","title":"5.6 \u79d2\uff01","text":"<p>\u867d\u7136\u53ea\u6539\u52a8\u4e86\u51e0\u884c\u4ee3\u7801\uff0c\u6211\u4eec\u5374\u660e\u663e\u63d0\u9ad8\u4e86\u7a0b\u5e8f\u7684\u6267\u884c\u901f\u5ea6\u3002\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4e3a CPU \u5bc6\u96c6\u578b\u4efb\u52a1\u548c IO \u5bc6\u96c6\u578b\u4efb\u52a1\u5206\u522b\u9009\u62e9\u591a\u8fdb\u7a0b\u548c\u591a\u7ebf\u7a0b\u5e93\u6765\u8fdb\u4e00\u6b65\u63d0\u9ad8\u6267\u884c\u901f\u5ea6\u2014\u2014\u8fd9\u4e5f\u662f\u89e3\u51b3\u6b7b\u9501\u95ee\u9898\u7684\u826f\u65b9\u3002\u6b64\u5916\uff0c\u7531\u4e8e map \u51fd\u6570\u5e76\u4e0d\u652f\u6301\u624b\u52a8\u7ebf\u7a0b\u7ba1\u7406\uff0c\u53cd\u800c\u4f7f\u5f97\u76f8\u5173\u7684 debug \u5de5\u4f5c\u4e5f\u53d8\u5f97\u5f02\u5e38\u7b80\u5355\u3002</p> <p>\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u5c31\u5b9e\u73b0\u4e86\uff08\u57fa\u672c\uff09\u901a\u8fc7\u4e00\u884c Python \u5b9e\u73b0\u5e76\u884c\u5316\u3002</p> <ul> <li>\u4e0b\u9762\u7684\u7f51\u5740\u4e2d\u53ef\u4ee5\u627e\u5230\u5173\u4e8e GIL\uff08Global Interpretor Lock\uff0c\u5168\u5c40\u89e3\u91ca\u5668\u9501\uff09\u66f4\u591a\u7684\u8ba8\u8bba\uff1a http://stackoverflow.com/questions/3044580/multiprocessing-vs-threading-python</li> <li>\u7b80\u8a00\u4e4b\uff0cIO \u5bc6\u96c6\u578b\u4efb\u52a1\u9009\u62e9multiprocessing.dummy\uff0cCPU \u5bc6\u96c6\u578b\u4efb\u52a1\u9009\u62e9multiprocessing </li> </ul>"}]}