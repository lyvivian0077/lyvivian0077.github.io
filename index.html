<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"lyvivian0077.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.5.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="总有刁民想要害朕">
<meta property="og:url" content="https://lyvivian0077.github.io/index.html">
<meta property="og:site_name" content="总有刁民想要害朕">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="lyvivian">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://lyvivian0077.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>总有刁民想要害朕</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">总有刁民想要害朕</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">lyvivian</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">categories</span>
      </div>
  </nav>
</div>



          </div>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lyvivian0077.github.io/2021/06/13/MB-MiB%E7%9A%84%E5%8C%BA%E5%88%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyvivian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="总有刁民想要害朕">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/06/13/MB-MiB%E7%9A%84%E5%8C%BA%E5%88%AB/" class="post-title-link" itemprop="url">MB_MiB的区别</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-06-13 12:45:56" itemprop="dateCreated datePublished" datetime="2021-06-13T12:45:56+09:00">2021-06-13</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-06-22 12:58:45" itemprop="dateModified" datetime="2021-06-22T12:58:45+09:00">2021-06-22</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/24601215">原文</a></li>
</ul>
<p><img src="/assets/MB_MiB%E7%9A%84%E5%8C%BA%E5%88%AB.png" alt="tag-vlan"></p>
<p>说实话这几个单位很多人会弄混，先放上直观的对应表：</p>
<p>1KB = 1,000 Byte<br>1MB = 1,000 KB<br>1GB = 1,000,000 KB<br>1TB = 1,000,000,000 KB</p>
<p>1KiB = 1,024Byte<br>1MiB = 1,024KiB<br>1GiB = 1,024MiB = 1,048,576 KiB<br>1TiB = 1,024GiB = 1,073,741,824 KiB</p>
<p>其中，KiB是<strong>ki</strong>lo <strong>bi</strong>nary <em>byte</em>的缩写，指的是千位<strong>二进制</strong>字节</p>
<p>而KB是<strong>kilobyte</strong>的缩写，指的是千字节</p>
<p>二者的区别就在于当中的<em>二进制</em>。我想说道这里大部分人应该都明白为啥KiB是按照1024换算的了。还记得那个笑话么，A问程序员B借钱：</p>
<p>A：B，借我点钱吧！</p>
<p>B：多少？<br>A：1000行不？</p>
<p>B：凑个整，给你1024吧！</p>
<p>再说深入一点，这其中其实牵扯了两种标准：</p>
<p>国际单位制 SI 制定的十进制标准和 国际电工委员会 制定的二进制标准，也就是通常所说的SI和IEC标准。</p>
<p>=============================================================<br>看了匿名用户的回复，决定来补充一些东西。//话说这种问题为啥要匿名呀摔！</p>
<p>首先1KB=1000B绝对不是硬盘厂商发明的，他们只是利用者，嗯嗯。</p>
<p>然后，关于大B和小b，匿名用户解释的非常好。顺便一说为啥网络传输要使用小b，因为在网络传输的时候，我们传输的实际上是一个个二进制数，似乎可以俗称为比特流。那么，在传输二进制数的时候，我们显然是不管你这是什么字，用的什么编码的，所以我们衡量传输速度的最直接的量就是每秒钟传输了多少了二进制位，所以在计算机网络中，我们普遍使用小b作为单位。</p>
<p>然后对于ta提出的Windows的Size的问题，这个很好解释。<br>首先，第一个Size显然是经过舎入的。请不要用115去做乘法，直接用118774去除1024就能得到结果：115.990234375。关于舍入究竟是什么规则，我还在寻找相关的文档，就目前来看似乎是直接舍去小数部分。</p>
<p>然后，第二个Size on Disk就更好解释了。如果你用118784除1024会发现诶，正好整除！结果就是116！这是为啥呢？显然这跟文件在磁盘上存储的最小单位有关。在NTFS分区上，文件存储的最小区块是簇，一般情况下默认的簇大小为4K，也就是说，不论你的文件有多小，就算你的文件只有1b，对不起，我还是要占用一个4K大小的簇。仔细一算你是不是发现116/4刚好整除，等于29呢？说明你的系统很可能也是4K为一个簇，然后该文件占用了你29个簇。</p>
<p>参考[<a href="https://link.zhihu.com/?target=http://imkuso.com/kb-kib-mb-mib-gb-gib-tb-tib-%E5%96%AE%E4%BD%8D%E5%82%BB%E5%82%BB%E5%88%86%E4%B8%8D%E6%B8%85%E6%A5%9A/">知識] KB KiB MB MiB GB GiB TB TiB 單位傻傻分不清楚?</a></p>
<p><a href="https://link.zhihu.com/?target=http://zh.wikipedia.org/wiki/%E5%8D%83%E5%AD%97%E8%8A%82">千字节</a><a href="https://link.zhihu.com/?target=http://zh.wikipedia.org/wiki/Kibibyte">Kibibyte</a></p>
<p>KB, MB, GB中的K, M, G代表字节的数量，自己也常混淆，总结如下：</p>
<ol>
<li>K单独出现时，代表1000 或 1024</li>
<li>K与Ki一起出现时，K代表1000，Ki代表1024</li>
<li>K与k一起出现时，K代表1024，k代表1000</li>
</ol>
<p>K和Ki为例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1K=10^3</span><br><span class="line">1M=10^3K=10^6</span><br><span class="line">1G=10^3M=10^9</span><br><span class="line"></span><br><span class="line">Ki=2^10</span><br><span class="line">Mi=2^10Ki=2^20</span><br><span class="line">Gi=2^10Mi=2^30</span><br></pre></td></tr></table></figure>



      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lyvivian0077.github.io/2020/10/22/Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyvivian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="总有刁民想要害朕">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/10/22/Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">Explain详解与索引最佳实践</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-10-22 12:49:29" itemprop="dateCreated datePublished" datetime="2020-10-22T12:49:29+09:00">2020-10-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-06-22 12:58:45" itemprop="dateModified" datetime="2021-06-22T12:58:45+09:00">2021-06-22</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="explain详解与索引最佳实践"><a href="#explain详解与索引最佳实践" class="headerlink" title="explain详解与索引最佳实践"></a>explain详解与索引最佳实践</h2><p>[explain详解与索引最佳实践](/assets/explain详解与索引最佳实践.pdf)</p>
<table>
<thead>
<tr>
<th>select_type</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>SIMPLE</td>
<td>简单的select查询,查询中不包含子查询或者UNION</td>
</tr>
<tr>
<td>PRIMARY</td>
<td>查询中若包含任何复杂的字查询,最外层查询标记为该标识</td>
</tr>
<tr>
<td>SUBQUERY</td>
<td>在SELECT或WHERE列表中包含了子查询</td>
</tr>
<tr>
<td>DERIVED</td>
<td>在FROM列表中包含的子查询,被标记为DERIVED(衍生)MySQL会递归执行这些子查询,把结果放在临时表中</td>
</tr>
<tr>
<td>UNION</td>
<td>若第二个SELECT出现在UNION之后,则标记为UNION;若UNION包含在FROM字句的子查询中,外层SELECT将被标记为:DERIVED</td>
</tr>
<tr>
<td>UNION RESULT</td>
<td>从UNION表获取结果的SELECT</td>
</tr>
</tbody></table>
<h5 id="explain-之type"><a href="#explain-之type" class="headerlink" title="explain 之type"></a>explain 之type</h5><table>
<thead>
<tr>
<th>type</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>NULL</td>
<td>MySQL不访问任何表,索引,直接返回结果</td>
</tr>
<tr>
<td>system</td>
<td>表只有一行记录(等于系统表),这是const类型的特例,一般不会出现</td>
</tr>
<tr>
<td>const</td>
<td>表示通过索引一次就找到了,const用于比较primary key或者unique索引.因为只匹配一行数据,所以很快.如将主键置于where列表中,MySQL就能将该查询转换为一个常量.const于将”主键”或”唯一”索引的所有部分与常量值进行比较</td>
</tr>
<tr>
<td>eq_ref</td>
<td>类型ref,区别在于使用的是唯一索引,使用主键的并联查询,关联查询的记录只有一条.常见于主键或唯一索引描述</td>
</tr>
<tr>
<td>ref</td>
<td>非唯一性索引描述,返回匹配某个单独值得所有行.本质上也是一种索引访问,返回所有匹配某个单独值的所有行(多个)</td>
</tr>
<tr>
<td>range</td>
<td>只检索给定返回的行,使用一个索引来选择行.where之后出现between,&lt;,&gt;,in 等操作</td>
</tr>
<tr>
<td>index</td>
<td>index与ALL的区别为index类型只是遍历了索引树,通常比ALL快,ALL是遍历数据文件</td>
</tr>
<tr>
<td>ALL</td>
<td>将遍历全表以找到匹配的行</td>
</tr>
</tbody></table>
<p>结果值从 <strong>最好</strong> 到 <strong>最坏</strong> 依次是:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NULL &gt; system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL</span><br><span class="line"></span><br><span class="line">system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL</span><br></pre></td></tr></table></figure>

<p>一般来说,我们需要保证查询至少达到range级别, 最后达到ref.</p>
<h5 id="explain-之key"><a href="#explain-之key" class="headerlink" title="explain 之key"></a>explain 之key</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">possible_keys: 显示可能应用在这张表的索引, 一个或多个</span><br><span class="line">key: 实际使用的索引,如果为NULL,则没有使用索引</span><br><span class="line">key_len: 表示索引中使用的字节数, 该值为索引字段最大可能长度,并非实际使用长度,在不损失精确性的前提下,长度越短越好.</span><br></pre></td></tr></table></figure>

<h5 id="explain-之rows"><a href="#explain-之rows" class="headerlink" title="explain 之rows"></a>explain 之rows</h5><p>扫描行的数量</p>
<h5 id="explain-之extra"><a href="#explain-之extra" class="headerlink" title="explain 之extra"></a>explain 之extra</h5><p>其他的额外的执行计划信息,在该列显示.</p>
<table>
<thead>
<tr>
<th>extra</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>using filesort</td>
<td>说明mysql会对数据使用一个外部的索引排序,而不是按照表内的索引顺序进行读取,称为”文件排序”,效率低.</td>
</tr>
<tr>
<td>using temporary</td>
<td>使用了临时表保存中间结果,MySQL在对查询结果排序时使用临时表. 常见于order by 和 group by, 效率低.</td>
</tr>
<tr>
<td>using index</td>
<td>表示相应的select操作使用了覆盖索引,避免访问表的数据行,效率不错.</td>
</tr>
</tbody></table>
<p>6). 尽量使用覆盖索引,避免select *</p>
<p>尽量使用覆盖索引(只访问索引的查询(<strong>索引列</strong> 完全包含 <strong>查询列</strong>)),减少<code>select *</code>.</p>
<p>如果查询类,超出索引列,也会降低性能.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TIP:</span><br><span class="line"> using index: 使用覆盖索引的时候就会出现</span><br><span class="line"> using where: 在查找使用索引的情况下, 需要回表查询数据</span><br><span class="line"> using index condition: 查找使用了索引, 但是需要回表查询数据</span><br><span class="line"> using index; using where: 查找使用了索引, 但是需要的数据都在索引列中能找到, 所以不需要回表查询数据</span><br></pre></td></tr></table></figure>

<ol start="12">
<li>单列索引和复合索引</li>
</ol>
<p>尽量使用复合索引, 而少使用单列索引</p>
<ul>
<li>创建复合索引</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create index idx_name_sta_address on tb_seller(name, status, address);</span><br><span class="line">就相当于创建了三个索引:</span><br><span class="line"></span><br><span class="line">name</span><br><span class="line">name + status</span><br><span class="line">name + status + address</span><br></pre></td></tr></table></figure>

<ul>
<li>创建单列索引</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create index idx_seller_name on tb_sell(name);</span><br><span class="line">create index idx_seller_status on tb_sell(status);</span><br><span class="line">create index idx_seller_address on tb_sell(address);</span><br></pre></td></tr></table></figure>

<p>数据库会选择一个最优的索引(辨识度最高索引)来使用,并不会使用全部索引.</p>
<h4 id="查看索引索引情况"><a href="#查看索引索引情况" class="headerlink" title="查看索引索引情况"></a>查看索引索引情况</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show status like &#x27;Handler_read%&#x27;;</span><br><span class="line">show global status like &#x27;Handler_read%&#x27;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">02:06:55 root@localhost[database1]&gt; show status like &#x27;Handler_read%&#x27;;</span><br><span class="line"></span><br><span class="line">+-----------------------+-------+</span><br><span class="line">| Variable_name         | Value |</span><br><span class="line">+-----------------------+-------+</span><br><span class="line">| Handler_read_first    | 0     |</span><br><span class="line">| Handler_read_key      | 0     |</span><br><span class="line">| Handler_read_last     | 0     |</span><br><span class="line">| Handler_read_next     | 0     |</span><br><span class="line">| Handler_read_prev     | 0     |</span><br><span class="line">| Handler_read_rnd      | 0     |</span><br><span class="line">| Handler_read_rnd_next | 34    |</span><br><span class="line">+-----------------------+-------+</span><br><span class="line">7 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">05:08:03 root@localhost[database1]&gt; show global status like &#x27;Handler_read%&#x27;;</span><br><span class="line">+-----------------------+--------------+</span><br><span class="line">| Variable_name         | Value        |</span><br><span class="line">+-----------------------+--------------+</span><br><span class="line">| Handler_read_first    | 622670       |</span><br><span class="line">| Handler_read_key      | 254215292    |</span><br><span class="line">| Handler_read_last     | 29           |</span><br><span class="line">| Handler_read_next     | 273266451    |</span><br><span class="line">| Handler_read_prev     | 97           |</span><br><span class="line">| Handler_read_rnd      | 10101645     |</span><br><span class="line">| Handler_read_rnd_next | 166307007667 |</span><br><span class="line">+-----------------------+--------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">05:08:11 root@localhost[database1]&gt;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- Handler_read_first: 索引中第一条被读的次数.如果高,表示服务器正执行大量全索引扫描(这个值越低越好).</span><br><span class="line"></span><br><span class="line">- Handler_read_key: 如果索引正在工作,这个值代表一个行被索引值读的次数,如果值越低,表示索引得到的性能改善不高,因为索引不经常使用(这个值越高越好).</span><br><span class="line"></span><br><span class="line">- Handler_read_rnd: 根据固定位置读一行的请求值. 如果你正执行大量查询并需要对结果进行排序,该值应该较高. 你可能使用了大量需要MySQL扫描这个表的查询或你的连接没有正确使用键.这个值较高,意味着运行效率低,可以建立索引来补救.</span><br><span class="line"></span><br><span class="line">- Handler_read_rnd_next: 在数据文件中读下一行的请求数.如果你正在进行大量的表扫描,该值较高.通常说明你的表的索引不正确或写入的查询没有利用索引.</span><br></pre></td></tr></table></figure>



<h4 id="SQL优化"><a href="#SQL优化" class="headerlink" title="SQL优化"></a>SQL优化</h4><ol>
<li><h5 id="大批量插入"><a href="#大批量插入" class="headerlink" title="大批量插入"></a>大批量插入</h5><ul>
<li><p>使用load命令导入数据的时候,适当的设置可以提高导入的效率.</p>
<ul>
<li><p>对于InnoDB类型的表,有以下几种方式可以提高导入的效率:</p>
<ul>
<li>主键顺序插入<ul>
<li>因为InnoDB类型的表示按照主键的顺序保存的,所以将导入的数据按照主键的顺序排列,可以有效的提高导入数据的效率. 如果InnoDB表没有主键,那么系统会自动默认创建一个内部列作为主键,所以如果可以给表创建一个主键,将可以利用这点,来提高导入数据的效率.<ul>
<li>插入ID顺序排列数据</li>
<li>插入ID无序排列数据</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol start="2">
<li><p>关闭唯一性校验</p>
<ol>
<li>在导入数据前执行 <code>SET UNIQUE_CHECKS = 0</code>, 关闭唯一性校验, 在导入结束后执行 <code>SET UNIQUE_CHECKS = 1</code>, 恢复唯一性校验, 可以提高导入的效率.</li>
</ol>
</li>
<li><p>手动提交事务</p>
<ol>
<li>如果应用使用自动提交的方式,建议在导入前执行 <code>SET AUTOCOMMIT=0</code>, 关闭自动提交, 导入结束后再执行 <code>SET AUTOCOMMIT=1</code>, 打开自动提交, 也可以提高导入的效率.</li>
</ol>
</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
<li><h5 id="优化insert语句"><a href="#优化insert语句" class="headerlink" title="优化insert语句"></a>优化insert语句</h5><ul>
<li><p>当进行数据的insert操作的时候,可以考虑采用以下几种优化方案</p>
<ul>
<li><p>如果需要同时对一张表插入很多行数据时,应该尽量使用多个值表的insert语句,这种方式将大大的缩减客户端与数据库之间的连接,关闭示例,原始方式为:</p>
<ul>
<li><p>优化后的方案前:<br>  insert into tb_test values(1,’Tom’);<br>  insert into tb_test values(2,’Cat’);<br>  insert into tb_test values(3,’Jerry’);</p>
</li>
<li><p>优化后的方案为:<br>  insert into tb_test values(1,’Tom’),(2,’Cat’),(3,’Jerry’);</p>
</li>
</ul>
</li>
<li><p>在事务中进行数据插入<br>  start transaction;<br>  insert into tb_test values(1,’Tom’);<br>  insert into tb_test values(2,’Cat’);<br>  insert into tb_test values(3,’Jerry’);<br>  commit;</p>
</li>
<li><p>数据有序插入<br>  insert into tb_test values(1,’Tom’);<br>  insert into tb_test values(2,’Cat’);<br>  insert into tb_test values(3,’Jerry’);<br>  insert into tb_test values(4,’Tim’);<br>  insert into tb_test values(5,’Rose’);</p>
</li>
</ul>
</li>
</ul>
</li>
<li><h5 id="优化order-by语句"><a href="#优化order-by语句" class="headerlink" title="优化order by语句"></a>优化order by语句</h5></li>
</ol>
<p><strong>两种排序方式</strong></p>
<ol>
<li>第一种是通过对返回数据进行排序,也就是通常说的 filesort 排序, 所有不是通过索引直接返回排序结果的排序都叫Filesort排序.</li>
<li>第二种通过有序索引顺序扫描直接返回有序数据,这种情况即为<code>using index</code>, 不需要额外排序,操作效率高.</li>
</ol>
<p>了解了MySQL的排序方式,优化目标就清晰了: </p>
<ul>
<li>尽量减少额外的排序,通过索引直接返回有序数据.</li>
<li><code>where</code>条件和<code>order by</code> 使用<strong>相同的索引</strong>,并且<code>Order by</code> 的顺序和<code>索引顺序</code><strong>相同</strong>, 并且<code>order by</code> 的字段<strong>都是升序</strong>,或者<strong>都是降序</strong>. 否则肯定需要额外的操作, 这样就会出现FileSort.</li>
</ul>
<ol start="4">
<li><h5 id="Filesort的优化"><a href="#Filesort的优化" class="headerlink" title="Filesort的优化"></a>Filesort的优化</h5><p>通过创建合适的索引,能够减少filesort的出现,但是在某些情况下,条件限制不能让Filesort消失,那就需要加快Filesort的排序操作.对于FileSort, MySQL有两种排序算法:</p>
<ul>
<li>两次扫描算法: MySQL4.1 之前, 使用该方式排序. 首先根据条件取出排序字段和行指针信息,然后在排序区 sort buffer 中排序, 如果sort buffer 不够,则在临时表temporary table 中存储排序结果. 完成排序后, 再根据行指针回表读取记录, 该操作可能会导致大量随机IO操作.</li>
<li>一次扫描算法: 一次性取出满足条件的索引字段,然后在排序区sort buffer 中排序后直接输出结果集. 排序时内存开销较大, 但是排序效率比两次扫描算法要高.</li>
</ul>
<p>MySQL通过比较系统变量 <code>max_length_for_sort_data</code>的大小和Query语句取出的字段总大小,来判断是否那种排序算法,如果<code>max_length_for_sort_data</code> 更大,那么使用第二种优化之后的算法,否则使用第一种.</p>
<p>可以适当提高<code>sort_buffer_size</code>和<code>max_length_for_sort_date</code>系统变量,来增大排序区的大小,提高排序的效率.</p>
</li>
<li><h5 id="优化group-by语句"><a href="#优化group-by语句" class="headerlink" title="优化group by语句"></a>优化group by语句</h5><p>由于group by 实际上也同样会进行排序操作, 而且于order by 相比,group by 只要只是多了排序之后的分组操作. 当然,如果在分组的时候还使用了其他的一些聚合函数, 那么还需要一些聚合函数的计算.所以,在group by 的实现过程中,于order by一样也可以利用到索引. </p>
<p>如果查询包含group by 但是用户想要避免排序结果的消耗,则可以执行<code>order by null</code> 禁止排序. 如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select age, count(*) from emp group by age;</span><br></pre></td></tr></table></figure>

<p>优化后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select age,count(*) from emp group by age order by null;</span><br></pre></td></tr></table></figure></li>
<li><h5 id="优化嵌套查询"><a href="#优化嵌套查询" class="headerlink" title="优化嵌套查询"></a>优化嵌套查询</h5><p>MySQL4.1 版本之后,开始支持SQL的子查询.这个技术可以使用select语句来创建一个单列的查询,然后把这个结果作为过滤条件用在另一个查询中. 使用子查询可以一次性的完成很多逻辑上需要多个步骤才能完成的SQL操作, 同时也可以避免事务或表锁死, 并且写起来也很容易. 但是,有些情况下,子查询是可以被跟高效的连接(JOIN)代替.</p>
</li>
<li><h5 id="优化OR条件"><a href="#优化OR条件" class="headerlink" title="优化OR条件"></a>优化OR条件</h5><p>对于包含OR查询子句,如果要利用索引,则OR之间的每个条件列都必须用到索引, 而且不能使用到复合索引; 如果没有索引,则应该考虑增加索引.</p>
<p><strong>建议使用union替换or</strong>.</p>
<p>type显示的是访问类型,是较为重要的一个指标,结果值从好到坏依次是:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merger &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL</span><br></pre></td></tr></table></figure>

<p>UNION 语句的type值为ref, OR语句的type值为range, 可以看到这是一个很明显的差距</p>
<p>UNION 语句的ref值为const, OR语句的type值为null, const表示是常量值引用,非常快</p>
<p>这两项的差距就说明了UNION要优于OR.</p>
</li>
<li><h5 id="优化分页查询"><a href="#优化分页查询" class="headerlink" title="优化分页查询"></a>优化分页查询</h5><p>一般分页查询时,通过创建覆盖索引能够比较好的提高性能. 一个常见又非常头疼的问题就是 limit 2000000, 10 , 此时需要MySQL排序前 2000010 记录, 仅仅返回2000000 - 2000010 的记录, 其他记录丢弃, 查询排序的代价非常大.</p>
<ol>
<li><p>优化思路一</p>
<p>在索引上完成排序分页操作, 最后根据主键关联回原表查询所需要的其他列内容.</p>
</li>
<li><p>优化思路二</p>
<p>该方案适应于主键自增的表,可以把Limit查询转换成某个位置的查询.</p>
</li>
<li></li>
</ol>
</li>
<li><p>适应SQL提示</p>
<p>SQL提示, 是优化数据库的一个重要字段, 简单来说, 就是在SQL语句中加入一些人为的提示来达到优化操作的目的.</p>
<ol>
<li><p><strong>USE INDEX</strong></p>
<p>在查询语句中表名的后面,添加 use index 来提供希望MySQL去参考的索引列表,就可以让MySQL不再考虑其他可用的索引.</p>
<p><code>create index idx_serller_name on tb_sellwe(name);</code></p>
</li>
<li><p><strong>IGNORE INDEX</strong></p>
<p>如果用户只是单纯的想让MySQL忽略一个或者多个索引, 则可以使用 ignore index 作为 hint.</p>
<p><code>explain select * from tb_seller ignore index(idx_seller_name) where name = &#39;xxx&#39;;</code></p>
</li>
<li><p><strong>FORCE INDEX</strong></p>
<p>为强制MySQL使用一个特定的索引, 可在查询中使用 force index 作为hint.</p>
<p><code>explain select * from tb_seller force index(idx_seller_address) wher address = &#39;xxx&#39;;</code></p>
</li>
</ol>
</li>
</ol>
<h4 id="查询缓存配置"><a href="#查询缓存配置" class="headerlink" title="查询缓存配置"></a>查询缓存配置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show status like &#x27;Qcache%&#x27;;</span><br><span class="line">+-------------------------+------------+</span><br><span class="line">| Variable_name           | Value      |</span><br><span class="line">+-------------------------+------------+</span><br><span class="line">| Qcache_free_blocks      | 23822      | &lt;- 可用的内存的块的个数</span><br><span class="line">| Qcache_free_memory      | 70259792   | &lt;- 可用的内存的空间,容量</span><br><span class="line">| Qcache_hits             | 1594706026 | &lt;- 查询缓冲的命中次数</span><br><span class="line">| Qcache_inserts          | 678651145  | &lt;- 添加到查询缓冲的次数</span><br><span class="line">| Qcache_lowmem_prunes    | 237160055  | &lt;- 如果内存不足,将数据移除出内存空间的次数</span><br><span class="line">| Qcache_not_cached       | 1344572761 | &lt;- 未做缓存的次数</span><br><span class="line">| Qcache_queries_in_cache | 67682      | &lt;- 查询缓存中注册的查询数</span><br><span class="line">| Qcache_total_blocks     | 181973     | &lt;- 查询缓存中的块总数</span><br><span class="line">+-------------------------+------------+</span><br></pre></td></tr></table></figure>



<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>Qcache_free_blocks</td>
<td>查询缓存中的可以内存块数</td>
</tr>
<tr>
<td>Qcache_free_memory</td>
<td>查询缓存的可用内存量</td>
</tr>
<tr>
<td>Qcache_hits</td>
<td>查询缓存命中率</td>
</tr>
<tr>
<td>Qcache_inserts</td>
<td>添加到查询缓存的查询数</td>
</tr>
<tr>
<td>Qcache_lowmem_prunes</td>
<td>由于内存不足而从查询缓存中删除的查询数</td>
</tr>
<tr>
<td>Qcache_not_cached</td>
<td>非缓存查询的数量(由于query_cache_type设置而无法缓存或未缓存)</td>
</tr>
<tr>
<td>Qcache_queries_in_cache</td>
<td>查询缓存中注册的查询数</td>
</tr>
<tr>
<td>Qcache_total_blocks</td>
<td>查询缓存中的块总数</td>
</tr>
</tbody></table>
<h4 id="开启查询缓存"><a href="#开启查询缓存" class="headerlink" title="开启查询缓存"></a>开启查询缓存</h4><p>MySQL的查询缓存默认是关闭的, 需要手动配置参数 <code>query_cache_type</code>,来开启查询缓存. <code>query_cache_type</code>该参数的可取值有三个</p>
<table>
<thead>
<tr>
<th>值</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>OFF 或 0</td>
<td>查询缓存功能关闭</td>
</tr>
<tr>
<td>ON 或 1</td>
<td>查询缓存功能打开, SELECT 的结果符合缓存条件即会缓存,否则,不予缓存, 显示指定SQL_NO_CACHE, 不予缓存</td>
</tr>
<tr>
<td>DEMAND 或 2</td>
<td>查询缓存功能按需进行, 显示指定SQL_CACHE的SELECT语句才会缓存; 其他均不予缓存</td>
</tr>
</tbody></table>
<h4 id="查询缓存失效的情况"><a href="#查询缓存失效的情况" class="headerlink" title="查询缓存失效的情况"></a>查询缓存失效的情况</h4><ol>
<li><p>SQL语句不一致的情况,想要命中查询缓存,查询的SQL语句必须一致.</p>
</li>
<li><p>当查询语句中有一些不确定的时,则不会缓存. 如: now(), current_date(),curdate(),curtime(),rand(),uuid(),user(),databases().</p>
</li>
<li><p>不使用任何表查询语句</p>
</li>
<li><p>查询 mysql, information_schema,或performance_schema 数据库中的表时,不会走查询缓存.</p>
</li>
<li><p>在存储的函数, 触发器或事件的主体内执行的查询.</p>
</li>
<li><p>如果表更改,则使用该表的所有高速缓存查询都将变为无效并从高速缓存中删除. 这包括使用<code>MERGE</code>映射到已更改表的查询.一个表可以被许多类型的语句, 如被改变 INSERT, UPDATE, DELETE, TRUNCATE TABLE, ALTER TABLE, DROP TABLE, 或 DROP DATABASE.</p>
</li>
</ol>
<h3 id="MySQL内存管理及优化"><a href="#MySQL内存管理及优化" class="headerlink" title="MySQL内存管理及优化"></a>MySQL内存管理及优化</h3><h4 id="内存优化原则"><a href="#内存优化原则" class="headerlink" title="内存优化原则"></a>内存优化原则</h4><ol>
<li><p>将尽量多的内存分配给MySQL做缓存, 但要给操作系统和其他查询预留足够内存.</p>
</li>
<li><p>MyISAM存储引擎的数据文件读取依赖于操作系统自身的<code>IO</code>缓存,因此,如果有MyISAM表, 就要预留更多的内存给操作系统做IO缓存.</p>
</li>
<li><p>排序区, 连接区等缓存是分配给每个数据库对话(session)专业的,其默认值的设置要根据最大连接数合理分配, 如果设置太大, 不但浪费资源,而且在并发连接较高时会导致物理内存耗尽.</p>
</li>
</ol>
<h4 id="MyISAM-内存优化"><a href="#MyISAM-内存优化" class="headerlink" title="MyISAM 内存优化"></a>MyISAM 内存优化</h4><p>MyISAM存储引擎使用 <code>key_buffer</code> 缓存索引块, 加速MyISAM索引的读写速度. 对于MyISAM表的数据块, mysql没有特别的缓存机制, 完全依赖于操作系统的IO缓存.</p>
<h4 id="key-buffer-size"><a href="#key-buffer-size" class="headerlink" title="key_buffer_size"></a>key_buffer_size</h4><p><code>key_buffer_size</code> 决定MyISAM索引块缓冲区的大小, 直接影响到MyISAM表的读取效率. 可以在MySQL参数文件中设置key_buffer_size的值, 对于一般MyISAM数据库, 建议至少将 <code>1/4</code> 可用内存分配给key_buffer_size.</p>
<h4 id="read-buffer-size"><a href="#read-buffer-size" class="headerlink" title="read_buffer_size"></a>read_buffer_size</h4><p>如果需要经常顺序扫描myisam表,可以通过增大read_buffer_size的值来改善性能. 但需要注意的是read_buffer_size是每个session独占的,如果默认值设置太大,就好造成内存浪费.</p>
<h4 id="read-rnd-buffer-size"><a href="#read-rnd-buffer-size" class="headerlink" title="read_rnd_buffer_size"></a>read_rnd_buffer_size</h4><p>对于需要排序的myisam表的查询, 如带有order by 子句的sql, 适当增加 read_rnd_buffer_size的值, 可以改善此类的sql性能. 但需注意的是, read_rnd_buffer_size是每个session独占的, 如果默认值设置太大,就好造成内存浪费.</p>
<h4 id="InnoDB内存优化"><a href="#InnoDB内存优化" class="headerlink" title="InnoDB内存优化"></a>InnoDB内存优化</h4><p>innodb用一块内存区做IO缓存, 该缓存池不仅用来缓存innodb的索引块, 而且也用来缓存innodb的数据块.</p>
<h5 id="innodb-buffer-pool-size"><a href="#innodb-buffer-pool-size" class="headerlink" title="innodb_buffer_pool_size"></a>innodb_buffer_pool_size</h5><p>该变量决定了Innodb存储引擎表数据和索引数据的最大缓存区大小. 在保证操作系统及其他程序有足够内存可用的情况下,innodb_buffer_pool_size 的值越大, 缓存命中率越高, 访问InnoDB表需要的磁盘IO就越少, 性能也就越高.</p>
<h5 id="innodb-log-buffer-size"><a href="#innodb-log-buffer-size" class="headerlink" title="innodb_log_buffer_size"></a>innodb_log_buffer_size</h5><p>决定了InnoDB重做日志缓存的大小, 对于可能产生大量更新记录的大事务, 增加innodb_log_buffer_size的大小, 可用避免innodb在事务提交前就执行不必要的日志写入磁盘.</p>
<h4 id="MySQL并发参数调整"><a href="#MySQL并发参数调整" class="headerlink" title="MySQL并发参数调整"></a>MySQL并发参数调整</h4><p>从实现上来说, MySQL Server 是多线程结果, 包括后台线程和客户端线程. 多线程可用有效利用服务器资源,提高数据库的并发性能.</p>
<p>在MySQL中, 控制并发连接和线程的主要参数包括 max_connections, back_log, thread_cache_size, table_open_cache.</p>
<h5 id="max-connections"><a href="#max-connections" class="headerlink" title="max_connections"></a>max_connections</h5><p>采用max_connections控制允许连接到MySQL数据库的最大数量, 默认是151. 当客户端连接服务端时,当同时连接的请求超过151时,就没有可用的连接来处理客户端的请求,后面进来的连接都会进入等待状态.</p>
<p><code>connections_errors_max_connections</code>为当连接达到最大请求值时,连接报错的信息.</p>
<p>如果状态变量 <code>connections_errors_max_connections</code>不为零,并且一直增长, 则说明不断有连接请求因数据库连接已达到允许最大值而失败, 这时可以考虑增大max_connections的值.</p>
<p>MySQL最大可支持的连接数, 取决于很多因素,包括给定操作系统平台的线程库的质量,内存大小,每个连接的负荷,CPU的处理速度,期望的响应时间等.在Linux平台下,性能好的服务器,支持500-1000个连接不是难事,需要根据服务器性能进行设定.</p>
<h5 id="back-log"><a href="#back-log" class="headerlink" title="back_log"></a>back_log</h5><p>back_log参数控制MySQL监听TCP端口时设置的积压请求栈大小. 如果MySQL的连接数达到max_connections时,新来的请求将会被存在堆栈中,以等待某一连接释放资源, 该堆栈的数量既是back_log. 如果等待的连接的数量超过back_log, 将不被授予连接资源,将会报错.</p>
<p>5.5.5版本之前默认值为50, 之后的版本默认为50+(max_connections / 5), 但最大不超过900.</p>
<p>如果需要数据库在短的时间内处理大量的连接请求, 可以考虑适当增大back_log的值.</p>
<h5 id="table-open-cache"><a href="#table-open-cache" class="headerlink" title="table_open_cache"></a>table_open_cache</h5><p>该参数用来控制所有SQL语句执行线程可打开表缓存的数量, 而在执行SQL语句时, 每一个SQL执行线程至少要打开1个表缓存. 该参数的值应该根据设置的最大连接数max_connections一个每个连接执行关联查询中涉及的表的最大数量来设定:</p>
<p><code>max_connections x N;</code></p>
<h5 id="hread-cache-size"><a href="#hread-cache-size" class="headerlink" title="hread_cache_size"></a>hread_cache_size</h5><p>为了加快数据库的速度，MySQL会缓存一定数量的客户服务线程以备重用，通过参数 thread_cache_size 可控制 MySQL 缓存客户端服务线程的数量。</p>
<h5 id="innodb-lock-wait-timeout"><a href="#innodb-lock-wait-timeout" class="headerlink" title="innodb_lock_wait_timeout"></a>innodb_lock_wait_timeout</h5><p>该参数是用来设置 InnoDB 事务等待行锁的时间，默认值是 50 ms，可以根据进行动态设置。对于需要快速反馈的业务系统来说，可以将行锁的等待时间调小，以避免事务长时间挂起；对于后台运行的批量处理程序来说，可以将行锁的等待时间调大，以避免发生大的回滚操作。</p>
<h2 id="2、MySQL-锁问题"><a href="#2、MySQL-锁问题" class="headerlink" title="2、MySQL 锁问题"></a>2、MySQL 锁问题</h2><h3 id="2-1、锁概述"><a href="#2-1、锁概述" class="headerlink" title="2.1、锁概述"></a>2.1、锁概述</h3><p>锁 是计算机协调多个进程或线程并发访问某一资源的机制（避免争抢）。</p>
<p>在数据库中，除传统的计算资源（如：CPU、RAM、I/O 等）的争用以外，数据也是一种供许多用户共享的资源。如何保证数据并发访问的一致性、有效性是所有数据库必须解决的一个问题，锁冲突也是影响数据库并发访问性能的一个重要因素。</p>
<h3 id="2-2、锁分类"><a href="#2-2、锁分类" class="headerlink" title="2.2、锁分类"></a>2.2、锁分类</h3><p>从对数据操作的粒度分：</p>
<ol>
<li>表锁：操作时，会锁定整个表</li>
<li>行锁：操作时，会锁定当前操作行</li>
</ol>
<p>从对数据操作的类型分：</p>
<ol>
<li>读锁（共享锁）：针对同一份数据，多个读操作可以同时进行而不会相互影响</li>
<li>写锁（排它锁）：当前操作没有完成之前，它会阻断其他写锁和读锁</li>
</ol>
<h3 id="2-3、MySQL锁"><a href="#2-3、MySQL锁" class="headerlink" title="2.3、MySQL锁"></a>2.3、MySQL锁</h3><p>相对于其他数据库而言，MySQL 的锁机制比较简单，其最显著的特点就是不同的存储引擎支持不同的锁机制。下表中罗列出了各个存储引擎对锁的支持情况</p>
<table>
<thead>
<tr>
<th>存储引擎</th>
<th>表级锁</th>
<th>行级锁</th>
<th>页面锁</th>
</tr>
</thead>
<tbody><tr>
<td>MyISAM</td>
<td>支持</td>
<td>不支持</td>
<td>不支持</td>
</tr>
<tr>
<td>InnoDB</td>
<td>支持</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>MEMORY</td>
<td>支持</td>
<td>不支持</td>
<td>不支持</td>
</tr>
<tr>
<td>BDB</td>
<td>支持</td>
<td>不支持</td>
<td>支持</td>
</tr>
</tbody></table>
<p>MySQL 这3中锁的特性可大致归纳如下：</p>
<table>
<thead>
<tr>
<th>锁类型</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>表极锁</td>
<td>偏向 MyISAM 存储引擎，开销小，加锁快；不会出现死锁；锁定粒度大，发生锁冲突的概率最高，并发度最低</td>
</tr>
<tr>
<td>行极锁</td>
<td>偏向 InnoDB 存储引擎，开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度也最高</td>
</tr>
<tr>
<td>页面锁</td>
<td>开锁和加锁时间介于表锁和行锁之间；会出现死锁；锁定粒度介于表锁和行锁之间，并发度一般</td>
</tr>
</tbody></table>
<p>从上述来看，很难笼统地说哪种锁更好，只能就具体应用的特点来说哪种锁更合适。<br>仅从锁的角度来说：<strong>表级锁</strong>更适合以查询为主，只有少量按索引条件更新数据的应用，如web应用；<strong>行级锁</strong> 更适合于有大量按索引条件并发更新少量不同数据，同时又有并查询的应用，如一些在线事务处理（OLTP）系统。</p>
<h3 id="2-4、MyISAM-表锁"><a href="#2-4、MyISAM-表锁" class="headerlink" title="2.4、MyISAM 表锁"></a>2.4、MyISAM 表锁</h3><p>MyISAM 存储引擎只支持表锁，这也是 MySQL 开始几个版本中唯一支持的锁类型。</p>
<h4 id="2-4-1、如何加表锁"><a href="#2-4-1、如何加表锁" class="headerlink" title="2.4.1、如何加表锁"></a>2.4.1、如何加表锁</h4><p>MyISAM 在执行查询语句（SELECT）前，会自动给涉及的所有表加读锁，在执行更新操作（UPDATE、DELETE、INSERT等）前，会自动给涉及的表加写锁。</p>
<p>这个过程并不需要用户干预，因此，用户一般不需要直接用 <code>LOCJ TABLE</code>命令给 MyISAM 表显示加锁。</p>
<p>显示加表锁语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">加读锁：lock <span class="keyword">table</span> table_name read;</span><br><span class="line">加写锁：lock <span class="keyword">table</span> table_name write;</span><br></pre></td></tr></table></figure>

<h4 id="2-4-4、结论"><a href="#2-4-4、结论" class="headerlink" title="2.4.4、结论"></a>2.4.4、结论</h4><table>
<thead>
<tr>
<th>当前锁模式\请求锁模式</th>
<th>None</th>
<th>读锁</th>
<th>写锁</th>
</tr>
</thead>
<tbody><tr>
<td>读锁</td>
<td>是</td>
<td>是</td>
<td>否</td>
</tr>
<tr>
<td>写锁</td>
<td>是</td>
<td>否</td>
<td>否</td>
</tr>
</tbody></table>
<p>由上表可见：<br>1）对 MyISAM 表的读操作，不会阻塞其他用户对同一表的读请求，但会阻塞对统一表的写请求；<br>2）对 MyISAM 表的写操作，则会阻塞其他用户对同一表的读和写操作；</p>
<p>简而言之，<strong>就是读锁会阻塞写，但是不会阻塞读</strong>。而写锁，<strong>既会阻塞读，又会阻塞写</strong>。</p>
<p>此外， MyISAM 的读写锁调度是 <strong>写</strong> 优先。这也是 MyISAM 不适合作为写为主的表的存储引擎的原因。因为写锁后，其他线程不能做任何操作，大量的更新会使查询很难得到锁，从而造成永远阻塞。</p>
<h4 id="2-4-5、查看锁的争用情况"><a href="#2-4-5、查看锁的争用情况" class="headerlink" title="2.4.5、查看锁的争用情况"></a>2.4.5、查看锁的争用情况</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">open</span> tables;</span><br></pre></td></tr></table></figure>

<ol>
<li>In_use：表当前被查询使用的次数，如果为零，则表是打开的，但是当前没有被使用。</li>
<li>Name_locked：表名称是否被锁定。名称锁定用于取消表或对表进行重命名等操作。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">show status like &#x27;Table_locks%&#x27;;</span><br><span class="line"></span><br><span class="line">mysql&gt; show status like &#x27;Table_lock%&#x27;;</span><br><span class="line">+-----------------------+------------+</span><br><span class="line">| Variable_name         | Value      |</span><br><span class="line">+-----------------------+------------+</span><br><span class="line">| Table_locks_immediate | 2772892035 |</span><br><span class="line">| Table_locks_waited    | 64713      |</span><br><span class="line">+-----------------------+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<ol>
<li>Table_locks_immediate：指的是能够立即获得表级锁的次数，每立即获取锁，值加 1。</li>
<li>Table_locks_waited：指的是不能立即获取表极锁而需要等待的次数，每等待一次，该值加 1，此值越高说明存在着较为严重的表极锁争用情况。</li>
</ol>
<h3 id="2-5、InnoDB-行锁"><a href="#2-5、InnoDB-行锁" class="headerlink" title="2.5、InnoDB 行锁"></a>2.5、InnoDB 行锁</h3><h4 id="2-5-1、行锁介绍"><a href="#2-5-1、行锁介绍" class="headerlink" title="2.5.1、行锁介绍"></a>2.5.1、行锁介绍</h4><p>行锁特点：偏向 InnoDB 存储引擎，开销大，加锁慢；会出现死锁；锁定粒度小，发生锁冲突的概率最低，并发度最高。</p>
<p>InnoDB 与 MyISAM 的最大不同有两点：一是支持事务，二是采用了行级锁。</p>
<h4 id="2-5-2、背景知识"><a href="#2-5-2、背景知识" class="headerlink" title="2.5.2、背景知识"></a>2.5.2、背景知识</h4><p>1、事务及其ACID属性<br>事务是由一组 SQL 语句组成的逻辑处理单元。<br>事务具有以下 4 个特性，简称为 <strong>事务ACID属性</strong>。</p>
<table>
<thead>
<tr>
<th>ACID属性</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>原子性（Atomicity）</td>
<td>事务是一个原子操作单元，其对数据的修改，要么全部成功，要么全部失败</td>
</tr>
<tr>
<td>一致性（Consistent）</td>
<td>在事务开始和完成时，数据都必须保持一致状态</td>
</tr>
<tr>
<td>隔离性（Isolation）</td>
<td>数据库系统提供一定的隔离机制，保证事务在不受外部并发操作影响的“独立环境”下运行</td>
</tr>
<tr>
<td>持久性（Durable）</td>
<td>事务完成之后，对于数据的修改是永久的。</td>
</tr>
</tbody></table>
<p>2、并发事务处理带来的问题</p>
<table>
<thead>
<tr>
<th>问题</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>丢失更新（Lost Update）</td>
<td>当两个或多个事务选择同一行，最初的事务修改的值，会被后面的事务修改的值覆盖。</td>
</tr>
<tr>
<td>脏读（Dirty Reads）</td>
<td>当一个事务正在访问数据，并对数据进行了修改，而这种修改还没有提交到数据库中。这时，另外一个事务也访问了这个数据，然后使用了这个数据。</td>
</tr>
<tr>
<td>不可重复读（Non-Repeatable Reads）</td>
<td>一个事务在读取某些数据后的某个时间，再次读取以前读过的数据，却发现和以前读出的数据不一致。</td>
</tr>
<tr>
<td>幻读（Phantom Reads）</td>
<td>一个事务按照相同的查询条件重新读取以前查询过的数据，却发现其他事务插入了满足查询条件的新数据。</td>
</tr>
</tbody></table>
<p>3、事务隔离级别<br>为了解决上述提到的事务并发问题，数据库提供一定的事务隔离机制来解决这个问题。数据库的事务隔离越严格，并发副作用越小，但付出的代价也就越大，因为事务隔离实质上就是使用事务在一定程度上“串行化”进行，这显然与”并发“是矛盾的。</p>
<p>数据库的隔离级别有 4 个，由低到高依次为 <code>Read uncommitted</code>、<code>Read committed</code>、<code>Repeatable read</code>、<code>Serializbale</code> ，这四个几杯可以逐个解决 脏写、脏读、不可重复读、幻读这几类问题。</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>丢失更新</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody><tr>
<td>Read uncommitted</td>
<td>×</td>
<td>√</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>Read committed</td>
<td>×</td>
<td>×</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>Repeatable read（默认）</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>√</td>
</tr>
<tr>
<td>Serializable</td>
<td>×</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
</tbody></table>
<p>备注 ： √ 代表可能出现 ， × 代表不会出现 。</p>
<p><strong>MySQL 的数据库默认隔离级别为 Repeatable read</strong>，查看方式为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;tx_isolation&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h4 id="2-5-3、InnoDB-的行锁模式"><a href="#2-5-3、InnoDB-的行锁模式" class="headerlink" title="2.5.3、InnoDB 的行锁模式"></a>2.5.3、InnoDB 的行锁模式</h4><p>InnoDB 实现了以下两种类型的行锁。</p>
<ul>
<li>共享锁（S）：又称为 读锁，简称 S锁 ，共享锁就是多个事务对于同一数据可以共享一把锁，都能访问到数据，但是只能读不能修改。</li>
<li>排他锁（X）：又称为 写锁，简称 X锁 ，排他锁不能与其他锁并存，如一个事务获取了一个数据行的排他锁，其他事务就不能再获取该行的其他锁，包括共享锁和排他锁，但是获取排他锁的事务是可以对数据就 行 读取和修改。</li>
</ul>
<p>对于 UPDATE、DELETE、INSERT 语句，InnoDB 会自动给涉及数据集加 排他锁（X）；<br>对于普通 SELECT 语句， InnoDB 不会加任何锁；</p>
<p>可以通过以下语句显示给记录集加共享锁或排他锁。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">共享锁（S）：<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_name <span class="keyword">where</span> ... lock <span class="keyword">in</span> share mode</span><br><span class="line">排他锁（X）：<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_name <span class="keyword">where</span> ... <span class="keyword">for</span> update</span><br></pre></td></tr></table></figure>

<h4 id="2-5-6、无索引行锁升级为表锁"><a href="#2-5-6、无索引行锁升级为表锁" class="headerlink" title="2.5.6、无索引行锁升级为表锁"></a>2.5.6、无索引行锁升级为表锁</h4><p>如果不通过索引条件检索数据，那么 InnoDB 将对表中的所有记录加锁，实际效果跟表锁一样。</p>
<p>查看当前表的索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> test_innodb_lock;</span><br></pre></td></tr></table></figure>

<p>由于执行更新时， name 字段本来为 varchar 类型，我们是作为数据类型使用，存在类型转换，索引失效，最终 行锁变为表锁。</p>
<h4 id="2-5-7、间隙锁危害"><a href="#2-5-7、间隙锁危害" class="headerlink" title="2.5.7、间隙锁危害"></a>2.5.7、间隙锁危害</h4><p>当我们用范围条件，而不是使用相等条件检索数据，并请求共享或排它锁时，InnoDB 会给符合条件的已有数据进行加锁；对于键值在条件范围内但不存在记录，叫做“<strong>间隙（GAP）</strong>”，InnoDB 也会对这个“间隙”加锁，这种机制就是所谓的 <strong>间隙锁（Next-key锁）</strong></p>
<h4 id="2-5-8、InnoDB行锁争用情况"><a href="#2-5-8、InnoDB行锁争用情况" class="headerlink" title="2.5.8、InnoDB行锁争用情况"></a>2.5.8、InnoDB行锁争用情况</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;innodb_row_lock%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Innodb_row_lock_current_waits: 当前正在等待锁定的数量</span><br><span class="line"></span><br><span class="line">Innodb_row_lock_time: 从系统启动到现在锁定总时间长度</span><br><span class="line"></span><br><span class="line">Innodb_row_lock_time_avg:每次等待所花平均时长</span><br><span class="line"></span><br><span class="line">Innodb_row_lock_time_max:从系统启动到现在等待最长的一次所花的时间</span><br><span class="line"></span><br><span class="line">Innodb_row_lock_waits: 系统启动后到现在总共等待的次数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">当等待的次数很高，而且每次等待的时长也不小的时候，我们就需要分析系统中为什么会有如此多的等待，然后根据分析结果着手制定优化计划。</span><br></pre></td></tr></table></figure>

<h4 id="2-5-9、总结"><a href="#2-5-9、总结" class="headerlink" title="2.5.9、总结"></a>2.5.9、总结</h4><p>InnoDB 存储引擎由于实现了行级锁定，虽然在锁定机制的实现方面带来了性能损耗可能比表极锁会更高一些，但是在整体并发处理能力方面要远远优于MyISAM的表锁的。当系统并发量比较高的时候，InnoDB 的整体性能和 MyISAM 相比就会有比较明显的优势。</p>
<p>但是，InnoDB 的行级锁也有脆弱的一面，当我们使用不当的时候，可能会让 InnoDB 的整体性能表现不仅不能比 MyISAM 高，甚至会更差。</p>
<h4 id="2-5-10、优化建议"><a href="#2-5-10、优化建议" class="headerlink" title="2.5.10、优化建议"></a>2.5.10、优化建议</h4><ol>
<li>尽可能让所有数据检索都能通过索引来完成，避免无索引行锁升级为表锁。</li>
<li>合理设计索引，尽量缩小锁的范围</li>
<li>尽可能减少索引条件，及索引范围，避免间隙锁</li>
<li>尽量控制事务大小，减少锁定资源量和时间长度</li>
<li>尽可能使用低级别事务隔离（但是需要业务层满足需求）</li>
</ol>
<h2 id="3、常用MySQL技巧"><a href="#3、常用MySQL技巧" class="headerlink" title="3、常用MySQL技巧"></a>3、常用MySQL技巧</h2><h4 id="1-SQL-执行顺序"><a href="#1-SQL-执行顺序" class="headerlink" title="1. SQL 执行顺序"></a>1. SQL 执行顺序</h4><p>编写顺序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span></span><br><span class="line"> <span class="operator">&lt;</span><span class="keyword">select</span> list<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line"> <span class="operator">&lt;</span>left_table<span class="operator">&gt;</span> <span class="operator">&lt;</span>join_type<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">JOIN</span></span><br><span class="line"> <span class="operator">&lt;</span>right_table<span class="operator">&gt;</span> <span class="keyword">ON</span> <span class="operator">&lt;</span>join_condition<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line"> <span class="operator">&lt;</span>where_condition<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line"> <span class="operator">&lt;</span>group_by_list<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">HAVING</span></span><br><span class="line"> <span class="operator">&lt;</span>having_condition<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line"> <span class="operator">&lt;</span>order_by_condition<span class="operator">&gt;</span></span><br><span class="line">LIMIT</span><br><span class="line"> <span class="operator">&lt;</span>limit_params<span class="operator">&gt;</span></span><br><span class="line"><span class="number">12345678910111213141516</span></span><br></pre></td></tr></table></figure>

<p>执行顺序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span>	<span class="operator">&lt;</span>left_table<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ON</span> 		<span class="operator">&lt;</span>join_condition<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span>join_type<span class="operator">&gt;</span>		<span class="keyword">JOIN</span>	<span class="operator">&lt;</span>right_table<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span>		<span class="operator">&lt;</span>where_condition<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> 	<span class="operator">&lt;</span>group_by_list<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">HAVING</span>		<span class="operator">&lt;</span>having_condition<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span>		<span class="operator">&lt;</span><span class="keyword">select</span> list<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span>	<span class="operator">&lt;</span>order_by_condition<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line">LIMIT		<span class="operator">&lt;</span>limit_params<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>


<h4 id="2-正则表达式使用"><a href="#2-正则表达式使用" class="headerlink" title="2. 正则表达式使用"></a>2. 正则表达式使用</h4><p>正则表达式（Regular Expression）是指一个用来描述或者匹配一系列符合某个句法规则的字符串的单个字符串。</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>^</td>
<td>在字符串开始处进行匹配</td>
</tr>
<tr>
<td>$</td>
<td>在字符串末尾处进行匹配</td>
</tr>
<tr>
<td>.</td>
<td>匹配任意单个字符, 包括换行符</td>
</tr>
<tr>
<td>[…]</td>
<td>匹配出括号内的任意字符</td>
</tr>
<tr>
<td>[^…]</td>
<td>匹配不出括号内的任意字符</td>
</tr>
<tr>
<td>a*</td>
<td>匹配零个或者多个a(包括空串)</td>
</tr>
<tr>
<td>a+</td>
<td>匹配一个或者多个a(不包括空串)</td>
</tr>
<tr>
<td>a?</td>
<td>匹配零个或者一个a</td>
</tr>
<tr>
<td>a1|a2</td>
<td>匹配a1或a2</td>
</tr>
<tr>
<td>a(m)</td>
<td>匹配m个a</td>
</tr>
<tr>
<td>a(m,)</td>
<td>至少匹配m个a</td>
</tr>
<tr>
<td>a(m,n)</td>
<td>匹配m个a 到 n个a</td>
</tr>
<tr>
<td>a(,n)</td>
<td>匹配0到n个a</td>
</tr>
<tr>
<td>(…)</td>
<td>将模式元素组成单一元素</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * from emp where name regexp &#x27;^T&#x27;;</span><br><span class="line">select * from emp where name regexp &#x27;2$&#x27;;</span><br><span class="line">select * from emp where name regexp &#x27;[uvw]&#x27;;</span><br><span class="line">12345</span><br></pre></td></tr></table></figure>


<h4 id="3-MySQL-常用函数"><a href="#3-MySQL-常用函数" class="headerlink" title="3. MySQL 常用函数"></a>3. MySQL 常用函数</h4><p>数字函数</p>
<table>
<thead>
<tr>
<th>函数名称</th>
<th>作 用</th>
</tr>
</thead>
<tbody><tr>
<td>ABS</td>
<td>求绝对值</td>
</tr>
<tr>
<td>SQRT</td>
<td>求二次方根</td>
</tr>
<tr>
<td>MOD</td>
<td>求余数</td>
</tr>
<tr>
<td>CEIL 和 CEILING</td>
<td>两个函数功能相同，都是返回不小于参数的最小整数，即向上取整</td>
</tr>
<tr>
<td>FLOOR</td>
<td>向下取整，返回值转化为一个BIGINT</td>
</tr>
<tr>
<td>RAND</td>
<td>生成一个0~1之间的随机数，传入整数参数是，用来产生重复序列</td>
</tr>
<tr>
<td>ROUND</td>
<td>对所传参数进行四舍五入</td>
</tr>
<tr>
<td>SIGN</td>
<td>返回参数的符号</td>
</tr>
<tr>
<td>POW 和 POWER</td>
<td>两个函数的功能相同，都是所传参数的次方的结果值</td>
</tr>
<tr>
<td>SIN</td>
<td>求正弦值</td>
</tr>
<tr>
<td>ASIN</td>
<td>求反正弦值，与函数 SIN 互为反函数</td>
</tr>
<tr>
<td>COS</td>
<td>求余弦值</td>
</tr>
<tr>
<td>ACOS</td>
<td>求反余弦值，与函数 COS 互为反函数</td>
</tr>
<tr>
<td>TAN</td>
<td>求正切值</td>
</tr>
<tr>
<td>ATAN</td>
<td>求反正切值，与函数 TAN 互为反函数</td>
</tr>
<tr>
<td>COT</td>
<td>求余切值</td>
</tr>
</tbody></table>
<p>字符串函数</p>
<table>
<thead>
<tr>
<th>函数名称</th>
<th>作 用</th>
</tr>
</thead>
<tbody><tr>
<td>LENGTH</td>
<td>计算字符串长度函数，返回字符串的字节长度</td>
</tr>
<tr>
<td>CONCAT</td>
<td>合并字符串函数，返回结果为连接参数产生的字符串，参数可以使一个或多个</td>
</tr>
<tr>
<td>INSERT</td>
<td>替换字符串函数</td>
</tr>
<tr>
<td>LOWER</td>
<td>将字符串中的字母转换为小写</td>
</tr>
<tr>
<td>UPPER</td>
<td>将字符串中的字母转换为大写</td>
</tr>
<tr>
<td>LEFT</td>
<td>从左侧字截取符串，返回字符串左边的若干个字符</td>
</tr>
<tr>
<td>RIGHT</td>
<td>从右侧字截取符串，返回字符串右边的若干个字符</td>
</tr>
<tr>
<td>TRIM</td>
<td>删除字符串左右两侧的空格</td>
</tr>
<tr>
<td>REPLACE</td>
<td>字符串替换函数，返回替换后的新字符串</td>
</tr>
<tr>
<td>SUBSTRING</td>
<td>截取字符串，返回从指定位置开始的指定长度的字符换</td>
</tr>
<tr>
<td>REVERSE</td>
<td>字符串反转（逆序）函数，返回与原始字符串顺序相反的字符串</td>
</tr>
</tbody></table>
<p>日期函数</p>
<table>
<thead>
<tr>
<th>函数名称</th>
<th>作 用</th>
</tr>
</thead>
<tbody><tr>
<td>CURDATE 和 CURRENT_DATE</td>
<td>两个函数作用相同，返回当前系统的日期值</td>
</tr>
<tr>
<td>CURTIME 和 CURRENT_TIME</td>
<td>两个函数作用相同，返回当前系统的时间值</td>
</tr>
<tr>
<td>NOW 和 SYSDATE</td>
<td>两个函数作用相同，返回当前系统的日期和时间值</td>
</tr>
<tr>
<td>MONTH</td>
<td>获取指定日期中的月份</td>
</tr>
<tr>
<td>MONTHNAME</td>
<td>获取指定日期中的月份英文名称</td>
</tr>
<tr>
<td>DAYNAME</td>
<td>获取指定曰期对应的星期几的英文名称</td>
</tr>
<tr>
<td>DAYOFWEEK</td>
<td>获取指定日期对应的一周的索引位置值</td>
</tr>
<tr>
<td>WEEK</td>
<td>获取指定日期是一年中的第几周，返回值的范围是否为 0〜52 或 1〜53</td>
</tr>
<tr>
<td>DAYOFYEAR</td>
<td>获取指定曰期是一年中的第几天，返回值范围是1~366</td>
</tr>
<tr>
<td>DAYOFMONTH</td>
<td>获取指定日期是一个月中是第几天，返回值范围是1~31</td>
</tr>
<tr>
<td>YEAR</td>
<td>获取年份，返回值范围是 1970〜2069</td>
</tr>
<tr>
<td>TIME_TO_SEC</td>
<td>将时间参数转换为秒数</td>
</tr>
<tr>
<td>SEC_TO_TIME</td>
<td>将秒数转换为时间，与TIME_TO_SEC 互为反函数</td>
</tr>
<tr>
<td>DATE_ADD 和 ADDDATE</td>
<td>两个函数功能相同，都是向日期添加指定的时间间隔</td>
</tr>
<tr>
<td>DATE_SUB 和 SUBDATE</td>
<td>两个函数功能相同，都是向日期减去指定的时间间隔</td>
</tr>
<tr>
<td>ADDTIME</td>
<td>时间加法运算，在原始时间上添加指定的时间</td>
</tr>
<tr>
<td>SUBTIME</td>
<td>时间减法运算，在原始时间上减去指定的时间</td>
</tr>
<tr>
<td>DATEDIFF</td>
<td>获取两个日期之间间隔，返回参数 1 减去参数 2 的值</td>
</tr>
<tr>
<td>DATE_FORMAT</td>
<td>格式化指定的日期，根据参数返回指定格式的值</td>
</tr>
<tr>
<td>WEEKDAY</td>
<td>获取指定日期在一周内的对应的工作日索引</td>
</tr>
</tbody></table>
<p>聚合函数</p>
<table>
<thead>
<tr>
<th>函数名称</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>MAX</td>
<td>查询指定列的最大值</td>
</tr>
<tr>
<td>MIN</td>
<td>查询指定列的最小值</td>
</tr>
<tr>
<td>COUNT</td>
<td>统计查询结果的行数</td>
</tr>
<tr>
<td>SUM</td>
<td>求和，返回指定列的总和</td>
</tr>
<tr>
<td>AVG</td>
<td>求平均值，返回指定列数据的平均值</td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lyvivian0077.github.io/2020/02/03/Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyvivian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="总有刁民想要害朕">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/03/Bash%E7%BC%96%E7%A8%8B%E8%B6%85%E8%AF%A6%E7%BB%86%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">Bash编程超详细语法总结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-02-03 15:38:19" itemprop="dateCreated datePublished" datetime="2020-02-03T15:38:19+09:00">2020-02-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-06-22 12:58:45" itemprop="dateModified" datetime="2021-06-22T12:58:45+09:00">2021-06-22</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/r5KNvm90qYnnNOL3TAVXJA">原文</a></li>
</ul>
<p>在Linux学习过程中，我们无可避免的会碰到一个既让人喜欢，又令人头疼的神奇的东西——bash编程，即shell脚本。<br>那么什么是shell脚本呢？shell是一个命令语言解释器，而shell脚本则是Linux命令的集合，<br>按照预设的顺序依次解释执行，来完成特定的、较复杂的系统管理任务，类似于Windows中的批处理文件。<br>本文带来的是bash编程的基础语法讲解。</p>
<h2 id="bash编程之变量"><a href="#bash编程之变量" class="headerlink" title="bash编程之变量"></a>bash编程之变量</h2><h3 id="bash变量类别"><a href="#bash变量类别" class="headerlink" title="bash变量类别"></a>bash变量类别</h3><p><strong>本地变量</strong> : 只对当前shell进程有效的变量，对其它shell进程无效，包当前shell进程的子进程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VAR_NAME=VALUE</span><br></pre></td></tr></table></figure>

<p><strong>变量赋值</strong> : 向变量的存储空间保存数据</p>
<p><strong>变量引用</strong> : ${VAR_NAME} </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;:弱引用，里面的变量会被替换</span><br><span class="line">&#x27;&#x27;:强引用，里面的所有字符都是字面量，直接输出</span><br></pre></td></tr></table></figure>

<p><strong>环境变量</strong> : 对当前shell进程及其子shell有效，对其它的shell进程无效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">定义：export VAR_NAME=VALUE</span><br><span class="line">导出：export VAR_NAME</span><br><span class="line">撤消变量：unset VAR_NAME</span><br><span class="line">只读变量：readonly VAR_NAME</span><br></pre></td></tr></table></figure>

<p><strong>局部变量</strong> : 对shell脚本中某代码片断有效，通常用于函数本地</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">local VAR_NAME=VALUE</span><br></pre></td></tr></table></figure>

<p><strong>位置变量</strong> : 用来接受变量指定位置的参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$1,$2...,$&#123;10&#125;</span><br></pre></td></tr></table></figure>

<p><strong>特殊变量</strong> : shell对一些参数做特殊处理,这些参数只能被引用而不能被赋值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$#  传递到脚本的参数个数</span><br><span class="line">$*  显示所有向脚本传递的参数                  #与位置变量不同，此选项参数可超过9个</span><br><span class="line">$$  获取当前shell的进程号</span><br><span class="line">$!  执行上一个指令的进程号</span><br><span class="line">$?  获取执行的上一个指令的返回值              #0为执行成功，非零为执行失败</span><br><span class="line">$-  显示shell使用的当前选项，与set命令功能相同</span><br><span class="line">$@  与$*相同，但是使用时加引号，并在引号中返回每个参数</span><br></pre></td></tr></table></figure>

<p><strong>查看变量</strong> :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set：查看当前shell进程中的所有变量</span><br><span class="line">export, printenv, env：查看当前shell进程中的所有环境变量</span><br></pre></td></tr></table></figure>

<p><strong>变量命名</strong> :</p>
<ol>
<li>不能使用程序中的关键字（保留字）</li>
<li>只能使用数字、字母和下划线，且不能以数字开头</li>
<li>要见名知义</li>
</ol>
<p><strong>变量类型</strong> :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">数值型：精确数值(整数)，近似数值（浮点型）</span><br><span class="line">字符型：char,string</span><br><span class="line">布尔型：true, false</span><br></pre></td></tr></table></figure>

<p><strong>类型转换</strong> :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">显式转换</span><br><span class="line">隐式转换</span><br></pre></td></tr></table></figure>


<h3 id="bash的配置文件："><a href="#bash的配置文件：" class="headerlink" title="bash的配置文件："></a>bash的配置文件：</h3><h4 id="功能：设定本地变量，定义命令别名"><a href="#功能：设定本地变量，定义命令别名" class="headerlink" title="功能：设定本地变量，定义命令别名"></a>功能：设定本地变量，定义命令别名</h4><ul>
<li>profile类：为交互式登录的用户提供配置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">全局：/etc/profile、/etc/profile.d/*.sh</span><br><span class="line">用户：~/.bash_profile</span><br></pre></td></tr></table></figure>

<ul>
<li>bashrc类：为非交互式的用户提供配置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">全局：/etc/bashrc</span><br><span class="line">用户：~/.bashrc</span><br></pre></td></tr></table></figure>

<h4 id="bash编程之编写格式及执行方式"><a href="#bash编程之编写格式及执行方式" class="headerlink" title="bash编程之编写格式及执行方式"></a>bash编程之编写格式及执行方式</h4><ul>
<li>编写格式：shell脚本第一行必须顶格写，用shebang定义指定的解释器来解释该脚本。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash       #!即为shebang</span><br><span class="line"># 其它的以#开头的行均为注释，会被解释器忽略，可用来注释脚本用途及版本，方便使用管理。</span><br></pre></td></tr></table></figure>

<ul>
<li>执行方式：bash编程属于面向过程编程，执行方式如下：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">顺序执行：按命令先后顺寻依次执行</span><br><span class="line">选择执行：测试条件，可能会多个测试条件，某条件满足时，则执行对应的分支</span><br><span class="line">循环执行：将同一段代码反复执行多次，因此，循环必须有退出条件；否则，则陷入死循环</span><br></pre></td></tr></table></figure>

<ul>
<li>bash执行选项：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash -n SHELLNAME  #语法测试，测试是否存在语法错误</span><br><span class="line">bash -x SHELLNAME  #模拟单步执行，显示每一步执行过程</span><br></pre></td></tr></table></figure>


<h4 id="bash之算数运算与逻辑运算"><a href="#bash之算数运算与逻辑运算" class="headerlink" title="bash之算数运算与逻辑运算"></a>bash之算数运算与逻辑运算</h4><ul>
<li><p>算数运算</p>
<ul>
<li>定义整型变量：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let VAR_NAME=INTEGER_VALUE            #例如：let a=3</span><br><span class="line">declare -i VAR_NAME=INTEGER_VALUE     #declare -i a=3</span><br></pre></td></tr></table></figure></li>
<li>实现算术运算的方式：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let VAR_NAME=ARITHMATIC_EXPRESSION</span><br><span class="line">VAR_NAME=$[ARITHMATIC_EXRESSION]</span><br><span class="line">VAR_NAME=$((EXPRESSION))</span><br><span class="line">VAR_NAME=$(expr $num1 + $num2)</span><br></pre></td></tr></table></figure></li>
<li>算术运算符：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+：加法</span><br><span class="line">-：减法</span><br><span class="line">*：乘法</span><br><span class="line">/：整除</span><br><span class="line">%：取余数</span><br><span class="line">**：乘幂</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：即使没有定义为整型变量，字符型的数字依然可以参与算术运算，bash会执行变量类型的隐式类型转换。</p>
</blockquote>
</li>
<li>逻辑运算</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">布尔运算：真，假</span><br><span class="line">与运算：真 &amp;&amp; 真 = 真</span><br><span class="line">        真 &amp;&amp; 假 = 假</span><br><span class="line">        假 &amp;&amp; 真 = 假</span><br><span class="line">        假 &amp;&amp; 假 = 假</span><br><span class="line">或运算：真 || 真 = 真</span><br><span class="line">  真 || 假 = 真</span><br><span class="line">  假 || 真 = 真</span><br><span class="line">  假 || 假 = 假</span><br><span class="line">非运算：！真=假</span><br><span class="line">        ！假=真</span><br></pre></td></tr></table></figure>

<h3 id="bash编程之条件测试语句"><a href="#bash编程之条件测试语句" class="headerlink" title="bash编程之条件测试语句"></a>bash编程之条件测试语句</h3><h4 id="bash条件测试"><a href="#bash条件测试" class="headerlink" title="bash条件测试"></a>bash条件测试</h4><p><strong>整型测试</strong>：整数比较</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">例如 [ $num1 -gt $num2 ]</span><br><span class="line"></span><br><span class="line">-gt: 大于则为真</span><br><span class="line">-lt: 小于则为真</span><br><span class="line">-ge: 大于等于则为真</span><br><span class="line">-le: 小于等于则为真</span><br><span class="line">-eq: 等于则为真</span><br><span class="line">-ne: 不等于则为真</span><br></pre></td></tr></table></figure>

<p><strong>字符测试</strong>：字符串比较</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">双目：</span><br><span class="line">例如[[ &quot;$str1&quot; &gt; &quot;$str2&quot; ]]</span><br><span class="line"></span><br><span class="line">&gt;: 大于则为真</span><br><span class="line">&lt;: 小于则为真</span><br><span class="line">&gt;=：大于等于则为真</span><br><span class="line">&lt;=：小于等于则为真</span><br><span class="line">==：等于则为真</span><br><span class="line">!=：不等于则为真</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">单目：</span><br><span class="line">-n String: 是否不空，不空则为真，空则为假</span><br><span class="line">-z String: 是否为空，空则为真，不空则假</span><br><span class="line"></span><br><span class="line">文件测试：判断文件的存在性及属性等</span><br><span class="line"></span><br><span class="line">-a FILE：存在则为真；否则则为假；</span><br><span class="line">-e FILE: 存在则为真；否则则为假；</span><br><span class="line">-f FILE: 存在并且为普通文件，则为真；否则为假；</span><br><span class="line">-d FILE: 存在并且为目录文件，则为真；否则为假；</span><br><span class="line">-L/-h FILE: 存在并且为符号链接文件，则为真；否则为假；</span><br><span class="line">-b: 存在并且为块设备，则为真；否则为假；</span><br><span class="line">-c: 存在并且为字符设备，则为真；否则为假</span><br><span class="line">-S: 存在并且为套接字文件，则为真；否则为假</span><br><span class="line">-p: 存在并且为命名管道，则为真；否则为假</span><br><span class="line">-s FILE: 存在并且为非空文件则为值，否则为假；</span><br><span class="line">-r FILE：文件可读为真，否则为假</span><br><span class="line">-w FILE：文件可写为真，否则为假</span><br><span class="line">-x FILE：文件可执行为真，否则为假</span><br><span class="line">file1 -nt file2: file1的mtime新于file2则为真，否则为假；</span><br><span class="line">file1 -ot file2：file1的mtime旧于file2则为真，否则为假；</span><br><span class="line"></span><br><span class="line">组合条件测试：在多个条件间实现逻辑运算</span><br><span class="line"></span><br><span class="line">与：[ condition1 -a condition2 ]</span><br><span class="line">  condition1 &amp;&amp; condition2</span><br><span class="line">或：[ condition1 -o condition2 ]</span><br><span class="line">  condition1 || condition2</span><br><span class="line">非：[ -not condition ]</span><br><span class="line">  ! condition</span><br><span class="line">与：COMMAND1 &amp;&amp; COMMAND2</span><br><span class="line">COMMAND1如果为假，则COMMAND2不执行</span><br><span class="line">或：COMMAND1 || COMMAND2</span><br><span class="line">COMMAND1如果为真，则COMMAND2不执行</span><br><span class="line">非：! COMMAND</span><br></pre></td></tr></table></figure>

<p><strong>条件测试之if语句</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">1、if语句之单分支</span><br><span class="line">语句结构：</span><br><span class="line">if 测试条件;then</span><br><span class="line">   选择分支</span><br><span class="line">fi</span><br><span class="line">表示条件测试状态返回值为值，则执行选择分支</span><br><span class="line">例：写一个脚本，接受一个参数，这个参数是用户名；如果此用户不存在，则创建该用户；</span><br><span class="line"></span><br><span class="line">#！/bin/bash</span><br><span class="line">if ! id $1 &amp;&gt; /dev/null;then</span><br><span class="line">  useradd $1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">2、if语句之双分支</span><br><span class="line">语句结构：</span><br><span class="line">if 测试条件;then</span><br><span class="line">   选择分支1</span><br><span class="line">else</span><br><span class="line">   选择分支2</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">两个分支仅执行其中之一</span><br><span class="line">例：通过命令行给定一个文件路径，而后判断：如果此文件中存在空白行，则显示其空白行的总数；否则，则显示无空白行；</span><br><span class="line">#！/bin/bash</span><br><span class="line">if grep &quot;^[[:space]]*$&quot; $1 &amp;&gt; /dev/null; then</span><br><span class="line">  echo &quot;$1 has $(grep &quot;^[[:space]]*$&quot; $1 | wc -l) blank lines.&quot;</span><br><span class="line">else</span><br><span class="line">  echo &quot;No blank lines&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">注意：如果把命令执行成功与否当作条件，则if语句后必须只跟命令本身，而不能引用。</span><br><span class="line"></span><br><span class="line">3、if语句之多分支</span><br><span class="line">语句结构：</span><br><span class="line">if 条件1;then</span><br><span class="line">     分支1</span><br><span class="line">elif 条件2;then</span><br><span class="line">     分支2</span><br><span class="line">elif 条件3;then</span><br><span class="line">     分支3</span><br><span class="line">      ...</span><br><span class="line">else</span><br><span class="line">     分支n</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">例：传递一个用户名给脚本：如果此用户的id号为0，则显示说这是管理员；如果此用户的id号大于等于500，则显示说这是普通用户；否则，则说这是系统用户。</span><br><span class="line">#!/bin/bash</span><br><span class="line">if [ $# -lt 1 ]; then</span><br><span class="line">  echo &quot;Usage: `basename $0` username&quot;</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line">if ! id -u $1 &amp;&gt; /dev/null; then</span><br><span class="line">  echo &quot;Usage: `basename $0` username&quot;</span><br><span class="line">  echo &quot;No this user $1.&quot;</span><br><span class="line">  exit 2</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ $(id -u $1) -eq 0 ]; then</span><br><span class="line">  echo &quot;Admin&quot;</span><br><span class="line">elif [ $(id -u $1) -ge 500 ]; then</span><br><span class="line">  echo &quot;Common user.&quot;</span><br><span class="line">else</span><br><span class="line">  echo &quot;System user.&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>


<p><strong>bash交互式编程</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">read [option] “prompt”-p:直接指定一个变量接受参数</span><br><span class="line">-t timaout：指定等待接受参数的时间</span><br><span class="line">-n:表示不换行</span><br><span class="line"></span><br><span class="line">例：输入用户名，可返回其shell</span><br><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line">read -p &quot;Plz input a username: &quot; userName</span><br><span class="line">if id $userName &amp;&gt; /dev/null; then</span><br><span class="line">    echo &quot;The shell of $userName is `grep &quot;^$userName\&gt;&quot; /etc/passwd | cut -d: -f7`.&quot;</span><br><span class="line">else</span><br><span class="line">    echo &quot;No such user. stupid.&quot;</span><br><span class="line">fi    </span><br></pre></td></tr></table></figure>

<p><strong>条件测试之case语句</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">case语句：有多个测试条件时，case语句会使得语法结构更明晰</span><br><span class="line">语句结构：</span><br><span class="line"></span><br><span class="line">case 变量引用 in</span><br><span class="line">PATTERN1)</span><br><span class="line">  分支1</span><br><span class="line">;;</span><br><span class="line">PATTERN2)</span><br><span class="line">  分支2</span><br><span class="line">;;</span><br><span class="line">...</span><br><span class="line">*)</span><br><span class="line">  分支n</span><br><span class="line">;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<p><strong>PATTERN：类同于文件名通配机制，但支持使用|表示或者</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"> a|b:  a或者b*：匹配任意长度的任意字符</span><br><span class="line">?: 匹配任意单个字符</span><br><span class="line">[]: 指定范围内的任意单个字符</span><br><span class="line"></span><br><span class="line">例：写一个脚本，完成如下任务，其使用形式如下所示：</span><br><span class="line">script.sh &#123;start|stop|restart|status&#125;</span><br><span class="line"></span><br><span class="line">其中：如果参数为空，则显示帮助信息，并退出脚本；</span><br><span class="line">如果参数为start，则创建空文件/var/lock/subsys/script，并显示“starting script successfully.”</span><br><span class="line">如果参数为stop，则删除文件/var/lock/subsys/script，并显示“Stop script successfully.”</span><br><span class="line">如果参数为restart，则删除文件/var/locksubsys/script并重新创建，而后显示“Restarting script successfully.”</span><br><span class="line">如果参数为status，那么：如果文件/var/lock/subsys/script存在，则显示“Script is running…”，否则，则显示“Script is stopped.”</span><br><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line">file=&#x27;/var/lock/subsys/script&#x27;</span><br><span class="line">case $1 in</span><br><span class="line">start)</span><br><span class="line">  if [ -f $file ];then</span><br><span class="line">  echo &quot;Script is running...&quot;</span><br><span class="line">    exit 3</span><br><span class="line">  else</span><br><span class="line">  touch $file</span><br><span class="line">  [ $? -eq 0 ] &amp;&amp; echo &quot;Starting script successfully.&quot;</span><br><span class="line">  fi</span><br><span class="line">  ;;</span><br><span class="line">stop)</span><br><span class="line">  if [ -f $file ];then</span><br><span class="line">  rm -rf $file</span><br><span class="line">  [ $? -eq 0 ] &amp;&amp; echo &quot;Stop script successfully.&quot;</span><br><span class="line">  else</span><br><span class="line">  echo &quot;Script is stopped...&quot;</span><br><span class="line">  exit 4</span><br><span class="line">  fi</span><br><span class="line">  ;;</span><br><span class="line">restart)</span><br><span class="line">  if [ -f $file ];then</span><br><span class="line">  rm -rf $file</span><br><span class="line">  [ $? -eq 0 ] &amp;&amp; echo &quot;Stop script successfully&quot;</span><br><span class="line">  else </span><br><span class="line">  echo &quot;Script is stopped...&quot;</span><br><span class="line">  exit 5</span><br><span class="line">  fi</span><br><span class="line">  touch $file</span><br><span class="line">  [ $? -eq 0 ] &amp;&amp; echo &quot;Starting script successfully&quot;</span><br><span class="line">  ;;</span><br><span class="line">status)</span><br><span class="line">  if [ -f $file ];then</span><br><span class="line">  echo &quot;Script is running...&quot;</span><br><span class="line">  else</span><br><span class="line">  echo &quot;Script is stopped.&quot;</span><br><span class="line">  fi</span><br><span class="line">  ;;</span><br><span class="line">*)</span><br><span class="line">  echo &quot;`basename $0` &#123;start|stop|restart|status&#125;&quot;</span><br><span class="line">  exit 2</span><br><span class="line">  ;;</span><br><span class="line"> esac</span><br></pre></td></tr></table></figure>


<h4 id="bash编程之循环语句"><a href="#bash编程之循环语句" class="headerlink" title="bash编程之循环语句"></a>bash编程之循环语句</h4><p><strong>循环之for循环</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1、for语句格式一</span><br><span class="line">语句结构：</span><br><span class="line">for 变量名 in 列表; do</span><br><span class="line">    循环体</span><br><span class="line">done</span><br><span class="line">列表：可包含一个或多个元素</span><br><span class="line">循环体：依赖于调用变量来实现其变化</span><br><span class="line">循环可嵌套</span><br><span class="line">退出条件：遍历元素列表结束</span><br><span class="line">例：求100以内所有正整数之和</span><br><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line">declare -i sum=0</span><br><span class="line">for i in &#123;1..100&#125;; do</span><br><span class="line">    let sum+=$i</span><br><span class="line">done</span><br><span class="line">echo $sum</span><br><span class="line"></span><br><span class="line">2、for语句格式二</span><br><span class="line">for ((初始条件;测试条件;修改表达式)); do</span><br><span class="line">      循环体</span><br><span class="line">done</span><br><span class="line">先用初始条件和测试条件做判断，如果符合测试条件则执行循环体，再修改表达式，否则直接跳出循环。</span><br><span class="line"></span><br><span class="line">例：求100以内所有正整数之和（for二实现）</span><br><span class="line">#!/bin/bash</span><br><span class="line">declare -i sum=0</span><br><span class="line">for ((counter=1;$counter &lt;= 100; counter++)); do</span><br><span class="line">  let sum+=$counter</span><br><span class="line">done</span><br><span class="line">echo $sum</span><br></pre></td></tr></table></figure>

<p><strong>循环之while语句</strong></p>
<p>while适用于循环次数未知，或不便用for直接生成较大的列表时</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">语句结构：</span><br><span class="line">while 测试条件; do</span><br><span class="line">  循环体</span><br><span class="line">done</span><br><span class="line">测试条件为真，进入循环；测试条件为假，退出循环</span><br><span class="line">例1：求100以内所有偶数之和，要求使用取模方法</span><br><span class="line">#!/bin/bash</span><br><span class="line">declare -i counter=1</span><br><span class="line">declare -i sum=0</span><br><span class="line">while [ $counter -le 100 ]; do</span><br><span class="line">  if [ $[$counter%2] -eq 0 ]; then</span><br><span class="line">     let sum+=$counter</span><br><span class="line">  fi</span><br><span class="line">  let counter++</span><br><span class="line"> done</span><br><span class="line">echo $sum</span><br><span class="line"></span><br><span class="line">例2：提示用户输入一个用户名，如果用户存在，就显示用户的ID号和shell；否则显示用户不存在；显示完成之后不退出，再次重复前面的操作，直到用户输入q或quit为止</span><br><span class="line">#!/bin/bash</span><br><span class="line">read -p &quot;Plz enter a username: &quot; userName</span><br><span class="line">while [ &quot;$userName&quot; != &#x27;q&#x27; -a &quot;$userName&quot; != &#x27;quit&#x27; ]; do</span><br><span class="line">  if id $userName &amp;&gt; /dev/null; then</span><br><span class="line">     grep &quot;^$userName\&gt;&quot; /etc/passwd | cut -d: -f3,7</span><br><span class="line">  else</span><br><span class="line">    echo &quot;No such user.&quot;</span><br><span class="line">  fi</span><br><span class="line">read -p &quot;Plz enter a username again: &quot; userName</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">while特殊用法：遍历文本文件</span><br><span class="line">语句结构：</span><br><span class="line">while read 变量名; do</span><br><span class="line">  循环体</span><br><span class="line">done &lt; /path/to/somefile</span><br><span class="line">变量名，每循环一次，记忆了文件中一行文本</span><br><span class="line"></span><br><span class="line">例：显示ID号为偶数，且ID号同GID的用户的用户名、ID和SHELL</span><br><span class="line">while read line; do</span><br><span class="line">  userID=`echo $line | cut -d: -f3`</span><br><span class="line">  groupID=`echo $line | cut -d: -f4`</span><br><span class="line">  if [ $[$userID%2] -eq 0 -a $userID -eq $groupID ]; then</span><br><span class="line">     echo $line | cut -d: -f1,3,7</span><br><span class="line">  fi</span><br><span class="line">done &lt; /etc/passwd</span><br></pre></td></tr></table></figure>

<p><strong>循环之until语句</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">语句结构：</span><br><span class="line">until 测试条件; do</span><br><span class="line">      循环体</span><br><span class="line">done</span><br><span class="line">测试条件为假，进入循环；测试条件为真，退出循环</span><br><span class="line"></span><br><span class="line">例：求100以内所有偶数之和，要求使用取模方法（until实现）</span><br><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line">declare -i counter=1</span><br><span class="line">declare -i sum=0</span><br><span class="line">until [ $counter -gt 100 ]; do</span><br><span class="line">  if [ $[$counter%2] -eq 0 ]; then</span><br><span class="line">     let sum+=$counter</span><br><span class="line">  fi</span><br><span class="line">  let counter++</span><br><span class="line">done</span><br><span class="line">echo $sum</span><br><span class="line">例：提示用户输入一个用户名，如果用户存在，就显示用户的ID号和shell；否则显示用户不存在；显示完成之后不退出，再次重复前面的操作，直到用户输入q或quit为止（until实现）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line">read -p &quot;Plz enter a username: &quot; userName</span><br><span class="line">until [ &quot;$userName&quot; = &#x27;q&#x27; -a &quot;$userName&quot; = &#x27;quit&#x27; ]; do</span><br><span class="line">  if id $userName &amp;&gt; /dev/null; then</span><br><span class="line">   grep &quot;^$userName\&gt;&quot; /etc/passwd | cut -d: -f3,7</span><br><span class="line">else</span><br><span class="line">echo &quot;No such user.&quot;</span><br><span class="line">fi</span><br><span class="line">read -p &quot;Plz enter a username again: &quot; userName</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p><strong>循环之循环控制和shift</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">循环控制命令：</span><br><span class="line">break：提前退出循环</span><br><span class="line">break [N]: 退出N层循环；N省略时表示退出break语句所在的循环</span><br><span class="line">continue: 提前结束本轮循环，而直接进入下轮循环</span><br><span class="line">continue [N]：提前第N层的循环的本轮循环，而直接进入下轮循环</span><br></pre></td></tr></table></figure>

<p><strong>死循环：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#while体while true; do</span><br><span class="line">      循环体</span><br><span class="line">done</span><br><span class="line">#until体</span><br><span class="line">until false; do</span><br><span class="line">      循环体</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">例1：写一个脚本，判断给定的用户是否登录了当前系统</span><br><span class="line">(1) 如果登录了，则脚本终止；</span><br><span class="line">(2) 每5秒种，查看一次用户是否登录；</span><br><span class="line">#!/bin/bash</span><br><span class="line">while true; do</span><br><span class="line">    who | grep &quot;gentoo&quot; &amp;&gt; /dev/null</span><br><span class="line">    if [ $? -eq 0 ];then</span><br><span class="line">break</span><br><span class="line">    fi</span><br><span class="line">    sleep 5</span><br><span class="line">done</span><br><span class="line">echo &quot;gentoo is logged.&quot;</span><br></pre></td></tr></table></figure>

<p><strong>shift：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">如果没有数字，只有shift 就是跳过一个参数获取下一个参数，如果加上数字，比如shift 2 ，跳过两个参数获取下一个参数。</span><br><span class="line">例：写一个脚本，使用形式如下所示    </span><br><span class="line">showifinfo.sh [-i INTERFACE|-a] [-v]</span><br><span class="line">要求：</span><br><span class="line">1、-i或-a不可同时使用，-i用于指定特定网卡接口，-a用于指定所有接口；</span><br><span class="line">显示接口的ip地址</span><br><span class="line">2、使用-v，则表示显示详细信息，显示接口的ip地址、子网掩码、广播地址；</span><br><span class="line">3、默认表示仅使用-a选项;</span><br><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line">allinterface=0</span><br><span class="line">ifflag=0</span><br><span class="line">verbose=0</span><br><span class="line">interface=0</span><br><span class="line">if [ $# -eq 0 ];then</span><br><span class="line">  ifconfig | grep &quot;inet addr:&quot; | awk &#x27;&#123;print $2&#125;&#x27;</span><br><span class="line">fi</span><br><span class="line">while [ $# -ge 1 ];do</span><br><span class="line">  case $1 in </span><br><span class="line">-a)</span><br><span class="line"> allinterface=1</span><br><span class="line"> shift 1</span><br><span class="line">  ;;</span><br><span class="line">-i)</span><br><span class="line">  ifflag=1</span><br><span class="line">  interface=$2</span><br><span class="line">  shift 2</span><br><span class="line">  ;;</span><br><span class="line">-v)</span><br><span class="line">  verbose=1</span><br><span class="line">  shift 1</span><br><span class="line">  ;;</span><br><span class="line">  *)</span><br><span class="line">echo &quot;error option&quot;</span><br><span class="line">exit 2</span><br><span class="line">  ;;</span><br><span class="line">  esac</span><br><span class="line">done</span><br><span class="line">if [ $allinterface -eq 1 ];then</span><br><span class="line">  if [ $ifflag -eq 1 ];then</span><br><span class="line">   echo &quot;command not found&quot;</span><br><span class="line">    exit 5</span><br><span class="line">  fi</span><br><span class="line">  if [ $verbose -eq 1 ];then</span><br><span class="line">    ifconfig | grep &quot;inet addr:&quot;</span><br><span class="line">  else</span><br><span class="line">    ifconfig | grep &quot;inet addr:&quot; | awk &#x27;&#123;print $2&#125;&#x27;</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line">if [ $ifflag -eq 1 ];then</span><br><span class="line">  if [ $allinterface -eq 1 ];then</span><br><span class="line">        echo &quot;command not found&quot;</span><br><span class="line">        exit 5</span><br><span class="line">  fi</span><br><span class="line"> if [ $verbose -eq 1 ];then</span><br><span class="line">    ifconfig $interface | grep &quot;inet addr:&quot;</span><br><span class="line">  else</span><br><span class="line">    ifconfig $interface | grep &quot;inet addr:&quot; | awk &#x27;&#123;print $2&#125;&#x27;</span><br><span class="line">  fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<h3 id="bash编程之函数"><a href="#bash编程之函数" class="headerlink" title="bash编程之函数"></a>bash编程之函数</h3><h4 id="语法结构："><a href="#语法结构：" class="headerlink" title="语法结构："></a>语法结构：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function F_NAME &#123;    </span><br><span class="line">   函数体</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  F_NAME() &#123;</span><br><span class="line">    函数体</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>可调用：使用函数名，函数名出现的地方，会被自动替换为函数<br>函数的返回值：<br>函数的执行结果返回值：代码的输出<br>函数中使用打印语句：echo, printf<br>函数中调用的系统命令执行后返回的结果<br>执行状态返回值：<br>默认取决于函数体执行的最后一个命令状态结果<br>自定义退出状态码：return [0-255]</p>
<blockquote>
<p>注意：函数体运行时，一旦遇到return语句，函数即返回；</p>
</blockquote>
<p><strong>函数可以接受参数：</strong><br>在函数体中调用函数参数的方式同脚本中调用脚本参数的方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">位置参数</span><br><span class="line">$1, $2, …</span><br><span class="line">$#, $*, $@</span><br></pre></td></tr></table></figure>

<p>例：写一个脚本，完成如下功能(使用函数)：</p>
<p>1、提示用户输入一个可执行命令；</p>
<p>2、获取这个命令所依赖的所有库文件(使用ldd命令)；</p>
<p>3、复制命令至/mnt/sysroot/对应的目录中</p>
<p>解释：假设，如果复制的是cat命令，其可执行程序的路径是/bin/cat，那么就要将/bin/cat复到/mnt/sysroot/bin/目录中，如果复制的是useradd命令，而useradd的可执行文件路径为/usr/sbin/useradd，那么就要将其复制到/mnt/sysroot/usr/sbin/目录中；</p>
<p>4、复制各库文件至/mnt/sysroot/对应的目录中；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">target=/mnt/sysroot/</span><br><span class="line">[ -d $target ] || mkdir $target</span><br><span class="line">preCommand() &#123;</span><br><span class="line">    if which $1 &amp;&gt; /dev/null; then</span><br><span class="line">  commandPath=`which --skip-alias $1`</span><br><span class="line">  return 0</span><br><span class="line">    else</span><br><span class="line">  echo &quot;No such command.&quot;</span><br><span class="line">  return 1</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">commandCopy() &#123;</span><br><span class="line">    commandDir=`dirname $1`</span><br><span class="line">    [ -d $&#123;target&#125;$&#123;commandDir&#125; ] || mkdir -p $&#123;target&#125;$&#123;commandDir&#125;</span><br><span class="line">    [ -f $&#123;target&#125;$&#123;commandPath&#125; ] || cp $1 $&#123;target&#125;$&#123;commandDir&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">libCopy() &#123;</span><br><span class="line">    for lib in `ldd $1 | egrep -o &quot;/[^[:space:]]+&quot;`; do</span><br><span class="line">libDir=`dirname $lib`</span><br><span class="line">[ -d $&#123;target&#125;$&#123;libDir&#125; ] || mkdir -p $&#123;target&#125;$&#123;libDir&#125;</span><br><span class="line">[ -f $&#123;target&#125;$&#123;lib&#125; ] || cp $lib $&#123;target&#125;$&#123;libDir&#125;</span><br><span class="line">    done</span><br><span class="line">&#125; </span><br><span class="line">read -p &quot;Plz enter a command: &quot; command</span><br><span class="line"></span><br><span class="line">until [ &quot;$command&quot; == &#x27;quit&#x27; ]; do</span><br><span class="line"></span><br><span class="line">  if preCommand $command &amp;&gt; /dev/null; then</span><br><span class="line">    commandCopy $commandPath</span><br><span class="line">    libCopy $commandPath</span><br><span class="line">  fi</span><br><span class="line"></span><br><span class="line">  read -p &quot;Plz enter a command: &quot; command</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h4 id="bash编程之信号捕捉"><a href="#bash编程之信号捕捉" class="headerlink" title="bash编程之信号捕捉"></a>bash编程之信号捕捉</h4><p>trap命令用于在shell程序中捕捉到信号，之后可以有三种反应方式：</p>
<ul>
<li>(1)执行一段程序来处理这一信号</li>
<li>(2)接受信号的默认操作</li>
<li>(3)忽视这一信号</li>
</ul>
<p>trap对上面三种方式提供了三种基本形式：</p>
<p>第一种形式的trap命令在shell接收到signal list清单中数值相同的信号时，将执行双引号中的命令串。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">trap &#x27;commands&#x27; signal-list</span><br><span class="line">trap &quot;commands&quot; signal-list</span><br></pre></td></tr></table></figure>

<p>第二种形式的trap命令恢复信号的默认操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trap signal-list</span><br></pre></td></tr></table></figure>

<p>第三种形式的trap命令允许忽视信号：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">trap &quot; &quot; signal-list</span><br><span class="line">trap &#x27;COMMAND&#x27; SIGINT（表示关闭进程）</span><br></pre></td></tr></table></figure>

<p>例：写一个脚本，能够ping探测指定网络内的所有主机是否在线,当没有执行完时可接收ctrl+c命令退出。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line">quitScript() &#123;</span><br><span class="line">   echo &quot;Quit...&quot;</span><br><span class="line">&#125;    </span><br><span class="line">trap &#x27;quitScript; exit 5&#x27; SIGINT</span><br><span class="line"></span><br><span class="line">cnetPing() &#123;</span><br><span class="line">  for i in &#123;1..254&#125;; do</span><br><span class="line">    if ping -c 1 -W 1 $1.$i &amp;&gt; /dev/null; then</span><br><span class="line">      echo &quot;$1.$i is up.&quot;</span><br><span class="line">     else</span><br><span class="line">      echo &quot;$1.$i is down.&quot;</span><br><span class="line">    fi</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bnetPing() &#123;</span><br><span class="line">  for j in &#123;0..255&#125;; do</span><br><span class="line">    cnetPing $1.$j </span><br><span class="line">  done</span><br><span class="line">&#125;</span><br><span class="line">anetPing() &#123;</span><br><span class="line">for m in &#123;0..255&#125;; do</span><br><span class="line">bnetPing $1.$m</span><br><span class="line">done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">netType=`echo $1 | cut -d&quot;.&quot; -f1`</span><br><span class="line"></span><br><span class="line">if [ $netType -ge 1 -a $netType -le 126 ]; then</span><br><span class="line">anetPing $netType</span><br><span class="line">elif [ $netType -ge 128 -a $netType -le 191 ]; then</span><br><span class="line">bnetPing $(echo $1 | cut -d&#x27;.&#x27; -f1,2)</span><br><span class="line">elif [ $netType -ge 192 -a $netType -le 223 ]; then</span><br><span class="line">cnetPing $(echo $1 | cut -d&#x27;.&#x27; -f1-3)</span><br><span class="line">else</span><br><span class="line">echo &quot;Wrong&quot;</span><br><span class="line">exit 2</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<h3 id="bash编程之数组"><a href="#bash编程之数组" class="headerlink" title="bash编程之数组"></a>bash编程之数组</h3><p><strong>数组</strong>：连续的多个独立内存空间，每个内存空间相当于一个变量<br><strong>数组元素</strong>：数组名+索引（从0开始编号）<br><strong>索引的表示方式</strong>：a[0], a[1]<br><strong>声明数组</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">declare -a ARRAR_NAME</span><br></pre></td></tr></table></figure>
<p><strong>关联数组</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">declare -A ARRAY_NAME</span><br></pre></td></tr></table></figure>

<p>支持稀疏格式：仅一维数组  </p>
<p>数组元素的赋值：</p>
<p>(1) 一次只赋值一个元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[0]=$RANDOM</span><br></pre></td></tr></table></figure>

<p>(2) 一次赋值全部元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=(red blue yellow green)</span><br></pre></td></tr></table></figure>

<p>(3) 指定索引进行赋值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=([0]=green [3]=red [2]=blue [6]=yellow)</span><br></pre></td></tr></table></figure>

<p>(4) 用户输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">read -a ARRAY</span><br></pre></td></tr></table></figure>

<p><strong>数组的访问</strong>：<br><strong>用索引访问</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ARRAY[index]</span><br></pre></td></tr></table></figure>
<p><strong>数组的长度</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;#ARRAY[*]&#125;</span><br><span class="line">$&#123;#ARRAY[@]&#125;</span><br></pre></td></tr></table></figure>
<p>例：写一个脚本，生成10个随机数，保存至数组中；而后显示数组下标为偶数的元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#！/bin/bash</span><br><span class="line">for i in &#123;0..9&#125;; do</span><br><span class="line">    rand[$i]=$RANDOM</span><br><span class="line">    [ $[$i%2] -eq 0 ] &amp;&amp; echo &quot;$i:$&#123;rand[$i]&#125;&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p><strong>从数组中挑选某元素</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;ARRAY[@]:offset:number&#125;</span><br></pre></td></tr></table></figure>

<p><strong>切片</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">offset: 偏移的元素个数</span><br><span class="line">number: 取出的元素的个数</span><br><span class="line">$&#123;ARRAY[@]:offset&#125;：取出偏移量后的所有元素</span><br><span class="line">$&#123;ARRAY[@]&#125;: 取出所有元素</span><br></pre></td></tr></table></figure>

<p><strong>数组复制</strong>：要使用${ARRAY[@]}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$@: 每个参数是一个独立的串</span><br><span class="line">$*: 所有参数是一个串</span><br></pre></td></tr></table></figure>
<p><strong>向数组中追加元素</strong>：非稀疏格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">week, </span><br><span class="line">week[$&#123;#week[@]&#125;]</span><br></pre></td></tr></table></figure>

<p><strong>从数组中删除元素</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unset ARRAY[index]</span><br></pre></td></tr></table></figure>

<p>例：复制一个数组中下标为偶数的元素至一个新数组中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">declare -a mylogs</span><br><span class="line">logs=(/var/log/*.log)</span><br><span class="line">echo $&#123;logs[@]&#125;</span><br><span class="line">for i in `seq 0 $&#123;#logs[@]&#125;`; do</span><br><span class="line">  if [ $[$i%2] -eq 0 ];then</span><br><span class="line">    index=$&#123;#mylogs[@]&#125;</span><br><span class="line">     mylogs[$index]=$&#123;logs[$i]&#125;</span><br><span class="line">  fi</span><br><span class="line">done</span><br><span class="line">echo $&#123;mylogs[@]&#125;</span><br></pre></td></tr></table></figure>

<p>例2：生成10个随机数，升序排序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line">for((i=0;i&lt;10;i++))</span><br><span class="line">do</span><br><span class="line">  rnd[$i]=$RANDOM</span><br><span class="line">done</span><br><span class="line">echo -e &quot;total=$&#123;#rnd[@]&#125;\n$&#123;rnd[@]&#125;\nBegin to sort&quot;</span><br><span class="line">for((i=9;i&gt;=1;i--))</span><br><span class="line">do</span><br><span class="line">        for((j=0;j&lt;i;j++))</span><br><span class="line">  do</span><br><span class="line">  if [ $&#123;rnd[$j]&#125; -gt $&#123;rnd[$[$j+1]]&#125; ] ;then</span><br><span class="line">    swapValue=$&#123;rnd[$j]&#125;</span><br><span class="line">    rnd[$j]=$&#123;rnd[$[$j+1]]&#125;</span><br><span class="line">    rnd[$[$j+1]]=$swapValue</span><br><span class="line">  fi</span><br><span class="line">  done</span><br><span class="line">done</span><br><span class="line">echo $&#123;rnd[@]&#125;</span><br></pre></td></tr></table></figure>

<p>例3：打印九九乘法表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bashfor((i=1;i&lt;=9;i++))</span><br><span class="line">do </span><br><span class="line">strLine=&quot;&quot;</span><br><span class="line">  for((j=1;i&lt;=9;j++))</span><br><span class="line">  do</span><br><span class="line">    strLine=$strLine&quot;$i*$j=&quot;$[$i*$j]&quot;\t&quot;</span><br><span class="line">    [ $i -eq $j ] &amp;&amp; echo -e $strLine &amp;&amp; break</span><br><span class="line">  done</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h3 id="bash编程之字符串操作"><a href="#bash编程之字符串操作" class="headerlink" title="bash编程之字符串操作"></a>bash编程之字符串操作</h3><p><strong>字符串切片</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$&#123;string:offset:length&#125;</span><br><span class="line">[root@scholar scripts]# string=&#x27;hello word&#x27;</span><br><span class="line">[root@scholar scripts]# echo $&#123;string:2:4&#125;</span><br><span class="line">llo</span><br><span class="line"></span><br><span class="line">取尾部的指定个数的字符：</span><br><span class="line">$&#123;string: -length&#125;</span><br><span class="line">[root@scholar scripts]# echo $&#123;string: -2&#125;</span><br><span class="line">rd</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>取子串</strong>：基于模式</p>
<ul>
<li><code>$&#123;variable#*word&#125;</code>：在variable中存储字串上，自左而右，查找第一次出现word，删除字符开始至此word处的所有内容；</li>
<li>$<code>&#123;variable##*word&#125;</code>：在variable中存储字串上，自左而右，查找最后一次出现word，删除字符开始至此word处的所有内容；<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file=&#x27;/var/log/messages&#x27;</span><br><span class="line">$&#123;file#*/&#125;: 返回的结果是var/log/messages</span><br><span class="line">$&#123;file##*/&#125;: 返回messages</span><br></pre></td></tr></table></figure></li>
<li><code>$&#123;variable%word*&#125;</code>: 在variable中存储字串上，自右而左，查找第一次出现word，删除此word处至字串尾部的所有内容；</li>
<li><code>$&#123;variable%%world*&#125;</code>:在variable中存储字串上，自右而左，查找最后一次出现word，删除此word处至字串尾部的所有内容；</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">file=&#x27;/var/log/messages&#x27;</span><br><span class="line">$&#123;file%*/&#125;: 返回的结果是/var/log</span><br><span class="line">$&#123;file%%*/&#125;: 返回结果为空</span><br><span class="line"></span><br><span class="line">例：url=&quot;http://www.redhat.com:80&quot;</span><br><span class="line">取端口：$&#123;url##*:&#125;</span><br><span class="line">取协议：$&#123;url%%:*&#125;</span><br></pre></td></tr></table></figure>

<p><strong>查找替换</strong>：</p>
<ul>
<li><code>$&#123;variable/pattern/substi&#125;</code>: 替换第一次出现</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#userinfo=`tail -1 /etc/passwd</span><br><span class="line">#echo $userinfo</span><br><span class="line">scholar:x:500:500:scholar:/home/scholar:/bin/bash</span><br><span class="line">#echo $&#123;userinfo/scholar/redhat&#125;</span><br><span class="line">redhat:x:500:500:scholar:/home/scholar:/bin/bash</span><br></pre></td></tr></table></figure>

<ul>
<li><code>$&#123;variable//pattern/substi&#125;</code>：替换所有的出现</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#echo $&#123;userinfo//scholar/redhat&#125;</span><br><span class="line">redhat:x:500:500:redhat:/home/redhat:/bin/bash</span><br></pre></td></tr></table></figure>

<ul>
<li><code>$&#123;variable/#pattern/substi&#125;</code>：替换行首被pattern匹配到的内容</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#echo $&#123;userinfo/#scholar/redhat&#125;</span><br><span class="line">redhat:x:500:500:scholar:/home/scholar:/bin/bash</span><br></pre></td></tr></table></figure>

<ul>
<li><code>$&#123;variable/%pattern/substi&#125;</code>：替换行尾被pattern匹配到的内容</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#echo $&#123;userinfo/%bash/redhat&#125;</span><br><span class="line">scholar:x:500:500:scholar:/home/scholar:/bin/redhat</span><br></pre></td></tr></table></figure>


<h4 id="pattern可以使用globbing中的元字符：-？"><a href="#pattern可以使用globbing中的元字符：-？" class="headerlink" title="pattern可以使用globbing中的元字符：* ？"></a>pattern可以使用globbing中的元字符：<code>* ？</code></h4><p><strong>查找删除</strong>：</p>
<ul>
<li><code>$&#123;variable/pattern&#125;</code>：删除第一次出现</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#echo $&#123;userinfo/scholar&#125;</span><br><span class="line">:x:500:500:scholar:/home/scholar:/bin/bash</span><br></pre></td></tr></table></figure>

<ul>
<li><code>$&#123;variable//pattern&#125;</code>：删除所有的出现</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#echo $&#123;userinfo//scholar&#125;</span><br><span class="line">:x:500:500::/home/:/bin/bash</span><br></pre></td></tr></table></figure>

<ul>
<li><code>$&#123;variable/#pattern&#125;</code>：删除行首被pattern匹配到的内容</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#echo $&#123;userinfo/#scholar&#125;</span><br><span class="line">:x:500:500:scholar:/home/scholar:/bin/bash</span><br></pre></td></tr></table></figure>

<ul>
<li><code>$&#123;variable/%pattern&#125;</code>：删除行尾被pattern匹配到的内容</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#echo $&#123;userinfo/%bash&#125;</span><br><span class="line">scholar:x:500:500:scholar:/home/scholar:/bin/</span><br></pre></td></tr></table></figure>

<p><strong>大小写转换</strong>：</p>
<p>小–&gt;大：<code>$&#123;variable^^&#125;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#echo $&#123;userinfo^^&#125;</span><br><span class="line">SCHOLAR:X:500:500:SCHOLAR:/HOME/SCHOLAR:/BIN/BASH</span><br></pre></td></tr></table></figure>

<p>大–&gt;小：<code>$&#123;variable,,&#125;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#name=&quot;SCHOLAR&quot;</span><br><span class="line">#echo $&#123;name,,&#125;</span><br><span class="line">scholar</span><br></pre></td></tr></table></figure>

<h4 id="变量赋值操作："><a href="#变量赋值操作：" class="headerlink" title="变量赋值操作："></a>变量赋值操作：</h4><ul>
<li><code>$&#123;variable:-string&#125;</code>:variable为空或未设定，那么返回string，否则，返回variable变量的值；</li>
<li><code>$&#123;variable:=string&#125;</code>:variable为空或未设定，则返回string，且将string赋值给变量variable，否则，返回variable的值；</li>
</ul>
<p>为脚本使用配置文件，并确保某变量有可用值的方式</p>
<p><code>variable=$&#123;variable:-default vaule&#125;</code></p>
<p>写个脚本，配置etc目录；</p>
<ul>
<li>(1) 在配置文件中定义变量；</li>
<li>(2) 在脚本中source配置文件；</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">[ -f /etc/sysconfig/network ] &amp;&amp; source /etc/network/network</span><br><span class="line">[-z &quot;$HOSTAME&quot; -o &quot;$HOSTNAME&quot; = &#x27;(none)&#x27; ] || HOSTNAME =&#x27;localhost&#x27;</span><br><span class="line">/bin/hostname $HOSTNAME</span><br><span class="line">/bin/hostname</span><br></pre></td></tr></table></figure>

<h4 id="mktemp命令："><a href="#mktemp命令：" class="headerlink" title="mktemp命令："></a>mktemp命令：</h4><p>mktemp [OPTIONS] filename.XXX</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-d: 创建临时目录</span><br><span class="line">--tmpdir=/path/to/somewhere ：指定临时文件所在的目录</span><br><span class="line"></span><br><span class="line">mktemp /tmp/tmp.XXX                    #XXX生成相同数量随机字符</span><br><span class="line">mktemp --tmpdir=/var/tmp tmp.XXX       #指定目录创建临时文件</span><br><span class="line">mktemp --tmpdir=/var/tmp -d tmp.XXX    #指定目录创建临时目录</span><br></pre></td></tr></table></figure>


<h4 id="install命令"><a href="#install命令" class="headerlink" title="install命令:"></a>install命令:</h4><p>install [OPTIONS] SOURCE DEST<br>install [OPTIONS] SOURCE… DIR<br>install [OPTIONS] -d DIR …</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">增强型的复制命令：</span><br><span class="line">-o OWNER</span><br><span class="line">-g GROUP</span><br><span class="line">-m MODE</span><br><span class="line">-d : 创建目录</span><br><span class="line"></span><br><span class="line">install /etc/fstab /tmp                 #复制文件到指定目录</span><br><span class="line">install --mode=644 /etc/fstab /tmp/     #复制时指定权限</span><br><span class="line">install --owner=scholar /etc/fstab /tmp #复制时指定属主</span><br><span class="line">install --group=scholar /etc/fstab /tmp #复制时指定属组</span><br><span class="line">install -d /tmp/install                 #创建目录</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lyvivian0077.github.io/2020/01/10/%E4%B8%80%E8%A1%8C-Python-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%B9%B6%E8%A1%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyvivian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="总有刁民想要害朕">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/10/%E4%B8%80%E8%A1%8C-Python-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%B9%B6%E8%A1%8C/" class="post-title-link" itemprop="url">一行 Python 代码实现并行</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-01-10 12:36:48" itemprop="dateCreated datePublished" datetime="2020-01-10T12:36:48+09:00">2020-01-10</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-06-22 12:58:45" itemprop="dateModified" datetime="2021-06-22T12:58:45+09:00">2021-06-22</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000000414339">原文</a></li>
</ul>
<p>Python 在程序并行化方面多少有些声名狼藉。撇开技术上的问题，例如线程的实现和 GIL1，我觉得错误的教学指导才是主要问题。<br>常见的经典 Python 多线程、多进程教程多显得偏“重”。而且往往隔靴搔痒，没有深入探讨日常工作中最有用的内容。</p>
<h2 id="传统的例子"><a href="#传统的例子" class="headerlink" title="传统的例子"></a>传统的例子</h2><p>简单搜索下“Python 多线程教程”，不难发现几乎所有的教程都给出涉及类和队列的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Example.py</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Standard Producer/Consumer Threading Pattern</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time </span><br><span class="line"><span class="keyword">import</span> threading </span><br><span class="line"><span class="keyword">import</span> Queue </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span>(<span class="params">threading.Thread</span>):</span> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, queue</span>):</span> </span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self._queue = queue </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>: </span><br><span class="line">            <span class="comment"># queue.get() blocks the current thread until </span></span><br><span class="line">            <span class="comment"># an item is retrieved. </span></span><br><span class="line">            msg = self._queue.get() </span><br><span class="line">            <span class="comment"># Checks if the current message is </span></span><br><span class="line">            <span class="comment"># the &quot;Poison Pill&quot;</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(msg, <span class="built_in">str</span>) <span class="keyword">and</span> msg == <span class="string">&#x27;quit&#x27;</span>:</span><br><span class="line">                <span class="comment"># if so, exists the loop</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># &quot;Processes&quot; (or in our case, prints) the queue item    </span></span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;I&#x27;m a thread, and I received %s!!&quot;</span> % msg</span><br><span class="line">        <span class="comment"># Always be friendly! </span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Bye byes!&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Producer</span>():</span></span><br><span class="line">    <span class="comment"># Queue is used to share items between</span></span><br><span class="line">    <span class="comment"># the threads.</span></span><br><span class="line">    queue = Queue.Queue()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Create an instance of the worker</span></span><br><span class="line">    worker = Consumer(queue)</span><br><span class="line">    <span class="comment"># start calls the internal run() method to </span></span><br><span class="line">    <span class="comment"># kick off the thread</span></span><br><span class="line">    worker.start() </span><br><span class="line"></span><br><span class="line">    <span class="comment"># variable to keep track of when we started</span></span><br><span class="line">    start_time = time.time() </span><br><span class="line">    <span class="comment"># While under 5 seconds.. </span></span><br><span class="line">    <span class="keyword">while</span> time.time() - start_time &lt; <span class="number">5</span>: </span><br><span class="line">        <span class="comment"># &quot;Produce&quot; a piece of work and stick it in </span></span><br><span class="line">        <span class="comment"># the queue for the Consumer to process</span></span><br><span class="line">        queue.put(<span class="string">&#x27;something at %s&#x27;</span> % time.time())</span><br><span class="line">        <span class="comment"># Sleep a bit just to avoid an absurd number of messages</span></span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># This the &quot;poison pill&quot; method of killing a thread. </span></span><br><span class="line">    queue.put(<span class="string">&#x27;quit&#x27;</span>)</span><br><span class="line">    <span class="comment"># wait for the thread to close down</span></span><br><span class="line">    worker.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    Producer()</span><br></pre></td></tr></table></figure>

<p>哈，看起来有些像 Java 不是吗？</p>
<p>我并不是说使用生产者/消费者模型处理多线程/多进程任务是错误的（事实上，这一模型自有其用武之地）。只是，处理日常脚本任务时我们可以使用更有效率的模型。</p>
<h2 id="问题在于…"><a href="#问题在于…" class="headerlink" title="问题在于…"></a>问题在于…</h2><p>首先，你需要一个样板类；<br>其次，你需要一个队列来传递对象；<br>而且，你还需要在通道两端都构建相应的方法来协助其工作（如果需想要进行双向通信或是保存结果还需要再引入一个队列）。</p>
<h2 id="worker-越多，问题越多"><a href="#worker-越多，问题越多" class="headerlink" title="worker 越多，问题越多"></a>worker 越多，问题越多</h2><p>按照这一思路，你现在需要一个 worker 线程的线程池。下面是一篇 <a target="_blank" rel="noopener" href="http://www.ibm.com/developerworks/aix/library/au-threadingpython/">IBM 经典教程</a> 中的例子——在进行网页检索时通过多线程进行加速。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Example2.py</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">A more realistic thread pool example </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time </span><br><span class="line"><span class="keyword">import</span> threading </span><br><span class="line"><span class="keyword">import</span> Queue </span><br><span class="line"><span class="keyword">import</span> urllib2 </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span>(<span class="params">threading.Thread</span>):</span> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, queue</span>):</span> </span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self._queue = queue </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>: </span><br><span class="line">            content = self._queue.get() </span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(content, <span class="built_in">str</span>) <span class="keyword">and</span> content == <span class="string">&#x27;quit&#x27;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            response = urllib2.urlopen(content)</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Bye byes!&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Producer</span>():</span></span><br><span class="line">    urls = [</span><br><span class="line">        <span class="string">&#x27;http://www.python.org&#x27;</span>, <span class="string">&#x27;http://www.yahoo.com&#x27;</span></span><br><span class="line">        <span class="string">&#x27;http://www.scala.org&#x27;</span>, <span class="string">&#x27;http://www.google.com&#x27;</span></span><br><span class="line">        <span class="comment"># etc.. </span></span><br><span class="line">    ]</span><br><span class="line">    queue = Queue.Queue()</span><br><span class="line">    worker_threads = build_worker_pool(queue, <span class="number">4</span>)</span><br><span class="line">    start_time = time.time()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Add the urls to process</span></span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urls: </span><br><span class="line">        queue.put(url)  </span><br><span class="line">    <span class="comment"># Add the poison pillv</span></span><br><span class="line">    <span class="keyword">for</span> worker <span class="keyword">in</span> worker_threads:</span><br><span class="line">        queue.put(<span class="string">&#x27;quit&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> worker <span class="keyword">in</span> worker_threads:</span><br><span class="line">        worker.join()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;Done! Time taken: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(time.time() - start_time)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_worker_pool</span>(<span class="params">queue, size</span>):</span></span><br><span class="line">    workers = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(size):</span><br><span class="line">        worker = Consumer(queue)</span><br><span class="line">        worker.start() </span><br><span class="line">        workers.append(worker)</span><br><span class="line">    <span class="keyword">return</span> workers</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    Producer()</span><br></pre></td></tr></table></figure>


<p>这段代码能正确的运行，但仔细看看我们需要做些什么：构造不同的方法、追踪一系列的线程，还有为了解决恼人的死锁问题，我们需要进行一系列的 join 操作。这还只是开始……</p>
<p>至此我们回顾了经典的多线程教程，多少有些空洞不是吗？样板化而且易出错，这样事倍功半的风格显然不那么适合日常使用，好在我们还有更好的方法。</p>
<h2 id="何不试试-map"><a href="#何不试试-map" class="headerlink" title="何不试试 map"></a>何不试试 map</h2><p>map 这一小巧精致的函数是简捷实现 Python 程序并行化的关键。map 源于 Lisp 这类函数式编程语言。它可以通过一个序列实现两个函数之间的映射。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">urls = [&#x27;http://www.yahoo.com&#x27;, &#x27;http://www.reddit.com&#x27;]</span><br><span class="line">results = map(urllib2.urlopen, urls)</span><br></pre></td></tr></table></figure>

<p>上面的这两行代码将 urls 这一序列中的每个元素作为参数传递到 urlopen 方法中，并将所有结果保存到 results 这一列表中。其结果大致相当于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">results = []</span><br><span class="line">for url in urls: </span><br><span class="line">    results.append(urllib2.urlopen(url))</span><br></pre></td></tr></table></figure>

<p>map 函数一手包办了序列操作、参数传递和结果保存等一系列的操作。</p>
<p>为什么这很重要呢？这是因为借助正确的库，map 可以轻松实现并行化操作。</p>
<p><img src="/assets/f61522cd2f5c85e4c06041f53619140c_articlex.png" alt="Map"></p>
<p>在 Python 中有个两个库包含了 map 函数： multiprocessing 和它鲜为人知的子库 multiprocessing.dummy.</p>
<p>这里多扯两句： multiprocessing.dummy？ mltiprocessing 库的线程版克隆？这是虾米？即便在 multiprocessing 库的官方文档里关于这一子库也只有一句相关描述。而这句描述译成人话基本就是说:”嘛，有这么个东西，你知道就成.”相信我，这个库被严重低估了！</p>
<p>dummy 是 multiprocessing 模块的完整克隆，唯一的不同在于 multiprocessing 作用于进程，而 dummy 模块作用于线程（因此也包括了 Python 所有常见的多线程限制）。<br>所以替换使用这两个库异常容易。你可以针对 IO 密集型任务和 CPU 密集型任务来选择不同的库。</p>
<h2 id="动手尝试"><a href="#动手尝试" class="headerlink" title="动手尝试"></a>动手尝试</h2><p>使用下面的两行代码来引用包含并行化 map 函数的库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from multiprocessing import Pool</span><br><span class="line">from multiprocessing.dummy import Pool as ThreadPool</span><br></pre></td></tr></table></figure>

<p>实例化 Pool 对象：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pool = ThreadPool()</span><br></pre></td></tr></table></figure>

<p>这条简单的语句替代了 example2.py 中 build_worker_pool 函数 7 行代码的工作。它生成了一系列的 worker 线程并完成初始化工作、将它们储存在变量中以方便访问。</p>
<p>Pool 对象有一些参数，这里我所需要关注的只是它的第一个参数：processes. 这一参数用于设定线程池中的线程数。其默认值为当前机器 CPU 的核数。</p>
<p>一般来说，执行 CPU 密集型任务时，调用越多的核速度就越快。但是当处理网络密集型任务时，事情有有些难以预计了，通过实验来确定线程池的大小才是明智的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pool = ThreadPool(4) # Sets the pool size to 4</span><br></pre></td></tr></table></figure>

<p>线程数过多时，切换线程所消耗的时间甚至会超过实际工作时间。对于不同的工作，通过尝试来找到线程池大小的最优值是个不错的主意。</p>
<p>创建好 Pool 对象后，并行化的程序便呼之欲出了。我们来看看改写后的 example2.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib2 </span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool <span class="keyword">as</span> ThreadPool </span><br><span class="line"></span><br><span class="line">urls = [</span><br><span class="line">    <span class="string">&#x27;http://www.python.org&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;http://www.python.org/about/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://www.onlamp.com/pub/a/python/2003/04/17/metaclasses.html&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://www.python.org/doc/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://www.python.org/download/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://www.python.org/getit/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://www.python.org/community/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://wiki.python.org/moin/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://planet.python.org/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://wiki.python.org/moin/LocalUserGroups&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://www.python.org/psf/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://docs.python.org/devguide/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://www.python.org/community/awards/&#x27;</span></span><br><span class="line">    <span class="comment"># etc.. </span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Make the Pool of workers</span></span><br><span class="line">pool = ThreadPool(<span class="number">4</span>) </span><br><span class="line"><span class="comment"># Open the urls in their own threads</span></span><br><span class="line"><span class="comment"># and return the results</span></span><br><span class="line">results = pool.<span class="built_in">map</span>(urllib2.urlopen, urls)</span><br><span class="line"><span class="comment">#close the pool and wait for the work to finish </span></span><br><span class="line">pool.close() </span><br><span class="line">pool.join() </span><br></pre></td></tr></table></figure>

<p>实际起作用的代码只有 4 行，其中只有一行是关键的。map 函数轻而易举的取代了前文中超过 40 行的例子。为了更有趣一些，我统计了不同方法、不同线程池大小的耗时情况。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># results = [] </span><br><span class="line"># for url in urls:</span><br><span class="line">#   result = urllib2.urlopen(url)</span><br><span class="line">#   results.append(result)</span><br><span class="line"></span><br><span class="line"># # ------- VERSUS ------- # </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># # ------- 4 Pool ------- # </span><br><span class="line"># pool = ThreadPool(4) </span><br><span class="line"># results = pool.map(urllib2.urlopen, urls)</span><br><span class="line"></span><br><span class="line"># # ------- 8 Pool ------- # </span><br><span class="line"></span><br><span class="line"># pool = ThreadPool(8) </span><br><span class="line"># results = pool.map(urllib2.urlopen, urls)</span><br><span class="line"></span><br><span class="line"># # ------- 13 Pool ------- # </span><br><span class="line"></span><br><span class="line"># pool = ThreadPool(13) </span><br><span class="line"># results = pool.map(urllib2.urlopen, urls)</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#        Single thread:  14.4 Seconds </span><br><span class="line">#               4 Pool:   3.1 Seconds</span><br><span class="line">#               8 Pool:   1.4 Seconds</span><br><span class="line">#              13 Pool:   1.3 Seconds</span><br></pre></td></tr></table></figure>

<p>很棒的结果不是吗？这一结果也说明了为什么要通过实验来确定线程池的大小。在我的机器上当线程池大小大于 9 带来的收益就十分有限了。</p>
<h2 id="另一个真实的例子"><a href="#另一个真实的例子" class="headerlink" title="另一个真实的例子"></a>另一个真实的例子</h2><p>生成上千张图片的缩略图<br>这是一个 CPU 密集型的任务，并且十分适合进行并行化。</p>
<h3 id="基础单进程版本"><a href="#基础单进程版本" class="headerlink" title="基础单进程版本"></a>基础单进程版本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">import</span> PIL </span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool </span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">SIZE = (<span class="number">75</span>,<span class="number">75</span>)</span><br><span class="line">SAVE_DIRECTORY = <span class="string">&#x27;thumbs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_image_paths</span>(<span class="params">folder</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (os.path.join(folder, f) </span><br><span class="line">            <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(folder) </span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;jpeg&#x27;</span> <span class="keyword">in</span> f)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_thumbnail</span>(<span class="params">filename</span>):</span> </span><br><span class="line">    im = Image.<span class="built_in">open</span>(filename)</span><br><span class="line">    im.thumbnail(SIZE, Image.ANTIALIAS)</span><br><span class="line">    base, fname = os.path.split(filename) </span><br><span class="line">    save_path = os.path.join(base, SAVE_DIRECTORY, fname)</span><br><span class="line">    im.save(save_path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    folder = os.path.abspath(</span><br><span class="line">        <span class="string">&#x27;11_18_2013_R000_IQM_Big_Sur_Mon__e10d1958e7b766c3e840&#x27;</span>)</span><br><span class="line">    os.mkdir(os.path.join(folder, SAVE_DIRECTORY))</span><br><span class="line"></span><br><span class="line">    images = get_image_paths(folder)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> image <span class="keyword">in</span> images:</span><br><span class="line">        create_thumbnail(Image)</span><br></pre></td></tr></table></figure>


<p>上边这段代码的主要工作就是将遍历传入的文件夹中的图片文件，一一生成缩略图，并将这些缩略图保存到特定文件夹中。</p>
<p>这我的机器上，用这一程序处理 6000 张图片需要花费 27.9 秒。</p>
<p>如果我们使用 map 函数来代替 for 循环：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">import</span> PIL </span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool </span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">SIZE = (<span class="number">75</span>,<span class="number">75</span>)</span><br><span class="line">SAVE_DIRECTORY = <span class="string">&#x27;thumbs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_image_paths</span>(<span class="params">folder</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (os.path.join(folder, f) </span><br><span class="line">            <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(folder) </span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;jpeg&#x27;</span> <span class="keyword">in</span> f)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_thumbnail</span>(<span class="params">filename</span>):</span> </span><br><span class="line">    im = Image.<span class="built_in">open</span>(filename)</span><br><span class="line">    im.thumbnail(SIZE, Image.ANTIALIAS)</span><br><span class="line">    base, fname = os.path.split(filename) </span><br><span class="line">    save_path = os.path.join(base, SAVE_DIRECTORY, fname)</span><br><span class="line">    im.save(save_path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    folder = os.path.abspath(</span><br><span class="line">        <span class="string">&#x27;11_18_2013_R000_IQM_Big_Sur_Mon__e10d1958e7b766c3e840&#x27;</span>)</span><br><span class="line">    os.mkdir(os.path.join(folder, SAVE_DIRECTORY))</span><br><span class="line"></span><br><span class="line">    images = get_image_paths(folder)</span><br><span class="line"></span><br><span class="line">    pool = Pool()</span><br><span class="line">    pool.<span class="built_in">map</span>(creat_thumbnail, images)</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br></pre></td></tr></table></figure>

<h4 id="5-6-秒！"><a href="#5-6-秒！" class="headerlink" title="5.6 秒！"></a>5.6 秒！</h4><p>虽然只改动了几行代码，我们却明显提高了程序的执行速度。在生产环境中，我们可以为 CPU 密集型任务和 IO 密集型任务分别选择多进程和多线程库来进一步提高执行速度——这也是解决死锁问题的良方。此外，由于 map 函数并不支持手动线程管理，反而使得相关的 debug 工作也变得异常简单。</p>
<p>到这里，我们就实现了（基本）通过一行 Python 实现并行化。</p>
<ul>
<li>下面的网址中可以找到关于 GIL（Global Interpretor Lock，全局解释器锁）更多的讨论： <a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/3044580/multiprocessing-vs-threading-python">http://stackoverflow.com/questions/3044580/multiprocessing-vs-threading-python</a></li>
<li>简言之，IO 密集型任务选择multiprocessing.dummy，CPU 密集型任务选择multiprocessing </li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lyvivian0077.github.io/2020/01/08/mysql%E3%82%92%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%8B%E3%82%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyvivian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="总有刁民想要害朕">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/08/mysql%E3%82%92%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%8B%E3%82%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB/" class="post-title-link" itemprop="url">mysqlをソースからインストール</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-01-08 15:02:28" itemprop="dateCreated datePublished" datetime="2020-01-08T15:02:28+09:00">2020-01-08</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-06-22 12:58:45" itemprop="dateModified" datetime="2021-06-22T12:58:45+09:00">2021-06-22</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="Linux系のビルドオプション"><a href="#Linux系のビルドオプション" class="headerlink" title="Linux系のビルドオプション"></a>Linux系のビルドオプション</h3><h4 id="MySQL5-6"><a href="#MySQL5-6" class="headerlink" title="MySQL5.6"></a>MySQL5.6</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ cat build-mysql5.6.sh</span><br><span class="line">export CC=&quot;cc&quot;</span><br><span class="line">export CXX=&quot;c++&quot;</span><br><span class="line">export CFLAGS=&quot;-O2 -fPIC -fno-omit-frame-pointer&quot;</span><br><span class="line">export CXXFLAGS=&quot;$&#123;CFLAGS&#125; -Wno-narrowing -felide-constructors -fno-rtti -fexceptions&quot;</span><br><span class="line"></span><br><span class="line">#export CXXFLAGS=&quot;$&#123;CFLAGS&#125; -Wno-c++11-narrowing -felide-constructors -fno-rtti -fno-exceptions&quot;</span><br><span class="line"></span><br><span class="line">cmake \</span><br><span class="line">-DCMAKE_INSTALL_PREFIX=&quot;/home/USER/myetc/mysql/5.6&quot; \</span><br><span class="line">-DINSTALL_DOCDIR=&quot;share/doc/mysql&quot; \</span><br><span class="line">-DINSTALL_DOCREADMEDIR=&quot;share/doc/mysql&quot; \</span><br><span class="line">-DINSTALL_INCLUDEDIR=&quot;include/mysql&quot; \</span><br><span class="line">-DINSTALL_INFODIR=&quot;info&quot; \</span><br><span class="line">-DINSTALL_LIBDIR=&quot;lib/mysql&quot; \</span><br><span class="line">-DINSTALL_MANDIR=&quot;man&quot; \</span><br><span class="line">-DINSTALL_MYSQLSHAREDIR=&quot;share/mysql&quot; \</span><br><span class="line">-DINSTALL_MYSQLTESTDIR=&quot;share/mysql/tests&quot; \</span><br><span class="line">-DINSTALL_PLUGINDIR=&quot;lib/mysql/plugin&quot; \</span><br><span class="line">-DINSTALL_SBINDIR=&quot;libexec&quot; \</span><br><span class="line">-DINSTALL_SCRIPTDIR=&quot;bin&quot; \</span><br><span class="line">-DINSTALL_SHAREDIR=&quot;share&quot; \</span><br><span class="line">-DINSTALL_SQLBENCHDIR=&quot;share/mysql&quot; \</span><br><span class="line">-DINSTALL_SUPPORTFILESDIR=&quot;share/mysql&quot; \</span><br><span class="line">-DWITH_UNIT_TESTS=0 \</span><br><span class="line">-DWITH_SSL=system \</span><br><span class="line">-DWITH_READLINE=1 \</span><br><span class="line">-DWITH_LIBWRAP=0 \</span><br><span class="line">-DWITHOUT_SERVER=1 \</span><br><span class="line">-DWITH_EMBEDDED_SERVER=&quot;ON&quot;</span><br></pre></td></tr></table></figure>

<p><code>make</code><br><code>make install</code></p>
<h4 id="MySQL5-5"><a href="#MySQL5-5" class="headerlink" title="MySQL5.5"></a>MySQL5.5</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ cat build-mysql5.5.sh</span><br><span class="line">export CC=&quot;cc&quot;</span><br><span class="line">export CXX=&quot;c++&quot;</span><br><span class="line">export CFLAGS=&quot;-O2 -fPIC -fno-omit-frame-pointer&quot;</span><br><span class="line">export CXXFLAGS=&quot;$&#123;CFLAGS&#125; -Wno-narrowing -felide-constructors -fno-rtti -fexceptions -fpermissive &quot;</span><br><span class="line"></span><br><span class="line">#export CXXFLAGS=&quot;$&#123;CFLAGS&#125; -Wno-c++11-narrowing -felide-constructors -fno-rtti -fno-exceptions&quot;</span><br><span class="line"></span><br><span class="line">cmake \</span><br><span class="line">-DCMAKE_INSTALL_PREFIX=&quot;/home/USER/myetc/mysql/5.5&quot; \</span><br><span class="line">-DINSTALL_DOCDIR=&quot;share/doc/mysql&quot; \</span><br><span class="line">-DINSTALL_DOCREADMEDIR=&quot;share/doc/mysql&quot; \</span><br><span class="line">-DINSTALL_INCLUDEDIR=&quot;include/mysql&quot; \</span><br><span class="line">-DINSTALL_INFODIR=&quot;info&quot; \</span><br><span class="line">-DINSTALL_LIBDIR=&quot;lib/mysql&quot; \</span><br><span class="line">-DINSTALL_MANDIR=&quot;man&quot; \</span><br><span class="line">-DINSTALL_MYSQLSHAREDIR=&quot;share/mysql&quot; \</span><br><span class="line">-DINSTALL_MYSQLTESTDIR=&quot;share/mysql/tests&quot; \</span><br><span class="line">-DINSTALL_PLUGINDIR=&quot;lib/mysql/plugin&quot; \</span><br><span class="line">-DINSTALL_SBINDIR=&quot;libexec&quot; \</span><br><span class="line">-DINSTALL_SCRIPTDIR=&quot;bin&quot; \</span><br><span class="line">-DINSTALL_SHAREDIR=&quot;share&quot; \</span><br><span class="line">-DINSTALL_SQLBENCHDIR=&quot;share/mysql&quot; \</span><br><span class="line">-DINSTALL_SUPPORTFILESDIR=&quot;share/mysql&quot; \</span><br><span class="line">-DWITH_UNIT_TESTS=0 \</span><br><span class="line">-DWITH_SSL=system \</span><br><span class="line">-DWITH_READLINE=1 \</span><br><span class="line">-DWITH_LIBWRAP=0 \</span><br><span class="line">-DWITHOUT_SERVER=0 \</span><br><span class="line">-DWITH_EMBEDDED_SERVER=&quot;ON&quot;</span><br></pre></td></tr></table></figure>

<p><code>make</code><br><code>make install</code></p>
<h3 id="FreeBSD系のビルドオプション"><a href="#FreeBSD系のビルドオプション" class="headerlink" title="FreeBSD系のビルドオプション"></a>FreeBSD系のビルドオプション</h3><h4 id="MySQL5-6-1"><a href="#MySQL5-6-1" class="headerlink" title="MySQL5.6"></a>MySQL5.6</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">export CC=&quot;cc&quot;</span><br><span class="line">export CXX=&quot;c++&quot;</span><br><span class="line">export CFLAGS=&quot;-O2 -fPIC -fno-omit-frame-pointer&quot;</span><br><span class="line">#export CXXFLAGS=&quot;$&#123;CFLAGS&#125; -Wno-c++11-narrowing -felide-constructors -fno-rtti -fno-exceptions&quot;</span><br><span class="line">export CXXFLAGS=&quot;$&#123;CFLAGS&#125; -Wno-narrowing -felide-constructors -fno-rtti -fexceptions&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cmake \</span><br><span class="line">-DCMAKE_INSTALL_PREFIX=&quot;/home/USER/myetc/mysql/5.6&quot; \</span><br><span class="line">-DINSTALL_DOCDIR=&quot;share/doc/mysql&quot; \</span><br><span class="line">-DINSTALL_DOCREADMEDIR=&quot;share/doc/mysql&quot; \</span><br><span class="line">-DINSTALL_INCLUDEDIR=&quot;include/mysql&quot; \</span><br><span class="line">-DINSTALL_INFODIR=&quot;info&quot; \</span><br><span class="line">-DINSTALL_LIBDIR=&quot;lib/mysql&quot; \</span><br><span class="line">-DINSTALL_MANDIR=&quot;man&quot; \</span><br><span class="line">-DINSTALL_MYSQLSHAREDIR=&quot;share/mysql&quot; \</span><br><span class="line">-DINSTALL_MYSQLTESTDIR=&quot;share/mysql/tests&quot; \</span><br><span class="line">-DINSTALL_PLUGINDIR=&quot;lib/mysql/plugin&quot; \</span><br><span class="line">-DINSTALL_SBINDIR=&quot;libexec&quot; \</span><br><span class="line">-DINSTALL_SCRIPTDIR=&quot;bin&quot; \</span><br><span class="line">-DINSTALL_SHAREDIR=&quot;share&quot; \</span><br><span class="line">-DINSTALL_SQLBENCHDIR=&quot;share/mysql&quot; \</span><br><span class="line">-DINSTALL_SUPPORTFILESDIR=&quot;share/mysql&quot; \</span><br><span class="line">-DWITH_UNIT_TESTS=0 \</span><br><span class="line">-DWITH_SSL=system \</span><br><span class="line">-DWITH_READLINE=1 \</span><br><span class="line">-DWITH_LIBWRAP=0 \</span><br><span class="line">-DWITHOUT_SERVER=1 \</span><br><span class="line">-DWITH_EMBEDDED_SERVER=&quot;ON&quot;</span><br></pre></td></tr></table></figure>

<p><code>make</code><br><code>make install</code></p>
<h4 id="MySQL5-5-1"><a href="#MySQL5-5-1" class="headerlink" title="MySQL5.5"></a>MySQL5.5</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">$ cat mysql-5.5.61/build-mysql5.5.sh</span><br><span class="line">export CC=&quot;cc&quot;</span><br><span class="line">export CXX=&quot;c++&quot;</span><br><span class="line">export CFLAGS=&quot;-O2 -fPIC -fno-omit-frame-pointer&quot;</span><br><span class="line">export CXXFLAGS=&quot;$&#123;CFLAGS&#125; -Wno-c++11-narrowing -felide-constructors -fno-rtti -fno-exceptions -fpermissive&quot;</span><br><span class="line">#export CXXFLAGS=&quot;$&#123;CFLAGS&#125; -Wno-c++11-narrowing -felide-constructors -fno-rtti -fno-exceptions&quot;</span><br><span class="line">#export CXXFLAGS=&quot;$&#123;CFLAGS&#125; -Wno-narrowing -felide-constructors -fno-rtti -fexceptions -fpermissive&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cmake \</span><br><span class="line">-DCMAKE_INSTALL_PREFIX=&quot;/home/USER/myetc/mysql/5.5&quot; \</span><br><span class="line">-DINSTALL_DOCDIR=&quot;share/doc/mysql&quot; \</span><br><span class="line">-DINSTALL_DOCREADMEDIR=&quot;share/doc/mysql&quot; \</span><br><span class="line">-DINSTALL_INCLUDEDIR=&quot;include/mysql&quot; \</span><br><span class="line">-DINSTALL_INFODIR=&quot;info&quot; \</span><br><span class="line">-DINSTALL_LIBDIR=&quot;lib/mysql&quot; \</span><br><span class="line">-DINSTALL_MANDIR=&quot;man&quot; \</span><br><span class="line">-DINSTALL_MYSQLSHAREDIR=&quot;share/mysql&quot; \</span><br><span class="line">-DINSTALL_MYSQLTESTDIR=&quot;share/mysql/tests&quot; \</span><br><span class="line">-DINSTALL_PLUGINDIR=&quot;lib/mysql/plugin&quot; \</span><br><span class="line">-DINSTALL_SBINDIR=&quot;libexec&quot; \</span><br><span class="line">-DINSTALL_SCRIPTDIR=&quot;bin&quot; \</span><br><span class="line">-DINSTALL_SHAREDIR=&quot;share&quot; \</span><br><span class="line">-DINSTALL_SQLBENCHDIR=&quot;share/mysql&quot; \</span><br><span class="line">-DINSTALL_SUPPORTFILESDIR=&quot;share/mysql&quot; \</span><br><span class="line">-DWITH_UNIT_TESTS=0 \</span><br><span class="line">-DWITH_SSL=system \</span><br><span class="line">-DWITH_READLINE=1 \</span><br><span class="line">-DWITH_LIBWRAP=0 \</span><br><span class="line">-DWITHOUT_SERVER=0 \</span><br><span class="line">-DWITHOUT_PARTITION_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_EMBEDDED_SERVER=&quot;ON&quot;</span><br></pre></td></tr></table></figure>

<p><code>make</code><br><code>make install</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lyvivian0077.github.io/2019/12/23/macOS%E8%BD%AF%E4%BB%B6%E7%BC%96%E8%AF%91%E6%97%B6%E6%89%BE%E4%B8%8D%E5%88%B0%E5%A4%B4%E6%96%87%E4%BB%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95-%E6%9B%B4%E6%96%B010-15/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyvivian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="总有刁民想要害朕">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/12/23/macOS%E8%BD%AF%E4%BB%B6%E7%BC%96%E8%AF%91%E6%97%B6%E6%89%BE%E4%B8%8D%E5%88%B0%E5%A4%B4%E6%96%87%E4%BB%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95-%E6%9B%B4%E6%96%B010-15/" class="post-title-link" itemprop="url">macOS软件编译时找不到头文件解决方法[更新10.15]</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-12-23 11:10:25" itemprop="dateCreated datePublished" datetime="2019-12-23T11:10:25+09:00">2019-12-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-06-22 12:58:45" itemprop="dateModified" datetime="2021-06-22T12:58:45+09:00">2021-06-22</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a target="_blank" rel="noopener" href="https://zhile.io/2018/09/26/macOS-10.14-install-sdk-headers.html">元URL</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lyvivian0077.github.io/2019/11/05/iptables/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyvivian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="总有刁民想要害朕">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/11/05/iptables/" class="post-title-link" itemprop="url">iptables</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-11-05 16:21:20" itemprop="dateCreated datePublished" datetime="2019-11-05T16:21:20+09:00">2019-11-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-06-22 12:58:45" itemprop="dateModified" datetime="2021-06-22T12:58:45+09:00">2021-06-22</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/main/" itemprop="url" rel="index"><span itemprop="name">main</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="iptables详解"><a href="#iptables详解" class="headerlink" title="iptables详解"></a>iptables详解</h3><ul>
<li><a target="_blank" rel="noopener" href="http://www.zsythink.net/archives/1199">原文</a></li>
</ul>
<h2 id="iptables概念"><a href="#iptables概念" class="headerlink" title="iptables概念"></a>iptables概念</h2><p><img src="/assets/iptables.png" alt="iptables概念"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lyvivian0077.github.io/2019/10/17/Regular-Expression/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyvivian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="总有刁民想要害朕">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/10/17/Regular-Expression/" class="post-title-link" itemprop="url">正規表現（Regular Expression）とは？</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-10-17 15:08:20" itemprop="dateCreated datePublished" datetime="2019-10-17T15:08:20+09:00">2019-10-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-06-22 12:58:45" itemprop="dateModified" datetime="2021-06-22T12:58:45+09:00">2021-06-22</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/main/" itemprop="url" rel="index"><span itemprop="name">main</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a target="_blank" rel="noopener" href="https://qiita.com/ikmiyabi/items/12d1127056cdf4f0eea5">元URL</a></li>
</ul>
<h1 id="正規表現（Regular-Expression）とは？"><a href="#正規表現（Regular-Expression）とは？" class="headerlink" title="正規表現（Regular Expression）とは？"></a>正規表現（Regular Expression）とは？</h1><ul>
<li>文字列をパターン化し、特殊な文字（メタキャラクタ、メタ文字）で表現したもの</li>
</ul>
<p>例えば、郵便番号を正規表現を使って表すと以下のように表現できる。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">郵便番号の正規表現</span><br><span class="line">\d&#123;3&#125;-?\d&#123;4&#125;</span><br><span class="line"># 3桁の数字 + ハイフン有りor無し + 4桁の数字</span><br></pre></td></tr></table></figure>
<p>この<code>「\d」「&#123;&#125;」「?」</code>のような文字のことを <strong>メタキャラクタ（メタ文字）</strong> という。</p>
<h1 id="正規表現の由来"><a href="#正規表現の由来" class="headerlink" title="正規表現の由来"></a>正規表現の由来</h1><ul>
<li>1940年代にさまざまな神経生理学者たちが、神経回路を数学的に説明するために開発した。</li>
<li>1956年、数学者 <em>Stephen Kleene（スティーブン・クリーネ）</em> が、その考え方に基づき論文を著述し、初めて正規表現の概念が紹介された。</li>
<li>ここで「正則集合の代数」を説明するために「正則表現・正規表現(regular expression)」が使用された。<br>何が言いたかったのかというと、元々は神経回路の研究で開発された数学的な概念だったということ。</li>
</ul>
<p>正規表現という若干分かりにくいネーミングはこのせい</p>
<p>参考：<a target="_blank" rel="noopener" href="https://msdn.microsoft.com/ja-jp/library/cc427944.aspx">正規表現の由来</a></p>
<h1 id="何の役に立つ？"><a href="#何の役に立つ？" class="headerlink" title="何の役に立つ？"></a>何の役に立つ？</h1><ul>
<li>文字列検索に役立つ<ul>
<li>grep検索、エディタやExcelの検索機能</li>
<li>→ 調査、コーディングが捗る</li>
</ul>
</li>
<li>文字列置換に役立つ<ul>
<li>sed、エディタやExcelの置換機能</li>
<li>→ 文字列の一括修正、一括挿入、一括削除が楽になる</li>
</ul>
</li>
<li>入力された文字列が、規定されたパターン通りに入力されているかの確認（バリデーション）に役立つ<ul>
<li>郵便番号、電話番号、メールアドレスなどの入力形式のチェックなど</li>
</ul>
</li>
</ul>
<h1 id="正規表現とワイルドカードの違い"><a href="#正規表現とワイルドカードの違い" class="headerlink" title="正規表現とワイルドカードの違い"></a>正規表現とワイルドカードの違い</h1><p>最初の頃に正規表現とワイルドカードを勘違いしていたので確認。</p>
<p>そもそも、ワイルドカード（Wild Card）とは何か？</p>
<ul>
<li>トランプ用語で，どのカードの代用にもできるカードのこと（ポーカーにおけるジョーカーなど）</li>
<li>転じてITにおけるワイルドカードとは、 <strong>任意の文字列</strong> にマッチする特殊文字</li>
<li>OSや言語によって解釈が異なる</li>
</ul>
<h2 id="ファイル検索におけるワイルドカード"><a href="#ファイル検索におけるワイルドカード" class="headerlink" title="ファイル検索におけるワイルドカード"></a>ファイル検索におけるワイルドカード</h2><ul>
<li>windowsやUnix/Linuxのシェルでのファイル検索では、以下のワイルドカードが使える</li>
</ul>
<table>
<thead>
<tr>
<th>ワイルドカード</th>
<th>内容</th>
</tr>
</thead>
<tbody><tr>
<td>?</td>
<td>任意の1文字にマッチ</td>
</tr>
<tr>
<td>*</td>
<td>0文字以上の任意の文字列にマッチ</td>
</tr>
</tbody></table>
<p><code>music.mp?</code> → 「music.mp3」「music.mp4」などにマッチ</p>
<p><code>*.txt</code> → 拡張子が.txtであるもの全てにマッチ</p>
<h2 id="SQLにおけるワイルドカード"><a href="#SQLにおけるワイルドカード" class="headerlink" title="SQLにおけるワイルドカード"></a>SQLにおけるワイルドカード</h2><ul>
<li>SQLのWHERE句におけるLIKE演算子では、以下のワイルドカードが使える</li>
</ul>
<table>
<thead>
<tr>
<th>ワイルドカード</th>
<th>内容</th>
</tr>
</thead>
<tbody><tr>
<td>%</td>
<td>0文字以上の任意の文字列にマッチ</td>
</tr>
<tr>
<td>_</td>
<td>任意の１文字にマッチ</td>
</tr>
</tbody></table>
<h1 id="メタキャラクタとは？"><a href="#メタキャラクタとは？" class="headerlink" title="メタキャラクタとは？"></a>メタキャラクタとは？</h1><ul>
<li>その文字自身とは異なる、特別な意味や役割を持つ文字のこと</li>
</ul>
<p>ざっくり分類すると、</p>
<ul>
<li>文字を表すメタキャラクタ：<code>.（ドット）, \w, \W, \s, \S, \d, \D</code>など</li>
<li>繰り返しを表すメタキャラクタ：<code>+, *, ?, &#123;n&#125;, &#123;n,m&#125;, &#123;n,&#125;</code></li>
<li>位置を表すメタキャラクタ：<code>^, $, \b, \B</code></li>
<li>文字集合やグループを作るメタキャラクタ：<code>[], [^], |, (), (?:)</code></li>
<li>その他（後方参照など）：<code>\1, \2, \3, ...</code></li>
</ul>
<p>※正規表現の実装によってサポートされているメタキャラクタが異なるので注意</p>
<h1 id="文字を表すメタキャラクタ"><a href="#文字を表すメタキャラクタ" class="headerlink" title="文字を表すメタキャラクタ"></a>文字を表すメタキャラクタ</h1><table>
<thead>
<tr>
<th>メタキャラクタ</th>
<th>意味</th>
<th>備考</th>
</tr>
</thead>
<tbody><tr>
<td>.（ドット）</td>
<td>任意の１文字にマッチ</td>
<td>改行にはマッチしない</td>
</tr>
<tr>
<td>\w</td>
<td>単語を構成する文字にマッチ</td>
<td>wはwordの頭文字</td>
</tr>
<tr>
<td>\W</td>
<td>単語を構成する文字 以外の文字 にマッチ</td>
<td></td>
</tr>
<tr>
<td>\d</td>
<td>数字（0~9）にマッチ</td>
<td>dはdigitの頭文字</td>
</tr>
<tr>
<td>\D</td>
<td>数字 以外の文字 にマッチ</td>
<td></td>
</tr>
<tr>
<td>\s</td>
<td>空白文字（半角スペース、タブ文字他）にマッチ</td>
<td>sはspaceの頭文字</td>
</tr>
<tr>
<td>\S</td>
<td>空白文字 以外の文字 にマッチ</td>
<td></td>
</tr>
</tbody></table>
<h1 id="制御文字を表すメタキャラクタ"><a href="#制御文字を表すメタキャラクタ" class="headerlink" title="制御文字を表すメタキャラクタ"></a>制御文字を表すメタキャラクタ</h1><table>
<thead>
<tr>
<th>メタキャラクタ</th>
<th>意味</th>
</tr>
</thead>
<tbody><tr>
<td>\t</td>
<td>タブ文字</td>
</tr>
<tr>
<td>\v</td>
<td>垂直タブ</td>
</tr>
<tr>
<td>\n</td>
<td>改行文字</td>
</tr>
<tr>
<td>\r</td>
<td>改行文字（キャレッジリターン）</td>
</tr>
<tr>
<td>\f</td>
<td>用紙送り文字</td>
</tr>
<tr>
<td>\a</td>
<td>警告文字</td>
</tr>
<tr>
<td>\e</td>
<td>エスケープ文字</td>
</tr>
</tbody></table>
<h1 id="繰り返しを表すメタキャラクタ（量指定子）"><a href="#繰り返しを表すメタキャラクタ（量指定子）" class="headerlink" title="繰り返しを表すメタキャラクタ（量指定子）"></a>繰り返しを表すメタキャラクタ（量指定子）</h1><table>
<thead>
<tr>
<th>メタキャラクタ</th>
<th>意味</th>
<th>備考</th>
</tr>
</thead>
<tbody><tr>
<td>{n}</td>
<td>n回以上の繰り返しにマッチ</td>
<td></td>
</tr>
<tr>
<td>{n,m}</td>
<td>n回以上m回以下の繰り返しにマッチ</td>
<td></td>
</tr>
<tr>
<td>{n,}</td>
<td>n回以上の繰り返しにマッチ</td>
<td></td>
</tr>
<tr>
<td>*</td>
<td>0回以上の繰り返しにマッチ</td>
<td>{0,}と同義</td>
</tr>
<tr>
<td>+</td>
<td>1回以上の繰り返しにマッチ</td>
<td>{1,}と同義</td>
</tr>
<tr>
<td>?</td>
<td>0回または1回の繰り返しにマッチ</td>
<td>{0,1}と同義</td>
</tr>
</tbody></table>
<h1 id="位置を表すメタキャラクタ（アンカー）"><a href="#位置を表すメタキャラクタ（アンカー）" class="headerlink" title="位置を表すメタキャラクタ（アンカー）"></a>位置を表すメタキャラクタ（アンカー）</h1><table>
<thead>
<tr>
<th>メタキャラクタ</th>
<th>意味</th>
</tr>
</thead>
<tbody><tr>
<td>$</td>
<td>行末</td>
</tr>
<tr>
<td>^</td>
<td>行頭</td>
</tr>
<tr>
<td>\b</td>
<td>単語境界</td>
</tr>
<tr>
<td>\B</td>
<td>単語境界以外</td>
</tr>
</tbody></table>
<h1 id="文字集合やグループを作るメタキャラクタ"><a href="#文字集合やグループを作るメタキャラクタ" class="headerlink" title="文字集合やグループを作るメタキャラクタ"></a>文字集合やグループを作るメタキャラクタ</h1><table>
<thead>
<tr>
<th>メタキャラクタ</th>
<th>意味</th>
</tr>
</thead>
<tbody><tr>
<td>[abc]</td>
<td>aかbかcのどれか1文字にマッチ</td>
</tr>
<tr>
<td>[a-z]</td>
<td>aからzのどれか1文字にマッチ</td>
</tr>
<tr>
<td>[^abc]</td>
<td>abc以外のどれか1文字にマッチ</td>
</tr>
<tr>
<td>`abc</td>
<td>def`</td>
</tr>
<tr>
<td>(abc)</td>
<td>グループ化とキャプチャを行う</td>
</tr>
<tr>
<td>(?:abc)</td>
<td>グループ化を行う</td>
</tr>
</tbody></table>
<h2 id="a-z-について"><a href="#a-z-について" class="headerlink" title="[a-z]について"></a>[a-z]について</h2><ul>
<li>[a-z]のa-zの範囲は文字コードの範囲</li>
<li>Unicodeの文字コード番号を使用して[\u0061-\u007A]のように表すこともできる</li>
</ul>
<h1 id="その他の正規表現の機能"><a href="#その他の正規表現の機能" class="headerlink" title="その他の正規表現の機能"></a>その他の正規表現の機能</h1><p>以下の機能は、処理系によっては使用できない場合があるので注意すること。</p>
<h2 id="グループ化"><a href="#グループ化" class="headerlink" title="グループ化"></a>グループ化</h2><ul>
<li>(abc)のように括弧内の文字列をひとまとめに扱うこと</li>
</ul>
<p>例1) hogehoge….と「hoge」を繰り返す文字列をマッチさせたい場合、以下で検索するとマッチする。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">グループ化の例1</span><br><span class="line">(hoge)+  </span><br></pre></td></tr></table></figure>
<p>例2) <a target="_blank" rel="noopener" href="https://www.yahoo.co.jp/">https://www.yahoo.co.jp/</a> と <a target="_blank" rel="noopener" href="https://www.google.co.jp/">https://www.google.co.jp/</a> の両方にマッチさせたい場合、以下で検索するとマッチする</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">グループ化の例2</span><br><span class="line">https://www\.(google|yahoo)\.co\.jp/</span><br></pre></td></tr></table></figure>
<p>で検索するとマッチする。</p>
<h2 id="キャプチャ"><a href="#キャプチャ" class="headerlink" title="キャプチャ"></a>キャプチャ</h2><ul>
<li>(abc)括弧内の文字列を記憶し、参照出来るようにすること</li>
<li>\1 ,\2 ,\3…で前方で記憶した文字列をマッチさせることが出来る</li>
<li>$1 ,$2 ,$3…で記憶した文字列を変数として参照できる（置換にも使える）</li>
</ul>
<p>※使用出来るかどうかが言語によって異なるので注意</p>
<p>例1) hoge_hoge のように、前後が同じものをマッチさせたい</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">キャプチャのの例1</span><br><span class="line"># 検索文字列</span><br><span class="line">(.+)_\1</span><br></pre></td></tr></table></figure>
<p>で検索するとマッチする。このように前方でマッチしたものを参照することを 後方参照 という。</p>
<p>例2) <a><a target="_blank" rel="noopener" href="https://www.google.co.jp/">https://www.google.co.jp/</a></a> のaタグ内の値をhref属性に設定したい場合、</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">キャプチャの例2</span><br><span class="line"># 検索文字列</span><br><span class="line">&lt;a&gt;(.+?)&lt;/a&gt;</span><br><span class="line"></span><br><span class="line"># 置換文字列</span><br><span class="line">&lt;a href=&quot;$1&quot;&gt;$1&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<p>で置換できる。</p>
<p>例3) <a href="mailto:&#x68;&#x6f;&#103;&#101;&#x40;&#102;&#117;&#103;&#x61;&#x2e;&#x63;&#x6f;&#x6d;">&#x68;&#x6f;&#103;&#101;&#x40;&#102;&#117;&#103;&#x61;&#x2e;&#x63;&#x6f;&#x6d;</a>からのローカル部、ドメイン部、メールアドレス全体を取り出したい場合、</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">キャプチャの例3</span><br><span class="line"># 検索文字列</span><br><span class="line">((.+)@(.+))</span><br><span class="line"></span><br><span class="line"># 置換文字列</span><br><span class="line">メールアドレス=$1\nローカル部=$2\nドメイン部=$3</span><br></pre></td></tr></table></figure>
<p>で置換すると、以下の結果になる。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">例3の結果</span><br><span class="line">メールアドレス=hoge@fuga.com</span><br><span class="line">ローカル部=hoge</span><br><span class="line">ドメイン部=fuga.com</span><br></pre></td></tr></table></figure>
<p>キャプチャする順番は「(」が現れた順になっている。</p>
<h2 id="キャプチャしない括弧"><a href="#キャプチャしない括弧" class="headerlink" title="キャプチャしない括弧"></a>キャプチャしない括弧</h2><ul>
<li><p>(?:)を使用すると、グループ化のみを行いキャプチャを行わない</p>
</li>
<li><p>グループ化のみが目的であることを明示したい場合このように書く</p>
</li>
<li><p>若干読みにくくなる（可読性が下がる）ので、どちらで書いた方がいいかは状況による</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">キャプチャしない括弧の例</span><br><span class="line">https://www\.(?:google|yahoo)\.co\.jp/ </span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="先読みと後読み"><a href="#先読みと後読み" class="headerlink" title="先読みと後読み"></a>先読みと後読み</h2><table>
<thead>
<tr>
<th>先読み・後読み</th>
<th>正規表現</th>
<th>意味</th>
</tr>
</thead>
<tbody><tr>
<td>肯定先読み(positive look forward)</td>
<td>(?=abc)</td>
<td>前方を見てabcがある位置にマッチ</td>
</tr>
<tr>
<td>否定先読み(negative look forward)</td>
<td>(?!abc)</td>
<td>前方を見てabcがない位置にマッチ</td>
</tr>
<tr>
<td>肯定後読み(positive look behind)</td>
<td>(?&lt;=abc)</td>
<td>後方を見てabcがある位置にマッチ</td>
</tr>
<tr>
<td>否定後読み(negative look behind)</td>
<td>(?&lt;!abc)</td>
<td>後方を見てabcがない位置にマッチ</td>
</tr>
</tbody></table>
<p>※JavaScript系では後読みは実装されていないので注意</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">例</span><br><span class="line">customer.fullname</span><br><span class="line">customer.firstName</span><br><span class="line">customer.lastName</span><br><span class="line">employee.firstName</span><br><span class="line">employee.lastName</span><br><span class="line">officer.firstName</span><br><span class="line">officer.lastName</span><br></pre></td></tr></table></figure>

<ul>
<li>customer(?=.firstName)<ul>
<li>→後ろにfirstNameが続くcustomerにマッチ</li>
</ul>
</li>
<li>customer(?!.firstName)<ul>
<li>→後ろにfullNameが来ないcustomerにマッチ</li>
</ul>
</li>
<li>(?&lt;=customer.)firstName<ul>
<li>→customerの後ろのfirstNameにマッチ</li>
</ul>
</li>
<li>(?&lt;!customer.)firstName<ul>
<li>→customer以外の後ろのfirstNameにマッチ</li>
</ul>
</li>
</ul>
<h2 id="～を含む・含まない"><a href="#～を含む・含まない" class="headerlink" title="～を含む・含まない"></a>～を含む・含まない</h2><ul>
<li>先読み・後読みを応用すると、～を含む・含まない行は以下の正規表現のように表せる</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">abcを含む行・含まない行</span><br><span class="line"># abcを含む行</span><br><span class="line">^(?=.*abc).*</span><br><span class="line"></span><br><span class="line"># defを含まない行</span><br><span class="line">^(?!.*def).*</span><br></pre></td></tr></table></figure>
<p>例)</p>
<p>スペースを含む行を削除したい</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">スペースを含む行の削除</span><br><span class="line"># 検索文字列</span><br><span class="line">^(?=.* ).*\n</span><br><span class="line"></span><br><span class="line"># 置換文字列は空文字</span><br></pre></td></tr></table></figure>

<h2 id="修飾子"><a href="#修飾子" class="headerlink" title="修飾子"></a>修飾子</h2><ul>
<li>多くの処理系にはマッチングの処理方法を変更する指定オプションが用意されている</li>
<li>末尾に付ける修飾子をフラグ（flag）と呼ぶ</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JavaScript</span><br><span class="line">// 修飾子iは大文字と小文字を区別しない（ignoreCase）</span><br><span class="line">// 修飾子gは全てのマッチング箇所を検索する（global）</span><br><span class="line">var regex = /hoge/ig;</span><br></pre></td></tr></table></figure>

<h1 id="正規表現における注意点"><a href="#正規表現における注意点" class="headerlink" title="正規表現における注意点"></a>正規表現における注意点</h1><h2 id="最長マッチと最短マッチ"><a href="#最長マッチと最短マッチ" class="headerlink" title="最長マッチと最短マッチ"></a>最長マッチと最短マッチ</h2><p>思ったよりも長い範囲にマッチしてしまう・・・という時に確認</p>
<ul>
<li>繰り返し文字はデフォルトではマッチしうる最大の文字列にマッチする</li>
<li>繰り返しのメタキャラクタの後ろに 「?」 を付けるとマッチしうる最小の文字列にマッチする</li>
</ul>
<p>例えば、「<a href="mailto:&#104;&#x6f;&#103;&#x65;&#x40;&#x68;&#111;&#x67;&#101;&#x2e;&#x63;&#111;&#x6d;">&#104;&#x6f;&#103;&#x65;&#x40;&#x68;&#111;&#x67;&#101;&#x2e;&#x63;&#111;&#x6d;</a>」からhogeを別々に2つマッチさせたいとする。</p>
<p>正規表現：<code>h.*e</code></p>
<p>とすると、「hoge@hoge」にマッチしてしまうのでNG、</p>
<p>正規表現：<code>h.*?e</code></p>
<p>のようにする必要がある。</p>
<h2 id="基本正規表現と拡張正規表現"><a href="#基本正規表現と拡張正規表現" class="headerlink" title="基本正規表現と拡張正規表現"></a>基本正規表現と拡張正規表現</h2><p>あれ？正規表現は合ってるのにマッチしない・・・という場合はそもそも機能がサポートされていない可能性がある</p>
<ul>
<li>POSIX正規表現には2種類あり、利用できるメタキャラクタや機能が異なる</li>
</ul>
<table>
<thead>
<tr>
<th>種類</th>
<th>特徴</th>
<th>対応</th>
</tr>
</thead>
<tbody><tr>
<td>基本正規表現(basic regular expression:BRE)</td>
<td>grep, sed など</td>
<td>「`</td>
</tr>
<tr>
<td>拡張正規表現(extended regular expression:ERE)</td>
<td>egrep（grep -E）, sed -E など</td>
<td>「+」「?」は使用できる「()」「{}」はエスケープ不要</td>
</tr>
</tbody></table>
<ul>
<li>さらにこれに機能を加えた正規表現があり、追加機能が使えるかどうかは実装毎に確認するしかない。</li>
</ul>
<p>参考：<a target="_blank" rel="noopener" href="http://jmatsu.hatenablog.com/entry/2017/01/30/130952">3つの正規表現を知らないとハマるヨ</a></p>
<h2 id="エスケープの必要性"><a href="#エスケープの必要性" class="headerlink" title="エスケープの必要性"></a>エスケープの必要性</h2><p>コード内で正規表現を使用する場合には、エスケープが２重に必要な場合があるので注意</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">java</span><br><span class="line">// 文字列リテラル</span><br><span class="line">String regex = &quot;hoge\\.com&quot;;</span><br><span class="line"></span><br><span class="line">// バックスラッシュの正規表現は\\\\と書く。これで「\」のみにマッチ</span><br><span class="line">String backslashRegex = &quot;\\\\&quot;;</span><br></pre></td></tr></table></figure>

<h2 id="正規表現リテラル"><a href="#正規表現リテラル" class="headerlink" title="正規表現リテラル"></a>正規表現リテラル</h2><ul>
<li>正規表現リテラルにはそのまま正規表現を書ける（正規表現のみのエスケープで良い）。</li>
<li>JavaScriptやRubyなどは正規表現リテラルがサポートされているが、Javaはサポートされていない<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JavaScript</span><br><span class="line">// 正規表現リテラル</span><br><span class="line">var regex = /hoge\.com/;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="正規表現のチェックに役立つサイト"><a href="#正規表現のチェックに役立つサイト" class="headerlink" title="正規表現のチェックに役立つサイト"></a>正規表現のチェックに役立つサイト</h2><ul>
<li><a target="_blank" rel="noopener" href="https://regexper.com/">Regexper：正規表現を可視化して確認できる</a></li>
<li><a target="_blank" rel="noopener" href="http://regex-testdrive.com/ja/">regex-testdrive：Javaの正規表現チェック</a></li>
<li><a target="_blank" rel="noopener" href="http://okumocchi.jp/php/re.php">okumocchi：PHP及びJavaScript正規表現チェック</a></li>
<li><a target="_blank" rel="noopener" href="http://regexr.com/">Regexr：JavaScriptの正規表現チェック</a></li>
<li><a target="_blank" rel="noopener" href="http://rubular.com/">Rubular：Rubyの正規表現チェック、キャプチャ内容がわかる</a></li>
</ul>
<h1 id="補足・参考"><a href="#補足・参考" class="headerlink" title="補足・参考"></a>補足・参考</h1><h2 id="「-」（バックスラッシュ）と「¥」（円マークについて）"><a href="#「-」（バックスラッシュ）と「¥」（円マークについて）" class="headerlink" title="「\」（バックスラッシュ）と「¥」（円マークについて）"></a>「\」（バックスラッシュ）と「¥」（円マークについて）</h2><ul>
<li>Unicodeが広まる以前、和文フォントでは「/」の文字コード（0x5c）に「¥」の表記を割り当てていたため、「\」を入力すると「¥」が表示されるようになった。</li>
<li>その名残で「\」文字コード（0x5c）を入力した場合、「¥」が表示される場合がある。</li>
<li>Unicodeでは「\」の文字コード（U+005c）とは別に、「¥」に文字コード（U+00A5）が割り当てられている。</li>
</ul>
<h2 id="改行コードについて"><a href="#改行コードについて" class="headerlink" title="改行コードについて"></a>改行コードについて</h2><p>正規表現とは関係ないけどキャレッジリターンってなんぞ？と思ったので調べてみた</p>
<ul>
<li>「CR」「LF」「CRLF」の3種類ある</li>
<li>昔のMacではCR,現在のMacやLinuxなどのUnix系ではLF,windowsではCRLFを採用している</li>
</ul>
<blockquote>
<p>タイプライターにはキャリッジというロールに紙を挟む役目を持つ部品があり、その位置を調節する「キャリッジリターンレバー」と、1行分ロールを回し紙を送ること（ラインフィード）が出来るレバーを順に操作することで改行を行っていた。</p>
</blockquote>
<h2 id="キャリッジリターン（carriage-return-CR、復帰）"><a href="#キャリッジリターン（carriage-return-CR、復帰）" class="headerlink" title="キャリッジリターン（carriage return:CR、復帰）"></a>キャリッジリターン（carriage return:CR、復帰）</h2><ul>
<li>カーソルを行の先頭に戻す指示（左に移動）<h2 id="ラインフィード（line-feed-LF-newline-end-of-line、狭義の改行）"><a href="#ラインフィード（line-feed-LF-newline-end-of-line、狭義の改行）" class="headerlink" title="ラインフィード（line feed:LF, newline, end-of-line、狭義の改行）"></a>ラインフィード（line feed:LF, newline, end-of-line、狭義の改行）</h2></li>
<li>カーソルを一つ下の行に移す指示（下に移動）</li>
<li>以前はカーソルを下に移すだけで行頭には戻らなかった（現在は行頭に戻るようになっている）</li>
</ul>
<h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><ul>
<li>grepとはedというラインエディタのコマンド g/re/pのコマンドからきている</li>
<li>global Regular Expression printの略</li>
</ul>
<h2 id="バリデーション（validation）とは？"><a href="#バリデーション（validation）とは？" class="headerlink" title="バリデーション（validation）とは？"></a>バリデーション（validation）とは？</h2><ul>
<li>validate：検証する・（妥当性を）確認する、有効性を確かめる</li>
<li>IT分野では「規定された文法・仕様通りに記述されているかどうかを検証すること」</li>
<li>メールアドレス、パスワード、電話番号、郵便番号など文法のチェックの意味で使われる</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lyvivian0077.github.io/2019/10/07/taged-VLAN%E3%81%A8untagedVLAN%E3%81%AE%E9%81%95%E3%81%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyvivian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="总有刁民想要害朕">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/10/07/taged-VLAN%E3%81%A8untagedVLAN%E3%81%AE%E9%81%95%E3%81%84/" class="post-title-link" itemprop="url">タグVLANとネイティブVLAN (PVID)の違い</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-10-08 03:04:20" itemprop="dateCreated datePublished" datetime="2019-10-08T03:04:20+09:00">2019-10-08</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-06-22 12:58:45" itemprop="dateModified" datetime="2021-06-22T12:58:45+09:00">2021-06-22</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/main/" itemprop="url" rel="index"><span itemprop="name">main</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="タグVLAN-とは"><a href="#タグVLAN-とは" class="headerlink" title="タグVLAN とは"></a>タグVLAN とは</h1><p><strong>タグVLAN (Tag VLAN)</strong> とは、複数のVLANを1本のLAN接続だけで複数スイッチ間で共有できる技術です。</p>
<p><code>IEEE802.1q</code> という規格で規定されており、VLAN ID は <code>1～4094</code> が使えます。</p>
<p>具体的な例として、スイッチ同士を接続するポートに<br><code>trunk port</code> (トランクポート。 <code>tag port</code> と呼ばれたりします) の設定を入れて接続します。</p>
<p>すると<strong>そのリンク(トランクリンク)は VLAN ID 情報を含む Tag を付けて通信するようになります</strong>。</p>
<p><img src="/assets/tag-vlan-1.png" alt="tag-vlan"></p>
<p>例では VLAN が 3 つだけですので、各VLAN 1本ずつ、<br>系3本のケーブルをスイッチ間で接続する構成も可能ですがこれは非効率です。<br>例えばこれが、VLAN が20個あったとしたらそれだけでケーブルとポートを20ポートも消費してしまいます。</p>
<p>このようなケースでも、タグ VLAN を使えば 1 ポートだけで 20 個の VLAN を共有できます。</p>
<h1 id="Native-VLAN-PVID-とは"><a href="#Native-VLAN-PVID-とは" class="headerlink" title="Native VLAN (PVID) とは"></a>Native VLAN (PVID) とは</h1><p><strong>Native VLAN</strong> とは、<strong>トランクポートの中で、タグを付けない VLAN ID のこと</strong>を指します。<br><code>デフォルトVLAN</code> や <code>PVID (Port VLAN ID)</code> も同じ意味です。</p>
<p>この Native VLAN も IEEE802.1q の規格で決まっており、<br><strong>各トランクポートで1つだけ、この Native VLAN を指定することができます</strong><br>（機器単位ではなくポート単位で指定できるものが多いです）。  </p>
<p>デフォルトでは全ポート <code>VLAN ID=1</code> が <code>Native VLAN</code> になっています。</p>
<h1 id="Native-VLAN-の不一致"><a href="#Native-VLAN-の不一致" class="headerlink" title="Native VLAN の不一致"></a>Native VLAN の不一致</h1><p><img src="/assets/native-vlan-1.png" alt="native-vlan"></p>
<p>上図左側の例に示した通り、<strong>Native VLAN はトランクリンクの両端で揃える必要があります</strong><br>（スイッチの全トランクポートでそろえる必要はありません）。</p>
<p><strong>もし揃えないと</strong>、例の右側の「悪い例」のように、VLAN 1 の通信が VLAN 2 に混入したりと、<br><strong>論理構成に捻じれが発生したりします</strong>。</p>
<p>Native VLAN の不一致は、特に PVSTPではループの検知が出来なくなる可能性があるため、<br>エラーにも出力されます。</p>
<p>なお、<code>CDP (Cisco Discovery Protocol)</code> には Native VLAN 情報も乗っており、不一致があると<br><code>&quot;%CDP-4-NATIVE_VLAN_MISMATCH: Native VLAN mismatch discovered on &quot;</code> といったログが出力されます。</p>
<h1 id="どういう時にネイティブVLANを変更する？"><a href="#どういう時にネイティブVLANを変更する？" class="headerlink" title="どういう時にネイティブVLANを変更する？"></a>どういう時にネイティブVLANを変更する？</h1><p>変更する理由は基本的には無いはずですが、ケースとして2つ例を挙げます。</p>
<ul>
<li>1つ目は、例えばネイティブ VLAN を 10 にすると、<br>そのポートに PC や VLAN 非対応のスイッチングハブを接続すると、<br>VLAN 10 で通信できます。このあたりは下記記事にも記載しています。</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://milestone-of-se.nesuke.com/nw-basic/ethernet/vlan-access-trunk/">トランクポートとアクセスポートの違い、trunk port に access port や PC を接続するとどうなるか</a></p>
<ul>
<li>2つ目は、1つ目に関連するのですが、デフォルト VLAN である VLAN 1 は、<br>telnet 接続用等の<strong>管理用として使われることも多いです</strong>。<br>トランクポートを一般ユーザが物理的にいじれる位置にあると、<br>その<strong>ポートを引っこ抜いて PC に接続すると VLAN 1 へアクセスできてしまいます</strong>。</li>
</ul>
<p>そのようなセキュリティの理由で、適当な VLAN に変更するケースが考えられます。</p>
<h1 id="accessポート、trunkポートとtagged-untaggedについて"><a href="#accessポート、trunkポートとtagged-untaggedについて" class="headerlink" title="accessポート、trunkポートとtagged, untaggedについて"></a>accessポート、trunkポートとtagged, untaggedについて</h1><p>メーカによっては、<code>access ポート</code>、<code>trunk ポート</code>という括りがなく、<br>単純にポート単位で <code>tagged</code>、<code>untagged</code> のVLAN ID を指定するスイッチもあります。</p>
<p>例えば以下のような対応になります。</p>
<table>
<thead>
<tr>
<th align="left">access, trunk</th>
<th align="left">tagged, untagged</th>
</tr>
</thead>
<tbody><tr>
<td align="left">access vlan=10</td>
<td align="left">untagged=10</td>
</tr>
<tr>
<td align="left">trunk vlan=10,20</td>
<td align="left">tagged=10,20</td>
</tr>
<tr>
<td align="left">trunk vlan=20(native vlan), 30,40</td>
<td align="left">untagged=20, tagged=30,40</td>
</tr>
</tbody></table>
<p>各ポートで untagged の VLAN は 0～1個、tagged の VLAN は0個以上です。</p>
<p>両方とも 0 個になることはなく、untagged が 1 個だけならそのポートはアクセスポート、<br>そこに tagged も1個以上乗るならそれはトランクポート(untagged は native VLAN)になります。</p>
<h1 id="Native-VLAN-をタグ付きで受信した場合の挙動"><a href="#Native-VLAN-をタグ付きで受信した場合の挙動" class="headerlink" title="Native VLAN をタグ付きで受信した場合の挙動"></a>Native VLAN をタグ付きで受信した場合の挙動</h1><p><strong>Native VLAN や untagged に指定したVLAN を、タグ付きで受信した場合の挙動</strong>は、メーカによって異なります。</p>
<p>例えば、Native VLAN=10 に設定したポートで、タグ付きの VLAN 10 を受信した場合、<br>通常の VLAN=10 として許可する場合もありますし、破棄されてしまう場合もありますので、<br>もしそのような構成をする場合は事前に確認が必要です。</p>
<h1 id="voice-vlan-でタグを付ける理由"><a href="#voice-vlan-でタグを付ける理由" class="headerlink" title="voice vlan でタグを付ける理由"></a>voice vlan でタグを付ける理由</h1><p><code>voice vlan</code> はタグを付けるのが <code>cisco</code> の推奨です。<br>2 byte とはいえ、速度にシビアな音声パケットにオーバーヘッドともなるタグを付けるのは何故でしょうか？</p>
<p>これは、<code>tag vlan</code> には <code>IEEE802.1p</code> という <code>QoS</code> で利用できるフィールド (通称 cos) があるからです。<br>音声パケットはこの <code>cos</code> 値を <code>5</code> に設定することで、スイッチに『<strong>このパケットは優先で通過させてね</strong>』と伝えるのです。</p>
<p>なお、単に <code>cos</code> 値を <code>5</code> にセットするだけでは <code>QoS</code> は動作しません。<br>経由する各スイッチで『<strong>cos 値 = 5 のパケットを優先で出力する</strong>』という設定が必要です。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://lyvivian0077.github.io/2019/06/03/Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyvivian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="总有刁民想要害朕">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/03/Python-Re-%E6%A8%A1%E5%9D%97%E8%B6%85%E5%85%A8%E8%A7%A3%E8%AF%BB/" class="post-title-link" itemprop="url">Python Re 模块超全解读</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-06-03 10:25:20" itemprop="dateCreated datePublished" datetime="2019-06-03T10:25:20+09:00">2019-06-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-06-22 12:58:45" itemprop="dateModified" datetime="2021-06-22T12:58:45+09:00">2021-06-22</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/main/" itemprop="url" rel="index"><span itemprop="name">main</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="re模块下的函数"><a href="#re模块下的函数" class="headerlink" title="re模块下的函数"></a>re模块下的函数</h3><h4 id="compile-pattern-：创建模式对象"><a href="#compile-pattern-：创建模式对象" class="headerlink" title="compile(pattern)：创建模式对象"></a>compile(pattern)：创建模式对象</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">pat=re.<span class="built_in">compile</span>(<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">m=pat.search(<span class="string">&#x27;CBA&#x27;</span>)                    <span class="comment">#等价于 re.search(&#x27;A&#x27;,&#x27;CBA&#x27;)</span></span><br><span class="line"><span class="built_in">print</span> m</span><br><span class="line">&lt;_sre.SRE_Match <span class="built_in">object</span> at <span class="number">0x9d690c8</span>&gt;   <span class="comment">#匹配到了，返回MatchObject（True）</span></span><br><span class="line"> </span><br><span class="line">m=pat.search(<span class="string">&#x27;CBD&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span> m</span><br><span class="line"><span class="literal">None</span>                                   <span class="comment">#没有匹配到，返回None（False）</span></span><br></pre></td></tr></table></figure>

<h4 id="search-pattern-string-：在字符串中寻找模式"><a href="#search-pattern-string-：在字符串中寻找模式" class="headerlink" title="search(pattern,string)：在字符串中寻找模式"></a>search(pattern,string)：在字符串中寻找模式</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">m = re.search(<span class="string">&#x27;asd&#x27;</span>,<span class="string">&#x27;ASDasd&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span> m</span><br><span class="line">&lt;_sre.SRE_Match <span class="built_in">object</span> at <span class="number">0xb72cd6e8</span>&gt;  <span class="comment">#匹配到了，返回MatchObject（True）</span></span><br><span class="line">m = re.search(<span class="string">&#x27;asd&#x27;</span>,<span class="string">&#x27;ASDASD&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span> m</span><br><span class="line"><span class="literal">None</span>                                   <span class="comment">#没有匹配到，返回None（False）</span></span><br></pre></td></tr></table></figure>

<h4 id="match-pattern-string-：在字符串开始处匹配模式"><a href="#match-pattern-string-：在字符串开始处匹配模式" class="headerlink" title="match(pattern,string)：在字符串开始处匹配模式"></a>match(pattern,string)：在字符串开始处匹配模式</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">m = re.search(<span class="string">&#x27;asd&#x27;</span>,<span class="string">&#x27;ASDasd&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span> m</span><br><span class="line">&lt;_sre.SRE_Match <span class="built_in">object</span> at <span class="number">0xb72cd6e8</span>&gt;  <span class="comment">#匹配到了，返回MatchObject（True）</span></span><br><span class="line">m = re.search(<span class="string">&#x27;asd&#x27;</span>,<span class="string">&#x27;ASDASD&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span> m</span><br><span class="line"><span class="literal">None</span>                                   <span class="comment">#没有匹配到，返回None（False）</span></span><br></pre></td></tr></table></figure>

<h5 id="等价于"><a href="#等价于" class="headerlink" title="等价于"></a>等价于</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pat=re.<span class="built_in">compile</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span> pat.match(<span class="string">&#x27;Aasd&#x27;</span>)</span><br><span class="line"><span class="literal">None</span></span><br><span class="line">printpat.match(<span class="string">&#x27;aASD&#x27;</span>)</span><br><span class="line">&lt;_sre.SRE_Match <span class="built_in">object</span> at <span class="number">0xb72cd6e8</span>&gt;</span><br></pre></td></tr></table></figure>

<h5 id="上面的函数返回都可以在if条件语句中进行判断："><a href="#上面的函数返回都可以在if条件语句中进行判断：" class="headerlink" title="上面的函数返回都可以在if条件语句中进行判断："></a>上面的函数返回都可以在if条件语句中进行判断：</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> pat.search(<span class="string">&#x27;asd&#x27;</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span> <span class="string">&#x27;OK&#x27;</span></span><br><span class="line">...</span><br><span class="line">OK        <span class="comment">#找到返回</span></span><br><span class="line"><span class="keyword">if</span> re.search(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;ASD&#x27;</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span> <span class="string">&quot;OK&quot;</span></span><br><span class="line"><span class="meta">... </span>      <span class="comment">#没有找到</span></span><br></pre></td></tr></table></figure>

<h4 id="split-pattern-string-：根据模式分割字符串-返回列表"><a href="#split-pattern-string-：根据模式分割字符串-返回列表" class="headerlink" title="split(pattern,string)：根据模式分割字符串,返回列表"></a>split(pattern,string)：根据模式分割字符串,返回列表</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">re.split(<span class="string">&#x27;,&#x27;</span>,<span class="string">&#x27;a,s,d,asd&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;asd&#x27;</span>]          <span class="comment">#返回列表</span></span><br><span class="line"> </span><br><span class="line">pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">pat.split(<span class="string">&#x27;a,s,d,asd&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;asd&#x27;</span>]          <span class="comment">#返回列表</span></span><br><span class="line"> </span><br><span class="line">re.split(<span class="string">&#x27;[, ]+&#x27;</span>,<span class="string">&#x27;a ,  s  ,d     ,,,,,asd&#x27;</span>)   <span class="comment">#正则匹配：[, ]+，后面说明</span></span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;asd&#x27;</span>]</span><br><span class="line"> </span><br><span class="line">re.split(<span class="string">&#x27;[, ]+&#x27;</span>,<span class="string">&#x27;a ,  s  ,d     ,,,,,asd&#x27;</span>,maxsplit=<span class="number">2</span>) <span class="comment"># maxsplit 最多分割次数</span></span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;d     ,,,,,asd&#x27;</span>]</span><br><span class="line"> </span><br><span class="line">pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;[, ]+&#x27;</span>)                     <span class="comment">#正则匹配：[, ]+，后面说明</span></span><br><span class="line">pat.split(<span class="string">&#x27;a ,  s  ,d     ,,,,,asd&#x27;</span>,maxsplit=<span class="number">2</span>)        <span class="comment"># maxsplit 最多分割次数</span></span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;d     ,,,,,asd&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="findall-pattern-string-：列表形式返回匹配项"><a href="#findall-pattern-string-：列表形式返回匹配项" class="headerlink" title="findall(pattern,string)：列表形式返回匹配项"></a>findall(pattern,string)：列表形式返回匹配项</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">re.findall(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;ASDaDFGAa&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>]                           <span class="comment">#列表形式返回匹配到的字符串</span></span><br><span class="line"> </span><br><span class="line">pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">pat.findall(<span class="string">&#x27;ASDaDFGAa&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>]                           <span class="comment">#列表形式返回匹配到的字符串</span></span><br><span class="line"> </span><br><span class="line">pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;[A-Z]+&#x27;</span>)       <span class="comment">#正则匹配：&#x27;[A-Z]+&#x27; 后面有说明</span></span><br><span class="line">pat.findall(<span class="string">&#x27;ASDcDFGAa&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;ASD&#x27;</span>, <span class="string">&#x27;DFGA&#x27;</span>]                      <span class="comment">#找到匹配到的字符串</span></span><br><span class="line"> </span><br><span class="line">pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;[A-Z]&#x27;</span>)</span><br><span class="line">pat.findall(<span class="string">&#x27;ASDcDFGAa&#x27;</span>)         <span class="comment">#正则匹配：&#x27;[A-Z]+&#x27; 后面有说明</span></span><br><span class="line">[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;A&#x27;</span>]  <span class="comment">#找到匹配到的字符串</span></span><br><span class="line"> </span><br><span class="line">pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;[A-Za-z]&#x27;</span>)     <span class="comment">#正则匹配：&#x27;[A-Za-z]+&#x27; 匹配所有单词，后面有说明</span></span><br><span class="line">pat.findall(<span class="string">&#x27;ASDcDFGAa&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;a&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="sub-pat-repl-string-：用repl替换-pat匹配项"><a href="#sub-pat-repl-string-：用repl替换-pat匹配项" class="headerlink" title="sub(pat,repl,string) ：用repl替换 pat匹配项"></a>sub(pat,repl,string) ：用repl替换 pat匹配项</h4><p>(留的是中间的，因为中间在中心)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">re.sub(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;abcasd&#x27;</span>)   <span class="comment">#找到a用A替换，后面见和group的配合使用</span></span><br><span class="line"><span class="string">&#x27;AbcAsd&#x27;</span></span><br><span class="line"> </span><br><span class="line">pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">pat.sub(<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;abcasd&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;AbcAsd&#x27;</span></span><br><span class="line"> </span><br><span class="line">pat=re.<span class="built_in">compile</span>(<span class="string">r&#x27;www\.(.*)\..&#123;3&#125;&#x27;</span>) <span class="comment">#正则表达式</span></span><br><span class="line">  <span class="comment">#在Python的string前面加上‘r’， 是为了告诉编译器这个string是个raw string，不要转译反斜杠 &#x27;\&#x27; 。</span></span><br><span class="line">  <span class="comment">#例如，\n 在raw string中，是两个字符，\和n， 而不会转译为换行符。</span></span><br><span class="line">  <span class="comment">#由于正则表达式和 \ 会有冲突，因此，当一个字符串使用了正则表达式后，最好在前面加上&#x27;r&#x27;。</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">#与大多数编程语言相同，正则表达式里使用&quot;\&quot;作为转义字符，这就可能造成反斜杠困扰。</span></span><br><span class="line">  <span class="comment">#假如你需要匹配文本中的字符&quot;\&quot;，那么使用编程语言表示的正则表达式里将需要4个反斜杠&quot;\\\\&quot;：</span></span><br><span class="line">  <span class="comment">#前两个和后两个分别用于在编程语言里转义成反斜杠，转换成两个反斜杠后再在正则表达式里转义成一个反斜杠。</span></span><br><span class="line">  <span class="comment">#Python里的原生字符串很好地解决了这个问题，这个例子中的正则表达式可以使用r&quot;\\&quot;表示。</span></span><br><span class="line">  <span class="comment">#同样，匹配一个数字的&quot;\\d&quot;可以写成r&quot;\d&quot;。</span></span><br><span class="line">  <span class="comment">#有了原生字符串，你再也不用担心是不是漏写了反斜杠，写出来的表达式也更直观。</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">#不是说 加了r \就没有转译功能，好乱，就直接记住1句话：</span></span><br><span class="line">  <span class="comment">#当一个字符串使用了正则表达式后，最好在前面加上&#x27;r&#x27;，这样你再也不用担心是不是漏写了反斜杠，写出来的表达式也更直观</span></span><br><span class="line"></span><br><span class="line">pat.match(<span class="string">&#x27;www.dxy.com&#x27;</span>).group(<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;dxy&#x27;</span></span><br><span class="line"> </span><br><span class="line">re.sub(<span class="string">r&#x27;www\.(.*)\..&#123;3&#125;&#x27;</span>,<span class="string">r&#x27;\1&#x27;</span>,<span class="string">&#x27;hello,www.dxy.com&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">pat.sub(<span class="string">r&#x27;\1&#x27;</span>,<span class="string">&#x27;hello,www.dxy.com&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;hello,dxy&#x27;</span></span><br><span class="line"><span class="comment"># r&#x27;1&#x27; 是第一组的意思</span></span><br><span class="line"><span class="comment">#通过正则匹配找到符合规则的&quot;www.dxy.com&quot; ，取得 组1字符串 去替换 整个匹配。</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">pat=re.<span class="built_in">compile</span>(<span class="string">r&#x27;(\w+) (\w+)&#x27;</span>)     <span class="comment">#正则表达式</span></span><br><span class="line">s=<span class="string">&#x27;hello world ! hello hz !&#x27;</span></span><br><span class="line"> </span><br><span class="line">pat.findall(<span class="string">&#x27;hello world ! hello hz !&#x27;</span>)</span><br><span class="line">[(<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;world&#x27;</span>), (<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;hz&#x27;</span>)]</span><br><span class="line">pat.sub(<span class="string">r&#x27;\2 \1&#x27;</span>,s)                <span class="comment">#通过正则得到组1(hello)，组2(world)，再通过sub去替换。即组1替换组2，组2替换组1，调换位置。  </span></span><br><span class="line"><span class="string">&#x27;world hello!hz hello!&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="escape-string-：对字符串里面的特殊字符串进行转义"><a href="#escape-string-：对字符串里面的特殊字符串进行转义" class="headerlink" title="escape(string) ：对字符串里面的特殊字符串进行转义"></a>escape(string) ：对字符串里面的特殊字符串进行转义</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.escape(<span class="string">&#x27;www.dxy.cn&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;www\\.dxy\\.cn&#x27;</span>                   <span class="comment">#转义</span></span><br></pre></td></tr></table></figure>

<p>上面的函数中，只有match、search有group方法，其他的函数没有。</p>
<h3 id="函数的方法"><a href="#函数的方法" class="headerlink" title="函数的方法"></a>函数的方法</h3><h4 id="group：获取子模式-组-的匹配项"><a href="#group：获取子模式-组-的匹配项" class="headerlink" title="group：获取子模式(组)的匹配项"></a>group：获取子模式(组)的匹配项</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pat = re.<span class="built_in">compile</span>(<span class="string">r&#x27;www\.(.*)\.(.*)&#x27;</span>)       <span class="comment">#用()表示1个组，2个组</span></span><br><span class="line">m = pat.match(<span class="string">&#x27;www.dxy.com&#x27;</span>)</span><br><span class="line">m.group()                                  <span class="comment">#默认为0，表示匹配整个字符串  </span></span><br><span class="line"><span class="string">&#x27;www.dxy.com&#x27;</span></span><br><span class="line"> </span><br><span class="line">m.group(<span class="number">1</span>)                                 <span class="comment">#返回给定组1匹配的子字符串</span></span><br><span class="line"><span class="string">&#x27;dxy&#x27;</span></span><br><span class="line"> </span><br><span class="line">m.group(<span class="number">2</span>)</span><br><span class="line"><span class="string">&#x27;com&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="start：给定组匹配项的开始位置"><a href="#start：给定组匹配项的开始位置" class="headerlink" title="start：给定组匹配项的开始位置"></a>start：给定组匹配项的开始位置</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m.start(<span class="number">2</span>)                                 <span class="comment">#组2开始的索引</span></span><br><span class="line"><span class="number">8</span></span><br></pre></td></tr></table></figure>

<h4 id="end：给定组匹配项的结束位置"><a href="#end：给定组匹配项的结束位置" class="headerlink" title="end：给定组匹配项的结束位置"></a>end：给定组匹配项的结束位置</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m.end(<span class="number">2</span>)                                   <span class="comment">#组2结束的索引</span></span><br><span class="line"><span class="number">11</span></span><br></pre></td></tr></table></figure>

<h4 id="span：-给定组匹配项的开始结束位置"><a href="#span：-给定组匹配项的开始结束位置" class="headerlink" title="span： 给定组匹配项的开始结束位置"></a>span： 给定组匹配项的开始结束位置</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m.span(<span class="number">2</span>)                                  <span class="comment">#组2开始、结束的索引</span></span><br><span class="line">(<span class="number">8</span>, <span class="number">11</span>)</span><br></pre></td></tr></table></figure>

<h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><h4 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h4><h4 id="“-”-：通配符-除换行符外的任意的1个字符"><a href="#“-”-：通配符-除换行符外的任意的1个字符" class="headerlink" title="“.” ：通配符,除换行符外的任意的1个字符"></a>“.” ：通配符,除换行符外的任意的1个字符</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pat=re.<span class="built_in">compile</span>(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">pat.match(<span class="string">&#x27;abc&#x27;</span>)</span><br><span class="line">&lt;_sre.SRE_Match <span class="built_in">object</span> at <span class="number">0xb72b6170</span>&gt;</span><br><span class="line">pat.match(<span class="string">&#x27;abc&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;a&#x27;</span>                                <span class="comment">#匹配到了首个字符</span></span><br><span class="line">pat.search(<span class="string">&#x27;abc&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;a&#x27;</span></span><br><span class="line">pat.match(<span class="string">&#x27;\n&#x27;</span>).group()        <span class="comment">#换行符匹配出错</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: <span class="string">&#x27;NoneType&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;group&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="“-”-转义符"><a href="#“-”-转义符" class="headerlink" title="“\” : 转义符"></a>“\” : 转义符</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pat=re.<span class="built_in">compile</span>(<span class="string">&#x27;\.&#x27;</span>)</span><br><span class="line">pat.search(<span class="string">&#x27;abc.efg&#x27;</span>).group()  <span class="comment">#匹配到.</span></span><br><span class="line"><span class="string">&#x27;.&#x27;</span></span><br><span class="line">pat.findall(<span class="string">&#x27;abc.efg&#x27;</span>)         <span class="comment">#不用group,返回列表</span></span><br><span class="line">[<span class="string">&#x27;.&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="“-…-”-字符集合，匹配里面的任意一个元素"><a href="#“-…-”-字符集合，匹配里面的任意一个元素" class="headerlink" title="“[…]” : 字符集合，匹配里面的任意一个元素"></a>“[…]” : 字符集合，匹配里面的任意一个元素</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">&#x27;[abc]&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;axbycz&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;axbycz&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;axbycz&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="“-d”-数字"><a href="#“-d”-数字" class="headerlink" title="“\d” : 数字"></a>“\d” : 数字</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">&#x27;\d&#x27;</span>)          </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;ax1by2cz3&#x27;</span>).group()   <span class="comment">#匹配到第一个数字:1，返回</span></span><br><span class="line"><span class="string">&#x27;1&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;ax1by2cz3&#x27;</span>).group()    <span class="comment">#匹配不到（首个不是）返回None，报错，match匹配字符串头</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: <span class="string">&#x27;NoneType&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;group&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;ax1by2cz3&#x27;</span>)          <span class="comment">#匹配所有的数字，列表返回</span></span><br><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="“-D”-非数字"><a href="#“-D”-非数字" class="headerlink" title="“\D” : 非数字"></a>“\D” : 非数字</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">&#x27;\D&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;ax1by2cz3&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;ax1by2cz3&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;ax1by2cz3&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;z&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="“-s”-：空白字符-、-t、-r、-n、空格"><a href="#“-s”-：空白字符-、-t、-r、-n、空格" class="headerlink" title="“\s” ：空白字符 、 \t、\r、\n、空格"></a>“\s” ：空白字符 、 \t、\r、\n、空格</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">&#x27;\s&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;\rax1 \nby2 \tcz3&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;\rax1 \nby2 \tcz3&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;\r&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;\rax1 \nby2 \tcz3&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;\r&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="“S”-非空白字符"><a href="#“S”-非空白字符" class="headerlink" title="“S” :非空白字符"></a>“S” :非空白字符</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">&#x27;\S&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;\rax1 \nby2 \tcz3&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;\rax1 \nby2 \tcz3&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;3&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="“-w”-：单个的-数字和字母，-A-Za-z0-9"><a href="#“-w”-：单个的-数字和字母，-A-Za-z0-9" class="headerlink" title="“\w” ：单个的 数字和字母，[A-Za-z0-9]"></a>“\w” ：单个的 数字和字母，[A-Za-z0-9]</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">&#x27;\w&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;1a2b3c&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;1&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;1a2b3c&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;1a2b3c&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;1&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="“-W”-非单词字符-除数字和字母外"><a href="#“-W”-非单词字符-除数字和字母外" class="headerlink" title="“\W”:非单词字符,除数字和字母外"></a>“\W”:非单词字符,除数字和字母外</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">&#x27;\W&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;1a2我b3c&#x27;</span>) <span class="comment">#python是用三字节表示一个汉字</span></span><br><span class="line">[<span class="string">&#x27;\xe6&#x27;</span>, <span class="string">&#x27;\x88&#x27;</span>, <span class="string">&#x27;\x91&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;1a2我b3c&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;\xe6&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="数量词"><a href="#数量词" class="headerlink" title="数量词"></a>数量词</h3><h4 id="“-”-：0次或多次"><a href="#“-”-：0次或多次" class="headerlink" title="“*” ：0次或多次"></a>“*” ：0次或多次</h4><p>（ 乘0会变成0）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;[abc]*&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;abcabcdefabc&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;abcabc&#x27;</span>                              <span class="comment">#2次</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;abcabcdefabc&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;abcabc&#x27;</span>                              <span class="comment">#2次</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;abcabcdefabc&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;abcabc&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;&#x27;</span>]     <span class="comment">#2次和1次,因为有0次，所以匹配了&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="“-”-：1次或多次"><a href="#“-”-：1次或多次" class="headerlink" title="“+” ：1次或多次"></a>“+” ：1次或多次</h4><p>（ 加0不会变成0）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;[abc]+&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;abcdefabcabc&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;abcdefabcabc&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;abcdefabcabc&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;abcabc&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="“-”-：0次或1次，match-search-不会出现none，会出现’-‘-（因为0次也是符合的）"><a href="#“-”-：0次或1次，match-search-不会出现none，会出现’-‘-（因为0次也是符合的）" class="headerlink" title="“?” ：0次或1次，match,search 不会出现none，会出现’ ‘ （因为0次也是符合的）"></a>“?” ：0次或1次，match,search 不会出现none，会出现’ ‘ （因为0次也是符合的）</h4><p>0次或1次不是指<code>[xxx]</code>这个集合，而是其中的任何的一个字符</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;[abc]?&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;defabc&#x27;</span>).group()     <span class="comment">#0次</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;abcdefabc&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;defabc&#x27;</span>).group()    <span class="comment">#0次</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;defabc&#x27;</span>)           <span class="comment">#0次和1次</span></span><br><span class="line">[<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;&#x27;</span>]     <span class="comment">#后面总再加个&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="“数量词-”-：非贪婪模式：只匹配最少的（尽可能少）；默认贪婪模式：匹配最多的（尽可能多）"><a href="#“数量词-”-：非贪婪模式：只匹配最少的（尽可能少）；默认贪婪模式：匹配最多的（尽可能多）" class="headerlink" title="“数量词?” ：非贪婪模式：只匹配最少的（尽可能少）；默认贪婪模式：匹配最多的（尽可能多）"></a>“数量词?” ：非贪婪模式：只匹配最少的（尽可能少）；默认贪婪模式：匹配最多的（尽可能多）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;[abc]+&#x27;</span>)         <span class="comment">#贪婪模式</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;abcdefabcabc&#x27;</span>).group()  <span class="comment">#匹配尽可能多的：abc</span></span><br><span class="line"><span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;bbabcdefabcabc&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;bbabc&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;dbbabcdefabcabc&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;bbabc&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;abcdefabcabc&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;abcabc&#x27;</span>]</span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;[abc]+?&#x27;</span>)        <span class="comment">#非贪婪模式：+?</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;abcdefabcabc&#x27;</span>).group()  <span class="comment">#匹配尽可能少的：a、b、c</span></span><br><span class="line"><span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;dbbabcdefabcabc&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;b&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;abcdefabcabc&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="“-m-”-：匹配字符串出现m次"><a href="#“-m-”-：匹配字符串出现m次" class="headerlink" title="“{m}” ：匹配字符串出现m次"></a>“{m}” ：匹配字符串出现m次</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;[op]&#123;2&#125;&#x27;</span>)     <span class="comment">#o或p出现2次</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;abcooapp&#x27;</span>).group()  <span class="comment">#匹配第一次出现的字符串,o比p先出现</span></span><br><span class="line"><span class="string">&#x27;oo&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;abcooapp&#x27;</span>)         <span class="comment">#匹配出现的所有字符串，列表形式返回</span></span><br><span class="line">[<span class="string">&#x27;oo&#x27;</span>, <span class="string">&#x27;pp&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="“-m-n-”-：匹配字符串出现m到n次"><a href="#“-m-n-”-：匹配字符串出现m到n次" class="headerlink" title="“{m,n}” ：匹配字符串出现m到n次"></a>“{m,n}” ：匹配字符串出现m到n次</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;[op]&#123;2,4&#125;&#x27;</span>)     <span class="comment">#o或则p出现2到4次</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;pppabcooapp&#x27;</span>).group()  <span class="comment">#匹配开头</span></span><br><span class="line"><span class="string">&#x27;ppp&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;pppabcooapp&#x27;</span>).group() <span class="comment">#匹配第一次出现</span></span><br><span class="line"><span class="string">&#x27;ppp&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;pppabcooapp&#x27;</span>)        <span class="comment">#匹配所有</span></span><br><span class="line">[<span class="string">&#x27;ppp&#x27;</span>, <span class="string">&#x27;oo&#x27;</span>, <span class="string">&#x27;pp&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="group-匹配第一次出现"><a href="#group-匹配第一次出现" class="headerlink" title=".group() #匹配第一次出现"></a>.group() #匹配第一次出现</h3><h4 id="边界"><a href="#边界" class="headerlink" title="边界"></a>边界</h4><h4 id="“-”-：匹配字符串开头或行头"><a href="#“-”-：匹配字符串开头或行头" class="headerlink" title="“^” ：匹配字符串开头或行头"></a>“^” ：匹配字符串开头或行头</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;^[abc]&#x27;</span>)     <span class="comment">#开头是a、b、c中的任意一个</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;defabc&#x27;</span>).group()    </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;defabc&#x27;</span>).group()    <span class="comment">#均找不到</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;defabc&#x27;</span>)</span><br><span class="line">[]</span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;adefabc&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;adefabc&#x27;</span>).group()   <span class="comment">#开头是a、b、c中的任意一个</span></span><br><span class="line"><span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;adefabc&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;^[abc]+&#x27;</span>)    <span class="comment">#开头是a、b、c中的任意一个的一次或则多次，贪婪：匹配多个</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;cbadefab&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;cba&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat = re.<span class="built_in">compile</span>(<span class="string">r&#x27;^[abc]+?&#x27;</span>)  <span class="comment">#开头是a、b、c中的任意一个的一次或则多次，非贪婪：匹配一个</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;cbadefab&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;c&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="“-”-：匹配字符串结尾或则行尾"><a href="#“-”-：匹配字符串结尾或则行尾" class="headerlink" title="“$” ：匹配字符串结尾或则行尾"></a>“$” ：匹配字符串结尾或则行尾</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;[abc]$&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;adefAbc&#x27;</span>).group()   <span class="comment">#match匹配的是字符串开头，所以查找$的时，总是返回None</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;adefAbc&#x27;</span>).group()  <span class="comment">#结尾是a、b、c中的任意一个</span></span><br><span class="line"><span class="string">&#x27;c&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;adefAbc&#x27;</span>)        </span><br><span class="line">[<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;[abc]+$&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;adefAbc&#x27;</span>).group()  <span class="comment">#结尾是a、b、c中的任意一个的一次或则多次，贪婪：匹配多个</span></span><br><span class="line"><span class="string">&#x27;bc&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;adefAbc&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;bc&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="“-A”：匹配字符串开头"><a href="#“-A”：匹配字符串开头" class="headerlink" title="“\A”：匹配字符串开头"></a>“\A”：匹配字符串开头</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;\A[abc]+&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;cbadefab&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;cba&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;cbadefab&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;cba&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="“-Z”：匹配字符串结尾"><a href="#“-Z”：匹配字符串结尾" class="headerlink" title="“\Z”：匹配字符串结尾"></a>“\Z”：匹配字符串结尾</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;[abc]+\Z&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;cbadefab&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;ab&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;cbadefab&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;ab&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h3><h4 id="…-：分组匹配-从左到右-每遇到一个-编号-1，分组后面可加数量词"><a href="#…-：分组匹配-从左到右-每遇到一个-编号-1，分组后面可加数量词" class="headerlink" title="(…)：分组匹配,从左到右,每遇到一个 ( 编号+1，分组后面可加数量词"></a>(…)：分组匹配,从左到右,每遇到一个 ( 编号+1，分组后面可加数量词</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">r&#x27;(a)\w(c)&#x27;</span>)  <span class="comment">#\w:单个的数字或字母 [A-Za-z0-9]</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;abcdef&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">&#x27;(a)b(c)&#x27;</span>)    <span class="comment">#分2组，匿名分组</span></span><br><span class="line">                                </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;abcdef&#x27;</span>).group()  <span class="comment">#默认返回匹配的字符串</span></span><br><span class="line"><span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;abcdef&#x27;</span>).group(<span class="number">1</span>) <span class="comment">#取分组1，适用于search</span></span><br><span class="line"><span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;abcdef&#x27;</span>).group(<span class="number">2</span>) <span class="comment">#取分组2，适用于search</span></span><br><span class="line"><span class="string">&#x27;c&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;abcdef&#x27;</span>).groups() <span class="comment">#取所有分组，元组形式返回</span></span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="：引用编号为的分组匹配到的字符串"><a href="#：引用编号为的分组匹配到的字符串" class="headerlink" title="：引用编号为的分组匹配到的字符串"></a><number>：引用编号为<number>的分组匹配到的字符串</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">r&#x27;www\.(.*)\..&#123;3&#125;&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;www.dxy.com&#x27;</span>).group(<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;dxy&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="“-P…-”-：在模式里面用-来表示分组（命名分组）-适用于提取目标字符串中的某一些部位。"><a href="#“-P…-”-：在模式里面用-来表示分组（命名分组）-适用于提取目标字符串中的某一些部位。" class="headerlink" title="“(?P…)” ：在模式里面用()来表示分组（命名分组）,适用于提取目标字符串中的某一些部位。"></a>“(?P<name>…)” ：在模式里面用()来表示分组（命名分组）,适用于提取目标字符串中的某一些部位。</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">r&#x27;(?P&lt;K&gt;a)\w(c)&#x27;</span>)    <span class="comment">#分2组：命名分组+匿名分组</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;abcdef&#x27;</span>).groups()       <span class="comment">#取所有分组，元组形式返回</span></span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;abcdef&#x27;</span>).group(<span class="number">1</span>)       <span class="comment">#取分组1，适用于match</span></span><br><span class="line"><span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;abcdef&#x27;</span>).group(<span class="number">2</span>)       <span class="comment">#取分组2，适用于match</span></span><br><span class="line"><span class="string">&#x27;c&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;abcdef&#x27;</span>).group()        <span class="comment">#默认返回匹配的字符串</span></span><br><span class="line"><span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;abcdef&#x27;</span>).groupdict()    <span class="comment">#命名分组可以返回一个字典【专有】，匿名分组也没有</span></span><br><span class="line">&#123;<span class="string">&#x27;K&#x27;</span>: <span class="string">&#x27;a&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="“-P-name-”：引用别名为的分组匹配到的串"><a href="#“-P-name-”：引用别名为的分组匹配到的串" class="headerlink" title="“(?P=name)”：引用别名为的分组匹配到的串"></a>“(?P=name)”：引用别名为<name>的分组匹配到的串</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">r&#x27;(?P&lt;K&gt;a)\w(c)(?P=K)&#x27;</span>)    <span class="comment">#(?P=K)引用分组1的值，就是a</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;abcdef&#x27;</span>).group()              <span class="comment">#匹配不到，因为完整&#x27;a\wca&#x27;,模式的第4位是a</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: <span class="string">&#x27;NoneType&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;group&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;abcadef&#x27;</span>).group()             <span class="comment">#匹配到，模式的第4位和组1一样,值是c</span></span><br><span class="line"><span class="string">&#x27;abca&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;abcadef&#x27;</span>).groups()</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;abcadef&#x27;</span>).group(<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;abcadef&#x27;</span>).group(<span class="number">2</span>)</span><br><span class="line"><span class="string">&#x27;c</span></span><br></pre></td></tr></table></figure>

<h4 id="“”-：引用分组编号匹配："><a href="#“”-：引用分组编号匹配：" class="headerlink" title="“” ：引用分组编号匹配："></a>“<number>” ：引用分组编号匹配：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">r&#x27;(?P&lt;K&gt;a)\w(c)(?P=K)\2&#x27;</span>)  <span class="comment">#\2引用分组2的值，就是c</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;Aabcadef&#x27;</span>)                   <span class="comment">#匹配不到，因为完整&#x27;a\wcac&#x27;,模式的第5位是c</span></span><br><span class="line">[]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;Aabcacdef&#x27;</span>)                  <span class="comment">#匹配到，模式的第5位和组2一样,值是c</span></span><br><span class="line">[(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;Aabcacdef&#x27;</span>).groups()</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;Aabcacdef&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;abcac&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;Aabcacdef&#x27;</span>).group(<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.search(<span class="string">&#x27;Aabcacdef&#x27;</span>).group(<span class="number">2</span>)</span><br><span class="line"><span class="string">&#x27;c&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="特殊构造"><a href="#特殊构造" class="headerlink" title="特殊构造"></a>特殊构造</h4><ul>
<li><code>(?:…) (…)</code>不分组版本,用于使用 <code>|</code> 或者后接数量词</li>
<li><code>(?iLmsux)</code> iLmsux的每个字符代表一个匹配模式,只能用在正则表达式的开头,可选多个</li>
<li><code>(?#…)</code> #号后的内容将作为注释</li>
<li><code>(?=…)</code> 之后的字符串内容需要匹配表达式才能成功匹配</li>
<li><code>(?!…)</code> 之后的字符串不匹配表达式才能成功</li>
<li><code>(?(?(?(id/name) yes |no)</code> 如果编号为id/名字为name的组匹配到字符串,则需要匹配yes,否则匹配no,no可以省略</li>
</ul>
<h4 id="“-…-”-：-里面有-表示该-不是分组"><a href="#“-…-”-：-里面有-表示该-不是分组" class="headerlink" title="“(?:…)” ：()里面有?:表示该()不是分组"></a>“(?:…)” ：()里面有?:表示该()不是分组</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">r&#x27;a(?:bc)&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;abc&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;abc&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;abc&#x27;</span>).groups()      <span class="comment">#显示不出分组</span></span><br></pre></td></tr></table></figure>

<h4 id="“-…-”：匹配…表达式，返回。对后进行匹配，总是对后面进行匹配"><a href="#“-…-”：匹配…表达式，返回。对后进行匹配，总是对后面进行匹配" class="headerlink" title="“(?=…)”：匹配…表达式，返回。对后进行匹配，总是对后面进行匹配"></a>“(?=…)”：匹配…表达式，返回。对后进行匹配，总是对后面进行匹配</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">r&#x27;\w(?=\d)&#x27;</span>)    <span class="comment">#匹配表达式\d，返回数字的前一位，\w：单词字符[A-Za-z0-9]</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;abc1 def1 xyz1&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;z&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;zhoujy20130628hangzhou&#x27;</span>)  <span class="comment">#匹配数字的前一位，列表返回</span></span><br><span class="line">[<span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;2&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">r&#x27;\w+(?=\d)&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;abc1,def1,xyz1&#x27;</span>)          <span class="comment">#匹配最末数字的前字符串，列表返回</span></span><br><span class="line">[<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;def&#x27;</span>, <span class="string">&#x27;xyz&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;abc21,def31,xyz41&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;abc2&#x27;</span>, <span class="string">&#x27;def3&#x27;</span>, <span class="string">&#x27;xyz4&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;zhoujy20130628hangzhou&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;zhoujy2013062&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">r&#x27;[A-Za-z]+(?=\d)&#x27;</span>)       <span class="comment">#[A-Za-z],匹配字母,可以用其他的正则方法</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;zhoujy20130628hangzhou123&#x27;</span>) <span class="comment">#匹配后面带有数字的字符串，列表返回</span></span><br><span class="line">[<span class="string">&#x27;zhoujy&#x27;</span>, <span class="string">&#x27;hangzhou&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;abc21,def31,xyz41&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;def&#x27;</span>, <span class="string">&#x27;xyz&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="“-…-”-不匹配…表达式，返回。对后进行匹配"><a href="#“-…-”-不匹配…表达式，返回。对后进行匹配" class="headerlink" title="“(?!…)” 不匹配…表达式，返回。对后进行匹配"></a>“(?!…)” 不匹配…表达式，返回。对后进行匹配</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">r&#x27;[A-Za-z]+(?!\d)&#x27;</span>)       <span class="comment">#[A-Za-z],匹配字母,可以用其他的正则方法</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;zhoujy20130628hangzhou123,12,binjiang310&#x27;</span>)  <span class="comment">#匹配后面不是数字的字符串，列表返回</span></span><br><span class="line">[<span class="string">&#x27;zhouj&#x27;</span>, <span class="string">&#x27;hangzho&#x27;</span>, <span class="string">&#x27;binjian&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;abc21,def31,xyz41&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;ab&#x27;</span>, <span class="string">&#x27;de&#x27;</span>, <span class="string">&#x27;xy&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="“-lt-…-”：匹配…表达式，返回。对前进行匹配-总是对前面进行匹配"><a href="#“-lt-…-”：匹配…表达式，返回。对前进行匹配-总是对前面进行匹配" class="headerlink" title="“(?&lt;=…)”：匹配…表达式，返回。对前进行匹配,总是对前面进行匹配"></a>“(?&lt;=…)”：匹配…表达式，返回。对前进行匹配,总是对前面进行匹配</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">r&#x27;(?&lt;=\d)[A-Za-z]+&#x27;</span>)      <span class="comment">#匹配前面是数字的字母</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;abc21,def31,xyz41&#x27;</span>)</span><br><span class="line">[]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;1abc21,2def31,3xyz41&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;def&#x27;</span>, <span class="string">&#x27;xyz&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;zhoujy20130628hangzhou123,12,binjiang310&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;hangzhou&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="“-lt-…-”：不匹配…表达式，返回。对前进行匹配-总是对前面进行匹配"><a href="#“-lt-…-”：不匹配…表达式，返回。对前进行匹配-总是对前面进行匹配" class="headerlink" title="“(?&lt;!…)”：不匹配…表达式，返回。对前进行匹配,总是对前面进行匹配"></a>“(?&lt;!…)”：不匹配…表达式，返回。对前进行匹配,总是对前面进行匹配</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">r&#x27;(?&lt;!\d)[A-Za-z]+&#x27;</span>)      <span class="comment">#匹配前面不是数字的字母</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;abc21,def31,xyz41&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;def&#x27;</span>, <span class="string">&#x27;xyz&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;zhoujy20130628hangzhou123,12,binjiang310&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;zhoujy&#x27;</span>, <span class="string">&#x27;angzhou&#x27;</span>, <span class="string">&#x27;binjiang&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="“-id-name-yes-no-”-组是否匹配，匹配返回"><a href="#“-id-name-yes-no-”-组是否匹配，匹配返回" class="headerlink" title="“(?(id/name) yes |no)”: 组是否匹配，匹配返回"></a>“(?(id/name) yes |no)”: 组是否匹配，匹配返回</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">r&#x27;a(\d)?bc(?(1)\d)&#x27;</span>)   <span class="comment">#no省略了，完整的是a\dbc\d ==&gt; a2bc3,总共5位，第2位是可有可无的数字，第5为是数字</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;abc9&#x27;</span>)                   <span class="comment">#返回组1，但第2位（组1）没有，即返回了&#x27;&#x27;</span></span><br><span class="line">[<span class="string">&#x27;&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;a8bc9&#x27;</span>)                  <span class="comment">#完整的模式，返回组1</span></span><br><span class="line">[<span class="string">&#x27;8&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;a8bc9&#x27;</span>).group()</span><br><span class="line"><span class="string">&#x27;a8bc9&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.match(<span class="string">&#x27;a8bc9&#x27;</span>).group(<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;8&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;a8bc&#x27;</span>)                   <span class="comment">#第5位不存在，则没有匹配到</span></span><br><span class="line">[]</span><br></pre></td></tr></table></figure>

<h4 id="“-iLmsux-”-这里就介绍下i参数：大小写区分匹配"><a href="#“-iLmsux-”-这里就介绍下i参数：大小写区分匹配" class="headerlink" title="“(?iLmsux)”:这里就介绍下i参数：大小写区分匹配"></a>“(?iLmsux)”:这里就介绍下i参数：大小写区分匹配</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">r&#x27;abc&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;abc&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;abc&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;ABC&#x27;</span>)</span><br><span class="line">[]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">r&#x27;(?i)abc&#x27;</span>)            <span class="comment">#(?i) 不区分大小写</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;ABC&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;ABC&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;abc&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;abc&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;aBc&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;aBc&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;aBC&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;aBC&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat=re.<span class="built_in">compile</span>(<span class="string">r&#x27;abc&#x27;</span>,re.I)           <span class="comment">#re.I 作为参数使用，推荐</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;aBC&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;aBC&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;abc&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;abc&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pat.findall(<span class="string">&#x27;ABC&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;ABC&#x27;</span>]</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lyvivian</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
