<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"lyvivian0077.github.io","root":"/","images":"/images","scheme":"Gemini","version":"8.5.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta name="description" content="Mysql参数优化对于新手来讲，是比较难懂的东西，其实这个参数优化，是个很复杂的东西，对于不同的网站，及其在线量，访问量，帖子数量，网络情况，以及机器硬件配置都有关系，优化不可能一次性完成，需要不断的观察以及调试，才有可能得到最佳效果。 123456789101112131415161718192021222324252627282930313233343536373839404142434445">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL">
<meta property="og:url" content="https://lyvivian0077.github.io/2017/09/13/mysql/index.html">
<meta property="og:site_name" content="总有刁民想要害朕">
<meta property="og:description" content="Mysql参数优化对于新手来讲，是比较难懂的东西，其实这个参数优化，是个很复杂的东西，对于不同的网站，及其在线量，访问量，帖子数量，网络情况，以及机器硬件配置都有关系，优化不可能一次性完成，需要不断的观察以及调试，才有可能得到最佳效果。 123456789101112131415161718192021222324252627282930313233343536373839404142434445">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2017-09-13T06:17:10.000Z">
<meta property="article:modified_time" content="2021-06-22T03:58:45.700Z">
<meta property="article:author" content="lyvivian">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://lyvivian0077.github.io/2017/09/13/mysql/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://lyvivian0077.github.io/2017/09/13/mysql/","path":"2017/09/13/mysql/","title":"MySQL"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>MySQL | 总有刁民想要害朕</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">总有刁民想要害朕</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#Mysql%E5%8F%82%E6%95%B0%E4%BC%98%E5%8C%96%E5%AF%B9%E4%BA%8E%E6%96%B0%E6%89%8B%E6%9D%A5%E8%AE%B2%EF%BC%8C%E6%98%AF%E6%AF%94%E8%BE%83%E9%9A%BE%E6%87%82%E7%9A%84%E4%B8%9C%E8%A5%BF%EF%BC%8C%E5%85%B6%E5%AE%9E%E8%BF%99%E4%B8%AA%E5%8F%82%E6%95%B0%E4%BC%98%E5%8C%96%EF%BC%8C%E6%98%AF%E4%B8%AA%E5%BE%88%E5%A4%8D%E6%9D%82%E7%9A%84%E4%B8%9C%E8%A5%BF%EF%BC%8C"><span class="nav-number">1.</span> <span class="nav-text">Mysql参数优化对于新手来讲，是比较难懂的东西，其实这个参数优化，是个很复杂的东西，</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#innodb-flush-log-at-trx-commit"><span class="nav-number"></span> <span class="nav-text">innodb_flush_log_at_trx_commit</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#innodb-buffer-pool-size"><span class="nav-number">1.</span> <span class="nav-text">innodb_buffer_pool_size</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#innodb-additional-pool-size"><span class="nav-number">2.</span> <span class="nav-text">innodb_additional_pool_size</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#innodb-log-file-size"><span class="nav-number">3.</span> <span class="nav-text">innodb_log_file_size</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#innodb-log-buffer-size"><span class="nav-number">4.</span> <span class="nav-text">innodb_log_buffer_size</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#innodb-flush-log-at-trx-commit-%EF%BC%88%E8%BF%99%E4%B8%AA%E5%BE%88%E7%AE%A1%E7%94%A8%EF%BC%89"><span class="nav-number">5.</span> <span class="nav-text">innodb_flush_log_at_trx_commit  （这个很管用）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#innodb-flush-log-at-trx-commit-1"><span class="nav-number">6.</span> <span class="nav-text">innodb_flush_log_at_trx_commit</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#my-cnf-%E6%9C%80%E7%B5%82%E5%BD%A2%E6%85%8B"><span class="nav-number"></span> <span class="nav-text">my.cnf 最終形態</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%B0%E5%9C%A8%E7%9A%84%E8%AE%BE%E7%BD%AE"><span class="nav-number"></span> <span class="nav-text">现在的设置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83"><span class="nav-number"></span> <span class="nav-text">生产环境</span></a></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">lyvivian</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">categories</span>
      </div>
  </nav>
</div>



          </div>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://lyvivian0077.github.io/2017/09/13/mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lyvivian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="总有刁民想要害朕">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MySQL
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-09-13 15:17:10" itemprop="dateCreated datePublished" datetime="2017-09-13T15:17:10+09:00">2017-09-13</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-06-22 12:58:45" itemprop="dateModified" datetime="2021-06-22T12:58:45+09:00">2021-06-22</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/main/" itemprop="url" rel="index"><span itemprop="name">main</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h4 id="Mysql参数优化对于新手来讲，是比较难懂的东西，其实这个参数优化，是个很复杂的东西，"><a href="#Mysql参数优化对于新手来讲，是比较难懂的东西，其实这个参数优化，是个很复杂的东西，" class="headerlink" title="Mysql参数优化对于新手来讲，是比较难懂的东西，其实这个参数优化，是个很复杂的东西，"></a>Mysql参数优化对于新手来讲，是比较难懂的东西，其实这个参数优化，是个很复杂的东西，</h4><p>对于不同的网站，及其在线量，访问量，帖子数量，网络情况，以及机器硬件配置都有关系，优化不可能一次性完成，需要不断的观察以及调试，才有可能得到最佳效果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line">[mysqld]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line">basedir = /usr/local/mysql</span><br><span class="line">datadir = /data/mysql</span><br><span class="line">pid-file = /data/mysql/mysql.pid</span><br><span class="line">user = mysql</span><br><span class="line">bind-address = 0.0.0.0</span><br><span class="line">server-id = 1 #表示是本机的序号为1,一般来讲就是master的意思</span><br><span class="line">skip-name-resolve</span><br><span class="line"># 禁止MySQL对外部连接进行DNS解析，使用这一选项可以消除MySQL进行DNS解析的时间。但需要注意，如果开启该选项，</span><br><span class="line"># 则所有远程主机连接授权都要使用IP地址方式，否则MySQL将无法正常处理连接请求</span><br><span class="line">#skip-networking</span><br><span class="line">back_log = 600</span><br><span class="line"># MySQL能有的连接数量。当主要MySQL线程在一个很短时间内得到非常多的连接请求，这就起作用，</span><br><span class="line"># 然后主线程花些时间(尽管很短)检查连接并且启动一个新线程。back_log值指出在MySQL暂时停止回答新请求之前的短时间内多少个请求可以被存在堆栈中。</span><br><span class="line"># 如果期望在一个短时间内有很多连接，你需要增加它。也就是说，如果MySQL的连接数据达到max_connections时，新来的请求将会被存在堆栈中，</span><br><span class="line"># 以等待某一连接释放资源，该堆栈的数量即back_log，如果等待连接的数量超过back_log，将不被授予连接资源。</span><br><span class="line"># 另外，这值（back_log）限于您的操作系统对到来的TCP/IP连接的侦听队列的大小。</span><br><span class="line"># 你的操作系统在这个队列大小上有它自己的限制（可以检查你的OS文档找出这个变量的最大值），试图设定back_log高于你的操作系统的限制将是无效的。</span><br><span class="line"></span><br><span class="line">max_connections = 1000</span><br><span class="line"># MySQL的最大连接数，如果服务器的并发连接请求量比较大，建议调高此值，以增加并行连接数量，</span><br><span class="line"># 当然这建立在机器能支撑的情况下，因为如果连接数越多，介于MySQL会为每个连接提供连接缓冲区，</span><br><span class="line"># 就会开销越多的内存，所以要适当调整该值，不能盲目提高设值。可以过&#x27;conn%&#x27;通配符查看当前状态的连接数量，以定夺该值的大小。</span><br><span class="line"></span><br><span class="line">max_connect_errors = 6000</span><br><span class="line"># 对于同一主机，如果有超出该参数值个数的中断错误连接，则该主机将被禁止连接。如需对该主机进行解禁，执行：FLUSH HOST。</span><br><span class="line"></span><br><span class="line">open_files_limit = 65535</span><br><span class="line"># MySQL打开的文件描述符限制，默认最小1024;当open_files_limit没有被配置的时候，比较max_connections*5和ulimit -n的值，哪个大用哪个，</span><br><span class="line"># 当open_file_limit被配置的时候，比较open_files_limit和max_connections*5的值，哪个大用哪个。</span><br><span class="line"></span><br><span class="line">table_open_cache = 128</span><br><span class="line"># MySQL每打开一个表，都会读入一些数据到table_open_cache缓存中，当MySQL在这个缓存中找不到相应信息时，才会去磁盘上读取。默认值64</span><br><span class="line"># 假定系统有200个并发连接，则需将此参数设置为200*N(N为每个连接所需的文件描述符数目)；</span><br><span class="line"># 当把table_open_cache设置为很大时，如果系统处理不了那么多文件描述符，那么就会出现客户端失效，连接不上</span><br><span class="line"></span><br><span class="line">max_allowed_packet = 4M</span><br><span class="line"># 接受的数据包大小；增加该变量的值十分安全，这是因为仅当需要时才会分配额外内存。</span><br><span class="line"># 例如，仅当你发出长查询或MySQLd必须返回大的结果行时MySQLd才会分配更多内存。</span><br><span class="line"># 该变量之所以取较小默认值是一种预防措施，以捕获客户端和服务器之间的错误信息包，并确保不会因偶然使用大的信息包而导致内存溢出。</span><br><span class="line"></span><br><span class="line">binlog_cache_size = 1M</span><br><span class="line"># 一个事务，在没有提交的时候，产生的日志，记录到Cache中；等到事务提交需要提交的时候，则把日志持久化到磁盘。默认binlog_cache_size大小32K</span><br><span class="line"></span><br><span class="line">max_heap_table_size = 8M</span><br><span class="line"># 定义了用户可以创建的内存表(memory table)的大小。这个值用来计算内存表的最大行数值。这个变量支持动态改变</span><br><span class="line"></span><br><span class="line">tmp_table_size = 16M</span><br><span class="line"># MySQL的heap（堆积）表缓冲大小。所有联合在一个DML指令内完成，并且大多数联合甚至可以不用临时表即可以完成。</span><br><span class="line"># 大多数临时表是基于内存的(HEAP)表。具有大的记录长度的临时表 (所有列的长度的和)或包含BLOB列的表存储在硬盘上。</span><br><span class="line"># 如果某个内部heap（堆积）表大小超过tmp_table_size，MySQL可以根据需要自动将内存中的heap表改为基于硬盘的MyISAM表。</span><br><span class="line"># 还可以通过设置tmp_table_size选项来增加临时表的大小。也就是说，如果调高该值，MySQL同时将增加heap表的大小，可达到提高联接查询速度的效果</span><br><span class="line"></span><br><span class="line">read_buffer_size = 2M</span><br><span class="line"># MySQL读入缓冲区大小。对表进行顺序扫描的请求将分配一个读入缓冲区，MySQL会为它分配一段内存缓冲区。</span><br><span class="line"># read_buffer_size变量控制这一缓冲区的大小。</span><br><span class="line"># 如果对表的顺序扫描请求非常频繁，并且你认为频繁扫描进行得太慢，可以通过增加该变量值以及内存缓冲区大小提高其性能</span><br><span class="line"></span><br><span class="line">read_rnd_buffer_size = 8M</span><br><span class="line"># MySQL的随机读缓冲区大小。当按任意顺序读取行时(例如，按照排序顺序)，将分配一个随机读缓存区。进行排序查询时，</span><br><span class="line"># MySQL会首先扫描一遍该缓冲，以避免磁盘搜索，提高查询速度，如果需要排序大量数据，</span><br><span class="line"># 可适当调高该值。但MySQL会为每个客户连接发放该缓冲空间，所以应尽量适当设置该值，以避免内存开销过大</span><br><span class="line"></span><br><span class="line">sort_buffer_size = 8M</span><br><span class="line"># MySQL执行排序使用的缓冲大小。如果想要增加ORDER BY的速度，首先看是否可以让MySQL使用索引而不是额外的排序阶段。</span><br><span class="line"># 如果不能，可以尝试增加sort_buffer_size变量的大小</span><br><span class="line"></span><br><span class="line">join_buffer_size = 8M</span><br><span class="line"># 联合查询操作所能使用的缓冲区大小，和sort_buffer_size一样，该参数对应的分配内存也是每连接独享</span><br><span class="line"></span><br><span class="line">thread_cache_size = 8</span><br><span class="line"># 这个值（默认8）表示可以重新利用保存在缓存中线程的数量，当断开连接时如果缓存中还有空间，那么客户端的线程将被放到缓存中，</span><br><span class="line"># 如果线程重新被请求，那么请求将从缓存中读取,如果缓存中是空的或者是新的请求，那么这个线程将被重新创建,如果有很多新的线程，</span><br><span class="line"># 增加这个值可以改善系统性能.通过比较Connections和Threads_created状态的变量，可以看到这个变量的作用。(–&gt;表示要调整的值)</span><br><span class="line"># 根据物理内存设置规则如下：</span><br><span class="line"># 1G - &gt; 8</span><br><span class="line"># 2G - &gt; 16</span><br><span class="line"># 3G - &gt; 32</span><br><span class="line"># 大于3G - &gt; 64</span><br><span class="line"></span><br><span class="line">query_cache_size = 8M</span><br><span class="line"># MySQL的查询缓冲大小（从4.0.1开始，MySQL提供了查询缓冲机制）使用查询缓冲，MySQL将SELECT语句和查询结果存放在缓冲区中，</span><br><span class="line"># 今后对于同样的SELECT语句（区分大小写），将直接从缓冲区中读取结果。根据MySQL用户手册，使用查询缓冲最多可以达到238%的效率。</span><br><span class="line"># 通过检查状态值&#x27;Qcache_%&#x27;，可以知道query_cache_size设置是否合理：如果Qcache_lowmem_prunes的值非常大，则表明经常出现缓冲不够的情况，</span><br><span class="line"># 如果Qcache_hits的值也非常大，则表明查询缓冲使用非常频繁，此时需要增加缓冲大小；如果Qcache_hits的值不大，则表明你的查询重复率很低，</span><br><span class="line"># 这种情况下使用查询缓冲反而会影响效率，那么可以考虑不用查询缓冲。此外，在SELECT语句中加入SQL_NO_CACHE可以明确表示不使用查询缓冲</span><br><span class="line"></span><br><span class="line">query_cache_limit = 2M</span><br><span class="line">#指定单个查询能够使用的缓冲区大小，默认1M</span><br><span class="line"></span><br><span class="line">key_buffer_size = 4M</span><br><span class="line"># 指定用于索引的缓冲区大小，增加它可得到更好处理的索引(对所有读和多重写)，到你能负担得起那样多。如果你使它太大，</span><br><span class="line"># 系统将开始换页并且真的变慢了。对于内存在4GB左右的服务器该参数可设置为384M或512M。通过检查状态值Key_read_requests和Key_reads，</span><br><span class="line"># 可以知道key_buffer_size设置是否合理。比例key_reads/key_read_requests应该尽可能的低，</span><br><span class="line"># 至少是1:100，1:1000更好(上述状态值可以使用SHOW STATUS LIKE &#x27;key_read%&#x27;获得)。注意：该参数值设置的过大反而会是服务器整体效率降低</span><br><span class="line"></span><br><span class="line">ft_min_word_len = 4</span><br><span class="line"># 分词词汇最小长度，默认4</span><br><span class="line"></span><br><span class="line">transaction_isolation = REPEATABLE-READ</span><br><span class="line"># MySQL支持4种事务隔离级别，他们分别是：</span><br><span class="line"># READ-UNCOMMITTED, READ-COMMITTED, REPEATABLE-READ, SERIALIZABLE.</span><br><span class="line"># 如没有指定，MySQL默认采用的是REPEATABLE-READ，ORACLE默认的是READ-COMMITTED</span><br><span class="line"></span><br><span class="line">log_bin = mysql-bin</span><br><span class="line">binlog_format = mixed</span><br><span class="line">expire_logs_days = 30 #超过30天的binlog删除</span><br><span class="line">log_error = /data/mysql/mysql-error.log #错误日志路径</span><br><span class="line">slow_query_log = 1</span><br><span class="line">long_query_time = 1 #慢查询时间 超过1秒则为慢查询</span><br><span class="line">slow_query_log_file = /data/mysql/mysql-slow.log</span><br><span class="line">performance_schema = 0</span><br><span class="line">explicit_defaults_for_timestamp</span><br><span class="line">#lower_case_table_names = 1 #不区分大小写</span><br><span class="line">skip-external-locking #MySQL选项以避免外部锁定。该选项默认开启</span><br><span class="line">default-storage-engine = InnoDB #默认存储引擎</span><br><span class="line"></span><br><span class="line">innodb_file_per_table = 1</span><br><span class="line"># InnoDB为独立表空间模式，每个数据库的每个表都会生成一个数据空间</span><br><span class="line"># 独立表空间优点：</span><br><span class="line"># 1．每个表都有自已独立的表空间。</span><br><span class="line"># 2．每个表的数据和索引都会存在自已的表空间中。</span><br><span class="line"># 3．可以实现单表在不同的数据库中移动。</span><br><span class="line"># 4．空间可以回收（除drop table操作处，表空不能自已回收）</span><br><span class="line"># 缺点：</span><br><span class="line"># 单表增加过大，如超过100G</span><br><span class="line"># 结论：</span><br><span class="line"># 共享表空间在Insert操作上少有优势。其它都没独立表空间表现好。当启用独立表空间时，请合理调整：innodb_open_files</span><br><span class="line"></span><br><span class="line">innodb_open_files = 500</span><br><span class="line"># 限制Innodb能打开的表的数据，如果库里的表特别多的情况，请增加这个。这个值默认是300</span><br><span class="line"></span><br><span class="line">innodb_buffer_pool_size = 64M</span><br><span class="line"># InnoDB使用一个缓冲池来保存索引和原始数据, 不像MyISAM.</span><br><span class="line"># 这里你设置越大,你在存取表里面数据时所需要的磁盘I/O越少.</span><br><span class="line"># 在一个独立使用的数据库服务器上,你可以设置这个变量到服务器物理内存大小的80%</span><br><span class="line"># 不要设置过大,否则,由于物理内存的竞争可能导致操作系统的换页颠簸.</span><br><span class="line"># 注意在32位系统上你每个进程可能被限制在 2-3.5G 用户层面内存限制,</span><br><span class="line"># 所以不要设置的太高.</span><br><span class="line"></span><br><span class="line">innodb_write_io_threads = 4</span><br><span class="line">innodb_read_io_threads = 4</span><br><span class="line"># innodb使用后台线程处理数据页上的读写 I/O(输入输出)请求,根据你的 CPU 核数来更改,默认是4</span><br><span class="line"># 注:这两个参数不支持动态改变,需要把该参数加入到my.cnf里，修改完后重启MySQL服务,允许值的范围从 1-64</span><br><span class="line"></span><br><span class="line">innodb_thread_concurrency = 0</span><br><span class="line"># 默认设置为 0,表示不限制并发数，这里推荐设置为0，更好去发挥CPU多核处理能力，提高并发量</span><br><span class="line"></span><br><span class="line">innodb_purge_threads = 1</span><br><span class="line"># InnoDB中的清除操作是一类定期回收无用数据的操作。在之前的几个版本中，</span><br><span class="line"># 清除操作是主线程的一部分，这意味着运行时它可能会堵塞其它的数据库操作。</span><br><span class="line"># 从MySQL5.5.X版本开始，该操作运行于独立的线程中,并支持更多的并发数。用户可通过设置innodb_purge_threads配置参数来选择清除操作是否使用单</span><br><span class="line"># 独线程,默认情况下参数设置为0(不使用单独线程),设置为 1 时表示使用单独的清除线程。建议为1</span><br><span class="line"></span><br><span class="line">innodb_flush_log_at_trx_commit = 2</span><br><span class="line"># 0：如果innodb_flush_log_at_trx_commit的值为0,</span><br><span class="line">#    log buffer每秒就会被刷写日志文件到磁盘，提交事务的时候不做任何操作（执行是由mysql的master thread线程来执行的。</span><br><span class="line">#    主线程中每秒会将重做日志缓冲写入磁盘的重做日志文件(REDO LOG)中。不论事务是否已经提交）默认的日志文件是ib_logfile0,ib_logfile1</span><br><span class="line"># 1：当设为默认值1的时候，每次提交事务的时候，都会将log buffer刷写到日志。</span><br><span class="line"># 2：如果设为2,每次提交事务都会写日志，但并不会执行刷的操作。每秒定时会刷到日志文件。</span><br><span class="line">#    要注意的是，并不能保证100%每秒一定都会刷到磁盘，这要取决于进程的调度。</span><br><span class="line">#    每次事务提交的时候将数据写入事务日志，而这里的写入仅是调用了文件系统的写入操作，</span><br><span class="line">#    而文件系统是有 缓存的，所以这个写入并不能保证数据已经写入到物理磁盘</span><br><span class="line"># 默认值1是为了保证完整的ACID。当然，你可以将这个配置项设为1以外的值来换取更高的性能，但是在系统崩溃的时候，你将会丢失1秒的数据。</span><br><span class="line"># 设为0的话，mysqld进程崩溃的时候，就会丢失最后1秒的事务。</span><br><span class="line"># 设为2,只有在操作系统崩溃或者断电的时候才会丢失最后1秒的数据。InnoDB在做恢复的时候会忽略这个值。</span><br><span class="line">### 总结 ###</span><br><span class="line"># 设为1当然是最安全的，但性能页是最差的（相对其他两个参数而言，但不是不能接受）。</span><br><span class="line"># 如果对数据一致性和完整性要求不高，完全可以设为2，如果只最求性能，例如高并发写的日志服务器，设为0来获得更高性能</span><br><span class="line"></span><br><span class="line">innodb_log_buffer_size = 2M</span><br><span class="line"># 此参数确定些日志文件所用的内存大小，以M为单位。缓冲区更大能提高性能，但意外的故障将会丢失数据。MySQL开发人员建议设置为1－8M之间</span><br><span class="line"></span><br><span class="line">innodb_log_file_size = 32M</span><br><span class="line"># 此参数确定数据日志文件的大小，更大的设置可以提高性能，但也会增加恢复故障数据库所需的时间</span><br><span class="line"></span><br><span class="line">innodb_log_files_in_group = 3</span><br><span class="line"># 为提高性能，MySQL可以以循环方式将日志文件写到多个文件。推荐设置为3</span><br><span class="line"></span><br><span class="line">innodb_max_dirty_pages_pct = 90</span><br><span class="line"># innodb主线程刷新缓存池中的数据，使脏数据比例小于90%</span><br><span class="line"></span><br><span class="line">innodb_lock_wait_timeout = 120 </span><br><span class="line"># InnoDB事务在被回滚之前可以等待一个锁定的超时秒数。</span><br><span class="line"># InnoDB在它自己的锁定表中自动检测事务死锁并且回滚事务。InnoDB用LOCK TABLES语句注意到锁定设置。默认值是50秒</span><br><span class="line"></span><br><span class="line">bulk_insert_buffer_size = 8M</span><br><span class="line"># 批量插入缓存大小， 这个参数是针对MyISAM存储引擎来说的。</span><br><span class="line"># 适用于在一次性插入100-1000+条记录时， 提高效率。默认值是8M。可以针对数据量的大小，翻倍增加。</span><br><span class="line"></span><br><span class="line">myisam_sort_buffer_size = 8M</span><br><span class="line"># MyISAM设置恢复表之时使用的缓冲区的尺寸，当在REPAIR TABLE或用CREATE INDEX创建索引或ALTER TABLE过程中排序 MyISAM索引分配的缓冲区</span><br><span class="line"></span><br><span class="line">myisam_max_sort_file_size = 10G</span><br><span class="line"># 如果临时文件会变得超过索引，不要使用快速排序索引方法来创建一个索引。注释：这个参数以字节的形式给出</span><br><span class="line"></span><br><span class="line">myisam_repair_threads = 1</span><br><span class="line"># 如果该值大于1，在Repair by sorting过程中并行创建MyISAM表索引(每个索引在自己的线程内) </span><br><span class="line"></span><br><span class="line">interactive_timeout = 28800</span><br><span class="line"># 服务器关闭交互式连接前等待活动的秒数。交互式客户端定义为在</span><br><span class="line"># mysql_real_connect()中使用CLIENT_INTERACTIVE选项的客户端。默认值：28800秒（8小时）</span><br><span class="line"></span><br><span class="line">wait_timeout = 28800</span><br><span class="line"># 服务器关闭非交互连接之前等待活动的秒数。在线程启动时，根据全局wait_timeout值或全局interactive_timeout值初始化会话wait_timeout值，</span><br><span class="line"># 取决于客户端类型(由mysql_real_connect()的连接选项CLIENT_INTERACTIVE定义)。参数默认值：28800秒（8小时）</span><br><span class="line"># MySQL服务器所支持的最大连接数是有上限的，因为每个连接的建立都会消耗内存，因此我们希望客户端在连接到MySQL Server处理完相应的操作后，</span><br><span class="line"># 应该断开连接并释放占用的内存。如果你的MySQL Server有大量的闲置连接，他们不仅会白白消耗内存，而且如果连接一直在累加而不断开，</span><br><span class="line"># 最终肯定会达到MySQL Server的连接上限数，这会报&#x27;too many connections&#x27;的错误。对于wait_timeout的值设定，应该根据系统的运行情况来判断。</span><br><span class="line"># 在系统运行一段时间后，可以通过show processlist命令查看当前系统的连接状态，如果发现有大量的sleep状态的连接进程，则说明该参数设置的过大，</span><br><span class="line"># 可以进行适当的调整小些。要同时设置interactive_timeout和wait_timeout才会生效。</span><br><span class="line">[mysqldump]</span><br><span class="line">quick</span><br><span class="line">max_allowed_packet = 16M #服务器发送和接受的最大包长度</span><br><span class="line">[myisamchk]</span><br><span class="line">key_buffer_size = 8M</span><br><span class="line">sort_buffer_size = 8M</span><br><span class="line">read_buffer = 4M</span><br><span class="line">write_buffer = 4M</span><br></pre></td></tr></table></figure>

<h2 id="innodb-flush-log-at-trx-commit"><a href="#innodb-flush-log-at-trx-commit" class="headerlink" title="innodb_flush_log_at_trx_commit"></a>innodb_flush_log_at_trx_commit</h2><h4 id="innodb-buffer-pool-size"><a href="#innodb-buffer-pool-size" class="headerlink" title="innodb_buffer_pool_size"></a>innodb_buffer_pool_size</h4><p>如 果用Innodb，那么这是一个重要变量。相对于MyISAM来说，Innodb对于buffer size更敏感。MySIAM可能对于大数据量使用默认的key_buffer_size也还好，但Innodb在大数据量时用默认值就感觉在爬了。 Innodb的缓冲池会缓存数据和索引，所以不需要给系统的缓存留空间，如果只用Innodb，可以把这个值设为内存的70%-80%。和 key_buffer相同，如果数据量比较小也不怎么增加，那么不要把这个值设太高也可以提高内存的使用率。</p>
<h4 id="innodb-additional-pool-size"><a href="#innodb-additional-pool-size" class="headerlink" title="innodb_additional_pool_size"></a>innodb_additional_pool_size</h4><p>这个的效果不是很明显，至少是当操作系统能合理分配内存时。但你可能仍需要设成20M或更多一点以看Innodb会分配多少内存做其他用途。</p>
<h4 id="innodb-log-file-size"><a href="#innodb-log-file-size" class="headerlink" title="innodb_log_file_size"></a>innodb_log_file_size</h4><p>对于写很多尤其是大数据量时非常重要。要注意，大的文件提供更高的性能，但数据库恢复时会用更多的时间。我一般用64M-512M，具体取决于服务器的空间。</p>
<h4 id="innodb-log-buffer-size"><a href="#innodb-log-buffer-size" class="headerlink" title="innodb_log_buffer_size"></a>innodb_log_buffer_size</h4><p>默认值对于多数中等写操作和事务短的运用都是可以的。如 果经常做更新或者使用了很多blob数据，应该增大这个值。但太大了也是浪费内存，因为1秒钟总会 flush（这个词的中文怎么说呢？）一次，所以不需要设到超过1秒的需求。8M-16M一般应该够了。小的运用可以设更小一点。</p>
<h4 id="innodb-flush-log-at-trx-commit-（这个很管用）"><a href="#innodb-flush-log-at-trx-commit-（这个很管用）" class="headerlink" title="innodb_flush_log_at_trx_commit  （这个很管用）"></a>innodb_flush_log_at_trx_commit  （这个很管用）</h4><p>抱怨Innodb比MyISAM慢 100倍？那么你大概是忘了调整这个值。默认值1的意思是每一次事务提交或事务外的指令都需要把日志写入（flush）硬盘，这是很费时的。特别是使用电 池供电缓存（Battery backed up cache）时。设成2对于很多运用，特别是从MyISAM表转过来的是可以的，它的意思是不写入硬盘而是写入系统缓存。日志仍然会每秒flush到硬 盘，所以你一般不会丢失超过1-2秒的更新。设成0会更快一点，但安全方面比较差，即使MySQL挂了也可能会丢失事务的数据。而值2只会在整个操作系统 挂了时才可能丢数据。 </p>
<h4 id="innodb-flush-log-at-trx-commit-1"><a href="#innodb-flush-log-at-trx-commit-1" class="headerlink" title="innodb_flush_log_at_trx_commit"></a>innodb_flush_log_at_trx_commit</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">If the value of innodb_flush_log_at_trx_commit is 0, the log buffer is written out to the log file once per second and the flush to disk operation is performed on the log file, but nothing is done at a transaction commit. When the value is 1, the log buffer is written out to the log file at each transaction commit and the flush to disk operation is performed on the log file. When the value is 2, the log buffer is written out to the file at each commit, but the flush to disk operation is not performed on it. However, the flushing on the log file takes place once per second also when the value is 2. Note that the once-per-second flushing is not 100% guaranteed to happen every second, due to process scheduling issues.</span><br><span class="line"></span><br><span class="line">The default value of this variable is 1 (prior to MySQL 4.0.13, the default is 0).</span><br><span class="line"></span><br><span class="line">A value of 1 is required for ACID compliance. You can achieve better performance by setting the value different from 1, but then you can lose at most one second worth of transactions in a crash. With a value of 0, any mysqldprocess crash can erase the last second of transactions. With a value of 2, then only an operating system crash or a power outage can erase the last second of transactions. However, InnoDB&#x27;s crash recovery is not affected and thus crash recovery does work regardless of the value.</span><br><span class="line">Note</span><br><span class="line"></span><br><span class="line">For the greatest possible durability and consistency in a replication setup using InnoDB with transactions, use innodb_flush_log_at_trx_commit=1, sync_binlog=1, and innodb-safe-binlog in your master server my.cnf file.</span><br><span class="line">Caution</span><br><span class="line"></span><br><span class="line">Many operating systems and some disk hardware fool the flush-to-disk operation. They may tellmysqld that the flush has taken place, even though it has not. Then the durability of transactions is not guaranteed even with the setting 1, and in the worst case a power outage can even corrupt theInnoDB database. Using a battery-backed disk cache in the SCSI disk controller or in the disk itself speeds up file flushes, and makes the operation safer. You can also try using the Unix commandhdparm to disable the caching of disk writes in hardware caches, or use some other command specific to the hardware vendor.</span><br></pre></td></tr></table></figure>



<h1 id="my-cnf-最終形態"><a href="#my-cnf-最終形態" class="headerlink" title="my.cnf 最終形態"></a>my.cnf 最終形態</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">user=mysql</span><br><span class="line">datadir=/home/mysql</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">tmpdir=/home/tmp</span><br><span class="line">slow_query_log=1</span><br><span class="line"># slow query 機能をONにする</span><br><span class="line">long_query_time=10</span><br><span class="line"># slow query 時間を10秒に設定</span><br><span class="line">slow_query_log_file=/var/log/mysql/slow_query.log</span><br><span class="line">log-error=/var/log/mysql/error.log</span><br><span class="line">log_output=FILE</span><br><span class="line"># log形式をfile式に設定</span><br><span class="line"></span><br><span class="line">#myisam</span><br><span class="line">myisam_sort_buffer_size=128M</span><br><span class="line"># MyISAMで以下の時のインデックスのソートに使われるメモリ上の領域です。 </span><br><span class="line"># REPAIR TABLE、CREATE INDEX、ALTER INDEX。通常のクエリ(DML)では使われないようなので、それほど多くする必要はないでしょう。</span><br><span class="line"></span><br><span class="line">key_buffer_size=512M</span><br><span class="line"># MyISAMのインデックスをキャッシュするメモリ上の領域です。</span><br><span class="line"># 多く割り当てた方がパフォーマンスが向上します。グローバルバッファなのでどかんと割り当てられます。</span><br><span class="line"># もし、MyISAMを(あまり)使ってないのならば、小さくしてほかのパラメータに回すのもアリです。</span><br><span class="line"></span><br><span class="line">sort_buffer_size=2M</span><br><span class="line"># ORDER BYやGROUP BYのときに使われるメモリ上の領域です。</span><br><span class="line"></span><br><span class="line">read_buffer_size=2M</span><br><span class="line"># インデックスを用いないテーブルスキャンのときに使われるメモリ上の領域です。</span><br><span class="line"></span><br><span class="line">read_rnd_buffer_size=2M</span><br><span class="line"># ソート後にレコードを読むときに使われるメモリ上の領域です。</span><br><span class="line"># ディスクI/Oが減るのでORDER BYの性能向上が期待できます。</span><br><span class="line"></span><br><span class="line">#server</span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line">skip-name-resolve</span><br><span class="line"># DNS解決をOFFにする</span><br><span class="line">skip-ssl</span><br><span class="line"># MySQL5.7ではSSL利用しないため、OFFにする</span><br><span class="line"></span><br><span class="line">max_connections=300</span><br><span class="line"># 最大接続数を300にする、サーバのパフォーマンスとネット帯域によるもので、</span><br><span class="line"># 今後サーバリプレースと10G化した後、変更する必要あります。</span><br><span class="line"></span><br><span class="line">max_connect_errors=300</span><br><span class="line"># 連続して接続要求が中断された場合にそれを許可する回数を決定します。</span><br><span class="line"></span><br><span class="line">max_allowed_packet=16M</span><br><span class="line"># MySQL Server およびクライアント間で転送可能なパケット数。</span><br><span class="line"></span><br><span class="line">query_cache_size=512M</span><br><span class="line"># クエリキャッシュ領域。</span><br><span class="line"></span><br><span class="line">query_cache_limit=32M</span><br><span class="line"># キャッシュするクエリ結果の最大サイズ。</span><br><span class="line">query_cache_type=1</span><br><span class="line"># SELECT SQL_NO_CACHE 以外のクエリをキャッシュする</span><br><span class="line"></span><br><span class="line">connect_timeout=30</span><br><span class="line"># connect timeout 時間を30秒に設定</span><br><span class="line"></span><br><span class="line">max_user_connections=30</span><br><span class="line"># 単一アカウントによる同時接続の数</span><br><span class="line"></span><br><span class="line">thread_cache_size=300</span><br><span class="line"># スレッドをコネクションの切断後にもキャッシュしておく数。</span><br><span class="line"># thread_cache_sizeをNに設定すると、N個のアクティブでない接続スレッドをキャッシュできる。</span><br><span class="line"># 関連付けられたクライアント接続が終了すると、接続スレッドはアクティブでなくなる。</span><br><span class="line"></span><br><span class="line">back_log=50</span><br><span class="line"># MySQL で保持できる未処理の接続リクエストの数。</span><br><span class="line"></span><br><span class="line">table_open_cache=19200</span><br><span class="line"># すべてのスレッドについて開いているテーブルの数。</span><br><span class="line"></span><br><span class="line">table_definition_cache=16000</span><br><span class="line"># 定義キャッシュに格納可能な (.frm ファイルからの) テーブル定義の数。</span><br><span class="line"></span><br><span class="line">delayed_insert_timeout=60</span><br><span class="line"># 終了する前に、INSERT DELAYED ハンドラスレッドが INSERT ステートメントを待機する秒数。</span><br><span class="line"></span><br><span class="line">interactive_timeout=300</span><br><span class="line"># サーバーが対話型の接続で、対話型の接続を閉じる前にアクティビティーを待機する秒数。</span><br><span class="line"></span><br><span class="line">wait_timeout=300</span><br><span class="line"># 非インタラクティブな接続を閉じる前に、サーバーがその接続上でアクティビティーを待機する秒数。</span><br><span class="line"></span><br><span class="line">tmp_table_size=256M</span><br><span class="line"># 内部インメモリーの一時テーブルの最大サイズ。</span><br><span class="line"></span><br><span class="line">max_heap_table_size=256M</span><br><span class="line"># ユーザーが作成した MEMORY テーブルの増加が許可される最大サイズを設定します。</span><br><span class="line"># </span><br><span class="line">character-set-server=utf8</span><br><span class="line">collation-server=utf8_general_ci</span><br><span class="line"></span><br><span class="line">#innodb options</span><br><span class="line">innodb_thread_concurrency=32</span><br><span class="line"># InnoDB は、この変数で指定された制限以下の数のオペレーティングシステムスレッドを同時に InnoDB 内部に保持しようと試みます </span><br><span class="line"># スレッド数がこの制限に達すると、それ以降のスレッドは実行されるまで,</span><br><span class="line"># 「先入れ先出し」 (FIFO) キュー内で待機状態になります。ロックを待機しているスレッドは、並列実行中のスレッドの数にカウントされません。</span><br><span class="line"></span><br><span class="line">innodb_buffer_pool_size=48G</span><br><span class="line"># 全体メモリの50%〜60%に設定する。8の倍数。</span><br><span class="line"></span><br><span class="line">innodb_buffer_pool_dump_pct=100</span><br><span class="line">innodb_buffer_pool_dump_at_shutdown=1</span><br><span class="line">innodb_buffer_pool_load_at_startup=0</span><br><span class="line"># http://tech.gmo-media.jp/post/128523146249/innodb-buffer-pool-load-at-startup</span><br><span class="line"></span><br><span class="line">innodb_log_file_size=2G</span><br><span class="line">innodb_log_files_in_group=2</span><br><span class="line"># ロググループ内の各ログファイルのサイズです。通常はinnodb_buffer_pool_sizeの25％が良いと言われてますが、</span><br><span class="line"># 12Gのib_logfileが生成され、クラッシュリカバリ時の速度が遅くなるため、4Gにしました。</span><br><span class="line"># もし、SSDではなく、NVMEであれば、適当な値に変更するべきだろう。</span><br><span class="line"></span><br><span class="line">innodb_log_buffer_size=4M</span><br><span class="line"># ディスク上のログファイルに書き込む際に InnoDB で使用されるバッファーのサイズです。</span><br><span class="line"># ログバッファーを大きくすると、ディスク I/O を節約できますが、障害時ロースするデータも多い、</span><br><span class="line"># 推奨は1〜8Mです。</span><br><span class="line"></span><br><span class="line">innodb_file_per_table</span><br><span class="line"># 新たに作成された各テーブルのデータおよびインデックスがシステムテーブルスペースではなく,</span><br><span class="line"># 個別の .ibd ファイルに格納されます。これらの InnoDB テーブル用のストレージは、テーブルが削除されたり、</span><br><span class="line"># 切り捨てられたりすると再利用されます。5.6.6 以上はデフォルトONです。</span><br><span class="line"></span><br><span class="line">innodb_open_files=9600</span><br><span class="line"># この変数は、複数の InnoDB テーブルスペースを使用する場合にのみ関連します。</span><br><span class="line"># MySQL で一度に開いたままにできる .ibd ファイルの最大数が指定されます。</span><br><span class="line"></span><br><span class="line">innodb_flush_method=O_DIRECT</span><br><span class="line"># InnoDB のデータファイルおよびログファイルにデータをフラッシュする際に使用される方法を定義します。</span><br><span class="line"># これにより、I/O スループットが影響を受ける可能性があります。この変数は、Unix および Linux システムでのみ構成可能です。</span><br><span class="line"># Windows システムでは、フラッシュ方法は常に async_unbuffered であり、変更できません。</span><br><span class="line"></span><br><span class="line"># - fsync: InnoDB は fsync() システムコールを使用して、データファイルとログファイルの両方をフラッシュします。fsync はデフォルト設定です。</span><br><span class="line"># </span><br><span class="line"># - O_DSYNC: InnoDB は、O_SYNC を使用してログファイルを開いてフラッシュし、fsync() を使用してデータファイルをフラッシュします。さまざまな種類の Unix で問題が発生しているため、InnoDB では直接 O_DSYNC が使用されません。</span><br><span class="line"># </span><br><span class="line"># - O_DIRECT: InnoDB は、O_DIRECT (Solaris では directio()) を使用してデータファイルを開き、fsync() を使用してデータファイルとログファイルの両方をフラッシュします。このオプションは、一部の GNU/Linux バージョン、FreeBSD、および Solaris で使用可能です。</span><br><span class="line"># </span><br><span class="line"># - O_DIRECT_NO_FSYNC: InnoDB は、I/O のフラッシュ時に O_DIRECT を使用しますが、後続の fsync() システムコールはスキップします。この設定は、一部のタイプのファイルシステムには適していますが、その他には適していません。たとえば、XFS には適していません。たとえば、使用中のファイルシステムですべてのファイルメタデータを保持するために、fsync() が必要であるのかどうかが不明な場合は、代わりに O_DIRECT を使用してください。このオプションは MySQL 5.6.7 (Bug #11754304、Bug #45892) で導入されました。</span><br><span class="line"></span><br><span class="line">default_password_lifetime=0</span><br><span class="line"># パスワードの有効期限、レンサバと連携しているため、OFFにしました。</span><br><span class="line">#enforce-gtid-consistency=1</span><br><span class="line">#gtid-mode=ON</span><br><span class="line">#safe-user-create=1</span><br><span class="line">#explicit_defaults_for_timestamp=1</span><br><span class="line">log_timestamps=SYSTEM</span><br><span class="line"># ログに出力される時刻変数です、デフォルトはUTCですが、読みにくいため、SYSTEMに変更しました。</span><br><span class="line"></span><br><span class="line">disable-partition-engine-check=1</span><br><span class="line"># https://yoku0825.blogspot.jp/2017/04/mysql-5717-deprecated-partition-engine.html</span><br><span class="line"># MySQL8 の過渡期にあたるMySQL 5.7に追加されたものです、今後MySQL8リリースした場合、</span><br><span class="line"># ユーザがDB移設する時約立つだろう（と思う）、しかし、毎回MySQL起動時にtableとチェックするため、</span><br><span class="line"># 時間かかるため、disableしました。 </span><br><span class="line"></span><br><span class="line">show_compatibility_56=on</span><br><span class="line"># https://yakst.com/ja/posts/2733</span><br><span class="line"></span><br><span class="line">innodb_buffer_pool_instances=8</span><br><span class="line"># InnoDB のバッファープールが分割される領域の数です。CPUコア数に合わせる。</span><br><span class="line"></span><br><span class="line">innodb_rollback_segments=32</span><br><span class="line"># トランザクション内で InnoDB が使用するシステムテーブルスペースにあるロールバックセグメントの数を定義します。</span><br><span class="line"></span><br><span class="line">innodb_write_io_threads=16</span><br><span class="line">innodb_read_io_threads=16</span><br><span class="line"></span><br><span class="line">innodb_io_capacity=2000</span><br><span class="line">innodb_io_capacity_max=5000</span><br><span class="line"># MySQLサーバはSSDのため、io_capacityを2000〜5000に設定する。</span><br><span class="line"></span><br><span class="line">innodb_max_dirty_pages_pct=40</span><br><span class="line"># InnoDB は、ダーティーページの割合がこの値を超えないように、バッファープールからデータをフラッシュしようと試みます。</span><br><span class="line"></span><br><span class="line">innodb_flush_log_at_trx_commit=2</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="现在的设置"><a href="#现在的设置" class="headerlink" title="现在的设置"></a>现在的设置</h2><h3 id="生产环境"><a href="#生产环境" class="headerlink" title="生产环境"></a>生产环境</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">server_id=1</span><br><span class="line">user=mysql</span><br><span class="line">datadir=/home/mysql</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">tmpdir=/home/tmp</span><br><span class="line">bind-address=0.0.0.0</span><br><span class="line"></span><br><span class="line"># log</span><br><span class="line">log_bin=mysql-bin</span><br><span class="line">binlog_error_action=IGNORE_ERROR</span><br><span class="line">expire_logs_days=2</span><br><span class="line">slow_query_log=1</span><br><span class="line">long_query_time=10</span><br><span class="line">slow_query_log_file=/var/log/mysql/slow_query.log</span><br><span class="line">log_error=/var/log/mysql/error.log</span><br><span class="line">log_output=FILE</span><br><span class="line"></span><br><span class="line"># server</span><br><span class="line">sql_mode=&quot;ONLY_FULL_GROUP_BY,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&quot;</span><br><span class="line">default_storage_engine=INNODB</span><br><span class="line">skip-partition</span><br><span class="line">skip-name-resolve</span><br><span class="line">skip-ssl</span><br><span class="line">skip-symbolic-links</span><br><span class="line">max_connections=600</span><br><span class="line">max_connect_errors=300</span><br><span class="line">max_allowed_packet=16M</span><br><span class="line">connect_timeout=30</span><br><span class="line">max_user_connections=30</span><br><span class="line">table_open_cache=19200</span><br><span class="line">interactive_timeout=300</span><br><span class="line">wait_timeout=300</span><br><span class="line">tmp_table_size=256M</span><br><span class="line">max_heap_table_size=256M</span><br><span class="line">default_password_lifetime=0</span><br><span class="line">explicit_defaults_for_timestamp=1</span><br><span class="line">log_timestamps=SYSTEM</span><br><span class="line">disable_partition_engine_check=1</span><br><span class="line">character-set-server=utf8mb4</span><br><span class="line">collation-server=utf8mb4_general_ci</span><br><span class="line"></span><br><span class="line"># buffer</span><br><span class="line">sort_buffer_size=1M</span><br><span class="line">read_buffer_size=1M</span><br><span class="line">read_rnd_buffer_size=1M</span><br><span class="line"></span><br><span class="line"># MyISAM</span><br><span class="line">myisam_sort_buffer_size=128M</span><br><span class="line">key_buffer_size=512M</span><br><span class="line"></span><br><span class="line"># InnoDB</span><br><span class="line">innodb_strict_mode=1</span><br><span class="line">innodb_file_per_table</span><br><span class="line">innodb_temp_data_file_path=ibtmp1:12M:autoextend:max:10G</span><br><span class="line">innodb_buffer_pool_size=56G</span><br><span class="line">innodb_buffer_pool_dump_pct=100</span><br><span class="line">innodb_buffer_pool_dump_at_shutdown=1</span><br><span class="line">innodb_buffer_pool_load_at_startup=0</span><br><span class="line">innodb_log_file_size=512M</span><br><span class="line">innodb_write_io_threads=16</span><br><span class="line">innodb_read_io_threads=16</span><br><span class="line">innodb_io_capacity=2000</span><br><span class="line">innodb_io_capacity_max=5000</span><br><span class="line">innodb_flush_log_at_trx_commit=2</span><br><span class="line">innodb_flush_method=O_DIRECT</span><br><span class="line">innodb_flush_neighbors=0</span><br><span class="line">innodb_read_ahead_threshold=0</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2017/09/13/megaraid/" rel="prev" title="MegaRAID Policy">
                  <i class="fa fa-chevron-left"></i> MegaRAID Policy
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2017/09/13/megacli/" rel="next" title="Megacliの基本操作">
                  Megacliの基本操作 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lyvivian</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
